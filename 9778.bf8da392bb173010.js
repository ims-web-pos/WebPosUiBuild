"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[9778],{11192:(F,U,d)=>{d.d(U,{C:()=>M});var e=d(42326),t=d(64537),u=d(67311),s=d(94534),R=d(53074);let M=(()=>{class j{constructor(g,m,v){this.alertService=g,this.genericProductService=m,this.masterService=v,this.rateValidationDisplayMessage="",this._trnMainService=m._trnMainService,this.userSetting=m.userSetting}mrpEnterEvent(g,m,v,l,S=new Function,b=new Function,a=new Function){"Tab"==l?.key&&l?.preventDefault(),(null==S()||"default"==S())&&(console.log("log 1"),this.mrpEnterEvent_CheckSellingRate(m)),this._trnMainService.TrnMainObj.VoucherType!=e.Km.ManualstockEntry&&this.mrpEnterEvent_validateRate(g,m,v.focusTo||"default"),console.log("clicktab");var n=b();1==n.preCheck?this.mrpEnterEvent_preCheckValidation(m,n.useDefault,v.focusTo||"default"):(console.log("rateissue"),this.mrpEnterEvent_checkValidation(m,n.useDefault,v.focusTo)),0==(null==a()||a())&&this.mrpEnterEvent_CalcuteBillDefault(m),this.genericProductService.navigationUsingFocusService(m,"ALTRATE","productEntrySetting.tableId")}mrpEnterEvent_new(g,m,v){return v.checkSellingRate&&(console.log("log 2"),this.mrpEnterEvent_CheckSellingRate(m)),this.mrpEnterEvent_validateRate(g,m,v.validateRateReturn.focusToId),console.log("clicktab"),1==v.checkValidationReturn.preCheckValidation?this.mrpEnterEvent_preCheckValidation(m,!0,"ITEMDESC"):this.mrpEnterEvent_checkValidation(m,!0,"ITEMDESC"),v.calculateBillReturn.useDefault&&this.mrpEnterEvent_CalcuteBillDefault(m),!1}mrpEnterEvent_CheckSellingRate(g){this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1!=this._trnMainService.TrnMainObj.ProdList[g].PTYPE&&this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length&&0==this._trnMainService.TrnMainObj.ProdList[g].ALTUNITObj.RATE_A&&0==this._trnMainService.TrnMainObj.ProdList[g].MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(v=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),console.log("popup loggg22"),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.genericProductService.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500))}mrpEnterEvent_validateRate(g,m,v){if(g.ALTRATE<1||null==g.ALTRATE||null==g.ALTRATE)return confirm(" Zero  Rate Entry Detected For Item '"+g.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")?(console.log("reachq"),!1):(document.getElementById("ALTRATE"+m).focus(),console.log("reachq"),!0);this.genericProductService.focusByElementId(v)}mrpEnterEvent_preCheckValidation(g,m,v){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance)null!=document.getElementById("MRP"+g)?document.getElementById("MRP"+g).focus():0==this._trnMainService.TrnMainObj.ProdList[g].REQEXPDATE?this.mrpEnterEvent_checkValidation(g,m,v):document.getElementById("MFGDATE"+g).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn)this.mrpEnterEvent_checkValidation(g,m,v="ITEMDESC");else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.genericProductService.activeurlpath)this.mrpEnterEvent_checkValidation(g,m,v);else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)"Non-Discountable"===this._trnMainService.TrnMainObj.ProdList[g].DISMODE?this.mrpEnterEvent_checkValidation(g,m,v):null!=document.getElementById("INDDISCOUNTRATE"+g)?document.getElementById("INDDISCOUNTRATE"+g).focus():document.getElementById("MFGDATE"+g).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+g)&&document.getElementById("OrderComment"+g).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(console.log("raktab"),1==this._trnMainService.userSetting.EnableOnetoOneProduction)return!1;this.mrpEnterEvent_checkValidation(g,m,v)}else this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack?this.mrpEnterEvent_checkValidation(g,m,v):this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue?(console.log("stock issue when batch selected"),this.mrpEnterEvent_checkValidation(g,m,v)):null!=document.getElementById("INDDISCOUNTRATE"+g)?document.getElementById("INDDISCOUNTRATE"+g).focus():null!=document.getElementById("remarks"+g)?document.getElementById("REMARKS"+g).focus():(console.log("foucsmfg"),document.getElementById("MFGDATE"+g)?.focus())}mrpEnterEvent_checkValidation(g,m,v){console.log("reached cehck validation");var l=this._trnMainService.TrnMainObj.ProdList[g];if(null!=l&&null==l.MCODE)return this.alertService.warning("Please select a Product"),!1;if(1==m&&0==this.mrpEnterEvent_CheckValidation_Default(g))return;let b=g;b=g+1,this.mrpEnterEvent_AddNewRow(),"default"!=v.toLocaleLowerCase()?this.genericProductService.focusByElementId(v+b):this.mrpEnterEvent_focusNextDefault(g)}mrpEnterEvent_AddNewRow(){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():this._trnMainService.ReCalculateBillWithNormal(),!this._trnMainService.TrnMainObj.ProdList.some(g=>null==g.MCODE))return this._trnMainService.addRow()}mrpEnterEvent_focusNextDefault(g){let m=g+1;1==this._trnMainService.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("barcode"+m)?(console.log("rn1"),document.getElementById("barcode"+m).focus()):document.getElementById("itemDesc"+m).focus()},50):setTimeout(()=>{null!=document.getElementById("itemDesc"+m)&&document.getElementById("itemDesc"+m).focus()},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+m)&&document.getElementById("itemDesc"+m).focus()},50))}mrpEnterEvent_CheckValidation_Default(g){var m=this._trnMainService.TrnMainObj.ProdList[g];if(m){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==m.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${m.ITEMDESC} (${m.MENUCODE}) Please Check Your Entry.`),!1;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!=this.genericProductService.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE){var v=this.genericProductService.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(l){return[l.MCODE,l.RATE,l.BC,l.BATCH]});for(const l of v)if(l.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){let l=this._trnMainService.TrnMainObj.ProdList.filter(S=>1==S.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(S.EXPDATE))[0];if(null!=l&&1!=this._trnMainService.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${l.ITEMDESC}`),!1}return"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[g].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[g].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[g].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[g].SELECTEDITEM.MAXLEVEL)?(this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+g).focus(),!1):!((this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)&&0==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[g].Quantity>this._trnMainService.TrnMainObj.ProdList[g].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[g].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[g].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[g].PTYPE&&this._trnMainService.TrnMainObj.ProdList[g].PTYPE<10&&(this.alertService.info("Quantity Exceed the available Stock."),document.getElementById("basequantity"+g).focus(),1))}}mrpEnterEvent_CalcuteBillDefault(g){(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(g),this._trnMainService.checkDeuplicateCodeAndRate(g)),this._trnMainService.ReCalculateBillWithNormal()}mrpEnterAssetPI(g,m,v){g.ALTUNIT==g.UNIT&&(g.Rate=g.ALTRATE),g.ALTRATE<this._trnMainService.TrnMainObj.MinDepValue&&(this.alertService.warning("Rate cannot be less than Minimun Depreciation Value!"),g.ALTRATE=this._trnMainService.TrnMainObj.MinDepValue),this._trnMainService.ReCalculateBillForAsset(this._trnMainService.TrnMainObj)}MRPChangeEvent(g,m,v,l){let S=this._trnMainService.TrnMainObj.ProdList[v].PTYPE;if("goods-received-note"==this.genericProductService.activeurlpath&&"NEW"==this._trnMainService.TrnMainObj.Mode){let b=this.masterService.userProfile.roleRights.find(a=>"ALLOWRATECHANGEINPI"==a.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==b.value&&(this._trnMainService.TrnMainObj.ProdList[v].TEMP_ALTRATE==this._trnMainService.TrnMainObj.ProdList[v].ALTRATE||confirm("PRATE DOEN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this._trnMainService.TrnMainObj.ProdList[v].ALTRATE=this._trnMainService.TrnMainObj.ProdList[v].TEMP_ALTRATE))}this.validateRate(l,v),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&1!=S&&(console.log("rnk1"),(this._trnMainService.TrnMainObj.ProdList[v].showPriceChangePopup&&2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch)&&(this._trnMainService.showPriceChangeDetail=!0),console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.genericProductService.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&this.validateCostPrice(),this._trnMainService.TrnMainObj.ProdList[v].UNIT==this._trnMainService.TrnMainObj.ProdList[v].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[v].RATE=this._trnMainService.TrnMainObj.ProdList[v].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[v].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[v].RATE=this._trnMainService.TrnMainObj.ProdList[v].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[v].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].SELLRATEBEFORETAX=this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].RATE,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].MRP=this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkRateisChangedinSoFromQT()}validateRate(g,m){if(g.ALTRATE<1||null==g.ALTRATE||null==g.ALTRATE)return!confirm(" Zero  Rate Entry Detected For Item '"+g.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")&&(document.getElementById("ALTRATE"+m).focus(),!0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let v=this.getSellingRate();this.validateSellingPriceBelowLandingCost(v,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].PRATE,this.genericProductService.activerowIndex)}}getSellingRate(){let g=this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].RATE;return 1==this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ISVAT&&this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder&&(g=1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTRATE/this.userSetting.VatConRate),g}validateSellingPriceBelowLandingCost(g,m,v){if(g<m)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{null!==document.getElementById("INDDISCOUNTRATE"+v)?document.getElementById("INDDISCOUNTRATE"+v).focus():document.getElementById("REMARKS"+v).focus()},0)}),!1}validateCostPrice(){this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTRATE>this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling price")}checkRateisChangedinSoFromQT(){this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTRATE!==this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].PORATE&&(confirm("Rate is change Do you want to proceed .")||(this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].PORATE))}calculateFCRATEChangeEvent(g){this._trnMainService.TrnMainObj.ProdList[g]&&(this._trnMainService.TrnMainObj.ProdList[g].ALTRATE=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[g].INVRATE)*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EXRATE),this._trnMainService.TrnMainObj.ProdList[g].REALRATE=this._trnMainService.TrnMainObj.ProdList[g].ALTRATE/this._trnMainService.TrnMainObj.ProdList[g].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[g].RATE=this._trnMainService.TrnMainObj.ProdList[g].ALTRATE/this._trnMainService.TrnMainObj.ProdList[g].ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal())}AlternateUnitEnterEventClick(g,m,v,l){console.log("event",g,v,m,l),l.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&(console.log("focusnext"),document.getElementById("ALTERNATEQUANTIY"+m).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&document.getElementById("approvedQty"+m).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("physicalStock"+m).focus()),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this._trnMainService.TrnMainObj.ProdList[m].BC&&""!=this._trnMainService.TrnMainObj.ProdList[m].BC&&void 0!==this._trnMainService.TrnMainObj.ProdList[m].BC&&document.getElementById("RATE"+m).focus(),74==this._trnMainService.TrnMainObj.VoucherType&&null!=this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&null!=this._trnMainService.TrnMainObj.ProdList[m].ALTUNIT&&document.getElementById("ALTERNATEQUANTIY"+m).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&document.getElementById("ALTERNATEQUANTIY"+m).focus()}RemarksEnterCommand(g,m,v,l){if(l.preventDefault(),"asset-purchase-invoice"!=this._trnMainService.activeurlpath){if(this.genericProductService.showBatchWiseDetail=!1,this.genericProductService.checkValidation(m)||this.masterService.focusAnyControl("REMARKS"+m),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval){let S=m+1;setTimeout(()=>{null!=document.getElementById("ALTUNIT"+S)&&document.getElementById("ALTUNIT"+S).focus()},50)}return!1}setTimeout(()=>{null!=document.getElementById("ACNAME"+this.genericProductService.activerowIndex)&&document.getElementById("ACNAME"+this.genericProductService.activerowIndex).focus()})}}return j.\u0275fac=function(g){return new(g||j)(t.LFG(u.c),t.LFG(s.w),t.LFG(R.P))},j.\u0275prov=t.Yz7({token:j,factory:j.\u0275fac}),j})()},56209:(F,U,d)=>{d.d(U,{u:()=>y});var e=d(88692),t=d(20092),u=d(71800),s=d(39773),R=d(31644),M=d(37469),j=d(48760),x=d(63321),g=d(29546),m=d(65063),v=d(59629),l=d(69401),S=d(11192),b=d(94534),a=d(68328),n=d(92849),T=d(97784),p=d(33612),O=d(64537);let y=(()=>{class _{static forRoot(){return{ngModule:_,providers:[]}}}return _.\u0275fac=function(P){return new(P||_)},_.\u0275mod=O.oAB({type:_}),_.\u0275inj=O.cJS({providers:[b.w,S.C,a.X,p.i],imports:[n.S,x._,M.X,R.v,m.f,g.l,j.L,T.m,e.ez,t.u5,t.UX,l.m,v.Z,s.X.forRoot(),u.zk.forRoot()]}),_})()},60716:(F,U,d)=>{d.d(U,{Vn:()=>t});var e=d(42326);class t{constructor(g){this.barcodeDisplay=!1,this.checkRefOrderBill=!1,this.gridPopUpApiForReturn="",this.multiCurrency=!1,this.showSubHeading=!1,this._trnMainService=g,this.userSetting=g.userSetting,this.itemPopupUrlSetting=new M}setItemPopupUrlDefaults(){this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this.itemPopupUrlSetting.showStock=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&(this.itemPopupUrlSetting.showStockIssueQty=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(this.itemPopupUrlSetting.showPQty=!1,this.itemPopupUrlSetting.showNetRate=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&(this.itemPopupUrlSetting.showRate=!1,this.itemPopupUrlSetting.stockTitle="SALES QTY",this.itemPopupUrlSetting.showInCreditNote=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(this.itemPopupUrlSetting.showPOStock=!1,this.itemPopupUrlSetting.grpName=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE&&(this.itemPopupUrlSetting.showPOStock=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.itemPopupUrlSetting.showQTStock=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(this.itemPopupUrlSetting.showMRP=!0,this.itemPopupUrlSetting.showSOStock=!1,this.itemPopupUrlSetting.grpName=!0):(this.itemPopupUrlSetting.showMRP=!1,this.itemPopupUrlSetting.showSOStock=!0,this.itemPopupUrlSetting.grpName=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.itemPopupUrlSetting.showRequesitionQty=!1)}}class M{constructor(){this.showStockIssueQty=!0,this.showNetRate=!0,this.showRate=!0,this.stockTitle="STOCK",this.showPOStock=!0,this.showQTStock=!0,this.showSOStock=!0,this.grpName=!1,this.showInCreditNote=!0,this.showRequesitionQty=!0,this.showMRP=!0,this.showStock=!1,this.showPQty=!0}}},68328:(F,U,d)=>{d.d(U,{K:()=>v,X:()=>m});var e=d(42326),t=d(27009),u=d(64537),s=d(94534),R=d(7976),M=d(54536),j=d(60694),x=d(67311),g=d(53074);let m=(()=>{class l{constructor(b,a,n,T,p,O){this.genericProductEntryService=b,this.arouter=a,this.dialog=n,this.responseMsgService=T,this.alertService=p,this.masterService=O,this._trnMainService=b._trnMainService,this.masterService=b.masterService,this.userSetting=this._trnMainService.userSetting,this.activeurlpath=a.snapshot.url[0]?.path}ItemkeyEvent(b,a,n=new Function,T=new Function,p=new Function,O=new Function,y=new Function){if(a.preventDefault(),this._trnMainService=this.genericProductEntryService._trnMainService,this.genericProductEntryService.activerowIndex=b,this.checkCustomerSelected()){if(n()==v.default&&this.get_showStockedQuantityOnly(),T(this.genericProductEntryService.showStockedQuantityOnly)==v.default&&this.setItemPopupUrl(),"VIEW"==this._trnMainService?.TrnMainObj?.Mode?.toUpperCase())return void this.displayProductDetailInViewMode(a);var _=p();if(_==v.default){if(1==this.checkSelfBilling())return}else if(_==v.returnFunction)return;this._trnMainService.currentIndexProductDetails=[];var I=O();if(I!=v.returnFunction&&(I!=v.default||1!=this.itemKeyEvent_CheckFlatDiscount())){var P=y();if(console.log("call back check",P),P!=v.default&&null!=P||this.itemKeyEvent_CheckRefBill())return this._trnMainService.itemselectevent=!0,this.showGenericGrid(),!1}}}checkCustomerSelected(){return"performa-invoice"!=this.genericProductEntryService.activeurlpath&&"delivery-chalan"!=this.genericProductEntryService.activeurlpath||null!=this._trnMainService.TrnMainObj.BILLTO||(this.alertService.warning("Please select customer first"),this.alertService.emitShowHideSubject.subscribe(b=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("customerselectid").focus()},100)}),!1)}setItemPopupUrl(){console.log("set item popup urlrp",this.userSetting.DefaultFilterIndex);let b=!0,a=!0,n=!0,T=!0,p="STOCK",O=!0,y=!0,_=!0,I=!1,P=!0,L=!0,w=!0,V=!1,N=!1,D=!1,E=!0,C=!0,i=!1,c=!0;"requisition-log"==this._trnMainService.activeurlpath&&(i=!0),1===this.userSetting.OneToOneBarcodeMode&&[e.Km.GoodsReceived,e.Km.Purchase,e.Km.DebitNote,e.Km.OpeningStockBalance,e.Km.PurchaseOrder,e.Km.SalesOrder,e.Km.Quotation,e.Km.CreditNote,e.Km.StockSettlement,e.Km.Sales,e.Km.PerformaSalesInvoice,e.Km.TaxInvoice,e.Km.StockIssue,e.Km.RequisitionEntry,e.Km.BranchTransferOut].indexOf(this._trnMainService.TrnMainObj.VoucherType)>=0&&(E=!1,C=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&(a=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(b=!1,n=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&(T=!1,p="SALES QTY",P=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn&&(p="ISSUED QTY",I=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(O=!1,I=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(O=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(y=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(w=!0,_=!1,I=!0):(w=!1,_=!0,I=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(w=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&2==this.userSetting.EnableBatch&&(c=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(L=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0===this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE)&&(N=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(D=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&(V=!0),this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.genericProductEntryService.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,filterSupplierWise:N,showLoadAllProductsOption:D,multiSelect:i,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:I,noSearch:!0},{key:"BATCH",title:"BATCH",hidden:c,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:b,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:a,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:n,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:T,noSearch:!0},{key:this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn?"ALTUNIT":"BASEUNIT",title:"UNIT",hidden:this._trnMainService.TrnMainObj.VoucherType!==e.Km.DeliveryReturn&&w,noSearch:!0},{key:this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn?"ALTSTOCK":"STOCK",title:p,hidden:V,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:L,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:P,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:O,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:y,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:_,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:O,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:_,noSearch:!0,alignment:"right",pipe:!0},{key:"BCODE",title:"BARCODE",hidden:E,noSearch:C},{key:"MRP",title:"MRP",hidden:w,noSearch:!0,alignment:"right",pipe:!0}]}}itemKeyEvent_CheckFlatDiscount(){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))return this.alertService.info("Flat Discount is already given could not add new product"),!0}displayProductDetailInViewMode(b){console.log("eventlog",b),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==b.code&&this.dialougeOpen()}get_showStockedQuantityOnly(){return this.genericProductEntryService.showStockedQuantityOnly=0,this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,this.genericProductEntryService.showStockedQuantityOnly}itemKeyEvent_CheckRefBill(){if(console.log("khai ?????"),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,console.log("eter clicked",this._trnMainService.TrnMainObj.VoucherType,this.userSetting.PODELIVERYMODE,this.genericProductEntryService.activeurlpath,this.userSetting.DisablePOReferenceRequired),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.genericProductEntryService.activeurlpath&&0==this.userSetting.DisablePOReferenceRequired||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0==this.userSetting.DisablePOReferenceRequired||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&0!==this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn&&0===this._trnMainService.TrnMainObj.DOFULLRETURN){if(console.log("eta ?"),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0!=this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER){if(!this._trnMainService.TrnMainObj.REFORDBILL){let b=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(b),!1}}else if(null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.info(this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj)),!1;this.genericProductEntryService.gridPopupSettings.apiEndpoints=`/getMenuitemFromProdForIssueReturnPagedList/${this._trnMainService.TrnMainObj.BILLTO}`}else if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&1==this.userSetting.DisablePOReferenceRequired&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&1==this.userSetting.DisablePOReferenceRequired&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.ENABLE_GRN_IN_IMPORTPI&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(0!==this.userSetting.ENABLE_SOINTI&&null!=this._trnMainService.TrnMainObj.REFORDBILL&&(0==this.userSetting.SOREFERENCE_REQUIRED&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice))this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else{let a,b="";"self-billing"===this.genericProductEntryService.activeurlpath?b="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(b=this._trnMainService.TrnMainObj.VoucherPrefix);let n="";if(n=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(n=this._trnMainService.TrnMainObj.BILLTO,null==this._trnMainService.TrnMainObj.BILLTO))return void this.alertService.info("Please select From Warehouse before selecting an item ");if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&(null==this._trnMainService.TrnMainObj.MWAREHOUSE||""==this._trnMainService.TrnMainObj.MWAREHOUSE))return void this.alertService.info("Please select Warehouse before selecting item");if(a=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC,(0==this.userSetting.GblBarcodeWiseBilling||null==a||void 0===a||""==a)&&(a="A"),this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please select Production warehouse");n=this._trnMainService.TrnMainObj.BILLTO}this.genericProductEntryService.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.genericProductEntryService.showStockedQuantityOnly}/${a}/all/${b}/${n}`,"EDIT"==this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&(this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList")}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE){let b="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(b=this._trnMainService.TrnMainObj.VoucherPrefix),this.genericProductEntryService.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.genericProductEntryService.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}if("add-membership-sales-invoice"==this.genericProductEntryService.activeurlpath&&(this.genericProductEntryService.gridPopupSettings.apiEndpoints="/getMenuItemListForMembershipSales"),this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.GoodsReceived&&"GOODS_RECEIVED_NOTE_IMPORT"==this._trnMainService.TrnMainObj.AdditionalObj.tag){if(null==this._trnMainService.TrnMainObj.BILLTO||void 0===this._trnMainService.TrnMainObj.BILLTO||""==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please Choose Supplier to Proceed...");if(!this._trnMainService.TrnMainObj.EXRATE)return void this.alertService.info("Please choose exchange rate to proceed or exchange rate cannot be zero...")}return this.genericProductEntryService.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||"FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL),!1}dialougeOpen(){console.log("dialouge open ProductDetails",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails),this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails,this.dialog.open(t.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(n=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?n?.data:n&&n.data&&n.data.productColorList?n.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.genericProductEntryService.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else document.getElementById("RATE"+this.genericProductEntryService.activerowIndex).focus()},20)})}showGenericGrid(){"requisition-log"==this._trnMainService.activeurlpath&&(this.genericProductEntryService.gridPopupSettings.multiSelect=!0),this.genericProductEntryService.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||"FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL)}checkSelfBilling(){if("self-billing"===this.genericProductEntryService.activeurlpath){if(""==this._trnMainService.TrnMainObj.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),this.alertService.emitShowHideSubject.subscribe(b=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)}),!0;if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return this.alertService.warning("Please select an Account Name!"),!0;if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return this.alertService.warning("Please select an Account Before self billing!"),!0;if(""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS)return this.alertService.warning("Remarks is mandatory!"),this.alertService.emitShowHideSubject.subscribe(b=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)}),!0;console.log("Check Tna",this._trnMainService.TrnMainObj.TRNACName,this._trnMainService.TrnMainObj.REMARKS),this.genericProductEntryService.showStockedQuantityOnly=0}return!1}ItemKeyEventForAsset(b,a=new Function){a(),this.genericProductEntryService.activerowIndex=b,this.genericProductEntryService.genericGrid.show()}ItemkeyEventForConsumptionEntry(b,a,n=new Function,T=new Function,p=new Function,O=new Function,y=new Function,_){if(a.preventDefault(),this._trnMainService=_,this.genericProductEntryService.activerowIndex=b,this.checkCustomerSelected()){if(n()==v.default&&this.get_showStockedQuantityOnly(),T(this.genericProductEntryService.showStockedQuantityOnly)==v.default&&this.setItemPopupUrl(),"VIEW"==this._trnMainService?.TrnMainObj?.Mode?.toUpperCase())return void this.displayProductDetailInViewMode(a);var I=p();if(I==v.default){if(1==this.checkSelfBilling())return}else if(I==v.returnFunction)return;this._trnMainService.currentIndexProductDetails=[];var P=O();if(P!=v.returnFunction&&(P!=v.default||1!=this.itemKeyEvent_CheckFlatDiscount())){var L=y();if(L!=v.default&&null!=L||this.itemKeyEvent_CheckRefBill())return this._trnMainService.itemselectevent=!0,this.showGenericGrid(),!1}}}}return l.\u0275fac=function(b){return new(b||l)(u.LFG(s.w),u.LFG(R.gz),u.LFG(M.uw),u.LFG(j.T),u.LFG(x.c),u.LFG(g.P))},l.\u0275prov=u.Yz7({token:l,factory:l.\u0275fac}),l})();var v=(()=>{return(l=v||(v={}))[l.default=0]="default",l[l.done=1]="done",l[l.returnFunction=2]="returnFunction",v;var l})()},91772:(F,U,d)=>{d.d(U,{s:()=>S});var e=d(42326),t=d(71732),s=d(27009),R=d(23815),j=d(64537),x=d(94534),g=d(67311),m=d(54536),v=d(7976),l=d(33612);let S=(()=>{class b{constructor(n,T,p,O,y){this.genericProductEntryService=n,this.alertService=T,this.dialog=p,this.arouter=O,this.focusService=y,this._trnMainService=n._trnMainService,this.masterService=n.masterService,this.userSetting=this.genericProductEntryService.userSetting,this.activerowIndex=n.activerowIndex,this.activeurlpath=this.genericProductEntryService.activeurlpath}QuantityChangeEvent(n){let T=this._trnMainService.TrnMainObj.VoucherType;if("asset-purchase-invoice"===this._trnMainService.activeurlpath||"assets-openingstockentry"===this._trnMainService.activeurlpath)return void this._trnMainService.ReCalculateBillForAsset(this._trnMainService.TrnMainObj);if(this.checkBCForMatrxiItem(),this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){let _=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK;if((1==this.userSetting.EnableBomBaseConsumption||2==this.userSetting.EnableBomBaseConsumption)&&(_=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTALSTOCK),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY>_)return this.alertService.warning("Entered quantity is greater than stock quantity!!"),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].AMOUNT=0)}if(this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&this._trnMainService.calculateBatchAdjustmentVariance(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){if(!this._trnMainService.allowMinusStockInEditMode(this.genericProductEntryService.activerowIndex)){let _=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];if(T in e.SL){if(console.log("loghere"),(p=this.ValidateQuantityinEDITMode())&&!p.status)return this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=p.userEnterQty,void this.alertService.info(p.message);this._trnMainService.quantityExceedCheck=""}if(T in e.fr&&1==this.userSetting.EnableBatchWisePrice&&2!=this.userSetting.EnableBatch){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].rowMode?.toUpperCase())if(!0!==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PriceSelected)this.checkBatchWiseRateinEditMode();else{var p;if((p=this.ValidateQtyEDITModeForOUt())&&!p.status)return this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=p.userEnterQty,void this.alertService.info(p.message)}else if((p=this.ValidateQtyEDITModeForOUt())&&!p.status)return this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=p.userEnterQty,void this.alertService.info(p.message);let I=this.checkItemStockINEditModeForOutQty();if(I&&!I.status)return void this.alertService.info(I.message)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(console.log("active",_),!this.checkBatchWiseEnterStock())return void this.alertService.warning("Entered quantity is greater than stock quantity!!");if("EDIT"===_?.RowMode?.toUpperCase()&&_&&!this.ValidateQtyINEditModeFroProduction(_))return}}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue)&&2==this.userSetting.EnableBatch){let _=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].EDITABLEQTY,I=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY,P=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BILLEDQTY,L=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT;0==_?I>P&&(this.alertService.info(`Item: '${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}' entered quantity: ${I} ${L} is more than editable quantity: ${P} ${L}`),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0):I>P+_&&(this.alertService.info(`Item: '${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}' entered quantity: ${I} ${L} is more than editable quantity: ${P+_} ${L}`),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0)}}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0);if((this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase)&&0!==this.userSetting.PODELIVERYMODE&&0==this.userSetting.AllowQtyExceedInPo&&("FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL.startsWith("PO"))&&this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY>this._trnMainService.TrnMainObj.ProdList[n].POSTOCK)return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[n].ITEMDESC} cannot have quantity more than PO Quantity.`),void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.genericProductEntryService.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[n].ITEMDESC} cannot have quantity more than one for membership sales invoice`),this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(_=>{setTimeout(()=>{null!==document.getElementById("rate"+n)&&document.getElementById("rate"+n).focus()},100)})),this._trnMainService.calculateNetRATE(n),this._trnMainService.ReCalculateBillWithNormal(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&this.genericProductEntryService.onChangeProductionItem.emit(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&"goods-received-note-import"==this._trnMainService.activeurlpath&&1==this.userSetting.ENABLE_GRN_IN_IMPORTPI||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"purchase-import"==this._trnMainService.activeurlpath)&&2==this.userSetting.IMPORTPOBILLMODE&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&(!this._trnMainService.validatePOQtyInImportGRN(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity,this.genericProductEntryService.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC)||!this._trnMainService.validatedDuplicateInImportGRN(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE,this.genericProductEntryService.activerowIndex))||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&!this._trnMainService.validatePurchaseQtyInDebitNote(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PSTOCK,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity,this.genericProductEntryService.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC))return;if(this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn){let _=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];if(!this._trnMainService.validateIssueQtyInStockIssueReturn(_.PSTOCK,_.ALTERNATEQUANTIY,this.genericProductEntryService.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity=0)}if(console.log("activerowinsert",this.genericProductEntryService.activerowIndex),this._trnMainService.allowNegativeBilling(this.genericProductEntryService.activerowIndex)?console.log("check user irghrs here"):this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this._trnMainService.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE)&&(console.log("check entered product stock"),this.checkEnteredProductStock()),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn)&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE<10&&0==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&1==this._trnMainService.userSetting.CheckSaleableQtyInSO&&0!=this.userSetting.EnableStockCheckInSO&&this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE<10&&7!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].NATURETYPE&&(console.log("selabel soprodlist",this._trnMainService.TrnMainObj.ProdList),this.checkSaleableQuantityInSalesOrder()),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.REFBILL&&this.checkStockInDREdit(n),((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(0!==this._trnMainService.userSetting.PODELIVERYMODE||0!==this._trnMainService.userSetting.IMPORTPOBILLMODE)||0!==this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice))&&this._trnMainService.TrnMainObj.ProdList[n].Quantity<this._trnMainService.TrnMainObj.ProdList[n].POSTOCK){let _="Quantity is less than PO Stock!! Are you sure you want to proceed further";if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&1===this._trnMainService.userSetting.AllowQtyExceedInPo&&(_="Quantity is less than PO Stock!!! PO Stock placed as Quantity.",this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=this._trnMainService.TrnMainObj.ProdList[n].POSTOCK),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(_="Quantity is less than SO Stock!! Are you sure you want to proceed further"),!confirm(_))return this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=0,document.getElementById("alternateqty"+n).focus(),void this._trnMainService.ReCalculateBillWithNormal()}this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.genericProductEntryService.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.genericProductEntryService.activerowIndex)||(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn)&&9!==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE&&this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE<10&&this.checkBatchWiseStockOut(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.getItemRelatedDiscount(this.genericProductEntryService.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE}),(0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(1===this._trnMainService.userSetting.PODELIVERYMODE||2===this._trnMainService.userSetting.PODELIVERYMODE)&&null!=this._trnMainService.TrnMainObj.REFORDBILL&&""!=this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this._trnMainService.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(1==this._trnMainService.userSetting.PODELIVERYMODE||2==this._trnMainService.userSetting.PODELIVERYMODE)&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"===this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this._trnMainService.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode();let O=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];T in e.po&&(!this._trnMainService.allowNegativeBilling(this.genericProductEntryService.activerowIndex)&&"self-billing"!=this.genericProductEntryService.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE<10&&this.checkItemTotalQtyWithStock(O.MCODE,O.BC,O.HASVARIANT,O.RATE,this.genericProductEntryService.activerowIndex,O.BATCH),"self-billing"!=this.genericProductEntryService.activeurlpath&&this.valiadateDuplicateRateItem(O.HASVARIANT,O.MCODE,O.RATE,O.BATCH,this.genericProductEntryService.activerowIndex)),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&"NEW"==this._trnMainService.TrnMainObj.Mode)&&(console.log("JJJJJ"),this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].UNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} \n        @Qty = ${this.totalQuantity} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT} `));const y=document.getElementById("ITEMDESC"+n);if(this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&y&&""!==y.value?.trim()){let _=n+1;const I=document.getElementById("ITEMDESC"+_);let P={isFocusAchieved:!1};this.focusService.autoFocus(n,document.getElementById("ALTERNATEQUANTIY"+n),P,"productEntrySetting.tableId"),P.isFocusAchieved||(this.genericProductEntryService.checkValidation(n),I&&""!==I.value?.trim()&&this.focusService.autoFocus(_,document.getElementById("ITEMDESC"+_),{},"productEntrySetting.tableId"))}}checkStockInDREdit(n){let T=this._trnMainService.TrnMainObj.ProdList[n].POSTOCK/this._trnMainService.TrnMainObj.ProdList[n].ALTCONFACTOR;this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY>T&&(this.alertService.info(`Enter quantity is greater than main quantity: ${T}!`),this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=0)}AlternateQuantityEventClick(n){if(console.log("rkone"),this.QuantityChangeEvent(n),this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&(this._trnMainService.TrnMainObj.ProdList[n+1]||this._trnMainService.addRow(),setTimeout(()=>{this.genericProductEntryService.focusNext(n)},10)),"asset-purchase-invoice"!=this.activeurlpath&&"assets-openingstockentry"!=this.activeurlpath||"NEW"!=this._trnMainService.TrnMainObj.Mode){if(5==this._trnMainService.TrnMainObj.CNDN_MODE&&"EDIT"==this._trnMainService.TrnMainObj.Mode){let O=this._trnMainService.TrnMainObj.VCHRNO,y=this._trnMainService.TrnMainObj.AssetsProdList[n].MCODE,_=this._trnMainService.TrnMainObj.AssetsProdList[n].BATCH;"new"!==this._trnMainService.TrnMainObj.AssetsProdList[n].rowMode&&this.masterService.getAssetEditableQty(O,y,_).subscribe(I=>{if("ok"==I.status){let P=this._trnMainService.TrnMainObj.AssetsProdList[n].ALTQTY_IN;if(I.result>0&&P>I.result)return void this.alertService.info(`Entered Qty${P} exceed the assets assign qty${I.result} `)}})}var T;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&setTimeout(()=>{document.getElementById("RATE"+n)?.focus()},20),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn)&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DONONSALEABLERETURN)if(T=this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[n].MCODE),this._trnMainService.TrnMainObj.ProdList[n].STOCK<T)return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity");if((this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL>0){const O=this._trnMainService.TrnMainObj.ProdList[n].TOTSTOCK-this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[n].MCODE);if(O<this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL)return this.alertService.warning(`Stock Qty Goes Below Minimum Stock Level. (Min Stock : ${this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL} | Stock Qty : ${O})`),void(1==this._trnMainService.TrnMainObj.ProdList[n]?.MINWARN&&(this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=0))}if(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]?.BC||1===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]?.HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder)&&(this.alertService.info("Please select variants first!"),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE}`).subscribe(O=>{"ok"==O.status&&O.result&&O.result.length&&this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{this.genericProductEntryService.matrixItemAtrribute=O.result,this.genericProductEntryService.matrixitemgrid.show()})})})),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]?.NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails=[]),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(0,t.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(1!==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].NATURETYPE||this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null==this._trnMainService.TrnMainObj.ProdList[n].BC||""==this._trnMainService.TrnMainObj.ProdList[n].BC||null==this._trnMainService.TrnMainObj.ProdList[n].BC||this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY)&&this.dialougeOpen()),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.checkMaxStockLevel(n),this._trnMainService.TrnMainObj.ProdList[n]?.PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&this.checkReorderStocklevel(n),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&9!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE&&(this._trnMainService.allowNegativeBilling(this.genericProductEntryService.activerowIndex)||this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&this.genericProductEntryService.checkValidation(n),"self-billing"===this.activeurlpath&&this.genericProductEntryService.checkValidation(n),"variant-adjustment"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.genericProductEntryService.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.genericProductEntryService.activerowIndex).focus()},20)),this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.ProdList[n].HASVARIANT){let O=0;O=this._trnMainService.ReturnStockReconcileForVariantItem(this._trnMainService.TrnMainObj.ProdList[n].MCODE,this._trnMainService.TrnMainObj.ProdList[n].BC);let I=this._trnMainService.TrnMainObj.ProdList[n].STOCK;if(I<O)return void this.alertService.info(`Entered Quantity exceed the stock Quantity ${I} `)}(this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.GoodsReceived)&&this.focusService.autoFocus(n,document.getElementById("ALTERNATEQUANTIY"+n),{},"productEntrySetting.tableId")}}checkMaxStockLevel(n){0!==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].STOCK)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this._trnMainService.TrnMainObj.ProdList[n].MAXLEVEL+" exceeded !")}checkReorderStocklevel(n){var T=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].STOCK)-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY);if(T<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL))return;if(T<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this._trnMainService.TrnMainObj.ProdList[n].MINLEVEL),1===this._trnMainService.TrnMainObj.ProdList[n].MINWARN&&(this._trnMainService.TrnMainObj.ProdList[n].ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[n].ROLEVEL))return;1===this._trnMainService.TrnMainObj.ProdList[n].ROWARN&&this.alertService.warning("Re-Order level "+this._trnMainService.TrnMainObj.ProdList[n].ROLEVEL+" has been reached !")}}}dialougeOpen(){console.log("dialouge open ProductDetails",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails),this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails,this.dialog.open(s.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(p=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?p?.data:p&&p.data&&p.data.productColorList?p.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)&&this.calculateRateForStockOut(p?.data),(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.genericProductEntryService.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else this._trnMainService.ReCalculateBillWithNormal(),document.getElementById("ALTRATE"+this.genericProductEntryService.activerowIndex).focus()},20)})}calculateRateForStockOut(n){this.productLists=n,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTRATE=this.productLists[0].Costprice,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].RATE=this.productLists[0].Costprice,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=1,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC=this.productLists[0].IEMI1,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].AMOUNT=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTRATE;for(let T=1;T<this.productLists?.length;T++){let p=(0,R.cloneDeep)(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]);p.ALTRATE=this.productLists[T].Costprice,p.RATE=this.productLists[T].Costprice,p.ALTERNATEQUANTIY=1,p.BC=this.productLists[T].IEMI1,p.AMOUNT=p.ALTERNATEQUANTIY*p.ALTRATE,this._trnMainService.TrnMainObj.ProdList.push(p)}}checkBCForMatrxiItem(){this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC||this.alertService.warning(`Variant Details is not selected for Item :${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} `))}ValidateQuantityinEDITMode(){let n={},T=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].EDITABLEQTY),p=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY,O=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BILLEDQTY,y=0;if(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT?y=p:(y=p,O/=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR),0==T&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTALOUTWARDSTOCK)>0){if(y<O)return n.status=!1,n.userEnterQty=O,n.message=`Item (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}) entered qty (${y}) is more than minimum editable qty is (0) `,n;if(y<this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BILLEDQTY-this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BSTOCK)return n.status=!1,n.userEnterQty=O,n.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY})\n            ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}) \n            ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}  ) ) `,n}if(T>0&&y<this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTALOUTWARDSTOCK)return n.status=!1,n.userEnterQty=O,n.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY})\n            ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT} \n            ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}   ) ) `,n}checkBatchWiseRateinEditMode(){this.genericProductEntryService.batchlist=[];let T="";T=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE}&VCHRNO=${this._trnMainService.TrnMainObj.VCHRNO}&warehouse=${T}`).subscribe(p=>{if("ok"===p.status&&(this.genericProductEntryService.batchlist=p.result,1===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===p.message&&(this.changeBatchWiseRate(p.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK=p.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(p.result),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PRATE=p.result[0].costprice),"SHOWPRICEPOPUP"===p.message&&!(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(p.result[0].RATE)),0===this.genericProductEntryService.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){var O=this.ValidateQtyEDITModeForOUt();if(O&&!O.status)return this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=O.userEnterQty,void this.alertService.info(O.message)}})}ValidateQtyEDITModeForOUt(){let n={},p=(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].EDITABLEQTY),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY),O=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BILLEDQTY,y=0;if(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT?y=p:(y=p*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR,O/=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR),console.log("stock",y,this._trnMainService.TrnMainObj.ProdList),y>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)return n.status=!1,n.userEnterQty=O,n.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY})\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}) \n        ,Exceed the Stock qty (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}  ) ) `,n}checkItemStockINEditModeForOutQty(){let n={},T=0,p=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY;if(T=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT?p:p*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR,"EDIT"!==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].rowMode?.toUpperCase()&&T>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)return n.status=!1,n.message="Enter Qty exceed the batch wise transaction qty",n;if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].rowMode?.toUpperCase()){let O=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BatchWiseEditList?.map(y=>y.INVOICEQTY).reduce((y,_)=>y+_,0);if(T-O>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)return n.status=!1,n.message="Enter Qty exceed the batch wise transaction qty",n}}ValidateQtyINEditModeFroProduction(n){let T=0;return T=n.BASEUNIT===n.ALTUNIT?n.ALTERNATEQUANTIY:n.ALTERNATEQUANTIY*n.ALTERNATEQUANTIY,!(T<n.OUTQTY&&(this.alertService.info(`Item : ${n.ITEMDESC} entered Qty:${T} ${n.BASEUNIT} is less than transaction Qty:${n.OUTQTY}`),1))}checkBatchSelectionInMultiplePrice(){return 1!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]?.HasMulitplePrice||!!this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PriceSelected}checkDuplicateproductEnterQuantity(){let n=0,T={};if(T=2==this.userSetting.EnableBatch?this._trnMainService.TrnMainObj.ProdList.filter(O=>O.MCODE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE&&O.BATCH==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH&&O.BC==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC&&O.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT&&O.PRATE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PRATE&&O.CRATE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].CRATE).forEach(O=>{n+=O.Quantity}):this._trnMainService.TrnMainObj.ProdList.filter(O=>O.MCODE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE&&O.BATCH==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH&&O.BC==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC).forEach(O=>{n+=O.Quantity}),n>(this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&0==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE?this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK:this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].TOTSTOCK)&&9!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE)return this.alertService.info(`Inserted Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} Quantity :\n  ${n}  \n  Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)} \n  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].AMOUNT=0,!1;this._trnMainService.quantityExceedCheck=""}checkEnteredProductStock(){let n=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.Quantity>T.STOCK&&7!=T.NATURETYPE&&T.PTYPE<10)[0];if(console.log("prod stock obj",n),null!=n)return this.alertService.info(n.BASEUNIT!=n.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(n.STOCK)} ${n.BASEUNIT}, Item : ${n.ITEMDESC} @Qty1 = ${n.Quantity} ${n.BASEUNIT} (${n.ALTERNATEQUANTIY} x ${n.ALTCONFACTOR} = ${n.Quantity} ${n.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(n.STOCK)} ${n.BASEUNIT}, Item : ${n.ITEMDESC} @Qty2 = ${n.Quantity} ${n.BASEUNIT} `),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkSaleableQuantityInSalesOrder(){let n=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex],T=n.ALTUNIT==n.BASEUNIT?n.ALTERNATEQUANTIY:n.ALTERNATEQUANTIY*n.ALTCONFACTOR;this.masterService.getSaleableQTY(n.MCODE,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNDATE,this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.TrnMainObj.VCHRNO).subscribe(p=>{if("ok"==p.status){let O=p.result[0].SALEABLE_SQTY;T>O&&(n.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),this.alertService.info("Entered qty is greater than its saleable qty:"+O),this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()},0)}))}},p=>{this.alertService.info(p)})}checkQuantityInSOLoadFromQT(){null!=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.Quantity>T.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT}\nexceed the item wise QT Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].POSTOCK}\n${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}\n`:`Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT} )\n        exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}\n        `),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQTin(){if(null!=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.Quantity<T.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,void document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()}checkRepackStock(){let n=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.BATCH===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH&&T.ROUTQTY>T.STOCK)[0];if(null!=n&&null!=n)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(n.STOCK)} ${n.PUNIT}, Item : ${n.ITEMDESC} @Qty3 = ${n.Quantity} ${n.ALTUNIT} `),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let n=0;if(this._trnMainService.TrnMainObj.ProdList.filter(p=>p.PMCODE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PMCODE&&p.BATCH==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH).forEach(p=>{n+=p.ROUTQTY}),console.log("total Enter qty",n,"stokc",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK),n>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PUNIT},\n      (-${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PUNIT} ) \n      Item : ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let n=0;if(this._trnMainService.TrnMainObj.ProdList.filter(p=>p.MCODE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE&&p.BATCH==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH).forEach(p=>{n+=p.ROUTQTY}),n>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n    Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PUNIT},\n    (-${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PUNIT} ) \n    Item : ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} \n    @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkQuantityInEditMode(){let n=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.Quantity<T.OUTQTY)[0];null!=n?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${n.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}checkBatchWiseStockOut(){this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} `)}checkQuantityInPOdeliveryMode(){console.log("reachdownpodelivery"),(7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]?.NATURETYPE||1!=this.userSetting.AllowQtyExceedInPo)&&null!=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.Quantity>T.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}\n        `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT} )\n        exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BASEUNIT}\n        `),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&1===this._trnMainService.userSetting.AllowQtyExceedInPo&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL||(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0),this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{document.getElementById("alternateqty"+this.genericProductEntryService.activerowIndex).focus()})}))}checkItemTotalQtyWithStock(n,T,p,O,y,_=""){let I=0;if(I=1==p?this._trnMainService.TrnMainObj.ProdList.filter(P=>P.MCODE==n&&P.BC==T&&P.RATE==O).map(P=>P.Quantity).reduce((P,L)=>P+L,0):this._trnMainService.TrnMainObj.ProdList.filter(P=>P.MCODE==n&&P.RATE==O&&P.BATCH==_).map(P=>P.Quantity).reduce((P,L)=>P+L,0),I>0)return I>this._trnMainService.TrnMainObj.ProdList[y].STOCK&&9!=this._trnMainService.TrnMainObj.ProdList[y].PTYPE?(console.log("entered info"),this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[y].ITEMDESC} Entered  Quantity: ${I}  exceed the available stock ${this._trnMainService.TrnMainObj.ProdList[y].STOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[y].ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(n,T,p,O,y){if(0==n){let _=this._trnMainService.TrnMainObj.ProdList.filter(I=>I.MCODE==T&&I.RATE==p&&I.BATCH==O);if(_&&_?.length>1)return this.alertService.info(`Item:${_[0].ITEMDESC} duplicate rate:${_[0].RATE} is detected.`),void(this._trnMainService.TrnMainObj.ProdList[y].ALTERNATEQUANTIY=0)}}checkBatchWiseEnterStock(){let n=0;return this._trnMainService.TrnMainObj.ProdList.filter(T=>T.MCODE==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MCODE&&T.BATCH==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH&&T.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTUNIT).forEach(T=>n+=T.Quantity),this.totalQuantity=n,n>this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}quantityKeyPress(n,T,p,O){("Tab"==n.key||"Enter"==n.key)&&(n.preventDefault(),this.AlternateQuantityEventClick(p))}changeBatchWiseRate(n){(this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(n)>0&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].RATE=n,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].REPACKRATE=n,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PRATE=n,this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].CONFACTOR):n,this.setDefaultUnitwisRate(this.genericProductEntryService.activerowIndex))}assignBarcodeWiseMFGEXPDATE(n){1===this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].MFGDATE=null==n[0].MFGDATE?"":n[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].EXPDATE=null==n[0].EXPDATE?"":n[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BATCH=n[0].BATCH)}setDefaultUnitwisRate(n){null!=this._trnMainService.TrnMainObj.ProdList[n].Product.AlternateUnits.filter(p=>1==p.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[n].ALTRATE=this._trnMainService.TrnMainObj.ProdList[n].RATE*this._trnMainService.TrnMainObj.ProdList[n].ALTCONFACTOR)}}return b.\u0275fac=function(n){return new(n||b)(j.LFG(x.w),j.LFG(g.c),j.LFG(m.uw),j.LFG(v.gz),j.LFG(l.i))},b.\u0275prov=j.Yz7({token:b,factory:b.\u0275fac}),b})()},94534:(F,U,d)=>{d.d(U,{w:()=>l});var e=d(64537),t=d(42326),u=d(28698),s=d(60716),R=d(87584),M=d(53074),j=d(67311),x=d(60694),g=d(7976),m=d(48063),v=d(33612);let l=(()=>{class S{constructor(a,n,T,p,O,y,_){this._trnMainService=a,this.masterService=n,this.alertService=T,this.responseMsgService=p,this.arouter=O,this.productHelperService=y,this.focusService=_,this.gridPopupSettings=new u.im,this.onChangeProductionItem=new e.vpe,this.loadFromBarcode=!1,this.activeurlpath="",this.batchlist=[],this.barcodeDisplay=!1,this.showBarCodeDetail=!1,this.showStockedQuantityOnly=0,this.stringValue="",this.hoverId=null,this.codeHoverId=null,this.rateHoverId=null,this.showBatchWiseDetail=!1,this.showBatchPopup=!1,this.subHeader=[],this.subHeader2=[],this.headerAfterSubHeader=[],this.headerAfterSubHeader2=[],this.gridPopupSettingsForSupplier=new u.im,this.userSetting=a.userSetting,this.userProfile=a.userProfile,this.genericProductEntrySetting=new s.Vn(a),this._trnMainService.activeurlpath=O.snapshot?.url[0]?.path}checkBatchWiseRateSettingZero(){console.log("check batch wise rate for setting"),this.batchlist=[];let n="",T="";n=this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,T=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${n}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${T}&barcode=`).subscribe(p=>{"ok"===p.status&&(this.batchlist=p.result,"SHOWPRICEPOPUP"===p.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}assignValueForReturnModeInProd(a){console.log("ineditmode"),this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.RATE,console.log("prodRAte",a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a.MFGDATE?"":a.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a.EXPDATE?"":a.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=a.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=a.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=a.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=a.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=a.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=a.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=a.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=a.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=a.ALTCONFACTOR,console.log("RATE",this._trnMainService.TrnMainObj.ProdList,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE),this._trnMainService.ReCalculateBillWithNormal()}assignRateandQtyLoadFromSO(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE/this.userSetting.VatConRate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE/this.userSetting.VatConRate),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice?a.OPSTOCK:a.POSTOCK}assignOrderedDiscount(a){if(console.log("assign ordered discount",a),a?.DISCOUNT){let n=a.DISCOUNT?100*a.DISCOUNT/a.AMOUNT:0;console.log("totaldisc loaded",n),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=n}else this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=a.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE}ValidateDuplicateItemEntry(a){if(this._trnMainService.TrnMainObj.VoucherType in t.NA){let T;return T=this._trnMainService.TrnMainObj.ProdList.filter(p=>p.MENUCODE==a.MENUCODE),!(T.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(a=>{this.colorLists=a&&a.result?a.result:[]})}setPrefix(){let a="";return"self-billing"===this._trnMainService.activeurlpath?a="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(a=this._trnMainService.TrnMainObj.VoucherPrefix),a}setItemPopupUrl(){console.log("set item popup url1",this.userSetting.DefaultFilterIndex),this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.grpName,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showPQty,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showStockIssueQty,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showNetRate,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showRate,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showMRP,noSearch:!0},{key:"STOCK",title:this.genericProductEntrySetting.itemPopupUrlSetting.stockTitle,hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showStock,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showRequesitionQty,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showInCreditNote,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showPOStock,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showQTStock,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showSOStock,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showPOStock,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showSOStock,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:this.genericProductEntrySetting.itemPopupUrlSetting.showMRP,noSearch:!0,alignment:"right",pipe:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}setItemPopupUrl_old(){console.log("set item popup urlold",this.userSetting.DefaultFilterIndex);let a=!0,n=!0,T=!0,p=!0,O="STOCK",y=!0,_=!0,I=!0,P=!1,L=!0,w=!0,V=!0;this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn&&(n=!1),this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(a=!1,T=!1),(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote)&&(p=!1,O="SALES QTY",L=!1),this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(y=!1,P=!0),this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE&&(y=!1),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(_=!1),(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(V=!0,I=!1,P=!0):(V=!1,I=!0,P=!0)),this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(w=!1),this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:P,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:a,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:n,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:T,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:p,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:V,noSearch:!0},{key:"STOCK",title:O,hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:w,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:L,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:y,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:_,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:I,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:y,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:I,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:V,noSearch:!0,alignment:"right",pipe:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}displayProductDetailInViewMode(a){console.log("eventlog",a);var n=!1;return"VIEW"==this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&"F9"==a.code&&(n=!0),n}checkFlatDiscountEntered(){return this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)}setShowStockQuatityAndLoadBarcodewiseProduct(){this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE??""):this.showStockedQuantityOnly=0}checkSelfBilling(a){return!("self-billing"!==this._trnMainService.activeurlpath||(""==this._trnMainService.TrnMainObj.MWAREHOUSE?(this.alertService.warning("Please select an unsalable warehouse!"),this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,a("warehouseId")}),0):""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName?(this.alertService.warning("Please select an Account Name!"),0):""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS?(this.alertService.warning("Remarks is mandatory!"),this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,a("remarksid")}),0):(this.showStockedQuantityOnly=0,0)))}checkREFBILL(){if((this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!==this.userSetting.IMPORTPOBILLMODE||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&0!==this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER)&&!this._trnMainService.TrnMainObj.REFORDBILL){let a=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(a),!1}return null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL?(this.alertService.info("Please Load the ref bill for return"),!1):(this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList",this._trnMainService.TrnMainObj.VoucherType!=t.Km.Purchase||"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||0==this.userSetting.IMPORTPOBILLMODE||this._trnMainService.TrnMainObj.REFORDBILL?void 0:(this.alertService.warning("Please Load the Import PO Ref bill for return"),!1))}showPOQtyRate(a){this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this._trnMainService.TrnMainObj.ProdList[a].POSTOCK,this._trnMainService.purchaseOrderRate=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE,this._trnMainService.produstWiseOrderUnit=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT)}checkBatchWiseRate(){if(null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE)return this.alertService.warning("Please select a Product"),!1;this.batchlist=[];let a=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this._trnMainService.activeurlpath&&(a="SF");let n="";n=this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE;let T="";T=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this.userProfile.userWarehouse,this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry&&this.userSetting.LinkProductionwithconsumption&&(T=this._trnMainService.TrnMainObj.BILLTO);let p=encodeURIComponent(T);this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${n}&voucherPrefix=${a}&warehouse=${p}&barcode=`).subscribe(O=>{"ok"===O.status&&(this.batchlist=O.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchlist),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.ProductionEntry&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===O.message&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&(this.batchWiseStockTax(O.result),this.changeBatchWiseRate(O.result[0].RATE)),"replacerate"===O.message&&(this.changeBatchWiseRate(O.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(O.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=O.result[0].costprice),"SHOWPRICEPOPUP"===O.message&&(this.masterService.PlistTitle=this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry?"Consumption Batch Selection":"Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&this.changeBatchWiseRate(O.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"error"==O.status&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&(this.masterService.PlistTitle="Batch Selection")})}batchWiseStockTax(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.map(n=>n.STOCK).reduce((n,T)=>n+T,0))}changeBatchWiseRate(a){(this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(a)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):a,this.setDefaultUnitwisRate(this.activerowIndex))}assignBarcodeWiseMFGEXPDATE(a){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a[0].MFGDATE?"":a[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a[0].EXPDATE?"":a[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a[0].BATCH)}setDefaultUnitwisRate(a){null!=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.filter(T=>1==T.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR)}itemFromBC(a){return 1==a&&1==this.loadFromBarcode}focusByElementId(a){setTimeout(()=>{const n=document.getElementById(a);!n||(n.focus(),n.click())},20)}discRateEnterClicked(a,n,T){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales){let p=this.masterService.userProfile.roleRights.find(O=>"DISLIMIT"==O.right);console.log("disLimt on discount rate",p),p&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>p?.value&&(this.alertService.warning("Discount limit of :"+p.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(O=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+n)&&document.getElementById("discountAmt"+n).focus()},0)}))}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let p=this.masterService.userProfile.userRights.find(O=>"SODiscountLimit"==O.right);p&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>p?.value&&(this.alertService.warning("Discount limit for sales order ("+p.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(O=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+n)?document.getElementById("discountAmt"+n).focus():document.getElementById("remarks"+n).focus()},0)}))}return(this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)||2==this._trnMainService.userSetting.EnableBatch?this._trnMainService.TrnMainObj.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder?document.getElementById("REMARKS"+n)&&document.getElementById("REMARKS"+n).focus():this.checkValidation(n):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"purchase-import"==this.activeurlpath?document.getElementById("INDDISCOUNT"+n).focus():null!=document.getElementById("INDDISCOUNT"+n)&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?this.navigationUsingFocusService(n,"INDDISCOUNTRATE","productEntrySetting.tableId"):document.getElementById("INDDISCOUNT"+n).focus()):this._trnMainService.TrnMainObj.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("INDDISCOUNT"+n).focus():document.getElementById("MFGDATE"+n).focus()),!1}disRateChange(a,n,T){a.DISCOUNT=0,a.DISRATE<0?a.DISRATE=0:a.DISRATE>100&&(a.DISRATE=100),this._trnMainService.ReCalculateBillForAsset(this._trnMainService.TrnMainObj)}disRateEnter(a,n,T){setTimeout(()=>{a.DISRATE?(this._trnMainService.initializeAssetProdlist(),setTimeout(()=>{document.getElementById("ITEMDESC"+(this.activerowIndex+1))&&document.getElementById("ITEMDESC"+(this.activerowIndex+1)).focus()})):document.getElementById("DISCOUNT"+this.activerowIndex).focus()})}IndDiscountRateChangeEvent(a,n,T){this._trnMainService.calculateNetRATE(T),this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE=100),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountModelRateChange(a,n,T){return a>100?(this.alertService.info("Discount rate cannot be greater than 100%"),void(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE=0)):a<0?(this.alertService.info("Discount rate cannot be less than 0%"),void(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE=0)):void 0}focusNext(a){let n=a+1;1==this._trnMainService.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("BC"+n)?(console.log("rn1"),document.getElementById("BC"+n).focus()):document.getElementById("ITEMDESC"+n).focus()},50):setTimeout(()=>{null!=document.getElementById("ITEMDESC"+n)&&document.getElementById("ITEMDESC"+n).focus()},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("ITEMDESC"+n)&&document.getElementById("ITEMDESC"+n).focus()},50))}disAmountChange(a,n,T){a.DISRATE=0,a.DISCOUNT<0?a.DISCOUNT=0:a.DISCOUNT>a.AMOUNT&&(a.DISCOUNT=a.AMOUNT),this._trnMainService.initializeAssetProdlist(),setTimeout(()=>{document.getElementById("ITEMDESC"+(this.activerowIndex+1))&&document.getElementById("ITEMDESC"+(this.activerowIndex+1)).focus()}),this._trnMainService.ReCalculateBillForAsset(this._trnMainService.TrnMainObj)}checkDiscountAmountGreaterThanGrossAmount(a){return this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[a].GROSSAMNT&&(this.alertService.warning("Discount amount cannot be greater than gross amount"),!0)}IndDiscountAmountChangeEvent(a,n,T,p){if(null!=this._trnMainService.TrnMainObj.ProdList[T].MCODE){if(!this.checkDiscountAmountGreaterThanGrossAmount(T)){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales){let O=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),y=this.masterService.userProfile.roleRights.find(_=>"DISLIMIT"==_.right);console.log("dis rate",O,"dislimit",y),y&&O>y?.value&&(this.alertService.warning("Discount limit of :"+y.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(_=>{setTimeout(()=>{null!==document.getElementById("INDDISCOUNT"+T)&&document.getElementById("INDDISCOUNT"+T).focus()},0)}))}if((this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[T].UNIT==this._trnMainService.TrnMainObj.ProdList[T].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[T].NETRATE=this._trnMainService.TrnMainObj.ProdList[T].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[T].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[T].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[T].CRATE=this._trnMainService.TrnMainObj.ProdList[T].NETRATE):(this._trnMainService.TrnMainObj.ProdList[T].NETRATE=this._trnMainService.TrnMainObj.ProdList[T].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[T].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[T].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[T].Quantity),this._trnMainService.TrnMainObj.ProdList[T].CRATE=this._trnMainService.TrnMainObj.ProdList[T].NETRATE)),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let O=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),y=this.masterService.userProfile.userRights.find(_=>"SODiscountLimit"==_.right);console.log(" so dis rate",O,"dislimit",y),y&&O>y?.value&&(this.alertService.warning("Discount limit of :"+y.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(_=>{setTimeout(()=>{null!==document.getElementById("INDDISCOUNT"+T)&&document.getElementById("INDDISCOUNT"+T).focus()},0)}))}this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT<0&&(this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT=0),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}}else this._trnMainService.TrnMainObj.ProdList[T].INDDISCOUNT=0}discEnterClicked(a,n,T,p){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOFULLRETURN){if(this._trnMainService.TrnMainObj.ProdList[n].INDDISCOUNTRATE>0&&(this._trnMainService.TrnMainObj.ProdList[n].INDDISCOUNTRATE=0),this.checkDiscountAmountGreaterThanGrossAmount(n))return;0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(n)):document.getElementById("MFGDATE"+n).focus()}else this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?("Tab"==p.key&&p.preventDefault(),this.checkValidation(n),this.navigationUsingFocusService(n,"INDDISCOUNT","productEntrySetting.tableId")):this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice?1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(n):this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan?this.checkValidation(n):this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder?document.getElementById("REMARKS"+n).focus():this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?this.checkValidation(n):document.getElementById("MFGDATE"+n).focus();return!1}QuantityEnterClicked(a,n,T){(this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry)&&this.checkValidation(n)}checkValidation(a){console.log("hello validations");var n=this._trnMainService.TrnMainObj.ProdList[a];if(null!=n){if(null==n.MCODE)return this._trnMainService.TrnMainObj.ProdList.splice(a,0),this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&0==n.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${n.ITEMDESC} (${n.MENUCODE}) Please Check Your Entry.`),!1;if("Non-Discountable"==this._trnMainService.TrnMainObj.ProdList[a].DISMODE&&this._trnMainService.TrnMainObj.VoucherType in t.Sl)return this.alertService.warning("Selected Item is not discountable."),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0,!1}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&"self-billing"!=this.activeurlpath){if(2==this.userSetting.EnableBatch)var T=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(y){return[y.MCODE,y.RATE,y.BC,y.BATCH,y.CRATE]});else T=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(_){return[_.MCODE,_.RATE,_.BC,_.BATCH]});for(const y of T)if(y.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry){let y=this._trnMainService.TrnMainObj.ProdList.filter(_=>1==_.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(_.EXPDATE))[0];if(null!=y&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${y.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+a).focus(),!1;if((this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[a].Quantity>this._trnMainService.TrnMainObj.ProdList[a].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[a].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this._trnMainService.TrnMainObj.ProdList[a].PTYPE<10)return this.alertService.error("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():(this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote());let p=a+1;const O=document.getElementById("ITEMDESC"+p);!this._trnMainService.TrnMainObj.ProdList.some(y=>null==y.MCODE)&&(!O||""===O.value.trim())&&(console.log("reachsales order"),!1===this._trnMainService.addRow())||(1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("BC"+p)?(console.log("rn1"),document.getElementById("BC"+p).focus()):document.getElementById("ITEMDESC"+p).focus()},50):setTimeout(()=>{null!=document.getElementById("ITEMDESC"+p)&&document.getElementById("ITEMDESC"+p).focus()},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("ITEMDESC"+p)&&document.getElementById("ITEMDESC"+p).focus()},50)))}onHoverRate(a){this.rateHoverId=a,this.stringValue=this.productHelperService.hoverRate(a,this._trnMainService.TrnMainObj.ProdList[a])}onHover(a){this.hoverId=a,this._trnMainService.TrnMainObj.ProdList[a].TotalDiscountDescription=this.productHelperService.hoverDiscount(a,this._trnMainService.TrnMainObj.ProdList[a]),this.stringValue=this.productHelperService.hoverDiscount(a,this._trnMainService.TrnMainObj.ProdList[a])}onHoverCode(a){this.codeHoverId=a;let n=this._trnMainService.TrnMainObj.ProdList[a];console.log("prodlist ma k aaucha",this._trnMainService.TrnMainObj.ProdList[a]),n.TotalDiscountDescription=this.productHelperService.hoverCode(a,this._trnMainService.TrnMainObj.ProdList[a]),this.stringValue=this.productHelperService.hoverCode(a,this._trnMainService.TrnMainObj.ProdList[a])}getPreviousBatchList(){this.checkBatchWiseRate()}BatchEnter(a,n,T,p){let O=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=a.LANDINGCOST,2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&O in t.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||this.checkBatchWiseRate(),null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){this.batchlist=[];let _=this._trnMainService.TrnMainObj.ProdList[T].MCODE,I=this.masterService.userProfile.userWarehouse;_&&this.masterService.getItemWiseBatch(_,I).subscribe(P=>{"ok"==P.status&&(this.batchlist=P.result.filter(L=>L.STOCK>0),this.batchlist?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}this.showBatchWiseDetail=!0;let y={isFocusAchieved:!1};return this.focusService.autoFocus(T,document.getElementById("BATCH"+T),y,"productEntrySetting.tableId"),y.isFocusAchieved||this.checkValidation(T),!1}onKeyDownBatch(a,n){this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||"Enter"===a.key||"Tab"===a.key||a.preventDefault()}expDateEnterEvent(a,n,T){return this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction||this.checkValidation(n)||this.masterService.focusAnyControl("REMARKS"+n),!1}CommentEnterEvent(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry&&this.checkValidation(a)}MFGDateEnterEvent(a,n,T){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}RecalculateMRP(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP}onTabMRP(a,n){a.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+n).focus()}RecalculateSPRICE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE}onTabSPRICE(a,n){a.preventDefault(),null!=document.getElementById("VSRATE"+this.activerowIndex)?document.getElementById("VSRATE"+this.activerowIndex).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(n):document.getElementById("mfgdate"+n).focus()}RecalculateVSRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT=1)?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE}onTabVSRATE(a){a.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE}onTabVPRATE(a,n){a.preventDefault(),this.RecalculateSPRICE(),0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(n):document.getElementById("mfgdate"+n).focus()}isReadOnly(a,n){return this._trnMainService.TrnMainObj.VoucherType!==t.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.Sales&&57!=this._trnMainService.TrnMainObj.VoucherType&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DeliveryChalan?(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===n?.DISMODE||void 0}NonProductPopupSelectEvent(a=new Function){a(),this.genericGrid.show()}useFulLifeEnter(a,n,T){this._trnMainService.initializeAssetProdlist(),setTimeout(()=>{document.getElementById("ITEMDESC"+(this.activerowIndex+1))&&document.getElementById("ITEMDESC"+(this.activerowIndex+1)).focus()})}isVatableInRow(a,n,T,p){this._trnMainService.TrnMainObj.ProdList[T].ISVAT=a.target.checked?1:0,this._trnMainService.ReCalculateBillWithNormal()}CommentEnterEventBranchIn(a){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferIn){this.checkValidation(a);let n=a+1;setTimeout(()=>{null!=document.getElementById("OPQTY"+n)&&document.getElementById("OPQTY"+n).focus()},50)}}getDuplicates(){let a=new Set,n=[];for(let T of this._trnMainService.TrnMainObj.ProdList){let p=T.ITEMDESC;a.has(p)?n.push(T):a.add(p)}return n}EXPDATEEnterClicked(a,n,T){let p=n+1;console.log("grn navigation gets here.....",p,this._trnMainService.TrnMainObj.DOFULLRETURN,document.getElementById("BC"+p)),(1!=this._trnMainService.TrnMainObj.DOFULLRETURN||!this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("PO"))&&null==document.getElementById("BC"+p)&&this._trnMainService.addRow(),setTimeout(()=>{this.focusNext(n)},10)}navigationUsingFocusService(a,n,T){let p=a+1;document.getElementById("ITEMDESC"+p);let y={isFocusAchieved:!1};this.focusService.autoFocus(a,document.getElementById(n+a),y,T),y.isFocusAchieved||this.focusService.autoFocus(p,document.getElementById("BC"+p),{},T)}}return S.\u0275fac=function(a){return new(a||S)(e.LFG(R.p),e.LFG(M.P),e.LFG(j.c),e.LFG(x.T),e.LFG(g.gz),e.LFG(m.h),e.LFG(v.i))},S.\u0275prov=e.Yz7({token:S,factory:S.\u0275fac}),S})()},54471:(F,U,d)=>{d.d(U,{o:()=>D});var e=d(8239),t=d(92340),u=d(42326),s=d(28698),R=d(38011),M=d(64537),j=d(53074),x=d(87584),g=d(67311),m=d(7976),v=d(67297),l=d(14970),S=d(48063),b=d(88692),a=d(20092),n=d(37051);const T=["multiselectGenericGrid"],p=["genericGrid"],O=["genericGridForSupplier"],y=["genericGridForBarcodeWiseProduct"];function _(E,C){if(1&E){const i=M.EpF();M.TgZ(0,"input",19),M.NdJ("ngModelChange",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h._trnMainService.barCodes.DESCA=r)}),M.qZA()}if(2&E){const i=M.oxw();M.Q6J("disabled",i.disableBarcode())("ngModel",i._trnMainService.barCodes.DESCA)}}function I(E,C){if(1&E){const i=M.EpF();M.TgZ(0,"input",20),M.NdJ("ngModelChange",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h._trnMainService.barCodes.DESCA=r)})("keydown.enter",function(){M.CHM(i);const r=M.oxw();return M.KtG(r.descEnter())})("keypress",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.keyPress(r))}),M.qZA()}if(2&E){const i=M.oxw();M.Q6J("ngModel",i._trnMainService.barCodes.DESCA)("disabled",i.disableBarcode())}}const P=function(){return{color:"green"}},L=function(){return{color:"red"}};function w(E,C){if(1&E&&(M.TgZ(0,"div",1)(1,"label",21),M._uU(2,"Stock: \xa0"),M.TgZ(3,"span",22),M._uU(4),M.qZA()()()),2&E){const i=M.oxw();M.xp6(3),M.Q6J("ngStyle",i.productHelperService.barcodeEnterStock>0?M.DdM(2,P):M.DdM(3,L)),M.xp6(1),M.Oqu(i.productHelperService.barcodeEnterStock)}}function V(E,C){if(1&E){const i=M.EpF();M.TgZ(0,"div",1)(1,"fieldset",23)(2,"legend",24)(3,"input",25),M.NdJ("ngModelChange",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.enableSupplierSelect=r)})("change",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.enableSupplierSelect=r.target.checked?1:0)})("ngModelChange",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.onChangeEvent(r))}),M.qZA(),M._uU(4,"Supplier Wise Filter"),M.qZA(),M.TgZ(5,"div",1)(6,"label",26),M._uU(7,"Supplier Name:"),M.qZA(),M.TgZ(8,"div",27)(9,"input",28),M.NdJ("keydown.Enter",function(){M.CHM(i);const r=M.oxw();return M.KtG(r.onSupplierEnter())})("keyup",function(){M.CHM(i);const r=M.oxw();return M.KtG(r.onSupplierEnter())})("keypress",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.keyPress(r))})("ngModelChange",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h._trnMainService.TrnMainObj.BILLTO=r)}),M.qZA()()()()()}if(2&E){const i=M.oxw();M.xp6(3),M.Q6J("ngModel",i.enableSupplierSelect)("checked",1==i.enableSupplierSelect)("disabled","VIEW"==i.tranMode),M.xp6(6),M.Q6J("disabled","VIEW"==i.tranMode||0==i.enableSupplierSelect)("ngModel",i._trnMainService.TrnMainObj.BILLTO)}}function N(E,C){if(1&E){const i=M.EpF();M.TgZ(0,"div",29)(1,"PBatchList",30),M.NdJ("dbClickEvent",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.dblClickPopupBatch(r))})("BatchClosedClick",function(){M.CHM(i);const r=M.oxw();return M.KtG(r.model1Closed())})("returnBatchValue",function(r){M.CHM(i);const h=M.oxw();return M.KtG(h.returnBatch(r))}),M.qZA()()}if(2&E){const i=M.oxw();M.xp6(1),M.Q6J("AlternateUnits",i.AlternateUnits)("activerowIndex",i.activerowIndex)("title",i.PlistTitle)("BList",i.batchlist)("voucherType",i._trnMainService.TrnMainObj.VoucherType)("activeurlpath",i.activeurlpath)}}let D=(()=>{class E{constructor(i,c,r,h,o,f,A){this.masterService=i,this._trnMainService=c,this.alertService=r,this.arouter=h,this.authservice=o,this.spinnerService=f,this.productHelperService=A,this.activerowIndex=0,this.productWiseBarCode=[],this.loadFromBarcode=!1,this.showStockedQuantityOnly=0,this.barcodeDisplay=!1,this.TrnMainObj={},this.batchlist=[],this.PlistTitle="",this.loadDescriptionWiseProduct=!1,this.enableSupplierSelect=0,this.multiselectPopupSettings=new R.oe,this.gridPopupSettings=new s.im,this.genericGridForSupplierSetting=new s.im,this.genericGridForBarcodeWiseProductSetting=new s.im,this.Snos=0,this.userSetting=this.authservice.getSetting(),this.activeurlpath=h.snapshot.url[0]?.path,this.genericGridForBarcodeWiseProductSetting={title:"BARCODE WISE PRODUCTS",apiEndpoints:"",defaultFilterIndex:1,columns:[{key:"MENUCODE",title:"Item Code",hidden:!1,noSearch:!1},{key:"DESCA",title:"Item Name",hidden:!1,noSearch:!1},{key:"DESCB",title:"Description",hidden:!1,noSearch:!1},{key:"BARCODE",title:"Barcode",hidden:!1,noSearch:!0},{key:"MRP",title:"MRP",hidden:!1,noSearch:!0}]}}ngOnInit(){this._trnMainService.barCodes.BC="",this._trnMainService.barCodes.DESCA="",this.productHelperService.barcodeEnterStock=null}disableBarcode(){return!!("VIEW"==this._trnMainService.TrnMainObj.Mode||this._trnMainService.disableOnPerFormaSelect||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&"purchase-import"==this.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this.userSetting.ENABLE_GRN_IN_PI&&"goods-received-note"==this.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&"add-debitnote-itembase"==this.activeurlpath&&"1"==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&!this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType==u.Km.DeliveryReturn&&(!this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.REFBILL&&1==this._trnMainService.TrnMainObj.DOFULLRETURN)||"add-purchase-invoice"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_GRN_IN_PI)&&0==this.userSetting.DisablePOReferenceRequired||1==this.userSetting.ENABLE_GRN_IN_PI&&this._trnMainService.TrnMainObj.REFORDBILL||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!=this.userSetting.PODELIVERYMODE&&0==this.userSetting.ENABLE_GRN_IN_PI&&this._trnMainService.TrnMainObj.REFORDBILL)||(this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales)&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.TrnMainObj.LOADFULLFROMQT||this._trnMainService.TrnMainObj.VoucherType===u.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||(this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue&&"FROMREQUESITION"==this._trnMainService.TrnMainObj.tag)&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF)||(null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE?!((0==this._trnMainService.TrnMainObj.DOFULLRETURN||0==this._trnMainService.TrnMainObj.LOADFULLFROMQT)&&(this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.REFORDBILL)):void 0)}barcodeQuantityClick(i){if(this.loadDescriptionWiseProduct){let c=this._trnMainService.TrnMainObj.ProdList.findIndex(r=>r.ITEMDESC==this._trnMainService.barCodes.DESCA);if(0==this.userSetting.OneToOneBarcodeMode&&(this._trnMainService.TrnMainObj.VoucherType==u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut)&&this._trnMainService.barCodes.Quantity>this._trnMainService.TrnMainObj.ProdList[c].TOTSTOCK)return void this.alertService.info("Quantity exceed the avilable stock");this._trnMainService.TrnMainObj.ProdList[c].ALTERNATEQUANTIY=this._trnMainService.barCodes.Quantity,this._trnMainService.ReCalculateBillWithNormal()}else{let c=this._trnMainService.TrnMainObj.ProdList.findIndex(r=>r.BC==this._trnMainService.barCodes.BC&&0==r.FulfillBatchQty);if(1==this._trnMainService.TrnMainObj.ProdList[c].NATURETYPE&&1!=this._trnMainService.barCodes.Quantity&&(this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote))return this.alertService.info("The entered item cannot have duplicate barcodes!"),void(this._trnMainService.barCodes.Quantity=1);if(1==this.userSetting.ENABLESINGLEBATCHMODE){let r=this.getTotalQty(this._trnMainService.TrnMainObj.ProdList.filter(o=>o.BC==this._trnMainService.barCodes.BC)[0].MCODE,!0),h=this._trnMainService.TrnMainObj.ProdList.findIndex(o=>o.BC==this._trnMainService.barCodes.BC);this._trnMainService.TrnMainObj.ProdList[h].IsAuthorizeForNegative||this._trnMainService.allowNegativeBilling(h,!1,!1,!0,r),this.addQuantityInExistingRow(c,this._trnMainService.barCodes.Quantity,!0)}else if(this.checkGridEnteredQty(this._trnMainService.barCodes.Quantity,this._trnMainService.barCodes.BC,!1,0,!0)){if(this._trnMainService.TrnMainObj.VoucherType!=u.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.ManualstockEntry&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.RequisitionEntry&&!this.checkMcodeWiseStock(this._trnMainService.TrnMainObj.ProdList.filter(r=>r.BC==this._trnMainService.barCodes.BC)[0].MCODE,!0))return console.log("reach202"),void this.alertService.info("Quantity exceed the avilable stock");this.addQuantityInExistingRow(c,this._trnMainService.barCodes.Quantity,!0)}}}myFunction(){}ItemBarCodeClick(i){if(0==this.userSetting.OneToOneBarcodeMode&&this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&!this._trnMainService.TrnMainObj.REFBILL&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)return void this.alertService.info("Please Load the ref bill for return");if(0==this.userSetting.DisablePOReferenceRequired&&0!=this.userSetting.PODELIVERYMODE&&!this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType==u.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==u.Km.Purchase))return void this.alertService.info("Please Load the ref bill for return");let c=this._trnMainService.TrnMainObj.ProdList?.findIndex(h=>h.BC==this._trnMainService.barCodes.BC&&!h.FulfillBatchQty);i.preventDefault(),document.getElementById("barcodeField").select(),this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),("self-billing"!=this.activeurlpath||this.validationInSelfBilling())&&this._trnMainService.checkBarcode(this._trnMainService.barCodes.BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(h=>{if("ok"==h.status)if(this.checkItemInGrid()){if(1!=this._trnMainService.TrnMainObj.ProdList[c]?.NATURETYPE||this._trnMainService.TrnMainObj.VoucherType!==u.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!==u.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==u.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!==u.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==u.Km.SalesOrder){if((this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote)&&!this.checkGridEnteredQty(1,this._trnMainService.barCodes.BC)||this._trnMainService.TrnMainObj.REFBILL&&(console.log("khai ?"),(this._trnMainService.TrnMainObj.VoucherType===u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===u.Km.DeliveryReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&!this.checkGridEnteredQty(1,this._trnMainService.barCodes.BC)))return;if(0==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.VoucherType==u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==u.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockSettlement)&&!this.checkMcodeWiseStock(this._trnMainService.TrnMainObj.ProdList.filter(o=>o.BC==this._trnMainService.barCodes.BC)[0].MCODE,!0))return void this.alertService.info("Quantity exceed the avilable stock");if(1==this.userSetting.ENABLESINGLEBATCHMODE){let o=this.getTotalQty(this._trnMainService.TrnMainObj.ProdList.filter(A=>A.BC==this._trnMainService.barCodes.BC)[0].MCODE,!0),f=this._trnMainService.TrnMainObj.ProdList.findIndex(A=>A.BC==this._trnMainService.barCodes.BC);this._trnMainService.TrnMainObj.ProdList[f].IsAuthorizeForNegative||this._trnMainService.allowNegativeBilling(f,!1,!1,!0,o)}console.log("reachhere",c),this.addQuantityInExistingRow(c,1)}else if(this._trnMainService.TrnMainObj.ProdList.find(f=>f.BC==this._trnMainService.barCodes.BC).ALTERNATEQUANTIY>0)return void this.alertService.error("Item has already been loaded!!")}else this.loadBarcodeWiseProductList();else this.alertService.info(h.result)})}getBarcodeScanEndPoint(){const i=encodeURIComponent("wholesale");let c="",r=this._trnMainService.TrnMainObj.MWAREHOUSE;r||(r=this._trnMainService.userProfile.userWarehouse),this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue&&(r=this._trnMainService.TrnMainObj.BILLTO);let h=encodeURIComponent(this._trnMainService.barCodes.BC);c=`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${h}&warehouse=${r}`;var o=`&RefBill=${encodeURIComponent(this._trnMainService.TrnMainObj.REFBILL)}`,f=this._trnMainService.TrnMainObj;return"add-sales-invoice-wholesale"==this.activeurlpath&&(c=`${c}&tag=${i}`),f.VoucherType==u.Km.CreditNote&&0==f.DOFULLRETURN&&0==f.DOMANUALSALESRETURN?c+=`${o}`:f.VoucherType==u.Km.CreditNote&&1==f.DOMANUALSALESRETURN?c+=`${o}&DomanualSalesReturn=${f.DOMANUALSALESRETURN}`:f.VoucherType==u.Km.DeliveryReturn?c+=`${o}`:f.VoucherType==u.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&f.REFBILL&&0==f.DOFULLRETURN?c+=`${o}&DomanualPurchaseReturn=1`:("add-sales-invoice"==this.activeurlpath&&f.REFORDBILL&&0==f.LOADFULLFROMQT&&0!=this.userSetting.ENABLE_SOINTI||f.VoucherType==u.Km.GoodsReceived&&f.REFORDBILL&&0==f.DOFULLRETURN&&0!=this.userSetting.PODELIVERYMODE||"add-purchase-invoice"==this.activeurlpath&&f.REFORDBILL&&0==f.DOFULLRETURN&&0!=this.userSetting.PODELIVERYMODE||f.VoucherType==u.Km.SalesOrder&&f.REFORDBILL&&0==f.DOFULLRETURN&&0!=this.userSetting.ENABLE_QUOTATTION_INSO)&&(c+=`&RefBill=${f.REFORDBILL}`),c}loadBarcodeWiseProductList(i=0){this.loadFromBarcode=!1;let c=[],r=this.getBarcodeScanEndPoint();this.masterService.masterGetmethod(r).subscribe(h=>{if(console.log("here here",r),"ok"===h.status){if(c=h.result.data,(this._trnMainService.TrnMainObj.VoucherType==u.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut)&&0==this.userSetting.OneToOneBarcodeMode&&c.length>1){let f=this._trnMainService.TrnMainObj.MWAREHOUSE;f||(f=this._trnMainService.userProfile.userWarehouse),this._trnMainService.TrnMainObj.VoucherType!=u.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.CreditNote||!this._trnMainService.TrnMainObj.REFBILL||encodeURIComponent(this._trnMainService.TrnMainObj.REFBILL);let k=this._trnMainService.TrnMainObj.VoucherPrefix;encodeURIComponent(this._trnMainService.barCodes.BC),r=`/getMenuitemBarCodeWise/${this.showStockedQuantityOnly}/${k}`,this.genericGridForBarcodeWiseProductSetting.apiEndpoints=r,this.genericGridForBarcodeWiseProduct.show()}if(1===c.length){this.loadFromBarcode=!0;var o=c[0];this.itemInfo=o,this.currentProdObj=c[0],this._trnMainService.barCodes.DESCA=o.DESCA,this.productHelperService.barcodeEnterStock=o.STOCK,o.existingBarcode=!1;const f=this._trnMainService.TrnMainObj.ProdList.filter(A=>0==A.PTYPE&&0==A.HASVARIANT)?.find(A=>A.MCODE==c[0].MCODE);if(f&&(f.BC=this._trnMainService.barCodes.BC,f.FulfillBatchQty=!1,o.existingBarcode=!0,this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&1!=this.userSetting.ENABLESINGLEBATCHMODE&&!this.checkGridEnteredQty(1,this._trnMainService.barCodes.BC)))return;if((this._trnMainService.TrnMainObj.VoucherType===u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===u.Km.DeliveryReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFBILL)&&(this.productHelperService.barcodeEnterStock=o.Quantity),this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockSettlement){if(0==this.userSetting.OneToOneBarcodeMode&&this._trnMainService.TrnMainObj.VoucherType===u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)return void this.majorMethods(o);if(1==this.userSetting.ENABLEBARCODEWISEBATCH&&o?.BATCH)return void this.getItemDetails(o);0==this.userSetting.ENABLESINGLEBATCHMODE&&1!=o.NATURETYPE&&this.checkBatchWiseRate(o),(1==this.userSetting.ENABLESINGLEBATCHMODE||1==o.NATURETYPE)&&this.getItemDetails(o)}else if(this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===u.Km.PerformaSalesInvoice){if(1==this.userSetting.ENABLEBARCODEWISEBATCH&&o?.BATCH)return void this.getItemDetails(o);this.majorMethods(o)}else this.checkIfItemExistOrNot(o).then(k=>{k||(this.addNewRowInGrid(o),this._trnMainService.TrnMainObj.VoucherType===u.Km.SalesOrder&&this.getContractPriceandOtherDiscount())})}}})}majorMethods(i,c=!1){1===i.HASBATCH&&1===this.userSetting.EnableItemWiseBatch&&this.checkBatchWiseRate(i),(0===this.userSetting.EnableBatchWisePrice||1===this.userSetting.EnableItemWiseBatch&&0===i.HASBATCH)&&0===this.userSetting.ENABLESINGLEBATCHMODE&&this.getItemDetails(i,c),0==this.userSetting.ENABLESINGLEBATCHMODE&&1===this.userSetting.EnableBatchWisePrice&&0===this.userSetting.EnableItemWiseBatch&&this.checkBatchWiseRate(i,c),1==this.userSetting.ENABLESINGLEBATCHMODE&&this.getItemDetails(i)}checkItemInGrid(){return(this._trnMainService.TrnMainObj.VoucherType!=u.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!=u.Km.BranchTransferOut||0!=this.userSetting.OneToOneBarcodeMode||"EDIT"!=this._trnMainService.TrnMainObj.Mode||!this._trnMainService.TrnMainObj.ProdList.find(i=>i.BC==this._trnMainService.barCodes.BC&&null==i.hasSameBarcode))&&!!this._trnMainService.TrnMainObj.ProdList.find(i=>i.BC==this._trnMainService.barCodes.BC&&!i.hasSameBarcode)}checkIfItemExistOrNot(i){var c=this;return(0,e.Z)(function*(){if(c._trnMainService.TrnMainObj.ProdList.find(r=>r.BC==c._trnMainService.barCodes.BC)){if(c._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice){let r=c._trnMainService.TrnMainObj.ProdList.findIndex(o=>o.BC==c._trnMainService.barCodes.BC&&0==o.FulfillBatchQty);c._trnMainService.nullToZeroConverter(c._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY)+c._trnMainService.nullToZeroConverter(c._trnMainService.barCodes.Quantity)>c._trnMainService.TrnMainObj.ProdList[r].STOCK&&(console.log("reach down"),c._trnMainService.TrnMainObj.ProdList[r].FulfillBatchQty=!0,document.getElementById("barcodeField").blur(),0==i.HASVARIANT&&c.checkBatchWiseRate(i))}return!0}return!1})()}addQuantityInExistingRow(i,c,r=!1){if(i>=0){if(r)return this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY=this._trnMainService.nullToZeroConverter(c),console.log(this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY),this._trnMainService.barCodes.Quantity=this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY,this.productHelperService.barcodeEnterStock=this._trnMainService.TrnMainObj.ProdList[i].STOCK,this._trnMainService.barCodes.DESCA=this._trnMainService.TrnMainObj.ProdList[i].ITEMDESC,void this._trnMainService.ReCalculateBillWithNormal();this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY)+this._trnMainService.nullToZeroConverter(c),this._trnMainService.barCodes.Quantity=this._trnMainService.TrnMainObj.ProdList[i].ALTERNATEQUANTIY,this.productHelperService.barcodeEnterStock=this._trnMainService.TrnMainObj.ProdList[i].STOCK,this._trnMainService.barCodes.DESCA=this._trnMainService.TrnMainObj.ProdList[i].ITEMDESC,this._trnMainService.ReCalculateBillWithNormal()}}addNewRowInGrid(i){document.getElementById("barcodeField").blur(),this.addRow(i,null)}ItemBarCodeTabEnter(){document.getElementById("quantityBarcode").focus()}ItemQuantityTabEnter(){document.getElementById("barcodeField").focus()}ItemBarcodeInsert(){document.getElementById("quantityBarcode").focus()}addRow(i,c,r=!1,h=!1){this._trnMainService.barCodes.Quantity=1;let o={};if(o.Sn=this.Snos+=1,o.inputMode=!0,o.MENUCODE=i.MENUCODE,o.ITEMDESC=i.DESCA,o.ALTRATE=r?c.RATE:this.getVoucherWiseRateForBarcode(i),o.BASERATE=r?c.RATE:this.getVoucherWiseRateForBarcode(i),o.RATE=r?c.RATE:this.getVoucherWiseRateForBarcode(i),o.SELLRATEBEFORETAX=r?c?.SELLRATEBEFORETAX:i.RATE,o.MCODE=i.MCODE,o.ISVAT=i.ISVAT,o.UNIT=i.BASEUNIT,o.BASEUNIT=i.BASEUNIT,o.ALTUNIT=i.BASEUNIT,o.MRP=i.MRP,o.SPRICE=i.MRP/this.userSetting.VatConRate,o.MFGDATE=r?c.MFGDATE?.toString().substring(0,10):i.MFGDATE?.toString().substring(0,10),o.EXPDATE=r?c.EXPDATE?.toString().substring(0,10):i.EXPDATE?.toString().substring(0,10),o.BATCH=r?c.BATCH:i?.BATCH,o.NCRATE=null,o.ECSRATE=i.ECSRATE,o.AMOUNT=null,o.INDDISCOUNTRATE=i?.INDDISCOUNTRATE,o.INDDISCOUNT=i?.INDDISCOUNT,o.CRATE=i?.CRATE,o.DISCOUNT=null,o.VAT=null,o.NETAMOUNT=null,o.ITEMTYPE=null,o.RECEIVEDTYPE=null,o.WAREHOUSE=null,o.BC=i.BARCODE,o.ALTERNATEQUANTIY=this._trnMainService.barCodes.Quantity,o.PRATE=r?c.costprice:i.costprice,o.STOCK=r?c.STOCK:i.STOCK,o.TOTSTOCK=this.salesreturnInLiteMode()?i.Quantity:i?.STOCK,o.FulfillBatchQty=!1,o.HASVARIANT=i.HASVARIANT,o.HASECSRATE=i.HASECSRATE,o.HASECSCHARGE=i.HASECSCHARGE,o.HasMulitplePrice=r?1:0,o.REQEXPDATE=i.REQEXPDATE,o.PTYPE=i.PTYPE,o.NATURETYPE=i.NATURETYPE,o.IsAuthorizeForNegative=!1,o.DISMODE=i.DISMODE,o.ISUNKNOWN=i.ISUNKNOWN,o.SUPPNAME=i.SUPPNAME,o.WARRANTY=i.WARRANTY,o.MINLEVEL=i.MINLEVEL,o.hasSameBarcode=h,this._trnMainService.TrnMainObj.VoucherType==u.Km.ManualstockEntry&&(o.WAREHOUSE=this._trnMainService.TrnMainObj.MWAREHOUSE),1==this.userSetting.ENABLEBARCODEWISEBATCH&&i?.BATCH&&(o.BATCH=i.BATCH),r&&(o.PriceSelected=!0),i.HASVARIANT&&1==i.HASVARIANT&&"requisition-log"!=this.activeurlpath){o.VARIANTDESCA="";var f=JSON.parse(i.barcodeDetails);for(var A in o.VARIANTLIST=f,f)o.VARIANTDESCA+=`<b>${A}</b>:${f[A]} &nbsp;`}if(this._trnMainService.TrnMainObj.ProdList[0].BC||this._trnMainService.TrnMainObj.ProdList[0].MCODE){if(this._trnMainService.TrnMainObj.ProdList.push(o),!this.checkMcodeWiseStock(o.MCODE))return console.log("reach"),void this.alertService.info("Quantity exceed the avilable stock")}else this._trnMainService.TrnMainObj.ProdList[0]=o;let k=0;k=this._trnMainService.TrnMainObj.ProdList.length-1,this.activerowIndex=k,this._trnMainService.getAllUnitsOfItem(k,i.ALTUNIT),this.getSchemeDiscountForItem(o),this.loadDescriptionWiseProduct?document.getElementById("barcodeDesc")?.focus():document.getElementById("barcodeField")?.focus(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.allowNegativeBilling(k,!1,!1)}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}getVoucherWiseRateForBarcode(i){return this._trnMainService.TrnMainObj.VoucherType===u.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===u.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===u.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===u.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===u.Km.GoodsReceived||"self-billing"===this.activeurlpath?i.PRATE:"add-sales-invoice-wholesale"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==u.Km.PerformaSalesInvoice&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate?i.RATE_B:this._trnMainService.TrnMainObj.VoucherType===u.Km.SalesOrder&&0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?i.IN_RATE:this._trnMainService.TrnMainObj.VoucherType===u.Km.SalesOrder&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate?i.RATE_B:i.RATE}checkBatchWiseRate(i,c=!1){this.batchlist=[];let r="";this.PlistTitle="";let h=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this.activeurlpath&&(h="SF"),r=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse;let f=this.debitNoteEndPointReturnMode(i,r,h,this._trnMainService.TrnMainObj.REFBILL);this.masterService.masterGetmethod(f).subscribe(A=>{if("ok"===A.status){if(this.batchlist=A.result,console.log("activerow1",this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]?.REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.PlistTitle="Batch Selection"),"replacerate"===A.message){if(this.getItemDetails(i,c),this._trnMainService.TrnMainObj.VoucherType===u.Km.Repack&&this.batchWiseStockTax(A.result[0].STOCK),this.assignBarcodeWiseMFGEXPDATE(A.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=A.result[0].costprice,(this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote)&&!this.checkGridEnteredQty(0,this._trnMainService.barCodes.BC))return;this.changeBatchWiseRate(A.result[0].RATE)}"SHOWPRICEPOPUP"===A.message&&(this.PlistTitle="Batch Price Selection",document.getElementById("barcodeField").blur(),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===u.Km.Repack&&this.changeBatchWiseRate(A.result[0].RATE)),this._trnMainService.TrnMainObj.REFBILL&&(this._trnMainService.TrnMainObj.VoucherType===u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===u.Km.DeliveryReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&(this.assingBatchInReturnMode(A.result[0].BATCH),this.batchWiseStockTax(A.result[0].STOCK),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK=A.result[0].STOCK),this._trnMainService.vatFreeBill(),(this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut)&&this.altrateChangeForReplaceRate(A,i),this._trnMainService.ReCalculateBillWithNormal(),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")}else this.alertService.info(A.result)})}assingBatchInReturnMode(i){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=i}debitNoteEndPointReturnMode(i,c,r,h){const o=encodeURIComponent("wholesale");let f=encodeURIComponent(this._trnMainService.barCodes.BC),B=`/getProuductMultiplePriceBatchWise?mcode=${encodeURIComponent(i.MCODE)}&voucherPrefix=${r}&warehouse=${encodeURIComponent(c)}&barcode=${f}`;return"add-sales-invoice-wholesale"==this.activeurlpath&&(B=`${B}&tag=${o}`),B}getItemDetails(i,c=!1){if(this.checkItemInGrid()){let r=this._trnMainService.TrnMainObj.ProdList.findIndex(h=>h.BC==this._trnMainService.barCodes.BC&&0==h.FulfillBatchQty);this.addQuantityInExistingRow(r,1)}else this.addRow(i,0,!1,c),(this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===u.Km.PerformaSalesInvoice)&&this.getContractPriceandOtherDiscount()}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.PARAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}batchWiseStockTax(i){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=i}checkMcodeWiseStock(i,c=!1){let r=0,h=0;return r=1==this.userSetting.ENABLEBARCODEWISEBATCH?this._trnMainService.TrnMainObj.ProdList.filter(o=>o.MCODE==i&&o.BC==this._trnMainService.barCodes.BC).map(o=>o.RealQty).reduce((o,f)=>o+f,0):this._trnMainService.TrnMainObj.ProdList.filter(o=>o.MCODE==i).map(o=>o.RealQty).reduce((o,f)=>o+f,0),c&&(r+=1),h=1==this.userSetting.ENABLEBARCODEWISEBATCH?this._trnMainService.TrnMainObj.ProdList.filter(o=>o.MCODE==i&&o.BC==this._trnMainService.barCodes.BC)[0].TOTSTOCK:this._trnMainService.TrnMainObj.ProdList.filter(o=>o.MCODE==i)[0].TOTSTOCK,!(r>h)}getTotalQty(i,c=!1){let r=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==i).map(h=>h.RealQty).reduce((h,o)=>h+o,0);return c&&(r+=1),r}checkGridEnteredQty(i,c,r=!1,h=0,o=!1,f=""){if(this._trnMainService.TrnMainObj.VoucherType==u.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==u.Km.ManualstockEntry||this._trnMainService.TrnMainObj.VoucherType==u.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType==u.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==u.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType==u.Km.RequisitionEntry)return!0;let A=0;if(A=2==this.userSetting.EnableBatch?this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&B.BATCH==f).map(B=>B.Quantity).reduce((B,K)=>B+K,0):this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c).map(B=>B.Quantity).reduce((B,K)=>B+K,0),(this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType==u.Km.DeliveryReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&A>0){if(i+A>this._trnMainService.TrnMainObj.ProdList.find(K=>K.BC===c).TOTSTOCK)return this.alertService.info("Quantity exceed the available stock"),!1;i=0}if(1==this.userSetting.ENABLESINGLEBATCHMODE&&"pro"===t.N.appMode)return!0;let k=0;if(k=r?2==this.userSetting.EnableBatch?this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&B.BATCH==f&&B.RATE===h&&0==B.FulfillBatchQty).map(B=>B.Quantity).reduce((B,K)=>B+K,0):this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&B.RATE===h&&0==B.FulfillBatchQty).map(B=>B.Quantity).reduce((B,K)=>B+K,0):0==this.userSetting.OneToOneBarcodeMode?this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&B.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&0==B.FulfillBatchQty).map(B=>B.Quantity).reduce((B,K)=>B+K,0):this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&0==B.FulfillBatchQty).map(B=>B.Quantity).reduce((B,K)=>B+K,0),!this.checkPurchaseVouchertype())if(0==this.userSetting.OneToOneBarcodeMode){if(A=this._trnMainService.TrnMainObj.ProdList.filter(B=>B.BC===c&&B.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).map(B=>B.Quantity).reduce((B,K)=>B+K,0),A>0&&i+A>this._trnMainService.TrnMainObj.ProdList.find(K=>K.BC===c&&K.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).TOTSTOCK)return this.alertService.info("Quantity exceed the available stock"),!1}else if(A>0&&i+A>this._trnMainService.TrnMainObj.ProdList.find(K=>K.BC===c).TOTSTOCK)return this.alertService.info("Quantity exceed the available stock"),!1;if(k>0){let B=i+k;if(o&&(B=i),B>this._trnMainService.TrnMainObj.ProdList.find(K=>K.BC===c&&0==K.FulfillBatchQty).STOCK&&!this.checkPurchaseVouchertype()){let K=this._trnMainService.TrnMainObj.ProdList.findIndex(Q=>Q.BC===c&&0==Q.FulfillBatchQty);return confirm("Batch Wise Stock is exceeded do you want to choose batch popup ")&&(this.PlistTitle="Batch Price Selection",document.getElementById("barcodeField").blur(),this._trnMainService.TrnMainObj.ProdList[K].FulfillBatchQty=!0),!1}}return!0}changeBatchWiseRate(i){let c=0;this.itemInfo&&(c=this._trnMainService.TrnMainObj.ProdList.findIndex(r=>r.MCODE==this.itemInfo.MCODE&&r.BC==this._trnMainService.barCodes.BC)),(this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===u.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===u.Km.PerformaSalesInvoice||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE||this._trnMainService.TrnMainObj.VoucherType===u.Km.SalesOrder)&&this._trnMainService.nullToZeroConverter(i)>0&&(this._trnMainService.TrnMainObj.ProdList[c].RATE=i,this._trnMainService.TrnMainObj.ProdList[c].REPACKRATE=i,this._trnMainService.TrnMainObj.ProdList[c].PRATE=i,this._trnMainService.TrnMainObj.ProdList[c].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==u.Km.Repack?this._trnMainService.TrnMainObj.ProdList[c].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[c].CONFACTOR):i)}setDefaultUnitwisRate(i){console.log("setunit",i),null!=this._trnMainService.TrnMainObj.ProdList[i].Product.AlternateUnits.filter(r=>1==r.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[i].ALTRATE=this._trnMainService.TrnMainObj.ProdList[i].RATE*this._trnMainService.TrnMainObj.ProdList[i].ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(i){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==i[0].MFGDATE?"":i[0].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==i[0].EXPDATE?"":i[0].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=i[0].BATCH)}model1Closed(){this.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},300)}checkPurchaseVouchertype(){return this._trnMainService.TrnMainObj.VoucherType===u.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===u.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===u.Km.GoodsReceived}returnBatch(i){let c=[];if("self-billing"==this.activeurlpath&&(c=this._trnMainService.TrnMainObj.ProdList.filter(r=>r.BATCH==i.BATCH&&r.MCODE==i.MCODE),c.length>0))this.alertService.warning("Cannot add same item with same batch in self-billing");else{if(this._trnMainService.TrnMainObj.VoucherType===u.Km.TaxInvoice&&"self-billing"!=this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===u.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===u.Km.Sales){if(c=this._trnMainService.TrnMainObj.ProdList.filter(2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&1==this.userSetting.EnableBatchWisePrice?r=>r.BC==this._trnMainService.barCodes.BC&&r.BATCH==i.BATCH&&r.RATE==i.RATE:r=>r.BC==this._trnMainService.barCodes.BC&&r.RATE==i.RATE),c.length>0)return void this.alertService.info("Cannot select the batch with same rate");if(!this.checkGridEnteredQty(1,this._trnMainService.barCodes.BC,!0,i.RATE,i.BATCH))return}this.PlistTitle="",this.addRow(this.currentProdObj,i,!0,!0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected=!0}}dblClickPopupBatch(i){this.returnBatch(i)}hideDetails(){this.masterService.ShowMore=!1,this._trnMainService.barCodes.Quantity=1}validationInSelfBilling(){return""==this._trnMainService.TrnMainObj.MWAREHOUSE?(this.alertService.warning("Please select an unsaleable warehouse!"),this.alertService.emitShowHideSubject.subscribe(i=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)}),!1):""!=this._trnMainService.TrnMainObj.REMARKS&&null!=this._trnMainService.TrnMainObj.REMARKS||(this.alertService.warning("Remarks is mandatory!"),this.alertService.emitShowHideSubject.subscribe(i=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)}),!1)}salesreturnInLiteMode(){return!("lite"!=this._trnMainService.AppMode||this._trnMainService.TrnMainObj.VoucherType!==u.Km.CreditNote||!this._trnMainService.TrnMainObj.REFBILL||0!=this._trnMainService.TrnMainObj.DOFULLRETURN||0!=this._trnMainService.userSetting.ENABLEMANUALSALESRETURN)}getSchemeDiscountForItem(i){console.log("get scheme discount for item",i),this._trnMainService.getSchemeDiscount(i.MCODE,this._trnMainService.TrnMainObj.DIVISION).subscribe(h=>{console.log("result fff",h),i.SchemeList="ok"==h.status?h.result:[],console.log("check scheme list",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SchemeList)},h=>{i.SchemeList=[],this.alertService.error(h)})}descEnter(){let c=this._trnMainService.TrnMainObj.MWAREHOUSE;c||(c=this._trnMainService.userProfile.userWarehouse),this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this._trnMainService.TrnMainObj,""),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/A/all/${this._trnMainService.TrnMainObj.VoucherPrefix}/${c}`,this.gridPopupSettings.multiSelect=!0,this.genericGrid.show()}dblClickPopupItem(i){console.log("event",i),this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),this.loadDescriptionWiseProduct=!0,this._trnMainService.barCodes.DESCA=i.DESCA,this._trnMainService.barCodes.BC=i.MENUCODE,this.checkDublicateonItemEnter(i)||this.addRow(i,0)}dblClickBarcodeWisePopupItem(i){console.log("event",i),this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),(this._trnMainService.TrnMainObj.VoucherType==u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)&&0==this.userSetting.OneToOneBarcodeMode&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList.find(c=>c.MCODE==i.MCODE)?.ALTERNATEQUANTIY)>=this._trnMainService.nullToZeroConverter(i.STOCK)?0==this._trnMainService.nullToZeroConverter(i.STOCK)?this.alertService.info("Product is out of stock"):this.alertService.info("Quantity exceeded the available stock"):(this.loadDescriptionWiseProduct=!0,this._trnMainService.barCodes.DESCA=i.DESCA,this._trnMainService.barCodes.BC=i.BARCODE,(this._trnMainService.TrnMainObj.VoucherType==u.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==u.Km.CreditNote)&&(this.checkDublicateonItemEnter(i)||this.addRow(i,0,!1,!0)),(this._trnMainService.TrnMainObj.VoucherType==u.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==u.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==u.Km.BranchTransferOut)&&(this.currentProdObj=i,this.checkDublicateonItemEnter(i)||this.majorMethods(i,!0)))}checkDublicateonItemEnter(i){return this._trnMainService.TrnMainObj.ProdList.filter(r=>r.MENUCODE==i.MENUCODE&&r.BATCH==i.BATCH)?.length>0&&(this._trnMainService.TrnMainObj.ProdList.forEach(r=>{r.MENUCODE==i.MENUCODE&&r.BATCH==i.BATCH&&(r.ALTERNATEQUANTIY+=1)}),this._trnMainService.ReCalculateBillWithNormal(),document.getElementById("barcodeDesc").focus(),!0)}onSupplierEnter(){this._trnMainService.TrnMainObj.BILLTO="",this.genericGridForSupplierSetting=this.masterService.getGenericGridPopUpSettings("SupplierList"),this.genericGridForSupplier.show()}dblClickLoadOnSupplierClick(i){console.log("event",i),this.spinnerService.show("Loading..."),this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this.spinnerService.hide()}enbaleStock(){return!("requisition-log"==this.activeurlpath||95==this._trnMainService.TrnMainObj.VoucherType||84==this._trnMainService.TrnMainObj.VoucherType||85==this._trnMainService.TrnMainObj.VoucherType||96==this._trnMainService.TrnMainObj.VoucherType||87==this._trnMainService.TrnMainObj.VoucherType)}onChangeEvent(i){0==i&&(this._trnMainService.TrnMainObj.BILLTO="",this._trnMainService.TrnMainObj.PARAC=null)}updown(i){"F11"==i.code&&i.ctrlKey&&(i.preventDefault(),this._trnMainService.barCodes.BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&(this.PlistTitle="Batch Price Selection"))}altrateChangeForReplaceRate(i,c){c.existingBarcode&&"replacerate"===i.message&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=c.CONFACTOR*c.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=c.ALTUNIT)}onMultiItemSelected(i){this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),this.loadDescriptionWiseProduct=!0,i.forEach(c=>{this.checkDublicateonItemEnter(c)||this.addRow(c,0)})}}return E.\u0275fac=function(i){return new(i||E)(M.Y36(j.P),M.Y36(x.p),M.Y36(g.c),M.Y36(m.gz),M.Y36(v.e),M.Y36(l.V),M.Y36(S.h))},E.\u0275cmp=M.Xpm({type:E,selectors:[["discounts-insert"]],viewQuery:function(i,c){if(1&i&&(M.Gf(T,5),M.Gf(p,5),M.Gf(O,5),M.Gf(y,5)),2&i){let r;M.iGM(r=M.CRH())&&(c.multiselectGenericGrid=r.first),M.iGM(r=M.CRH())&&(c.genericGrid=r.first),M.iGM(r=M.CRH())&&(c.genericGridForSupplier=r.first),M.iGM(r=M.CRH())&&(c.genericGridForBarcodeWiseProduct=r.first)}},hostBindings:function(i,c){1&i&&M.NdJ("keydown",function(h){return c.updown(h)},!1,M.evT)},decls:30,vars:13,consts:[[1,"pd0","mr3","plainBackGround",2,"margin-left","0px  !important"],[1,"row"],[1,"col-md-2"],[2,"width","25%","font-weight","bold"],["id","barcodeField","type","text","autocomplete","off","placeholder","Enter Barcode","onclick","this.select()",2,"width","64%","margin-top","4px",3,"disabled","ngModel","focus","ngModelChange","keydown.Tab","keydown.enter","keydown.insert"],[1,"col-md-4"],[2,"width","20%","font-weight","bold"],["type","text","autocomplete","off","style","width:64%; margin-top: 4px;","placeholder","Description",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["type","text","autocomplete","off","id","barcodeDesc","style","width:64%; margin-top: 4px;","placeholder","Press ENTER to Select Item","readonly","",3,"ngModel","disabled","ngModelChange","keydown.enter","keypress",4,"ngIf"],["type","number","id","quantityBarcode","autocomplete","off",2,"width","34%","margin-top","4px",3,"ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],["class","row",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick","onItemsSelected"],["genericGrid",""],[3,"popupsettings","onItemDoubleClick"],["genericGridForSupplier",""],["genericGridForBarcodeWiseProduct",""],[3,"popupsettings","onItemsSelected"],["multiselectGenericGrid",""],["type","text","autocomplete","off","placeholder","Description",2,"width","64%","margin-top","4px",3,"disabled","ngModel","ngModelChange"],["type","text","autocomplete","off","id","barcodeDesc","placeholder","Press ENTER to Select Item","readonly","",2,"width","64%","margin-top","4px",3,"ngModel","disabled","ngModelChange","keydown.enter","keypress"],[2,"width","45%","font-weight","bold"],[3,"ngStyle"],[2,"width","95%","border-radius","3px"],[1,"legend-class",2,"font-size","14px","width","36%"],["type","checkbox","id","supplierSelect",3,"ngModel","checked","disabled","ngModelChange","change"],[1,"col-sm-4"],[1,"col-sm-7"],["type","text","placeholder","Press ENTER to Select","autocomplete","off",2,"width","100%",3,"disabled","ngModel","keydown.Enter","keyup","keypress","ngModelChange"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue"]],template:function(i,c){1&i&&(M.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",1)(4,"label",3),M._uU(5,"BarCode:"),M.qZA(),M.TgZ(6,"input",4),M.NdJ("focus",function(){return c.hideDetails()})("ngModelChange",function(h){return c._trnMainService.barCodes.BC=h})("ngModelChange",function(){return c.productHelperService.clearBarcodeGrid()})("keydown.Tab",function(){return c.ItemBarCodeTabEnter()})("keydown.enter",function(h){return c.ItemBarCodeClick(h)})("keydown.insert",function(){return c.ItemBarcodeInsert()}),M.qZA()()(),M.TgZ(7,"div",5)(8,"div",1)(9,"label",6),M._uU(10,"Description:"),M.qZA(),M.YNc(11,_,1,2,"input",7),M.YNc(12,I,1,2,"input",8),M.qZA()(),M.TgZ(13,"div",2)(14,"div",1)(15,"label",3),M._uU(16,"Quantity:"),M.qZA(),M.TgZ(17,"input",9),M.NdJ("ngModelChange",function(h){return c._trnMainService.barCodes.Quantity=h})("keydown.Tab",function(){return c.ItemQuantityTabEnter()})("keydown.enter",function(h){return c.barcodeQuantityClick(h)}),M.qZA()()(),M.TgZ(18,"div",5),M.YNc(19,w,5,4,"div",10),M.YNc(20,V,10,5,"div",10),M.qZA()()(),M.YNc(21,N,2,6,"div",11),M.TgZ(22,"generic-popup-grid",12,13),M.NdJ("onItemDoubleClick",function(h){return c.dblClickPopupItem(h)})("onItemsSelected",function(h){return c.onMultiItemSelected(h)}),M.qZA(),M.TgZ(24,"generic-popup-grid",14,15),M.NdJ("onItemDoubleClick",function(h){return c.dblClickLoadOnSupplierClick(h)}),M.qZA(),M.TgZ(26,"generic-popup-grid",14,16),M.NdJ("onItemDoubleClick",function(h){return c.dblClickBarcodeWisePopupItem(h)}),M.qZA(),M.TgZ(28,"multiselect-generic-grid",17,18),M.NdJ("onItemsSelected",function(h){return c.onMultiItemSelected(h)}),M.qZA()),2&i&&(M.xp6(6),M.Q6J("disabled",c.disableBarcode()||c._trnMainService.fromNotification)("ngModel",c._trnMainService.barCodes.BC),M.xp6(5),M.Q6J("ngIf","requisition-log"!=c._trnMainService.activeurlpath),M.xp6(1),M.Q6J("ngIf","requisition-log"==c._trnMainService.activeurlpath),M.xp6(5),M.Q6J("ngModel",c._trnMainService.barCodes.Quantity)("disabled",c.disableBarcode()),M.xp6(2),M.Q6J("ngIf",c.enbaleStock()),M.xp6(1),M.Q6J("ngIf","requisition-log"==c.activeurlpath),M.xp6(1),M.Q6J("ngIf","Batch Price Selection"==c.PlistTitle),M.xp6(1),M.Q6J("popupsettings",c.gridPopupSettings),M.xp6(2),M.Q6J("popupsettings",c.genericGridForSupplierSetting),M.xp6(2),M.Q6J("popupsettings",c.genericGridForBarcodeWiseProductSetting),M.xp6(2),M.Q6J("popupsettings",c.multiselectPopupSettings))},dependencies:[b.O5,b.PC,a.Fj,a.wV,a.Wl,a.JJ,a.On,s.Zl,n.K,R.ky],styles:[".prefixYes[_ngcontent-%COMP%] {\n        width: 34%;\n    }\n\n    .prefixNo[_ngcontent-%COMP%] {\n        width: 88%;\n    }\n\n    .btn[_ngcontent-%COMP%] {\n        width: 65px;\n    }"]}),E})()},27009:(F,U,d)=>{d.d(U,{H:()=>E});var e=d(20092),t=d(54536),u=d(42326),s=d(64537),R=d(51405),M=d(53074),j=d(87584),x=d(67311),g=d(88692);const m=["color"],v=["imeino"],l=["imei1"],S=function(){return{standalone:!0}};function b(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21),s._uU(4,"Item :"),s.qZA(),s.TgZ(5,"div",22)(6,"div",23),s._uU(7),s.qZA()()(),s.TgZ(8,"div",20)(9,"div",21),s._uU(10,"Warranty Period (months):"),s.qZA(),s.TgZ(11,"div",24)(12,"div",23),s._uU(13),s.qZA()()(),s.TgZ(14,"div",25)(15,"div",21),s._uU(16,"IMEI NO :"),s.qZA(),s.TgZ(17,"div",26)(18,"input",27,28),s.NdJ("ngModelChange",function(o){s.CHM(r);const f=s.oxw();return s.KtG(f.IMEINO1=o)})("keydown.enter",function(o){s.CHM(r);const f=s.oxw();return s.KtG(f.checkBarCodeItem(o.target.value))})("keydown.tab",function(o){s.CHM(r);const f=s.oxw();return s.KtG(f.checkBarCodeItem(o.target.value))}),s.qZA()()()()()}if(2&i){const r=s.oxw();s.xp6(7),s.hij("",r.data.message.ITEMDESC," "),s.xp6(6),s.hij("",r.data.message.WARRANTY," "),s.xp6(5),s.Q6J("ngModel",r.IMEINO1)("ngModelOptions",s.DdM(4,S))}}function a(i,c){if(1&i&&(s.TgZ(0,"option",43),s._uU(1),s.qZA()),2&i){const r=c.$implicit;s.s9C("value",null==r?null:r.colorName),s.xp6(1),s.hij(" ",null==r?null:r.colorName,"")}}function n(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"td",38)(1,"select",39,40),s.NdJ("change",function(o){s.CHM(r);const f=s.oxw(3);return s.KtG(f.onChaneColor(o))})("keydown.enter",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.colorEnterClicked(o))}),s.ynx(3,41),s.YNc(4,a,2,2,"option",42),s.BQk(),s.qZA()()}if(2&i){const r=s.oxw(3);s.xp6(4),s.Q6J("ngForOf",r.colorLists)}}function T(i,c){if(1&i&&(s.TgZ(0,"td",38),s._UZ(1,"input",44),s.qZA()),2&i){const r=s.oxw(3);s.xp6(1),s.s9C("value",r.colorLists.colorName),s.Q6J("readonly",!0)}}function p(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"td",45)(1,"input",46),s.NdJ("change",function(o){s.CHM(r);const f=s.oxw(3);return s.KtG(f.onChangeIMEINO1(o))})("keydown.enter",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.imei1EnterClicked(o))}),s.qZA()()}if(2&i){const r=s.oxw().index,h=s.oxw(2);s.xp6(1),s.MGl("id","imei1",r,""),s.Q6J("readOnly","VIEW"==h.mode)}}function O(i,c){if(1&i&&(s.TgZ(0,"option",43),s._uU(1),s.qZA()),2&i){const r=c.$implicit;s.Q6J("value",r.BARCODE),s.xp6(1),s.Oqu(r.BARCODE)}}function y(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"td",45)(1,"input",47),s.NdJ("keydown.enter",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.imei1EnterClicked(o))})("change",function(o){s.CHM(r);const f=s.oxw(3);return s.KtG(f.onChangeIEMINO1(o))}),s.qZA(),s.TgZ(2,"datalist",48),s.YNc(3,O,2,2,"option",42),s.qZA()()}if(2&i){const r=s.oxw().index,h=s.oxw(2);s.xp6(1),s.MGl("id","imei1",r,""),s.xp6(2),s.Q6J("ngForOf",h.IMEINO1List)}}function _(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"td",45)(1,"input",49),s.NdJ("keydown.enter",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.addItems(o))})("keydown.tab",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.addItems(o))}),s.qZA()()}if(2&i){const r=s.oxw().index,h=s.oxw(2);s.xp6(1),s.MGl("id","imei2",r,""),s.Q6J("readOnly","VIEW"==h.mode)}}function I(i,c){if(1&i&&(s.TgZ(0,"option",43),s._uU(1),s.qZA()),2&i){const r=c.$implicit;s.Q6J("value",r.VEHICLECHASISNO),s.xp6(1),s.Oqu(r.VEHICLECHASISNO)}}function P(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"td",45)(1,"input",50),s.NdJ("keydown.enter",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.addItems(o))})("keydown.tab",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.addItems(o))}),s.qZA(),s.TgZ(2,"datalist",51),s.YNc(3,I,2,2,"option",42),s.qZA()()}if(2&i){const r=s.oxw().index,h=s.oxw(2);s.xp6(1),s.MGl("id","imei2",r,""),s.xp6(2),s.Q6J("ngForOf",h.IMEINO2List)}}function L(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"div",52)(1,"button",53),s.NdJ("click",function(){s.CHM(r);const o=s.oxw().index,f=s.oxw(2);return s.KtG(f.removeItems(o))}),s._uU(2,"Remove"),s.qZA()()}if(2&i){const r=s.oxw(3);s.xp6(1),s.Q6J("disabled","VIEW"==r.mode)}}function w(i,c){if(1&i&&(s.TgZ(0,"tr",31)(1,"td",32),s._uU(2),s.qZA(),s.YNc(3,n,5,1,"td",33),s.YNc(4,T,2,2,"td",34),s.YNc(5,p,2,2,"td",35),s.YNc(6,y,4,2,"td",35),s.YNc(7,_,2,2,"td",35),s.YNc(8,P,4,2,"td",35),s.TgZ(9,"td",36),s.YNc(10,L,3,1,"div",37),s.qZA()()),2&i){const r=c.index,h=s.oxw(2);s.Q6J("formGroupName",r),s.xp6(2),s.Oqu(r+1),s.xp6(1),s.Q6J("ngIf","VIEW"!=h.mode),s.xp6(1),s.Q6J("ngIf","VIEW"==h.mode&&("PI"==h.type||"OP"==h.type)),s.xp6(1),s.Q6J("ngIf",h.isShowField()),s.xp6(1),s.Q6J("ngIf","NEW"==h.mode&&"TI"==h.type),s.xp6(1),s.Q6J("ngIf",h.isShowField()),s.xp6(1),s.Q6J("ngIf","NEW"==h.mode&&"TI"==h.type),s.xp6(2),s.Q6J("ngIf",h.isShowField())}}function V(i,c){if(1&i&&(s.TgZ(0,"tbody",29),s.YNc(1,w,11,9,"tr",30),s.qZA()),2&i){const r=s.oxw();s.xp6(1),s.Q6J("ngForOf",r.productArray.controls)}}function N(i,c){if(1&i){const r=s.EpF();s.TgZ(0,"tr",45)(1,"td",32),s._uU(2),s.qZA(),s.TgZ(3,"td",38),s._uU(4),s.qZA(),s.TgZ(5,"td",38),s._uU(6),s.qZA(),s.TgZ(7,"td",38),s._uU(8),s.qZA(),s.TgZ(9,"td",56)(10,"button",57),s.NdJ("click",function(){const f=s.CHM(r).index,A=s.oxw(2);return s.KtG(A.removeItems(f))}),s._uU(11,"Remove"),s.qZA()()()}if(2&i){const r=c.$implicit,h=c.index,o=s.oxw(2);s.xp6(2),s.Oqu(h+1),s.xp6(2),s.Oqu(r.color),s.xp6(2),s.Oqu(r.IEMI1),s.xp6(2),s.Oqu(r.IEMI2),s.xp6(2),s.Q6J("disabled","VIEW"==o.mode)}}function D(i,c){if(1&i&&(s.TgZ(0,"tbody",54),s.YNc(1,N,12,5,"tr",55),s.qZA()),2&i){const r=s.oxw();s.xp6(1),s.Q6J("ngForOf",r.productDetailsList)}}let E=(()=>{class i{constructor(r,h,o,f,A,k,B,K){this.fb=r,this.productMasterService=h,this.masterService=o,this._transactionService=f,this.dialogref=A,this.changeDetection=k,this.alterService=B,this.data=K,this.currentPage=1,this.limit=10,this.offset=0,this.productDetailsList=[],this.curretnIndexPrevDetials=[],this.productList=[],this.IMEINO1List=[],this.IMEINO2List=[],this.isSubmitting=!1,this.isLoader=!1,this.isSubmitted=!1,this.lastColor="",K&&(this.type=K.type,this.productDetails=K.message,this.mode=K.mode,this.productList=K.productList,this.batch=K.message.BATCH,this.warehouse=K.warehouse,this.curretnIndexPrevDetials=K.curretnIndexPrevDetials,this.mcode=this.productDetails&&this.productDetails.MCODE?this.productDetails.MCODE:"",this.TrnMainObj=K.TrnMainObj),this.mcode&&this.getColor(this.mcode);const Q=this.productDetails&&this.productDetails.productDetails?this.productDetails.productDetails:[];Q&&Q.length>0&&this.formReset(Q)}get productArray(){return this.form.get("productColorList")}updown(r){"End"===r.code&&(r.preventDefault(),this.submit()),"Escape"===r.code&&(r.preventDefault(),this.closeModalAtEscape())}productDetailTitle(){let r;return"VIEW"==this.mode?(r="Product Details List",r):(r="Insert Product Details",r)}ngAfterContentChecked(){this.changeDetection.detectChanges()}getColor(r){this.masterService.getProductColorByMCode(r).subscribe(h=>{this.colorLists=h&&h.result?h.result:[]})}onChaneColor(r){this.selectedColor=r.target.value,"TI"==this.type&&this.getProductIMEINOColorWise(this.mcode,this.selectedColor)}getProductIMEINOColorWise(r,h){this.masterService.getProductIMEINOByMCodeAndColor(r,h,this.batch).subscribe(o=>{this.IMEINO1List=o.result.length<1?[]:o&&o.result?o.result:[]})}onChangeIEMIN1(r){if(0==this.IMEINO1List.filter(o=>o.BARCODE==r.target.value).length)return this.alterService.info("Entered IMEINO1 is not belong to this product"),!1;this.getProductIMEINOTwoColorWise(this.mcode,this.selectedColor,r.target.value)}getProductIMEINOTwoColorWise(r,h,o){this.masterService.getProductIMEINOTwoByMCodeAndColor(r,h,o).subscribe(f=>{this.IMEINO2List=f&&f.result?f.result:[]})}ngOnInit(){"VIEW"==this.productDetails.rowMode||"EDIT"==this.productDetails.rowMode||this.curretnIndexPrevDetials?.length>=1?this.prepareProductDetailForViewandEDIT():this.form=this.fb.group({productColorList:this.fb.array([this.addProductItems()])})}ngAfterViewInit(){console.log("enm",this.colorElement,this.imeinoEl),"VIEW"!=this.productDetails.rowMode&&("PI"==this.type||"OP"==this.type?this.colorElement&&setTimeout(()=>this.colorElement.nativeElement.focus()):"TI"==this.type&&"NEW"==this.mode&&this.imeinoEl&&setTimeout(()=>this.imeinoEl.nativeElement.focus())),this.imei1Element.changes.subscribe(()=>{setTimeout(()=>{},10)})}formReset(r){this.form.setControl("productColorList",this.setExistingColor(r&&r.productColorList?r.productColorList:""))}setExistingColor(r){const h=new e.Oe([]);return r.forEach(o=>{h.push(this.fb.group({id:o.id?o.id:"",color:o.color?o.color:"",quantity:o.quantity?o.quantity:1,IEMI1:o.IEMI1?o.IEMI1:"",IEMI2:o.IEMI2?o.IEMI2:""}))}),h}addProductItems(){return this.fb.group({color:[this.lastColor,[e.kI.required]],quantity:[1],MCODE:[this.data.message.MCODE],IEMI1:["",[e.kI.required]],IEMI2:[""]})}prepareProductDetailForViewandEDIT(){let r=this.productDetails.ProductDetails.length?this.productDetails.ProductDetails:this.curretnIndexPrevDetials;this.form=this.fb.group({productColorList:this.fb.array([this.addProductItems()])}),this.productArray.removeAt(0);for(const f of r){var h=this.fb.group({color:f.color,quantity:1,IEMI1:f.IEMI1,IEMI2:f.IEMI2}),o={};o.color=f.color,o.Quantity=1,o.IEMI1=f.IEMI1,o.IEMI2=f.IEMI2,this.productDetailsList.push(o),this.productArray.push(h)}}prepareProductDetailsInSales(){let r=this.productDetails.ProductDetails.length?this.productDetails.ProductDetails:this.curretnIndexPrevDetials;this.form=this.fb.group({productColorList:this.fb.array([this.addProductItems()])}),this.productArray.removeAt(0);for(const o of r){var h={};h.color=o.color,h.Quantity=1,h.IEMI1=o.IEMI1,h.IEMI2=o.IEMI2,this.productDetailsList.push(h)}}closeModel(){if(confirm("You Are Going To Cancel Your Current Entry. Do You Want To Procced Anyway ?  ")){const r=this.form.value;"NEW"!=this.mode?this.dialogref.close({data:r}):this.dialogref.close(),this.form.reset()}}removeItems(r){"TI"==this.type||"CN"==this.type||"DN"==this.type||"QT"==this.type||"PP"==this.type||"TO"==this.type?this.productDetailsList.splice(r,1):this.productArray.removeAt(r)}addItems(r){const h=this.form.value.productColorList,o=h[h.length-1];if(null===o.color||""===o.color||null===o.IEMI1||""===o.IEMI1)return;if(h.filter(A=>A.IEMI1===o.IEMI1).length>1)return void this.alterService.error("Duplicate IMEI number!");this.lastColor=o.color,this.productArray.push(this.addProductItems());let f=r+1;setTimeout(()=>{null!=document.getElementById("imei1"+f)&&document.getElementById("imei1"+f).focus()},20)}checkBarCodeItem(r){if(r){let h=[],o=this.productDetailsList.filter(A=>A.IEMI1==r);if(null!=o&&o.length)return void this.alterService.info(`Duplicate IMEI1 :${r} is found`);if(h=this.productList.filter(A=>null!=A.BC&&""!=A.BC),h.length&&null!=h.filter(k=>k.BC==r)[0])return void this.alterService.info(`Duplicate IMEI1 :${r} found on Product Entry Grid`);this.productList.filter(A=>6==A.PTYPE).forEach(A=>A.ProductDetails?.forEach(k=>{if(k.IEMI1==r)return this.alterService.info(`Duplicte IMEI1 :${k.IEMI1} is found on Bulk Entry Grid`),r=null,!1})),r&&(this._transactionService.TrnMainObj.VoucherType===u.Km.CreditNote||"CN"==this.type?this._transactionService.checkBarcodeForSalesReturn(r,this.TrnMainObj.REFBILL).subscribe(A=>{"ok"==A.status?this.addItemsScanned(r):this.alterService.info(A.result)},A=>{this.alterService.info(A.result)}):this._transactionService.TrnMainObj.VoucherType===u.Km.BranchTransferOut||"TO"==this.type||"DN"==this.type?this.masterService.getBarcodeWiseBatchDetails(r).subscribe(A=>{"ok"==A.status&&this.addItemsScannedStockOut(r,A.result)}):this._transactionService.checkBarcode(r,this.warehouse).subscribe(A=>{"ok"==A.status?this.addItemsScanned(r):(this.alterService.info(A.result),this.alterService.emitShowHideSubject.subscribe(k=>{setTimeout(()=>{document.getElementById("imeino").focus()},0)}))},A=>{this.alterService.info(A.result)}))}}addItemsScannedStockOut(r,h){let o={};o.color=h.COLOR,o.IEMI1=this.IMEINO1,o.IEMI2=h.BARCODE,o.Quantity=1,o.LANDINGCOST=h.LANDINGCOST,o.Costprice=h.Costprice,this.productDetailsList.push(o),this.IMEINO1=""}addItemsScanned(r){if(r){let h=[];this._transactionService.CheckIfSalesReturn()?this.masterService.getProductBCodeDetailForSalsReturn(this.mcode,r).subscribe(o=>{if("ok"==o.status){h=o&&o.result?o.result:[];let f={};f.color=h[0].COLOR,f.IEMI1=this.IMEINO1,f.IEMI2=h[0].IMEINO2,f.Quantity=1,this.productDetailsList.push(f),this.IMEINO1=""}}):this._transactionService.TrnMainObj.VoucherType===u.Km.CreditNote||"CN"==this.type?this.masterService.getProductBarCodeForMobileItem(this.mcode,r).subscribe(o=>{if("ok"==o.status){h=o&&o.result?o.result:[];let f={};f.color=h[0].COLOR,f.IEMI1=this.IMEINO1,f.IEMI2=h[0].IMEINO2,f.Quantity=1,this.productDetailsList.push(f),this.IMEINO1=""}},o=>{this.alterService.error(o.error)}):this.masterService.getProductDetailsbyMCodeAndIMEINO1(this.mcode,r).subscribe(o=>{if("ok"==o.status){h=o&&o.result?o.result:[];let f={};f.color=h[0].COLOR,f.IEMI1=this.IMEINO1,f.IEMI2=h[0].IMEINO2,f.Quantity=1,this.productDetailsList.push(f),this.IMEINO1=""}})}else this.alterService.info("Please Enter IMEI No first.")}isShowTableBody(){return"PI"==this.type||"OP"==this.type}isShowItemScanedTable(){return"TI"===this.type||"CN"===this.type||"DN"===this.type||"QT"===this.type||"PP"==this.type||"TO"==this.type}isShowScanField(){return"NEW"==this.mode&&("TI"==this.type||"DN"===this.type)}isShowField(){return"NEW"==this.mode&&"TI"!=this.type||("VIEW"==this.mode||"EDIT"==this.mode)&&"TI"!=this.type}onChangeIMEINO1(r){}submit(){const r=this.form.value.productColorList,h=r[r.length-1];let o=[];if("PI"==this.type||"OP"==this.type){if(o=this.form.value.productColorList.filter(A=>""!=A.IEMI2),o.length&&o.some(A=>""==A.IEMI1))return this.isSubmitting=!0,void this.alterService.info("IMEI numbe one is mandatory!");if(r.filter(A=>A.IEMI1===h.IEMI1).length>1)return void this.alterService.error("Duplicate IMEI number!"+h.IEMI1);if(this.isSubmitted)return;this.isSubmitted=!0;const f=this.form.value;f.productColorList=f.productColorList.filter(A=>""!=A.IEMI1),"NEW"==this.mode?.toUpperCase()?this.masterService.masterPostmethod("/getProductDetailsListOfItem",f.productColorList).subscribe(A=>{"ok"==A.status?this.dialogref.close({data:f}):(this.isSubmitted=!1,this.alterService.info(A.result))}):this.dialogref.close({data:f})}("TI"==this.type||"CN"==this.type||"DN"===this.type||"QT"===this.type||"PP"===this.type||"TO"===this.type)&&(this.productDetailsList=this.productDetailsList.filter(f=>null!=f.IEMI1&&""!=f.IEMI1),console.log("this.productDetails",this.productDetailsList),this.dialogref.close({data:this.productDetailsList}))}colorEnterClicked(r){document.getElementById("imei1"+r).focus()}imei1EnterClicked(r){document.getElementById("imei2"+r).focus()}closeModalAtEscape(){const r=this.form.value;let h=r.productColorList.filter(o=>""!=o.IEMI1);"NEW"!=this.mode?this.dialogref.close({data:r}):"NEW"==this.mode&&h.length>0?this.dialogref.close("TI"==this.type?{data:r.productColorList}:{data:r}):this.dialogref.close(),this.form.reset()}}return i.\u0275fac=function(r){return new(r||i)(s.Y36(e.qu),s.Y36(R.L),s.Y36(M.P),s.Y36(j.p),s.Y36(t.so),s.Y36(s.sBO),s.Y36(x.c),s.Y36(t.WI))},i.\u0275cmp=s.Xpm({type:i,selectors:[["addproductdetails"]],viewQuery:function(r,h){if(1&r&&(s.Gf(m,5),s.Gf(v,5),s.Gf(l,5)),2&r){let o;s.iGM(o=s.CRH())&&(h.colorElement=o.first),s.iGM(o=s.CRH())&&(h.imeinoEl=o.first),s.iGM(o=s.CRH())&&(h.imei1Element=o)}},hostBindings:function(r,h){1&r&&s.NdJ("keydown",function(f){return h.updown(f)},!1,s.evT)},decls:34,vars:7,consts:[[1,""],["role","document",1,"",2,"max-width","100%","max-height","450px","overflow","hidden"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","46vw"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","text-center",2,"padding","0"],[3,"formGroup"],[1,"form-header"],[1,"title","h5",2,"margin-bottom","0","font-size","1.2rem","text-align","left"],["type","button",1,"btn","btn-info",2,"margin-right","5px",3,"disabled","click"],["type","button",1,"btn","btn-info",3,"disabled","click"],[1,"form_wrapper"],["class","row",4,"ngIf"],[1,"scrolldown"],["scope","col",2,"width","3%"],["scope","col"],["formArrayName","productColorList",4,"ngIf"],["style","height: 30vh;",4,"ngIf"],[1,"row"],[1,"col-lg-12",2,"padding","0"],[1,"row",2,"margin-bottom","0.2rem !important"],[1,"title","h5",2,"font-size","1rem"],[1,"col-sm-7"],[1,"title","h5",2,"font-size","1rem","text-align","left"],[1,"col-sm-4"],[1,"form-group","row",2,"margin-bottom","0.5rem !important"],[1,"col-sm-6"],["type","text","id","imeino","placeholder","Enter IMEI NO","autocomplete","off",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange","keydown.enter","keydown.tab"],["imeino",""],["formArrayName","productColorList"],["style","border: 1px solid #e6e6e6;",3,"formGroupName",4,"ngFor","ngForOf"],[2,"border","1px solid #e6e6e6",3,"formGroupName"],[2,"border","1px solid #e6e6e6","padding-left","2px","width","5%"],["style","border: 1px solid #e6e6e6;width: 27%; ",4,"ngIf"],["style","border: 1px solid #e6e6e6;width: 27%;",4,"ngIf"],["style","border: 1px solid #e6e6e6;",4,"ngIf"],[2,"border","1px solid #e6e6e6","width","13%"],["class","form-group",4,"ngIf"],[2,"border","1px solid #e6e6e6","width","27%"],["id","color","formControlName","color",1,"form-control",3,"change","keydown.enter"],["color",""],[1,"colorLists","&&","colorLists.length",">","0"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","color",1,"form-control",3,"readonly","value"],[2,"border","1px solid #e6e6e6"],["type","text","list","imeinofirst","placeholder","Enter IMEI 1*","formControlName","IEMI1","autocomplete","off",1,"form-control",3,"id","readOnly","change","keydown.enter"],["type","text","list","codes","placeholder","Enter IMEI 1*","formControlName","IEMI1",1,"form-control",3,"id","keydown.enter","change"],["id","codes"],["type","text","name","imei2","autocomplete","off","placeholder","Enter IMEI 2","list","imeino2","formControlName","IEMI2",1,"form-control",3,"id","readOnly","keydown.enter","keydown.tab"],["type","text","list","code","placeholder","Enter IMEI 2*","formControlName","IEMI2",1,"form-control",3,"id","keydown.enter","keydown.tab"],["id","code"],[1,"form-group"],["type","button",1,"btn","btn-sm","btn-danger",2,"line-height","1.2","width","-webkit-fill-available",3,"disabled","click"],[2,"height","30vh"],["style","border: 1px solid #e6e6e6;",4,"ngFor","ngForOf"],[2,"border","1px solid #e6e6e6","width","11%"],["type","button",1,"btn","btn-sm","btn-danger",2,"line-height","1.2",3,"disabled","click"]],template:function(r,h){1&r&&(s.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"button",3),s.NdJ("click",function(){return h.closeModalAtEscape()}),s.TgZ(5,"span",4),s._uU(6,"\xd7"),s.qZA()()(),s.TgZ(7,"div",5)(8,"form",6)(9,"div",7)(10,"div",8),s._uU(11),s.qZA(),s.TgZ(12,"div",0)(13,"button",9),s.NdJ("click",function(){return h.closeModel()}),s._uU(14,"CANCEL"),s.qZA(),s.TgZ(15,"button",10),s.NdJ("click",function(){return h.submit()}),s._uU(16,"SUBMIT"),s.qZA()()(),s.TgZ(17,"div",11),s.YNc(18,b,20,5,"div",12),s.TgZ(19,"table",13)(20,"thead")(21,"tr")(22,"th",14),s._uU(23,"SNo"),s.qZA(),s.TgZ(24,"th",15),s._uU(25,"Item Color"),s.qZA(),s.TgZ(26,"th",15),s._uU(27,"IMEI No-1"),s.qZA(),s.TgZ(28,"th",15),s._uU(29,"IMEI No-2"),s.qZA(),s.TgZ(30,"th",15),s._uU(31,"Action"),s.qZA()()(),s.YNc(32,V,2,1,"tbody",16),s.YNc(33,D,2,1,"tbody",17),s.qZA()()()()()()()),2&r&&(s.xp6(8),s.Q6J("formGroup",h.form),s.xp6(3),s.Oqu(h.productDetailTitle()),s.xp6(2),s.Q6J("disabled","VIEW"==h.mode),s.xp6(2),s.Q6J("disabled","VIEW"==h.mode),s.xp6(3),s.Q6J("ngIf",!("NEW"!=h.mode&&"EDIT"!=h.mode||"TI"!=h.type&&"CN"!=h.type&&"DN"!=h.type&&"QT"!=h.type&&"PP"!=h.type&&"TO"!=h.type)),s.xp6(14),s.Q6J("ngIf",h.isShowTableBody()),s.xp6(1),s.Q6J("ngIf",h.isShowItemScanedTable()))},dependencies:[g.sg,g.O5,e._Y,e.YN,e.Kr,e.Fj,e.EJ,e.JJ,e.JL,e.On,e.sg,e.u,e.x0,e.CE],styles:[".form-group[_ngcontent-%COMP%] {\n    text-align: left;\n  }\n\n  .form-control[_ngcontent-%COMP%] {\n    height: 27px !important;\n    font-size: 0.8rem;\n  }\n\n  .form-header[_ngcontent-%COMP%] {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n  }\n\n  .form-group[_ngcontent-%COMP%] {\n    margin-bottom: 0 !important;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 11px;\n  }\n\n  tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n    padding: 0.4rem;\n    background: silver;\n    color: black;\n    border-top: 2px solid #E6E6E6;\n    border-bottom: 2px solid #E6E6E6;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #ced6d3 !important;\n  }\n\n  table[_ngcontent-%COMP%] {\n    border-collapse: collapse;\n  }\n\n  tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n    padding: 2px !important;\n    margin: 0 !important;\n    vertical-align: middle;\n  }\n\n  table.scrolldown[_ngcontent-%COMP%] {\n    border-spacing: 0;\n    width: 100%;\n  }\n\n  table.scrolldown[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%], table.scrolldown[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%] {\n    display: block;\n  }\n\n\n  table.scrolldown[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%] {\n\n    \n    height: 321px;\n\n    \n    overflow-y: auto;\n\n    \n    overflow-x: hidden;\n  }"]}),i})()},33612:(F,U,d)=>{d.d(U,{i:()=>g});var e=d(92340),t=d(42326),u=d(64537),s=d(67297),R=d(69389),M=d(7976),j=d(87584),x=d(53074);let g=(()=>{class m{constructor(l,S,b,a,n){this.authservice=l,this.setting=S,this.arouter=b,this._trnMainService=a,this.masterService=n,this.AppSettings=S.appSetting,this.userprofile=l.getUserProfile(),this.userSetting=l.getSetting(),this.AppMode=e.N.appMode}afterEnterFocousItem(l,S,b){this.activerowIndex=S,1!=l||"add-sales-invoice"!=b&&"abbreviated-sales-invoice"!=b&&"quotation"!=b&&"performa-invoice"!=b&&"salesorder"!=b?"requisition-entry"==b?setTimeout(()=>{document.getElementById("alternateQty"+S).focus()},5):(this._trnMainService.allowDescriptionEdit=!1,this.focusAfterItemSelect(S)):(this._trnMainService.allowDescriptionEdit=!0,setTimeout(()=>{document.getElementById("itemDesc"+S).focus()},5))}focusAfterItemSelect(l){2==this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment?null!=document.getElementById("batch"+l)&&setTimeout(()=>{document.getElementById("batch"+l).focus()},20):(null!=document.getElementById("alternateunit"+l)&&setTimeout(()=>{document.getElementById("alternateunit"+l).focus()},20),74===this._trnMainService.TrnMainObj.VoucherType&&null!=document.getElementById("alternateqty"+l)&&setTimeout(()=>{document.getElementById("alternateqty"+l).focus()},20))}autoFocus(l,S,b={},a){this.getTableRowByIndex(l,S,b,a)}getTableRowByIndex(l,S,b={},a="productinserttable"){let n=document.getElementById(a);if(!((l+=1)>=1&&l<n.rows.length))return null;this.focusFirstFocusableElement(n.rows[l],S,b)}isFocusable(l){const S="function"==typeof l.focus,b=!0===l.disabled,a=!0===l.readOnly,n=null===l.offsetParent||"hidden"===l.style.visibility,p=l.hasAttribute("tabindex")&&"-1"!==l.getAttribute("tabindex"),O=["input","select","textarea","a"].includes(l.tagName.toLowerCase());return S&&!b&&!a&&!n&&(O||p)}removeElementsById(l,S){return l.filter(b=>!S.includes(b.id))}removeElementsBefore(l,S){const b=l.indexOf(S);return-1===b?l:l.slice(b+1)}focusFirstFocusableElement(l,S,b={}){const a=Array.from(l.querySelectorAll("input, button, a, select, textarea, [tabindex]:not([tabindex='-1'])")),n=this.removeElementsBefore(a,S);for(const T of n)if(this.isFocusable(T)){T.focus(),b.isFocusAchieved=!0;break}}}return m.\u0275fac=function(l){return new(l||m)(u.LFG(s.e),u.LFG(R.R),u.LFG(M.gz),u.LFG(j.p),u.LFG(x.P))},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac}),m})()},60694:(F,U,d)=>{d.d(U,{T:()=>m});var e=d(7976),t=d(42326),u=d(64537),s=d(53074),R=d(67297),M=d(67311),j=d(14970),x=d(69389),g=d(87584);let m=(()=>{class v{constructor(S,b,a,n,T,p,O,y){this.masterService=S,this.authservice=b,this.alertService=a,this.loadService=n,this.setting=T,this.arouter=p,this.router=O,this.trnmainservice=y,this.AppSettings=T.appSetting,this.userprofile=b.getUserProfile(),this.userSetting=b.getSetting(),this.activeurlpath=p.snapshot?.url[0]?.path,this.router.events.subscribe(_=>{if(_ instanceof e.m2){let I=_.url.split("/");this.urlpath=I[I.length-1]}})}getProperMessageForRefBill(S){console.log("from reponse messag service",S.VoucherType);let b="";switch(S.VoucherType){case t.Km.Purchase:b="Please Load the PO Reference bill!!!",0!=this.userSetting.ENABLE_GRN_IN_PI&&(b="Please Load GRN reference bill!!!");break;case t.Km.TaxInvoice:b="Please Load the SO Reference bill!!!";break;case t.Km.GoodsReceived:b="Please Load the PO Reference bill!!!";break;case t.Km.StockIssueReturn:b="Please Load the Stock Issue Reference bill!!!";break;case t.Km.PerformaSalesInvoice:b="Please Load the SO Reference bill!!!";break;default:b="Please Load the Reference Bill for return!!!"}return b}}return v.\u0275fac=function(S){return new(S||v)(u.LFG(s.P),u.LFG(R.e),u.LFG(M.c),u.LFG(j.V),u.LFG(x.R),u.LFG(e.gz),u.LFG(e.F0),u.LFG(g.p))},v.\u0275prov=u.Yz7({token:v,factory:v.\u0275fac}),v})()},7782:(F,U,d)=>{d.d(U,{y:()=>g});var e=d(7976),t=d(42326),u=d(64537),s=d(67297),R=d(67311),M=d(14970),j=d(69389),x=d(87584);let g=(()=>{class m{constructor(l,S,b,a,n,T,p){this.authservice=l,this.alertService=S,this.loadService=b,this.setting=a,this.arouter=n,this._trnMainService=T,this.router=p,this.showAuthPopup=!1,console.log("USER RIGHT AUTH SERVICE CALLED"),this.AppSettings=a.appSetting,this.userprofile=l.getUserProfile(),this.userSetting=l.getSetting(),this.activeurlpath=n.snapshot?.url[0]?.path,this.router.events.subscribe(O=>{if(O instanceof e.m2){let y=O.url.split("/");this.urlpath=y[y.length-1]}})}checkuserrightfordelete(l,S){if(1==this.userSetting.ENABLESINGLEBATCHMODE){if(S==t.Km.Purchase){if(0==this.userSetting.ALLOWMINUSTOCK_PURCHASE||1==this.userSetting.ALLOWMINUSTOCK_PURCHASE)return!1;if(2==this.userSetting.ALLOWMINUSTOCK_PURCHASE)return!this.checkForUserMinusStockAuth()&&(this.showAuthPopup=!0,!0)}if(S==t.Km.OpeningStockBalance){if(0==this.userSetting.ALLOWMINUSTOCK_OPENING||1==this.userSetting.ALLOWMINUSTOCK_OPENING)return!1;if(2==this.userSetting.ALLOWMINUSTOCK_OPENING)return!this.checkForUserMinusStockAuth()&&(this.showAuthPopup=!0,!0)}if(S==t.Km.BranchTransferOut){if(0==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT||1==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT)return!1;if(2==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT)return!this.checkForUserMinusStockAuth()&&(this.showAuthPopup=!0,!0)}}return!1}checkForUserMinusStockAuth(){return console.log("checkForUserMinusStockAuth",this.userprofile.userRights.filter(l=>"AllowMinusStock"==l.right)[0]),1==this.userprofile.userRights.filter(l=>"AllowMinusStock"==l.right)[0]?.value}checkUserRightsForCreditSales(){return 1==this.userprofile.userRights.find(l=>"CSALES"==l.right.toUpperCase())?.value}}return m.\u0275fac=function(l){return new(l||m)(u.LFG(s.e),u.LFG(R.c),u.LFG(M.V),u.LFG(j.R),u.LFG(e.gz),u.LFG(x.p),u.LFG(e.F0))},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac}),m})()},74263:(F,U,d)=>{d.d(U,{R:()=>g});var e=d(7976),t=d(42326),u=d(64537),s=d(67297),R=d(67311),M=d(14970),j=d(69389),x=d(87584);let g=(()=>{class m{constructor(l,S,b,a,n,T,p){this.authservice=l,this.alertService=S,this.loadService=b,this.setting=a,this.arouter=n,this._trnMainService=T,this.router=p,this.AppSettings=a.appSetting,this.userprofile=l.getUserProfile(),this.userSetting=l.getSetting(),this.activeurlpath=n.snapshot?.url[0]?.path,this.router.events.subscribe(O=>{if(O instanceof e.m2){let y=O.url.split("/");this.urlpath=y[y.length-1]}})}validateDuplicateItemEntry(l,S){if(l.VoucherType===t.Km.DebitNote&&(1==this.userSetting.EnableBatch||2==this.userSetting.EnableBatch))return void 0===l.ProdList.find(a=>a.MENUCODE==S.MENUCODE&&a.BATCH==S.BATCH&&a.CRATE==S.CRATE);if(l.VoucherType===t.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!==l.AdditionalObj.tag&&1==this.userSetting.DisableDuplicateItemEntry||l.VoucherType===t.Km.Purchase&&0!==this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"===l.AdditionalObj.tag&&1==this.userSetting.DisableDuplicateItemEntry||l.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&l.REFORDBILL||l.VoucherType===t.Km.SalesOrder&&this.userSetting.ENABLE_QUOTATTION_INSO&&l.REFORDBILL||l.VoucherType===t.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE||l.VoucherType===t.Km.DebitNote&&1==this.userSetting.DisableDuplicateItemEntry||l.VoucherType===t.Km.ProductionEntry||l.VoucherType===t.Km.CreditNote&&1==this.userSetting.DisableDuplicateItemEntry){let b;return b=l.ProdList.find(1==this.userSetting.EnableVariantCategory&&1==S.HASVARIANT?a=>a.MENUCODE==S.MENUCODE&&a.BC==S.BC:l.VoucherType===t.Km.TaxInvoice?a=>a.MENUCODE==S.MENUCODE&&a.ALTRATE==S.PRATE:a=>a.MENUCODE==S.MENUCODE&&a.BATCH==S.BATCH),void 0===b}}checkStockforApprovalQty(l){let S;return S=l.ALTUNIT===l.BASEUNIT?this._trnMainService.nullToZeroConverter(l.APPROVEDALTQTY):this._trnMainService.nullToZeroConverter(l.APPROVEDALTQTY)*this._trnMainService.nullToZeroConverter(l.ALTCONFACTOR),S>l.STOCK}calculateTotalQuantity(l,S=!1,b=!1){let a=0,n="ALTERNATEQUANTIY";return S&&(n="APPROVEDALTQTY"),a=l.ALTUNIT===l.BASEUNIT?this._trnMainService.nullToZeroConverter(l[n]):this._trnMainService.nullToZeroConverter(l[n])*this._trnMainService.nullToZeroConverter(l.ALTCONFACTOR),a}validateRequestQtyDoingTransferOut(l,S){let b=this.calculateTotalQuantity(l,!1,!0);if(b>l.RSTOCK)return this.alertService.info(`Input Quantity:${b} exceeds the request quantity :${l.RSTOCK} of ${l.ITEMDESC}... Please Check Your Entry.`),!1;let a=S.filter(n=>n.MCODE==l.MCODE).map(n=>n.Quantity).reduce((n,T)=>n+T,0);return!(a>l.RSTOCK&&(this.alertService.info(`Input Quantity:${a} exceeds the request quantity :${l.RSTOCK} of ${l.ITEMDESC}... Please Check Your Entry.`),1))}validateStockinReqApproval(l,S,b=!1){let a=this.calculateTotalQuantity(l,!0,!1);return!((!(l.PTYPE>=10||7==l.NATURETYPE)||a>l.ALTERNATEQUANTIY)&&(l.APPROVEDALTQTY>l.ALTERNATEQUANTIY?(this.alertService.info(`Approved Quantity:${l.APPROVEDALTQTY} exceeds the request quantity :${l.ALTERNATEQUANTIY} of ${l.ITEMDESC}... Please Check Your Entry.`),l.APPROVEDALTQTY=0,this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("approvedQty"+S).focus()},0)}),1):!b&&a>l.STOCK&&(this.alertService.info(`Approved Quantity:${a} (${l.APPROVEDALTQTY} ${l.BASEUNIT} * ${l.ALTCONFACTOR}) exceeds the available stock :${l.STOCK} \n                    of ${l.ITEMDESC}... Please Check Your Entry.`),l.APPROVEDALTQTY=0,this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("approvedQty"+S).focus()},0)}),1)))}validateCreditLimit(l,S,b){return l+S>=b}checkEmptyUnit(l){return!!l&&(this.alertService.error(`Unit of ${l.ITEMDESC} is missing, please enter the unit!`),!0)}validateDuplicateBarcode(l,S){return!(S&&S?.length>0&&S.filter(a=>a.BC===l.BC).length>0&&(this.alertService.info("Selected item/variant is already in the list."),1))}validateEmptySubLedger(l){if(l&&l.length>0){let S=l.filter(b=>1==b.HASSUBLEDGER)[0];if(S&&!S.SL_ACNAME)return this.alertService.info(`Sub Ledger can not be empty for Account :${S.ACNAME} `),!1}return!0}validateSalesOrderAdvancePayment(l){if(1===this.userSetting.EnableDeliveryDateInSOrder&&!l.DeliveryDate)return this.alertService.info("Delivery Date is not selected"),!1;if(1===this.userSetting.EnableAdvPaymentInSOrder&&"credit"!=l.TRNMODE){if(0==this._trnMainService.nullToZeroConverter(l.ADVANCE)&&"NEW"==l.Mode.toUpperCase())return!!confirm("ADVANCE AMOUNT IS EMPTY. DO YOU WANT TO PROCEED ANYWAY ?")&&(1==this.userSetting.EnableCusProfileInSOrder?(l.TRNMODE=null,l.TRNACName=null,l.TRNAC=null):(l.TRNMODE="credit",l.TRNACName=null,l.TRNAC=l.PARAC),!0);if(l.ADVANCE){let S;if(S=1==this.userSetting.EnableRoundoff?Math.round(this._trnMainService.nullToZeroConverter(l.ADVANCE)):l.ADVANCE,S>l.NETAMNT)return this.alertService.info("Advance Amount is greater than Net Amount"),!1;if(!l.TRNMODE)return this.alertService.info("Payment Mode is not selected"),!1;if(!l.TRNAC)return this.alertService.info("Account is not selected"),!1}}return!0}validateVariantProduct(l){if(l.VoucherType==t.Km.Purchase||l.VoucherType==t.Km.TaxInvoice||l.VoucherType==t.Km.DebitNote||l.VoucherType==t.Km.CreditNote||l.VoucherType==t.Km.Sales){let S="";if(l.ProdList?.length>0&&l.ProdList.forEach(b=>{1==b.HASVARIANT&&(!b.VARIANTLIST||null==b.VARIANTLIST||null==b.VARIANTLIST)&&(S+=" : "+b.ITEMDESC)}),S)return this.alertService.info(`Variant is not mapped in product${S} `),!1}return!0}validateEmptyACName(l){if(l&&l.length>0){let S=l.filter(b=>""==b.ACID||null==b.ACID);if(S&&S.length>0)return this.alertService.info("Account Name can not be empty."),!1}return!0}validateExportsales(l){return l?.AdditionalObj?.PAYMENTTERMS?l?.FCurrency?void 0:(this.alertService.info("Currency is not selected"),!0):(this.alertService.info("Payment Terms is not selected"),!0)}}return m.\u0275fac=function(l){return new(l||m)(u.LFG(s.e),u.LFG(R.c),u.LFG(M.V),u.LFG(j.R),u.LFG(e.gz),u.LFG(x.p),u.LFG(e.F0))},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac}),m})()},64657:(F,U,d)=>{d.d(U,{F:()=>t});var e=d(64537);let t=(()=>{class u{constructor(R){this.el=R,this.specialKeys=["Backspace","Tab","End","Home"]}onKeyDown(R){if(this.decimalPlacesRestriction){if(this.regex=new RegExp(`^\\d*\\.?\\d{0,${this.decimalPlacesRestriction}}$`,"g"),-1!==this.specialKeys.indexOf(R.key))return;let x=this.el.nativeElement.value.concat(R.key);x&&!String(x).match(this.regex)&&R.preventDefault()}}}return u.\u0275fac=function(R){return new(R||u)(e.Y36(e.SBq))},u.\u0275dir=e.lG2({type:u,selectors:[["","decimalPlacesRestriction",""]],hostBindings:function(R,M){1&R&&e.NdJ("keydown",function(x){return M.onKeyDown(x)})},inputs:{decimalPlacesRestriction:"decimalPlacesRestriction"}}),u})()},90994:(F,U,d)=>{d.d(U,{r:()=>t});var e=d(64537);let t=(()=>{class u{onKeyDown(R){this.OnlyWholeNumber&&"."==R.key&&"110"==R.keyCode&&R.preventDefault()}}return u.\u0275fac=function(R){return new(R||u)},u.\u0275dir=e.lG2({type:u,selectors:[["","OnlyWholeNumber",""]],hostBindings:function(R,M){1&R&&e.NdJ("keydown",function(x){return M.onKeyDown(x)})},inputs:{OnlyWholeNumber:"OnlyWholeNumber"}}),u})()},8630:(F,U,d)=>{d.d(U,{n:()=>s});var e=d(64537),t=d(67297),u=d(53074);let s=(()=>{class R{constructor(j,x,g,m){this.authService=j,this.el=x,this.renderer=g,this.masterService=m,this.disallowSalesRateChangeValue=!1}ngOnInit(){this.userSetting=this.authService.getSetting();let j=this.masterService.userProfile.userRights.find(x=>"AllowRateChangeInSO"==x.right);j&&0==j?.value&&(this.disallowSalesRateChangeValue=!0,this.renderer.setAttribute(this.el.nativeElement,"disabled","true"))}disallowSalesRateChange(){return this.disallowSalesRateChangeValue}}return R.\u0275fac=function(j){return new(j||R)(e.Y36(t.e),e.Y36(e.SBq),e.Y36(e.Qsj),e.Y36(u.P))},R.\u0275dir=e.lG2({type:R,selectors:[["","appSalesRateDisableFromUserProfile",""]],exportAs:["appSalesRateDisableFromUserProfile"]}),R})()},63688:(F,U,d)=>{d.d(U,{v:()=>t});var e=d(64537);let t=(()=>{class u{transform(R){return console.log("ya ta aaucha ni",R),R||(R=0),Number(R).toFixed(3)}}return u.\u0275fac=function(R){return new(R||u)},u.\u0275pipe=e.Yjl({name:"threeDigitNumber",type:u,pure:!0}),u})()},89952:(F,U,d)=>{d.d(U,{g:()=>t});var e=d(64537);let t=(()=>{class u{transform(R){return R||(R=0),Number(R).toFixed(2)}}return u.\u0275fac=function(R){return new(R||u)},u.\u0275pipe=e.Yjl({name:"twoDigitNumber",type:u,pure:!0}),u})()},77398:(F,U,d)=>{d.d(U,{e:()=>j});var e=d(42326),t=d(15613),u=d(64537),s=d(87584),R=d(53074),M=d(94534);let j=(()=>{class x{constructor(m,v,l,S){this._trnMainService=m,this.masterService=v,this.genericProductService=l,this.injector=S}transform(m,v,l){let S;return S="asset-purchase-invoice"===this._trnMainService.activeurlpath||"assets-openingstockentry"===this._trnMainService.activeurlpath?this.DisableInAssetProdInsert(m,v,l):this.DisableInProductInsert(m,v,l),S}DisableInProductInsert(m,v,l=!1){let S=this._trnMainService.TrnMainObj.ProdList[v],b=!1;switch(m){case"disableRateandDiscount":if(this.injector.get(t.P).indexOf(this._trnMainService.TrnMainObj.VoucherType)>=0){if(1===this._trnMainService.userSetting.EnableBatchWisePrice)return!0;let a=this.masterService.userProfile.userRights.find(n=>"AllowRateChangeInSO"==n.right);if(a&&(0==a?.value||1===this._trnMainService.TrnMainObj.ProdList[v].HASBATCH))return!0}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("QT")||"stock-adjustment"===this._trnMainService.activeurlpath||"add-stock-issue"===this._trnMainService.activeurlpath||1==this.masterService.userSetting.LinkProductionwithconsumption&&this.masterService.userSetting.Enableconsumtionbaseproductionrate&&"production-entry"==this._trnMainService.activeurlpath)return!0;if((0==this.masterService.userSetting.LinkProductionwithconsumption||!this.masterService.userSetting.Enableconsumtionbaseproductionrate)&&"production-entry"==this._trnMainService.activeurlpath)return!1;if(1==this._trnMainService.userSetting.EnableRateFromConsumption&&"production-entry"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this.disableProductDeleteAndGrid())return!0;if(("add-purchase-invoice"==this._trnMainService.activeurlpath||"goods-received-note"==this._trnMainService.activeurlpath)&&"NEW"==this._trnMainService.TrnMainObj.Mode){let a=this.masterService.userProfile.roleRights.find(n=>"ALLOWRATECHANGEINPI"==n.right);if(a&&0==this._trnMainService.disableRateOnGRNload&&0!=this._trnMainService.userSetting.PODELIVERYMODE&&1==this._trnMainService.userSetting.RATECHANGE_IN_POBASEPI&&1==a?.value)return!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&0==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&(2==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.EnableBatch)||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF?.length>0&&this._trnMainService.TrnMainObj.ProdList.filter(a=>a.MCODE)?.length>0||this.disablePurchaseFields_PI_GRN(m))return!0;if(!("VIEW"==S.rowMode||S.isDisabled||this.disableRAteDisandAmt()||1==this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this._trnMainService.activeurlpath||"stock-issue-approval"==this._trnMainService.activeurlpath||this._trnMainService.disableRateOnPOselect||("add-sales-invoice"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)&&this._trnMainService.TrnMainObj.REFORDBILL||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote||this._trnMainService.disableOnPerFormaSelect||this._trnMainService.disableRateOnGRNload||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||"self-billing"==this._trnMainService.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn))return!1;b=!0;break;case"disableBarcodeField":return!!(1==this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this._trnMainService.activeurlpath||"stock-issue-approval"==this._trnMainService.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||this._trnMainService.disableOnPerFormaSelect||this.disableProductDeleteAndGrid());case"disableItemDesc":if("EDIT"===this._trnMainService.TrnMainObj.ProdList[v].rowMode?.toUpperCase())return this._trnMainService.TrnMainObj.VoucherType!=e.Km.Purchase||"purchase-import"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.ProdList[v].TOTALOUTWARDSTOCK>0;if("stock-adjustment"===this._trnMainService.activeurlpath||"add-sales-invoice"==this._trnMainService.activeurlpath&&this._trnMainService.disableOnDCselect||S.isBarcodeOfPtypeSix||"VIEW"===S.rowMode||!0===this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this._trnMainService.activeurlpath||"stock-issue-approval"==this._trnMainService.activeurlpath||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||!0===this._trnMainService.disableOnPerFormaSelect||this._trnMainService.disableItemSelectOnPOselect||"StockSettlementEntry"==this._trnMainService.activeurlpath&&this._trnMainService.viewModeForStockSettle||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn)return!0;if(0===this._trnMainService.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)return!0;if(1===this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)return!0;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&(0!==this._trnMainService.userSetting.PODELIVERYMODE||0!==this._trnMainService.userSetting.ENABLE_GRN_IN_PI)&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0==this._trnMainService.userSetting.DisablePOReferenceRequired&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;if(0==this._trnMainService.userSetting.PODELIVERYMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_PI&&"add-purchase-invoice"==this._trnMainService.activeurlpath)return!0;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&0!==this._trnMainService.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0==this._trnMainService.userSetting.DisablePOReferenceRequired)return console.log("check check ?"),!0;if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF?.length>0&&this._trnMainService.TrnMainObj.ProdList.filter(a=>a.MCODE)?.length>0||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!=this._trnMainService.userSetting.IMPORTPOBILLMODE&&("purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI))return!0;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this._trnMainService.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;if(0==this._trnMainService.userSetting.IMPORTPOBILLMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;if(this._trnMainService.disableOnCreditSelect&&0!==this._trnMainService.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales))return console.log("disableitemdesc2"),!0;if(this._trnMainService.TrnMainObj.VoucherType!==e.Km.RequisitionApproval)return!!(this.disableProductDeleteAndGrid()||this._trnMainService.TrnMainObj.ProdList[v].ITEMDESC&&this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived))||!(this._trnMainService.TrnMainObj.VoucherType!==e.Km.BranchTransferOut||1!=this._trnMainService.userSetting.EnablePIReferenceInTransferOut&&2!=this._trnMainService.userSetting.EnablePIReferenceInTransferOut||!this._trnMainService.TrnMainObj.REFBILL);if(null!=this._trnMainService.TrnMainObj.REFORDBILL)return!0;break;case"disableGridForReqApproval":return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.REFORDBILL;case"disableBatch":if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&0==this.masterService.userSetting.EnableManualBatchinproduction)return!0;if(2==this._trnMainService.userSetting.EnableBatch&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN))return!1;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&(1==this._trnMainService.userSetting.EnablePIReferenceInTransferOut||2==this._trnMainService.userSetting.EnablePIReferenceInTransferOut)&&this._trnMainService.TrnMainObj.REFBILL||1==this._trnMainService.userSetting.EnableBatch&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)||(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan)&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO")||this.disableProductDeleteAndGrid())return!0;if(0===S.REQEXPDATE||null===S.REQEXPDATE||void 0===S.REQEXPDATE&&89!=this._trnMainService.TrnMainObj.VoucherType)return!1;break;case"disableConsumptionBatch":case"disableConsumptionRate":return!0;case"disableAltUnit":return console.log("prod",S),!(!("VIEW"===S.rowMode||S.isDisabled||1==this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"===this._trnMainService.activeurlpath||"stock-issue-approval"===this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||this._trnMainService.disableOnPerFormaSelect||"StockSettlementEntry"==this._trnMainService.activeurlpath&&this._trnMainService.viewModeForStockSettle||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan&&2==this._trnMainService.userSetting.EnablePartialSalesFromDeliveryChalan||"stock-adjustment"===this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&"EDIT"==S.rowMode&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF?.length>0&&this._trnMainService.TrnMainObj.ProdList.filter(a=>a.MCODE)?.length>0||this._trnMainService.disableOnCreditSelect&&0!==this._trnMainService.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)||0===this._trnMainService.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||"add-sales-invoice"==this._trnMainService.activeurlpath&&this._trnMainService.disableOnDCselect)&&(1===this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?(console.log("d1"),0):!(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this._trnMainService.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||1===this._trnMainService.TrnMainObj.ProdList[v].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.userSetting.EnableTelcomDevices||(this._trnMainService.TrnMainObj.ProdList[v].ALTUNIT||this._trnMainService.TrnMainObj.ProdList[v].ALTERNATEUNIT||this._trnMainService.TrnMainObj.ProdList[v].BASEUNIT)&&this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this.disablePurchaseFields_PI_GRN(m)||this.disableProductDeleteAndGrid()||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&(1==this._trnMainService.userSetting.EnablePIReferenceInTransferOut||2==this._trnMainService.userSetting.EnablePIReferenceInTransferOut)&&this._trnMainService.TrnMainObj.REFBILL)));case"disableAltQty":return!(!("VIEW"==S.rowMode||S.isDisabled||S.isBarcodeOfPtypeSix||1==this.masterService.disableQtyInStockIssueReturn||1==this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this._trnMainService.activeurlpath||"stock-issue-approval"==this._trnMainService.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice||this._trnMainService.disableOnPerFormaSelect||"StockSettlementEntry"==this._trnMainService.activeurlpath&&this._trnMainService.viewModeForStockSettle||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&"EDIT"==S.rowMode&&this._trnMainService.TrnMainObj.REFBILL&&1==this._trnMainService.userSetting.EnablePIReferenceInTransferOut||"stock-adjustment"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF?.length>0&&this._trnMainService.TrnMainObj.ProdList.filter(a=>a.MCODE)?.length>0||"add-sales-invoice"==this._trnMainService.activeurlpath&&this._trnMainService.disableOnDCselect||0===this._trnMainService.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&(1===this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&"edit"!=this._trnMainService.TrnMainObj.Mode?.toLocaleLowerCase()?(console.log("mode",this._trnMainService.TrnMainObj),0):!(this._trnMainService.disableOnCreditSelect&&1==this._trnMainService.userSetting.ENABLE_SOINTI&&1==this._trnMainService.TrnMainObj.LOADFULLFROMQT&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType!=e.Km.PerformaSalesInvoice)||this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval||1===this._trnMainService.TrnMainObj.ProdList[v].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.userSetting.EnableTelcomDevices||1==this.masterService.userSetting.EnableBomBaseConsumption&&this._trnMainService.TrnMainObj.ProdList[v].ALTERNATEQUANTIY&&this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&"EDIT"!=S.rowMode||this.disableProductDeleteAndGrid()||this.disablePurchaseFields_PI_GRN(m))));case"disableAltRate":return!("VIEW"!=S.rowMode&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&1===this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&"StockSettlementEntry"!=this._trnMainService.activeurlpath&&!this.disablePurchaseFields_PI_GRN(m)&&!this.disableProductDeleteAndGrid()));case"disableRequestQTY":return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval;case"disableSupplier":return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry;case"disableAprroveQty":return"VIEW"==S.rowMode;case"disableGridForReqApproval":return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.REFORDBILL;case"disableFCrate":if("VIEW"==this._trnMainService.TrnMainObj.Mode||this._trnMainService.disableRateOnPOselect||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!=this._trnMainService.userSetting.IMPORTPOBILLMODE&&("purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI)||0==this._trnMainService.TrnMainObj.DOFULLRETURN&&2==this._trnMainService.userSetting.IMPORTPOBILLMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&"goods-received-note-import"===this._trnMainService.activeurlpath)return!0;if(0==this._trnMainService.userSetting.IMPORTPOBILLMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;case"disableDiscountRate":if(this.disableRAteDisandAmt()||"VIEW"==S.rowMode||1==this._trnMainService.disableAllFieldinPurchase||1==S.isPurchaseOrder||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote||"add-purchase-invoice"==this._trnMainService.activeurlpath&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_PI&&this._trnMainService.TrnMainObj.REFORDBILL&&"NEW"==this._trnMainService.TrnMainObj.Mode||this._trnMainService.disableOnPerFormaSelect||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.masterService.userSetting.REFBILLCOMPULSORINDNOTE&&this._trnMainService.TrnMainObj.REFBILL)return!0;if(this.disableProductDeleteAndGrid())return!0;if("add-sales-invoice"==this._trnMainService.activeurlpath&&this._trnMainService.disableOnDCselect||0!=this._trnMainService.userSetting.IMPORTPOBILLMODE&&("purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&1==this._trnMainService.TrnMainObj.DOFULLRETURN))return!0;if(0==this._trnMainService.userSetting.IMPORTPOBILLMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived))return!0;break;case"disableDiscountAmount":if(this.disableRAteDisandAmt()||"VIEW"==S.rowMode||"NON-DISCOUNTABLE"==this._trnMainService.TrnMainObj.ProdList[v].DISMODE?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.PurchaseOrder||1==this._trnMainService.disableAllFieldinPurchase||1==S.isPurchaseOrder||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.masterService.userSetting.REFBILLCOMPULSORINDNOTE&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.SalesDeliveryList&&this._trnMainService.TrnMainObj.SalesDeliveryList.length>v&&"NON-DISCOUNTABLE"==this._trnMainService.TrnMainObj.SalesDeliveryList[v].DISMODE?.toUpperCase())return!0;if(this.disableProductDeleteAndGrid())return!0;if("add-sales-invoice"==this._trnMainService.activeurlpath&&this._trnMainService.disableOnDCselect||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!=this._trnMainService.userSetting.IMPORTPOBILLMODE&&("purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI))return!0;if(0==this._trnMainService.userSetting.IMPORTPOBILLMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)return!0;if(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived))return!0;break;case"disableDiscountRateImpPurchase":case"disableDiscountAmountImpPurchase":if(this.disableRAteDisandAmt()||"VIEW"==S.rowMode||1==this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem)return!0;break;case"disableMfgDate":return!!(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&1==this.masterService.userSetting.EnableManualBatchinproduction||2==this._trnMainService.userSetting.EnableBatch||"VIEW"==S.rowMode||S.isDisabled||S.isPurchaseOrder||"stock-issue-approval"==this._trnMainService.activeurlpath||this._trnMainService.disableOnGRNload||null!=S.BATCH&&1==S.REQEXPDATE&&5==this._trnMainService.TrnMainObj.VoucherType||7==this._trnMainService.TrnMainObj.VoucherType||0==S.REQEXPDATE&&(3==this._trnMainService.TrnMainObj.VoucherType||88==this._trnMainService.TrnMainObj.VoucherType||74==this._trnMainService.TrnMainObj.VoucherType||31==this._trnMainService.TrnMainObj.VoucherType||24==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType&&1==this.masterService.userSetting.ENABLEMANUALSALESRETURN))||!!this.disableProductDeleteAndGrid();case"disableExpDate":return!!(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&1==this.masterService.userSetting.EnableManualBatchinproduction||2==this._trnMainService.userSetting.EnableBatch||"VIEW"==S.rowMode||S.isDisabled||S.isPurchaseOrderItem||"stock-issue-approval"==this._trnMainService.activeurlpath||this._trnMainService.disableOnGRNload||null!=S.BATCH&&1==S.REQEXPDATE&&5==this._trnMainService.TrnMainObj.VoucherType||7==this._trnMainService.TrnMainObj.VoucherType||0==S.REQEXPDATE&&(3==this._trnMainService.TrnMainObj.VoucherType||88==this._trnMainService.TrnMainObj.VoucherType||74==this._trnMainService.TrnMainObj.VoucherType||31==this._trnMainService.TrnMainObj.VoucherType||24==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType&&1==this.masterService.userSetting.ENABLEMANUALSALESRETURN))||!!this.disableProductDeleteAndGrid();case"disableRowDelete":return("asset-purchase-invoice"!=this._trnMainService.activeurlpath||"VIEW"!=this._trnMainService.TrnMainObj.Mode)&&(!!("VIEW"==S.rowMode||"VIEW"==this._trnMainService.TrnMainObj.Mode||null==this._trnMainService.TrnMainObj.ProdList[v]?.MCODE&&1==this._trnMainService.TrnMainObj.ProdList.length||15==this._trnMainService.TrnMainObj.VoucherType&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"TI"==this._trnMainService.TrnMainObj.VoucherPrefix&&this._trnMainService.disableOnPerFormaSelect||this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_PI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase)&&1==this._trnMainService.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("PO")||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.REFORDBILL||(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase)&&this._trnMainService.TrnMainObj.ProdList[v].TOTALOUTWARDSTOCK>0&&0==this.masterService.userSetting.ENABLESINGLEBATCHMODE&&"EDIT"==this._trnMainService.TrnMainObj.Mode||"stock-adjustment"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||this.disableProductDeleteAndGrid())||3==this._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI);case"disableConsumptionRowDelete":if(2==this.masterService.userSetting.EnableBomBaseConsumption&&this._trnMainService.TrnMainObj.ProdList[v].disableRowDeleteInBomBase&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry)return!0;case"disableItemDescInMultipleConsumption":return!!(S.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||S.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN);case"disableDeleteRow":return"salesorder"==this.genericProductService.activeurlpath&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"VIEW"==this._trnMainService.TrnMainObj.Mode;case"disableOnView":return"VIEW"===this._trnMainService.TrnMainObj.Mode;case"disableQtyInTR":if("VIEW"==this._trnMainService.TrnMainObj.Mode)return!0;case"disableRemarks":case"disableOtherComments":return"VIEW"==this._trnMainService.TrnMainObj.Mode;case"disableECSAmount":return!("add-purchase-invoice"!=this._trnMainService.activeurlpath||!("GR"==this._trnMainService.TrnMainObj.VoucherAbbName||this._trnMainService.TrnMainObj.CHALANNO&&this._trnMainService.TrnMainObj.CHALANNO.startsWith("GR")))||(1==this._trnMainService.TrnMainObj.ProdList[v].HASECSCHARGE?1==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[v]?.HASECSRATE)&&"EDIT"==this._trnMainService.TrnMainObj.Mode||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[v].ECSRATE)>0&&"EDIT"!=this._trnMainService.TrnMainObj.Mode||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.masterService.userSetting.REFBILLCOMPULSORINDNOTE&&"EDIT"==this._trnMainService.TrnMainObj.Mode:!!(this._trnMainService.TrnMainObj.ProdList[v].ECSRATE>0||0==this._trnMainService.TrnMainObj.ProdList[v].HASECSCHARGE||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.masterService.userSetting.REFBILLCOMPULSORINDNOTE&&this._trnMainService.TrnMainObj.REFBILL))}return b}disableRAteDisandAmt(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0===this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN&&null!=this._trnMainService.TrnMainObj.REFBILL&&""!=this._trnMainService.TrnMainObj.REFBILL&&null!=this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn&&0===this._trnMainService.TrnMainObj.DOFULLRETURN||!!this.disableProductDeleteAndGrid()}DisableInAssetProdInsert(m,v,l=!1){let S=this._trnMainService.TrnMainObj.AssetsProdList[v];switch(m){case"disableAssetItemDesc":return"VIEW"===this._trnMainService.TrnMainObj.Mode||!!S.IsDepreciationDone;case"disableSubLedger":return"VIEW"===this._trnMainService.TrnMainObj.Mode||"EDIT"!==this._trnMainService.TrnMainObj.Mode&&"NEW"!==this._trnMainService.TrnMainObj.Mode||1!=S.HASSUBLEDGER}}disableProductDeleteAndGrid(){return 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)||0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)?!(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("QT")||(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan)&&(0==this._trnMainService.TrnMainObj.LOADFULLFROMQT||2==this._trnMainService.userSetting.ENABLE_SOINTI)&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO")||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0===this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0===this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN):!(this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder||1!=this._trnMainService.TrnMainObj.DOFULLRETURN||!this._trnMainService.TrnMainObj.REFORDBILL||!this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("QT"))}disablePurchaseFields_PI_GRN(m){if(["disableAltQty","disableAltUnit"].includes(m)){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL){if("purchase-import"!==this._trnMainService.activeurlpath&&0!==this._trnMainService.userSetting.PODELIVERYMODE&&(0===this._trnMainService.userSetting.AllowQtyExceedInPo&&1!==this._trnMainService.userSetting.ENABLE_GRN_IN_PI||1===this._trnMainService.userSetting.ENABLE_GRN_IN_PI))return!0;if("purchase-import"===this._trnMainService.activeurlpath&&0!==this._trnMainService.userSetting.IMPORTPOBILLMODE&&(0===this._trnMainService.userSetting.AllowQtyExceedInPo&&1!==this._trnMainService.userSetting.ENABLE_GRN_IN_PI||1===this._trnMainService.userSetting.ENABLE_GRN_IN_PI))return!0}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0===this._trnMainService.userSetting.AllowQtyExceedInPo&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL){if("goods-received-note-import"!==this._trnMainService.activeurlpath&&0!==this._trnMainService.userSetting.PODELIVERYMODE)return!0;if("goods-received-note-import"===this._trnMainService.activeurlpath&&0!==this._trnMainService.userSetting.IMPORTPOBILLMODE)return!0}return!1}return!(!["disableRateandDiscount","disableAltRate"].includes(m)||"purchase-import"!==this._trnMainService.activeurlpath&&"purchase-import-order"!==this._trnMainService.activeurlpath&&"goods-received-note-import"!==this._trnMainService.activeurlpath&&(0===this._trnMainService.userSetting.PODELIVERYMODE||!this._trnMainService.TrnMainObj.REFORDBILL||0!==this._trnMainService.userSetting.RATECHANGE_IN_POBASEPI||this._trnMainService.TrnMainObj.VoucherType!==e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.GoodsReceived))}}return x.\u0275fac=function(m){return new(m||x)(u.Y36(s.p,16),u.Y36(R.P,16),u.Y36(M.w,16),u.Y36(u.zs3,16))},x.\u0275pipe=u.Yjl({name:"disable",type:x,pure:!0}),x})()},84260:(F,U,d)=>{d.d(U,{R:()=>R});var e=d(42326),t=d(64537),u=d(87584),s=d(94534);let R=(()=>{class M{constructor(x,g){this._trnMainService=x,this.genericProductService=g}transform(x,g){return this.Hide(x,g)}Hide(x,g=!1){if("hideAddButton"===x)return!("VIEW"==this._trnMainService.TrnMainObj.Mode||"stock-adjustment"==this._trnMainService.activeurlpath||"StockSettlementEntry"==this._trnMainService.activeurlpath&&this._trnMainService.viewModeForStockSettle||"goods-received-note"==this._trnMainService.activeurlpath&&(2==this._trnMainService.userSetting.PODELIVERYMODE||1==this._trnMainService.userSetting.PODELIVERYMODE)&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL||("salesorder"==this.genericProductService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryReturn)&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"TI"==this._trnMainService.TrnMainObj.VoucherPrefix&&this._trnMainService.disableOnPerFormaSelect||"RQ"==this._trnMainService.TrnMainObj.VoucherPrefix&&"EDIT"==this._trnMainService.TrnMainObj.Mode&&10==this._trnMainService.TrnMainObj.STATUS||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&1==this._trnMainService.userSetting.LinkProductionwithconsumption&&"EDIT"==this._trnMainService.TrnMainObj.Mode||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"FROMREQUESITION"==this._trnMainService.TrnMainObj.tag&&this._trnMainService.TrnMainObj.REFBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&1==this._trnMainService.TrnMainObj.LOADFULLFROMQT||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.DELIVERYREF?.length>0&&this._trnMainService.TrnMainObj.ProdList.filter(m=>m.MCODE)?.length>0||this.hideProductAdd()||(this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesOrder||1!=this._trnMainService.TrnMainObj.DOFULLRETURN||!this._trnMainService.TrnMainObj.REFORDBILL||!this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("QT"))&&(82==this._trnMainService.TrnMainObj.VoucherType||90==this._trnMainService.TrnMainObj.VoucherType&&"supplier"==this._trnMainService.TrnMainObj.filterByInReqApproval||95==this._trnMainService.TrnMainObj.VoucherType||84==this._trnMainService.TrnMainObj.VoucherType||85==this._trnMainService.TrnMainObj.VoucherType||96==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.userSetting.ENABLE_GRN_IN_IMPORTPI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.REFORDBILL&&2==this._trnMainService.userSetting.PODELIVERYMODE&&1==this._trnMainService.userSetting.ENABLE_GRN_IN_PI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&("GR"==this._trnMainService.TrnMainObj.VoucherAbbName||this._trnMainService.TrnMainObj.CHALANNO&&this._trnMainService.TrnMainObj.CHALANNO.startsWith("GR"))))}hideProductAdd(){return!(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("QT")||(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&0==this._trnMainService.TrnMainObj.LOADFULLFROMQT||(this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||1!==this._trnMainService.TrnMainObj.DOFULLRETURN||1!=this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE)&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN||"EDIT"===this._trnMainService.TrnMainObj.Mode))}}return M.\u0275fac=function(x){return new(x||M)(t.Y36(u.p,16),t.Y36(s.w,16))},M.\u0275pipe=t.Yjl({name:"hide",type:M,pure:!0}),M})()},56529:(F,U,d)=>{d.d(U,{A:()=>s});var e=d(88692),t=d(64537),u=d(87584);let s=(()=>{class R{constructor(j){this._trnMainService=j}transform(j){if(console.log("value ma k aaucha",j),null==j||null==j||""==j)return"";let x=new Date(j);return 0==this._trnMainService.userSetting.enableDayWiseMfgEXPDate?x.toLocaleDateString("en-US",{month:"long",year:"numeric"}):(0,e.p6)(j,"MM/dd/yyyy","en-US")}}return R.\u0275fac=function(j){return new(j||R)(t.Y36(u.p,16))},R.\u0275pipe=t.Yjl({name:"monthYear",type:R,pure:!0}),R})()},94619:(F,U,d)=>{d.d(U,{m:()=>V});var e=d(64537),t=d(20092),u=d(53074),s=d(87584),R=d(67311),M=d(14970),j=d(88692),x=d(56529);function g(N,D){1&N&&(e.TgZ(0,"h5",17),e._uU(1,"Authorization"),e.qZA())}function m(N,D){1&N&&(e.TgZ(0,"h5",17),e._uU(1,"Expired Item List"),e.qZA())}function v(N,D){if(1&N){const E=e.EpF();e.TgZ(0,"div",18)(1,"label",19),e._uU(2,"Username :"),e.qZA(),e.TgZ(3,"div",20)(4,"input",21),e.NdJ("ngModelChange",function(i){e.CHM(E);const c=e.oxw(2);return e.KtG(c.AuthObj.username=i)})("keydown.enter",function(){e.CHM(E);const i=e.oxw(2);return e.KtG(i.focusToPassword())}),e.qZA()()()}if(2&N){const E=e.oxw(2);e.xp6(4),e.Q6J("ngModel",E.AuthObj.username)}}function l(N,D){if(1&N){const E=e.EpF();e.TgZ(0,"div",22)(1,"label",23),e._uU(2,"Password:"),e.qZA(),e.TgZ(3,"div",20)(4,"input",24),e.NdJ("ngModelChange",function(i){e.CHM(E);const c=e.oxw(2);return e.KtG(c.AuthObj.password=i)})("keydown.enter",function(){e.CHM(E);const i=e.oxw(2);return e.KtG(i.authConfirm())}),e.qZA()()()}if(2&N){const E=e.oxw(2);e.xp6(4),e.Q6J("ngModel",E.AuthObj.password)}}function S(N,D){1&N&&(e.TgZ(0,"th",33),e._uU(1,"Cost Rate"),e.qZA())}function b(N,D){1&N&&(e.TgZ(0,"th",33),e._uU(1,"Dis%"),e.qZA())}function a(N,D){1&N&&(e.TgZ(0,"th",33),e._uU(1,"Dis Amnt."),e.qZA())}function n(N,D){1&N&&(e.TgZ(0,"th",33),e._uU(1,"Expiry Date"),e.qZA())}function T(N,D){if(1&N&&(e.TgZ(0,"td",37),e._uU(1),e.ALo(2,"number"),e.qZA()),2&N){const E=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,E.PRATE,"1.2-2"))}}function p(N,D){if(1&N&&(e.TgZ(0,"td",37),e._uU(1),e.ALo(2,"number"),e.qZA()),2&N){const E=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,E.INDDISCOUNTRATE,"1.2-2"))}}function O(N,D){if(1&N&&(e.TgZ(0,"td",37),e._uU(1),e.ALo(2,"number"),e.qZA()),2&N){const E=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,E.INDDISCOUNT,"1.2-2"))}}function y(N,D){if(1&N&&(e.TgZ(0,"td",37),e._uU(1),e.ALo(2,"monthYear"),e.qZA()),2&N){const E=e.oxw().$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,E.EXPDATE))}}function _(N,D){if(1&N&&(e.TgZ(0,"tr")(1,"td",34),e._uU(2),e.qZA(),e.TgZ(3,"td",35),e._uU(4),e.qZA(),e.YNc(5,T,3,4,"td",36),e.YNc(6,p,3,4,"td",36),e.YNc(7,O,3,4,"td",36),e.YNc(8,y,3,3,"td",36),e.qZA()),2&N){const E=D.$implicit,C=D.index,i=e.oxw(4);e.xp6(2),e.Oqu(C+1),e.xp6(2),e.Oqu(E.ITEMDESC),e.xp6(1),e.Q6J("ngIf","showExpItemList"!=i.authorizeFor),e.xp6(1),e.Q6J("ngIf","discountCheck"==i.authorizeFor||"GblDiscountCheck"==i.authorizeFor),e.xp6(1),e.Q6J("ngIf","discountCheck"==i.authorizeFor||"GblDiscountCheck"==i.authorizeFor),e.xp6(1),e.Q6J("ngIf","showExpItemList"==i.authorizeFor)}}function I(N,D){if(1&N&&(e.TgZ(0,"div",13)(1,"label",26),e._uU(2,"Item Details: "),e.qZA(),e.TgZ(3,"table",27)(4,"thead")(5,"tr",28)(6,"th",29),e._uU(7,"S.n"),e.qZA(),e.TgZ(8,"th",30),e._uU(9,"Item Name"),e.qZA(),e.YNc(10,S,2,0,"th",31),e.YNc(11,b,2,0,"th",31),e.YNc(12,a,2,0,"th",31),e.YNc(13,n,2,0,"th",31),e.qZA()(),e.TgZ(14,"tbody"),e.YNc(15,_,9,6,"tr",32),e.qZA()()()),2&N){const E=e.oxw(3);e.xp6(10),e.Q6J("ngIf","showExpItemList"!=E.authorizeFor),e.xp6(1),e.Q6J("ngIf","discountCheck"==E.authorizeFor||"GblDiscountCheck"==E.authorizeFor),e.xp6(1),e.Q6J("ngIf","discountCheck"==E.authorizeFor||"GblDiscountCheck"==E.authorizeFor),e.xp6(1),e.Q6J("ngIf","showExpItemList"==E.authorizeFor),e.xp6(2),e.Q6J("ngForOf",E.itemList)}}function P(N,D){if(1&N&&(e.TgZ(0,"div"),e.YNc(1,I,16,5,"div",25),e.qZA()),2&N){const E=e.oxw(2);e.xp6(1),e.Q6J("ngIf",E.itemList&&E.itemList.length>0)}}function L(N,D){1&N&&(e.TgZ(0,"div",38)(1,"span",39)(2,"strong"),e._uU(3,"Note:"),e.qZA(),e._uU(4," Press confirm to save transaction."),e.qZA()())}function w(N,D){if(1&N){const E=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3),e.YNc(3,g,2,0,"h5",4),e.YNc(4,m,2,0,"h5",4),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("click",function(){e.CHM(E);const i=e.oxw();return e.KtG(i.closeDialog())}),e.TgZ(7,"span",7),e._uU(8,"\xd7"),e.qZA()()()(),e.TgZ(9,"div",8),e.YNc(10,v,5,1,"div",9),e.YNc(11,l,5,1,"div",10),e.YNc(12,P,2,1,"div",11),e.qZA(),e.TgZ(13,"div",12)(14,"div",13),e.YNc(15,L,5,0,"div",14),e.TgZ(16,"div",15)(17,"button",16),e.NdJ("click",function(){e.CHM(E);const i=e.oxw();return e.KtG(i.authConfirm())})("keydown.enter",function(){e.CHM(E);const i=e.oxw();return e.KtG(i.authConfirm())}),e._uU(18,"Confirm"),e.qZA()()()()()()}if(2&N){const E=e.oxw();e.xp6(3),e.Q6J("ngIf","showExpItemList"!=E.authorizeFor),e.xp6(1),e.Q6J("ngIf","showExpItemList"==E.authorizeFor),e.xp6(6),e.Q6J("ngIf","showExpItemList"!=E.authorizeFor),e.xp6(1),e.Q6J("ngIf","showExpItemList"!=E.authorizeFor),e.xp6(1),e.Q6J("ngIf",90!=E._trnMainService.TrnMainObj.VoucherType),e.xp6(3),e.Q6J("ngIf","showExpItemList"==E.authorizeFor)}}let V=(()=>{class N{constructor(E,C,i,c,r){this.fb=E,this.masterservice=C,this._trnMainService=i,this.alertService=c,this.spinnerService=r,this.isActive=!1,this.AuthObj={},this.onUserRightReceived=new e.vpe,this.onDiscountLimitReceived=new e.vpe,this.onRoleRightsReceived=new e.vpe,this.onCreditLimitReceived=new e.vpe,this.allowExpiredItemforSave=new e.vpe,this.itemList=[]}ngOnInit(){}closeDialog(){this.isActive=!1}show(E=[],C){this.isActive=!0,console.log("filter list in ",E,C),this.itemList=E,this.authorizeFor=C,setTimeout(()=>{document.getElementById("AuthUsername").focus()},500)}hide(){this.isActive=!1}authConfirm(){console.log("atuh obj",this.AuthObj),""!=this.AuthObj.username&&null!=this.AuthObj.username||"showExpItemList"==this.authorizeFor?""!=this.AuthObj.password&&null!=this.AuthObj.password||"showExpItemList"==this.authorizeFor?(this.spinnerService.show("showExpItemList"==this.authorizeFor?"Saving Data. Please Wait...":"Asking for Authorization. Please Wait.."),this.authCheckCreditLimit(),"prateCheck"==this.authorizeFor?this.masterservice.authorizeSalesBelowCRate(this.AuthObj).subscribe(E=>{this.spinnerService.hide(),"ok"==E.status&&this.onUserRightReceived.emit(E.result)},E=>{this.spinnerService.hide(),this.alertService.info(E)}):"discountCheck"==this.authorizeFor?(console.log("CHECK DISOCUNT LIMIT"),this.masterservice.authorizeDiscountLimitInSO(this.AuthObj).subscribe(E=>{this.spinnerService.hide(),"ok"==E.status&&this.onDiscountLimitReceived.emit(E.result)},E=>{this.spinnerService.hide(),this.alertService.info(E)})):"GblDiscountCheck"==this.authorizeFor?(console.log("CHECK DISOCUNT LIMIT"),this.masterservice.authorizeGblDiscountLimit(this.AuthObj).subscribe(E=>{this.spinnerService.hide(),"ok"==E.status&&this.onRoleRightsReceived.emit(E.result)},E=>{this.spinnerService.hide(),this.alertService.info(E)})):"ReqApproval"==this.authorizeFor?this.masterservice.authorizeApprovedQtyWLessStock(this.AuthObj).subscribe(E=>{this.spinnerService.hide(),"ok"==E.status&&this.onUserRightReceived.emit(E.result)},E=>{this.spinnerService.hide(),this.alertService.info(E)}):"showExpItemList"==this.authorizeFor&&(this.spinnerService.hide(),this.allowExpiredItemforSave.emit("ALLOWSAVE")),this.AuthObj.password="",this.AuthObj.username=""):this.alertService.warning("Please enter password !"):this.alertService.warning("Please enter username !")}focusToPassword(){setTimeout(()=>{document.getElementById("AuthPassword").focus()},500)}authCheckCreditLimit(){"AuthorizeCreditLimitCheck"==this.authorizeFor&&this.masterservice.AuthorizeCreditLimitCheck(this.AuthObj).subscribe(E=>{this.spinnerService.hide(),"ok"==E.status&&this.onCreditLimitReceived.emit(E.result)},E=>{this.spinnerService.hide(),this.alertService.info(E)})}}return N.\u0275fac=function(E){return new(E||N)(e.Y36(t.qu),e.Y36(u.P),e.Y36(s.p),e.Y36(R.c),e.Y36(M.V))},N.\u0275cmp=e.Xpm({type:N,selectors:[["authentication-entry"]],outputs:{onUserRightReceived:"onUserRightReceived",onDiscountLimitReceived:"onDiscountLimitReceived",onRoleRightsReceived:"onRoleRightsReceived",onCreditLimitReceived:"onCreditLimitReceived",allowExpiredItemforSave:"allowExpiredItemforSave"},decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],["class","page-title",4,"ngIf"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"card-body"],["class","form-group row","style","margin-top: 1rem;",4,"ngIf"],["class","form-group row",4,"ngIf"],[4,"ngIf"],[1,"card-footer"],[1,"row"],["class","col-9",4,"ngIf"],[1,"col"],["type","button",1,"btn","btn-info",2,"margin-left","50px !important",3,"click","keydown.enter"],[1,"page-title"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label"],[1,"col-md-8"],["id","AuthUsername","type","text","autocomplete","off",1,"form-control",3,"ngModel","ngModelChange","keydown.enter"],[1,"form-group","row"],[1,"col-md-3","form-control-label"],["id","AuthPassword","type","password","autocomplete","off",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange","keydown.enter"],["class","row",4,"ngIf"],[2,"font-size","12px","font-weight","bold","height","20px"],[1,"table","table-striped"],[2,"position","sticky","top","0","line-height","1rem"],["scope","col",2,"width","7%"],["scope","col",2,"width","50%"],["scope","col","style","width: 15%; text-align: right;",4,"ngIf"],[4,"ngFor","ngForOf"],["scope","col",2,"width","15%","text-align","right"],[2,"width","7%"],[2,"width","50%"],["style","width: 15%; text-align: right;",4,"ngIf"],[2,"width","15%","text-align","right"],[1,"col-9"],[2,"font-size","12px"]],template:function(E,C){1&E&&e.YNc(0,w,19,6,"div",0),2&E&&e.Q6J("ngIf",C.isActive)},dependencies:[j.sg,j.O5,t.Fj,t.JJ,t.On,j.JJ,x.A],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:40%;top:25%;left:60%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem;padding:5px}.card-header[_ngcontent-%COMP%]{padding:5px 3px;background:silver}.card-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:11vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}th[_ngcontent-%COMP%]{font-size:14px}td[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]{width:97.5%!important}"]}),N})()},32711:(F,U,d)=>{d.d(U,{ed:()=>V,im:()=>N});var e=d(64762),t=d(64537),u=d(68277),s=d(28049),R=d(54395),M=d(92340),j=d(54536),x=d(87584),g=d(88692),m=d(20092),v=d(72533);const l=["inputBox"];function S(i,c){if(1&i&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&i){const r=t.oxw().$implicit;t.xp6(1),t.Oqu(r.title)}}function b(i,c){if(1&i&&(t.ynx(0),t.YNc(1,S,2,1,"th",2),t.BQk()),2&i){const r=c.$implicit;t.xp6(1),t.Q6J("ngIf",!r.hidden)}}function a(i,c){1&i&&(t.TgZ(0,"th"),t._uU(1,"Action"),t.qZA())}function n(i,c){if(1&i&&(t.TgZ(0,"td")(1,"div",20),t._uU(2),t.qZA()()),2&i){const r=t.oxw().$implicit,h=t.oxw().$implicit;t.xp6(1),t.s9C("title",h[r.key]),t.xp6(1),t.hij(" ",h[r.key]," ")}}function T(i,c){if(1&i&&(t.ynx(0),t.YNc(1,n,3,2,"td",2),t.BQk()),2&i){const r=c.$implicit;t.xp6(1),t.Q6J("ngIf",!r.hidden)}}function p(i,c){if(1&i){const r=t.EpF();t.ynx(0),t.TgZ(1,"span")(2,"i",21),t.NdJ("click",function(){const f=t.CHM(r).$implicit,A=t.oxw(2).index,k=t.oxw(3);return t.KtG(k.onActionClicked(f.text,A))}),t.qZA()(),t.BQk()}if(2&i){const r=c.$implicit;t.xp6(2),t.Tol(r.icon),t.s9C("title",r.title)}}function O(i,c){if(1&i&&(t.ynx(0),t.TgZ(1,"td"),t.YNc(2,p,3,4,"ng-container",14),t.qZA(),t.BQk()),2&i){const r=t.oxw(4);t.xp6(2),t.Q6J("ngForOf",r.popupsettings.actionKeys)}}function y(i,c){if(1&i){const r=t.EpF();t.TgZ(0,"tr",19),t.NdJ("dblclick",function(){const f=t.CHM(r).$implicit,A=t.oxw(3);return t.KtG(A.doubleClick(f))})("click",function(){const f=t.CHM(r).index,A=t.oxw(3);return t.KtG(A.singleClick(f))}),t.YNc(1,T,2,1,"ng-container",14),t.YNc(2,O,3,1,"ng-container",2),t.qZA()}if(2&i){const r=c.index,h=t.oxw(3);t.ekj("selected-row",h.selectedRowIndex==r),t.xp6(1),t.Q6J("ngForOf",h.popupsettings.columns),t.xp6(1),t.Q6J("ngIf",h.popupsettings.showActionButton&&h.popupsettings.actionKeys.length)}}const _=function(i,c,r,h){return{id:i,itemsPerPage:c,currentPage:r,totalItems:h}};function I(i,c){if(1&i&&(t.TgZ(0,"tbody"),t.YNc(1,y,3,4,"tr",18),t.ALo(2,"paginate"),t.qZA()),2&i){const r=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",t.xi3(2,1,r.itemList,t.l5B(4,_,r.tabindex,r.pageSize,r.pageNumber,r.totalItems)))}}function P(i,c){if(1&i){const r=t.EpF();t.TgZ(0,"div",22)(1,"pagination-controls",23),t.NdJ("pageChange",function(o){t.CHM(r);const f=t.oxw(2);return t.KtG(f.onPageChange(o))}),t.qZA()()}if(2&i){const r=t.oxw(2);t.xp6(1),t.Q6J("id",r.tabindex)}}function L(i,c){if(1&i&&t._UZ(0,"div",24),2&i){const r=t.oxw(2);t.Q6J("innerHTML",r.summary,t.oJD)}}function w(i,c){if(1&i){const r=t.EpF();t.TgZ(0,"div")(1,"div")(2,"div",3)(3,"h4",4),t._uU(4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){t.CHM(r);const o=t.oxw();return t.KtG(o.hide())}),t.TgZ(6,"span",6),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"div",7)(9,"div",8),t._UZ(10,"input",9,10),t.qZA()(),t.TgZ(12,"div",11)(13,"table",12)(14,"thead")(15,"tr",13),t.YNc(16,b,2,1,"ng-container",14),t.YNc(17,a,2,0,"th",2),t.qZA()(),t.YNc(18,I,3,9,"tbody",2),t.qZA(),t.TgZ(19,"div",15),t.YNc(20,P,2,1,"div",16),t.qZA()()(),t.YNc(21,L,1,1,"div",17),t.qZA()}if(2&i){const r=t.oxw();t.xp6(4),t.hij(" ",r.popupsettings.title," "),t.xp6(6),t.Q6J("formControl",r.filterValue),t.xp6(6),t.Q6J("ngForOf",r.popupsettings.columns),t.xp6(1),t.Q6J("ngIf",r.popupsettings.showActionButton&&r.popupsettings.actionKeys.length),t.xp6(1),t.Q6J("ngIf",r.itemList.length),t.xp6(2),t.Q6J("ngIf",r.itemList.length),t.xp6(1),t.Q6J("ngIf",r.summary)}}class V extends u.nd{constructor(c,r,h){super(c),this.injector=c,this.dialog=r,this._trnMainService=h,this.requestUrl="",this.isActive=!1,this.itemList=[],this.selectedRowIndex=0,this.tabindex="list",this.hideGridOnDoubleClick=!0,this.billTo="",this.tag="",this.isForCancelOrder=!1,this.onPopUpClose=new t.vpe,this.onItemDoubleClick=new t.vpe,this.onDeleteClicked=new t.vpe}ngAfterViewInit(){this.filterValue.valueChanges.pipe((0,R.b)(500)).subscribe(c=>{this.refreshPage(),this.refresh()})}show(c="",r=!1,h="",o=!0){this.hideGridOnDoubleClick=o,setTimeout(()=>{this.inputBox.nativeElement.focus()},10),this.summary=null,this.billTo=c,this.isForCancelOrder=r,this.itemList=[],this.isActive=!0,this.selectedRowIndex=0,this.tag=h,setTimeout(()=>{this.setFilterOption(),this.refreshPage(),this.refresh()},100)}setFilterOption(){if(this.popupsettings&&this.popupsettings.columns.length){const c=this.popupsettings.defaultFilterIndex?this.popupsettings.defaultFilterIndex:0;if(this.popupsettings.columns.length<=c)return;this.filterValue.setValue(""),this.filterOption=this.popupsettings.columns[c].key}}getData(){this.summary=null,this.selectedRowIndex=0;let h=`${M.N.apiUrl}${this.popupsettings.apiEndpoints}?currentPage=${this.pageNumber}&maxResultCount=${this.pageSize}`;return this.billTo&&""!==this.billTo&&null!=this.billTo&&void 0!==this.billTo&&(h+=`&billTo=${this.billTo}`),this.tag&&""!==this.tag&&null!=this.tag&&void 0!==this.isTableLoading&&(h+=`&tag=${this.tag}`),this.isForCancelOrder&&(h+=`&isForCancelOrder=${this.isForCancelOrder}`),this.requestUrl=this.getFilterOption(h,1==this._trnMainService.userSetting.ProductSearchMode?1:0),this._http.get(this.requestUrl).pipe((0,s.P)()).subscribe(o=>{this.totalItems=o?o.totalCount:0,this.itemList=o?o.data:[],this.itemList.forEach(function(f){null!=f.TRNDATE&&void 0!==f.TRNDATE&&(f.TRNDATE=f.TRNDATE.toString().substring(0,10)),null!=f.DATE&&void 0!==f.DATE&&(f.DATE=f.DATE.toString().substring(0,10))}),this.itemList.length>0&&0===this.selectedRowIndex&&this.itemList[this.selectedRowIndex].itemSummary&&(this.summary=this.itemList[this.selectedRowIndex].itemSummary)})}hide(){this.itemList=[],this.pageNumber=1,this.totalItems=0,this.isActive=!1}triggerSearch(){null==this.filterOption||void 0===this.filterOption||""===this.filterOption||(this.filterValue.setValue(""),this.refreshPage(),this.refresh())}singleClick(c){this.selectedRowIndex=c,this.summary=this.itemList[c].itemSummary}doubleClick(c){this.onItemDoubleClick.emit(c),this.hideGridOnDoubleClick&&this.hide()}updown(c){if(!this.isActive)return!0;if("ArrowDown"===c.code)c.preventDefault(),this.selectedRowIndex++,null!=this.itemList[this.selectedRowIndex]&&(this.summary=this.itemList[this.selectedRowIndex].itemSummary),this.calculateTotalPages(),this.selectedRowIndex===this.itemList.length&&this.pageNumber<this.totalPages?(this.pageNumber=this.pageNumber+1,this.refresh(),this.selectedRowIndex=0,this.itemListClosed()):this.selectedRowIndex===this.itemList.length&&this.pageNumber===this.totalPages&&(this.selectedRowIndex=this.itemList.length-1);else if("ArrowUp"===c.code)c.preventDefault(),this.selectedRowIndex--,null!=this.itemList[this.selectedRowIndex]&&(this.summary=this.itemList[this.selectedRowIndex].itemSummary),-1===this.selectedRowIndex&&this.pageNumber>1?(this.pageNumber=this.pageNumber-1,this.refresh(),this.selectedRowIndex=this.itemList.length-1,this.itemListClosed()):-1===this.selectedRowIndex&&1===this.pageNumber&&(this.selectedRowIndex=0);else if(("Enter"===c.code||"NumpadEnter"===c.code)&&this.selectedRowIndex>=0&&this.selectedRowIndex<this.itemList.length)c.preventDefault(),"BARCODE"===this.filterOption||(this.onItemDoubleClick.emit(this.itemList[this.selectedRowIndex]),this.hide(),this.itemListClosed());else if("Escape"===c.code)c.preventDefault(),this.hide(),this.itemListClosed();else if("ArrowRight"===c.code){if(c.preventDefault(),this.calculateTotalPages(),this.pageNumber>=this.totalPages)return void(this.pageNumber=this.totalPages);this.selectedRowIndex=0,this.pageNumber=this.pageNumber+1,this.refresh()}else if("ArrowLeft"===c.code){if(c.preventDefault(),this.pageNumber<=1)return void(this.pageNumber=1);this.selectedRowIndex=0,this.pageNumber=this.pageNumber-1,this.refresh()}}itemListClosed(){this.onPopUpClose.emit()}ngOnChanges(c){this.popupsettings=c.popupsettings.currentValue}onActionClicked(c,r){if(""!==c&&null!=c&&void 0!==c){const h=c.toLowerCase();switch(h){case"delete":case"cancel":confirm(`Are you sure to ${h} this row ?.`)&&this.onDeleteClicked.emit(this.itemList[r])}}}}V.\u0275fac=function(c){return new(c||V)(t.Y36(t.zs3),t.Y36(j.uw),t.Y36(x.p))},V.\u0275cmp=t.Xpm({type:V,selectors:[["barcode-popup-grid"]],viewQuery:function(c,r){if(1&c&&t.Gf(l,5),2&c){let h;t.iGM(h=t.CRH())&&(r.inputBox=h.first)}},hostBindings:function(c,r){1&c&&t.NdJ("keydown",function(o){return r.updown(o)},!1,t.evT)},inputs:{popupsettings:"popupsettings",summary:"summary"},outputs:{onPopUpClose:"onPopUpClose",onItemDoubleClick:"onItemDoubleClick",onDeleteClicked:"onDeleteClicked"},features:[t.qOj,t.TTD],decls:3,vars:3,consts:[[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px"],[1,"modal-content","modal-content-main-area"],[4,"ngIf"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"padding-left","5px","font-size","1.2rem"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12",2,"margin","2px 0px","display","flex","padding-right","0px"],["type","text","placeholder","Enter keyword to search",2,"width","100%",3,"formControl"],["inputBox",""],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#7ed0ff"],[4,"ngFor","ngForOf"],[1,"row",2,"float","center","margin","4px 0px"],["class","col-md-12","style","width:100%;margin-top: -1.8rem;",4,"ngIf"],["style","margin-left: 25px; margin-top: -25px;\n        font-size: 12px;",3,"innerHTML",4,"ngIf"],["class","highlight","title","double click for detail view",3,"selected-row","dblclick","click",4,"ngFor","ngForOf"],["title","double click for detail view",1,"highlight",3,"dblclick","click"],[3,"title"],[3,"title","click"],[1,"col-md-12",2,"width","100%","margin-top","-1.8rem"],["maxSize","9","directionLinks","true","autoHide","true","responsive","true","previousLabel","Previous","nextLabel","Next","screenReaderPaginationLabel","Pagination","screenReaderPageLabel","page","screenReaderCurrentLabel","You're on page",2,"margin-left","6rem","margin-bottom","0","font-size","0.8rem",3,"id","pageChange"],[2,"margin-left","25px","margin-top","-25px","font-size","12px",3,"innerHTML"]],template:function(c,r){1&c&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,w,22,7,"div",2),t.qZA()()),2&c&&(t.ekj("modal-sticky-hide",!r.isActive),t.xp6(2),t.Q6J("ngIf",r.popupsettings))},dependencies:[g.sg,g.O5,m.Fj,m.JJ,m.oH,v.LS,v._s],styles:[".modal-content[_ngcontent-%COMP%] {\n      padding: 1px;\n      margin: 0px;\n      float: right;\n      width: 80% !important;\n    }\n  \n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n      background-color: #f3f5f4;\n      cursor: pointer;\n    }\n  \n    tr[_ngcontent-%COMP%] {\n      font-size: 11px;\n    }\n  \n    .selected-row[_ngcontent-%COMP%] {\n      background-color: #ced6d3 !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n      line-height: 18px !important;\n      padding: 5px 10px;\n      vertical-align: middle;\n    }\n  \n    .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n      line-height: 5px !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n      text-align: left !important;\n      padding: 0px 0px 0px 11px !important;\n    }\n  \n    .modal-content[_ngcontent-%COMP%] {\n      box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n  \n    .modal-content-main-area[_ngcontent-%COMP%] {\n      max-height: 100%;\n      height: 100%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .modal-content-summary-area[_ngcontent-%COMP%] {\n      max-height: 20%;\n      height: 20%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .ellipsis[_ngcontent-%COMP%] {\n      \n      white-space: nowrap;\n    }"]}),(0,e.gn)([function C(i){return function(c,r,h){const o=h.value,f=`__timeout__${r}`;return h.value=function(...A){clearTimeout(this[f]),this[f]=setTimeout(()=>o.apply(this,A),i)},h}}(10)],V.prototype,"updown",null);class N{constructor(){this.columns=[],this.defaultFilterIndex=0,this.showActionButton=!1,this.actionKeys=[]}}},88762:(F,U,d)=>{d.d(U,{B:()=>j});var e=d(64537),t=d(42326),u=d(67311),s=d(53074),R=d(87584),M=d(20092);let j=(()=>{class x{constructor(m,v,l){this.alertService=m,this.masterService=v,this._trnMainService=l,this.emitCloseBatch=new e.vpe,this.emitCreatedBatch=new e.vpe,this.batchName="",this.pLifeUnit="year",this.disableDate=!1,this.focusOut=!0,this.todayDate=(new Date).toISOString().split("T")[0]}ngOnInit(){}ngOnChanges(){this.disableDate=0==this._trnMainService.TrnMainObj.ProdList[this.activeIndex].REQEXPDATE}calculateExpDate(){if(this.pLifeValue<1&&(this.pLifeValue=1),this.mfgDate&&this.pLifeValue&&this.pLifeUnit){var m=new Date(this.mfgDate);new Date,"year"===this.pLifeUnit?m.setFullYear(m.getFullYear()+parseInt(this.pLifeValue)):"month"===this.pLifeUnit&&m.setMonth(m.getMonth()+parseInt(this.pLifeValue)),this.expDate=m.toISOString().split("T")[0]}}onResetClick(){this.batchName="",this.mfgDate="",this.pLifeValue=null,this.pLifeUnit="",this.expDate=""}onApplyClick(){if(!this.focusOut)return void(this.focusOut=!0);if(!this._trnMainService.TrnMainObj.ProdList.find(S=>S.BATCH==this.batchName)&&this.batchName&&this._trnMainService.TrnMainObj.ProdList.find(S=>S.BATCH?.toLowerCase()==this.batchName.toLowerCase()))return void this.alertService.info(`Batch${this.batchName} is already present in grid`);if(!this.batchName)return void this.alertService.warning("Batch Name cannot be Empty!!");if(!this.mfgDate&&!this.disableDate)return void this.alertService.warning("Manufactured Date cannot be Empty!!");if(!this.expDate&&!this.disableDate)return void this.alertService.warning("Expiry Date cannot be Empty!!");if(this.mfgDate&&this.expDate&&this.mfgDate==this.expDate)return void this.alertService.warning("Manufactured and Expiry date cannot be the same!!");let m={batchName:this.batchName,mfgDate:this.mfgDate,expDate:this.expDate};const v=this._trnMainService.TrnMainObj.ProdList[this.activeIndex],l=v?.MCODE;if(v&&l){const S=this._trnMainService.TrnMainObj.ProdList.some(b=>b!==v&&b.MCODE==l&&b.BATCH==this.batchName&&1==b.showPriceChangePopup);this._trnMainService.TrnMainObj.ProdList[this.activeIndex].showPriceChangePopup=!S}this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.ProdList[this.activeIndex].enableSalesPrice=!0),this.emitCreatedBatch.emit(m),this.emitCloseBatch.emit()}onBackClick(){this.emitCloseBatch.emit()}onEnteredBatch(){this.focusOut=!0,this.batchName&&this.masterService.http.get(`${this.masterService.apiUrl}/CheckEnteredBatch?mcode=${this._trnMainService.TrnMainObj.ProdList[this.activeIndex].MCODE}&batch=${this.batchName}`).subscribe(v=>{"ok"==v.status&&v.result&&v.result?.length>0&&(this.alertService.info("Batch has already been created!!"),this.batchName=null,this.focusOut=!1)})}}return x.\u0275fac=function(m){return new(m||x)(e.Y36(u.c),e.Y36(s.P),e.Y36(R.p))},x.\u0275cmp=e.Xpm({type:x,selectors:[["create-manual-batch-popup"]],inputs:{activeIndex:"activeIndex"},outputs:{emitCloseBatch:"closeBatchPopupEvent",emitCreatedBatch:"emitCreatedBatchEvent"},features:[e.TTD],decls:39,vars:11,consts:[[1,"backdrop"],["id","popup",1,"popup"],[1,"popup-content"],[1,"section1"],[1,"section2"],["type","text","name","batchname",3,"ngModel","ngModelChange","focusout"],["type","date","name","mfgdate",3,"ngModel","max","disabled","ngModelChange","change"],["type","number","name","plife",2,"width","30px","margin-right","1px",3,"ngModel","disabled","ngModelChange","change"],["name","plifeunit",2,"width","40px",3,"ngModel","disabled","ngModelChange","change"],["value","year"],["value","month"],["type","date","name","expdate",3,"ngModel","min","disabled","ngModelChange"],[1,"section3"],["id","applyBtn",1,"button",3,"click"],["id","resetBtn",1,"button",3,"click"],["id","backBtn",1,"button",3,"click"]],template:function(m,v){1&m&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Create Batch[NEW]"),e.qZA(),e.TgZ(5,"div",4)(6,"table")(7,"thead")(8,"tr")(9,"th"),e._uU(10,"Batch Name"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"MFG Date"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Product Life"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Exp Date"),e.qZA()()(),e.TgZ(17,"tbody")(18,"tr")(19,"td")(20,"input",5),e.NdJ("ngModelChange",function(S){return v.batchName=S})("focusout",function(){return v.onEnteredBatch()}),e.qZA()(),e.TgZ(21,"td")(22,"input",6),e.NdJ("ngModelChange",function(S){return v.mfgDate=S})("change",function(){return v.calculateExpDate()}),e.qZA()(),e.TgZ(23,"td")(24,"input",7),e.NdJ("ngModelChange",function(S){return v.pLifeValue=S})("change",function(){return v.calculateExpDate()}),e.qZA(),e.TgZ(25,"select",8),e.NdJ("ngModelChange",function(S){return v.pLifeUnit=S})("change",function(){return v.calculateExpDate()}),e.TgZ(26,"option",9),e._uU(27,"Y"),e.qZA(),e.TgZ(28,"option",10),e._uU(29,"M"),e.qZA()()(),e.TgZ(30,"td")(31,"input",11),e.NdJ("ngModelChange",function(S){return v.expDate=S}),e.qZA()()()()()(),e.TgZ(32,"div",12)(33,"button",13),e.NdJ("click",function(){return v.onApplyClick()}),e._uU(34,"APPLY"),e.qZA(),e.TgZ(35,"button",14),e.NdJ("click",function(){return v.onResetClick()}),e._uU(36,"RESET"),e.qZA(),e.TgZ(37,"button",15),e.NdJ("click",function(){return v.onBackClick()}),e._uU(38,"BACK"),e.qZA()()()()()),2&m&&(e.xp6(20),e.Q6J("ngModel",v.batchName),e.xp6(2),e.Q6J("ngModel",v.mfgDate)("max",v.todayDate)("disabled",v.disableDate),e.xp6(2),e.Q6J("ngModel",v.pLifeValue)("disabled",!v.mfgDate||v.disableDate),e.xp6(1),e.Q6J("ngModel",v.pLifeUnit)("disabled",!v.mfgDate||v.disableDate),e.xp6(6),e.Q6J("ngModel",v.expDate)("min",v.todayDate)("disabled",!v.mfgDate||v.disableDate))},dependencies:[M.YN,M.Kr,M.Fj,M.wV,M.EJ,M.JJ,M.On],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}.popup[_ngcontent-%COMP%]{position:fixed;top:50%;right:50%;transform:translate(50%,-50%);background-color:#fff;border:1px solid #ccc;box-shadow:0 0 10px #0000001a;z-index:99999}.section1[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:10px}.section2[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-collapse:collapse;background-color:#e5e7e8;margin:10px}.section2[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .section2[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}.section3[_ngcontent-%COMP%]{margin:20px;text-align:center}.button[_ngcontent-%COMP%]{margin:0 5px;padding:5px 15px;cursor:pointer;border:none;background-color:#007bff;color:#fff}"]}),x})()},87454:(F,U,d)=>{d.d(U,{t:()=>p});var e=d(64537),t=d(42326),u=d(67311),s=d(87584),R=d(67297),M=d(88692),j=d(20092),x=d(89952);function g(O,y){if(1&O&&(e.ynx(0),e.TgZ(1,"th",19),e._uU(2),e.qZA(),e.BQk()),2&O){const _=y.$implicit;e.xp6(2),e.Oqu(_)}}function m(O,y){if(1&O&&(e.TgZ(0,"option",26),e._uU(1),e.qZA()),2&O){const _=y.$implicit;e.Q6J("ngValue",_),e.xp6(1),e.hij(" ",_.NAME,"")}}function v(O,y){if(1&O){const _=e.EpF();e.TgZ(0,"select",24),e.NdJ("click",function(){e.CHM(_);const P=e.oxw(2).index,L=e.oxw(3);return e.KtG(L.SELECTEDINDEX=P)})("ngModelChange",function(P){e.CHM(_);const L=e.oxw().$implicit,w=e.oxw().$implicit;return e.KtG(w[L]=P)})("change",function(){e.CHM(_);const P=e.oxw().$implicit,L=e.oxw().index,w=e.oxw(3);return e.KtG(w.onAttributeChange(P,L))}),e.YNc(1,m,2,2,"option",25),e.qZA()}if(2&O){const _=e.oxw().$implicit,I=e.oxw(),P=I.index,L=I.$implicit,w=e.oxw(3);e.hYB("name","",_,"",P,"")("id","",_,"",P,""),e.Q6J("ngModel",L[_]),e.xp6(1),e.Q6J("ngForOf",w.getvariantValues(_))}}function l(O,y){if(1&O){const _=e.EpF();e.TgZ(0,"input",27),e.NdJ("keydown.Enter",function(){e.CHM(_);const P=e.oxw().$implicit,L=e.oxw().index,w=e.oxw(3);return e.KtG(w.onAttributeChange(P,L))})("change",function(){e.CHM(_);const P=e.oxw().$implicit,L=e.oxw().index,w=e.oxw(3);return e.KtG(w.onAttributeChange(P,L))})("click",function(){e.CHM(_);const P=e.oxw(2).index,L=e.oxw(3);return e.KtG(L.SELECTEDINDEX=P)})("ngModelChange",function(P){e.CHM(_);const L=e.oxw().$implicit,w=e.oxw().$implicit;return e.KtG(w[L]=P)})("keyup",function(){e.CHM(_);const P=e.oxw(5);return e.KtG(P.applyPipe=!1)})("focusout",function(){e.CHM(_);const P=e.oxw(5);return e.KtG(P.focusOut())})("keydown.Shift.delete",function(){e.CHM(_);const P=e.oxw(5);return e.KtG(P.deleteRow())}),e.ALo(1,"twoDigitNumber"),e.qZA()}if(2&O){const _=e.oxw().$implicit,I=e.oxw(),P=I.index,L=I.$implicit,w=e.oxw(3);e.hYB("name","",_,"",P,"")("id","",_,"",P,""),e.Q6J("ngModel",w.applyPipe?e.lcZ(1,5,L[_]):L[_])}}function S(O,y){if(1&O){const _=e.EpF();e.TgZ(0,"input",28),e.NdJ("change",function(){e.CHM(_);const P=e.oxw(2),L=P.index,w=P.$implicit,V=e.oxw(3);return e.KtG(V.validateBarcode(L,w))})("click",function(){e.CHM(_);const P=e.oxw(2).index,L=e.oxw(3);return e.KtG(L.SELECTEDINDEX=P)})("keydown.Enter",function(){e.CHM(_);const P=e.oxw(2),L=P.index,w=P.$implicit,V=e.oxw(3);return e.KtG(V.addRows(L,w))})("ngModelChange",function(P){e.CHM(_);const L=e.oxw().$implicit,w=e.oxw().$implicit;return e.KtG(w[L]=P)})("keydown.Shift.delete",function(){e.CHM(_);const P=e.oxw(5);return e.KtG(P.deleteRow())}),e.qZA()}if(2&O){const _=e.oxw().$implicit,I=e.oxw(),P=I.index,L=I.$implicit;e.hYB("name","",_,"",P,"")("id","",_,"",P,""),e.Q6J("ngModel",L[_])}}function b(O,y){if(1&O&&(e.ynx(0),e.TgZ(1,"td",19),e.YNc(2,v,2,6,"select",21),e.YNc(3,l,2,7,"input",22),e.YNc(4,S,1,5,"input",23),e.qZA(),e.BQk()),2&O){const _=y.$implicit,I=e.oxw(4);e.xp6(2),e.Q6J("ngIf",I.selectInputType(_,"select")),e.xp6(1),e.Q6J("ngIf",I.selectInputType(_,"input")&&"BARCODE"!=_),e.xp6(1),e.Q6J("ngIf","BARCODE"==_)}}function a(O,y){if(1&O){const _=e.EpF();e.TgZ(0,"tr",20),e.NdJ("click",function(){const L=e.CHM(_).index,w=e.oxw(3);return e.KtG(w.SELECTEDINDEX=L)}),e.YNc(1,b,5,3,"ng-container",16),e.qZA()}if(2&O){const _=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",_.keys)}}function n(O,y){if(1&O&&(e.TgZ(0,"div",12)(1,"table",13,14)(3,"thead")(4,"tr",15),e.YNc(5,g,3,1,"ng-container",16),e.qZA()(),e.TgZ(6,"tbody",17),e.YNc(7,a,2,1,"tr",18),e.qZA()()()),2&O){const _=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",_.headerKeys),e.xp6(2),e.Q6J("ngForOf",_.matrixItemRows)}}function T(O,y){if(1&O){const _=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.NdJ("click",function(){e.CHM(_);const P=e.oxw();return e.KtG(P.hide())}),e.TgZ(4,"span",5),e._uU(5,"\xd7"),e.qZA()(),e.TgZ(6,"h4",6),e._uU(7),e.qZA()(),e.YNc(8,n,8,2,"div",7),e.TgZ(9,"div",8)(10,"div")(11,"input",9),e.NdJ("ngModelChange",function(P){e.CHM(_);const L=e.oxw();return e.KtG(L.loadRate=P)})("change",function(P){e.CHM(_);const L=e.oxw();return e.KtG(L.onAutoFillRateClick(P))}),e.qZA(),e.TgZ(12,"span")(13,"b"),e._uU(14,"Load Old Rate"),e.qZA()()(),e.TgZ(15,"div")(16,"button",10),e.NdJ("click",function(){e.CHM(_);const P=e.oxw();return e.KtG(P.okClicked())}),e._uU(17,"Apply"),e.qZA(),e.TgZ(18,"button",11),e.NdJ("click",function(){e.CHM(_);const P=e.oxw();return e.KtG(P.hide())}),e._uU(19,"Cancel"),e.qZA()()()()()}if(2&O){const _=e.oxw();e.ekj("modal-sticky-hide",!_.isActive),e.xp6(7),e.hij(" ",_.itemname," "),e.xp6(1),e.Q6J("ngIf",_.matrixItemAtrribute&&_.matrixItemAtrribute.length),e.xp6(3),e.Q6J("ngModel",_.loadRate)}}let p=(()=>{class O{constructor(_,I,P){this.alertService=_,this._trnMainService=I,this.authservice=P,this.itemname="",this.productObj={},this.isActive=!1,this.keys=[],this.headerKeys=[],this.matrixItemRows=[],this.SELECTEDINDEX=0,this.applyPipe=!0,this.validation=!0,this.loadRate=!0,this.onApplyClicked=new e.vpe,this.addRows=(L,w)=>{if(this.validateVariantsForEachRow(L,w)){var V={};this.keys.forEach(D=>V[D]=null),this.matrixItemRows.push(V);var N=parseFloat(L)+1;this.SELECTEDINDEX=N,this.loadRate&&this.loadRateInitially(this.SELECTEDINDEX),setTimeout(()=>{this.onAttributeChange("NONE",N)},0)}},this.onAttributeChange=(L,w)=>{let V=this.keys.findIndex(E=>E==L),N=[];for(var D in N=V>-1?this.keys.slice(V+1):this.keys,N)if("SRATE"==N[D]&&this.calulateSRATE(),"BARCODE"==N[D]&&this.calculateMRP(),this.validateSRATEandPRATE(V),document.getElementById(N[D]+w))return void setTimeout(()=>{const E=document.getElementById(N[D]+w);E.focus(),E.select()},100)},this.getvariantValues=L=>{var w=this.matrixItemAtrribute.filter(V=>V.VARIANTNAME==L);return w.length?w[0].VARIANT_ATTRIBUTE_LIST:[]},this.selectInputType=(L,w)=>{if("input"===w&&["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(L)>-1||"select"===w&&-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(L))return!0},this.okClicked=()=>{this.matrixItemRows.forEach(L=>{null===L.PRATE&&(L.PRATE=0)}),this.removeInvalidRows(),this.validateVariants()&&(this.onApplyClicked.emit(this.matrixItemRows),console.log("ans",this.matrixItemRows),this.hide())},this.show=()=>{console.log("show"),this.isActive=!0,setTimeout(()=>{this.onAttributeChange("NONE",0)},0)},this.hide=()=>{this.matrixItemRows.filter(w=>null!=w.QTY&&""!=w.QTY),this.isActive=!1,this.matrixItemAtrribute=[],this.keys=[],this.matrixItemRows=[]},this.userSetting=P.getSetting()}ngOnChanges(_){this.matrixItemAtrribute=_.matrixItemAtrribute?.currentValue,this.keys=[],this.headerKeys=[],this.matrixItemAtrribute?.forEach(P=>{P.VARIANT_ATTRIBUTE_LIST=JSON.parse(P.VARIANT_ATTRIBUTE),this.keys.push(P.VARIANTNAME),this.headerKeys.push(P.VARIANTNAME)}),this.keys.push("QTY"),this.keys.push("PRATE"),this.keys.push("MRP"),this.keys.push("SRATE"),this.keys.push("BARCODE"),this.headerKeys.push("QTY"),this.headerKeys.push("PRATE"),this.headerKeys.push("SRATE(W/V)"),this.headerKeys.push("SRATE"),this.headerKeys.push("BARCODE"),this.matrixItemRows=[];var I={};this.keys.forEach(P=>I[P]=null),this.matrixItemRows.push(I),console.log("matric item rows",this.matrixItemRows,"matric item rows Obj",I),this.loadRate&&this.loadRateInitially(this.SELECTEDINDEX)}loadRateInitially(_){this.matrixItemRows[_].PRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]?.PRATE,this.matrixItemRows[_].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]?.MRP,this.calulateSRATE()}calulateSRATE(){this.matrixItemRows[this.SELECTEDINDEX].SRATE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]?.ISVAT?this.matrixItemRows[this.SELECTEDINDEX].MRP/this.userSetting.VatConRate:this.matrixItemRows[this.SELECTEDINDEX].MRP}calculateMRP(){this.matrixItemRows[this.SELECTEDINDEX].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this.matrixItemRows[this.SELECTEDINDEX].SRATE*this.userSetting.VatConRate:this.matrixItemRows[this.SELECTEDINDEX].SRATE}removeInvalidRows(){this.matrixItemRows=this.matrixItemRows.filter(_=>null!=_.PRATE&&null!=_.QTY&&null!=_.SRATE&&null!=_.MRP),console.log("filtered",this.matrixItemRows)}validateVariants(){for(var _ of this.matrixItemRows)if(0==_.QTY||null==_.QTY)return this.alertService.warning("Please enter quantity"),!1;let I=0;for(var P of(console.log("matrix",this.matrixItemRows),this.matrixItemRows))for(var L in P)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(L)&&(console.log("hmmm",L,P[L]),null==P[L]&&I++);return I>0?(this.alertService.warning("Please enter for all the variant attirbutes"),!1):!!this.validation||(this.validation=!0,!1)}validateVariantsForEachRow(_,I){if(null==this.matrixItemRows[_].QTY||0==this.matrixItemRows[_].QTY)return this.alertService.warning("Please enter quantity first!"),!1;let P=this.matrixItemRows[_],L=0;for(var w in P)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(w)&&null==P[w]&&L++;if(L>0)return this.alertService.warning("Please enter for all the variant attributes"),!1;if((this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase)&&1===this.userSetting.EnableBatchWisePrice){if(null==this.matrixItemRows[_].MRP||0==this.matrixItemRows[_].MRP)return this.alertService.warning("Please enter the MRP!!!"),!1;if(null==this.matrixItemRows[_].SRATE||0==this.matrixItemRows[_].SRATE)return this.alertService.warning("Please enter the Selling Rate!!!"),!1;if(this.dublicateBarcode(_,I))return!1}return!0}dublicateBarcode(_,I){for(let P=0;P<_;P++)return!(!I.BARCODE||this.matrixItemRows[P].BARCODE!=I.BARCODE||(this.alertService.info("Duplicate barcode detected! Please enter unique barcode."),I.BARCODE="",this.validation=!1,0))}deleteRow(){confirm("Are you sure u you want to delete the Row?")&&this.matrixItemRows.splice(this.SELECTEDINDEX,1)}focusOut(){this.applyPipe=!0}validateBarcode(_,I){if(I?.BARCODE?.length>13)return this.alertService.warning("Barcode cannot have more than 13 characters!"),I.BARCODE="",void(this.validation=!1);this.dublicateBarcode(_,I)}onAutoFillRateClick(_){this.loadRate=this.loadRate=!!_.target.checked}assignPRATEandMRP(_){"PRATE"==this.keys[_]&&(null==this.matrixItemRows[this.SELECTEDINDEX].PRATE||0==this.matrixItemRows[this.SELECTEDINDEX].PRATE)&&(this.matrixItemRows[this.SELECTEDINDEX].PRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE),"MRP"==this.keys[_]&&(null==this.matrixItemRows[this.SELECTEDINDEX].MRP||0==this.matrixItemRows[this.SELECTEDINDEX].MRP)&&(this.matrixItemRows[this.SELECTEDINDEX].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP)}validateSRATEandPRATE(_){("MRP"==this.keys[_]||"SRATE"==this.keys[_])&&this.matrixItemRows[this.SELECTEDINDEX].PRATE>this.matrixItemRows[this.SELECTEDINDEX].SRATE&&this.alertService.warning("Sales Rates should not be less than Purchase Rate!")}select(_,I){this.keys.findIndex(L=>L==I),setTimeout(()=>{_.target.select()},10)}}return O.\u0275fac=function(_){return new(_||O)(e.Y36(u.c),e.Y36(s.p),e.Y36(R.e))},O.\u0275cmp=e.Xpm({type:O,selectors:[["matrix-item-grid"]],inputs:{itemname:"itemname",matrixItemAtrribute:"matrixItemAtrribute",productObj:"productObj",activerowIndex:"activerowIndex"},outputs:{onApplyClicked:"onApplyClicked"},features:[e.TTD],decls:1,vars:1,consts:[["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;",3,"modal-sticky-hide",4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#ecad79"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],["class","modal-body","style","max-height: 63vh;overflow-y: auto;",4,"ngIf"],[1,"modal-footer"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"btn","btn-info","pull-right",3,"click"],[1,"btn","btn-info","pull-right",2,"margin-right","5px",3,"click"],[1,"modal-body",2,"max-height","63vh","overflow-y","auto"],["id","BlueHeaderResizableTable",1,"matrix-table",2,"font-size","12px","width","98%","overflow-x","auto"],["reportHtmlTable",""],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],[4,"ngFor","ngForOf"],[2,"width","fit-content"],["style","border: 1px solid #e6e6e6; max-height: 25px",3,"click",4,"ngFor","ngForOf"],["width","100px"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click"],[3,"name","id","ngModel","click","ngModelChange","change",4,"ngIf"],["type","number",3,"name","id","ngModel","keydown.Enter","change","click","ngModelChange","keyup","focusout","keydown.Shift.delete",4,"ngIf"],["type","text",3,"name","id","ngModel","change","click","keydown.Enter","ngModelChange","keydown.Shift.delete",4,"ngIf"],[3,"name","id","ngModel","click","ngModelChange","change"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],["type","number",3,"name","id","ngModel","keydown.Enter","change","click","ngModelChange","keyup","focusout","keydown.Shift.delete"],["type","text",3,"name","id","ngModel","change","click","keydown.Enter","ngModelChange","keydown.Shift.delete"]],template:function(_,I){1&_&&e.YNc(0,T,20,5,"div",0),2&_&&e.Q6J("ngIf",I.isActive)},dependencies:[M.sg,M.O5,j.YN,j.Kr,j.Fj,j.wV,j.Wl,j.EJ,j.JJ,j.On,x.g],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content-main-area[_ngcontent-%COMP%]{height:75vh!important}.modal-sticky[_ngcontent-%COMP%]{width:70vw im!important}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.modal-footer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:6px;font-size:14px}tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{background-color:#f3f5f4;cursor:pointer}tr[_ngcontent-%COMP%]{font-size:11px}.selected-row[_ngcontent-%COMP%]{background-color:#ced6d3!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{line-height:30px!important}.table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{line-height:5px!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important;padding:0 0 0 11px!important}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.modal-content-main-area[_ngcontent-%COMP%]{max-height:100%;height:100%;width:100%!important}.modal-content-summary-area[_ngcontent-%COMP%]{max-height:20%;height:20%;overflow:auto;overflow-x:hidden}.ellipsis[_ngcontent-%COMP%]{white-space:nowrap}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#CED6D3;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{height:30px;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   .borderdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15)}.matrix-table[_ngcontent-%COMP%]   .rowdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15);text-align:center}.matrix-table[_ngcontent-%COMP%]   .smalllabeldiv[_ngcontent-%COMP%]{height:16px}.matrix-table[_ngcontent-%COMP%]   .smallHeader[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0}.matrix-table[_ngcontent-%COMP%]   .scrolldiv[_ngcontent-%COMP%]{max-height:75px;padding-right:30px;overflow:auto;scrollbar-3dlight-color:#FFFFFF;scrollbar-arrow-color:#000000;scrollbar-base-color:#FF9999;scrollbar-darkshadow-color:#000000;scrollbar-face-color:#000000;scrollbar-highlight-color:#000000;scrollbar-shadow-color:#0033CC}.matrix-table[_ngcontent-%COMP%]   .multiboxspan[_ngcontent-%COMP%]{font-size:11px;font-weight:700;position:relative;float:left;display:block;margin:2px;border:1px solid silver;border-radius:5px;background-color:#fff0f5}.matrix-table[_ngcontent-%COMP%]   .smallBoldLabel[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0;float:left;color:#222}.matrix-table[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:77vh}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:95%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{flex:0 0 auto;width:calc(100% - .9em)}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{flex:1 1 auto;display:block;overflow-y:scroll}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{width:99.6%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;table-layout:fixed}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#deb887!important;color:#fff}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f2f2f2}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#fff}.matrix-table[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#222;width:auto}.matrix-table[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]{margin-bottom:1%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]{margin-top:10%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:600;font-size:15px;padding:0 5px}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{height:25px!important;padding:0 5px!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{overflow:hidden}"]}),O})()},64752:(F,U,d)=>{d.d(U,{JP:()=>w,_v:()=>L});var e=d(64762),t=d(64537),u=d(68277),s=d(53074),R=d(87584),M=d(7976),j=d(67311),x=d(88692),g=d(20092),m=d(72533);const v=["inputBox"];function l(D,E){if(1&D&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&D){const C=t.oxw().$implicit;t.xp6(1),t.Oqu(C.title)}}function S(D,E){if(1&D&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&D){const C=t.oxw().$implicit;t.xp6(1),t.Oqu(C.title)}}function b(D,E){if(1&D&&(t.ynx(0),t.YNc(1,l,2,1,"th",2),t.YNc(2,S,2,1,"th",2),t.BQk()),2&D){const C=E.$implicit;t.xp6(1),t.Q6J("ngIf",!C.hidden),t.xp6(1),t.Q6J("ngIf",!C.isInputRequired)}}function a(D,E){if(1&D&&(t.TgZ(0,"td")(1,"div",17),t._uU(2),t.qZA()()),2&D){const C=t.oxw().$implicit,i=t.oxw().$implicit;t.xp6(1),t.s9C("title",i[C.key]),t.xp6(1),t.hij(" ",i[C.key]," ")}}function n(D,E){if(1&D){const C=t.EpF();t.TgZ(0,"td")(1,"div",17)(2,"input",18,19),t.NdJ("keyup",function(c){t.CHM(C);const r=t.oxw(5);return t.KtG(r.onChangQuantity(c))})("ngModelChange",function(c){t.CHM(C);const r=t.oxw(2).$implicit;return t.KtG(r.qty=c)}),t.qZA()()()}if(2&D){const C=t.oxw().$implicit,i=t.oxw().$implicit;t.xp6(1),t.s9C("title",i[C.key]),t.xp6(1),t.Q6J("ngModel",i.qty)}}function T(D,E){if(1&D&&(t.ynx(0),t.YNc(1,a,3,2,"td",2),t.YNc(2,n,4,2,"td",2),t.BQk()),2&D){const C=E.$implicit;t.xp6(1),t.Q6J("ngIf",!C.hidden),t.xp6(1),t.Q6J("ngIf",!C.isInputRequired)}}function p(D,E){if(1&D){const C=t.EpF();t.TgZ(0,"tr",16),t.NdJ("dblclick",function(){const r=t.CHM(C).$implicit,h=t.oxw(3);return t.KtG(h.doubleClick(r))})("click",function(){const r=t.CHM(C).index,h=t.oxw(3);return t.KtG(h.singleClick(r))})("keydown.Enter",function(){const r=t.CHM(C).$implicit,h=t.oxw(3);return t.KtG(h.doubleClickEnter(r))}),t.YNc(1,T,3,2,"ng-container",11),t.qZA()}if(2&D){const C=E.index,i=t.oxw(3);t.ekj("selected-row",i.selectedRowIndex==C),t.xp6(1),t.Q6J("ngForOf",i.popupsettings.columns)}}const O=function(D,E,C,i){return{id:D,itemsPerPage:E,currentPage:C,totalItems:i}};function y(D,E){if(1&D&&(t.TgZ(0,"tbody"),t.YNc(1,p,2,3,"tr",15),t.ALo(2,"paginate"),t.qZA()),2&D){const C=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",t.xi3(2,1,C._trnMainService.mulitplePriceItemList,t.l5B(4,O,C.tabindex,C.pageSize,C.pageNumber,C.totalItems)))}}function _(D,E){if(1&D){const C=t.EpF();t.TgZ(0,"div",20)(1,"pagination-controls",21),t.NdJ("pageChange",function(c){t.CHM(C);const r=t.oxw(2);return t.KtG(r.onPageChange(c))}),t.qZA()()}if(2&D){const C=t.oxw(2);t.xp6(1),t.Q6J("id",C.tabindex)}}function I(D,E){if(1&D&&t._UZ(0,"div",22),2&D){const C=t.oxw(2);t.Q6J("innerHTML",C.summary,t.oJD)}}function P(D,E){if(1&D){const C=t.EpF();t.TgZ(0,"div")(1,"div")(2,"div",3)(3,"div",4),t._uU(4,"Price List"),t.qZA(),t.TgZ(5,"div",5)(6,"button",6),t.NdJ("click",function(){t.CHM(C);const c=t.oxw();return t.KtG(c.hide())}),t._uU(7,"CLOSE"),t.qZA(),t.TgZ(8,"button",7),t.NdJ("click",function(c){t.CHM(C);const r=t.oxw();return t.KtG(r.doubleClickEnter(c))}),t._uU(9,"SUBMIT"),t.qZA()()(),t._UZ(10,"div",8),t.TgZ(11,"div",9)(12,"table",10)(13,"thead")(14,"tr"),t.YNc(15,b,3,2,"ng-container",11),t.qZA()(),t.YNc(16,y,3,9,"tbody",2),t.qZA(),t.TgZ(17,"div",12),t.YNc(18,_,2,1,"div",13),t.qZA()()(),t.YNc(19,I,1,1,"div",14),t.qZA()}if(2&D){const C=t.oxw();t.xp6(15),t.Q6J("ngForOf",C.popupsettings.columns),t.xp6(1),t.Q6J("ngIf",C._trnMainService.mulitplePriceItemList.length),t.xp6(2),t.Q6J("ngIf",C._trnMainService.mulitplePriceItemList.length),t.xp6(1),t.Q6J("ngIf",C.summary)}}class L extends u.nd{constructor(E,C,i,c,r){super(E),this.injector=E,this.masterService=C,this._trnMainService=i,this.route=c,this.alertService=r,this.requestUrl="",this.isActive=!1,this.selectedRowIndex=0,this.tabindex="list",this.newItem="first",this.billTo="",this.isForCancelOrder=!1,this.onPopUpClose=new t.vpe,this.onItemDoubleClick=new t.vpe}show(E="",C=!1){1==this._trnMainService.customerEvent&&setTimeout(()=>{},500),this.summary=null,this.billTo=E,this.isForCancelOrder=C,this._trnMainService.mulitplePriceItemList=[],this.isActive=!0,this.selectedRowIndex=0,setTimeout(()=>{this.setFilterOption(),this.refreshPage(),this.refresh()},100)}changebatchModel(E){}setFilterOption(){if(this.popupsettings&&this.popupsettings.columns.length){let E=this.popupsettings.defaultFilterIndex?this.popupsettings.defaultFilterIndex:0;if(this.popupsettings.columns.length<=E)return;this.filterValue.setValue(this.popupsettings.useDefinefilterValue),this.filterOption=this.popupsettings.columns[E].key}}getData(){this.summary=null,this.selectedRowIndex=0;let C=`${this.apiUrl}${this.popupsettings.apiEndpoints}?currentPage=${this.pageNumber}&maxResultCount=${this.pageSize}`;return this.billTo&&""!=this.billTo&&null!=this.billTo&&null!=this.billTo&&(C+=`&billTo=${this.billTo}`),this.isForCancelOrder&&(C+=`&isForCancelOrder=${this.isForCancelOrder}`),this.requestUrl=this.getFilterOption(C,1==this._trnMainService.userSetting.ProductSearchMode?1:0),this._http.get(this.requestUrl).subscribe(i=>{this.totalItems=i?i.totalCount:0,this._trnMainService.mulitplePriceItemList=i?i.data:[],this._trnMainService.mulitplePriceItemList.forEach(function(c){null!=c.TRNDATE&&null!=c.TRNDATE&&(c.TRNDATE=c.TRNDATE.toString().substring(0,10)),null!=c.DATE&&null!=c.DATE&&(c.DATE=c.DATE.toString().substring(0,10))}),this._trnMainService.mulitplePriceItemList.length>0&&0==this.selectedRowIndex&&this._trnMainService.mulitplePriceItemList[this.selectedRowIndex].itemSummary&&(this.summary=this._trnMainService.mulitplePriceItemList[this.selectedRowIndex].itemSummary)})}hide(){this._trnMainService.mulitplePriceItemList=[],this.pageNumber=1,this.totalItems=0,this.isActive=!1}triggerQtyChange(){}triggerSearch(){null==this.filterOption||null==this.filterOption||""==this.filterOption||null==this.filterValue.value||null==this.filterValue.value||""==this.filterValue.value||(this.refreshPage(),this.refresh())}singleClick(E){this.selectedRowIndex=E,this.summary=this._trnMainService.mulitplePriceItemList[E].itemSummary}doubleClick(E){}onChangQuantity(E){null!=this._trnMainService.mulitplePriceItemList.filter(i=>this._trnMainService.nullToZeroConverter(i.qty)>this._trnMainService.nullToZeroConverter(i.stock))[0]&&this.alertService.info("Quantity Exceed the available stock")}doubleClickEnter(E){this.onItemDoubleClick.emit(E),this.hide()}updown(E){if(!this.isActive)return!0;if("ArrowDown"==E.code)E.preventDefault(),this.selectedRowIndex++,null!=this._trnMainService.mulitplePriceItemList[this.selectedRowIndex]&&(this.summary=this._trnMainService.mulitplePriceItemList[this.selectedRowIndex].itemSummary),this.calculateTotalPages(),this.selectedRowIndex==this._trnMainService.mulitplePriceItemList.length&&this.pageNumber<this.totalPages?(this.pageNumber=this.pageNumber+1,this.refresh(),this.selectedRowIndex=0,this.itemListClosed()):this.selectedRowIndex==this._trnMainService.mulitplePriceItemList.length&&this.pageNumber==this.totalPages&&(this.selectedRowIndex=this._trnMainService.mulitplePriceItemList.length-1);else if("ArrowUp"==E.code)E.preventDefault(),this.selectedRowIndex--,null!=this._trnMainService.mulitplePriceItemList[this.selectedRowIndex]&&(this.summary=this._trnMainService.mulitplePriceItemList[this.selectedRowIndex].itemSummary),-1==this.selectedRowIndex&&this.pageNumber>1?(this.pageNumber=this.pageNumber-1,this.refresh(),this.selectedRowIndex=this._trnMainService.mulitplePriceItemList.length-1,this.itemListClosed()):-1==this.selectedRowIndex&&1==this.pageNumber&&(this.selectedRowIndex=0);else if(("Enter"==E.code||"NumpadEnter"==E.code)&&this.selectedRowIndex>=0&&this.selectedRowIndex<this._trnMainService.mulitplePriceItemList.length)E.preventDefault(),"BARCODE"==this.filterOption||(this.onItemDoubleClick.emit(this._trnMainService.mulitplePriceItemList[this.selectedRowIndex]),this.hide(),this.itemListClosed());else if("Escape"==E.code&&"addsientry"!=this.route.snapshot.url[0].path)E.preventDefault(),this.hide(),this.itemListClosed();else if("ArrowRight"==E.code){if(E.preventDefault(),this.calculateTotalPages(),this.pageNumber>=this.totalPages)return void(this.pageNumber=this.totalPages);this.selectedRowIndex=0,this.pageNumber=this.pageNumber+1,this.refresh()}else if("ArrowLeft"==E.code){if(E.preventDefault(),this.pageNumber<=1)return void(this.pageNumber=1);this.selectedRowIndex=0,this.pageNumber=this.pageNumber-1,this.refresh()}}itemListClosed(){this.onPopUpClose.emit()}ngOnChanges(E){this.popupsettings=E.popupsettings.currentValue}}L.\u0275fac=function(E){return new(E||L)(t.Y36(t.zs3),t.Y36(s.P),t.Y36(R.p),t.Y36(M.gz),t.Y36(j.c))},L.\u0275cmp=t.Xpm({type:L,selectors:[["multiple-price-popup-grid"]],viewQuery:function(E,C){if(1&E&&t.Gf(v,5),2&E){let i;t.iGM(i=t.CRH())&&(C.inputBox=i.first)}},hostBindings:function(E,C){1&E&&t.NdJ("keydown",function(c){return C.updown(c)},!1,t.evT)},inputs:{popupsettings:"popupsettings",summary:"summary"},outputs:{onPopUpClose:"onPopUpClose",onItemDoubleClick:"onItemDoubleClick"},features:[t.qOj,t.TTD],decls:3,vars:3,consts:[[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area"],[4,"ngIf"],[1,"modal-header",2,"padding","0px"],[1,"title","h5",2,"margin-bottom","0","margin-left","8px"],[1,"header-button"],["type","button",1,"btn","btn-info","btn-sm",2,"margin-right","5px",3,"click"],["type","button",1,"btn","btn-info","btn-sm",3,"click"],[1,"row","clearfix"],[1,"col-md-12","table-scroll"],[1,"table"],[4,"ngFor","ngForOf"],[1,"row","clearfix",2,"float","center","margin","4px 0px"],["class","col-md-12","style","width:100%",4,"ngIf"],["style","margin-left: 25px ",3,"innerHTML",4,"ngIf"],["class","highlight","title","double click for detail view",3,"selected-row","dblclick","click","keydown.Enter",4,"ngFor","ngForOf"],["title","double click for detail view",1,"highlight",3,"dblclick","click","keydown.Enter"],[3,"title"],["type","number",2,"width","45%",3,"ngModel","keyup","ngModelChange"],["inputBox",""],[1,"col-md-12",2,"width","100%"],["maxSize","9","directionLinks","true","autoHide","true","responsive","true","previousLabel","Previous","nextLabel","Next","screenReaderPaginationLabel","Pagination","screenReaderPageLabel","page","screenReaderCurrentLabel","You're on page",3,"id","pageChange"],[2,"margin-left","25px",3,"innerHTML"]],template:function(E,C){1&E&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,P,20,4,"div",2),t.qZA()()),2&E&&(t.ekj("modal-sticky-hide",!C.isActive),t.xp6(2),t.Q6J("ngIf",C.popupsettings))},dependencies:[x.sg,x.O5,g.Fj,g.wV,g.JJ,g.On,m.LS,m._s],styles:[".modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    top: 47%;\n    transform: translate(-50%, -50%);\n    width: 70% !important;\n  }\n\n  .modal-header[_ngcontent-%COMP%] {\n    margin-top: 10px;\n  }\n\n  tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n    \n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 11px;\n    border-bottom: 2px solid #E6E6E6;\n    border-top: 2px solid #E6E6E6;\n    \n    color: black;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #ced6d3 !important;\n  }\n\n  .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n    border: 1px solid #e6e6e6;\n  }\n\n  .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 94%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    \n    white-space: nowrap;\n  }\n\n  .header-button[_ngcontent-%COMP%] {\n    margin-bottom: 10px;\n    margin-right: 10px;\n  }"]}),(0,e.gn)([function N(D){return function(E,C,i){const c=i.value,r=`__timeout__${C}`;return i.value=function(...h){clearTimeout(this[r]),this[r]=setTimeout(()=>c.apply(this,h),D)},i}}(10)],L.prototype,"updown",null);class w{constructor(){this.columns=[],this.defaultFilterIndex=0}}},15613:(F,U,d)=>{d.d(U,{P:()=>u});var e=d(64537),t=d(42326);const u=new e.OlP("SalesRate-disabled-voucherNumbers",{providedIn:"root",factory:()=>[t.Km.SalesOrder,t.Km.TaxInvoice,t.Km.Sales,t.Km.CreditNote,t.Km.Quotation,t.Km.PerformaSalesInvoice,t.Km.DeliveryChalan]})}}]);