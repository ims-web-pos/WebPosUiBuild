"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[2317],{92317:(Qi,B,d)=>{d.r(B),d.d(B,{SalesModule:()=>qi});var Y=d(34579),p=d(28698),S=d(87584),D=d(42326),W=d(92340),V=d(60716),w=d(94534),u=d(68328),x=d(91772),k=d(11192),b=d(40216),e=d(64537),f=d(53074),O=d(7976),P=d(67311),A=d(14970),I=d(67297),q=d(24029);const K=["genericGridSO"],X=["genericPerformaInvoiceGridSO"],z=["genericCancelSales"],$=["popupCustomerCreation"],ee=["genericGridMemberShip"],ie=["fileUploadPopup"],te=["genericGridsalesMan"],ne=["discountPopup"],re=["genericReverseInvoiceGridSO"],oe=["genericGridSalesManRoute"],ae=["genericGridCustomerListBySalesmanAndRoute"];function se(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div")(1,"voucher-sidebar-billdetail",29),e.NdJ("onMemberIDSearch",function(t){e.CHM(i);const n=e.oxw(2);return e.KtG(n.onClickMemberIDSearch(t))})("onMemberReferIDSearch",function(t){e.CHM(i);const n=e.oxw(2);return e.KtG(n.onClickMemberReferIDSearch(t))})("onClickSlider",function(){e.CHM(i);const t=e.oxw(2);return e.KtG(t.calculateMemberPointsForView())}),e.qZA()()}}function ce(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",30)(2,"span")(3,"b"),e._uU(4,"SO Qty:"),e.qZA(),e._uU(5),e.qZA()(),e.TgZ(6,"div",23)(7,"span")(8,"b"),e._uU(9,"Rate:"),e.qZA(),e._uU(10),e.ALo(11,"currency"),e.qZA()(),e.BQk()),2&o){const i=e.oxw(2);e.xp6(5),e.hij("\xa0",i._trnMainService.purchaseOrderQty," \xa0"),e.xp6(5),e.hij("\xa0",e.Dn7(11,2,i._trnMainService.purchaseOrderRate,"INR","Rs. ")," ")}}function le(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",17)(1,"div",18)(2,"div",19),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",19)(5,"label",20),e._uU(6),e.qZA(),e.YNc(7,se,2,0,"div",21),e.qZA(),e.TgZ(8,"div",22),e.YNc(9,ce,12,6,"ng-container",21),e.qZA(),e.TgZ(10,"div",23)(11,"voucher-master-action",24),e.NdJ("onLoadFromSOClickEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showLoadFromSOPopup(t))})("onLoadFromPerformaInvoiceClickEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showApprovedPreformaInvoicePopup(t))})("onLoadCancelSalesEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showSalesDayWise(t))})("onClickSalesMan",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickNewSalesman(t))})("onLoadFromReverseEntryEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showReverseVoucherInvoicePopup(t))})("onclickOnResetPopupEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onclickOnResetPopupEmit(t))})("onSaveSelfBilling",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onclickOnResetPopupEmit(t))})("deliveryChalanEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.deliveryChalanEmit(t))})("onFileUploadPopupEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showSalesInvoicePopup(t))}),e.qZA(),e.TgZ(12,"generic-popup-grid",9,25),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onSalesOrderSelect(t))}),e.qZA(),e.TgZ(14,"generic-popup-grid",9,26),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onPerformaInvoiceSelect(t))}),e.qZA(),e.TgZ(16,"generic-popup-grid",9,27),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onSalesCancelSelect(t))}),e.qZA(),e.TgZ(18,"generic-popup-grid",9,28),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onReverseEntrySelect(t))}),e.qZA()()()()}if(2&o){const i=e.oxw();e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(1),e.Q6J("ngIf","lite"!=i.AppMode),e.xp6(2),e.Q6J("ngIf",0!=i.userSetting.ENABLE_SOINTI&&i._trnMainService.TrnMainObj.REFORDBILL),e.xp6(2),e.Q6J("buttonShow",!1),e.xp6(1),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridPerformaInvoicePopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridcancelSalesPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridReverseEntryPopupSettings)}}function de(o,s){1&o&&(e.TgZ(0,"div",6),e._UZ(1,"discounts-insert"),e.qZA())}function he(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",31)(1,"div",32)(2,"trnmain-parameters-master",33),e.NdJ("onDblClickSOLoadInTI",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onDblClickSOLoadInTI(t))}),e.qZA()(),e.TgZ(3,"div",5),e.YNc(4,de,2,0,"div",34),e.qZA()()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(3),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling)}}function pe(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"productentry",35),e.NdJ("onClickItemSelectPopUp",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickPoReferenceProduct(t))}),e.qZA()}}function ue(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"productentryLite",35),e.NdJ("onClickItemSelectPopUp",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickPoReferenceProduct(t))}),e.qZA()}}function Se(o,s){1&o&&(e.TgZ(0,"div",36),e._UZ(1,"voucher-total-area"),e.qZA())}function Me(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"app-quantity-change-popup",37),e.NdJ("showProdListChange",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showProdListInTIfromDC=t)})("showChange",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showQuantityChangePopup=t)}),e.qZA()}if(2&o){const i=e.oxw();e.Q6J("showProdList",i.showProdListInTIfromDC)("show",i.showQuantityChangePopup)}}let G=(()=>{class o{constructor(i,r,t,n,a,l,h,c,v,H,C,_){this.masterService=i,this._trnMainService=r,this.route=t,this.alertService=n,this.loadingSerive=a,this.authservice=l,this.changeDetection=h,this.genericProductEntryService=c,this.itemKeyEventService=v,this.quantityChangeEventService=H,this.entryValidateService=C,this.salesService=_,this.showQuantityChangePopup=!1,this.showProdListInTIfromDC=!1,this.hideShow=!1,this.gridPopupSettingsForMember=new p.im,this.fileUploadPopupSettings=new b.s,this.gridPopupSettingsalesMan=new p.im,this.gridReverseEntryPopupSettings=new p.im,this.salesManList=[],this.routerMasterList=[],this.userProfile={},this.RouteList=[],this.CustomerList=[],this.applyReferValue=!1,this.gridPopupSettings=new p.im,this.gridPerformaInvoicePopupSettings=new p.im,this.gridcancelSalesPopupSettings=new p.im,this.gridPopupSettingsForSalesManRoute=new p.im,this.gridPopupSettingsForCustomerListBySalesmanAndRoute=new p.im,this.userProfile=l.getUserProfile(),this.userSetting=this.authservice.getSetting(),this.AppMode=W.N.appMode,"canceladdsientry"===this.route.snapshot.url[0].path?this._trnMainService.initialFormLoad(61):"add-sales-invoice"===this.route.snapshot.url[0].path?(this._trnMainService.initialFormLoad(14),this.getSalesManList()):"add-sales-invoice-wholesale"==this.route.snapshot.url[0].path?(this._trnMainService.initialFormLoad(14),this._trnMainService.TrnMainObj.SUBMENU="wholeSale",this._trnMainService.TrnMainObj.INVOICETYPE="wholeSale"):"self-billing"==this.route.snapshot.url[0].path?(this._trnMainService.initialFormLoad(14),this._trnMainService.TrnMainObj.SUBMENU="selfBilling",this._trnMainService.TrnMainObj.INVOICETYPE="selfBilling",this.setLoginDivisionName()):"abbreviated-sales-invoice"==this.route.snapshot.url[0].path&&this._trnMainService.initialFormLoad(1),this.userSetting.EnableUserWiseCreditSalesRights&&!this._trnMainService.checkUserRightsForCreditSales()&&(this._trnMainService.TrnMainObj.TRNMODE="cash"),this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME&&"cash"==this._trnMainService.TrnMainObj.TRNMODE&&(this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME,this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC),this.masterService.getSalesmanList().subscribe(m=>{this.salesManList.push(m)}),this.gridPopupSettings={title:"Sales Vouchers",apiEndpoints:"/getTrnMainPagedList/SO/tag",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TRNAC",title:"Trn. A/c",hidden:!1,noSearch:!1},{key:"PhiscalId",title:"Fiscal Year",hidden:!1,noSearch:!1}]};let Z=null;"add-sales-invoice-wholesale"==this._trnMainService.activeurlpath&&(Z="wholesale"),this.gridPerformaInvoicePopupSettings={title:"Approved Proforma Vouchers",apiEndpoints:`/getApprovedHOPerformaInvoicePagedList/${Z}`,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1},{key:"REFORDBILL",title:"Ref.Bill No.",hidden:!1,noSearch:!1},{key:"BILLTOTEL",title:"VAT NO.",hidden:!1,noSearch:!1}]},this.gridcancelSalesPopupSettings={title:"Sales Invoice ",apiEndpoints:"/getTrnMainDateWisePagedList/TI",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"BILL NO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"TRNMODE",title:"TYPE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.gridReverseEntryPopupSettings={title:"Reverse Entry VoucherList",apiEndpoints:"/getReverseEntryPagedList",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TRNAC",title:"Trn. A/c",hidden:!1,noSearch:!1},{key:"PhiscalId",title:"Fiscal Year",hidden:!1,noSearch:!1}]},this.route.queryParams.subscribe(m=>{"DRILL"!=m.mode&&("FROMSI"==m.mode?(this.masterService.TempTrnMainObj.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,this.masterService.TempTrnMainObj.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,this.masterService.TempTrnMainObj.VoucherType=D.Km.TaxInvoice,this._trnMainService.TrnMainObj=this.masterService.TempTrnMainObj,this.masterService.getCustomerIDFromCProfile(m.ID).subscribe(y=>{y.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=y[0].CUSTID),this._trnMainService.TrnMainObj.PARAC=m.ID})):m.voucher&&this.getSelectedPerformaInvoice(m.voucher))})}updown(i){"F10"==i.code&&this.calculateMemberPointsForView()}ngAfterContentChecked(){this.changeDetection.detectChanges()}getMemberShipList(){this.gridPopupSettingsForMember=this.masterService.getGenericGridPopUpSettings("MemberList")}onclickOnResetPopupEmit(i){console.log("event"),this.setLoginDivisionName()}getSalesManList(){this.gridPopupSettingsalesMan=this.masterService.getGenericGridPopUpSettings("SalesManList")}setLoginDivisionName(){this.masterService.getloginDivisionName().subscribe(i=>{console.log("get login divison ",i),"ok"==i.status&&(i.result?(this._trnMainService.TrnMainObj.BILLTO=i.result.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.result.ACID,this._trnMainService.TrnMainObj.PARAC=i.result.ACID,this._trnMainService.TrnMainObj.VATNO=i.result.VATNO,this._trnMainService.TrnMainObj.BILLTOTEL=i.result.VATNO,this._trnMainService.TrnMainObj.BILLTOADD=i.result.ADDRESS,this._trnMainService.TrnMainObj.TRNACName=i.result.ACNAME,this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.TRNMODE="credit","self-billing"==this._trnMainService.activeurlpath&&(this._trnMainService.TrnMainObj.RECEIVEBY=i.result.CUSTID)):this.alertService.warning("Please set default account for the current division."))},i=>{this.alertService.warning("Please set default account for the current division")})}onSalesManSelect(i){this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.SALESMAN=i.NAME,this._trnMainService.salesmanID=i.SALESMANID,this._trnMainService.salesmanName=i.NAME,this.getSalesManRouteList(),this.genericGridSalesManRoute.show()}onRouteSelect(i){this._trnMainService.doubleClick=!0,this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.ROUTE=i.RouteCode,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,this._trnMainService.getCustomerListRouteAndSalesmanWise(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE),this.getCustomerList(),this.genericGridCustomerListBySalesmanAndRoute.show()}onCustomerSelected(i){this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.BILLTOTEL=i.VATNO,this._trnMainService.TrnMainObj.BILLTOADD=i.ADDRESS,this._trnMainService.TrnMainObj.BILLTOMOB=i.MOBILE,this._trnMainService.TrnMainObj.TRNACName=i.ACNAME,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""===i.PMODE?"credit":i.PMODE}getSalesManRouteList(){this.gridPopupSettingsForSalesManRoute=this.masterService.getGenericGridSettintForSalemanRoute(this._trnMainService.TrnMainObj.SALESMANID)}getCustomerList(){this.gridPopupSettingsForCustomerListBySalesmanAndRoute=this.masterService.getGridSettingForCustomerBySalesmanRoute(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE),this.gridPopupSettingsForCustomerListBySalesmanAndRoute={title:"Customers",apiEndpoints:`/getPagedCustomerListBySalesmanAndRoute/${this._trnMainService.TrnMainObj.SALESMANID}/${this._trnMainService.TrnMainObj.ROUTE}`,defaultFilterIndex:this.userSetting.FilterIndexForCustomer,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ACCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}ngAfterViewInit(){1===this.userSetting.ENABLE_SALESMAN_ROUTE&&(this.getSalesManList(),this.genericGridsalesMan.show())}onClickNewSalesman(){1===this.userSetting.ENABLE_SALESMAN_ROUTE&&(this.getSalesManList(),this.genericGridsalesMan.show())}ngOnInit(){this.route.queryParams.subscribe(i=>{if(console.log("PARAM",i),"DRILL"==i.mode){let r=i.voucher,t=[];t=r.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(r,t[1],t[2]).subscribe(n=>{"ok"==n.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.Mode="VIEW",r.startsWith("TI")?(console.log("TI",r),this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="SALES TAX INVOICE",this._trnMainService.TrnMainObj.VoucherPrefix="TI"):r.startsWith("SI")&&(console.log("SI",r),this._trnMainService.TrnMainObj.VoucherType=1,this._trnMainService.pageHeading="Abbreviated tax Invoice",this._trnMainService.TrnMainObj.VoucherPrefix="SI"),this._trnMainService.TrnMainObj.TRNDATE=n.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.TRN_DATE=n.result.TRN_DATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList.forEach(a=>{0==a.ALTERNATEQUANTIY&&(a.ALTERNATEQUANTIY=a.AltQty),a.rowMode="VIEW"}),null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.ReCalculateBillWithNormal())},n=>{this.loadingSerive.hide(),this.alertService.error(n)})}}),this.setFileUploadHelper(),this.setProductEntryTable()}setFileUploadHelper(){this.fileUploadPopupSettings=Object.assign(new b.s,{title:"Sales Invoice",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Sales Invoice Sample"})}setProductEntryTable(){var i=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new V.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"350px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableItemDesc",t,n),focusTo:"ALTUNIT"},{field:"BATCH",header:"Batch",hidden:!1,isActiveColumnHeader:!0,inputType:"batch",headerNgStyle:{width:"80px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableBatch",t,n),onEnter:(t,n,a,l)=>{this.genericProductEntryService.BatchEnter(t,n,a,l)},onKeyPress:(t,n)=>{this.genericProductEntryService.onKeyDownBatch(t,n)}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"80px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltUnit",t,n),onEnter:(t,n,a,l)=>this.entryValidateService.AlternateUnitEnterEventClick(t,n,a,l)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},onChange:(t,n,a)=>this.QuantityChangeEvent_default(t,n,a),applyTwoDigitPipe:!1,disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltQty",t,n)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(t,n,a)=>this.mrpEnterEvent(t,n,a),onChange:(t,n,a,l)=>this.entryValidateService.MRPChangeEvent(t,n,a,l),focusTo:"ITEMDESC",disablePipe:(t,n)=>this.getColumnDisablePipe("disableRateandDiscount",t,n)},{field:"AMOUNT",header:"Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"DISCOUNT",header:"Total Disc",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onHover:t=>{this.genericProductEntryService.onHover(t)},displayOnHover:!0},{field:"VAT",header:"VAT",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"NETAMOUNT",header:"Net Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"EXPDATE",header:"Exp Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},applyTwoDigitPipe:!1},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=i,this.genericProductEntrySetting.voucherType=D.Km.PerformaSalesInvoice,this.genericProductEntrySetting.setRowItemFromSelectedItem=t=>this.SetRowItemFromSelectedItem(t),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(t,n=new Function)=>this.SetRowItemRate(t,n)}showGenericGrid(i){this.itemKeyEventService.ItemkeyEvent(i.index,i.event,()=>u.K.default,r=>u.K.default,()=>u.K.default,()=>u.K.default,()=>u.K.default)}getColumnDisablePipe(i,r,t){return i}SetRowItemFromSelectedItem(i){let r=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(r,i),this._trnMainService.assignPrateaAsRATE(r,i)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}mrpEnterEvent(i,r,t){this.entryValidateService.mrpEnterEvent(i,r,t,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}QuantityChangeEvent_default(i,r,t){this.quantityChangeEventService.QuantityChangeEvent(t)}SetRowItemRate(i,r){r()}getSalesmanRoute(i){}showLoadFromSOPopup(i){this.genericGridSO.show()}showApprovedPreformaInvoicePopup(i){this.genericPerformaInvoiceGridSO.show()}showSalesDayWise(i){this.genericCancelSales.show()}onPerformaInvoiceSelect(i){this.getSelectedPerformaInvoice(i.VCHRNO)}oncancelSalesSelect(i){}onMemberSelect(i){console.log("k aaucha eta scheme name ko lagi",i.SCHEMEID,i),this.applyReferValue?(this._trnMainService.TrnMainObj.REFERMEMBERNAME=i.FNAME,this._trnMainService.TrnMainObj.REFERMEMBERNO=i.MEMID,this._trnMainService.TrnMainObj.SCHEMENAME=i.SCHEMEID):(this._trnMainService.TrnMainObj.MEMBERNO=i.MEMID,this._trnMainService.TrnMainObj.MEMBERNAME=i.FNAME,this._trnMainService.TrnMainObj.SCHEMENAME=i.SCHEMEID)}onClickMemberReferIDSearch(i){this.applyReferValue=!0,this.getMemberShipList(),this.genericGridMemberShip.show()}getSelectedPerformaInvoice(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadHoPerformaInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"===r.status){this._trnMainService.callPipe=!this._trnMainService.callPipe,this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW";for(let t in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.TrnMainObj.ProdList[t].inputMode=!1,this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].RATEDISCOUNT)>0&&1==this.userSetting.EnableDiscountInAltUnit&&(this._trnMainService.TrnMainObj.ProdList[t].UNITDISCOUNTRATE=100*this._trnMainService.TrnMainObj.ProdList[t].RATEDISCOUNT/(this._trnMainService.TrnMainObj.ProdList[t].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[t].RATE*this._trnMainService.TrnMainObj.ProdList[t].ALTCONFACTOR));1==this.userSetting.enableAdditionalFlatDiscountsInSales&&(this._trnMainService.TrnMainObj.FLATDCAMNT=this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT?this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT:0),this._trnMainService.TrnMainObj.TRNACName=this._trnMainService.TrnMainObj.BILLTO,this._trnMainService.TrnMainObj.RECURREFBILL=this._trnMainService.TrnMainObj.REFBILL,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.PhiscalYearInfo.PhiscalID,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="SALES TAX INVOICE",this._trnMainService.TrnMainObj.TRNMODE="credit",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.disableOnPerFormaSelect=!0,null==this._trnMainService.TrnMainObj.PARAC&&(this._trnMainService.TrnMainObj.TRNMODE="cash",this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME?(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME,this._trnMainService.disableAccountInputField=!0):this.masterService.userSetting.CASHINHAND_AC?(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C"):(alert("'Default Cash' on database not found. Please Contact to Administrator for this!"),this._trnMainService.TrnMainObj.TRNACName="error..."))}},r=>{this.loadingSerive.hide()})}onSalesOrderSelect(i){this.masterService.loadSalesInvoiceFromSalesOrder(i.VCHRNO).subscribe(r=>{if("ok"===r.status){if(this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW",!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||void 0===this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.TransporterEway={},this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let n in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(n),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[n].PClist,n);let a=this._trnMainService.TrnMainObj.ProdList[n].ALTUNITObj;this._trnMainService.RealQuantitySet(n,null==a?1:a.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[n].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let h=0;this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,h=this._trnMainService.TrnMainObj.ProdList[n].PRATE}var t=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK<=0);this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK>0),this._trnMainService.ReCalculateBillWithNormal(),null!=t&&t.length>0&&this.alertService.error("Some Of the item have been excluded because of unavailable Stock")}},r=>{})}onItemDoubleClick(i){this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.loadSODataToSales(i.VCHRNO)}onSalesCancelSelect(i){this.loadTaxInvoiceForCancel(i.VCHRNO,i.DIVISION,i.PhiscalId)}onClickMemberIDSearch(i){this.getMemberShipList(),this.genericGridMemberShip.show()}loadTaxInvoiceForCancel(i,r,t){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.LoadTransaction(i,r,t).subscribe(n=>{if(this.loadingSerive.hide(),"ok"===n.status){this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherType=61,this._trnMainService.pageHeading="SALES TAX INVOICE [CANCEL]",this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let a in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.setAltunitDropDownForViewStock(a),this._trnMainService.getPricingOfItem(a,"",!0),this._trnMainService.TrnMainObj.ProdList[a].inputMode=!1}},n=>{this.loadingSerive.hide()})}getRouteListSalesmanWise(i){this.masterService.getRouteListBasedUponSalesman(i).subscribe(r=>{this.RouteList=r})}onClickCreateCustomer(){}onClickCustomerHide(){}DisplayCustomerProfile(i){!1===i&&this.popupCustomerCreation.show()}calculateMemberPointsForView(){this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length&&this.masterService.postMemberPointCalculation(this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result.pointsGained,this._trnMainService.TrnMainObj.TOTMEMPOINTS=i.result2)})}onClickPoReferenceProduct(i){i&&(this._trnMainService.purchaseOrderQty=i.ALTERNATEQTY,this._trnMainService.purchaseOrderRate=i.RATE)}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList.length>1&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE))}showReverseVoucherInvoicePopup(i){this.genericReverseInvoiceGridSO.show()}onReverseEntrySelect(i){this.getReverseInvoice(i.VCHRNO)}getReverseInvoice(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadReverseInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"===r.status){this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW";for(let t=0;t<this._trnMainService.TrnMainObj.ProdList.length;t++)this._trnMainService.TrnMainObj.ProdList[t].inputMode=!1;console.log("firstparac5"),this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC,this._trnMainService.TrnMainObj.TRNACName=this._trnMainService.TrnMainObj.BILLTO,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="SALES TAX INVOICE",this._trnMainService.TrnMainObj.TRNMODE="credit",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.disableOnPerFormaSelect=!0}},r=>{this.loadingSerive.hide()})}onDblClickSOLoadInTI(i){this._trnMainService.TrnMainObj.ViewList=[],this._trnMainService.loadDataForSalesInoviceFromSO(this._trnMainService.TrnMainObj.REFORDBILL,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,"SOINTI")}deliveryChalanEmit(i){this.showProdListInTIfromDC=!0,this._trnMainService.getDeliveryChalanProdDetails(i)}showSalesInvoicePopup(){null!=this._trnMainService.TrnMainObj.PARAC&&""!=this._trnMainService.TrnMainObj.PARAC?this.fileUploadPopup.show():this.alertService.warning("Please select the Account...")}fileUploadSuccess(i){if("ok"==i.status){this._trnMainService.TrnMainObj.ProdList=i.result,this._trnMainService.TrnMainObj.tag="FROMEXCEL";for(let r in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.setAltunitDropDownForView(r),this._trnMainService.TrnMainObj.ProdList[r].REALRATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[r].RATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[r].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[r].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[r].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[r].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[r].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[r].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[r].OtherDiscount=this._trnMainService.TrnMainObj.ProdList[r].INDODAMT;this._trnMainService.prePareVariantDescription(),this._trnMainService.ReCalculateBillWithNormal(),this.loadingSerive.hide()}else this.loadingSerive.hide(),this.alertService.error(i.result.error)}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e),e.Y36(e.sBO),e.Y36(w.w),e.Y36(u.X),e.Y36(x.s),e.Y36(k.C),e.Y36(q.M))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-sales-invoice"]],viewQuery:function(i,r){if(1&i&&(e.Gf(K,5),e.Gf(X,5),e.Gf(z,5),e.Gf($,5),e.Gf(ee,5),e.Gf(ie,5),e.Gf(te,5),e.Gf(ne,5),e.Gf(re,5),e.Gf(oe,5),e.Gf(ae,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericPerformaInvoiceGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericCancelSales=t.first),e.iGM(t=e.CRH())&&(r.popupCustomerCreation=t.first),e.iGM(t=e.CRH())&&(r.genericGridMemberShip=t.first),e.iGM(t=e.CRH())&&(r.fileUploadPopup=t.first),e.iGM(t=e.CRH())&&(r.genericGridsalesMan=t.first),e.iGM(t=e.CRH())&&(r.discountPopup=t.first),e.iGM(t=e.CRH())&&(r.genericReverseInvoiceGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericGridSalesManRoute=t.first),e.iGM(t=e.CRH())&&(r.genericGridCustomerListBySalesmanAndRoute=t.first)}},hostBindings:function(i,r){1&i&&e.NdJ("keydown",function(n){return r.updown(n)},!1,e.evT)},features:[e._Bn([S.p,k.C,u.X,w.w,x.s])],decls:21,vars:11,consts:[[1,"sectionWrapper"],[1,"topWrapper"],["class","sticky-top","style","padding-bottom: 1px;",4,"ngIf"],["class","main-container",4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"onClickItemSelectPopUp",4,"ngIf"],["class","footer-wrapper",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridMemberShip",""],["genericGridsalesMan",""],["genericGridSalesManRoute",""],["genericGridCustomerListBySalesmanAndRoute",""],[3,"showProdList","show","showProdListChange","showChange",4,"ngIf"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""],[1,"sticky-top",2,"padding-bottom","1px"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[4,"ngIf"],[1,"col-md-1","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic","padding-left","0px","padding-right","0px"],[1,"col-md-7","pd0"],[3,"buttonShow","onLoadFromSOClickEmit","onLoadFromPerformaInvoiceClickEmit","onLoadCancelSalesEmit","onClickSalesMan","onLoadFromReverseEntryEmit","onclickOnResetPopupEmit","onSaveSelfBilling","deliveryChalanEmit","onFileUploadPopupEmit"],["genericGridSO",""],["genericPerformaInvoiceGridSO",""],["genericCancelSales",""],["genericReverseInvoiceGridSO",""],[3,"onMemberIDSearch","onMemberReferIDSearch","onClickSlider"],[1,"col-md-5","pd0"],[1,"main-container"],[3,"hidden"],["viewDisable","disableView",3,"onDblClickSOLoadInTI"],["class","col-md-12 pd5",4,"ngIf"],[3,"onClickItemSelectPopUp"],[1,"footer-wrapper"],[3,"showProdList","show","showProdListChange","showChange"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,le,20,9,"div",2),e.YNc(3,he,5,2,"div",3),e.qZA(),e.TgZ(4,"div",4)(5,"div",5)(6,"div",6),e.YNc(7,pe,1,0,"productentry",7),e.YNc(8,ue,1,0,"productentryLite",7),e.qZA()()(),e.YNc(9,Se,2,0,"div",8),e.qZA(),e.TgZ(10,"generic-popup-grid",9,10),e.NdJ("onItemDoubleClick",function(n){return r.onMemberSelect(n)}),e.qZA(),e.TgZ(12,"generic-popup-grid",9,11),e.NdJ("onItemDoubleClick",function(n){return r.onSalesManSelect(n)}),e.qZA(),e.TgZ(14,"generic-popup-grid",9,12),e.NdJ("onItemDoubleClick",function(n){return r.onRouteSelect(n)}),e.qZA(),e.TgZ(16,"generic-popup-grid",9,13),e.NdJ("onItemDoubleClick",function(n){return r.onCustomerSelected(n)}),e.qZA(),e.YNc(18,Me,1,2,"app-quantity-change-popup",14),e.TgZ(19,"file-uploader-popup",15,16),e.NdJ("onUploaded",function(n){return r.fileUploadSuccess(n)}),e.qZA()),2&i&&(e.xp6(2),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(4),e.Q6J("ngIf","pro"==r._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf","lite"==r._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("popupsettings",r.gridPopupSettingsForMember),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsalesMan),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForSalesManRoute),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForCustomerListBySalesmanAndRoute),e.xp6(2),e.Q6J("ngIf",r.showQuantityChangePopup||r.showProdListInTIfromDC),e.xp6(1),e.Q6J("popupsettings",r.fileUploadPopupSettings))},styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}.card[_ngcontent-%COMP%]{height:15rem;border:2px solid slategray}.confirmation-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:55%;top:33%;left:26%}",".table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n    text-align: left;\n    vertical-align: middle;\n  }\n\n  .card[_ngcontent-%COMP%] {\n    height: 30rem;\n    border: 2px solid slategray;\n  }"]}),o})();var T=d(82661),M=d(88692),E=d(53704),j=d(66582),N=d(68527),L=d(58349),R=d(78159),U=d(3047),F=d(54471),Q=d(32635);const ve=["fileUploadPopup"],ge=["genericGridMemberShip"];function _e(o,s){1&o&&(e.TgZ(0,"div",15),e._UZ(1,"discounts-insert"),e.qZA())}function me(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"productentry",20),e.NdJ("onClickItemSelectPopUp",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickPoReferenceProduct(t))}),e.qZA()}}function Te(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"productentryLite",20),e.NdJ("onClickItemSelectPopUp",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickPoReferenceProduct(t))}),e.qZA()}}let fe=(()=>{class o{constructor(i,r,t,n,a,l){this.masterService=i,this._trnMainService=r,this.route=t,this.authService=n,this.loadingSerive=a,this.alertService=l,this.fileUploadPopupSettings=new b.s,this.gridPopupSettingsForMember=new p.im,this.applyReferValue=!1,this.userProfile=n.getUserProfile(),"add-creditnote-itembase"===this.route.snapshot.url[0].path?(this._trnMainService.initialFormLoad(15),this._trnMainService.pageHeading="CREDIT NOTE (SALES RETURN)",this.userSetting=this.authService.getSetting()):"add-creditnote-itembase-approval"===this.route.snapshot.url[0].path&&(this._trnMainService.initialFormLoad(15),this._trnMainService.pageHeading="CREDIT NOTE (SALES RETURN) Approval",this.userSetting=this.authService.getSetting());try{this.route.queryParams.subscribe(h=>{if("DRILL"!=h.mode){if(h.voucher){let c=h.voucher,v=h.fromcompanyid;console.log("HO case fro alert mesage check",c,v),this.getSalesReturnInvoiceFromDistributor(c,v),this._trnMainService.fromNotification=h.fromNotification}h.status&&1==h.status&&(this._trnMainService.showPerformaApproveReject=!1)}})}catch(h){alert(h)}}updown(i){"F10"==i.code&&this.calculateMemberPointsForView()}ngOnInit(){this.route.queryParams.subscribe(i=>{if("DRILL"==i.mode){let r=i.voucher,t=[];t=r.split("-"),console.log("Drill case for Credit Note",r,t),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(r,t[1],t[2]).subscribe(n=>{console.log("what is the response here",n),"ok"==n.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.VoucherType=15,this._trnMainService.pageHeading="Credit Note",this._trnMainService.TrnMainObj.VoucherPrefix="CN",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.TrnMainObj.ProdList.forEach(a=>{0==a.ALTERNATEQUANTIY&&(a.ALTERNATEQUANTIY=a.ALTQTY_IN),a.rowMode="VIEW"}),null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.ReCalculateBillWithNormal())},n=>{this.loadingSerive.hide(),this.alertService.error(n)})}else i.voucher&&this.getSalesReturnInvoiceFromDistributor(i.voucher,i.fromcompanyid),i.status&&1==i.status&&(this._trnMainService.showPerformaApproveReject=!1)}),this.fileUploadPopupSettings=Object.assign(new b.s,{title:"Sales Return",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Sales Return Sample"})}getSalesReturnInvoiceFromDistributor(i,r){this.loadingSerive.show("Getting Data. Please Wait..."),this.masterService.loadSalesInvoiceFromSupplierHO(i,r).subscribe(t=>{if(this.loadingSerive.hide(),"ok"==t.status){if(this._trnMainService.TrnMainObj=t.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherType=15,this._trnMainService.TrnMainObj.VoucherPrefix="CN",this._trnMainService.TrnMainObj.VoucherAbbName="CN",this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFORDBILL=i,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="",this._trnMainService.TrnMainObj.INVOICETYPE="INTERBRANCH",this._trnMainService.TrnMainObj.DIVISION=this.userProfile.CompanyInfo.INITIAL,this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.CompanyInfo.PhiscalID,this._trnMainService.disableAllFieldinPurchase=!0;for(let n in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.TrnMainObj.ProdList[n].inputMode=!1,this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].VARIANTDESCA=this._trnMainService.getVariantDescriptionFromList(this._trnMainService.TrnMainObj.ProdList[n]);this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate()}},t=>{this.loadingSerive.hide()})}onClickMemberReferIDSearch(i){this.applyReferValue=!0,this.getMemberShipList(),this.genericGridMemberShip.show()}calculateMemberPointsForView(){this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length&&this.masterService.postMemberPointCalculation(this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result.pointsGained,this._trnMainService.TrnMainObj.TOTMEMPOINTS=i.result2)})}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList.length>1&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE))}onClickMemberIDSearch(i){this.getMemberShipList(),this.genericGridMemberShip.show()}getMemberShipList(){this.gridPopupSettingsForMember=this.masterService.getGenericGridPopUpSettings("MemberList")}showSalesInvoicePopup(i){null!=this._trnMainService.TrnMainObj.BILLTOADD&&""!=this._trnMainService.TrnMainObj.BILLTOADD?this.fileUploadPopup.show():this.alertService.warning("Please select the account...")}fileUploadSuccess(i){if("ok"==i.status){if(this._trnMainService.TrnMainObj.ProdList=i.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherType=15,this._trnMainService.TrnMainObj.VoucherPrefix="CN",this._trnMainService.TrnMainObj.VoucherAbbName="CN",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="";for(let r of this._trnMainService.TrnMainObj.ProdList)r.MFGDATE=null==r.MFGDATE?"":r.MFGDATE.toString().substring(0,10),r.EXPDATE=null==r.EXPDATE?"":r.EXPDATE.toString().substring(0,10),r.REALRATE=r.ALTRATE/r.ALTCONFACTOR,r.RATE=r.ALTRATE/r.ALTCONFACTOR;this._trnMainService.ReCalculateBillWithNormal()}}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(I.e),e.Y36(A.V),e.Y36(P.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["creditnote-itembase"]],viewQuery:function(i,r){if(1&i&&(e.Gf(ve,5),e.Gf(ge,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.fileUploadPopup=t.first),e.iGM(t=e.CRH())&&(r.genericGridMemberShip=t.first)}},hostBindings:function(i,r){1&i&&e.NdJ("keydown",function(n){return r.updown(n)},!1,e.evT)},features:[e._Bn([S.p])],decls:27,vars:8,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top",2,"padding-bottom","1px"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[3,"onMemberIDSearch","onMemberReferIDSearch","onClickSlider"],[1,"col-md-7"],[3,"buttonShow","onFileUploadPopupEmit"],[1,"main-container"],[3,"hidden"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[3,"onClickItemSelectPopUp",4,"ngIf"],[1,"footer-wrapper"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""],[3,"onClickItemSelectPopUp"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA(),e.TgZ(9,"div")(10,"voucher-sidebar-billdetail",7),e.NdJ("onMemberIDSearch",function(n){return r.onClickMemberIDSearch(n)})("onMemberReferIDSearch",function(n){return r.onClickMemberReferIDSearch(n)})("onClickSlider",function(){return r.calculateMemberPointsForView()}),e.qZA()()(),e.TgZ(11,"div",8)(12,"voucher-master-action",9),e.NdJ("onFileUploadPopupEmit",function(n){return r.showSalesInvoicePopup(n)}),e.qZA()()()(),e.TgZ(13,"div",10)(14,"div",11),e._UZ(15,"trnmain-parameters-master"),e.qZA(),e.TgZ(16,"div",12),e.YNc(17,_e,2,0,"div",13),e.qZA()()(),e.TgZ(18,"div",14)(19,"div",12)(20,"div",15),e.YNc(21,me,1,0,"productentry",16),e.YNc(22,Te,1,0,"productentryLite",16),e.qZA()()(),e.TgZ(23,"div",17),e._UZ(24,"voucher-total-area"),e.qZA()(),e.TgZ(25,"file-uploader-popup",18,19),e.NdJ("onUploaded",function(n){return r.fileUploadSuccess(n)}),e.qZA()),2&i&&(e.xp6(8),e.AsE("",r._trnMainService.pageHeading," [",r._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("buttonShow",!1),e.xp6(2),e.Q6J("hidden",!r.masterService.ShowMore),e.xp6(3),e.Q6J("ngIf",1==r.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("ngIf","pro"==r._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf","lite"==r._trnMainService.AppMode),e.xp6(3),e.Q6J("popupsettings",r.fileUploadPopupSettings))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u,U.d,b.U,F.o,Q.j],styles:[".table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:10px}.table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important}"]}),o})(),Oe=(()=>{class o{constructor(){}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["sales"]],decls:1,vars:0,template:function(i,r){1&i&&e._UZ(0,"router-outlet")},dependencies:[O.lC],encapsulation:2}),o})();var g=d(20092);let Ce=(()=>{class o{constructor(i,r,t,n,a){this._fb=i,this.masterservice=r,this._trnMainService=t,this.alertService=n,this.loadingSerive=a,this.isActive=!1,this.CustomerForm=i.group({CUSTNAME:["",g.kI.required],MOBILENO:["",g.kI.required],ADDRESS:["",g.kI.required]})}show(){this.isActive=!0}hide(){this.isActive=!1}onClickCustomerHide(){this.hide()}onClickCreateCustomer(){}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(g.qu),e.Y36(f.P),e.Y36(S.p),e.Y36(P.c),e.Y36(A.V))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-customer"]],decls:23,vars:4,consts:[[3,"formGroup"],[1,"modal-sticky",2,"display","block","padding","0px"],[1,"modal-content",2,"background-color","#f1f1f1","width","30% !important","height","200px","border","1px solid","margin-top","6%","margin-right","15%","border","1px solid"],[1,"modal-header",2,"padding","0px","background","#f1f1f1"],[1,"modal-title",2,"text-align","center"],[1,"row",2,"margin-top","10px"],["type","text","formControlName","CUSTNAME","placeholder","Customer Name",2,"width","100px","margin-left","8%","width","50%","margin-left","8%"],[1,"row"],["type","number","placeholder","Mobile","formControlName","MOBILENO",2,"width","100px","margin-left","8%","width","50%","margin-left","8%"],["type","text","placeholder","Address","formControlName","ADDRESS",2,"width","100px","margin-left","8%","width","50%","margin-left","8%"],[1,"col-md-12",2,"margin-top","20px"],[1,"btn","btn-info",2,"height","26px","width","100px",3,"disabled","click"],[1,"btn","btn-info",2,"height","26px","width","100px",3,"click"]],template:function(i,r){1&i&&(e.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4",4),e._uU(5," Create Customer "),e.qZA()(),e.TgZ(6,"div",5)(7,"label"),e._uU(8,"Customer Name"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"div",7)(11,"label"),e._uU(12,"Mobile"),e.qZA(),e._UZ(13,"input",8),e.qZA(),e.TgZ(14,"div",7)(15,"label"),e._uU(16,"Address"),e.qZA(),e._UZ(17,"input",9),e.qZA(),e.TgZ(18,"div",10)(19,"button",11),e.NdJ("click",function(){return r.onClickCreateCustomer()}),e._uU(20,"Create"),e.qZA(),e.TgZ(21,"button",12),e.NdJ("click",function(){return r.onClickCustomerHide()}),e._uU(22,"Cancel"),e.qZA()()()()()),2&i&&(e.Q6J("formGroup",r.CustomerForm),e.xp6(1),e.ekj("modal-sticky-hide",!r.isActive),e.xp6(18),e.Q6J("disabled",!r.CustomerForm.valid))},dependencies:[g._Y,g.Fj,g.wV,g.JJ,g.JL,g.sg,g.u],styles:[".modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}.btn-file[_ngcontent-%COMP%]{position:relative;overflow:hidden}.btn-file[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;top:0;right:0;min-width:100%;min-height:100%;font-size:100px;text-align:right;filter:alpha(opacity=0);opacity:0;outline:none;background:white;cursor:inherit;display:block}",".modal-content[_ngcontent-%COMP%] {\n      padding: 1px;\n      margin: 0px;\n      float: right;\n  }\n\n  .table-scroll[_ngcontent-%COMP%] {\n      overflow-y: scroll;\n      overflow-x: hidden;\n  }\n\n  tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n      background-color: #f3f5f4;\n      cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n      font-size: 11px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n      background-color: #ced6d3 !important;\n  }\n\n  td[_ngcontent-%COMP%] {\n      padding: 2px;\n      border: 1px solid black;\n  }\n\n  th[_ngcontent-%COMP%] {\n      padding: 2px;\n      border: 1px solid black;\n  }\n\n  .modal-sticky[_ngcontent-%COMP%] {\n      position: fixed;\n      bottom: 45px;\n      right: 14%;\n      width: 120%;\n      height: 76%;\n      z-index: 2;\n  }\n\n  .input[_ngcontent-%COMP%] {\n      width: 80%\n  }\n\n  td[_ngcontent-%COMP%] {\n      line-height: 0px !important;\n      height: 26px\n  }\n\n  .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n      border-top: 0px solid gainsboro !important;\n  }\n\n  .TopMargin[_ngcontent-%COMP%] {\n      Margin-Top: 10px\n  }\n\n  .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n      text-align: left !important;\n  }\n\n  input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n  }\n\n  label[_ngcontent-%COMP%] {\n      \n      \n      \n      \n      font-size: 13px;\n      padding-top: 6px;\n      margin-left: 8%;\n      width: 25%\n  }"]}),o})();const be=["genericGridSO"],Pe=["genericPerformaInvoiceGridSO"],Ae=["genericCancelSales"],Ie=["popupCustomerCreation"],Ee=["genericGridSalesMan"],Ne=["genericGridSalesManRoute"],Le=["genericGridCustomerListBySalesmanAndRoute"];function Re(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",7)(2,"span")(3,"b"),e._uU(4,"PO Qty:"),e.qZA(),e._uU(5),e.qZA()(),e.TgZ(6,"div",22)(7,"span")(8,"b"),e._uU(9,"Rate:"),e.qZA(),e._uU(10),e.ALo(11,"currency"),e.qZA()(),e.BQk()),2&o){const i=e.oxw();e.xp6(5),e.hij("\xa0",i._trnMainService.purchaseOrderQty," \xa0"),e.xp6(5),e.hij("\xa0",e.Dn7(11,2,i._trnMainService.purchaseOrderRate,"INR","Rs. ")," ")}}let je=(()=>{class o{constructor(i,r,t,n,a,l){this.masterService=i,this._trnMainService=r,this.route=t,this.alertService=n,this.loadingSerive=a,this.authservice=l,this.hideShow=!1,this.salesManList=[],this.routerMasterList=[],this.userProfile={},this.RouteList=[],this.CustomerList=[],this.gridPopupSettings=new p.im,this.gridPerformaInvoicePopupSettings=new p.im,this.gridcancelSalesPopupSettings=new p.im,this.gridPopupSettingsForSalesMan=new p.im,this.gridPopupSettingsForSalesManRoute=new p.im,this.gridPopupSettingsForCustomerListBySalesmanAndRoute=new p.im,this.userProfile=l.getUserProfile(),this.userSetting=this.authservice.getSetting(),"canceladdsientry"==this.route.snapshot.url[0].path?this._trnMainService.initialFormLoad(61):"addsientry"==this.route.snapshot.url[0].path&&this._trnMainService.initialFormLoad(14),this.masterService.getSalesmanList().subscribe(h=>{this.salesManList.push(h)}),this.gridPopupSettings={title:"Sales Vouchers",apiEndpoints:"/getTrnMainPagedList/SO/tag",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TRNAC",title:"Trn. A/c",hidden:!1,noSearch:!1},{key:"PhiscalId",title:"Fiscal Year",hidden:!1,noSearch:!1}]},this.gridPerformaInvoicePopupSettings={title:"Approved Proforma Vouchers",apiEndpoints:"/getApprovedHOPerformaInvoicePagedList",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1},{key:"BILLTOTEL",title:"VAT NO.",hidden:!1,noSearch:!1}]},this.gridcancelSalesPopupSettings={title:"Sales Invoice ",apiEndpoints:"/getTrnMainDateWisePagedList/TI",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"BILL NO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"TRNMODE",title:"TYPE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.route.queryParams.subscribe(h=>{h.voucher&&this.getSelectedPerformaInvoice(h.voucher)})}getSalesManList(){this.gridPopupSettingsForSalesMan=this.masterService.getGenericGridPopUpSettings("SalesManList")}onclickOnResetPopupEmit(i){}onSalesManSelect(i){this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.SALESMAN=i.NAME,this._trnMainService.salesmanID=i.SALESMANID,this._trnMainService.salesmanName=i.NAME,this.getSalesManRouteList(),this.genericGridSalesManRoute.show()}onRouteSelect(i){this._trnMainService.doubleClick=!0,this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.ROUTE=i.RouteCode,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,this._trnMainService.getCustomerListRouteAndSalesmanWise(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE),this.getCustomerList(),this.genericGridCustomerListBySalesmanAndRoute.show()}onCustomerSelected(i){console.log("kkmparac"),this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""==i.PMODE?"credit":i.PMODE,this.masterService.focusAnyControl("unit")}getSalesManRouteList(){this.gridPopupSettingsForSalesManRoute=this.masterService.getGenericGridSettintForSalemanRoute(this._trnMainService.TrnMainObj.SALESMANID)}getCustomerList(){this.gridPopupSettingsForCustomerListBySalesmanAndRoute=this.masterService.getGridSettingForCustomerBySalesmanRoute(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE)}ngOnInit(){}getSalesmanRoute(i){}showLoadFromSOPopup(i){this.genericGridSO.show()}showApprovedPreformaInvoicePopup(i){this.genericPerformaInvoiceGridSO.show()}showSalesDayWise(i){this.genericCancelSales.show()}onPerformaInvoiceSelect(i){this.getSelectedPerformaInvoice(i.VCHRNO)}oncancelSalesSelect(i){}getSelectedPerformaInvoice(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadHoPerformaInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"==r.status){this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW";for(let t=0;t<this._trnMainService.TrnMainObj.ProdList.length;t++)this._trnMainService.TrnMainObj.ProdList[t].inputMode=!1;console.log("prevphiscalid",this._trnMainService.TrnMainObj,this.userProfile.PhiscalYearInfo.PhiscalID),this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="Tax Invoice",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.ReCalculateBillWithNormal()}},r=>{this.loadingSerive.hide()})}onSalesOrderSelect(i){this.masterService.loadSalesInvoiceFromSalesOrder(i.VCHRNO).subscribe(r=>{if("ok"==r.status){if(this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW",!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.TransporterEway={},this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let n in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(n),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[n].PClist,n);let a=this._trnMainService.TrnMainObj.ProdList[n].ALTUNITObj;this._trnMainService.RealQuantitySet(n,null==a?1:a.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[n].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let h=0;this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,h=this._trnMainService.TrnMainObj.ProdList[n].PRATE}var t=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK<=0);this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK>0),this._trnMainService.ReCalculateBillWithNormal(),null!=t&&t.length>0&&this.alertService.error("Some Of the item have been excluded because of unavailable Stock")}},r=>{})}onItemDoubleClick(i){this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.loadSODataToSales(i.VCHRNO)}onSalesCancelSelect(i){this.loadTaxInvoiceForCancel(i.VCHRNO,i.DIVISION,i.PhiscalId)}loadTaxInvoiceForCancel(i,r,t){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.LoadTransaction(i,r,t).subscribe(n=>{if(this.loadingSerive.hide(),"ok"==n.status){this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherType=61,this._trnMainService.pageHeading="Tax Invoice [Cancel]",this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let a in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.setAltunitDropDownForViewStock(a),this._trnMainService.getPricingOfItem(a,"",!0),this._trnMainService.TrnMainObj.ProdList[a].inputMode=!1}},n=>{this.loadingSerive.hide()})}getRouteListSalesmanWise(i){this.masterService.getRouteListBasedUponSalesman(i).subscribe(r=>{this.RouteList=r})}onClickCreateCustomer(){}onClickCustomerHide(){}DisplayCustomerProfile(i){0==i&&this.popupCustomerCreation.show()}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["addsales-invoice"]],viewQuery:function(i,r){if(1&i&&(e.Gf(be,5),e.Gf(Pe,5),e.Gf(Ae,5),e.Gf(Ie,5),e.Gf(Ee,5),e.Gf(Ne,5),e.Gf(Le,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericPerformaInvoiceGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericCancelSales=t.first),e.iGM(t=e.CRH())&&(r.popupCustomerCreation=t.first),e.iGM(t=e.CRH())&&(r.genericGridSalesMan=t.first),e.iGM(t=e.CRH())&&(r.genericGridSalesManRoute=t.first),e.iGM(t=e.CRH())&&(r.genericGridCustomerListBySalesmanAndRoute=t.first)}},features:[e._Bn([S.p])],decls:35,vars:9,consts:[[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"color","black"],[1,"col-md-2","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic","padding-left","0px","padding-right","0px"],[4,"ngIf"],[1,"col-md-5","pd0"],[3,"onLoadFromSOClickEmit","onLoadFromPerformaInvoiceClickEmit","onLoadCancelSalesEmit"],[3,"popupsettings","onItemDoubleClick"],["genericGridSO",""],["genericPerformaInvoiceGridSO",""],["genericCancelSales",""],["genericGridSalesMan",""],["genericGridSalesManRoute",""],["genericGridCustomerListBySalesmanAndRoute",""],[1,"main-container"],[3,"showCustomerProfile"],[1,"row",2,"margin-top","5px"],[1,"col-md-12","pd5"],[1,"sticky-bottom"],["popupCustomerCreation",""],[1,"col-md-6","pd0"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",3)(5,"h2",4),e._uU(6),e.qZA(),e.TgZ(7,"div"),e._UZ(8,"voucher-sidebar-billdetail"),e.qZA()(),e.TgZ(9,"div",5),e.YNc(10,Re,12,6,"ng-container",6),e.qZA(),e.TgZ(11,"div",7)(12,"voucher-master-action",8),e.NdJ("onLoadFromSOClickEmit",function(n){return r.showLoadFromSOPopup(n)})("onLoadFromPerformaInvoiceClickEmit",function(n){return r.showApprovedPreformaInvoicePopup(n)})("onLoadCancelSalesEmit",function(n){return r.showSalesDayWise(n)}),e.qZA(),e.TgZ(13,"generic-popup-grid",9,10),e.NdJ("onItemDoubleClick",function(n){return r.onSalesOrderSelect(n)}),e.qZA(),e.TgZ(15,"generic-popup-grid",9,11),e.NdJ("onItemDoubleClick",function(n){return r.onPerformaInvoiceSelect(n)}),e.qZA(),e.TgZ(17,"generic-popup-grid",9,12),e.NdJ("onItemDoubleClick",function(n){return r.onSalesCancelSelect(n)}),e.qZA(),e.TgZ(19,"generic-popup-grid",9,13),e.NdJ("onItemDoubleClick",function(n){return r.onSalesManSelect(n)}),e.qZA(),e.TgZ(21,"generic-popup-grid",9,14),e.NdJ("onItemDoubleClick",function(n){return r.onRouteSelect(n)}),e.qZA(),e.TgZ(23,"generic-popup-grid",9,15),e.NdJ("onItemDoubleClick",function(n){return r.onCustomerSelected(n)}),e.qZA()()()(),e.TgZ(25,"div",16)(26,"div")(27,"trnmain-parameters-master",17),e.NdJ("showCustomerProfile",function(n){return r.DisplayCustomerProfile(n)}),e.qZA()(),e.TgZ(28,"div",18)(29,"div",19),e._UZ(30,"productentry"),e.qZA()()(),e.TgZ(31,"div",20),e._UZ(32,"voucher-total-area"),e.qZA(),e._UZ(33,"app-create-customer",null,21)),2&i&&(e.xp6(6),e.AsE("",r._trnMainService.pageHeading,"[",r._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",0!=r.userSetting.ENABLE_SOINTI),e.xp6(3),e.Q6J("popupsettings",r.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",r.gridPerformaInvoicePopupSettings),e.xp6(2),e.Q6J("popupsettings",r.gridcancelSalesPopupSettings),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForSalesMan),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForSalesManRoute),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForCustomerListBySalesmanAndRoute))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u,U.d,p.Zl,Ce,M.H9],styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}"]}),o})();const ye=["genericGridSO"],De=["genericGridPerformaInvoice"];function we(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",21)(2,"span")(3,"b"),e._uU(4,"SO Qty:"),e.qZA(),e._uU(5),e.qZA()(),e.TgZ(6,"div",22)(7,"span")(8,"b"),e._uU(9,"Rate:"),e.qZA(),e._uU(10),e.ALo(11,"currency"),e.qZA()(),e.BQk()),2&o){const i=e.oxw();e.xp6(5),e.hij("\xa0",i._trnMainService.purchaseOrderQty," \xa0"),e.xp6(5),e.hij("\xa0",e.Dn7(11,2,i._trnMainService.purchaseOrderRate,"INR","Rs. ")," ")}}function xe(o,s){1&o&&(e.TgZ(0,"div"),e._UZ(1,"trnmain-parameters-master"),e.qZA())}function ke(o,s){1&o&&(e.TgZ(0,"div",18),e._UZ(1,"discounts-insert"),e.qZA())}let Fe=(()=>{class o{constructor(i,r,t,n,a,l,h,c,v,H){this.masterService=i,this._trnMainService=r,this.route=t,this.alertService=n,this.loadingSerive=a,this.authService=l,this.genericProductEntryService=h,this.itemKeyEventService=c,this.quantityChangeEventService=v,this.entryValidateService=H,this.gridPopupSettings=new p.im,this.gridPopupSettingsForHOPerformaRequest=new p.im,this._trnMainService.initialFormLoad(57),this.userSetting=this.authService.getSetting(),this.gridPopupSettings={title:"Proforma Vouchers",apiEndpoints:"/getTrnMainPagedList/SO/tag",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"SO NO.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.gridPopupSettingsForHOPerformaRequest={title:"Proforma Requested Vouchers",apiEndpoints:"/getAllHOPerformaInvoicePagedList",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"PROFORMA NO.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.route.queryParams.subscribe(C=>{C.voucher&&this.getSelectedPerofrmaVoucher(C.voucher),C.status&&1==C.status&&(this._trnMainService.showPerformaApproveReject=!1)})}ngOnInit(){this.route.queryParams.subscribe(i=>{if("DRILL"==i.mode){let r=i.voucher,t=[];t=r.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(r,t[1],t[2]).subscribe(n=>{"ok"==n.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.pageHeading="Proforma Invoice",this._trnMainService.TrnMainObj.VoucherPrefix="PP",this._trnMainService.TrnMainObj.Mode="VIEW",null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(a=>a.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},n=>{this.loadingSerive.hide(),this.alertService.error(n)})}else this.masterService.masterGetmethod("/gettransactionmodes").subscribe(r=>{"ok"==r.status&&(this._trnMainService.paymentmodelist=r.result)},r=>{})}),this.setProductEntryTable()}setProductEntryTable(){var i=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new V.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"40px"}},{field:"BC",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,inputType:"barcodeInputText",headerNgStyle:{width:"90px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltQty",t,n)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"350px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableItemDesc",t,n),focusTo:"ALTUNIT"},{field:"BATCH",header:"Batch",hidden:!1,isActiveColumnHeader:!0,inputType:"batch",headerNgStyle:{width:"80px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableBatch",t,n),onEnter:(t,n,a,l)=>{this.genericProductEntryService.BatchEnter(t,n,a,l)},onKeyPress:(t,n)=>{this.genericProductEntryService.onKeyDownBatch(t,n)}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltUnit",t,n),onEnter:(t,n,a,l)=>this.entryValidateService.AlternateUnitEnterEventClick(t,n,a,l)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(t,n,a)=>this.QuantityChangeEvent_default(t,n,a),applyTwoDigitPipe:!1,disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltQty",t,n)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(t,n,a)=>this.mrpEnterEvent(t,n,a),onChange:(t,n,a,l)=>this.entryValidateService.MRPChangeEvent(t,n,a,l),focusTo:"INDDISCOUNTRATE",disablePipe:(t,n)=>this.getColumnDisablePipe("disableRateandDiscount",t,n)},{field:"AMOUNT",header:"Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"INDDISCOUNTRATE",header:"Dis%",hidden:!1,inputType:"number",isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableDiscountRate",t,n),applyTwoDigitPipe:!1,onEnter:(t,n,a)=>{this.genericProductEntryService.discRateEnterClicked(t,n,a),this.genericProductEntryService.IndDiscountRateChangeEvent(t,a,n)},onChange:(t,n,a)=>this.genericProductEntryService.IndDiscountRateChangeEvent(t,n,a),focusTo:"INDDISCOUNT",decimalPlacesRestriction:"2"},{field:"INDDISCOUNT",header:"Dis Amt",hidden:!1,inputType:"number",isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableDiscountAmount",t,n),applyTwoDigitPipe:!0,onEnter:(t,n,a)=>{this.genericProductEntryService.discEnterClicked(t,n,a)},onChange:(t,n,a,l)=>this.genericProductEntryService.IndDiscountAmountChangeEvent(t,n,a,l),focusTo:"ITEMDESC",decimalPlacesRestriction:"2"},{field:"VAT",header:"VAT",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"NETAMOUNT",header:"Net Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=i,this.genericProductEntrySetting.voucherType=D.Km.PerformaSalesInvoice,this.genericProductEntrySetting.setRowItemFromSelectedItem=t=>this.SetRowItemFromSelectedItem(t),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(t,n=new Function)=>this.SetRowItemRate(t,n)}showGenericGrid(i){this.itemKeyEventService.ItemkeyEvent(i.index,i.event,()=>u.K.default,r=>u.K.default,()=>u.K.default,()=>u.K.default,()=>u.K.default)}SetRowItemFromSelectedItem(i){let r=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(r,i),this._trnMainService.assignPrateaAsRATE(r,i)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(i,r,t){this.quantityChangeEventService.QuantityChangeEvent(t)}SetRowItemRate(i,r){r()}getColumnDisablePipe(i,r,t){return i}mrpEnterEvent(i,r,t){this.entryValidateService.mrpEnterEvent(i,r,t,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}showLoadFromSOPopup(i){this.genericGridSO.show()}showLoadFromPerformaInvoiceRequestPopup(i){this.genericGridPerformaInvoice.show()}onSalesOrderSelect(i){this.masterService.loadSalesInvoiceFromSalesOrder(i.VCHRNO).subscribe(r=>{if("ok"==r.status){if(this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP",this._trnMainService.TrnMainObj.TransporterEway={},this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;for(let n in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(n),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[n].PClist,n);let a=this._trnMainService.TrnMainObj.ProdList[n].ALTUNITObj;this._trnMainService.RealQuantitySet(n,null==a?1:a.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[n].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let h=0;this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,h=this._trnMainService.TrnMainObj.ProdList[n].PRATE}var t=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK<=0);this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK>0),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.TrnMainObj.Mode="NEW",null!=t&&t.length>0&&this.alertService.error("Some Of the item have been excluded because of unavailable Stock")}},r=>{})}onHoPerformaInvoiceClicked(i){this.getSelectedPerofrmaVoucher(i.VCHRNO)}getSelectedPerofrmaVoucher(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadHoPerformaInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"==r.status){this._trnMainService.TrnMainObj=JSON.parse(r.result);for(let t in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(t),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[t].PClist,t);let n=this._trnMainService.TrnMainObj.ProdList[t].ALTUNITObj;this._trnMainService.RealQuantitySet(t,null==n?1:n.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[t].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[t].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[t].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[t].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[t].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[t].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[t].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[t].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let l=0;this._trnMainService.TrnMainObj.ProdList[t].inputMode=!0,l=this._trnMainService.TrnMainObj.ProdList[t].PRATE}this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.showPerformaApproveReject=!0}},r=>{this.loadingSerive.hide()})}onItemDoubleClick(i){this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.loadSODataToSales(i.VCHRNO)}onClickPoReferenceProduct(i){console.log("PERFORMA INVOUCE",i),i&&(this._trnMainService.purchaseOrderQty=i.ALTERNATEQTY,this._trnMainService.purchaseOrderRate=i.RATE)}updown(i){"F10"==i.code&&this._trnMainService.rounding()}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e),e.Y36(w.w),e.Y36(u.X),e.Y36(x.s),e.Y36(k.C))},o.\u0275cmp=e.Xpm({type:o,selectors:[["add-performa-invoice"]],viewQuery:function(i,r){if(1&i&&(e.Gf(ye,5),e.Gf(De,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericGridPerformaInvoice=t.first)}},hostBindings:function(i,r){1&i&&e.NdJ("keydown",function(n){return r.updown(n)},!1,e.evT)},features:[e._Bn([S.p,k.C,u.X,w.w,x.s])],decls:28,vars:7,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-2","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic","padding-left","0px","padding-right","0px"],[4,"ngIf"],[1,"col-md-5"],[3,"onLoadFromSOClickEmit","onLoadFromHOPerformaInvoiceClickEmit"],[3,"popupsettings","onItemDoubleClick"],["genericGridSO",""],["genericGridPerformaInvoice",""],[1,"main-container"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[3,"onClickItemSelectPopUp"],[1,"footer-wrapper"],[1,"col-md-5","pd0"],[1,"col-md-7","pd0"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA(),e._UZ(9,"voucher-sidebar-billdetail"),e.qZA(),e.TgZ(10,"div",7),e.YNc(11,we,12,6,"ng-container",8),e.qZA(),e.TgZ(12,"div",9)(13,"voucher-master-action",10),e.NdJ("onLoadFromSOClickEmit",function(n){return r.showLoadFromSOPopup(n)})("onLoadFromHOPerformaInvoiceClickEmit",function(n){return r.showLoadFromPerformaInvoiceRequestPopup(n)}),e.qZA(),e.TgZ(14,"generic-popup-grid",11,12),e.NdJ("onItemDoubleClick",function(n){return r.onSalesOrderSelect(n)}),e.qZA(),e.TgZ(16,"generic-popup-grid",11,13),e.NdJ("onItemDoubleClick",function(n){return r.onHoPerformaInvoiceClicked(n)}),e.qZA()()()(),e.TgZ(18,"div",14),e.YNc(19,xe,2,0,"div",8),e.TgZ(20,"div",15),e.YNc(21,ke,2,0,"div",16),e.qZA()()(),e.TgZ(22,"div",17)(23,"div",15)(24,"div",18)(25,"productentry",19),e.NdJ("onClickItemSelectPopUp",function(n){return r.onClickPoReferenceProduct(n)}),e.qZA()()()(),e.TgZ(26,"div",20),e._UZ(27,"voucher-total-area"),e.qZA()()),2&i&&(e.xp6(8),e.AsE("",r._trnMainService.pageHeading," [",r._trnMainService.TrnMainObj.Mode,"]"),e.xp6(3),e.Q6J("ngIf",(0!=r.userSetting.ENABLE_SOINTI||0!=r.userSetting.PERFOMASOBILLMODE)&&r._trnMainService.TrnMainObj.REFORDBILL),e.xp6(3),e.Q6J("popupsettings",r.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForHOPerformaRequest),e.xp6(3),e.Q6J("ngIf",r.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==r.masterService.userSetting.GblBarcodeWiseBilling))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u,U.d,p.Zl,F.o,M.H9],styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}.table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:12px;font-weight:700}.table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important}"]}),o})();var Ze=d(54536);const Ge=["genericHOSalesInvoiceGridTI"],Ue=["genericsGridSAPPI"],He=["fileUploadPopup"],Ve=["digitalSignUpload"];function Be(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",19)(2,"span")(3,"b"),e._uU(4,"QT Qty:"),e.qZA(),e._uU(5),e.qZA()(),e._UZ(6,"div",14),e.TgZ(7,"div",21)(8,"span")(9,"b"),e._uU(10,"Rate:"),e.qZA(),e._uU(11),e.ALo(12,"currency"),e.qZA()(),e.BQk()),2&o){const i=e.oxw(2);e.xp6(5),e.AsE("\xa0",i._trnMainService.purchaseOrderQty," \xa0 ",i._trnMainService.produstWiseOrderUnit," "),e.xp6(6),e.hij("\xa0",e.Dn7(12,3,i._trnMainService.purchaseOrderRate,"INR","Rs. ")," ")}}function qe(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",12)(1,"div",13)(2,"div",14),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",15)(5,"label",16),e._uU(6),e.qZA()(),e.TgZ(7,"div",17),e.YNc(8,Be,13,7,"ng-container",18),e.qZA(),e.TgZ(9,"div",19)(10,"voucher-master-action",20),e.NdJ("onFileUploadPopupEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showPurchaseInvoicePopup(t))})("onDigitalSignatureUploadPopupEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showDigitalSignPopup(t))}),e.qZA()()()()}if(2&o){const i=e.oxw();e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(2),e.Q6J("ngIf",1==i.userSetting.ENABLE_QUOTATTION_INSO&&i._trnMainService.TrnMainObj.REFORDBILL)}}function Qe(o,s){1&o&&(e.TgZ(0,"div"),e._UZ(1,"trnmain-purchase-entry",24),e.qZA())}function Je(o,s){1&o&&(e.TgZ(0,"div",6),e._UZ(1,"discounts-insert"),e.qZA())}function Ye(o,s){if(1&o&&(e.TgZ(0,"div",22),e.YNc(1,Qe,2,0,"div",18),e.TgZ(2,"div",5),e.YNc(3,Je,2,0,"div",23),e.qZA()()),2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling)}}function We(o,s){1&o&&(e.TgZ(0,"div",25),e._UZ(1,"voucher-total-area"),e.qZA())}let J=(()=>{class o{constructor(i,r,t,n,a,l,h,c,v,H,C){this.masterService=i,this._trnMainService=r,this.dialog=t,this.alertService=n,this.loadingSerive=a,this.authservice=l,this.route=h,this.genericProductEntryService=c,this.itemKeyEventService=v,this.quantityChangeEventService=H,this.entryValidateService=C,this.hideShow=!1,this.fileUploadPopupSettings=new b.s,this.gridHoSalesInvoicePopupSettings=new p.im,this.gridSAPPIPopupSettings=new p.im,this.disableView=!1,this.prefix={},this.userProfile={},this.userSetting=this.authservice.getSetting(),this.appType=this.masterService.appType,this._trnMainService.initialFormLoad(20),i.Currencies=[],i.getCurrencies(),this.userProfile=l.getUserProfile(),this.route.queryParams.subscribe(_=>{"DRILL"!=_.mode&&(_.voucher&&(this.getPurchaseOrderFromCustomer(_.voucher,_.fromcompanyid,!0),this._trnMainService.fromNotification=_.fromNotification),_.status&&1==_.status&&(this._trnMainService.showPerformaApproveReject=!1))})}ngOnInit(){this.route.queryParams.subscribe(i=>{if("DRILL"==i.mode){let r=i.voucher,t=[];t=r.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(r,t[1],t[2]).subscribe(n=>{"ok"==n.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.VoucherType=20,this._trnMainService.pageHeading="Sales Order",this._trnMainService.TrnMainObj.VoucherPrefix="SO",this._trnMainService.TrnMainObj.Mode="VIEW",null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(a=>a.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},n=>{this.loadingSerive.hide(),this.alertService.error(n)})}else console.log(this._trnMainService.TrnMainObj),console.log(this._trnMainService.TrnMainObj.Mode),this.masterService.refreshTransactionList()}),this.fileUploadPopupSettings=Object.assign(new b.s,{title:"Sales Order",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Sales Order Sample"}),this.setProductEntryTable()}setProductEntryTable(){var i=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new V.Vn(this._trnMainService);var r=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"90px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"350px"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableItemDesc",t,n),focusTo:"ALTUNIT"},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"80px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltUnit",t,n),onEnter:(t,n,a,l)=>this.entryValidateService.AlternateUnitEnterEventClick(t,n,a,l)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(t,n,a)=>this.QuantityChangeEvent_default(t,n,a),applyTwoDigitPipe:!1,disablePipe:(t,n)=>this.getColumnDisablePipe("disableAltQty",t,n)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(t,n,a)=>this.mrpEnterEvent(t,n,a),onChange:(t,n,a,l)=>this.entryValidateService.MRPChangeEvent(t,n,a,l),focusTo:"INDDISCOUNTRATE",disablePipe:(t,n)=>this.getColumnDisablePipe("disableRateandDiscount",t,n)},{field:"INDDISCOUNTRATE",header:"Dis%",hidden:!1,inputType:"number",isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableDiscountRate",t,n),applyTwoDigitPipe:!1,onEnter:(t,n,a)=>{this.genericProductEntryService.discRateEnterClicked(t,n,a),this.genericProductEntryService.IndDiscountRateChangeEvent(t,a,n)},onChange:(t,n,a)=>this.genericProductEntryService.IndDiscountRateChangeEvent(t,n,a),focusTo:"INDDISCOUNT",decimalPlacesRestriction:"2"},{field:"INDDISCOUNT",header:"Dis Amt",hidden:!1,inputType:"number",isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableDiscountAmount",t,n),applyTwoDigitPipe:!0,onEnter:(t,n,a)=>{this.genericProductEntryService.discEnterClicked(t,n,a)},onChange:(t,n,a,l)=>this.genericProductEntryService.IndDiscountAmountChangeEvent(t,n,a,l),focusTo:"REMARKS",decimalPlacesRestriction:"2"},{field:"AMOUNT",header:"Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"VAT",header:"VAT",hidden:this.hideVAT(),isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"NETAMOUNT",header:"Net Amt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{width:"40px"},focusTo:"ITEMDESC",onEnter:(t,n,a,l)=>{this.entryValidateService.RemarksEnterCommand(t,n,a,l)}},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(t,n)=>this.getColumnDisablePipe("disableDeleteRow",t,n)}];this.genericProductEntrySetting.columns=r,this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=i,this.genericProductEntrySetting.voucherType=D.Km.PerformaSalesInvoice,this.genericProductEntrySetting.setRowItemFromSelectedItem=t=>this.SetRowItemFromSelectedItem(t),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(t,n=new Function)=>this.SetRowItemRate(t,n)}getPurchaseOrderFromCustomer(i,r,t=!1){this.loadingSerive.show("Getting Data. Please Wait..."),this.masterService.loadSalesInvoiceFromSupplierHO(i,r).subscribe(n=>{if(this.loadingSerive.hide(),"ok"==n.status){if(this._trnMainService.TrnMainObj=n.result,this._trnMainService.disableAllFieldinPurchase=!0,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;const a=d(67816);this._trnMainService.TrnMainObj.guid=a(),this._trnMainService.TrnMainObj.VoucherType=20,this._trnMainService.TrnMainObj.VoucherPrefix="SO",this._trnMainService.TrnMainObj.VoucherAbbName="SO",this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="",this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision,this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.CompanyInfo.PhiscalID,t&&(this._trnMainService.TrnMainObj.INVOICETYPE="FROMNOTIFICATION");for(let c in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.TrnMainObj.ProdList[c].inputMode=!1,this._trnMainService.TrnMainObj.ProdList[c].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[c].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[c].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[c].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[c].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[c].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[c].VARIANTDESCA=this._trnMainService.getVariantDescriptionFromList(this._trnMainService.TrnMainObj.ProdList[c]);const h=this._trnMainService.TrnMainObj.ProdList.filter(c=>"Non-Discountable"===c.DISMODE&&(c.INDDISCOUNT>0||c.INDDISCOUNTRATE>0||c.FLATDISCOUNT>0)).map(c=>c.ITEMDESC);h.length>0&&this.alertService.warning(`The following items have discounts applied but are marked as Non-Discountable: ${h.join(", ")}`),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate()}},n=>{this.loadingSerive.hide()})}showGenericGrid(i){this.itemKeyEventService.ItemkeyEvent(i.index,i.event,()=>u.K.default,r=>u.K.default,()=>u.K.default,()=>u.K.default,()=>u.K.default)}getColumnDisablePipe(i,r,t){return i}SetRowItemFromSelectedItem(i){this._trnMainService.prepareItem(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex],i)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}hideVAT(){return 0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER}mrpEnterEvent(i,r,t){this.entryValidateService.mrpEnterEvent(i,r,t,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}QuantityChangeEvent_default(i,r,t){this.quantityChangeEventService.QuantityChangeEvent(t)}SetRowItemRate(i,r){r()}showDigitalSignPopup(i){this.digitalSignUpload.show()}showPurchaseInvoicePopup(i){null!=this._trnMainService.TrnMainObj.BILLTOADD&&""!=this._trnMainService.TrnMainObj.BILLTOADD?this.fileUploadPopup.show():this.alertService.warning("Please select the Customer...")}fileUploadSuccess(i){if("ok"==i.status){if(this._trnMainService.TrnMainObj.ProdList=i.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherPrefix="SO",this._trnMainService.TrnMainObj.VoucherAbbName="SO",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="";for(let r of this._trnMainService.TrnMainObj.ProdList)r.MFGDATE=null==r.MFGDATE?"":r.MFGDATE.toString().substring(0,10),r.EXPDATE=null==r.EXPDATE?"":r.EXPDATE.toString().substring(0,10),r.REALRATE=r.ALTRATE/r.ALTCONFACTOR,r.RATE=r.ALTRATE/r.ALTCONFACTOR;console.log("prodlist",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.ReCalculateBillWithNormal()}}onClickPoReferenceProduct(i){i&&(this._trnMainService.purchaseOrderQty=i.ALTERNATEQTY,this._trnMainService.purchaseOrderRate=i.RATE,this._trnMainService.produstWiseOrderUnit=i.BASEUNIT)}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(Ze.uw),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e),e.Y36(O.gz),e.Y36(w.w),e.Y36(u.X),e.Y36(x.s),e.Y36(k.C))},o.\u0275cmp=e.Xpm({type:o,selectors:[["salesorder"]],viewQuery:function(i,r){if(1&i&&(e.Gf(Ge,5),e.Gf(Ue,5),e.Gf(He,5),e.Gf(Ve,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericHOSalesInvoiceGridTI=t.first),e.iGM(t=e.CRH())&&(r.genericsGridSAPPI=t.first),e.iGM(t=e.CRH())&&(r.fileUploadPopup=t.first),e.iGM(t=e.CRH())&&(r.digitalSignUpload=t.first)}},features:[e._Bn([S.p,k.C,u.X,w.w,x.s])],decls:13,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],["class","sticky-top",4,"ngIf"],["class","main-container",4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"onClickItemSelectPopUp"],["class","footer-wrapper",4,"ngIf"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""],["digitalSignUpload",""],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-33px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-3","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic"],[4,"ngIf"],[1,"col-md-5","pd0"],[3,"onFileUploadPopupEmit","onDigitalSignatureUploadPopupEmit"],[1,"col-md-6","pd0"],[1,"main-container"],["class","col-md-12 pd5",4,"ngIf"],["viewDisable","disableView"],[1,"footer-wrapper"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,qe,11,3,"div",2),e.YNc(3,Ye,4,2,"div",3),e.qZA(),e.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"productentry",7),e.NdJ("onClickItemSelectPopUp",function(n){return r.onClickPoReferenceProduct(n)}),e.qZA()()()(),e.YNc(8,We,2,0,"div",8),e.qZA(),e.TgZ(9,"file-uploader-popup",9,10),e.NdJ("onUploaded",function(n){return r.fileUploadSuccess(n)}),e.qZA(),e._UZ(11,"digital-signature-popup",null,11)),2&i&&(e.xp6(2),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(5),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("popupsettings",r.fileUploadPopupSettings))},styles:[".table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n        text-align: center;\n        vertical-align: middle;\n    }"]}),o})();const Ke=["genericGridSO"],Xe=["genericGridPerformaInvoice"];function ze(o,s){1&o&&(e.TgZ(0,"div"),e._UZ(1,"trnmain-parameters-master"),e.qZA())}function $e(o,s){1&o&&(e.TgZ(0,"div",17),e._UZ(1,"discounts-insert"),e.qZA())}let ei=(()=>{class o{constructor(i,r,t,n,a,l){this.masterService=i,this._trnMainService=r,this.route=t,this.alertService=n,this.loadingSerive=a,this.authService=l,this.gridPopupSettings=new p.im,this.gridPopupSettingsForHOPerformaRequest=new p.im,this._trnMainService.initialFormLoad(64),this.userSetting=this.authService.getSetting(),this.gridPopupSettings={title:"Proforma Vouchers",apiEndpoints:"/getTrnMainPagedList/SO/tag",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"SO NO.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.gridPopupSettingsForHOPerformaRequest={title:"Proforma Requested Vouchers",apiEndpoints:"/getAllHOPerformaInvoicePagedList",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"PROFORMA NO.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.route.queryParams.subscribe(h=>{h.voucher&&this.getSelectedPerofrmaVoucher(h.voucher),h.status&&1==h.status&&(this._trnMainService.showPerformaApproveReject=!1)})}ngOnInit(){this.route.queryParams.subscribe(i=>{if("DRILL"==i.mode){let r=i.voucher,t=[];t=r.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(r,t[1],t[2]).subscribe(n=>{"ok"==n.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.VoucherType=64,this._trnMainService.pageHeading="Quotation",this._trnMainService.TrnMainObj.VoucherPrefix="QT",this._trnMainService.TrnMainObj.Mode="VIEW",null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(a=>a.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},n=>{this.loadingSerive.hide(),this.alertService.error(n)})}else this.masterService.masterGetmethod("/gettransactionmodes").subscribe(r=>{"ok"==r.status&&(this._trnMainService.paymentmodelist=r.result)},r=>{})})}showLoadFromSOPopup(i){this.genericGridSO.show()}showLoadFromPerformaInvoiceRequestPopup(i){this.genericGridPerformaInvoice.show()}onSalesOrderSelect(i){this.masterService.loadSalesInvoiceFromSalesOrder(i.VCHRNO).subscribe(r=>{if("ok"==r.status){if(this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP",this._trnMainService.TrnMainObj.TransporterEway={},this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;for(let n in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(n),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[n].PClist,n);let a=this._trnMainService.TrnMainObj.ProdList[n].ALTUNITObj;this._trnMainService.RealQuantitySet(n,null==a?1:a.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[n].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let h=0;this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,h=this._trnMainService.TrnMainObj.ProdList[n].PRATE}var t=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK<=0);this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK>0),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.TrnMainObj.Mode="NEW",null!=t&&t.length>0&&this.alertService.error("Some Of the item have been excluded because of unavailable Stock")}},r=>{})}onHoPerformaInvoiceClicked(i){this.getSelectedPerofrmaVoucher(i.VCHRNO)}getSelectedPerofrmaVoucher(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadHoPerformaInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"==r.status){this._trnMainService.TrnMainObj=JSON.parse(r.result);for(let t in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(t),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[t].PClist,t);let n=this._trnMainService.TrnMainObj.ProdList[t].ALTUNITObj;this._trnMainService.RealQuantitySet(t,null==n?1:n.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[t].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[t].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[t].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[t].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[t].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[t].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[t].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[t].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let l=0;this._trnMainService.TrnMainObj.ProdList[t].inputMode=!0,l=this._trnMainService.TrnMainObj.ProdList[t].PRATE}this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.showPerformaApproveReject=!0}},r=>{this.loadingSerive.hide()})}onItemDoubleClick(i){this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.loadSODataToSales(i.VCHRNO)}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["add-quotation"]],viewQuery:function(i,r){if(1&i&&(e.Gf(Ke,5),e.Gf(Xe,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericGridPerformaInvoice=t.first)}},features:[e._Bn([S.p])],decls:25,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onLoadFromSOClickEmit","onLoadFromHOPerformaInvoiceClickEmit"],[3,"popupsettings","onItemDoubleClick"],["genericGridSO",""],["genericGridPerformaInvoice",""],[1,"main-container"],[4,"ngIf"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[1,"footer-wrapper"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onLoadFromSOClickEmit",function(n){return r.showLoadFromSOPopup(n)})("onLoadFromHOPerformaInvoiceClickEmit",function(n){return r.showLoadFromPerformaInvoiceRequestPopup(n)}),e.qZA(),e.TgZ(11,"generic-popup-grid",9,10),e.NdJ("onItemDoubleClick",function(n){return r.onSalesOrderSelect(n)}),e.qZA(),e.TgZ(13,"generic-popup-grid",9,11),e.NdJ("onItemDoubleClick",function(n){return r.onHoPerformaInvoiceClicked(n)}),e.qZA()()()(),e.TgZ(15,"div",12),e.YNc(16,ze,2,0,"div",13),e.TgZ(17,"div",14),e.YNc(18,$e,2,0,"div",15),e.qZA()()(),e.TgZ(19,"div",16)(20,"div",14)(21,"div",17),e._UZ(22,"productentry"),e.qZA()()(),e.TgZ(23,"div",18),e._UZ(24,"voucher-total-area"),e.qZA()()),2&i&&(e.xp6(8),e.AsE("",r._trnMainService.pageHeading," [",r._trnMainService.TrnMainObj.Mode,"]"),e.xp6(3),e.Q6J("popupsettings",r.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForHOPerformaRequest),e.xp6(3),e.Q6J("ngIf",r.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==r.masterService.userSetting.GblBarcodeWiseBilling))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u,p.Zl,F.o],styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}.table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:12px;font-weight:700}.table-summary[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important}"]}),o})();function ii(o,s){if(1&o&&(e.TgZ(0,"div",3)(1,"div",4)(2,"div",5),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",6)(5,"label",7),e._uU(6),e.qZA(),e._UZ(7,"div"),e.qZA(),e._UZ(8,"div",8),e.TgZ(9,"div",9),e._UZ(10,"voucher-master-action"),e.qZA()()()),2&o){const i=e.oxw();e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]")}}function ti(o,s){1&o&&e._UZ(0,"div",15)}function ni(o,s){if(1&o&&(e.TgZ(0,"div",10)(1,"div",11),e._UZ(2,"trnmain-parameters-master",12),e.qZA(),e.TgZ(3,"div",13),e.YNc(4,ti,1,0,"div",14),e.qZA(),e.TgZ(5,"div",13)(6,"div",15),e._UZ(7,"productentry"),e.qZA()()()),2&o){const i=e.oxw();e.xp6(1),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(3),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling)}}function ri(o,s){1&o&&(e.TgZ(0,"div",16),e._UZ(1,"voucher-total-area"),e.qZA())}let oi=(()=>{class o{constructor(i,r,t,n,a){this.masterService=i,this._trnMainService=r,this.route=t,this.authservice=n,this.changeDetection=a,this.userProfile={},this.applyReferValue=!1,this.userProfile=n.getUserProfile(),this.userSetting=this.authservice.getSetting(),"add-membership-sales-invoice"===this.route.snapshot.url[0].path&&(this._trnMainService.initialFormLoad(1),this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new")}ngAfterContentChecked(){this.changeDetection.detectChanges()}ngAfterViewInit(){}ngOnInit(){}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(I.e),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-membership-sales-invoice"]],features:[e._Bn([S.p])],decls:3,vars:3,consts:[["class","sticky-top",4,"ngIf"],["class","main-container",4,"ngIf"],["class","sticky-bottom",4,"ngIf"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-2","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic","padding-left","0px","padding-right","0px"],[1,"col-md-5","pd0"],[1,"main-container"],[3,"hidden"],["viewDisable","disableView"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"col-md-12","pd5"],[1,"sticky-bottom"]],template:function(i,r){1&i&&(e.YNc(0,ii,11,2,"div",0),e.YNc(1,ni,8,2,"div",1),e.YNc(2,ri,2,0,"div",2)),2&i&&(e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u],styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}",".table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n    text-align: center;\n    vertical-align: middle;\n  }"]}),o})();const ai=["genericGridSO"],si=["genericPerformaInvoiceGridSO"],ci=["genericCancelSales"],li=["popupCustomerCreation"],di=["genericGridMemberShip"],hi=["genericGridsalesMan"],pi=["genericReverseInvoiceGridSO"],ui=["genericGridSalesManRoute"],Si=["genericGridCustomerListBySalesmanAndRoute"];function Mi(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"div",22)(2,"span")(3,"b"),e._uU(4,"SO Qty:"),e.qZA(),e._uU(5),e.qZA()(),e.TgZ(6,"div",28)(7,"span")(8,"b"),e._uU(9,"Rate:"),e.qZA(),e._uU(10),e.ALo(11,"currency"),e.qZA()(),e.BQk()),2&o){const i=e.oxw(2);e.xp6(5),e.hij("\xa0",i._trnMainService.purchaseOrderQty," \xa0"),e.xp6(5),e.hij("\xa0",e.Dn7(11,2,i._trnMainService.purchaseOrderRate,"INR","Rs. ")," ")}}function vi(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"div",16),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",17)(5,"label",18),e._uU(6),e.qZA(),e.TgZ(7,"div")(8,"voucher-sidebar-billdetail",19),e.NdJ("onMemberIDSearch",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickMemberIDSearch(t))})("onMemberReferIDSearch",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickMemberReferIDSearch(t))})("onClickSlider",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.calculateMemberPointsForView())}),e.qZA()()(),e.TgZ(9,"div",20),e.YNc(10,Mi,12,6,"ng-container",21),e.qZA(),e.TgZ(11,"div",22)(12,"voucher-master-action",23),e.NdJ("onLoadFromSOClickEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showLoadFromSOPopup(t))})("onLoadFromPerformaInvoiceClickEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showApprovedPreformaInvoicePopup(t))})("onLoadCancelSalesEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showSalesDayWise(t))})("onClickSalesMan",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onClickNewSalesman(t))})("onLoadFromReverseEntryEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.showReverseVoucherInvoicePopup(t))})("onclickOnResetPopupEmit",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onclickOnResetPopupEmit(t))})("onSaveSelfBilling",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onclickOnResetPopupEmit(t))}),e.qZA(),e.TgZ(13,"generic-popup-grid",9,24),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onSalesOrderSelect(t))}),e.qZA(),e.TgZ(15,"generic-popup-grid",9,25),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onPerformaInvoiceSelect(t))}),e.qZA(),e.TgZ(17,"generic-popup-grid",9,26),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onSalesCancelSelect(t))}),e.qZA(),e.TgZ(19,"generic-popup-grid",9,27),e.NdJ("onItemDoubleClick",function(t){e.CHM(i);const n=e.oxw();return e.KtG(n.onReverseEntrySelect(t))}),e.qZA()()()()}if(2&o){const i=e.oxw();e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",0!=i.userSetting.ENABLE_SOINTI&&i._trnMainService.TrnMainObj.REFORDBILL),e.xp6(3),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridPerformaInvoicePopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridcancelSalesPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridReverseEntryPopupSettings)}}function gi(o,s){1&o&&(e.TgZ(0,"div",6),e._UZ(1,"discounts-insert"),e.qZA())}function _i(o,s){if(1&o&&(e.TgZ(0,"div",29)(1,"div",30),e._UZ(2,"trnmain-parameters-master",31),e.qZA(),e.TgZ(3,"div",5),e.YNc(4,gi,2,0,"div",32),e.qZA()()),2&o){const i=e.oxw();e.xp6(1),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(3),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling)}}function mi(o,s){1&o&&(e.TgZ(0,"div",33),e._UZ(1,"voucher-total-area"),e.qZA())}let Ti=(()=>{class o{constructor(i,r,t,n,a,l,h){this.masterService=i,this._trnMainService=r,this.route=t,this.alertService=n,this.loadingSerive=a,this.authservice=l,this.changeDetection=h,this.hideShow=!1,this.gridPopupSettingsForMember=new p.im,this.gridPopupSettingsalesMan=new p.im,this.gridReverseEntryPopupSettings=new p.im,this.salesManList=[],this.routerMasterList=[],this.userProfile={},this.RouteList=[],this.CustomerList=[],this.applyReferValue=!1,this.costlists=[],this.gridPopupSettings=new p.im,this.gridPerformaInvoicePopupSettings=new p.im,this.gridcancelSalesPopupSettings=new p.im,this.gridPopupSettingsForSalesManRoute=new p.im,this.gridPopupSettingsForCustomerListBySalesmanAndRoute=new p.im,i.Currencies=[],i.getCurrencies().subscribe(c=>{i.Currencies=c}),this.userProfile=l.getUserProfile(),this.userSetting=this.authservice.getSetting(),"export-sales-invoice"===this.route.snapshot.url[0].path&&(this._trnMainService.initialFormLoad(14),this._trnMainService.TrnMainObj.CNDN_MODE=10,this.getSalesManList()),this.masterService.getSalesmanList().subscribe(c=>{this.salesManList.push(c)}),this.gridPopupSettings={title:"Sales Vouchers",apiEndpoints:"/getTrnMainPagedList/SO/tag",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TRNAC",title:"Trn. A/c",hidden:!1,noSearch:!1},{key:"PhiscalId",title:"Fiscal Year",hidden:!1,noSearch:!1}]},this.gridPerformaInvoicePopupSettings=1==this.userSetting.EnableGRNInPIForCargo?{title:"Approved Proforma Vouchers",apiEndpoints:"/getProformaVoucherListFromCargo",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"BOOKINGID",title:"Booking ID",hidden:!1,noSearch:!1}]}:{title:"Approved Proforma Vouchers",apiEndpoints:"/getApprovedHOPerformaInvoicePagedList/null",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1},{key:"BILLTOTEL",title:"VAT NO.",hidden:!1,noSearch:!1}]},this.gridcancelSalesPopupSettings={title:"Sales Invoice ",apiEndpoints:"/getTrnMainDateWisePagedList/TI",defaultFilterIndex:0,columns:[{key:"CHALANNO",title:"BILL NO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"TRNMODE",title:"TYPE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]},this.gridReverseEntryPopupSettings={title:"Reverse Entry VoucherList",apiEndpoints:"/getReverseEntryPagedList",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TRNAC",title:"Trn. A/c",hidden:!1,noSearch:!1},{key:"PhiscalId",title:"Fiscal Year",hidden:!1,noSearch:!1}]},this.route.queryParams.subscribe(c=>{"DRILL"!=c.mode&&("FROMSI"==c.mode?(this.masterService.TempTrnMainObj.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,this.masterService.TempTrnMainObj.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,this.masterService.TempTrnMainObj.VoucherType=D.Km.TaxInvoice,this._trnMainService.TrnMainObj=this.masterService.TempTrnMainObj,this.masterService.getCustomerIDFromCProfile(c.ID).subscribe(v=>{v.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=v[0].CUSTID),this._trnMainService.TrnMainObj.PARAC=c.ID})):c.voucher&&this.getSelectedPerformaInvoice(c.voucher))})}updown(i){"F10"==i.code&&this.calculateMemberPointsForView()}ngAfterContentChecked(){this.changeDetection.detectChanges()}getMemberShipList(){this.gridPopupSettingsForMember=this.masterService.getGenericGridPopUpSettings("MemberList")}onclickOnResetPopupEmit(i){console.log("event"),this.setLoginDivisionName()}getSalesManList(){this.gridPopupSettingsalesMan=this.masterService.getGenericGridPopUpSettings("SalesManList")}setLoginDivisionName(){this.masterService.getloginDivisionName().subscribe(i=>{console.log("get login divison ",i),"ok"==i.status&&(i.result?(this._trnMainService.TrnMainObj.BILLTO=i.result.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.result.ACID,this._trnMainService.TrnMainObj.PARAC=i.result.ACID,this._trnMainService.TrnMainObj.VATNO=i.result.VATNO,this._trnMainService.TrnMainObj.BILLTOTEL=i.result.VATNO,this._trnMainService.TrnMainObj.BILLTOADD=i.result.ADDRESS,this._trnMainService.TrnMainObj.TRNACName=i.result.ACNAME):this.alertService.warning("Please set default account for the current division."))},i=>{this.alertService.warning("Please set default account for the current division")})}onSalesManSelect(i){this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.SALESMAN=i.NAME,this._trnMainService.salesmanID=i.SALESMANID,this._trnMainService.salesmanName=i.NAME,this.getSalesManRouteList(),this.genericGridSalesManRoute.show()}onRouteSelect(i){this._trnMainService.doubleClick=!0,this._trnMainService.TrnMainObj.SALESMANID=i.SALESMANID,this._trnMainService.TrnMainObj.ROUTE=i.RouteCode,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,this._trnMainService.getCustomerListRouteAndSalesmanWise(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE),this.getCustomerList(),this.genericGridCustomerListBySalesmanAndRoute.show()}onCustomerSelected(i){this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.BILLTOTEL=i.VATNO,this._trnMainService.TrnMainObj.BILLTOADD=i.ADDRESS,this._trnMainService.TrnMainObj.BILLTOMOB=i.MOBILE,this._trnMainService.TrnMainObj.TRNACName=i.ACNAME,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""===i.PMODE?"credit":i.PMODE}getSalesManRouteList(){this.gridPopupSettingsForSalesManRoute=this.masterService.getGenericGridSettintForSalemanRoute(this._trnMainService.TrnMainObj.SALESMANID)}getCustomerList(){this.gridPopupSettingsForCustomerListBySalesmanAndRoute=this.masterService.getGridSettingForCustomerBySalesmanRoute(this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.TrnMainObj.ROUTE),this.gridPopupSettingsForCustomerListBySalesmanAndRoute={title:"Customers",apiEndpoints:`/getPagedCustomerListBySalesmanAndRoute/${this._trnMainService.TrnMainObj.SALESMANID}/${this._trnMainService.TrnMainObj.ROUTE}`,defaultFilterIndex:this.userSetting.FilterIndexForCustomer,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ACCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}ngAfterViewInit(){1===this.userSetting.ENABLE_SALESMAN_ROUTE&&(this.getSalesManList(),this.genericGridsalesMan.show())}onClickNewSalesman(){1===this.userSetting.ENABLE_SALESMAN_ROUTE&&(this.getSalesManList(),this.genericGridsalesMan.show())}ngOnInit(){this._trnMainService.pageHeading="EXPORT SALES INVOICE",this._trnMainService.TrnMainObj.TRNMODE="credit"}getSalesmanRoute(i){}showLoadFromSOPopup(i){this.genericGridSO.show()}showApprovedPreformaInvoicePopup(i){this.genericPerformaInvoiceGridSO.show()}showSalesDayWise(i){this.genericCancelSales.show()}onPerformaInvoiceSelect(i){1==this.userSetting.EnableGRNInPIForCargo?this.getSelectedPerformaInvoiceCargo(i):this.getSelectedPerformaInvoice(i.VCHRNO)}oncancelSalesSelect(i){}onMemberSelect(i){this.applyReferValue?(this._trnMainService.TrnMainObj.REFERMEMBERNAME=i.FNAME,this._trnMainService.TrnMainObj.REFERMEMBERNO=i.MEMID):(this._trnMainService.TrnMainObj.MEMBERNO=i.MEMID,this._trnMainService.TrnMainObj.MEMBERNAME=i.FNAME,this._trnMainService.TrnMainObj.SCHEMENAME=i.SCHEMEID)}onClickMemberReferIDSearch(i){this.applyReferValue=!0,this.getMemberShipList(),this.genericGridMemberShip.show()}getSelectedPerformaInvoice(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadHoPerformaInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"===r.status){console.log("loaded from proforma",JSON.parse(r.result)),this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW";for(let t=0;t<this._trnMainService.TrnMainObj.ProdList.length;t++)this._trnMainService.TrnMainObj.ProdList[t].inputMode=!1;console.log("firstparac3"),this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC,this._trnMainService.TrnMainObj.TRNACName=this._trnMainService.TrnMainObj.BILLTO,this._trnMainService.TrnMainObj.RECURREFBILL=this._trnMainService.TrnMainObj.REFBILL,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="Export Sales Invoice",this._trnMainService.TrnMainObj.TRNMODE="credit",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.disableOnPerFormaSelect=!0}},r=>{this.loadingSerive.hide()})}getSelectedPerformaInvoiceCargo(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadCargoProdList(i.VCHRNO).subscribe(r=>{this.loadingSerive.hide(),"ok"===r.status&&(this._trnMainService.TrnMainObj.ProdList=r.result,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC,this._trnMainService.TrnMainObj.TRNACName=this._trnMainService.TrnMainObj.BILLTO,this._trnMainService.TrnMainObj.RECURREFBILL=this._trnMainService.TrnMainObj.REFBILL,this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.COUNTRY=i.COUNTRY,this._trnMainService.TrnMainObj.AdditionalObj.TRANSPORTATIONMODE=i.TRANSPORTATIONMODE,this._trnMainService.TrnMainObj.FCurrency=i.FOREIGN_CURR,this._trnMainService.TrnMainObj.EXRATE=i.CurRate,this._trnMainService.TrnMainObj.ProdList.forEach(t=>t.NETAMOUNT=t.AMOUNT),this.getCostCenterforCargo(r),this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="Export Sales Invoice",this._trnMainService.TrnMainObj.AdditionalObj.PAYMENTTERMS="TELEX",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this.calculateCargoTotal(),this._trnMainService.disableOnPerFormaSelect=!0,this._trnMainService.disableCostCenterForCargo=!0)},r=>{this.loadingSerive.hide()})}calculateCargoTotal(){this._trnMainService.TrnMainObj.TOTALSQTY=0,this._trnMainService.TrnMainObj.GROSSAMNT=0,this._trnMainService.TrnMainObj.NONTAXABLE=0,this._trnMainService.TrnMainObj.NETAMNT=0,this._trnMainService.TrnMainObj.TOTAMNT=0,this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.TOTALSQTY+=i.ALTERNATEQUANTIY,this._trnMainService.TrnMainObj.GROSSAMNT+=i.AMOUNT,this._trnMainService.TrnMainObj.NONTAXABLE=this._trnMainService.TrnMainObj.GROSSAMNT,this._trnMainService.TrnMainObj.NETAMNT=this._trnMainService.TrnMainObj.GROSSAMNT,this._trnMainService.TrnMainObj.TOTAMNT=this._trnMainService.TrnMainObj.GROSSAMNT})}getCostCenterforCargo(i){this.masterService.getAllCostCenter().subscribe(r=>{this.costlists=r;let t=this.costlists.filter(n=>n.COSTCENTERNAME==i.result[0].BOOKINGID);t&&(this._trnMainService.TrnMainObj.COSTCENTER=t[0].CCID)},r=>{this.costlists=[]})}onSalesOrderSelect(i){this.masterService.loadSalesInvoiceFromSalesOrder(i.VCHRNO).subscribe(r=>{if("ok"===r.status){if(this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW",!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||void 0===this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.TransporterEway={},this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let n in this._trnMainService.TrnMainObj.ProdList){this._trnMainService.setAltunitDropDownForView(n),this._trnMainService.AssignSellingPriceAndDiscounts(this._trnMainService.TrnMainObj.ProdList[n].PClist,n);let a=this._trnMainService.TrnMainObj.ProdList[n].ALTUNITObj;this._trnMainService.RealQuantitySet(n,null==a?1:a.CONFACTOR),this._trnMainService.TrnMainObj.ProdList[n].MFGDATE=null==this._trnMainService.TrnMainObj.ProdList[n].MFGDATE?"":this._trnMainService.TrnMainObj.ProdList[n].MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].EXPDATE=null==this._trnMainService.TrnMainObj.ProdList[n].EXPDATE?"":this._trnMainService.TrnMainObj.ProdList[n].EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,this._trnMainService.TrnMainObj.ProdList[n].VCHRNO=this._trnMainService.TrnMainObj.VCHRNO;let h=0;this._trnMainService.TrnMainObj.ProdList[n].inputMode=!0,h=this._trnMainService.TrnMainObj.ProdList[n].PRATE}var t=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK<=0);this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SELECTEDITEM.STOCK>0),this._trnMainService.ReCalculateBillWithNormal(),null!=t&&t.length>0&&this.alertService.error("Some Of the item have been excluded because of unavailable Stock")}},r=>{})}onItemDoubleClick(i){this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.loadSODataToSales(i.VCHRNO)}onSalesCancelSelect(i){this.loadTaxInvoiceForCancel(i.VCHRNO,i.DIVISION,i.PhiscalId)}onClickMemberIDSearch(i){this.getMemberShipList(),this.genericGridMemberShip.show()}loadTaxInvoiceForCancel(i,r,t){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.LoadTransaction(i,r,t).subscribe(n=>{if(this.loadingSerive.hide(),"ok"===n.status){this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherType=61,this._trnMainService.pageHeading="Export Sales Invoice [Cancel]",this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate();for(let a in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.setAltunitDropDownForViewStock(a),this._trnMainService.getPricingOfItem(a,"",!0),this._trnMainService.TrnMainObj.ProdList[a].inputMode=!1}},n=>{this.loadingSerive.hide()})}getRouteListSalesmanWise(i){this.masterService.getRouteListBasedUponSalesman(i).subscribe(r=>{this.RouteList=r})}onClickCreateCustomer(){}onClickCustomerHide(){}DisplayCustomerProfile(i){!1===i&&this.popupCustomerCreation.show()}calculateMemberPointsForView(){this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length&&this.masterService.postMemberPointCalculation(this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result.pointsGained)})}onClickPoReferenceProduct(i){i&&(this._trnMainService.purchaseOrderQty=i.ALTERNATEQTY,this._trnMainService.purchaseOrderRate=i.RATE)}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList.length>1&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE))}showReverseVoucherInvoicePopup(i){this.genericReverseInvoiceGridSO.show()}onReverseEntrySelect(i){this.getReverseInvoice(i.VCHRNO)}getReverseInvoice(i){this.loadingSerive.show("Getting data, Please wait..."),this.masterService.loadReverseInvoice(i).subscribe(r=>{if(this.loadingSerive.hide(),"ok"===r.status){this._trnMainService.TrnMainObj=JSON.parse(r.result),this._trnMainService.TrnMainObj.Mode="NEW";for(let t=0;t<this._trnMainService.TrnMainObj.ProdList.length;t++)this._trnMainService.TrnMainObj.ProdList[t].inputMode=!1;console.log("firstparac5"),this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC,this._trnMainService.TrnMainObj.TRNACName=this._trnMainService.TrnMainObj.BILLTO,this._trnMainService.TrnMainObj.REFBILL=i,this._trnMainService.TrnMainObj.VoucherPrefix="TI",this._trnMainService.TrnMainObj.VoucherType=14,this._trnMainService.pageHeading="Export Sales Invoice",this._trnMainService.TrnMainObj.TRNMODE="credit",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.disableOnPerFormaSelect=!0}},r=>{this.loadingSerive.hide()})}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(f.P),e.Y36(S.p),e.Y36(O.gz),e.Y36(P.c),e.Y36(A.V),e.Y36(I.e),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-exportsales-invoice"]],viewQuery:function(i,r){if(1&i&&(e.Gf(ai,5),e.Gf(si,5),e.Gf(ci,5),e.Gf(li,5),e.Gf(di,5),e.Gf(hi,5),e.Gf(pi,5),e.Gf(ui,5),e.Gf(Si,5)),2&i){let t;e.iGM(t=e.CRH())&&(r.genericGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericPerformaInvoiceGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericCancelSales=t.first),e.iGM(t=e.CRH())&&(r.popupCustomerCreation=t.first),e.iGM(t=e.CRH())&&(r.genericGridMemberShip=t.first),e.iGM(t=e.CRH())&&(r.genericGridsalesMan=t.first),e.iGM(t=e.CRH())&&(r.genericReverseInvoiceGridSO=t.first),e.iGM(t=e.CRH())&&(r.genericGridSalesManRoute=t.first),e.iGM(t=e.CRH())&&(r.genericGridCustomerListBySalesmanAndRoute=t.first)}},hostBindings:function(i,r){1&i&&e.NdJ("keydown",function(n){return r.updown(n)},!1,e.evT)},features:[e._Bn([S.p])],decls:17,vars:7,consts:[[1,"sectionWrapper"],[1,"topWrapper"],["class","sticky-top",4,"ngIf"],["class","main-container",4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"onClickItemSelectPopUp"],["class","footer-wrapper",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridMemberShip",""],["genericGridsalesMan",""],["genericGridSalesManRoute",""],["genericGridCustomerListBySalesmanAndRoute",""],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-145px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[3,"onMemberIDSearch","onMemberReferIDSearch","onClickSlider"],[1,"col-md-2","row",2,"padding-top","0.8vh","font-size","15px","font-style","italic","padding-left","0px","padding-right","0px"],[4,"ngIf"],[1,"col-md-5","pd0"],[3,"onLoadFromSOClickEmit","onLoadFromPerformaInvoiceClickEmit","onLoadCancelSalesEmit","onClickSalesMan","onLoadFromReverseEntryEmit","onclickOnResetPopupEmit","onSaveSelfBilling"],["genericGridSO",""],["genericPerformaInvoiceGridSO",""],["genericCancelSales",""],["genericReverseInvoiceGridSO",""],[1,"col-md-7","pd0"],[1,"main-container"],[3,"hidden"],["viewDisable","disableView"],["class","col-md-12 pd5",4,"ngIf"],[1,"footer-wrapper"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,vi,21,7,"div",2),e.YNc(3,_i,5,2,"div",3),e.qZA(),e.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"productentry",7),e.NdJ("onClickItemSelectPopUp",function(n){return r.onClickPoReferenceProduct(n)}),e.qZA()()()(),e.YNc(8,mi,2,0,"div",8),e.qZA(),e.TgZ(9,"generic-popup-grid",9,10),e.NdJ("onItemDoubleClick",function(n){return r.onMemberSelect(n)}),e.qZA(),e.TgZ(11,"generic-popup-grid",9,11),e.NdJ("onItemDoubleClick",function(n){return r.onSalesManSelect(n)}),e.qZA(),e.TgZ(13,"generic-popup-grid",9,12),e.NdJ("onItemDoubleClick",function(n){return r.onRouteSelect(n)}),e.qZA(),e.TgZ(15,"generic-popup-grid",9,13),e.NdJ("onItemDoubleClick",function(n){return r.onCustomerSelected(n)}),e.qZA()),2&i&&(e.xp6(2),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(5),e.Q6J("ngIf",!r._trnMainService.TrnMainObj.hasShipName),e.xp6(1),e.Q6J("popupsettings",r.gridPopupSettingsForMember),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsalesMan),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForSalesManRoute),e.xp6(2),e.Q6J("popupsettings",r.gridPopupSettingsForCustomerListBySalesmanAndRoute))},dependencies:[M.O5,E.x,j.M,N.q,L.i,R.u,U.d,p.Zl,F.o,M.H9],styles:[".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}",".table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n    text-align: center;\n    vertical-align: middle;\n  }"]}),o})();var fi=d(16738),Oi=d.n(fi);const Ci=["genericViewpopup"];function bi(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"button",6,31),e.NdJ("click",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.saveDenomination())}),e._uU(2,"Save"),e.qZA()}}function Pi(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"button",6,31),e.NdJ("click",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.onPrint())}),e._uU(2,"Print"),e.qZA()}}function Ai(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"tr")(1,"td",32),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"input",33),e.NdJ("change",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.calculateDenomination())})("ngModelChange",function(t){const a=e.CHM(i).$implicit;return e.KtG(a.qty=t)}),e.qZA()(),e.TgZ(5,"td",34),e._uU(6),e.qZA()()}if(2&o){const i=s.$implicit,r=e.oxw();e.xp6(2),e.Oqu(i.denO_NAME),e.xp6(2),e.Q6J("ngModel",i.qty)("disabled",r.disableonview),e.xp6(2),e.hij(" ",i.amount," ")}}function Ii(o,s){1&o&&e.GkF(0)}function Ei(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",35)(1,"div",36)(2,"div",37)(3,"h4",38),e._uU(4,"Print Preview"),e.qZA()(),e.TgZ(5,"div",39)(6,"pre"),e._uU(7),e.qZA()(),e.TgZ(8,"div",40)(9,"button",41),e.NdJ("click",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.cancelprint())}),e._uU(10," Close "),e.qZA(),e.TgZ(11,"button",42),e.NdJ("click",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.printPosBill())}),e._uU(12," Print "),e.qZA()()()()}if(2&o){const i=e.oxw();e.xp6(7),e.hij("        ",i.print,"\n      ")}}const Ri=O.Bz.forChild([{path:"",component:Oe,children:[{path:"export-sales-invoice",component:Ti,canActivate:[T.C]},{path:"add-sales-invoice",component:G,canActivate:[T.C]},{path:"add-sales-invoice-wholesale",component:G,canActivate:[T.C]},{path:"abbreviated-sales-invoice",component:G,canActivate:[T.C]},{path:"self-billing",component:G,canActivate:[T.C]},{path:"add-creditnote-itembase",component:fe,canActivate:[T.C]},{path:"canceladdsientry",component:je,canActivate:[T.C]},{path:"performa-invoice",component:Fe,canActivate:[T.C]},{path:"salesorder",component:J,canActivate:[T.C]},{path:"quotation",component:ei,canActivate:[T.C]},{path:"add-membership-sales-invoice",component:oi,canActivate:[T.C]},{path:"cash-handover",component:(()=>{class o{constructor(i,r,t,n,a){this.authService=i,this.masterService=r,this._trnMainService=t,this.alertService=n,this.loadingservice=a,this.total=0,this.screenOne=!0,this.counterArray=[],this.denoArray=[],this.amountArray=[],this.showPosPrinterPreview=!1,this.settlementAmount=0,this.disableonview=!1,this.promptPrintDevice=!1,this.genericGridViewSettings=new p.im}ngOnInit(){this.userProfile=this.authService.getUserProfile(),this.obj={VoucherPrefix:"CS",DIVISION:this.userProfile.userDivision,PhiscalID:this.userProfile.PhiscalYearInfo.PhiscalID,VoucherName:"Cash Settlement"},this.masterService.masterGetmethod("/getDenominationList").subscribe(i=>{"ok"==i.status&&(this.denoList=i.result)}),this.masterService.getVoucherNo(this.obj).subscribe(i=>{this.userSettlement=i.result.VCHRNO})}enableSaveButton(){return!!Oi()(new Date).isSame(this.date,"day")}changeMorningCash(i){this.calculateDenomination()}changeCashTaken(i){this.calculateDenomination()}dateChange(i){this.noOfBills=null,this.noOfItems=null,this.totalSales=null,this.discountAmount=null,this.modeOfPaymentList=null,this.date=i.target.value}reset(){this.masterService.masterGetmethod("/getDenominationList").subscribe(i=>{"ok"==i.status&&(this.denoList=i.result)}),this.masterService.getVoucherNo(this.obj).subscribe(i=>{this.userSettlement=i.result.VCHRNO}),this.disableonview=!1,this.total=0}canclePreview(){this.showPosPrinterPreview=!1}calculateDenomination(){this.total=this.masterService.nullToZeroConverter(this.morningCash)-this.masterService.nullToZeroConverter(this.cashTaken);for(let i of this.denoList)i.amount=this.masterService.nullToZeroConverter(i.qty)*i.basevalue,this.total=this.total+i.amount}changeScreen(){this.screenOne=1!=this.screenOne}saveDenomination(){this.denoList.forEach(i=>{i.morning_cash=this.morningCash,i.cash_taken=this.cashTaken,i.total=this.total}),this.loadingservice.show("Saving data, please wait.."),this.masterService.saveDenomination(this.denoList).subscribe(i=>{"ok"==i.status?(this.loadingservice.hide(),this.alertService.success("Data Saved SuccessFully"),this.masterService.getVoucherNo(this.obj).subscribe(r=>{this.userSettlement=r.result.VCHRNO}),this.denoList.forEach(r=>{r.amount=0,r.qty=0}),this.total=0,this.onPrint()):(this.loadingservice.hide(),this.alertService.warning(i.result.error))},i=>{this.loadingservice.hide()})}printPosBill(i){var r;(r=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function n(){},!1),r.addEventListener("open",function t(a){alert("Are you sure to print?"),r.onopen=()=>r.send(a)}(this.print),!1),this.showPosPrinterPreview=!1}printDayEndBill(){this.printPosBill(this.print)}onPrint(){null==this.userSettlement||null==this.userSettlement||""==this.userSettlement||this.masterService.masterGetmethod(`/getprintCashHandover?dateTime=${this.date}&sessionId=${this.userSettlement}`).subscribe(i=>{this.print=i.result,console.log("print",i.result),this.showPosPrinterPreview=!0})}denoprint(){let i=[];this.denoList.forEach(r=>{i.push({Qty:r.qty+"  =",amount:r.amount,deno_name:r.denO_NAME+"  X"})}),i.push({Qty:this.denoList.reduce((r,t)=>r+(t.qty||0),0),amount:this.denoList.reduce((r,t)=>r+(t.amount||0),0),deno_name:"TOTAL   "}),this.masterService.masterPostmethod("/getDenoPrint",i).subscribe(r=>{this.print=r.result,this.showPosPrinterPreview=!0})}viewDenomination(){this.genericGridViewSettings={title:"Cash",apiEndpoints:"/getCashSettlementPagedList",defaultFilterIndex:1,columns:[{key:"Date",title:"Date",hidden:!1,noSearch:!1},{key:"User",title:"User",hidden:!1,noSearch:!1},{key:"SESSIONID",title:"Cash settlement ID",hidden:!1,noSearch:!1},{key:"Amount",title:"Total Amount",hidden:!1,noSearch:!1,alignment:"right"}]},this.genericViewpopup.show()}onCachSettlementSelect(i){this.masterService.masterGetmethod(`/getCashSettlementFromID?sessionID=${i.SESSIONID}`).subscribe(r=>{"ok"==r.status?(this.denoList=r.result,this.total=r.result.map(t=>t.amount).reduce((t,n)=>t+n),this.date=r.result[0].TRNDATE.toString().substring(0,10),this.userSettlement=r.result[0].SESSIONID,this.disableonview=!0):this.alertService.error(r.result)},r=>{this.alertService.error(r)})}cancelprint(){this.promptPrintDevice=!1,this.showPosPrinterPreview=!1}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(I.e),e.Y36(f.P),e.Y36(S.p),e.Y36(P.c),e.Y36(A.V))},o.\u0275cmp=e.Xpm({type:o,selectors:[["cash-handover"]],viewQuery:function(i,r){if(1&i&&e.Gf(Ci,5),2&i){let t;e.iGM(t=e.CRH())&&(r.genericViewpopup=t.first)}},decls:52,vars:14,consts:[[1,"sticky-top","row"],[1,"col-md-4"],[2,"white-space","nowrap","margin-bottom","8px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-8",2,"padding-right","3vw"],[1,"row","pull-right"],["type","button","class","btn  btn-info","style","font-size: 12px;",3,"click",4,"ngIf"],["type","button",1,"btn","btn-info",2,"font-size","12px",3,"click"],["view",""],[1,"card"],[1,"card-body"],[1,"row","col-md-12","plainBackGround",2,"margin","0px !important","padding","0","height","2.5rem"],[1,"row"],[2,"width","25%"],["type","date","name","date",1,"head",2,"margin-left","-10%",3,"max","ngModel","disabled","change","ngModelChange"],[2,"width","14%","margin-left","-15%"],["type","text","readonly","",1,"head",2,"width","70%",3,"ngModel","disabled","ngModelChange"],[2,"width","31%","margin-left","-14%"],["type","text","readonly","",1,"head",2,"width","70%","margin-left","4%",3,"ngModel","disabled","ngModelChange"],[2,"padding","0 !important","margin-top","2rem"],[2,"display","flex","justify-content","center"],[1,"tableBorder",2,"padding","10px","width","60%"],[2,"background-color","#f7f7f7","padding-left","10px"],[2,"padding-left","10px","background-color","#f7f7f7"],[2,"background-color","#f7f7f7"],[4,"ngFor","ngForOf"],["colspan","2"],["colspan","2",2,"background-color","#f7f7f7","text-align","end"],[3,"popupsettings","onItemDoubleClick"],["genericViewpopup",""],[4,"ngIf","ngIfThen"],["printPopup",""],["save",""],[2,"padding-left","10px"],["type","number",2,"text-align","end",3,"ngModel","disabled","change","ngModelChange"],[2,"background-color","#f7f7f7","text-align","end"],[1,"print-modal-sticky"],[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-header"],["id","myModalLabel",1,"modal-title"],[1,"modal-body",2,"height","320px","overflow-y","scroll"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,r){if(1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"CASH HANDOVER"),e.qZA()(),e.TgZ(4,"div",3)(5,"div",4),e.YNc(6,bi,3,0,"button",5),e.YNc(7,Pi,3,0,"button",5),e.TgZ(8,"button",6),e.NdJ("click",function(){return r.reset()}),e._uU(9,"Reset"),e.qZA(),e.TgZ(10,"button",6,7),e.NdJ("click",function(){return r.viewDenomination()}),e._uU(12,"View"),e.qZA()()()(),e.TgZ(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",1)(17,"div",11)(18,"label",12),e._uU(19,"Date :"),e.qZA(),e.TgZ(20,"input",13),e.NdJ("change",function(n){return r.dateChange(n)})("ngModelChange",function(n){return r.date=n}),e.qZA()()(),e.TgZ(21,"div",1)(22,"div",11)(23,"label",14),e._uU(24,"User:"),e.qZA(),e.TgZ(25,"input",15),e.NdJ("ngModelChange",function(n){return r.userProfile.username=n}),e.qZA()()(),e.TgZ(26,"div",1)(27,"div",11)(28,"label",16),e._uU(29,"Settlement ID:"),e.qZA(),e.TgZ(30,"input",17),e.NdJ("ngModelChange",function(n){return r.userSettlement=n}),e.qZA()()()(),e.TgZ(31,"div",18)(32,"div",19)(33,"table",20)(34,"tr")(35,"th",21),e._uU(36," Deno "),e.qZA(),e.TgZ(37,"th",22),e._uU(38," Count "),e.qZA(),e.TgZ(39,"th",23),e._uU(40,"Amount"),e.qZA()(),e.YNc(41,Ai,7,4,"tr",24),e.TgZ(42,"tr")(43,"td",25),e._uU(44,"Total"),e.qZA(),e.TgZ(45,"td",26),e._uU(46),e.qZA()()()()()(),e.TgZ(47,"generic-popup-grid",27,28),e.NdJ("onItemDoubleClick",function(n){return r.onCachSettlementSelect(n)}),e.qZA(),e.YNc(49,Ii,1,0,"ng-container",29),e.YNc(50,Ei,13,1,"ng-template",null,30,e.W1O),e.qZA()),2&i){const t=e.MAs(51);e.xp6(6),e.Q6J("ngIf",!r.disableonview),e.xp6(1),e.Q6J("ngIf",r.disableonview),e.xp6(13),e.Q6J("max",r.date)("ngModel",r.date)("disabled",r.disableonview),e.xp6(5),e.Q6J("ngModel",r.userProfile.username)("disabled",r.disableonview),e.xp6(5),e.Q6J("ngModel",r.userSettlement)("disabled",r.disableonview),e.xp6(11),e.Q6J("ngForOf",r.denoList),e.xp6(5),e.Oqu(r.total),e.xp6(1),e.Q6J("popupsettings",r.genericGridViewSettings),e.xp6(2),e.Q6J("ngIf",r.showPosPrinterPreview)("ngIfThen",t)}},dependencies:[M.sg,M.O5,g.Fj,g.wV,g.JJ,g.On,p.Zl],styles:[".print-modal-sticky[_ngcontent-%COMP%]{display:block;padding:0;margin-bottom:25px;height:auto;position:absolute;right:0vw;width:30vw;z-index:9999999}",".GRNPopUp[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.GRNPopUp[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#123456!important;color:#fff}.modal-dialog.modal-md[_ngcontent-%COMP%], .modal-dialog.modal-sm[_ngcontent-%COMP%]{top:45%;margin-top:0}",".card[_ngcontent-%COMP%] {\n  width: 85%;\n  margin:0 auto;\n}\n\n input[_ngcontent-%COMP%]{\n    height: 26px;\n }\n\n .head[_ngcontent-%COMP%]{\n    margin-top: 3px;\n\n }"]}),o})(),canActivate:[T.C]}]}]);var ji=d(21919),yi=d(74263),Di=d(60694),wi=d(7782),xi=d(48063),ki=d(33612),Fi=d(32404),Zi=d(56209),Gi=d(18177),Ui=d(64548),Hi=d(76018),Vi=d(2847),Bi=d(11728);let qi=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[T.C,S.p,q.M,yi.R,Di.T,wi.y,xi.h,ki.i,Fi.i],imports:[M.ez,Y.h,ji.k.forRoot(),Ri,Zi.u,Gi.$,Ui.x]}),o})();e.B6R(G,function(){return[M.O5,E.x,j.M,N.q,L.i,R.u,U.d,b.U,p.Zl,F.o,Q.j,Hi.E]},function(){return[M.H9]}),e.B6R(J,function(){return[M.O5,Vi.v,E.x,N.q,L.i,R.u,b.U,F.o,Bi.q]},function(){return[M.H9]})}}]);