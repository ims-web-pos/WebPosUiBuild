"use strict";var ao=Object.defineProperty,co=(ve,ce,b)=>ce in ve?ao(ve,ce,{enumerable:!0,configurable:!0,writable:!0,value:b}):ve[ce]=b,Sr=(ve,ce,b)=>(co(ve,"symbol"!=typeof ce?ce+"":ce,b),b);(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[3145],{93105:ve=>{var e,ce="object"==typeof Reflect?Reflect:null,b=ce&&"function"==typeof ce.apply?ce.apply:function(m,I,P){return Function.prototype.apply.call(m,I,P)};e=ce&&"function"==typeof ce.ownKeys?ce.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var O=Number.isNaN||function(m){return m!=m};function M(){M.init.call(this)}ve.exports=M,ve.exports.once=function y(x,m){return new Promise(function(I,P){function w(U){x.removeListener(m,Q),P(U)}function Q(){"function"==typeof x.removeListener&&x.removeListener("error",w),I([].slice.call(arguments))}L(x,m,Q,{once:!0}),"error"!==m&&function f(x,m,I){"function"==typeof x.on&&L(x,"error",m,I)}(x,w,{once:!0})})},M.EventEmitter=M,M.prototype._events=void 0,M.prototype._eventsCount=0,M.prototype._maxListeners=void 0;var ee=10;function $(x){if("function"!=typeof x)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function S(x){return void 0===x._maxListeners?M.defaultMaxListeners:x._maxListeners}function J(x,m,I,P){var w,Q,U;if($(I),void 0===(Q=x._events)?(Q=x._events=Object.create(null),x._eventsCount=0):(void 0!==Q.newListener&&(x.emit("newListener",m,I.listener?I.listener:I),Q=x._events),U=Q[m]),void 0===U)U=Q[m]=I,++x._eventsCount;else if("function"==typeof U?U=Q[m]=P?[I,U]:[U,I]:P?U.unshift(I):U.push(I),(w=S(x))>0&&U.length>w&&!U.warned){U.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=x,B.type=m,B.count=U.length,function t(x){console&&console.warn&&console.warn(x)}(B)}return x}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(x,m,I){var P={fired:!1,wrapFn:void 0,target:x,type:m,listener:I},w=C.bind(P);return w.listener=I,P.wrapFn=w,w}function Z(x,m,I){var P=x._events;if(void 0===P)return[];var w=P[m];return void 0===w?[]:"function"==typeof w?I?[w.listener||w]:[w]:I?function j(x){for(var m=new Array(x.length),I=0;I<m.length;++I)m[I]=x[I].listener||x[I];return m}(w):X(w,w.length)}function k(x){var m=this._events;if(void 0!==m){var I=m[x];if("function"==typeof I)return 1;if(void 0!==I)return I.length}return 0}function X(x,m){for(var I=new Array(m),P=0;P<m;++P)I[P]=x[P];return I}function L(x,m,I,P){if("function"==typeof x.on)P.once?x.once(m,I):x.on(m,I);else{if("function"!=typeof x.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(m,function w(Q){P.once&&x.removeEventListener(m,w),I(Q)})}}Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return ee},set:function(x){if("number"!=typeof x||x<0||O(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");ee=x}}),M.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},M.prototype.setMaxListeners=function(m){if("number"!=typeof m||m<0||O(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},M.prototype.getMaxListeners=function(){return S(this)},M.prototype.emit=function(m){for(var I=[],P=1;P<arguments.length;P++)I.push(arguments[P]);var w="error"===m,Q=this._events;if(void 0!==Q)w=w&&void 0===Q.error;else if(!w)return!1;if(w){var U;if(I.length>0&&(U=I[0]),U instanceof Error)throw U;var B=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw B.context=U,B}var q=Q[m];if(void 0===q)return!1;if("function"==typeof q)b(q,this,I);else{var W=q.length,re=X(q,W);for(P=0;P<W;++P)b(re[P],this,I)}return!0},M.prototype.on=M.prototype.addListener=function(m,I){return J(this,m,I,!1)},M.prototype.prependListener=function(m,I){return J(this,m,I,!0)},M.prototype.once=function(m,I){return $(I),this.on(m,_(this,m,I)),this},M.prototype.prependOnceListener=function(m,I){return $(I),this.prependListener(m,_(this,m,I)),this},M.prototype.off=M.prototype.removeListener=function(m,I){var P,w,Q,U,B;if($(I),void 0===(w=this._events))return this;if(void 0===(P=w[m]))return this;if(P===I||P.listener===I)0==--this._eventsCount?this._events=Object.create(null):(delete w[m],w.removeListener&&this.emit("removeListener",m,P.listener||I));else if("function"!=typeof P){for(Q=-1,U=P.length-1;U>=0;U--)if(P[U]===I||P[U].listener===I){B=P[U].listener,Q=U;break}if(Q<0)return this;0===Q?P.shift():function H(x,m){for(;m+1<x.length;m++)x[m]=x[m+1];x.pop()}(P,Q),1===P.length&&(w[m]=P[0]),void 0!==w.removeListener&&this.emit("removeListener",m,B||I)}return this},M.prototype.removeAllListeners=function(m){var I,P,w;if(void 0===(P=this._events))return this;if(void 0===P.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==P[m]&&(0==--this._eventsCount?this._events=Object.create(null):delete P[m]),this;if(0===arguments.length){var U,Q=Object.keys(P);for(w=0;w<Q.length;++w)"removeListener"!==(U=Q[w])&&this.removeAllListeners(U);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(I=P[m]))this.removeListener(m,I);else if(void 0!==I)for(w=I.length-1;w>=0;w--)this.removeListener(m,I[w]);return this},M.prototype.listeners=function(m){return Z(this,m,!0)},M.prototype.rawListeners=function(m){return Z(this,m,!1)},M.listenerCount=function(x,m){return"function"==typeof x.listenerCount?x.listenerCount(m):k.call(x,m)},M.prototype.listenerCount=k,M.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},82661:(ve,ce,b)=>{b.d(ce,{C:()=>x});var e=b(26215),t=b(54536),O=b(64537),M=b(88692);let ee=(()=>{class m{constructor(P,w){this.dialogref=P,this.data=w,this.heading="Information",this.heading=w.header,this.message$=w.message}authResult(P){this.dialogref.close(P)}}return m.\u0275fac=function(P){return new(P||m)(O.Y36(t.so),O.Y36(t.WI))},m.\u0275cmp=O.Xpm({type:m,selectors:[["result-dialog"]],decls:11,vars:4,consts:[[1,"modal-dialog","modal-md"],[1,"modal-content"],[1,"modal-header","custom-modal-header"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],[1,"modal-body"],[2,"display","inline-block"]],template:function(P,w){1&P&&(O.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),O._uU(4),O.qZA(),O.TgZ(5,"div",4),O.NdJ("click",function(){return w.authResult(!0)}),O._uU(6,"\xd7"),O.qZA()(),O.TgZ(7,"div",5),O._UZ(8,"div",6),O._uU(9),O.ALo(10,"async"),O.qZA()()()),2&P&&(O.xp6(4),O.Oqu(w.heading),O.xp6(5),O.hij(" ",O.lcZ(10,2,w.message$)," "))},dependencies:[M.Ov],encapsulation:2}),m})();var $=b(67297),S=b(53074),J=b(14970),C=b(7976),_=b(67311);function Z(m,I){1&m&&(O.TgZ(0,"h4",5),O._uU(1,"Your Fiscal Year is Changed. Year End Process will generate new sequence for transaction. Would you like to start Inventry year Ending Process ? "),O.qZA())}function k(m,I){1&m&&(O.TgZ(0,"h4",5),O._uU(1,"Your Fiscal Year is Changed.Please do year end process from Online portal and sync the transaction.If you want do back date Sales invoice Click Ok to continue.Thank you... "),O.qZA())}function X(m,I){if(1&m){const P=O.EpF();O.TgZ(0,"button",6),O.NdJ("click",function(){O.CHM(P);const Q=O.oxw();return O.KtG(Q.YesClick())}),O._uU(1,"Yes"),O.qZA()}}function H(m,I){if(1&m){const P=O.EpF();O.TgZ(0,"button",6),O.NdJ("click",function(){O.CHM(P);const Q=O.oxw();return O.KtG(Q.NoClick())}),O._uU(1,"No"),O.qZA()}}function j(m,I){if(1&m){const P=O.EpF();O.TgZ(0,"button",6),O.NdJ("click",function(){O.CHM(P);const Q=O.oxw();return O.KtG(Q.offlinelineOK())}),O._uU(1,"OK"),O.qZA()}}let y=(()=>{class m{constructor(P,w,Q,U,B,q){this.dialogref=P,this.authSerice=w,this.masterService=Q,this.spinnerService=U,this.router=B,this.alertService=q}YesClick(){1!==this.masterService.userSetting.ENABLEOFFLINESALE&&(this.spinnerService.show("Processing...Please Wait..."),this.masterService.masterGetmethod("/yearEndingInventory").subscribe(P=>{"ok"===P.status?(this.authSerice.setSessionVariable("isIYE",1),this.dialogref.close(),this.alertService.success("The year end for inventory are done successfully..."),setTimeout(()=>{console.log("from logout"),this.router.navigate(["login",{logout:"logout"}]).then(()=>{window.location.reload()})},5e3)):(this.spinnerService.hide(),alert(P.result.error))},P=>{this.spinnerService.hide(),alert(JSON.parse(P._body))}))}NoClick(){this.authSerice.setSessionVariable("isIYE",2),this.dialogref.close()}offlinelineOK(){this.authSerice.setSessionVariable("isIYE",2),this.dialogref.close()}}return m.\u0275fac=function(P){return new(P||m)(O.Y36(t.so),O.Y36($.e),O.Y36(S.P),O.Y36(J.V),O.Y36(C.F0),O.Y36(_.c))},m.\u0275cmp=O.Xpm({type:m,selectors:[["inventry-yearend-dialog"]],decls:8,vars:5,consts:[[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-header"],["class","modal-title","id","myModalLabel",4,"ngIf"],[1,"modal-body"],["class","btn btn-info",3,"click",4,"ngIf"],["id","myModalLabel",1,"modal-title"],[1,"btn","btn-info",3,"click"]],template:function(P,w){1&P&&(O.TgZ(0,"div",0)(1,"div",1),O.YNc(2,Z,2,0,"h4",2),O.YNc(3,k,2,0,"h4",2),O.qZA(),O.TgZ(4,"div",3),O.YNc(5,X,2,0,"button",4),O.YNc(6,H,2,0,"button",4),O.YNc(7,j,2,0,"button",4),O.qZA()()),2&P&&(O.xp6(2),O.Q6J("ngIf",1!=w.masterService.userSetting.ENABLEOFFLINESALE),O.xp6(1),O.Q6J("ngIf",1==w.masterService.userSetting.ENABLEOFFLINESALE),O.xp6(2),O.Q6J("ngIf",1!=w.masterService.userSetting.ENABLEOFFLINESALE),O.xp6(1),O.Q6J("ngIf",1!=w.masterService.userSetting.ENABLEOFFLINESALE),O.xp6(1),O.Q6J("ngIf",1==w.masterService.userSetting.ENABLEOFFLINESALE))},dependencies:[M.O5],styles:[".md-dialog-container[_ngcontent-%COMP%]{height:auto!important;width:auto!important;overflow:hidden!important;box-shadow:0!important}.mat-dialog-container[_ngcontent-%COMP%]{background:transparent!important;box-shadow:none!important;margin-left:auto;margin-right:auto;overflow:hidden!important;height:350px!important}.auth-main[_ngcontent-%COMP%]{position:inherit!important;display:inherit!important}.cdk-overlay-pane[_ngcontent-%COMP%], .md-overlay-pane[_ngcontent-%COMP%]{height:auto!important}.cdk-overlay-pane[_ngcontent-%COMP%], .md-overlay-pane[_ngcontent-%COMP%]{flex:1 1 0}"]}),m})();var f=b(71180),L=b(62870);let x=(()=>{class m{constructor(P,w,Q,U,B,q){this.gblstate=P,this._authService=w,this.authenticationService=Q,this.masterService=U,this.router=B,this.dialog=q,this.viewPermission=[],this.userSetting={},this.enableFiscalYearEnd=!1,this.viewPermission=P.getGlobalSetting("View-Permission")||[],this.userSetting=this.masterService.userSetting}canActivate(P,w){const Q=new e.X(""),U=Q.asObservable(),B=this._authService.getAuth();let q="";null!=P.url[0]&&(q=P.url[0].path),console.log("path",q);let W=P.params.mode;if(void 0===W&&(W="list"),!B||!B.profile){Q.next("Your session has expired. You have been logged out of your account in another tab. Please log in again to continue.");const ae=this.dialog.open(ee,{hasBackdrop:!0,data:{header:"Information",message:U}});return this.authenticationService.setCurrentUserValue(null),this.router.navigate(["/login"]),setTimeout(()=>{ae.close()},1e4),!1}if(0===this._authService.getSessionVariable("isIYE")&&(this.dialog.closeAll(),this.dialog.open(y,{hasBackdrop:!0,data:{header:"Information",message:""}}),"dashboard"!==q))return!1;if(B&&B.profile&&"dashboard"===q||"SYSTEMUSER"===this._authService?.getUserProfile()?.username.toUpperCase()&&("division"==q||"payment-mode-master"==q))return!0;("adduser"==q&&"role"==W||"adduser"==q&&"user"==W)&&(W="add"),"adduser"==q&&"editRole"==W&&(W="edit");const re=this._authService.getMenuRight(q,W);return q?!0===re.right||"list"===W&&!0===re.list:!0===re.list||void 0}}return m.\u0275fac=function(P){return new(P||m)(O.LFG(f.q),O.LFG($.e),O.LFG(L.$),O.LFG(S.P),O.LFG(C.F0),O.LFG(t.uw))},m.\u0275prov=O.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},53704:(ve,ce,b)=>{b.d(ce,{x:()=>dr});var e=b(64537),t=b(42326),O=b(28698),M=b(37051),ee=b(82484),$=b(27009),S=b(64752),J=b(71732),C=b(88692),_=b(23815),Z=b(15613),k=b(53074),X=b(87584),H=b(69389),j=b(54536),y=b(20092),f=b(7976),L=b(67311),x=b(67297),m=b(14970),I=b(74263),P=b(60694),w=b(7782),Q=b(48063),U=b(33612),B=b(71800),q=b(98692),W=b(90994);const re=["discountPercentageInput"],ae=["discountAmountInput"],Me=["applyButton"];function G(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div")(1,"div",17)(2,"div",18)(3,"div",19)(4,"h5",20),e._uU(5,"Discount authorization"),e.qZA(),e.TgZ(6,"button",21),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.closeModal())}),e.TgZ(7,"span",22),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",23)(10,"div",24)(11,"div",25)(12,"div",26)(13,"label",27),e._uU(14,"User Name:"),e.qZA(),e.TgZ(15,"div",28)(16,"input",29),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disLimitAuthObj.username=c)}),e.qZA()()()(),e.TgZ(17,"div",25)(18,"div",26)(19,"label",27),e._uU(20,"Password:"),e.qZA(),e.TgZ(21,"div",28)(22,"input",30),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disLimitAuthObj.password=c)}),e.qZA()()()()(),e.TgZ(23,"div",24)(24,"div",25)(25,"div",26)(26,"label",27),e._uU(27,"Discount Percent:"),e.qZA(),e.TgZ(28,"input",31),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disLimitAuthObj.discountRate=c)}),e.qZA()()(),e.TgZ(29,"div",25)(30,"div",26)(31,"label",27),e._uU(32,"Discount Amount:"),e.qZA(),e.TgZ(33,"input",31),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disLimitAuthObj.discountAmt=c)}),e.qZA()()()(),e.TgZ(34,"div",32)(35,"fieldset",33)(36,"legend",34),e._uU(37,"Discount authorization remarks:"),e.qZA(),e.TgZ(38,"textarea",35),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disLimitAuthObj.remarks=c)}),e.qZA()()()(),e.TgZ(39,"div",36)(40,"button",37),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.discountIndAuthConfirm())}),e._uU(41,"Confirm"),e.qZA()()()()()}if(2&v){const r=e.oxw();e.xp6(16),e.Q6J("ngModel",r._trnMainService.disLimitAuthObj.username),e.xp6(6),e.Q6J("ngModel",r._trnMainService.disLimitAuthObj.password),e.xp6(6),e.Q6J("disabled",r._trnMainService.nullToZeroConverter(r._trnMainService.disLimitAuthObj.discountAmt)>0)("ngModel",r._trnMainService.disLimitAuthObj.discountRate),e.xp6(5),e.Q6J("disabled",r._trnMainService.nullToZeroConverter(r._trnMainService.disLimitAuthObj.discountRate)>0)("ngModel",r._trnMainService.disLimitAuthObj.discountAmt),e.xp6(5),e.Q6J("ngModel",r._trnMainService.disLimitAuthObj.remarks)}}let Y=(()=>{class v{constructor(r,l,c,u){this._trnMainService=r,this.alertService=l,this.masterService=c,this.loader=u,this.discountPercentage=0,this.discountAmount=0,this.isActive=!1,this.isPercentageChanged=!1,this.UserDisLimit=this.masterService.userProfile.userRights.filter(R=>"DISLIMIT"==R.right)[0]?.value,this.RoleDisLimit=this.masterService.userProfile.roleRights.find(R=>"DISLIMIT"==R.right).value,this.disLimit=0!=this._trnMainService.nullToZeroConverter(this.UserDisLimit)?this.UserDisLimit:this.RoleDisLimit}ngOnInit(){}submitDiscountValues(){this.discountAmount<0&&(this.discountAmount=0),null!=this.discountAmount&&(this._trnMainService.TrnMainObj.ProdList[this.rowIndex].INDDISCOUNTRATE=this.isPercentageChanged?this.discountPercentage:0,this._trnMainService.TrnMainObj.ProdList[this.rowIndex].INDDISCOUNT=this.discountAmount),this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1,document.getElementById("discountAmt"+this.rowIndex).focus()}show(){this.discountPercentage=null,this.discountAmount=0,this.isActive=!0,setTimeout(()=>this.focusOnDiscountPercentageInput(),0)}hide(){this.isActive=!1}onKeydownHandler(r){["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","End","Insert","Escape"].includes(r.key)&&this.hide()}focusOnDiscountPercentageInput(){this.discountPercentageInput&&this.discountPercentageInput.nativeElement.focus()}onDiscRateChange(r){if(this.discountPercentage=Number(r.target.value),this.discountPercentage<0)return this.discountPercentage=0,void this.alertService.warning("Discount percentage cannot be less than 0");if(this.discountPercentage>100)return this.discountPercentage=0,void this.alertService.warning("Discount percentage cannot be more than 100");if(this.discountPercentage>this.disLimit&&!this._trnMainService.isPurchaseModule()){if(!confirm("Discount limit of :"+this.disLimit+"% exceeded. Do You Want To Ask for Discount Authorization ???"))return this._trnMainService.clearDisAuthValues(),void(this.discountPercentage=0);this._trnMainService.disLimitAuthObj.discountRate=this.discountPercentage,this._trnMainService.showIndDiscountAuth=!0}let l=this._trnMainService.TrnMainObj.ProdList[this.rowIndex].RATE;l=parseFloat(Number(this._trnMainService.nullToZeroConverter(l)).toFixed(3));let c=this._trnMainService.TrnMainObj.ProdList[this.rowIndex].ALTERNATEQUANTIY,u=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.rowIndex].ECSAMOUNT);this.discountAmount=(l*c+u)*(this.discountPercentage/100),this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)).toFixed(2)),this.isPercentageChanged=!0}focusOnDiscountAmountInput(){this.discountAmountInput&&this.discountAmountInput.nativeElement.focus()}onDiscAmountChange(r){if(this.discountAmount=Number(r.target.value),this.discountAmount<0)return this.discountAmount=0,void this.alertService.warning("Discount amount cannot be less than 0");if(this.discountAmount>this._trnMainService.TrnMainObj.ProdList[this.rowIndex].NETAMOUNT)return this.discountAmount=0,void this.alertService.warning("Discount amount cannot be more than "+this._trnMainService.TrnMainObj.ProdList[this.rowIndex].NETAMOUNT);if(this.discountAmount>this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT*this.disLimit/100&&!this._trnMainService.isPurchaseModule()){if(!confirm("Discount limit of :"+this.disLimit+"% exceeded. Do You Want To Ask for Discount Authorization ???"))return this._trnMainService.clearDisAuthValues(),void(this.discountAmount=0);this._trnMainService.disLimitAuthObj.discountAmt=this.discountAmount,this._trnMainService.showIndDiscountAuth=!0}this._trnMainService.TrnMainObj.ProdList[this.rowIndex]?.ISVAT&&1==this._trnMainService.userSetting?.EnableVatExcludingDiscount&&!this._trnMainService.isPurchaseModule()&&(this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)/this._trnMainService.userSetting.VatConRate).toFixed(2))),this.discountPercentage=100*this.discountAmount/this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT,this.discountPercentage=parseFloat(this.discountPercentage.toFixed(3)),this.isPercentageChanged=!1}focusOnApplyButton(){this.applyButton&&this.applyButton.nativeElement.focus()}onKeydown(r,l){("Enter"===r.key||"Tab"===r.key)&&(r.preventDefault(),l?this[l].nativeElement.focus():r.target.focus())}closeModal(){this._trnMainService.clearDisAuthValues(),this.discountAmount=0,this.discountPercentage=0,this._trnMainService.showIndDiscountAuth=!1}discountIndAuthConfirm(){this._trnMainService.disLimitAuthObj.isAuthDisLim=!0,this.loader.show("Authorizing Please wait"),this.masterService.authorizeDiscountLimitInSO(this._trnMainService.disLimitAuthObj).subscribe(r=>{if(this.loader.hide(),"ok"==r.status){let l=0!=this._trnMainService.nullToZeroConverter(r.result.userDisLimit)?r.result.userDisLimit:r.result.roleDisLimit;this._trnMainService.limitValue=this._trnMainService.disLimitAuthObj.discountRate,this.discountPercentage=this._trnMainService.limitValue,this._trnMainService.nullToZeroConverter(this._trnMainService.disLimitAuthObj.discountAmt)>0&&(this._trnMainService.limitValue=100*Number(this._trnMainService.disLimitAuthObj.discountAmt)/this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT,this.discountPercentage=this._trnMainService.limitValue,this.discountAmount=this._trnMainService.disLimitAuthObj.discountAmt,this._trnMainService.TrnMainObj.ProdList[this.rowIndex]?.ISVAT&&1==this._trnMainService.userSetting?.EnableVatExcludingDiscount&&!this._trnMainService.isPurchaseModule()&&(this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)/this._trnMainService.userSetting.VatConRate).toFixed(2)))),this._trnMainService.limitValue>l?(this.alertService.error("Specified discount value exceeded authorized discount limit!!!"),this.isActive=!0,this.discountAmount=0,this.discountPercentage=0,this._trnMainService.onFlatDiscountClear(),this._trnMainService.clearDisAuthValues()):(this.alertService.success("Authorization Sucessfull"),this._trnMainService.resetDisLimitAuthObj()),this._trnMainService.showIndDiscountAuth=!1}else this._trnMainService.clearDisAuthValues(),this._trnMainService.onFlatDiscountClear()})}ngOnDestroy(){this.discountAmount=0,this.discountPercentage=0}}return v.\u0275fac=function(r){return new(r||v)(e.Y36(X.p),e.Y36(L.c),e.Y36(k.P),e.Y36(m.V))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-discount-popup"]],viewQuery:function(r,l){if(1&r&&(e.Gf(re,5),e.Gf(ae,5),e.Gf(Me,5)),2&r){let c;e.iGM(c=e.CRH())&&(l.discountPercentageInput=c.first),e.iGM(c=e.CRH())&&(l.discountAmountInput=c.first),e.iGM(c=e.CRH())&&(l.applyButton=c.first)}},hostBindings:function(r,l){1&r&&e.NdJ("keydown",function(u){return l.onKeydownHandler(u)},!1,e.evT)},inputs:{rowIndex:"rowIndex"},decls:22,vars:4,consts:[[1,"backdrop",3,"hidden"],[1,"discount-popup-box"],[1,"discount-popup-box-header"],[1,"text-white","py-2","ms-4",2,"margin-left","10px"],[1,"discount-popup-box-header-button",3,"click"],[1,"discount-popup-box-contents","mt-3"],[2,"display","flex"],[2,"width","40px"],["type","number","name","discount_percentage","tabindex","1",2,"width","100px","border-radius","5px",3,"ngModel","ngModelChange","change","keydown"],["discountPercentageInput",""],[2,"display","flex","justify-content","center"],[2,"width","50px"],["type","number","name","discount_amount","tabindex","2",2,"width","100px","border-radius","5px",3,"ngModel","ngModelChange","change","keydown"],["discountAmountInput",""],["tabindex","3",1,"discount-popup-box-submit-button","btn","btn-info",3,"keydown","click","keydown.enter"],["applyButton",""],[4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","20rem"],[1,"modal-content","modal-content-main-area",2,"width","auto","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group","row","mb-2",2,"margin","0.5rem"],[1,"col-md-6","col-sm-12"],[1,"row"],[1,"col-5","form-control-label","p-0","m-0",2,"font-size","13px"],[1,"col-6",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","number","id","Parent","autocomplete","off",1,"col-6","form-control",2,"height","4vh","font-size","13px",3,"disabled","ngModel","ngModelChange"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(r,l){1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4,"SET INDIVIDUAL DISCOUNT"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return l.hide()}),e._uU(6,"\xd7"),e.qZA()(),e.TgZ(7,"div",5)(8,"div",6)(9,"label",7),e._uU(10,"Dis %: "),e.qZA(),e.TgZ(11,"input",8,9),e.NdJ("ngModelChange",function(u){return l.discountPercentage=u})("change",function(u){return l.onDiscRateChange(u)})("keydown",function(u){return l.onKeydown(u,"discountAmountInput")}),e.qZA()(),e.TgZ(13,"div",10)(14,"label",11),e._uU(15,"Dis Amt: "),e.qZA(),e.TgZ(16,"input",12,13),e.NdJ("ngModelChange",function(u){return l.discountAmount=u})("change",function(u){return l.onDiscAmountChange(u)})("keydown",function(u){return l.onKeydown(u,"applyButton")}),e.qZA()()(),e.TgZ(18,"button",14,15),e.NdJ("keydown",function(u){return l.onKeydown(u,null)})("click",function(){return l.submitDiscountValues()})("keydown.enter",function(){return l.submitDiscountValues()}),e._uU(20,"Apply"),e.qZA()()(),e.YNc(21,G,42,7,"div",16)),2&r&&(e.Q6J("hidden",!l.isActive),e.xp6(11),e.Q6J("ngModel",l.discountPercentage),e.xp6(5),e.Q6J("ngModel",l.discountAmount),e.xp6(5),e.Q6J("ngIf",l._trnMainService.showIndDiscountAuth))},dependencies:[C.O5,y.Fj,y.wV,y.JJ,y.On],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}.discount-popup-box[_ngcontent-%COMP%]{position:fixed;top:35%;left:35%;background-color:#fff;width:400px;height:186px;border:2px solid #888888;border-radius:5px}.discount-popup-box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background:#4472C4;width:100%}.discount-popup-box-header-button[_ngcontent-%COMP%]{margin:8px;background-color:#375892;color:#000;border:0;border-radius:5px;height:25px;width:25px;font-weight:700;outline:none}.discount-popup-box-contents[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;margin-top:35px!important}.discount-popup-box-submit-button[_ngcontent-%COMP%]{border-radius:5px;font-size:medium;padding:3px 25px;margin:20px 150px!important;background-color:#007bff}@media (max-width: 900px){.discount-popup-box[_ngcontent-%COMP%]{left:20%}}"]}),v})();var z=b(64657),K=b(59963),oe=b(65171),me=b(32711),Ne=b(87454),Ze=b(86857),Fe=b(94619),dt=b(14173);function ht(v,V){if(1&v&&(e.TgZ(0,"tr",10)(1,"td",11),e._uU(2),e.qZA(),e.TgZ(3,"td",12),e._uU(4),e.qZA(),e.TgZ(5,"td",12),e._uU(6),e.qZA()()),2&v){const r=V.$implicit,l=V.index;e.xp6(2),e.Oqu(l+1),e.xp6(2),e.Oqu(r.Warehouse),e.xp6(2),e.Oqu(r.Stock)}}function ut(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"Warehouse Wise Stock"),e.qZA(),e.TgZ(5,"button",5),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.itemBatchClosed())}),e.TgZ(6,"span",6),e._uU(7,"\xd7"),e.qZA()()(),e.TgZ(8,"table",7)(9,"tr",8)(10,"th"),e._uU(11,"Sn."),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Warehouse"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Stock"),e.qZA()(),e.TgZ(16,"tbody"),e.YNc(17,ht,7,3,"tr",9),e.qZA()()()()}if(2&v){const r=e.oxw();e.xp6(17),e.Q6J("ngForOf",r.wareHouseStockList)}}let pt=(()=>{class v{constructor(r,l){this.masterRepo=r,this._trnMainService=l,this.isActive=!1,this.wareHouseStockList=[]}ngOnInit(){}show(r,l){this.isActive=!0,this.wareHouseStockList=[],this.indexRow=l,this.masterRepo.getWarehouseWiseStock(r).subscribe(c=>{this.wareHouseStockList=c})}itemBatchClosed(){this.isActive=!1,setTimeout(()=>{this.masterRepo.focusAnyControl("alternateQty"+this.indexRow)},50)}}return v.\u0275fac=function(r){return new(r||v)(e.Y36(k.P),e.Y36(X.p))},v.\u0275cmp=e.Xpm({type:v,selectors:[["warehousewisestock"]],decls:1,vars:1,consts:[["class","modal-sticky","style","width: 50vw;",4,"ngIf"],[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],["aria-disabled","true","class","highlight",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"]],template:function(r,l){1&r&&e.YNc(0,ut,18,1,"div",0),2&r&&e.Q6J("ngIf",l.isActive)},dependencies:[C.sg,C.O5],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }"]}),v})();var _t=b(88762),Tt=b(89952);let Mt=(()=>{class v{constructor(r){this._trnMainService=r}transform(r){return this.showColumnInProductInsert(r)}showColumnInProductInsert(r){switch(r){case"showNetAmtHeadercolumn":return!(this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==t.Km.Stockadjustment);case"showVATcolumn":return!(this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||(this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==t.Km.Quotation)&&0==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==t.Km.Stockadjustment);case"showNetAmtNonEditable":return this._trnMainService.TrnMainObj.VoucherType!=t.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.Stockadjustment&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.ReverseProductionEntry&&!(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT);case"showNetAmtEditable":return this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT;case"showRateHeader":return[1,5,7,8,9,10,14,15,19,20,24,41,43,57,64,73,74,75,80,81,88,90].includes(this._trnMainService.TrnMainObj.VoucherType)&&!(19===this._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"===this._trnMainService.TrnMainObj.AdditionalObj?.tag)&&!(90===this._trnMainService.TrnMainObj.VoucherType&&1===this._trnMainService.userSetting.LogBasedRequisitionApproval)&&!this._trnMainService.hideColumn("Rate",t.Km[this._trnMainService.TrnMainObj.VoucherType])}}}return v.\u0275fac=function(r){return new(r||v)(e.Y36(X.p,16))},v.\u0275pipe=e.Yjl({name:"showColumn",type:v,pure:!0}),v})();var Ui=b(77398),mt=b(79700),gt=b(84260),vt=b(56529);let St=(()=>{class v{constructor(r,l){this.authservice=r,this._trnMainService=l}transform(r){return this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&1!==this.authservice.getSetting().ENABLESINGLEBATCHMODE}}return v.\u0275fac=function(r){return new(r||v)(e.Y36(x.e,16),e.Y36(X.p,16))},v.\u0275pipe=e.Yjl({name:"checkBatchMode",type:v,pure:!0}),v})();const Bi=["genericGridSupplierPopup"],ft=["barCodeGridPopup"],Ki=["discountPopup"],Ot=["PetrolGrid"],Zi=["genericGridMulitplePricePopup"],Fi=["matrixitemgrid"],Qi=["warehouseWiseStockPopup"],Hi=["itemEditGrid"],bt=["authenticationPopup"],Ct=["rateValidatoin"],nt=["genericGrid"],qe=["focusBatch"];function At(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1,"Approval Flag"),e.qZA())}function Et(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1,"Code"),e.qZA())}function It(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Barcode "),e.qZA())}function We(v,V){1&v&&(e.TgZ(0,"th",56),e._uU(1,"HS Code"),e.qZA())}function Pt(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Alt.Unit "),e.qZA())}function yt(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Alt.Qty "),e.qZA())}const Ue=function(){return{width:"10%"}};function xt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," BatchNo "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Ue):null)}}function Rt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Source Barcode "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Ue):null)}}function Nt(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," Source Batch Rate "),e.qZA())}function Lt(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," S.. BatchId "),e.qZA())}function wt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Source Batch "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Ue):null)}}function rt(v,V){1&v&&(e.TgZ(0,"th",59),e._uU(1," P-Stock "),e.qZA())}function Dt(v,V){1&v&&(e.TgZ(0,"th",59),e._uU(1," C-Stock "),e.qZA())}function jt(v,V){1&v&&(e.TgZ(0,"th",60),e._uU(1," Quantity "),e.qZA())}function kt(v,V){1&v&&(e.TgZ(0,"th",60),e._uU(1," Other Unit Qty "),e.qZA())}const Qe=function(){return{width:"8%"}};function Vt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Request Qty "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Qe):null)}}function Ut(v,V){if(1&v&&(e.TgZ(0,"th",8),e._uU(1," Approved Qty "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Qe):null)}}function Bt(v,V){if(1&v&&(e.TgZ(0,"th",8),e._uU(1," Sellable Stock "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Qe):null)}}function Kt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Adjusting Barcode "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,Ue):null)}}const He=function(){return{width:"7%"}};function Zt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Adjusting Batch "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,He):null)}}function Ft(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Adjusting Batch Rate "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?e.DdM(1,He):e.DdM(2,Ue))}}function Qt(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," A.. BatchId "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,He):null)}}function Ht(v,V){if(1&v&&(e.TgZ(0,"th",57),e._uU(1," Variance Amnt "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?e.DdM(1,He):e.DdM(2,Ue))}}function Gt(v,V){if(1&v&&(e.TgZ(0,"th",58),e._uU(1),e.qZA()),2&v){const r=e.oxw();e.xp6(1),e.hij(" ",r.FCRATELABEL," ")}}const Yt=function(){return{width:"15%"}},Jt=function(){return{width:"20%"}};function qt(v,V){if(1&v&&(e.TgZ(0,"th",61),e._uU(1," Rate "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",19==r._trnMainService.TrnMainObj.VoucherType||8==r._trnMainService.TrnMainObj.VoucherType?e.DdM(3,Yt):null)("ngStyle",7==r._trnMainService.TrnMainObj.VoucherType?e.DdM(4,Jt):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?e.DdM(5,Qe):null)}}function Wt(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," P.Rate "),e.qZA())}function $t(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1,"Amount"),e.qZA())}function zt(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," Con.Factor "),e.qZA())}function Xt(v,V){1&v&&(e.TgZ(0,"th",62),e._uU(1," Amt "),e.qZA())}function ei(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," ECS "),e.qZA())}const $e=function(){return{width:"6.5%"}};function ti(v,V){if(1&v&&(e.TgZ(0,"th",61),e._uU(1," Amt "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",8==r._trnMainService.TrnMainObj.VoucherType||15==r._trnMainService.TrnMainObj.VoucherType||1==r._trnMainService.TrnMainObj.VoucherType||7==r._trnMainService.TrnMainObj.VoucherType?e.DdM(2,$e):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?e.DdM(3,Qe):null)}}function ii(v,V){1&v&&(e.TgZ(0,"th",63),e._uU(1," Ind. Disc "),e.qZA())}function ni(v,V){1&v&&(e.TgZ(0,"th",63),e._uU(1," Total Disc "),e.qZA())}function ri(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," Sales Price "),e.qZA())}function ze(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," Sales Price(W/V) "),e.qZA())}function oi(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," WSP "),e.qZA())}function si(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," WSP(W/V) "),e.qZA())}function ai(v,V){1&v&&(e.TgZ(0,"th",64),e._uU(1," Dis% "),e.qZA())}function ci(v,V){1&v&&(e.TgZ(0,"th",63),e._uU(1," Dis Amt "),e.qZA())}function li(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1," S.Charge "),e.qZA())}function di(v,V){1&v&&(e.TgZ(0,"th",58),e._uU(1,"VAT"),e.qZA())}function hi(v,V){1&v&&(e.TgZ(0,"th",62),e._uU(1,"Net Amt"),e.qZA())}function ui(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Net Rate "),e.qZA())}function pi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1,"Approval Flag"),e.qZA())}function _i(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Approval "),e.qZA())}function Ti(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," MASTER ITEM "),e.qZA())}function Mi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1,"OUT-QTY"),e.qZA())}function mi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1,"UNIT"),e.qZA())}function gi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Order Comments "),e.qZA())}function vi(v,V){1&v&&(e.TgZ(0,"th",65),e._uU(1," MRP "),e.qZA())}const ot=function(){return{width:"130px"}};function Si(v,V){if(1&v&&(e.TgZ(0,"th",8),e._uU(1," Mfg Date "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,$e):e.DdM(2,ot))}}function fi(v,V){if(1&v&&(e.TgZ(0,"th",8),e._uU(1," Exp Date "),e.qZA()),2&v){const r=e.oxw();e.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?e.DdM(1,$e):e.DdM(2,ot))}}function Oi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," Old Expiry Date "),e.qZA())}function bi(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," New Mfg Date "),e.qZA())}function Ci(v,V){1&v&&(e.TgZ(0,"th"),e._uU(1," New Exp Date "),e.qZA())}function Ai(v,V){1&v&&(e.TgZ(0,"th",66),e._uU(1," Remarks "),e.qZA())}function Ei(v,V){1&v&&e._UZ(0,"th")}function Ii(v,V){if(1&v&&(e.TgZ(0,"td",111),e._uU(1),e.qZA()),2&v){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",r.MENUCODE," ")}}function Pi(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",112)(1,"input",113),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.BC=c)})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ItemBarCodeClick(u,c))})("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ItemBarCodeClick(u,c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ItemBarCodeClick(u,c))})("focusout",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ItemBarCodeFoucusOut(u,c))})("focus",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ItemBarCodeClickFocusIn(u,c))}),e.ALo(2,"disable"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","barcode",l,""),e.Q6J("ngModel",c.BC)("readonly","VIEW"==c.rowMode)("disabled",e.Dn7(2,5,"disableBarcodeField",l,u._trnMainService.callPipe)),e.uIk("disabled",!0)}}function yi(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",112)(1,"input",114),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.HS_Code=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","hsCode",l,""),e.Q6J("ngModel",c.HS_Code),e.uIk("disabled",!0)}}const Ge=function(v){return{tooltipChild:v}};function xi(v,V){if(1&v&&(e.ynx(0),e._UZ(1,"span",115),e.BQk()),2&v){const r=e.oxw().index,l=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ge,l.hoverId==r))("innerHTML",l.itemDescHoverValue,e.oJD)}}function Ri(v,V){if(1&v&&(e.ynx(0),e.TgZ(1,"option",119),e._uU(2),e.qZA(),e.BQk()),2&v){const r=V.$implicit;e.xp6(1),e.s9C("value",r.ALTUNIT),e.xp6(1),e.Oqu(r.ALTUNIT)}}function Ni(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",116)(1,"select",117),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ALTERNATEUNIT=c)}),e.YNc(2,Ri,3,2,"ng-container",118),e.qZA()()}if(2&v){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",r.ALTERNATEUNIT),e.xp6(1),e.Q6J("ngForOf",null==r.Product?null:r.Product.AlternateUnits)}}function D(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",120)(1,"input",121),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.OPQTY=c)}),e.qZA()()}if(2&v){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",r.OPQTY)}}function te(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",122)(1,"input",123,124),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.BATCH=c)})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))})("keydown",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.onKeydownOnBatch(c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))})("focusout",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.batchFocusOut(u,c))}),e.ALo(3,"disable"),e.qZA(),e.TgZ(4,"span",74),e._uU(5,"press ENTER or TAB to Select Batch"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","batch",l,""),e.Q6J("ngModel",c.BATCH)("disabled",e.Dn7(3,4,"disableBatch",l,u._trnMainService.callPipe))("readonly",u.readOnlyBatch())}}function a(v,V){if(1&v&&(e.ynx(0),e.TgZ(1,"option",119),e._uU(2),e.qZA(),e.BQk()),2&v){const r=V.$implicit;e.xp6(1),e.s9C("value",r.ALTUNIT),e.xp6(1),e.Oqu(r.ALTUNIT)}}function h(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",116)(1,"select",125),e.NdJ("change",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.SelectUnit(c))})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.AlternateUnitEnterEventClick(u,c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.AlternateUnitEnterEventClick(u,c))})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ALTUNIT=c)}),e.ALo(2,"disable"),e.YNc(3,a,3,2,"ng-container",118),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","alternateunit",l,""),e.Q6J("ngModel",c.ALTUNIT)("disabled",e.Dn7(2,4,"disableAltUnit",l,u._trnMainService.callPipe)),e.xp6(2),e.Q6J("ngForOf",null==c.Product?null:c.Product.AlternateUnits)}}function d(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",126)(1,"input",127),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.BC=c)})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","sourcebc",l,""),e.Q6J("ngModel",c.BC)("disabled",0==c.HASVARIANT)}}function g(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",120)(1,"input",128),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.BATCHID=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","sourcebatchId",l,""),e.Q6J("ngModel",c.BATCHID)("readonly",!0)}}function N(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",116)(1,"input",129),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ALTUNIT=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","punit",l,""),e.Q6J("ngModel",c.ALTUNIT)}}function ne(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",130)(1,"input",131),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.VRATE=c)}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","sourceRate",l,""),e.Q6J("ngModel",u.applyPipeInRate?e.lcZ(2,3,c.VRATE):c.VRATE)("readonly",!0)}}function he(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",122)(1,"input",132),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.BATCH=c)})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))})("keydown",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.onKeydownOnBatch(c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.BatchEnter(u,c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","sourcebatch",l,""),e.Q6J("ngModel",c.BATCH)("disabled",c.isDisabled||"VIEW"==c.rowMode)}}function Ce(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",134),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.PSTOCK=c)})("keydown.Enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.PstockEnter(u,c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","physicalStock",l,""),e.Q6J("ngModel",c.PSTOCK)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||"stock-adjustment"===u.activeurlpath)}}function Le(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",135),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.CSTOCK=c)})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.CstockEnter(u,c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","computerStock",l,""),e.Q6J("ngModel",c.CSTOCK)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||"stock-adjustment"===u.activeurlpath)}}function Ee(v,V){if(1&v&&(e.ynx(0),e._UZ(1,"span",115),e.BQk()),2&v){const r=e.oxw(2).index,l=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ge,l.qtyId==r))("innerHTML",l.qtyValue,e.oJD)}}function Ie(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",136),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ALTERNATEQUANTIY=c)})("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.QuantityChangeEvent(u,c))})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.AlternateQuantityEventClick(u,c))})("keydown.Enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.AlternateQuantityEventClick(u,c))})("keypress",function(c){e.CHM(r);const u=e.oxw(),R=u.$implicit,F=u.index,le=e.oxw();return e.KtG(1==R.NATURETYPE&&1!=R.isPurchaseOrder?le.AlternateQuantityEventClick(F,c):le.return)})("mouseover",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverQty(c))})("mouseleave",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverLeaveQty(c))}),e.ALo(2,"disable"),e.qZA(),e.YNc(3,Ee,2,4,"ng-container",5),e.qZA()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","alternateQty",l,""),e.Q6J("ngModel",c.ALTERNATEQUANTIY)("readonly",c.isQuantityReadonly)("disabled",e.Dn7(2,6,"disableAltQty",l,u._trnMainService.callPipe))("OnlyWholeNumber",1==c.StopDecimal),e.xp6(2),e.Q6J("ngIf",u.showtooltip)}}function Be(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"input",137),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.OtherUnitQty=c)}),e.ALo(1,"disable"),e.qZA()}if(2&v){const r=e.oxw(),l=r.$implicit,c=r.index,u=e.oxw();e.Q6J("ngModel",l.OtherUnitQty)("disabled",e.Dn7(1,2,"disableAltQty",c,u._trnMainService.callPipe))}}function Ye(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",138),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.APPROVEDALTQTY=c)})("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.approvedQtyEnter(u,c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.approvedQtyEnter(c))}),e.ALo(2,"disable"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","approvedQty",l,""),e.Q6J("ngModel",c.APPROVEDALTQTY)("disabled",e.Dn7(2,3,"disableAprroveQty",l,u._trnMainService.callPipe))}}function Xe(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",139),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.STOCK=c)}),e.ALo(2,"disable"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","stock",l,""),e.Q6J("ngModel",c.STOCK)("disabled",e.Dn7(2,3,"disableGridForReqApproval",l,u._trnMainService.callPipe))}}function et(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",122)(1,"input",140),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ADJUSTBC=c)})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.AdjustBatchEnter(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","adjustbc",l,""),e.Q6J("ngModel",c.ADJUSTBC)("disabled",0==c.HASVARIANT)}}function Oe(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",141)(1,"input",140),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ADJUSTBATCH=c)})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.AdjustBatchEnter(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","adjustbatch",l,""),e.Q6J("ngModel",c.ADJUSTBATCH)("disabled",c.isDisabled)}}function st(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",120)(1,"input",142),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.INVRATE=c)}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","sourceRate",l,""),e.Q6J("ngModel",u.applyPipeInRate?e.lcZ(2,3,c.INVRATE):c.INVRATE)("readonly",!0)}}function at(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",120)(1,"input",128),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.MANUFACTURER=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","adjustBatchId",l,""),e.Q6J("ngModel",c.MANUFACTURER)("readonly",!0)}}function be(v,V){if(1&v&&(e.TgZ(0,"td",143),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","varianceAmount",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function ct(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",144)(1,"input",145),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.INVRATE=c)})("change",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.FCRATEChangeEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.fcrateEnterEvent(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.fcrateEnterEvent(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","fcrate",l,""),e.Q6J("ngModel",c.INVRATE)("disabled",u._trnMainService.disableRateOnPOselect)}}const Ke=function(v){return{"tooltipChild disabled-rate":v}};function tt(v,V){if(1&v&&(e.ynx(0),e._UZ(1,"span",115),e.BQk()),2&v){const r=e.oxw(2).index,l=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ke,l.rateId===r))("innerHTML",l.rateInnerHTML,e.oJD)}}function Li(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",146)(1,"input",147),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ALTRATE=c)})("change",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.MRPChangeEvent(u,R))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.mrpEnterEvent(u,R))})("keydown.enter",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.mrpEnterEvent(u,R))})("keyup",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.rateChange(c))})("focusout",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.rateFocusOut(c))})("mouseover",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverRate(c))})("mouseleave",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverLeaveRate(c))}),e.ALo(2,"twoDigitNumber"),e.ALo(3,"disable"),e.ALo(4,"checkBatchMode"),e.qZA(),e.YNc(5,tt,2,4,"ng-container",5),e.qZA()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.Q6J("hidden",89==u._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.MGl("id","rate",l,""),e.Q6J("ngModel",u.applyPipeInRate?e.lcZ(2,6,c.ALTRATE):c.ALTRATE)("disabled",e.Dn7(3,8,"disableRateandDiscount",l,u._trnMainService.callPipe))("readonly",e.lcZ(4,12,u.disableRate())),e.xp6(4),e.Q6J("ngIf",u.showtooltip)}}function wi(v,V){if(1&v&&(e.TgZ(0,"td",148),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","grossamnt",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.GROSSAMNT))," ")}}function Di(v,V){if(1&v&&(e.TgZ(0,"td",143),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","amount",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function it(v,V){if(1&v&&(e.TgZ(0,"td",143),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","confactor",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.ALTCONFACTOR))," ")}}function zi(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",149),e.NdJ("change",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.MRPChangeEvent(c))}),e.TgZ(1,"input",150),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ECSAMOUNT=c)})("focusout",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.ECSFocusOut())})("focusin",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.ECSFocusIn())})("keyup",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.ECSValueChange())})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ECSEnterClicked(u,c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.ECSEnterClicked(u,c))}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","ECSAmount",l,""),e.Q6J("ngModel",u.applyPipeInECS?e.lcZ(2,3,c.ECSAMOUNT):c.ECSAMOUNT)("disabled",u.disableECS(c))}}function Xi(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",151),e.NdJ("change",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.MRPChangeEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.mrpEnterEvent(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.mrpEnterEvent(c))}),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()}if(2&v){const r=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function en(v,V){if(1&v&&(e.ynx(0),e._UZ(1,"span",115),e.BQk()),2&v){const r=e.oxw(2).index,l=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ge,l.hoverIndId==r))("innerHTML",l.rateValue,e.oJD)}}function tn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",152)(1,"input",153),e.NdJ("keydown",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.indDiscEnterClicked(u,c))})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.INDDISCOUNT=c)})("focusout",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.rateFocusOut(c))})("mouseover",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverIndDiscount(c))})("mouseleave",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverLeaveIndDiscount(c))}),e.ALo(2,"twoDigitNumber"),e.ALo(3,"disable"),e.qZA(),e.YNc(4,en,2,4,"ng-container",5),e.qZA()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","discountAmt",l,""),e.Q6J("ngModel",u.applyPipeInRate?e.lcZ(2,4,c.INDDISCOUNT):c.INDDISCOUNT)("disabled",e.Dn7(3,6,"disableDiscountAmount",l,u._trnMainService.callPipe)),e.xp6(3),e.Q6J("ngIf",c.INDDISCOUNTRATE>0&&1==u.showHoverInd)}}function nn(v,V){if(1&v&&(e.ynx(0),e._UZ(1,"span",115),e.BQk()),2&v){const r=e.oxw(2).index,l=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ge,l.hoverId==r))("innerHTML",l.stringValue,e.oJD)}}function rn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",154),e.NdJ("mouseover",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverDiscountt(c))})("mouseleave",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.hoverLeaveDiscountt(c))}),e._uU(1),e.ALo(2,"twoDigitNumber"),e.YNc(3,nn,2,4,"ng-container",5),e.qZA()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","totalDisc",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,3,u._trnMainService.nullToZeroConverter(c.DISCOUNT))," "),e.xp6(2),e.Q6J("ngIf",c.DISCOUNT>0)}}function on(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",152)(1,"input",155),e.NdJ("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.IndDiscountAmountChangeOfRetailerVATINCEvent(u,c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discEnterClicked(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discEnterClicked(c))}),e.ALo(2,"number"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","discountAmtVATInclusiveForretailer",l,""),e.Q6J("ngModel",e.xi3(2,3,u._trnMainService.nullToZeroConverter(c.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem)}}function sn(v,V){if(1&v&&(e.TgZ(0,"td",156),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function an(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",157)(1,"input",158),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.MRP=c)})("change",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.RecalculateMRP())})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabMRP(c,u))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabMRP(c,u))})("keyup",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.rateChange(c))})("focusout",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.rateFocusOut(c))}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","MRP",l,""),e.Q6J("ngModel",u.applyPipeInRate?e.lcZ(2,3,c.MRP):c.MRP)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||u.disableSalesPriceWOVAT(l))}}function cn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",157)(1,"input",159),e.NdJ("change",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.RecalculateSPRICE())})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.SPRICE=c)})("keydown.tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabSPRICE(c,u))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabSPRICE(c,u))})("keyup",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.spriceChange(c))})("focusout",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.spriceFocusOut(c))}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","SPRICE",l,""),e.Q6J("ngModel",u.applyPipeInSprice?e.lcZ(2,3,c.SPRICE):c.SPRICE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWVAT(l))}}function ln(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",157)(1,"input",160),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.VSRATE=c)})("change",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.RecalculateVSRATE())})("keydown.tab",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.onTabVSRATE(c))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw(2);return e.KtG(u.onTabVSRATE(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","VSRATE",l,""),e.Q6J("ngModel",c.VSRATE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWOVAT(l))}}function dn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",157)(1,"input",160),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.VPRATE=c)})("change",function(){e.CHM(r);const c=e.oxw(2);return e.KtG(c.RecalculateVPRATE())})("keydown.tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabVPRATE(c,u))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.onTabVPRATE(c,u))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","VPRATE",l,""),e.Q6J("ngModel",c.VPRATE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWVAT(l))}}function hn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",152)(1,"input",161,162),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.INDDISCOUNTRATE=c)})("change",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.IndDiscountRateChangeEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discRateEnterClicked(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discRateEnterClicked(c))}),e.ALo(3,"disable"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","discountIP",l,""),e.Q6J("ngModel",c.INDDISCOUNTRATE)("readonly",u._trnMainService.disableProd||u.disableDiscount())("disabled",e.Dn7(3,4,"disableDiscountRateImpPurchase",l,u._trnMainService.callPipe))}}function un(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",152)(1,"input",163),e.NdJ("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.IndDiscountAmountChangeEvent(u,c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discEnterClicked(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.discEnterClicked(c))}),e.ALo(2,"twoDigitNumber"),e.ALo(3,"disable"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","discountAmti",l,""),e.Q6J("readonly",u.disableDiscount())("ngModel",e.lcZ(2,4,u._trnMainService.nullToZeroConverter(c.INDDISCOUNT)))("disabled",e.Dn7(3,6,"disableDiscountAmountImpPurchase",l,u._trnMainService.callPipe))}}function pn(v,V){if(1&v&&(e.TgZ(0,"td",164),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.SERVICETAX))," ")}}function _n(v,V){if(1&v&&(e.TgZ(0,"td",165),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.VAT))," ")}}function Tn(v,V){if(1&v&&(e.TgZ(0,"td",148),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","netamount",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.NETAMOUNT))," ")}}function Mn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",148)(1,"input",166),e.NdJ("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.changeONNetAmount(u,c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.clickOnNetAmount(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.clickOnNetAmount(c))}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","netamount",l,""),e.xp6(1),e.MGl("id","netamounteditable",l,""),e.Q6J("ngModel",e.lcZ(2,4,u._trnMainService.nullToZeroConverter(c.NETAMOUNT)))("disabled","VIEW"==c.rowMode)}}function mn(v,V){if(1&v&&(e.TgZ(0,"td",167),e._UZ(1,"input",168),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","mrp",l,""),e.xp6(1),e.Q6J("ngModel",c.CRATE)("disabled",1==u._trnMainService.disableAllFieldinPurchase||u._trnMainService.disableOnGRNload)("readonly",!0)}}function gn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",169)(1,"select",170),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.IsApproveStockSettlement=c)}),e.TgZ(2,"option",119),e._uU(3,"Approved"),e.qZA(),e.TgZ(4,"option",119),e._uU(5,"Not Approved"),e.qZA()()()}if(2&v){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",r.IsApproveStockSettlement),e.xp6(1),e.Q6J("value",1),e.xp6(2),e.Q6J("value",0)}}function vn(v,V){if(1&v&&(e.TgZ(0,"td",143),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.MGl("id","amount",l,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function Sn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",169)(1,"select",170),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.isApproved=c)}),e.TgZ(2,"option",119),e._uU(3,"Approved"),e.qZA(),e.TgZ(4,"option",119),e._uU(5,"Not Approved"),e.qZA()()()}if(2&v){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",r.isApproved),e.xp6(1),e.Q6J("value",1),e.xp6(2),e.Q6J("value",0)}}function fn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",171)(1,"input",172),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.PDESCA=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","masteritem",l,""),e.Q6J("ngModel",c.PDESCA)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode)}}function On(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",133)(1,"input",173),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.ROUTQTY=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","outqty",l,""),e.Q6J("ngModel",c.ROUTQTY)}}function bn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",116)(1,"input",129),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.PUNIT=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","punit",l,""),e.Q6J("ngModel",c.PUNIT)}}function Cn(v,V){if(1&v&&(e.TgZ(0,"td",174),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.MRP))," ")}}function An(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",175)(1,"input",176),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.MFGDATE=c)})("ngModelChange",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.productHelperService.CalculateExpiryDate(u.MFGDATE,R,u))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.MFGDateEnterEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.MFGDateEnterEvent(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","mfgdate",l,""),e.s9C("type",u.mfgExpDateType),e.Q6J("ngModel",c.MFGDATE)("max",u.maxDate)("disabled","VIEW"==c.rowMode||2==u.userSetting.EnableBatch&&88==!u._trnMainService.TrnMainObj.VoucherType||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==u.activeurlpath||u._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==u._trnMainService.TrnMainObj.VoucherType||7==u._trnMainService.TrnMainObj.VoucherType||1==u.masterService.disableQtyInStockIssueReturn||0==c.REQEXPDATE&&24==u._trnMainService.TrnMainObj.VoucherType||(0==c.REQEXPDATE||1==u.userSetting.EnableManualBatchinproduction)&&88==u._trnMainService.TrnMainObj.VoucherType)}}function En(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",175)(1,"input",177),e.NdJ("change",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return F.onChangeExpDate(),e.KtG(F.productHelperService.validateDates(u.TransferMfgDate,R,u))})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.EXPDATE=c)})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.expDateEnterEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.expDateEnterEvent(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","expdate",l,""),e.s9C("type",u.mfgExpDateType),e.Q6J("ngModel",c.EXPDATE)("max",u.maxDate)("min",u.currDate)("disabled","VIEW"==c.rowMode||2==u.userSetting.EnableBatch&&88==!u._trnMainService.TrnMainObj.VoucherType||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==u.activeurlpath||u._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==u._trnMainService.TrnMainObj.VoucherType||7==u._trnMainService.TrnMainObj.VoucherType||1==u.masterService.disableQtyInStockIssueReturn||0==c.REQEXPDATE&&24==u._trnMainService.TrnMainObj.VoucherType||(0==c.REQEXPDATE||1==u.userSetting.EnableManualBatchinproduction)&&88==u._trnMainService.TrnMainObj.VoucherType)}}function In(v,V){if(1&v&&(e.TgZ(0,"td",178),e._uU(1),e.ALo(2,"monthYear"),e.qZA()),2&v){const r=e.oxw(),c=r.$implicit;e.MGl("id","oldexpiry",r.index,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,c.EXPDATE)," ")}}function Pn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",179)(1,"input",176),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.TransferMfgDate=c)})("ngModelChange",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.productHelperService.CalculateExpiryDate(u.TransferMfgDate,R,u))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.newMFGDateEnterEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.newMFGDateEnterEvent(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","newmanufacture",l,""),e.s9C("type",u.mfgExpDateType),e.Q6J("ngModel",c.TransferMfgDate)("max",u.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function yn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",179)(1,"input",180),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.TransferExpiryDate=c)})("ngModelChange",function(){e.CHM(r);const c=e.oxw(),u=c.$implicit,R=c.index,F=e.oxw();return e.KtG(F.productHelperService.CalculateExpiryDate(u.TransferExpiryDate,R,u))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.newExpDateEnterEvent(c))})("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.newExpDateEnterEvent(c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw();e.xp6(1),e.MGl("id","newexpiry",l,""),e.s9C("type",u.mfgExpDateType),e.Q6J("ngModel",c.TransferExpiryDate)("max",u.maxDate)("min",u.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function xn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",181)(1,"select",182),e.NdJ("keydown.Tab",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.OrderComment(c))})("keydown.enter",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.OrderComment(c))})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.COMMENTS=c)}),e.TgZ(2,"option",183),e._uU(3,"Urgent"),e.qZA(),e.TgZ(4,"option"),e._uU(5,"Needed"),e.qZA(),e.TgZ(6,"option"),e._uU(7,"Nil"),e.qZA()()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","OrderComment",l,""),e.Q6J("ngModel",c.COMMENTS)}}function Rn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",181)(1,"input",184),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.COMMENTS=c)}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","Comment",l,""),e.Q6J("ngModel",c.COMMENTS)}}function Nn(v,V){if(1&v&&(e.TgZ(0,"td",185),e._uU(1),e.ALo(2,"monthYear"),e.qZA()),2&v){const r=e.oxw(),c=r.$implicit;e.MGl("id","mfgdateNonedit",r.index,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,c.MFGDATE)," ")}}function Ln(v,V){if(1&v&&(e.TgZ(0,"td",185),e._uU(1),e.ALo(2,"monthYear"),e.qZA()),2&v){const r=e.oxw(),c=r.$implicit;e.MGl("id","expdateNonedit",r.index,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,c.EXPDATE)," ")}}function wn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",152)(1,"input",186),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.REMARKS=c)})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.RemarksEnterCommand(c,u))})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw();return e.KtG(R.RemarksEnterCommand(c,u))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit;e.xp6(1),e.MGl("id","remarks",l,""),e.Q6J("ngModel",c.REMARKS)("disabled","VIEW"==c.rowMode)}}function Dn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",187)(1,"div",108)(2,"button",109),e.NdJ("click",function(){e.CHM(r);const c=e.oxw().index,u=e.oxw();return e.KtG(u.editRow(c))}),e.TgZ(3,"span"),e._uU(4,"Edit"),e.qZA()()()()}if(2&v){const r=e.oxw().$implicit;e.xp6(2),e.Q6J("disabled","VIEW"==r.rowMode)}}const jn=function(){return{width:"22%"}},kn=function(){return[14,16,57,64,73]},Gi=function(){return[3,14,16,57,64,73,64,74,89]},Vn=function(){return[5,81]};function Un(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"tbody",67)(1,"tr",68),e.NdJ("click",function(){const u=e.CHM(r).index,R=e.oxw();return e.KtG(R.RowClick(u))})("keydown.Shift.delete",function(){const u=e.CHM(r).index,R=e.oxw();return e.KtG(R.deleteRow(u))}),e.TgZ(2,"td",69),e._uU(3),e.qZA(),e.YNc(4,Ii,2,1,"td",70),e.ALo(5,"activeColumn"),e.YNc(6,Pi,3,9,"td",71),e.ALo(7,"activeColumn"),e.YNc(8,yi,2,3,"td",71),e.ALo(9,"activeColumn"),e.TgZ(10,"td",72),e.NdJ("mouseover",function(){const u=e.CHM(r).index,R=e.oxw();return e.KtG(R.hoverItemDesc(u))})("mouseleave",function(){const u=e.CHM(r).index,R=e.oxw();return e.KtG(R.hoverLeaveItemDesc(u))}),e.TgZ(11,"input",73),e.NdJ("ngModelChange",function(c){const R=e.CHM(r).$implicit;return e.KtG(R.ITEMDESC=c)})("keydown.enter",function(c){const R=e.CHM(r).index,F=e.oxw();return F.ItemkeyEvent(R,c),e.KtG(F.displayProductDetailInViewMode(F.event))})("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.onClicked())}),e.ALo(12,"disable"),e.qZA(),e.TgZ(13,"span",74),e._uU(14,"Press ENTER to Select Item"),e.qZA(),e.ynx(15),e._UZ(16,"br")(17,"span",75),e.BQk(),e.YNc(18,xi,2,4,"ng-container",5),e.qZA(),e.YNc(19,Ni,3,2,"td",76),e.YNc(20,D,2,1,"td",77),e.YNc(21,te,6,8,"td",78),e.ALo(22,"activeColumn"),e.YNc(23,h,4,8,"td",76),e.ALo(24,"activeColumn"),e.YNc(25,d,2,3,"td",79),e.YNc(26,g,2,3,"td",77),e.YNc(27,N,2,2,"td",76),e.YNc(28,ne,3,5,"td",80),e.YNc(29,he,2,3,"td",78),e.YNc(30,Ce,2,3,"td",81),e.YNc(31,Le,2,3,"td",81),e.YNc(32,Ie,4,10,"td",81),e.ALo(33,"activeColumn"),e.YNc(34,Be,2,6,"input",82),e.YNc(35,Ye,3,7,"td",81),e.YNc(36,Xe,3,7,"td",81),e.YNc(37,et,2,3,"td",78),e.YNc(38,Oe,2,3,"td",83),e.YNc(39,st,3,5,"td",77),e.YNc(40,at,2,3,"td",77),e.YNc(41,be,3,4,"td",84),e.YNc(42,ct,2,3,"td",85),e.ALo(43,"activeColumn"),e.YNc(44,Li,6,14,"td",86),e.YNc(45,wi,3,4,"td",87),e.YNc(46,Di,3,4,"td",84),e.YNc(47,it,3,4,"td",84),e.ALo(48,"activeColumn"),e.YNc(49,zi,3,5,"td",88),e.ALo(50,"activeColumn"),e.YNc(51,Xi,3,3,"td",89),e.YNc(52,tn,5,10,"td",90),e.YNc(53,rn,4,5,"td",91),e.YNc(54,on,3,6,"td",90),e.ALo(55,"activeColumn"),e.YNc(56,sn,3,3,"td",92),e.YNc(57,an,3,5,"td",93),e.YNc(58,cn,3,5,"td",93),e.YNc(59,ln,2,3,"td",93),e.YNc(60,dn,2,3,"td",93),e.YNc(61,hn,4,8,"td",90),e.ALo(62,"activeColumn"),e.YNc(63,un,4,10,"td",90),e.ALo(64,"activeColumn"),e.YNc(65,pn,3,3,"td",94),e.YNc(66,_n,3,3,"td",95),e.ALo(67,"activeColumn"),e.YNc(68,Tn,3,4,"td",96),e.ALo(69,"showColumn"),e.YNc(70,Mn,3,6,"td",96),e.ALo(71,"showColumn"),e.YNc(72,mn,2,4,"td",97),e.YNc(73,gn,6,3,"td",98),e.YNc(74,vn,3,4,"td",84),e.YNc(75,Sn,6,3,"td",98),e.YNc(76,fn,2,3,"td",99),e.YNc(77,On,2,2,"td",81),e.YNc(78,bn,2,2,"td",76),e.YNc(79,Cn,3,3,"td",100),e.YNc(80,An,2,5,"td",101),e.ALo(81,"activeColumn"),e.YNc(82,En,2,6,"td",101),e.ALo(83,"activeColumn"),e.YNc(84,In,3,4,"td",102),e.YNc(85,Pn,2,5,"td",103),e.YNc(86,yn,2,6,"td",103),e.YNc(87,xn,8,2,"td",104),e.YNc(88,Rn,2,2,"td",104),e.YNc(89,Nn,3,4,"td",105),e.ALo(90,"activeColumn"),e.YNc(91,Ln,3,4,"td",105),e.ALo(92,"activeColumn"),e.YNc(93,wn,2,3,"td",90),e.YNc(94,Dn,5,1,"td",106),e.TgZ(95,"td",107)(96,"div",108)(97,"button",109),e.NdJ("click",function(){const u=e.CHM(r).index,R=e.oxw();return e.KtG(R.deleteRow(u))}),e.ALo(98,"disable"),e._UZ(99,"img",110),e.qZA()()()()()}if(2&v){const r=V.$implicit,l=V.index,c=e.oxw();e.xp6(1),e.ekj("selected",c.isTableRowSelected(l))("highlighted",l+1==c.highlightBarCodeWiseRow())("bgforlessstockitem",c.highlightLessStockItem(l)),e.xp6(1),e.MGl("id","sno",l,""),e.xp6(1),e.hij(" ",l+1," "),e.xp6(1),e.Q6J("ngIf",e.lcZ(5,79,"MENUCODE_HEADER")),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,81,"BARCODE_HEADER")),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,83,"HS_CODE")),e.xp6(2),e.Q6J("ngStyle",3==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||74==c._trnMainService.TrnMainObj.VoucherType||31==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType?e.DdM(136,jn):null),e.xp6(1),e.MGl("id","itemDesc",l,""),e.Q6J("readonly",c.ReadOnlyForDescription(l))("ngModel",r.ITEMDESC)("disabled",e.Dn7(12,85,"disableItemDesc",l,c._trnMainService.callPipe)),e.xp6(6),e.Q6J("innerHtml",r.VARIANTDESCA,e.oJD),e.xp6(1),e.Q6J("ngIf","export-sales-invoice"===c.activeurlpath&&r.REMARKS),e.xp6(1),e.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),e.xp6(1),e.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),e.xp6(1),e.Q6J("ngIf",e.lcZ(22,89,"BATCH_EDITABLE")),e.xp6(2),e.Q6J("ngIf",e.xi3(24,91,"UNIT_EDITABLE",l)),e.xp6(2),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),e.xp6(1),e.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",e.xi3(33,94,"QUANTITY_EDITABLE",l)),e.xp6(2),e.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableOtherUnitQtyInTI),e.xp6(1),e.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType&&0==c.userSetting.LogBasedRequisitionApproval),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",e.xi3(43,97,"FCRATE_EDITABLE",0)),e.xp6(2),e.Q6J("ngIf",c.showRateField()&&c._trnMainService.showFieldFromRight("Rate")),e.xp6(1),e.Q6J("ngIf",3==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",e.DdM(137,kn).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1||"add-purchase-order"==c.activeurlpath),e.xp6(1),e.Q6J("ngIf",e.lcZ(48,100,"CONFACTOR")),e.xp6(2),e.Q6J("ngIf",e.lcZ(50,102,"ECSAmount")),e.xp6(2),e.Q6J("ngIf",(-1==e.DdM(138,Gi).indexOf(c._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=c.activeurlpath&&!c.userSetting.IsBBSM||90==c._trnMainService.TrnMainObj.VoucherType&&0===c.userSetting.LogBasedRequisitionApproval&&c.userSetting.IsBBSM)&&c._trnMainService.showFieldFromRight("Amt")),e.xp6(1),e.Q6J("ngIf",(14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||3==c._trnMainService.TrnMainObj.VoucherType||64==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||16==c._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=c.activeurlpath),e.xp6(1),e.Q6J("ngIf",(14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||3==c._trnMainService.TrnMainObj.VoucherType||64==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||16==c._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=c.activeurlpath),e.xp6(1),e.Q6J("ngIf",e.xi3(55,104,"DISCOUNT_AMT_EDITABLE_VATINCLU",l)),e.xp6(2),e.Q6J("ngIf",6===c.pType),e.xp6(1),e.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE||74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE),e.xp6(1),e.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",e.xi3(62,107,"DISCOUNT_IMPORTPURCHASE",l)),e.xp6(2),e.Q6J("ngIf",e.xi3(64,110,"DISCOUNT_IMPORTPURCHASE",l)),e.xp6(2),e.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableServiceCharge),e.xp6(1),e.Q6J("ngIf",e.xi3(67,113,"GST_AMT_NONEDITABLE",l)),e.xp6(2),e.Q6J("ngIf",e.lcZ(69,116,"showNetAmtNonEditable")),e.xp6(2),e.Q6J("ngIf",e.lcZ(71,118,"showNetAmtEditable")),e.xp6(2),e.Q6J("ngIf",(3==c._trnMainService.TrnMainObj.VoucherType||37==c._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||31==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",c.approvalFlag),e.xp6(1),e.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf","add-creditnote-itembase-approval"==c.activeurlpath||"add-stock-issue-approval"==c.activeurlpath||"transfer-out-approval"==c.activeurlpath||"stock-issue-approval"==c.activeurlpath),e.xp6(1),e.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",(19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||e.DdM(139,Vn).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1&&1==c.userSetting.BATCHWISEPRICE||8==c._trnMainService.TrnMainObj.VoucherType)&&c._trnMainService.showFieldFromRight("MRP")),e.xp6(1),e.Q6J("ngIf",e.xi3(81,120,"MFGDATE_EDITABLE",0)),e.xp6(2),e.Q6J("ngIf",e.xi3(83,123,"EXPDATE_EDITABLE",0)),e.xp6(2),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY&&1==c.userSetting.enableDayWiseMfgEXPDate),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",80==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",e.xi3(90,126,"MFGDATE_NONEDITABLE",0)),e.xp6(2),e.Q6J("ngIf",e.xi3(92,129,"EXPDATE_NONEDITABLE",0)),e.xp6(2),e.Q6J("ngIf",64==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||90==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||80==c._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.LinkProductionwithconsumption),e.xp6(3),e.Q6J("disabled",e.Dn7(98,132,"disableRowDelete",l,c._trnMainService.callPipe))}}function Bn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"span",188),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.addRowInsert())}),e.TgZ(1,"p"),e._uU(2,"+"),e.qZA()()}if(2&v){const r=e.oxw();e.ekj("disabled",r.disableAddRow())}}function Kn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"tr",197),e.NdJ("click",function(){const u=e.CHM(r).$implicit,R=e.oxw(2);return e.KtG(R.selectProductDetails(u))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()}if(2&v){const r=V.$implicit;e.xp6(2),e.Oqu(r.color),e.xp6(2),e.Oqu(r.size),e.xp6(2),e.Oqu(r.imeI1),e.xp6(2),e.Oqu(r.imeI2)}}function Zn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div")(1,"div",189)(2,"div",190)(3,"div")(4,"div")(5,"div",191)(6,"h4",192),e._uU(7," Product Details "),e.qZA(),e.TgZ(8,"button",47),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.closeProductDetails())}),e.TgZ(9,"span",48),e._uU(10,"\xd7"),e.qZA()()(),e.TgZ(11,"div",193)(12,"table",194)(13,"thead")(14,"tr",195)(15,"th"),e._uU(16,"Color Group"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Size Group"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"IMEI 1"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"IMEI 2"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,Kn,9,4,"tr",196),e.qZA()()()()()()()()}if(2&v){const r=e.oxw();e.xp6(24),e.Q6J("ngForOf",r.selectedProductDetails)}}function Fn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",198)(1,"PItemList",199),e.NdJ("dbClickEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.dblClickPopupItem(c))})("itemCloseClick",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.model1Closed())}),e.qZA()()}if(2&v){const r=e.oxw();e.xp6(1),e.Q6J("title",r.masterService.PlistTitle)}}function Qn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"create-manual-batch-popup",200),e.NdJ("closeBatchPopupEvent",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.toggleCreateBatch())})("emitCreatedBatchEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.emittedBatch(c))}),e.qZA()}if(2&v){const r=e.oxw();e.Q6J("activeIndex",r.activerowIndex)}}function Hn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",201)(1,"PBatchList",202),e.NdJ("dbClickEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.dblClickPopupBatch(c))})("BatchClosedClick",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.model1Closed())})("returnBatchValue",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.returnBatch(c))})("showCreateBatchEvent",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.showCreateBatchFromPopup())}),e.qZA()()}if(2&v){const r=e.oxw();e.xp6(1),e.Q6J("AlternateUnits",r.AlternateUnits)("activerowIndex",r.activerowIndex)("title",r.masterService.PlistTitle)("BList",r.batchlist)("voucherType",r._trnMainService.TrnMainObj.VoucherType)("activeurlpath",r.activeurlpath)}}function Gn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",201)(1,"popPartyChoose",203),e.NdJ("dbClickEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.dblClickPopupParty(c))})("partyCloseClick",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.partypopupClosed())}),e.qZA()()}if(2&v){const r=e.oxw();e.xp6(1),e.Q6J("partyList",r._trnMainService.partyList)}}function Yn(v,V){1&v&&(e.TgZ(0,"th",223),e._uU(1," CURRENT WS-PRICE "),e.qZA())}function Jn(v,V){1&v&&(e.TgZ(0,"th",224),e._uU(1," NEW WS-PRICE "),e.qZA())}function qn(v,V){if(1&v&&(e.TgZ(0,"td",226),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&v){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,r.WSRATE_A)," ")}}function Wn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"td",226)(1,"input",228),e.NdJ("change",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw(2);return e.KtG(R.onChangePurchasePrice(u,c))})("ngModelChange",function(c){e.CHM(r);const u=e.oxw().$implicit;return e.KtG(u.WNRATE_A=c)})("keydown.enter",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw(2);return e.KtG(R.onChangePurchasePrice(u,c))})("keydown.Tab",function(c){e.CHM(r);const u=e.oxw().index,R=e.oxw(2);return e.KtG(R.onChangePurchasePrice(u,c))}),e.qZA()()}if(2&v){const r=e.oxw(),l=r.index,c=r.$implicit,u=e.oxw(2);e.xp6(1),e.MGl("id","newWholeSellingPrice",l,""),e.Q6J("ngModel",c.WNRATE_A)("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem||u._trnMainService.TrnMainObj.ProdList[u.activerowIndex].BASEUNIT!=c.UNIT)}}function $n(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"tbody")(1,"tr",225)(2,"td",226),e._uU(3),e.qZA(),e.TgZ(4,"td",226),e._uU(5),e.ALo(6,"twoDigitNumber"),e.qZA(),e.YNc(7,qn,3,3,"td",227),e.TgZ(8,"td",226)(9,"input",228),e.NdJ("change",function(c){const R=e.CHM(r).index,F=e.oxw(2);return e.KtG(F.onChangePurchasePrice(R,c))})("ngModelChange",function(c){const R=e.CHM(r).$implicit;return e.KtG(R.NRATE_A=c)})("keydown.enter",function(c){const R=e.CHM(r).index,F=e.oxw(2);return e.KtG(F.onChangePurchasePrice(R,c))})("keydown.Tab",function(c){const R=e.CHM(r).index,F=e.oxw(2);return e.KtG(F.onChangePurchasePrice(R,c))}),e.qZA()(),e.YNc(10,Wn,2,3,"td",227),e.qZA()()}if(2&v){const r=V.$implicit,l=V.index,c=e.oxw(2);e.xp6(3),e.Oqu(r.UNIT),e.xp6(2),e.hij(" ",e.lcZ(6,7,r.CRATE_A)," "),e.xp6(2),e.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING),e.xp6(2),e.MGl("id","newSellingPrice",l,""),e.Q6J("ngModel",r.NRATE_A)("disabled","VIEW"==r.rowMode||r.isPurchaseOrderItem||c._trnMainService.TrnMainObj.ProdList[c.activerowIndex].BASEUNIT!=r.UNIT),e.xp6(1),e.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING)}}function zn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",204)(1,"div",205)(2,"div",206)(3,"h4",207),e._uU(4," Selling Price Setting "),e.qZA()(),e.TgZ(5,"div",208)(6,"div")(7,"h5",207),e._uU(8," Cost Price has been changed.Please reset your new Selling Price "),e.qZA(),e._UZ(9,"hr",209),e.qZA(),e.TgZ(10,"div",50)(11,"label"),e._uU(12,"Label MRP:"),e.qZA(),e.TgZ(13,"input",210),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.TrnMainObj.ProdList[u.activerowIndex].LABELMRP=c)}),e.qZA()(),e.TgZ(14,"fieldset")(15,"legend",211),e._uU(16," New Selling Price Setting "),e.qZA(),e.TgZ(17,"table",194)(18,"thead")(19,"tr",212)(20,"th",213),e._uU(21,"UOM"),e.qZA(),e.TgZ(22,"th",214),e._uU(23,"CURRENT S-PRICE"),e.qZA(),e.YNc(24,Yn,2,0,"th",215),e.TgZ(25,"th",216),e._uU(26,"NEW S-PRICE"),e.qZA(),e.YNc(27,Jn,2,0,"th",217),e.qZA()(),e.YNc(28,$n,11,9,"tbody",118),e.qZA(),e.TgZ(29,"div",50)(30,"div",218)(31,"h6"),e._uU(32),e.qZA()(),e.TgZ(33,"div",219),e._UZ(34,"div",220),e.qZA()()(),e.TgZ(35,"button",221),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.onApplyClickNewPrice())})("keydown.enter",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.onApplyClickNewPrice())}),e._uU(36," APPLY "),e.qZA(),e.TgZ(37,"button",222),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.onApplyOldPriceClick())})("keydown.enter",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.onApplyOldPriceClick())}),e._uU(38," APPLY OLD S-PRICE "),e.qZA()()()()}if(2&v){const r=e.oxw();e.xp6(13),e.Q6J("ngModel",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].LABELMRP),e.xp6(11),e.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),e.xp6(3),e.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngForOf",r._trnMainService.priceChangeList),e.xp6(4),e.hij(" Recommended Margin: ",r._trnMainService.selectedProdcutRecMargin,"% ")}}function Xn(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div")(1,"div",229)(2,"div",230)(3,"div",191)(4,"h5",192),e._uU(5," Discount authorization "),e.qZA(),e.TgZ(6,"button",47),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.closeModal())}),e.TgZ(7,"span",48),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",49)(10,"div",231)(11,"label",232),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",233)(14,"input",234),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.disAuthObj.username=c)}),e.qZA()()(),e.TgZ(15,"div",231)(16,"label",232),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",233)(19,"input",235),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.disAuthObj.password=c)}),e.qZA()()(),e.TgZ(20,"div",231)(21,"label",232),e._uU(22,"Discount:"),e.qZA(),e.TgZ(23,"div",236)(24,"input",237),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.disAuthObj.discount=c)}),e.qZA()(),e.TgZ(25,"div",238)(26,"a"),e._uU(27,"% \xa0"),e.qZA()()(),e.TgZ(28,"div",239)(29,"fieldset",240)(30,"legend",241),e._uU(31," Discount authorization remarks: "),e.qZA(),e.TgZ(32,"textarea",242),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.disAuthObj.remarks=c)}),e.qZA()()()(),e.TgZ(33,"div",243)(34,"button",244),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.discountAuthConfirm())}),e._uU(35," Confirm "),e.qZA()()()()()}if(2&v){const r=e.oxw();e.xp6(14),e.Q6J("ngModel",r.disAuthObj.username),e.xp6(5),e.Q6J("ngModel",r.disAuthObj.password),e.xp6(5),e.Q6J("ngModel",r.disAuthObj.discount),e.xp6(8),e.Q6J("ngModel",r.disAuthObj.remarks)}}function er(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div")(1,"itemwisebatch",245),e.NdJ("BatchClosedEmit",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.BatchPopupClosed())})("dbClickEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.dblClickPopupBatchs(c))}),e.qZA()()}if(2&v){const r=e.oxw();e.xp6(1),e.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function tr(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div")(1,"itemwisebatch",245),e.NdJ("BatchClosedEmit",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.AdjustPopupClosed())})("dbClickEvent",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u.DblClickPopupAdjust(c))}),e.qZA()()}if(2&v){const r=e.oxw();e.xp6(1),e.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function ir(v,V){1&v&&(e.TgZ(0,"h6",192),e._uU(1," Authorization for Negative Stock Entry "),e.qZA())}function nr(v,V){1&v&&(e.TgZ(0,"h6",192),e._uU(1," Credit Sales Authorization "),e.qZA())}function rr(v,V){if(1&v){const r=e.EpF();e.TgZ(0,"div",246)(1,"div",247)(2,"div",230)(3,"div",191),e.YNc(4,ir,2,0,"h6",248),e.YNc(5,nr,2,0,"h6",248),e.TgZ(6,"button",47),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.closeModal())}),e.TgZ(7,"span",48),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",49)(10,"div",231)(11,"label",232),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",233)(14,"input",249),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disAuthObj.username=c)}),e.qZA()()(),e.TgZ(15,"div",231)(16,"label",232),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",233)(19,"input",235),e.NdJ("ngModelChange",function(c){e.CHM(r);const u=e.oxw();return e.KtG(u._trnMainService.disAuthObj.password=c)}),e.qZA()()()(),e.TgZ(20,"div",243)(21,"button",244),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.confirmAuthorization())}),e._uU(22," Confirm "),e.qZA(),e.TgZ(23,"button",250),e.NdJ("click",function(){e.CHM(r);const c=e.oxw();return e.KtG(c.closeModal())}),e._uU(24," Cancel "),e.qZA()()()()()}if(2&v){const r=e.oxw();e.xp6(4),e.Q6J("ngIf",1==r._trnMainService.showNegativeBilling||1==r.userRightAuthService.showAuthPopup),e.xp6(1),e.Q6J("ngIf",r._trnMainService.showCreditSalesAuth),e.xp6(9),e.Q6J("ngModel",r._trnMainService.disAuthObj.username),e.xp6(5),e.Q6J("ngModel",r._trnMainService.disAuthObj.password)}}const or=function(){return{width:"28%"}},sr=function(){return{width:"25%"}},ar=function(){return{width:"24%"}},cr=function(){return{width:"40%"}},lr=function(){return{backdrop:"static"}};let dr=(()=>{class v{constructor(r,l,c,u,R,F,le,Se,Re,xe,ye,ji,hr,ur,pr,_r){this.masterService=r,this._trnMainService=l,this.setting=c,this.dialog=u,this.fb=R,this.arouter=F,this.alertService=le,this.authservice=Se,this.changeDetection=Re,this.loader=xe,this.validationService=ye,this.responseMsgService=ji,this.userRightAuthService=hr,this.productHelperService=ur,this.focusService=pr,this.salesRateDisabled=_r,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.stringValue="",this.hoverId=null,this.hoverIndId=null,this.onHoverItemDesc=!1,this.itemDescHoverValue="",this.showCreateBatch=!1,this.TotalBill=new e.vpe,this.gridPopupSettingsForSupplier=new O.im,this.barcodeGridSettings=new O.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new e.vpe,this.onChangeProductionItem=new e.vpe,this.indexEmit=new e.vpe,this.activeRowEmit=new e.vpe,this.emitShowPopup=new e.vpe,this.activeRowEmitForEdit=new e.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.showtooltip=!1,this.qtyValue="",this.qtyId=null,this.rateValue="",this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new O.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showHoverInd=!1,this.isQtyZero=!0,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInSprice=!0,this.applyPipeInECS=!0,this.mfgExpDateType="month",this.currDate="",this.maxDate="",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=Yi=>{let Ae=Object.assign({},this.trnProd),Ji=[],qi=0;for(var Pe of Yi)if(Ae.VaraintDetailS=[],this.masterService.nullToZeroConverter(Pe.QTY)>0){let Vi="";Ae.VARIANTDESCA="";var Wi={};for(var Je in Pe)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Je)&&(Vi+=Pe[Je].VARIANTBARCODE,Ae.VARIANTDESCA=Ae.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Je)}</b>:${Pe[Je].NAME} &nbsp;`,Wi[Pe[Je].VARIANTNAME]=Pe[Je].NAME);Ae.VaraintDetailS.push(Wi),Ae.VARIANTLIST=Pe,Ae.BC=Pe.BARCODE?Pe.BARCODE:Ae.MCODE+Vi,Ae.Quantity=Pe.QTY,Ae.MRP=Pe.MRP,Ae.ALTMRP=Pe.MRP,Ae.REALQTY_IN=Pe.QTY,Ae.ALTERNATEQUANTIY=Pe.QTY,Ae.AltQty=Pe.QTY,Ae.PRATE=Pe.PRATE,Ae.RATE=Pe.PRATE,Ae.REALRATE=Pe.PRATE,Ae.ALTRATE=Pe.PRATE,Ae.SPRICE=Pe.SRATE,Ae.SellingPrice=Pe.SRATE,Ae.ALTRATE2=Pe.SRATE,this.trnMain.VoucherType==t.Km.ProductionEntry&&(Ae.SELLRATEBEFORETAX=Pe.SRATE),Ae.BATCH=`-${qi}`,Ji.push(Object.assign({},Ae)),qi++}let ki=this.trnMain.ProdList.slice(0,this.activerowIndex),Mr=this.trnMain.ProdList.slice(this.activerowIndex+1);for(var mr of(this.trnMain.ProdList.splice(this.activerowIndex),Ji))ki.push(mr);for(var gr of Mr)ki.push(gr);this.trnMain.ProdList=ki,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)};const Tr=new Date;this.currDate=(0,C.p6)(Tr,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this.trnMain.VoucherType&&(this.AppSettings=c.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this.trnMain.VoucherType===t.Km.StockIssue&&(this.showDiscount=!1),r.ShowMore=!0}catch{}this.activeurlpath=F.snapshot.url[0].path,this.trnMain.CHALANNO="","export-sales-invoice"==this.activeurlpath?this.FCRATELABEL="FC E.Rate":(t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag)&&(this.FCRATELABEL="FC P.Rate")}ngAfterContentChecked(){this.changeDetection.detectChanges()}get trnMain(){return this._trnMainService.TrnMainObj}get trnProd(){return this.indexedProd(this.activerowIndex)}indexedProd(r){return this.trnMain.ProdList[r]}updown(r){"number"===r.target.type&&("-"===r.key||"Minus"===r.key)&&r.preventDefault(),"F2"===r.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F7"==r.code&&(r.preventDefault(),this.trnMain.VoucherType===t.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===r.code&&(r.preventDefault(),"VIEW"==this.trnMain.Mode.toUpperCase()&&this._trnMainService.inputCode&&this.trnProd.ProductDetails.length>0&&this.dialougeOpen()),"F11"==r.code&&r.ctrlKey&&(r.preventDefault(),this._trnMainService.barCodes.BC||null!=this.trnProd.MCODE&&this.checkBatchWiseRate()),"Escape"==r.code&&(r.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}model1Closed(){this.masterService.PlistTitle="",1==this.trnProd.REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{this.focusAltQty()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;const r=new Date;0==this.userSetting.EnablePreviousDateInExpiry&&(this.currDate=(0,C.p6)(r,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",0==this.userSetting.enableDayWiseMfgEXPDate&&(this.currDate=(0,C.p6)(r,"yyyy-MM","en-US"),this.maxDate="2999-12"))}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this.trnProd.MCODE).subscribe(r=>{this.colorLists=r&&r.result?r.result:[]})}RowClick(r){this.activerowIndex=this.rowIndex=r,this.masterService.ShowMore=!1,console.log("row click",this.trnProd.POSTOCK,this.trnProd.PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(r),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])}disableECS(r){return!!(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL.startsWith("SO")&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==t.Km.Sales)||r.ECSRATE>0||0==r.HASECSCHARGE)}disableAddRow(){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.REFORDBILL)return!0}descriptionEditOnRowClick(r){this._trnMainService.allowDescriptionEdit=1==this.trnProd.ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let r=0;if(r=this.trnMain.ProdList.length-1,this.trnMain.ProdList&&null!=this.indexedProd(0).MENUCODE)return this.trnMain.ProdList.findIndex(c=>c.BC==this._trnMainService.barCodes.BC&&0==c.FulfillBatchQty)+1}highlightLessStockItem(r){return!!(this.trnMain.VoucherType===t.Km.RequisitionApproval&&null!=this.indexedProd(r).MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this.indexedProd(r).APPROVEDALTQTY||this.trnMain.VoucherType===t.Km.BranchTransferOut&&2==this.userSetting.EnablePIReferenceInTransferOut&&this._trnMainService.TrnMainObj.REFBILL&&"EDIT"!=this._trnMainService.TrnMainObj.ProdList[r].rowMode?.toUpperCase()&&this.indexedProd(r).PSTOCK>this.indexedProd(r).TOTALSTOCK)}showPOQtyRate(r){this.trnMain.REFORDBILL&&(this.trnMain.VoucherType===t.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===t.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||0!==this.userSetting.ENABLE_SOINTI&&(this.trnMain.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)||this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType===t.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this.indexedProd(r).POSTOCK,this._trnMainService.purchaseOrderRate=this.indexedProd(r).ALTRATE,this._trnMainService.produstWiseOrderUnit=this.indexedProd(r).BASEUNIT)}openDialog(r){this.selectedIndex=r}ItemBarCodeClick(r,l){if(this.activerowIndex=r,this.trnMain.VoucherType!=t.Km.ProductionEntry||this.trnMain.BILLTO){if(!this.indexedProd(r).BC&&(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&"NEW"!==this.trnMain.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this.indexedProd(r).ProductDetails,this.indexedProd(r).visible=!0,this.getProductColorMcodeWise(),!1;if(this.trnMain.VoucherType===t.Km.DebitNote&&"PI"===this.trnMain.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this.indexedProd(r).ProductDetails,this.indexedProd(r).visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this.trnMain.Mode||"EDIT"===this.trnMain.Mode)&&6===this.indexedProd(r).Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this.indexedProd(r).BC||null==this.indexedProd(r).BC||""==this.indexedProd(r).BC)1==this.indexedProd(r).isBarcodeOfPtypeSix&&(this.indexedProd(r).isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this.trnMain.ProdList[r]={}},0)),null!=document.getElementById("itemDesc"+r)&&setTimeout(()=>{document.getElementById("itemDesc"+r).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this.trnMain.VoucherType!==t.Km.CreditNote&&this.trnMain.VoucherType!==t.Km.SalesReturn){let c=this.trnMain.ProdList.filter(R=>R.BC==this.indexedProd(r).BC);if(null!=c&&c?.length>1)return this.alertService.info(`Duplicate barcode:${this.indexedProd(r).BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)});this.trnMain.ProdList.filter(R=>6==R.PTYPE).forEach(R=>R.ProductDetails?.forEach(F=>{if(F.IEMI1==this.trnProd.BC)return this.alertService.info(`Duplicte IMEI1 :${F.IEMI1} is found on Bulk Entry Grid`),this.trnProd.BC=null,!1}))}this.indexedProd(r).BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this.indexedProd(r).BC,this.trnMain.REFBILL).subscribe(c=>{"ok"==c.status?(this._trnMainService.ReturnStockObj=c.result,this.loadBarcodeWiseProductList(c.result.TotalStock)):(this.alertService.info(c.result),this.alertService.emitShowHideSubject.subscribe(u=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)}))},c=>{this.alertService.info(c.result)}):this._trnMainService.checkBarcode(this.indexedProd(r).BC,this.trnMain.MWAREHOUSE).subscribe(c=>{"ok"==c.status?this.loadBarcodeWiseProductList():this.alertService.info(c.result)},c=>{this.alertService.info(c.result)}))}}else this.alertService.info("Please select Production warehouse")}ItemkeyEvent(r,l){if(this.trnMain.VoucherType===t.Km.TaxInvoice&&"export-sales-invoice"===this.activeurlpath){if(""===this.trnMain.FCurrency||null==this.trnMain.FCurrency)return this.masterService.ShowMore=!0,void this.alertService.info("Please specify currency value first");if(null==this.trnMain.EXRATE)return void this.alertService.info("EX Rate cannnot be null")}if(l.preventDefault(),this.activerowIndex=r,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this.trnMain.VoucherType===t.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this.trnMain.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this.trnMain.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this.trnMain.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this.trnMain.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this.trnMain.TRNACName||null==this.trnMain.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this.trnMain.TRNACName||null==this.trnMain.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this.trnMain.REMARKS||null==this.trnMain.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});this.showStockedQuantityOnly=0}else this.trnMain.VoucherType===t.Km.PerformaSalesInvoice||this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.Repack||this.trnMain.VoucherType===t.Km.Quotation?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this.trnProd.BARCODE??""):this.showStockedQuantityOnly=0;if("performa-invoice"==this.activeurlpath&&null==this.trnMain.BILLTO)return void this.alertService.info("Please select customer first");if(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this.trnMain.VoucherType===t.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===t.Km.Purchase&&(0!==this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_GRN_IN_PI)&&"purchase-import"!==this.activeurlpath&&0==this.userSetting.DisablePOReferenceRequired||this.trnMain.VoucherType===t.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&0==this.userSetting.DisablePOReferenceRequired||this.trnMain.VoucherType===t.Km.SalesOrder&&this.trnMain.REFORDBILL&&0!==this.userSetting.ENABLE_QUOTATTION_INSO||this.trnMain.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this.trnMain.VoucherType===t.Km.BranchTransferOut&&1===this.trnMain.ISLOADFROMORDER||this.trnMain.VoucherType===t.Km.StockIssue&&1===this.trnMain.ISLOADFROMORDER){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&0!=this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER){if(!this.trnMain.REFORDBILL){console.log("ETA ROKYO ?");let c=this.responseMsgService.getProperMessageForRefBill(this.trnMain);return this.alertService.info(c),!1}}else if(null==this.trnMain.REFBILL||""==this.trnMain.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this.trnMain.VoucherType===t.Km.StockIssueReturn){if(!this.trnMain.REFORDBILL)return this.alertService.info(this.responseMsgService.getProperMessageForRefBill(this.trnMain)),!1;this.gridPopupSettings.apiEndpoints=`/getMenuitemFromProdForIssueReturnPagedList/${this.trnMain.BILLTO}`}else if(this.trnMain.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this.trnMain.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this.trnMain.VoucherType===t.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath&&1==this.userSetting.DisablePOReferenceRequired&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===t.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&1==this.userSetting.DisablePOReferenceRequired&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&0==this.userSetting.SOREFERENCE_REQUIRED&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType==t.Km.Sales&&0!==this.userSetting.ENABLE_SOINTI&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===t.Km.PerformaSalesInvoice&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===t.Km.BranchTransferOut&&0==this.trnMain.DOFULLRETURN)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else{let u,c="";"self-billing"===this.activeurlpath?c="SB":null!=this.trnMain.VoucherPrefix&&(c=this.trnMain.VoucherPrefix);let R="";if(R=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.trnMain.VoucherType===t.Km.StockIssue&&(R=this.trnMain.BILLTO,null==this.trnMain.BILLTO))return void this.alertService.info("Please select From Warehouse before selecting an item ");if(this.trnMain.VoucherType===t.Km.RequisitionEntry&&(null==this.trnMain.MWAREHOUSE||""==this.trnMain.MWAREHOUSE))return void this.alertService.info("Please select Warehouse before selecting item");if(u=this.trnProd.BC,(0==this.userSetting.GblBarcodeWiseBilling||null==u||void 0===u||""==u)&&(u="A"),this.productListInGenericPopup(r,u,c,R),this.trnMain.VoucherType==t.Km.ProductionEntry){if(!this.trnMain.BILLTO)return void this.alertService.info("Please select Production warehouse");R=this.trnMain.BILLTO}this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.INVOICETYPE&&"StockIssue"==this._trnMainService.TrnMainObj.INVOICETYPE&&(R=this._trnMainService.TrnMainObj.BILLTO),this.gridPopupSettings.apiEndpoints=this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder&&this.userSetting.EnableDeliveryWarehouseSelectionInSO&&this._trnMainService.deliveryWarehouse&&this._trnMainService.deliveryWarehouse!=R?`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${u}/all/${c}/${this._trnMainService.deliveryWarehouse}`:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${u}/all/${c}/${R}`}if(this.trnMain.VoucherType===t.Km.CreditNote&&"NewBill"===this.trnMain.AdditionalObj.INVOICETYPE){let c="";null!=this.trnMain.VoucherPrefix&&(c=this.trnMain.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}if("add-membership-sales-invoice"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getMenuItemListForMembershipSales"),this.trnMain.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==t.Km.GoodsReceived&&"GOODS_RECEIVED_NOTE_IMPORT"==this._trnMainService.TrnMainObj.AdditionalObj.tag){if(null==this.trnMain.BILLTO||void 0===this.trnMain.BILLTO||""==this.trnMain.BILLTO)return void this.alertService.info("Please Choose Supplier to Proceed...");if(!this.trnMain.EXRATE)return void this.alertService.info("Please choose exchange rate to proceed or exchange rate cannot be zero...")}return this._trnMainService.itemselectevent=!0,this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType==t.Km.StockIssueReturn||this.trnMain.VoucherType==t.Km.BranchTransferOut||this.trnMain.VoucherType==t.Km.TaxInvoice||this.trnMain.VoucherType==t.Km.SalesOrder||this.trnMain.VoucherType==t.Km.StockIssue||"FROMPO"==this.trnMain.AdditionalObj.INVOICETYPE||"FROMSO"==this.trnMain.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this.trnMain.AdditionalObj.INVOICETYPE?this.trnMain.REFORDBILL:this.trnMain.REFBILL),!1}this.displayProductDetailInViewMode(l)}}productListInGenericPopup(r,l,c,u){if(1==this.indexedProd(r).ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let R=this.indexedProd(r).ITEMDESC;R&&""!=R?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+r).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${u}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${u}`}displayProductDetailInViewMode(r){console.log("eventlog",r),"VIEW"==this.trnMain.Mode.toUpperCase()&&"F9"==r.code&&this.dialougeOpen()}onChangeExpDate(){if(this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.warning("Production item is not selected!!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.warning("Quantity is not selected!!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE)return void this.alertService.warning("Manufacture Date is not selected!!")}}loadBarcodeWiseProductList(r=0){this.loadFromBarcode=!1;let c=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this.trnMain.VoucherPrefix}&barcode=${this.trnProd.BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(R=>{if("ok"===R.status)if(c=R.result.data,0===c.length)this.alertService.info("Product is out of Stock ");else if(1===c.length){this.loadFromBarcode=!0;var F=c[0];if(this._trnMainService.CheckIfSalesReturn()){F.STOCK=r;var le=0;for(let xe of this.trnMain.ProdList)xe.BC==this.trnProd.BC&&(le+=xe.ALTERNATEQUANTIY);if(F.STOCK<le)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(F),this.loadFromBarcode=!1,this.trnProd.VARIANTDESCA="",F.barcodeDetails){var Se=JSON.parse(F.barcodeDetails);for(var Re in console.log("varDetail",Se),Se)this.trnProd.VARIANTDESCA+=`<b>${Re}</b>:${Se[Re]} &nbsp;`}}else this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(R.result.error)})}checkDuplicatProductWithBarcode(){let r=[];return r=this.trnMain.ProdList.filter(l=>l.BARCODE===this.trnProd.BARCODE),r.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}batchFocusOut(r,l){l.target.value&&this.productHelperService.checkBatch(this._trnMainService.TrnMainObj.ProdList[r].MCODE,l.target.value).subscribe(R=>{},R=>{this._trnMainService.TrnMainObj.ProdList[r].BATCH=null})}checkBatchWiseRate(){this.batchlist=[];let r=this.trnMain.VoucherPrefix;"self-billing"===this.activeurlpath&&(r="SF");let l="";l=this.trnMain.VoucherType==t.Km.Repack?this.trnProd.PMCODE:this.trnProd.MCODE;let c="";c=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse;let u="";("add-sales-invoice-wholesale"===this.activeurlpath||this.trnMain.VoucherType==t.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate)&&(u="wholesale"),this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${l}&voucherPrefix=${r}&warehouse=${encodeURIComponent(c)}&barcode=&tag=${u}&CUSTID=${this.trnMain.PARAC}&PRICEMODE=${this.trnMain.PRICEMODE}&UNIT=${this.trnProd.UNIT}`).subscribe(R=>{if(console.log("resp1",R,R.message),"ok"===R.status)this.batchlist=R.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this.trnProd.REQEXPDATE&&!this.trnProd.BARCODE&&(this.masterService.PlistTitle="Batch Selection"),!R.message&&this.trnMain.VoucherType===t.Km.ProductionEntry&&this.userSetting.EnableManualBatchinproduction&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===R.message&&this.trnMain.VoucherType===t.Km.Repack&&(this.batchWiseStockTax(R.result),this.changeBatchWiseRate(R.result[0].RATE)),"replacerate"===R.message&&(this.changeBatchWiseRate(R.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(R.result),this.trnProd.PRATE=R.result[0].costprice),"SHOWPRICEPOPUP"===R.message&&(this.masterService.PlistTitle="Batch Price Selection",this.trnProd.HasMulitplePrice=1,this.trnMain.VoucherType===t.Km.Repack&&this.changeBatchWiseRate(R.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this.trnMain.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!");else{if("error"===R.status&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.OpeningStockBalance)return void this.alertService.info(R.result);"error"==R.status&&this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&(this.masterService.PlistTitle="Batch Selection")}})}checkBatchWiseRateSettingZero(){this.batchlist=[];let l="",c="";l=this.trnMain.VoucherType==t.Km.Repack?this.trnProd.PMCODE:this.trnProd.MCODE,c=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${l}&voucherPrefix=${this.trnMain.VoucherPrefix}&warehouse=${c}&barcode=`).subscribe(u=>{"ok"===u.status&&(this.batchlist=u.result,"SHOWPRICEPOPUP"===u.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(r){(this.trnMain.VoucherType==t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.Repack||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice||"consumption"===this.trnMain.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(r)>0&&(this.trnProd.RATE=r,this.trnProd.REPACKRATE=r,this.trnProd.PRATE=r,this.trnProd.ALTRATE=this.trnMain.VoucherType==t.Km.Repack?this.trnProd.RATE*this._trnMainService.nullToZeroConverter(this.trnProd.CONFACTOR):r,console.log("ratealt",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,r),this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(r){null!=this.trnProd.Product.AlternateUnits.filter(c=>1==c.ISDEFAULTPUNIT)[0]&&(this.trnProd.ALTRATE=this.trnProd.RATE*this.trnProd.ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(r){1===this.trnProd.REQEXPDATE&&this.trnProd.BC&&(this.trnProd.MFGDATE=null==r[0].MFGDATE?"":r[0].MFGDATE.toString().substring(0,7),this.trnProd.EXPDATE=null==r[0].EXPDATE?"":r[0].EXPDATE.toString().substring(0,7),this.trnProd.BATCH=r[0].BATCH)}batchWiseSalesRateBeforeTax(r){this.trnMain.VoucherType===t.Km.Repack&&(this.trnProd.SELLRATEBEFORETAX=r)}batchWiseStockTax(r){this.trnMain.VoucherType===t.Km.Repack&&(this.trnProd.STOCK=r.map(l=>l.STOCK).reduce((l,c)=>l+c,0))}BatchEnter(r,l){this.activerowIndex=r,l.preventDefault();let c=this.trnMain.VoucherType;if(this.trnProd.VRATE=l.LANDINGCOST,this.activeRowEmit.emit(this.trnProd),1!=this.userSetting.EnableBatch||"SI"!=this.trnMain.VoucherPrefix&&"TI"!=this.trnMain.VoucherPrefix&&"CN"!=this.trnMain.VoucherPrefix&&"PP"!=this.trnMain.VoucherPrefix){if(2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this.trnProd.EnableAutoBatch)&&c in t.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),2==this.userSetting.EnableBatch&&this.trnMain.VoucherType==t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this.trnMain.VoucherType==t.Km.BatchAdjustment||this.checkBatchWiseRate(),this.trnMain.VoucherType===t.Km.ProductionEntry)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC?(this.checkBatchWiseRate(),void setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20)):void this.alertService.info("Please Select Production Item!");if(null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this.trnMain.VoucherType==t.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){this.batchList=[];let u=this.indexedProd(r).MCODE,R=this._trnMainService.TrnMainObj.MWAREHOUSE;u&&this.masterService.getItemWiseBatch(u,R).subscribe(F=>{"ok"==F.status&&(this.batchList=F.result.filter(le=>le.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20)}PstockEnter(r,l){l.preventDefault(),this.trnMain.VoucherType==t.Km.Stockadjustment&&document.getElementById("computerStock"+r).focus()}CstockEnter(r,l){l.preventDefault(),this.trnMain.VoucherType==t.Km.Stockadjustment&&this.focusAltQty(r)}AdjustBatchEnter(r){if(this.trnMain.VoucherType=t.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let l=this.indexedProd(r).MCODE,c=this._trnMainService.TrnMainObj.MWAREHOUSE;l&&this.masterService.getAdjustingBatch(l,c).subscribe(u=>{console.log("get batch list",u),"ok"==u.status&&(this.batchList=u.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(r){this.trnMain.VoucherType==t.Km.BatchAdjustment&&(this.trnProd.VRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this.trnProd.BATCHID=r.BATCHID),1==this.trnMain.ADJUSTEXPIRY&&(this.trnProd.EXPDATE=r.EXPDATE,this.trnProd.SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this.trnProd.MRP=r.MRP,this.trnProd.RATE=r.COSTPRICE,this.trnProd.BASERATE=r.COSTPRICE,this.trnProd.ALTRATE=r.COSTPRICE,this.trnProd.CRATE=r.COSTPRICE,this.trnProd.PRATE=r.COSTPRICE)),this.checkDuplicateSourceBarcode(r.BATCHCODE,r.MCODE)&&(this.trnProd.BATCH=r.BATCHCODE,this.trnProd.STOCK=r.STOCK,1==this.trnProd.HASVARIANT&&(this.trnProd.BC=r.BC),this.showBatchPopup=!1,this.focusAltQty())}checkDuplicateSourceBarcode(r,l){return!r||!this.trnMain.ProdList.find(c=>c.BATCH==r&&c.MCODE==l)||(this.alertService.info(`Batch ${r} is already selected as a source barcode for the item.`),!1)}DblClickPopupAdjust(r){r.BATCHCODE!=this.trnProd.BATCH?(this.trnProd.ADJUSTBATCH=r.BATCHCODE,this.trnProd.INVRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this.trnProd.MANUFACTURER=r.BATCHID),1==this.trnProd.HASVARIANT&&(this.trnProd.ADJUSTBC=r.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}selectProductDetails(r){let l=[];l=r,this.trnProd.ProductDetails.push(l),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this.trnProd.MCODE,vchrno:this.trnMain.REFBILL}).subscribe(l=>{l&&"ok"===l.status?(this.isProductDetailView=!0,this.selectedProductDetails=l.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},l=>{this.selectedProductDetails=[]})}discEnterClicked(r,l){if(this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this.trnMain.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DOFULLRETURN)0==this._trnMainService.nullToZeroConverter(this.trnProd.REQEXPDATE)?(console.log("reach1"),this.checkValidation(r)):document.getElementById("mfgdate"+r).focus();else if(this.trnMain.VoucherType===t.Km.DebitNote)this.checkValidation(r);else if(this.trnMain.VoucherType===t.Km.TaxInvoice)1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(r);else if(this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice){let c={isFocusAchieved:!1};this.focusService.autoFocus(r,document.getElementById("discountAmt"+r),c,"productinserttable"),c.isFocusAchieved||this.checkValidation(r)}else this.trnMain.VoucherType===t.Km.Quotation||this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===t.Km.SalesOrder?document.getElementById("remarks"+r).focus():this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag?this.checkValidation(r):document.getElementById("mfgdate"+r).focus();return!1}ECSEnterClicked(r,l){l.preventDefault();let c={isFocusAchieved:!1};this.focusService.autoFocus(r,document.getElementById("ECSAmount"+r),c,"productinserttable"),c.isFocusAchieved||this.checkValidation(r),this._trnMainService.ReCalculateBillWithNormal()}approvedQtyEnter(r){let c=this.indexedProd(r);if(this.validationService.checkStockforApprovalQty(c)&&!c.isConfirmed&&0==this.userSetting.LogBasedRequisitionApproval){console.log("reach");let u=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(u,"ReqApproval")}c.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(c,r)&&setTimeout(()=>{null!=document.getElementById("remarks"+r)&&document.getElementById("remarks"+r).focus()},50),this.validationService.validateStockinReqApproval(c,r,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(r){if(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales){let l=this.masterService.userProfile.roleRights.find(c=>"DISLIMIT"==c.right);console.log("disLimt on discount rate",l),l&&this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit of :"+l.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if(this.trnMain.VoucherType===t.Km.SalesOrder){let l=this.masterService.userProfile.userRights.find(c=>"DISLIMIT"==c.right);l&&this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit for sales order ("+l.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)?document.getElementById("discountAmt"+r).focus():document.getElementById("remarks"+r).focus()},0)}))}(this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.Quotation||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType===t.Km.PurchaseOrder||this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)&&(this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>0?this.trnMain.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this.trnMain.VoucherType==t.Km.SalesOrder?document.getElementById("discountAmt"+r).focus():this.checkValidation(r):0==this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)?(this.trnMain.VoucherType==t.Km.Purchase&&"purchase-import"==this.activeurlpath||null!=document.getElementById("discountAmti"+r))&&document.getElementById("discountAmti"+r).focus():this.trnMain.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+r).focus():document.getElementById("mfgdate"+r).focus())}indDiscEnterClicked(r,l){l.preventDefault();var c=this._trnMainService.TrnMainObj.ProdList[r];if(null!=c){if(null==c.MCODE)return void this.alertService.warning("Please select a Product");if(!c.ALTERNATEQUANTIY)return void this.alertService.warning(`Qty Is Not Specified For The Item ${c.ITEMDESC} (${c.MENUCODE}) Please Check Your Entry.`)}if(l.altKey&&"Enter"===l.key||l.key>="0"&&l.key<="9")this.discountPopup.show();else{if("Enter"!==l.key&&"Tab"!==l.key)return"Backspace"==l.key?(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=0,void this._trnMainService.ReCalculateBillWithNormal()):void 0;this.discEnterClicked(r,l)}}addRowInsert(){this.trnMain.VoucherType==t.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.fromRequistionToTransferOut&&1==this.trnMain.DOFULLRETURN||this.trnMain.VoucherType==t.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.requisitionFromNotification||"VIEW"!=this.trnMain.Mode&&this._trnMainService.addRow()}checkValidation(r){var l=this.indexedProd(r);if(null!=l){if(null==l.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this.trnMain.VoucherType==t.Km.TaxInvoice&&0==l.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${l.ITEMDESC} (${l.MENUCODE}) Please Check Your Entry.`),!1}if(this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType==t.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE){var c=this.masterService.groupBy(this.trnMain.ProdList.filter(R=>0==R.ISUNKNOWN&&0==R.REQEXPDATE),function(R){return[R.MCODE,R.RATE,R.BC,R.BATCH]});for(const R of c)if(R.length>1){const F=R[0];return this.alertService.warning(`Cannot enter  "${F.ITEMDESC}" with same rate "${F.ALTRATE}".`),!1}}if((this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType===t.Km.ProductionEntry)&&null!=this.trnMain.ProdList.filter(F=>1==F.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(F.EXPDATE))[0]&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return document.getElementById("mfgdate"+r).focus(),!1;if(this.trnMain.VoucherType===t.Km.BatchAdjustment&&1==this.trnMain.ADJUSTEXPIRY){let R=this.trnMain.ProdList.filter(le=>le.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(le.TransferExpiryDate))[0];if(null!=R&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Exp Date is required for item:${R.ITEMDESC}`),!1;let F=this.trnMain.ProdList.filter(le=>le.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(le.TransferMfgDate))[0];if(null!=F&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Mfg Date is required for item:${F.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this.trnMain.AdditionalObj.tag&&null!=this.indexedProd(r).SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).Quantity)+this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)>this._trnMainService.nullToZeroConverter(this.indexedProd(r).SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+r).focus(),!1;if((this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.indexedProd(r).Quantity>this.indexedProd(r).STOCK&&"EDIT"!==this.indexedProd(r).rowMode?.toUpperCase()&&this.indexedProd(r).STOCK>0&&9!=this.indexedProd(r).PTYPE&&this.indexedProd(r).PTYPE<10)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this.trnMain.VoucherType==t.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():(this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()),!this.trnMain.ProdList.some(R=>null==R.MCODE)&&!1===this._trnMainService.addRow())return;let u=r+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.ProductionEntry||this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.OpeningStockBalance?setTimeout(()=>{const R=document.getElementById("barcode"+u);null!=document.getElementById("barcode"+u)&&1!=R.disabled?(console.log("rn1"),this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.CreditNote?(document.getElementById("itemDesc"+u).focus(),this.resetDescriptionEdit()):this.trnMain.VoucherType===t.Km.BranchTransferOut?document.getElementById("itemDesc"+u).focus():document.getElementById("barcode"+u).focus()):document.getElementById("itemDesc"+u).focus()},0):setTimeout(()=>{null!=document.getElementById("itemDesc"+u)&&(document.getElementById("itemDesc"+u).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+u)&&document.getElementById("itemDesc"+u).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}returnBatch(r){if(console.log("returnBatch hit"),"self-billing"==this.activeurlpath&&this.trnMain.ProdList.filter(u=>u.BATCH==r.BATCH&&u.MCODE==r.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance&&2==this.userSetting.EnableBatch&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].enableSalesPrice=!1),this._trnMainService.assignBatchToActiveProdRow(r,this.activerowIndex),this.masterService.PlistTitle="",this.trnProd.PriceSelected=!0,1===this.trnProd.HASVARIANT)for(var l in this.trnProd.VARIANTLIST=r.VARIANTDETAIL,this.trnProd.VARIANTDESCA="",this.trnProd.BC=r.BCODE,this.trnProd.VARIANTLIST)console.log("Var attribute",l,this.trnProd.VARIANTLIST[l]),this.trnProd.VARIANTDESCA+=`<b>${l}</b>:${this.trnProd.VARIANTLIST[l]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance)&&this.focusAltQty()}}dblClickPopupBatch(r){console.log("eta aaucha ????/"),this.returnBatch(r),document.getElementById("alternateQty"+this.activerowIndex).focus()}QuantityChangeEvent(r,l){let c=this.trnMain.VoucherType;if(1!=this.isQtyZero||2==this.userSetting.EnableBatch||this.validateItemQuantity(r,l)){if(this.isQtyZero=!0,(this.trnMain.VoucherType===t.Km.TaxInvoice||"abbreviated-sales-invoice"==this.activeurlpath||"performa-invoice"==this.activeurlpath||this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType===t.Km.Quotation)&&1==this.userSetting.EnablePartyWiseTaxableBill&&"EDIT"===this.trnMain.Mode&&this._trnMainService.vatFreeBill(),this.checkBCForMatrxiItem(),this.trnMain.VoucherType==t.Km.BatchAdjustment&&this._trnMainService.calculateBatchAdjustmentVariance(),(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==t.Km.Sales)&&this.getSchemeDiscountForItem(this._trnMainService.TrnMainObj.ProdList[r]),"EDIT"===this.trnMain.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let R=this.trnProd;if(c in t.SL&&(u=this.ValidateQuantityinEDITMode())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message);if(c in t.fr&&1!=this.indexedProd(r).NATURETYPE&&1==this.userSetting.EnableBatchWisePrice&&2!=this.userSetting.EnableBatch&&(0==this.userSetting.EnablePIReferenceInTransferOut||!this._trnMainService.TrnMainObj.REFBILL||!this._trnMainService.TrnMainObj.REFBILL?.startsWith("PI"))){if("EDIT"===this.trnProd.rowMode?.toUpperCase())if(!0!==this.trnProd.PriceSelected)this.checkBatchWiseRateinEditMode();else{var u;if((u=this.ValidateQtyEDITModeForOUt())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message)}else if((u=this.ValidateQtyEDITModeForOUt())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message);let F=this.checkItemStockINEditModeForOutQty();if(F&&!F.status)return void this.alertService.info(F.message)}if(this.trnMain.VoucherType===t.Km.ProductionEntry&&(console.log("active",R),"EDIT"===R.RowMode?.toUpperCase()&&R&&!this.ValidateQtyINEditModeFroProduction(R)))return}if((this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this.trnProd.ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this.trnProd.ALTERNATEQUANTIY=0);if(this.trnMain.VoucherType===t.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this.indexedProd(r).ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this.indexedProd(r).ITEMDESC} cannot have quantity more than one for membership sales invoice`),this.indexedProd(r).ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{null!==document.getElementById("rate"+r)&&document.getElementById("rate"+r).focus()},100)})),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote(),this.trnMain.VoucherType!==t.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this.trnProd.PSTOCK,this.trnProd.Quantity,this.activerowIndex,this.trnProd.ITEMDESC)){if(this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssueReturn){let R=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],F=0;if(this._trnMainService.TrnMainObj.ProdList.filter(le=>le.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).forEach(le=>F+=le.Quantity),!this._trnMainService.validateIssueQtyInStockIssueReturn(R.TotalReqQuantity,F,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(!(!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&this.trnProd.PTYPE<10&&(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.BatchAdjustment||this.trnMain.VoucherType===t.Km.StockIssueReturn||this.trnMain.VoucherType===t.Km.StockIssue&&"NEW"===this.trnMain?.Mode?.toUpperCase()||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this.trnMain.VoucherType===t.Km.BranchTransferOut&&7!=this.trnProd.NATURETYPE&&9!==this.trnProd.PTYPE))||(console.log("check entered product stock"),this.checkEnteredProductStock(l))){if(this.trnMain.VoucherType===t.Km.TaxInvoice&&this.trnProd.PTYPE<10&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this.trnMain.VoucherType===t.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&0!=this.userSetting.EnableStockCheckInSO&&this.trnProd.PTYPE<10&&7!=this.trnProd.NATURETYPE&&this.checkSaleableQuantityInSalesOrder(),this.trnMain.REFORDBILL&&this.trnMain.VoucherType===t.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&this.trnMain.REFORDBILL&&this.trnMain.REFORDBILL?.startsWith("SO")&&(this.trnMain.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)){if(this.trnMain.VoucherType==t.Km.GoodsReceived&&0==this.userSetting.AllowQtyExceedInPo&&7==this.indexedProd(r).NATURETYPE)return;let R=this.trnMain.ProdList.filter(F=>F.MENUCODE==this.indexedProd(r).MENUCODE).map(F=>F.ALTERNATEQUANTIY).reduce((F,le)=>F+le,0);if(R>this.indexedProd(r).POSTOCK&&!this._trnMainService.isPurchaseModule())return this.alertService.info("Quantity is more than SO Stock!!"),this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).POSTOCK,this.focusAltQty(r),void this._trnMainService.ReCalculateBillWithNormal();if(R>this.indexedProd(r).POSTOCK&&this._trnMainService.isPurchaseModule()){let F="Quantity is more than PO Stock!! Are you sure you want to proceed further";if((this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)&&(F="Quantity is more than SO Stock!! Are you sure you want to proceed further"),!confirm(F))return this.indexedProd(r).ALTERNATEQUANTIY=0,this.focusAltQty(r),void this._trnMainService.ReCalculateBillWithNormal()}}if(this.trnMain.VoucherType===t.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this.trnMain.VoucherType===t.Km.OpeningStockBalance&&"EDIT"===this.trnMain.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.StockIssueReturn)&&9!==this.trnProd.PTYPE&&this.trnProd.PTYPE<10&&this.checkBatchWiseStockOut(r),this.trnMain.VoucherType===t.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!==this.trnMain.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)&&null!=this.trnMain.REFORDBILL&&""!=this.trnMain.REFORDBILL||this.trnMain.VoucherType===t.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"===this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),c in t.po){let R=this.trnProd.MCODE,F=this.trnProd.RATE,le=this.trnProd.HASVARIANT,Se=this.trnProd.BC,Re=this.trnProd.ISUNKNOWN;const xe=this.trnProd.BATCH,ye=this.trnProd.REQEXPDATE,ji=this.trnProd.EXPDATE;!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&this.trnMain.REFORDBILL&&this.trnMain.VoucherType===t.Km.SalesOrder&&this.trnProd.PTYPE<10&&this.checkItemTotalQtyWithStock(R,Se,le,F,this.activerowIndex),"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE&&1!=this.indexedProd(r).NATURETYPE&&(xe||this.valiadateDuplicateRateItem(le,R,F,Re,this.activerowIndex,ye,ji))}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(this.checkBatchWiseEnterStock(r)?document.getElementById("ALTRATE"+this.activerowIndex)?.focus():this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n        ${this.trnProd.UNIT}, Item : ${this.trnProd.ITEMDESC} \n        @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `)),"production-entry"==this.activeurlpath){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.info("Please Select Production Item!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT)return void this.alertService.info("Please Select Item UNIT!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.info("Please Enter Valid Quantity!");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.info("Please Select Consumption WareHouse!!");if(this.userSetting.LinkProductionwithconsumption)return 1==this.userSetting.EnableBomBaseConsumption?void this.emitShowPopup.emit():void this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])}return this.trnMain.VoucherType!=t.Km.BranchTransferOut||1!=this._trnMainService.fromRequistionToTransferOut||this.validationService.validateRequestQtyDoingTransferOut(this.indexedProd(r),this.trnMain.ProdList)?(this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut&&(2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch)&&this.checkValidation(r),!0):void(this.indexedProd(r).ALTERNATEQUANTIY=0)}}}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this.trnProd.MCODE,QUANTITY:this.trnProd.Quantity,RATE:this.trnProd.RATE,AMOUNT:this.trnProd.AMOUNT,UNIT:this.trnProd.UNIT,CUSTID:this.trnMain.PARAC,PRICEMODE:this.trnMain.PRICEMODE})}ratechangeEvent(r){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(r){this._trnMainService.calculateNetRATE(r),this.indexedProd(r).INDDISCOUNT=0,this.indexedProd(r).INDDISCOUNTRATE<0?this.indexedProd(r).INDDISCOUNTRATE=0:this.indexedProd(r).INDDISCOUNTRATE>100&&(this.indexedProd(r).INDDISCOUNTRATE=100),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountRateChange(r,l){return console.log("change disocunt entered generic",r,l),r>100?(this.alertService.info("Discount rate cannot be greater than 100%"),void(this.indexedProd(l).INDDISCOUNTRATE=0)):r<0?(this.alertService.info("Discount rate cannot be less than 0%"),void(this.indexedProd(l).INDDISCOUNTRATE=0)):void 0}IndDiscountAmountChangeEvent(r,l){if(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales){let c=100*this.trnProd.INDDISCOUNT/this._trnMainService.nullToZeroConverter(this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE),u=this.masterService.userProfile.roleRights.find(R=>"DISLIMIT"==R.right);console.log("dis rate",c,"dislimit",u),u&&c>u?.value&&(this.alertService.warning("Discount limit of :"+u.value+"% exceeded, with given discount amount : "+this.indexedProd(r).INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if((this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&(this.indexedProd(r).UNIT==this.indexedProd(r).BASEUNIT?(this.indexedProd(r).NETRATE=this.indexedProd(r).RATE+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ECSAMOUNT)/this.indexedProd(r).Quantity-this._trnMainService.nullToZeroConverter(this.indexedProd(r).INDDISCOUNT),this.indexedProd(r).CRATE=this.indexedProd(r).NETRATE):(this.indexedProd(r).NETRATE=this.indexedProd(r).RATE+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ECSAMOUNT)/this.indexedProd(r).Quantity-this._trnMainService.nullToZeroConverter(this.indexedProd(r).INDDISCOUNT/this.indexedProd(r).Quantity),this.indexedProd(r).CRATE=this.indexedProd(r).NETRATE)),this.trnMain.VoucherType===t.Km.SalesOrder){let c=100*this.trnProd.INDDISCOUNT/this._trnMainService.nullToZeroConverter(this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE),u=this.masterService.userProfile.userRights.find(R=>"DISLIMIT"==R.right);console.log(" so dis rate",c,"dislimit",u),u&&c>u?.value&&(this.alertService.warning("Discount limit of :"+u.value+"% exceeded, with given discount amount : "+this.indexedProd(r).INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDDISCOUNT<0?this.indexedProd(r).INDDISCOUNT=0:this.indexedProd(r).INDDISCOUNT>this.indexedProd(r).AMOUNT&&(this.indexedProd(r).INDDISCOUNT=this.indexedProd(r).AMOUNT),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountAmountChangeOfRetailerVATINCEvent(r,l){this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(l.target.value),this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT<0?this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=0:this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT>this.indexedProd(r).AMOUNT&&(this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=this.indexedProd(r).AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}QuantityEventClick(r){return this._trnMainService.nullToZeroConverter(this.indexedProd(r).Quantity)<1||(this.activerowIndex=r,this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.PurchaseOrder||this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.StockSettlement||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.GoodsReceived?document.getElementById("alternateunit"+r).focus():(this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.CreditNote)&&document.getElementById("remarks"+r).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(r){return{status:"error",error:r}}}isTableRowSelected(r){return this.activerowIndex===r}deleteRow(r){if("stock-adjustment"!=this._trnMainService.activeurlpath&&"VIEW"!=this.trnMain?.Mode?.toUpperCase()){if("EDIT"==this.trnMain?.Mode?.toUpperCase()&&(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType==t.Km.OpeningStockBalance||this.trnMain.VoucherType==t.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this.trnMain.VoucherType))return;if((this.trnMain.VoucherType==t.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this.trnMain.VoucherType==t.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this.trnProd.rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this.trnProd.ITEMDESC}`),(this.trnMain.VoucherType==t.Km.OpeningStockBalance||this.trnMain.VoucherType==t.Km.Purchase)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).TOTALOUTWARDSTOCK)>0&&"EDIT"===this.trnProd.rowMode?.toUpperCase())return void this.alertService.info(`Transaction has been completed for this item::${this.trnProd.ITEMDESC}, cannot delete.`)}if(this.trnMain.VoucherType!=t.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")){if(this.activerowIndex=this.rowIndex=r,null==this.trnProd.MCODE&&1==this.trnMain.ProdList.length)this.trnMain.ProdList.splice(this.activerowIndex,0);else{let l=this.trnMain.ProdList[this.activerowIndex],c={activeRow:l,deleteIndex:this.activerowIndex};this.userSetting.LinkProductionwithconsumption&&this.trnMain.VoucherType==t.Km.ProductionEntry&&(this.trnMain.ConsumptionProdList=this.trnMain.ConsumptionProdList.filter(u=>u.MasterMCode!==l.MCODE),this.activeRowEmit.emit(c)),this.trnMain.ProdList.splice(this.activerowIndex,1)}0===this.trnMain.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck=""}}}editRow(r){this._trnMainService.TrnMainObj.BILLTO?this._trnMainService.TrnMainObj.ProdList[r].MCODE?this._trnMainService.TrnMainObj.BILLTOADD?1==this.userSetting.EnableBomBaseConsumption?this.emitShowPopup.emit():this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[r]):this.alertService.info("Please Select Consumption WareHouse!!"):this.alertService.info("Please Select Production Item!"):this.alertService.info("Please Select Production WareHouse!!")}restrictPercentageNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this.indexedProd(l).INDDISCOUNTRATE=0:(parseFloat(r)>100||isNaN(parseFloat(r)))&&(this.indexedProd(l).INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this.indexedProd(l).INDDISCOUNT=0:parseFloat(r)>this.indexedProd(l).AMOUNT&&(this.indexedProd(l).INDDISCOUNT=this.indexedProd(l).AMOUNT)}catch{}}SelectUnit(r,l,c){this.indexedProd(r).DiscountOnAltUnit=!1,this.indexedProd(r).ALTERNATEQUANTIY=0,this.indexedProd(r).CRATE=0;let u=this.indexedProd(r).Product.AlternateUnits.find(R=>R.ALTUNIT==this.indexedProd(r).ALTUNIT);this.indexedProd(r).StopDecimal=u.StopDecimal,1==this.userSetting.EnableAltUnitDiscOnRate&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==t.Km.Sales)&&0==this.userSetting.EnableBatchWisePrice&&this.assignRate(u,r),this.indexedProd(r).ALTUNIT==this.indexedProd(r).BASEUNIT?(this.trnMain.VoucherType!==t.Km.SalesOrder||1!=this.trnMain.AdditionalObj.LoadWholeSaleRate&&1!=this.userSetting.ENABLE_WSRATE_INSORDER||(this.indexedProd(r).RATE=this.indexedProd(r).WRATE),this.indexedProd(r).ALTRATE=this.indexedProd(r).RATE,this.indexedProd(r).ALTCONFACTOR=1,this.indexedProd(r).UNITDISCOUNTRATE=0,this.trnMain.VoucherType!=t.Km.CreditNote&&(this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDDISCOUNT=0)):(this.indexedProd(r).ALTCONFACTOR=u.CONFACTOR,this.trnMain.VoucherType===t.Km.SalesOrder&&(1==this.trnMain.AdditionalObj.LoadWholeSaleRate||1==this.userSetting.ENABLE_WSRATE_INSORDER)&&(this.indexedProd(r).RATE=this.indexedProd(r).WRATE),this.indexedProd(r).ALTRATE=this.indexedProd(r).RATE*this.indexedProd(r).ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this.indexedProd(r).WSRATE_DISCOUNT>0&&(this.indexedProd(r).ALTRATE=this.indexedProd(r).ALTRATE-this.indexedProd(r).ALTRATE*(this.indexedProd(r).WSRATE_DISCOUNT/100),this.indexedProd(r).RATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR),this.trnMain.VoucherType===t.Km.SalesOrder&&this.applyDiscountOnUnitChange(u,r),(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.DeliveryChalan||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice||this.trnMain.VoucherType===t.Km.Quotation)&&this.applyDiscountOnUnitChangeOnSales(u,r),this._trnMainService.ReCalculateBillWithNormal()),this.trnMain.VoucherType===t.Km.RequisitionApproval&&(console.log("something here",this.indexedProd(r)),this.indexedProd(r).ALTUNIT!=this.indexedProd(r).BASEUNIT?this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).REQUESTTOTALQTY/this.indexedProd(r).ALTCONFACTOR:this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).REQUESTTOTALQTY,this.approvedQtyEnter(r),this._trnMainService.CalculateApprovalBill())}assignRate(r,l){let c=this.indexedProd(l).BASERATE;this.indexedProd(l).RATE=c,this.indexedProd(l).ALTRATE=c*r.CONFACTOR}applyDiscountOnUnitChange(r,l){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)if(1==this.userSetting.EnableAltUnitDiscOnRate){console.log("unit1");let c="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT;this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100),this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE}else 1==this.userSetting.EnableDiscountInAltUnit&&(this.indexedProd(l).UNITDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT);else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let c=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?r.SRATE_DISCOUNT:r.WSRATE_DISCOUNT);this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100)}}applyDiscountOnUnitChangeOnSales(r,l){if(1==this.userSetting.EnableAltUnitDiscOnRate){console.log("unit2");let c="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT;this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100),this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE}else 1==this.userSetting.EnableDiscountInAltUnit&&(this.indexedProd(l).INDDISCOUNTRATE="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT)}returnMultiBatchScheme(r){for(let l of r)this._trnMainService.assignBatchToActiveProdRow(l,this.activerowIndex)}flatDisChange(r){this.flatDiscountValue=r,this.flatDiscountAssign()}flatDiscountUnitChange(r){this.radioFlatDiscount=r,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this.trnMain.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let r=this.trnMain.ProdList.reduce((l,c)=>l+(this._trnMainService.nullToZeroConverter(c.AMOUNT)-this._trnMainService.nullToZeroConverter(c.INDDISCOUNT)),0);this.trnMain.TOTALFLATDISCOUNT=this.flatDiscountValue*r/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(r,l){this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l)}RemarksEnterCommand(r,l){if(r.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l),this.trnMain.VoucherType==t.Km.RequisitionApproval){let c=l+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+c)&&document.getElementById("alternateunit"+c).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let l="";l=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this.trnProd.MCODE}&VCHRNO=${this.trnMain.VCHRNO}&warehouse=${l}`).subscribe(c=>{if("ok"===c.status&&(this.batchlist=c.result,1===this.trnProd.REQEXPDATE&&!this.trnProd.BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===c.message&&(this.changeBatchWiseRate(c.result[0].RATE),this.trnProd.STOCK=c.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(c.result),this.trnProd.PRATE=c.result[0].costprice),"SHOWPRICEPOPUP"===c.message&&(this.masterService.PlistTitle="Batch Price Selection",this.trnProd.HasMulitplePrice=1,this.trnMain.VoucherType===t.Km.Repack&&this.changeBatchWiseRate(c.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this.trnMain.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this.trnMain.Mode?.toUpperCase()){var u=this.ValidateQtyEDITModeForOUt();if(u&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message)}})}dblClickPricePopUP(r){let l=this._trnMainService.mulitplePriceItemList.filter(xe=>this._trnMainService.nullToZeroConverter(xe.qty)>0),c=this.trnProd.UNIT,u=this.trnProd.BASEUNIT,R=this.trnProd.MCODE,F=this.trnProd.MENUCODE,le=this.trnProd.ITEMDESC,Se=this.trnProd.Product.AlternateUnits,Re=this.trnProd.ALTCONFACTOR;if(this.trnMain.ProdList=this.trnMain.ProdList.filter(xe=>0!=this._trnMainService.nullToZeroConverter(xe.ALTERNATEQUANTIY)),null!=l)for(let xe=0;xe<l.length;xe++){let ye={Product:{}};ye.MCODE=R,ye.MENUCODE=F,ye.INDDISCOUNT=l[xe].dcamount,ye.INDDISCOUNTRATE=l[xe].dcrate,ye.ITEMDESC=le,ye.UNIT=c,ye.BASEUNIT=u,ye.RATE=l[xe].rate,ye.ALTRATE=l[xe].rate,ye.ALTERNATEQUANTIY=l[xe].qty,ye.inputMode=!0,ye.CRATE=l[xe].netrate,ye.ALTCONFACTOR=Re,ye.Product.AlternateUnits=Se,this.trnMain.ProdList.push(ye)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(r){console.log("dblclickpar"),null!=r&&(this.trnMain.VoucherType===t.Km.OpeningStockBalance?(this.trnProd.TRNAC=r.ACID,this.trnProd.ACNAME=r.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this.trnMain.PARAC=r.ACID,this.trnMain.BILLTO=r.ACNAME,this.trnMain.BILLTOADD=r.ADDRESS,this.trnMain.BILLTOTEL=r.VATNO,this.trnMain.BILLTOMOB=r.MOBILE,null==this.trnMain.AdditionalObj&&(this.trnMain.AdditionalObj={}),this.trnMain.AdditionalObj.TRNTYPE=r.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this.trnMain.VoucherType===t.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}SupplierEnterClicked(r){return r.preventDefault(),document.getElementById("supplier"+this.activerowIndex).blur(),this.genericGridSupplierPopup.show(),!1}onKeydownPreventEdit(r){"Enter"===r.key||"Tab"===r.key||r.preventDefault()}batchKeyDownEvent(){return!1}newMFGDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("newexpiry"+this.activerowIndex).focus(),!1}newExpDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("remarks"+this.activerowIndex).focus(),!1}MFGDateEnterEvent(r){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(r){return this.trnMain.VoucherType==t.Km.ProductionEntry&&"EDIT"==this.trnMain.Mode||this.checkValidation(r)||this.masterService.focusAnyControl("remarks"+r),!1}AlternateUnitEnterEventClick(r,l){l.preventDefault(),this.activerowIndex=r,null!=this.indexedProd(r).ALTUNIT&&""!=this.indexedProd(r).ALTUNIT&&void 0!==this.indexedProd(r).ALTUNIT&&(this.focusAltQty(r),this.trnMain.VoucherType==t.Km.RequisitionApproval&&document.getElementById("approvedQty"+r).focus(),this.trnMain.VoucherType==t.Km.Stockadjustment&&document.getElementById("physicalStock"+r).focus()),this.trnMain.VoucherType==t.Km.TaxInvoice&&1==this.trnProd.NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this.indexedProd(r).BC&&""!=this.indexedProd(r).BC&&void 0!==this.indexedProd(r).BC&&document.getElementById("rate"+r).focus(),74==this.trnMain.VoucherType&&null!=this.indexedProd(r).ALTUNIT&&""!=this.indexedProd(r).ALTUNIT&&null!=this.indexedProd(r).ALTUNIT&&document.getElementById("alternaetqty"+r).focus(),this.trnMain.VoucherType==t.Km.TaxInvoice&&this.trnMain.REFORDBILL&&this.focusAltQty(r)}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discountAmt"+this.activerowIndex).focus(),!1}mrpEnterEvent(r,l){if(this.activerowIndex=l,this.trnMain.VoucherType===t.Km.ProductionEntry&&this.validateProductionRate(r,l)||this.blockMoveToNextrow())return;let c=this.indexedProd(l).PTYPE;if(this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&1!=c&&this.trnMain.ProdList&&this.trnMain.ProdList.length&&0==this.indexedProd(l).ALTUNITObj.RATE_A&&0==this.indexedProd(l).MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(r,l),this.trnMain.VoucherType===t.Km.OpeningStockBalance)null!=document.getElementById("MRP"+l)?document.getElementById("MRP"+l).focus():0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus();else if(this.trnMain.VoucherType===t.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(l);else if(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales||57==this.trnMain.VoucherType)"Non-Discountable"!=this.trnProd.DISMODE&&(this.trnMain.VoucherType===t.Km.TaxInvoice&&0==this.trnProd.ECSRATE&&1==this.trnProd.HASECSCHARGE?document.getElementById("ECSAmount"+this.activerowIndex).focus():null!=document.getElementById("discountAmt"+this.activerowIndex)||this.trnMain.VoucherType===t.Km.TaxInvoice&&null!=document.getElementById("discountAmt"+this.activerowIndex)&&1!=this.userSetting.EnableBatchWisePrice?document.getElementById("discountAmt"+this.activerowIndex).focus():document.getElementById("mfgdate"+this.activerowIndex).focus());else if(this.trnMain.VoucherType===t.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this.trnMain.VoucherType===t.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(l)}else this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===t.Km.StockSettlement||this.trnMain.VoucherType===t.Km.BranchTransferIn||this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.Repack?this.checkValidation(l):this.trnMain.VoucherType===t.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(l)):null!=document.getElementById("discountAmt"+this.activerowIndex)?document.getElementById("discountAmt"+this.activerowIndex).focus():null!=document.getElementById("remarks"+this.activerowIndex)?document.getElementById("remarks"+this.activerowIndex).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+this.activerowIndex).focus());(this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.Repack||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType===t.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(l),1==this.userSetting.EnableBatch&&this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote();let u={isFocusAchieved:!1};return this.focusService.autoFocus(l,document.getElementById("rate"+l),u,"productinserttable"),u.isFocusAchieved||this.checkValidation(l),!1}blockMoveToNextrow(){return("EDIT"==this.trnMain.Mode||1==this.trnMain.DOFULLRETURN)&&"RQ"==this.trnMain.REFBILL?.substring(0,2)&&1==this.userSetting.EnableRequisitionPopup}setItemPopupUrl(){this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this.trnMain,this._trnMainService.activeurlpath),this.gridPopupSettingsForSupplier=this.productHelperService.getGridPopUpSettingForSupplier()}assignValueForReturnModeInProd(r){this.trnMain.VoucherType===t.Km.DebitNote?(this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.RATE):this.trnProd.PRATE=r.PRATE,this.trnProd.REALRATE=this.trnProd.ALTRATE=this.trnProd.RATE=r.RATE,this.trnProd.SPRICE=r.SPRICE,this.trnProd.BATCH=r.BATCH,this.trnProd.MFGDATE=null==r.MFGDATE?"":r.MFGDATE.toString().substring(0,10),this.trnProd.EXPDATE=null==r.EXPDATE?"":r.EXPDATE.toString().substring(0,10),this.trnProd.UNIT=r.UNIT,this.trnProd.STOCK=r.STOCK,this.trnProd.Quantity=r.STOCK,this.trnProd.WAREHOUSE=r.WAREHOUSE,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,this.trnProd.INDDISCOUNT=r.INDDISCOUNT,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,this.trnProd.PrimaryDiscount=r.PrimaryDiscount,this.trnProd.SecondaryDiscount=r.SecondaryDiscount,this.trnProd.LiquiditionDiscount=r.LiquiditionDiscount,this.trnProd.BASEUNIT=r.BASEUNIT,null==this.trnProd.Product&&(this.trnProd.Product={}),this.trnProd.Product.MCODE=r.MCODE,this.trnProd.CONFACTOR=1,this.trnProd.ALTUNIT=r.UNIT,this.trnProd.UNIT=r.UNIT,this.trnProd.BASEQUANTITY=r.Quantity,this.trnProd.ProductDetails=[],this.trnProd.ALTERNATEUNIT=this.trnProd.ALTUNIT,this.trnProd.ALTCONFACTOR=r.ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(r){this.activerowIndex=r,this.batchlist=[]}validateRate(r,l){if(this.trnMain.VoucherType===t.Km.ProductionEntry)return this.validateProductionRate(r,l);if(0==this._trnMainService.nullToZeroConverter(r.ALTRATE))return this.alertService.warning("Zero Rate Entry Detected For Item '"+r.ITEMDESC+"'. Please Enter Valid Rate."),!1;const c=this.getSellingRate();if(this.changeRateBelowCRateRight=this.masterService.userProfile.userRights.find(u=>"AllowSalesBelowCRate"==u.right)?.value,this._trnMainService.nullToZeroConverter(c)<this._trnMainService.nullToZeroConverter(r.PRATE)&&0==this.changeRateBelowCRateRight)return this.alertService.info("User "+this.userProfile.username+" doesn't have right to enter less rate for item '"+r.ITEMDESC+"'."),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=0,!1;if(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation){let u=this.getSellingRate();this.validateSellingPriceBelowLandingCost(u,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE,this.activerowIndex)}}validateProductionRate(r,l){return!(0!=this._trnMainService.nullToZeroConverter(r.ALTRATE)||!r.MCODE||(this.alertService.info("Cannot add 0 rate in production entry for item "+r.ITEMDESC),document.getElementById("rate"+l).focus(),0))}getSellingRate(){const r=0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR)?1:this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR);let l=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE)/r;return 1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation)&&(l=1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate),l}validateSellingPriceBelowLandingCost(r,l,c){if(r<l)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(u=>{setTimeout(()=>{null!==document.getElementById("discount"+c)?document.getElementById("discount"+c).focus():document.getElementById("remarks"+c).focus()},0)}),!1}MRPChangeEvent(r,l){let c=this.indexedProd(l).PTYPE;if("goods-received-note"==this.activeurlpath&&"NEW"==this.trnMain.Mode){let u=this.masterService.userProfile.roleRights.find(R=>"ALLOWRATECHANGEINPI"==R.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==u.value&&(this.indexedProd(l).TEMP_ALTRATE==this.indexedProd(l).ALTRATE||confirm("PRATE DIDN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this.indexedProd(l).ALTRATE=this.indexedProd(l).TEMP_ALTRATE))}this.validateRate(r,l),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&0==this.userSetting.EnableBatchWisePrice&&this.validateRateForSalesInvoiceOnEnter(),this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&1!=c&&(console.log("rnk1"),this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this.trnMain.VoucherType===t.Km.OpeningStockBalance&&this.validateCostPrice(),this.indexedProd(l).UNIT==this.indexedProd(l).BASEUNIT?this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE:0!=this._trnMainService.nullToZeroConverter(this.indexedProd(l).ALTRATE)&&(this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE/this._trnMainService.nullToZeroConverter(this.indexedProd(l).ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this.trnMain.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this.trnProd.SELLRATEBEFORETAX=this.trnProd.RATE,this.trnProd.MRP=this.trnProd.RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this.trnMain.VoucherType===t.Km.SalesOrder&&this.trnMain.REFORDBILL&&this.checkRateisChangedinSoFromQT()}validateRateForSalesInvoiceOnEnter(){this.validateSellingPriceBelowLandingCost(this.trnProd.ALTRATE,this.trnProd.PRATE,this.activerowIndex)}checkRateisChangedinSoFromQT(){this.trnProd.ALTRATE!==this.trnProd.PORATE&&(confirm("Rate is change Do you want to proceed .")||(this.trnProd.ALTRATE=this.trnProd.PORATE))}AlternateQuantityEventClick(r,l){if(l.preventDefault(),this.QuantityChangeEvent(r,l)&&0!=this.trnProd.Quantity&&"QuantityExceed"!=this._trnMainService.quantityExceedCheck){if(this.trnMain.VoucherType===t.Km.OpeningStockBalance&&"EDIT"===this.trnMain.Mode&&setTimeout(()=>{document.getElementById("rate"+r).focus()},20),(this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.SalesReturn)&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DONONSALEABLERETURN){var c,u=this.indexedProd(r).MCODE;if(c=this._trnMainService.ReturnStockReconcile(u),this.indexedProd(r).STOCK<c)return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity")}if((this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.BranchTransferOut||this.trnMain.VoucherType===t.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL>0){const R=this._trnMainService.TrnMainObj.ProdList[r].TOTSTOCK-this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[r].MCODE);if(R<this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL)return this.alertService.warning(`Stock Qty Goes Below Minimum Stock Level. (Min Stock : ${this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL} | Stock Qty : ${R})`),void(1==this._trnMainService.TrnMainObj.ProdList[r]?.MINWARN&&(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0))}if(this.trnMain.VoucherType==t.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this.trnProd.PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show()),this.trnProd.BC||1===this.trnProd.HASVARIANT&&(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType==t.Km.OpeningStockBalance||this.trnMain.VoucherType==t.Km.ProductionEntry||this.trnMain.VoucherType==t.Km.RequisitionEntry||this.trnMain.VoucherType==t.Km.Quotation||this.trnMain.VoucherType==t.Km.PurchaseOrder||this.trnMain.VoucherType==t.Km.SalesOrder)&&(this.alertService.info("Please select variants first!"),this.trnProd.ALTERNATEQUANTIY=0,this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this.trnProd.Mcat}&mcode=${this.trnProd.MCODE}`).subscribe(R=>{"ok"==R.status&&R.result&&R.result.length&&this.alertService.emitShowHideSubject.subscribe(F=>{setTimeout(()=>{this.matrixItemAtrribute=R.result,this.matrixitemgrid.show()})})})),1===this.userSetting.EnableTelcomDevices&&1===this.trnProd.NATURETYPE&&(this.trnProd.visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this.trnMain.Mode?.toUpperCase()&&(this.trnProd.ProductDetails=[]),(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.TaxInvoice&&(0,J.isNullOrUndefined)(this.trnProd.BARCODE)||this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.Quotation||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice||this.trnMain.VoucherType===t.Km.BranchTransferOut)&&(1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote)?(null==this._trnMainService.TrnMainObj.ProdList[r].BC||""==this._trnMainService.TrnMainObj.ProdList[r].BC||null==this._trnMainService.TrnMainObj.ProdList[r].BC)&&this.dialougeOpen():this.dialougeOpen())),(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&this.checkMaxStockLevel(r),this.indexedProd(r).PTYPE<10&&(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType==t.Km.StockIssue||this.trnMain.VoucherType===t.Km.BranchTransferOut)&&this.checkReorderStocklevel(r),(this.trnMain.VoucherType==t.Km.TaxInvoice||this.trnMain.VoucherType==t.Km.Sales)&&this.getSchemeDiscountForItem(this.indexedProd(r)),this.trnMain.VoucherType===t.Km.BranchTransferOut&&9!=this.trnProd.PTYPE&&(console.log("abc",this._trnMainService.allowNegativeBilling(this.activerowIndex)),this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock(l)),this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote&&(0==this.userSetting.ENABLEMANUALSALESRETURN||0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&this.checkValidation(r),"self-billing"===this.activeurlpath&&this.checkValidation(r),this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY>0&&this.focusToRate(r,l),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this.trnProd.HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this.trnMain.VoucherType==t.Km.BatchAdjustment&&1==this.trnMain.ADJUSTEXPIRY&&setTimeout(()=>{document.getElementById("newexpiry"+this.activerowIndex).focus()},20),this.trnMain.VoucherType==t.Km.BranchTransferOut&&1==this._trnMainService.fromRequistionToTransferOut&&!this.validationService.validateRequestQtyDoingTransferOut(this.indexedProd(r),this.trnMain.ProdList))return void(this.indexedProd(r).ALTERNATEQUANTIY=0);this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut&&(2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch)&&this.checkValidation(r)}}focusAfterQuantityClick(){if(this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag)document.getElementById("fcrate"+this.activerowIndex).focus();else if(this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag){if(0==this.userSetting.IMPORTPOBILLMODE)return void document.getElementById("fcrate"+this.activerowIndex).focus();document.getElementById("discountAmt"+this.activerowIndex).focus()}if(this.trnMain.VoucherType===t.Km.TaxInvoice&&"export-sales-invoice"==this.activeurlpath)document.getElementById("fcrate"+this.activerowIndex).focus();else if((this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived&&7!=this.trnProd.NATURETYPE)&&this.trnMain.REFORDBILL)document.getElementById("discountAmt"+this.activerowIndex).focus();else if(this.trnMain.VoucherType==t.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath)this.trnMain.VoucherType==t.Km.BatchAdjustment&&(1==this.trnMain.ADJUSTEXPIRY?(console.log("suru ma ya chircha ki nai hernu paryo",this.activerowIndex),setTimeout(()=>{document.getElementById("newmanufacture"+this.activerowIndex).focus()},20)):document.getElementById("adjustbatch"+this.activerowIndex).focus());else if(this.trnMain.VoucherType==t.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL)document.getElementById("discountAmt"+this.activerowIndex).focus();else if(console.log("fc1"),this.focusService.isFocusable(document.getElementById("rate"+this.activerowIndex)))document.getElementById("rate"+this.activerowIndex).focus();else{let r={isFocusAchieved:!1};this.focusService.autoFocus(this.activerowIndex,document.getElementById("alternateQty"+this.activerowIndex),r,"productinserttable"),console.log("fc",r),r.isFocusAchieved||this.checkValidation(this.activerowIndex)}}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let r=0;if(this.trnMain.ProdList.filter(c=>c.PMCODE==this.trnProd.PMCODE&&c.BATCH==this.trnProd.BATCH).forEach(c=>{r+=c.ROUTQTY}),console.log("total Enter qty",r,"stokc",this.trnProd.STOCK),r>this.trnProd.STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n      ${this.trnProd.PUNIT},\n      (-${this.indexedProd(this.activerowIndex-1).ROUTQTY}   ${this.trnProd.PUNIT} ) \n      Item : ${this.trnProd.ITEMDESC} \n      @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let r=0;if(this.trnMain.ProdList.filter(c=>c.MCODE==this.trnProd.MCODE&&c.BATCH==this.trnProd.BATCH).forEach(c=>{r+=c.ROUTQTY}),r>this.trnProd.STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n    Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n    ${this.trnProd.PUNIT},\n    (-${this.indexedProd(this.activerowIndex-1).ROUTQTY}   ${this.trnProd.PUNIT} ) \n    Item : ${this.trnProd.ITEMDESC} \n    @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let r=0;if(this.trnMain.ProdList.filter(l=>l.MCODE==this.trnProd.MCODE&&l.BATCH==this.trnProd.BATCH&&l.BC==this.trnProd.BC).forEach(l=>{r+=l.Quantity}),r>this.trnProd.TOTSTOCK&&9!=this.trnProd.PTYPE)return this.alertService.info(`Inserted Item ${this.trnProd.ITEMDESC} Quantity :\n  ${this._trnMainService.nullToZeroConverter(this.trnProd.Quantity)}  \n  Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this.trnProd.TOTSTOCK)} \n  ${this.trnProd.BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(r,l){if(l.preventDefault(),"production-entry"==this.activeurlpath&&this.userSetting.LinkProductionwithconsumption){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.info("Please Select Production Item!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT)return void this.alertService.info("Please Select Item UNIT!");if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.info("Please Enter Valid Quantity!");if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)return void this.alertService.info("Please Enter Expiry Date!!");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.info("Please Select Consumption WareHouse!!");this.userSetting.LinkProductionwithconsumption&&(1==this.userSetting.EnableBomBaseConsumption?this.emitShowPopup.emit():this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]))}if("production-entry"==this.activeurlpath&&0==this.userSetting.LinkProductionwithconsumption){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)return void this.alertService.info("Please Enter Expiry Date!!");setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},10)}0==this.indexedProd(r).ECSRATE&&1==this.indexedProd(r).HASECSCHARGE&&document.getElementById("ECSAmount"+this.activerowIndex).focus(),this.trnMain.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag?document.getElementById("fcrate"+r).focus():this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect&&7!==this.indexedProd(r).NATURETYPE?document.getElementById("discountAmt"+r).focus():this.trnMain.VoucherType===t.Km.TaxInvoice&&"self-billing"==this.activeurlpath?(console.log("dis"),document.getElementById("discountAmt"+r).focus()):this.salesRateDisabled.indexOf(this.trnMain.VoucherType)>=0?this.focusRateOrDiscount():document.getElementById("rate"+r).focus()}BaseQuantityEventClick(r,l){l.preventDefault(),this.activerowIndex=r,null!=document.getElementById("mrp"+r)?this.masterService.focusAnyControl("mrp"+r):this.masterService.focusAnyControl("remarks"+r),this.SelectUnit(r,"EACH",l.target.value)}checkBatchWiseStockOut(r){this.checkBatchWiseEnterStock(r)||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n      ${this.trnProd.BASEUNIT}, Item : ${this.trnProd.ITEMDESC} \n      @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `)}checkItemTotalQtyWithStock(r,l,c,u,R){let F=0;if(F=1==c?this.trnMain.ProdList.filter(le=>le.MCODE==r&&le.BC==l&&le.RATE==u).map(le=>le.Quantity).reduce((le,Se)=>le+Se,0):this.trnMain.ProdList.filter(le=>le.MCODE==r&&le.RATE==u).map(le=>le.Quantity).reduce((le,Se)=>le+Se,0),F>0)return F>this.trnProd.TOTSTOCK&&9!=this.trnProd.PTYPE?(this.alertService.info(`Item ${this.trnProd.ITEMDESC} Entered  Quantity: ${F}  exceed the available stock ${this.trnProd.TOTSTOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(r,l,c,u,R,F,le){let Se;if(0==r&&0==u&&(Se=this.trnMain.ProdList.filter(1==F?Re=>Re.MCODE==l&&Re.RATE==c&&Re.EXPDATE==le:Re=>Re.MCODE==l&&Re.RATE==c),Se&&Se?.length>1))return this.alertService.info(`${Se[0].ITEMDESC} Item with '${Se[0].RATE}' duplicate rate `),this.trnProd.ALTERNATEQUANTIY=0,void(this.isQtyZero=!1)}checkBatchWiseStock(){let r=[];this.masterService.getStockBatchWise(this.trnProd.MCODE).subscribe(l=>{"ok"==l.status&&(r=l.result,null!=r&&this.trnProd.Quantity>r[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(r){console.log("petrol pump fxn ",r.MRP,r.ISAMOUNTWISEBILL),(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==r.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(r.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}wareHouseWiseStock(r){this.warehouseWiseStockPopup.show(r.MCODE,this.activerowIndex)}assignWSRate(r){this.trnProd.RATE=r.WRATE,this.trnProd.ALTRATE=r.WRATE,this.trnProd.BASERATE=r.WRATE}dblClickPopupItem(r){this.showtooltip=!0;let c,l=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={},this._trnMainService.TrnMainObj.VoucherType!==t.Km.OpeningStockBalance||1!=this.userSetting.EnablePanBill||1!=r.ISVAT)if(this._trnMainService.TrnMainObj.VoucherType!==t.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.CreditNote||1!=this.userSetting.EnablePanBill||1!=r.ISVAT){if((this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.ExportSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales)&&this.userSetting.CompulsoryHSCodeInput){if(r&&!r.HSNCode)return void this.alertService.warning("HS Code is not registered!");this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HS_Code=r.HSNCode,console.log("HSNCode",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HS_Code)}if(this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry?void 0!==this._trnMainService.TrnMainObj.ProdList.find(F=>F.MENUCODE==r.MENUCODE)&&(c=!1):c=this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,r),0==c)return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(F=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(r),"add-sales-invoice"==this.activeurlpath&&1==this._trnMainService.showWareHouseWiseStockPopup&&this.wareHouseWiseStock(r),0!=this.ValidateDuplicateItemEntry(r)){if("add-sales-invoice-wholesale"===this.activeurlpath||this.trnMain.VoucherType==t.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate||this.trnMain.VoucherType==t.Km.SalesOrder&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate?this.assignWSRate(r):(this.trnMain.VoucherType!=t.Km.BranchTransferOut&&(this.trnProd.RATE=r.RATE,this.trnProd.BASERATE=r.RATE,this.trnProd.ALTRATE=r.RATE),this.trnMain.VoucherType==t.Km.BranchTransferOut&&1==r.NATURETYPE&&(this.trnProd.RATE=r.RATE,this.trnProd.BASERATE=r.RATE,this.trnProd.ALTRATE=r.PRATE)),this._trnMainService.NeedToTakePriceFromMenuItem()){let F=r.RATE;l in t.qK&&(l==t.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate&&(F=r.WRATE),this._trnMainService.assignProductMasterRate(this.activerowIndex,F)),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.WRATE),l in t.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.PRATE,r.CONFACTOR)}if(this.trnProd.PTYPE=r.PTYPE,this.trnProd.ECSRATE=r.ECSRATE,this.trnProd.HASECSCHARGE=r.HASECSCHARGE,this.trnProd.HASECSRATE=r.HASECSRATE,this.trnProd.NATURETYPE=r.NATURETYPE,this.trnProd.ENABLEITEMWISEBATCH=r.ENABLEITEMWISEBATCH,this.trnProd.HASBATCH=r.HASBATCH,6==this.trnProd.NATURETYPE&&this.trnMain.VoucherType!=t.Km.PurchaseOrder&&(this.trnProd.isQuantityReadonly=!0),this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TotalReqQuantity=r.TotalReqQuantity),("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"IS"==this._trnMainService.TrnMainObj.VoucherPrefix||"TO"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this.trnProd&&(this.trnProd.BC=r.BARCODE),6==this.trnProd.NATURETYPE&&""!=this.trnProd.BC&&null!=this.trnProd.BC&&null!=this.trnProd.BC&&(this.trnProd.isBarcodeOfPtypeSix=!0)),this.trnMain.VoucherType===t.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this.trnProd.SPRICE=r.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this.trnProd.VSRATE=r.In_Rate_B,this.trnProd.VPRATE=r.RATE_B)),1===this.trnProd.NATURETYPE&&this.trnMain.VoucherType===t.Km.CreditNote&&1==this.userSetting.EnableTelcomDevices){if(!this.validationService.validateDuplicateBarcode(r,this.trnMain.ProdList))return;this.trnProd.ProductDetails=[],this.trnProd.ALTERNATEQUANTIY=1,this.trnProd.BC=r.BC,this._trnMainService.addRow(),setTimeout(()=>{const F=document.getElementById("itemDesc"+(this.activerowIndex+1));F&&F.focus()},50)}if(this.focusAfterItemSelect(),this.focusService.afterEnterFocousItem(r.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this.trnProd){this.batchlist=[];let F=this.trnProd;F.REQEXPDATE=r.REQEXPDATE,F.DISMODE=r.DISMODE,F.PWEIGHT=r.GWEIGHT,F.PROMOTION=0,F.BATCHSCHEME=null,F.ALLSCHEME=null,F.ISVAT=r.ISVAT,F.MENUCODE=r.MENUCODE,F.ITEMDESC=r.DESCA,F.MCODE=r.MCODE,F.WEIGHT=r.GWEIGHT,F.Mcat=r.MCAT,F.BASEUNIT=r.BASEUNIT,F.SHELFLIFE=r.SHELFLIFE,F.Weighable=r.Weighable,F.MRP=r.MRP,F.ALTCONFACTOR=r.CONFACTOR,F.BARCODE=r.BARCODE,F.TOTSTOCK=r.STOCK,F.PSTOCK=r.PSTOCK,this.trnMain.VoucherType===t.Km.Repack&&(F.ALTUNIT=r.BASEUNIT,F.PDESCA=r.ParentName,F.PMCODE=r.SUPITEMCODE,F.CONFACTOR=r.CONFACTOR,F.PUNIT=r.PUNIT,F.REPACKRATE=r.PRATE,F.ALTRATE=r.PRATE),F.UNIT=r.BASEUNIT,F.WARRANTY=r.WARRANTY,F.W_MRP=r.W_MRP,F.W_SELLRATEBEFORETAX=r.W_SELLRATEBEFORETAX,F.STOCK=r.STOCK,F.WSRATE_DISCOUNT=r.WSRATE_DISCOUNT,F.MINLEVEL=r.MINLEVEL,F.MAXLEVEL=r.MAXLEVEL,F.ROLEVEL=r.ROLEVEL,F.ROWARN=r.ROWARN,F.MINWARN=r.MINWARN,F.HASVARIANT=r.HASVARIANT,F.Mcat=r.MCAT,F.REMARKS=r.REMARKS,F.PRATE=r.PRATE,F.ISRECURRING=r.ISRECURRING,F.HASCOMMISSIONCHARGE=r.HASCOMMISSIONCHARGE,F.ISAMOUNTWISEBILL=r.ISAMOUNTWISEBILL,F.ISUNKNOWN=r.ISUNKNOWN,F.RSTOCK=r.RSTOCK,1==r.HASVARIANT&&(F.BC=r.BC),r.VARIANTDETAIL&&(F.VARIANTLIST=JSON.parse(r?.VARIANTDETAIL),F.VARIANTDESCA="",F.VARIANTDESCA=this._trnMainService.getVariantDescriptionFromList(F)),1==this.trnProd.NATURETYPE&&!(0,J.isNullOrUndefined)(this.trnProd.BC)&&(this.trnProd.ALTERNATEQUANTIY=1),1==this.trnProd.NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this.trnProd.isItemDesReadonly=!0),this.trnMain.VoucherType===t.Km.OpeningStockBalance&&(this.trnProd.SUPCODE=r.SUPCODE,this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.CRATE),this.trnMain.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.CRATE),this.trnMain.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DOFULLRETURN&&this.trnMain.REFBILL&&(this.trnProd.LOYALTYRATE=this._trnMainService.nullToZeroConverter(r.LOYALTY/(r.STOCK*r.RATE)*100),r.RATEDISCOUNT>0&&(this.trnProd.UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE)),this.trnProd.PROMOTIONRATE=this._trnMainService.nullToZeroConverter(r.PROMOTION/(r.REALQTY*r.RATE)*100),this._trnMainService.vatFreeBill()),this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&(this.trnProd.INVRATE=r.INVRATE),this.trnMain.VoucherType===t.Km.SalesOrder&&(this.trnProd.RATE=r.RATE,this.trnProd.WRATE=r.WRATE,(1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate||1==this.userSetting.ENABLE_WSRATE_INSORDER)&&(this.trnProd.RATE=this.trnProd.WRATE,this.trnProd.ALTRATE=this.trnProd.UNIT===this.trnProd.BASEUNIT?this.trnProd.RATE:this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*this._trnMainService.nullToZeroConverter(this.trnProd.ALTCONFACTOR))),this.trnMain.VoucherType===t.Km.StockIssueReturn&&(this.trnProd.PSTOCK=r.ISSUEQTY,this.trnProd.EXPDATE=r.EXPDATE),this.trnMain.VoucherType in t.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this.trnMain.VoucherType===t.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this.trnMain.DOFULLRETURN)||this.trnMain.VoucherType==t.Km.BatchAdjustment)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this.trnMain.VoucherType==t.Km.BatchAdjustment&&this.FocusForBatchAdjustment(r.HASVARIANT),this.trnMain.VoucherType===t.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this.trnProd.ALTERNATEQUANTIY=1),1===this.userSetting.EnableWSRateGroup&&this.trnMain.VoucherType===t.Km.SalesOrder&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),1===this.userSetting.ENABLERATEGROUP&&!(this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO"))&&("abbreviated-sales-invoice"===this.activeurlpath||"add-sales-invoice"===this.activeurlpath||"add-sales-invoice-wholesale"===this.activeurlpath)&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),this._trnMainService.NeedToTakePriceFromMenuItem()||(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.StockSettlement||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)&&1===this.userSetting.EnableItemWiseBatch&&1===r.HASBATCH&&this.trnProd.PTYPE<10&&this.checkBatchWiseRate(),!(this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO"))&&0===this.userSetting.ENABLESINGLEBATCHMODE&&((this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice||(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales)&&1===this.userSetting.EnableExpiryTrackinginBilling&&1==this.trnProd.REQEXPDATE)&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate(),this._trnMainService.NeedToTakePriceFromMenuItem()||(this.trnMain.VoucherType===t.Km.StockIssueReturn||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.BranchTransferIn||this.trnMain.VoucherType===t.Km.BranchTransferOut&&1!=r.NATURETYPE||"consumption"===this.trnMain.AdditionalObj.RETURNTYPE||this.trnMain.VoucherType===t.Km.Repack||this.trnMain.VoucherType===t.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===t.Km.StockSettlement||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&r.PTYPE<10&&9!==r.PTYPE&&(this.trnMain.VoucherType===t.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL||!1===this.itemFromBC(r.HASVARIANT)&&this.checkBatchWiseRate())),(this.trnMain.VoucherType===t.Km.SalesOrder||this.trnMain.VoucherType==t.Km.Sales||this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.BranchTransferOut)&&0===this.userSetting.EnableBatchWisePrice&&1===r.HASVARIANT&&this.checkBatchWiseRateSettingZero(),1!=this.trnProd.NATURETYPE&&this.trnMain.VoucherType===t.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE),this.trnMain.VoucherType===t.Km.Purchase||"production-entry"===this.activeurlpath||this.trnMain.VoucherType==t.Km.BranchTransferOut&&(7==r.NATURETYPE||r.PTYPE>=10)||this.trnMain.VoucherType===t.Km.StockIssue||this.trnMain.VoucherType===t.Km.OpeningStockBalance||this.trnMain.VoucherType===t.Km.RequisitionEntry||this.trnMain.VoucherType===t.Km.GoodsReceived||"self-billing"===this.activeurlpath||this.trnMain.VoucherType===t.Km.PurchaseOrder?(this.trnProd.RATE=r.PRATE,this.trnProd.SELLRATEBEFORETAX=r.RATE,this.trnProd.ALTRATE=r.PRATE,this.trnProd.RECRATE=r.RECRATE,this.trnProd.POSTOCK=r.POSTOCK,this.trnProd.PREV_PRATE=r.PREV_PRATE):(this.trnMain.VoucherType===t.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this.trnMain.VoucherType===t.Km.StockIssue&&(this.trnProd.BATCH=r.BATCH,this.trnProd.isApproved=0),(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(r),0!==this.userSetting.ENABLE_SOINTI&&this.trnMain.REFORDBILL&&(this.trnMain.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(r),this.trnMain.VoucherType===t.Km.SalesOrder&&this.trnMain.REFORDBILL&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),this.emitReferenceQuantity(),1==this.userSetting.ENABLESINGLEBATCHMODE&&this.trnMain.VoucherType==t.Km.Repack&&this._trnMainService.getParentItemStock(this.activerowIndex),this.trnProd.BC||1===this.trnProd.HASVARIANT&&(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived||this.trnMain.VoucherType==t.Km.OpeningStockBalance||this.trnMain.VoucherType==t.Km.ProductionEntry||this.trnMain.VoucherType==t.Km.RequisitionEntry||this.trnMain.VoucherType==t.Km.Quotation||this.trnMain.VoucherType==t.Km.PurchaseOrder||this.trnMain.VoucherType==t.Km.SalesOrder)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this.trnProd.Mcat}&mcode=${this.trnProd.MCODE}`).subscribe(Se=>{"ok"==Se.status&&Se.result&&Se.result.length&&(this.matrixItemAtrribute=Se.result,this.matrixitemgrid.show())})}if(6===r.PTYPE&&this.trnMain.VoucherType===t.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex)),(this.trnMain.VoucherType==t.Km.TaxInvoice||this.trnMain.VoucherType==t.Km.Sales||this.trnMain.VoucherType==t.Km.PerformaSalesInvoice||this.trnMain.VoucherType==t.Km.SalesOrder||this.trnMain.VoucherType==t.Km.Quotation)&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1==this.userSetting.PRICEMODEINBILLING&&0==this.userSetting.EnableBatchWisePrice&&(this.trnMain.VoucherType===t.Km.PerformaSalesInvoice||this.trnMain.VoucherType===t.Km.Sales||this.trnMain.VoucherType===t.Km.TaxInvoice)&&this.assignWSRate(r),1==this.userSetting.LinkProductionwithconsumption&&"production-entry"==this.activeurlpath&&this.userSetting.Enableconsumtionbaseproductionrate&&(this.trnProd.ALTRATE=0,this.trnProd.PRATE=0,this.trnProd.RATE=0),this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry){if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=this._trnMainService.TrnMainObj.TRN_DATE,r.SHELFLIFE){let F=new Date(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE);F.setDate(F.getDate()+r.SHELFLIFE);let le=(0,C.p6)(F,"yyyy-MM-dd","en-US");this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=le}this.userSetting.EnableManualBatchinproduction?(setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},100),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])):(setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},100),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]))}setTimeout(()=>{console.log("sett",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])},200)}else this.alertService.warning("Cannot enter duplicate item!")}else this.alertService.warning("Vatable items cannot be billed under a PAN Bill. Please contact your administrator for assistance.");else this.alertService.warning("Vatable Items cannot be selected for opening stock entry. Please, contact your administrator for assistance.")}FocusForBatchAdjustment(r){1==r?setTimeout(()=>{document.getElementById("sourcebc"+this.activerowIndex).focus()},200):0==r&&setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).focus()},200)}emitReferenceQuantity(){(this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this.trnMain.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL||this.trnMain.VoucherType===t.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this.trnProd.POSTOCK,RATE:this.trnProd.ALTRATE,BASEUNIT:this.trnProd.BASEUNIT})}dialougeOpen(){this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.dialog.open($.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this.trnMain.VoucherPrefix,mode:this.trnMain.Mode,warehouse:this.trnMain.MWAREHOUSE,message:this.trnProd,curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this.trnMain.ProdList,TrnMainObj:this.trnMain}}).afterClosed().subscribe(c=>{this.productLists=this.trnMain.VoucherType===t.Km.TaxInvoice||this.trnMain.VoucherType===t.Km.CreditNote||this.trnMain.VoucherType===t.Km.Quotation||this.trnMain.VoucherType===t.Km.DebitNote||this.trnMain.VoucherType===t.Km.PerformaSalesInvoice?c?.data:c&&c.data&&c.data.productColorList?c.data.productColorList:[],"VIEW"==this.trnMain.Mode.toUpperCase()?(this.trnProd.ProductDetails=this.productLists.productColorList,this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.trnProd.ALTERNATEQUANTIY=this.productLists.productColorList?this.productLists.productColorList.length:0):(this.trnProd.ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.trnProd.ALTERNATEQUANTIY=this.productLists?this.productLists.length:0),this.trnMain.VoucherType===t.Km.BranchTransferOut&&this.calculateRateForTransferOut(c?.data),(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this.trnProd.ALTERNATEQUANTIY){if(this.trnMain.VoucherType==t.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this.trnProd.ITEMDESC} (${this.trnProd.MENUCODE}). Please Check Your Entry.`)}else console.log("hit here",this.trnMain.ProdList),this._trnMainService.ReCalculateBillWithNormal(),document.getElementById("rate"+this.activerowIndex).focus()},20)})}calculateRateForTransferOut(r){this.productLists=r,this.trnProd.ALTRATE=this.productLists[0].LANDINGCOST,this.trnProd.RATE=this.productLists[0].LANDINGCOST,this.trnProd.ALTERNATEQUANTIY=1,this.trnProd.BC=this.productLists[0].IEMI1,this.trnProd.AMOUNT=this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE;for(let l=1;l<this.productLists?.length;l++){let c=(0,_.cloneDeep)(this.trnProd);c.ALTRATE=this.productLists[l].LANDINGCOST,c.RATE=this.productLists[l].LANDINGCOST,c.ALTERNATEQUANTIY=1,c.BC=this.productLists[l].IEMI1,c.AMOUNT=c.ALTERNATEQUANTIY*c.ALTRATE,this.trnMain.ProdList.push(c)}}checkMaxStockLevel(r){0!==this._trnMainService.nullToZeroConverter(this.indexedProd(r).MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this.indexedProd(r).MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this.indexedProd(r).MAXLEVEL+" exceeded !")}checkReorderStocklevel(r){var l=this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)-this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY);if(l<this._trnMainService.nullToZeroConverter(this.indexedProd(r).ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).MINLEVEL))return;if(l<this._trnMainService.nullToZeroConverter(this.indexedProd(r).MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this.indexedProd(r).MINLEVEL),1===this.indexedProd(r).MINWARN&&(this.indexedProd(r).ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).ROLEVEL))return;1===this.indexedProd(r).ROWARN&&this.alertService.warning("Re-Order level "+this.indexedProd(r).ROLEVEL+" has been reached !")}}}CancelCommand(){this.showBarCodeDetail=!1,this.trnProd.visible=!1}loadBarCodeRow(r){let c={IEMI1:"",IEMI2:""};c.MCODE=0===this.activerowIndex?"":this.trnProd.MCODE,c.Color="",0===this.activerowIndex?(this.indexedProd(0).ProductDetails=[],this.indexedProd(0).ProductDetails.push(c)):this.trnProd.ProductDetails.push(c),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(r){let l={IEMI1:"",IEMI2:""};l.MCODE=this.trnProd.MCODE,l.Color="",this.trnProd.ProductDetails.push(l),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(r){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this.indexedProd(this.barcodeWiseProductIndex).BASEQUANTITY=this.indexedProd(this.barcodeWiseProductIndex).ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}onApplyOldPriceClick(){let r={};if(1==this.userSetting.EnableBatchWisePrice&&(r=this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.CRATE_A))[0],console.log("INVALID UOM",r),r))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${r.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let r of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this.trnProd.Product.AltSellingPrices.find(l=>l.UNIT==r.UNIT).NRATE_A=r.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let r={};return r=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(l=>null==l.NRATE_A||0==l.NRATE_A)[0],!r||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${r.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(r,l){let c=0,u=0,R=0,F=this._trnMainService.priceChangeList[r];if(null!=F){if(F.UNIT==this.trnProd.BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this.trnProd.ISVAT){let le=this._trnMainService.nullToZeroConverter(this.trnProd.RATE)+this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*this.userSetting.VATRate;F.NRATE_A<=le&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)&&(R=this._trnMainService.nullToZeroConverter(this.trnProd.RATE)+this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*(this.trnProd.RECRATE/100),F.NRATE_A<=R+R*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?(R=this.trnProd.RATE+this.trnProd.RATE*(this.trnProd.RECRATE/100),F.NRATE_A<=R&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):F.NRATE_A<this.trnProd.RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else c=this.trnProd.RATE,0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)&&(c=this.trnProd.RATE+this.trnProd.RATE*(this.trnProd.RECRATE/100)),F.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this.trnProd.ISVAT){let le=this.trnProd.ALTRATE;if(u=le+le*this.userSetting.VATRate,F.NRATE_A<=u&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)){let Se=le+le*(this.trnProd.RECRATE/100);F.NRATE_A<=Se+Se*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?F.NRATE_A<=this.trnProd.ALTRATE+this.trnProd.ALTRATE*(this.trnProd.RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):F.NRATE_A<this.trnProd.ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else c=this.trnProd.ALTRATE/this.trnProd.ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?F.NRATE_A<=c+c*(this.trnProd.RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):F.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(r),this.trnProd.SELLRATEBEFORETAX=1===this.trnProd.ISVAT?this._trnMainService.priceChangeList[r].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].NRATE_A,this.trnProd.W_SELLRATEBEFORETAX=1===this.trnProd.ISVAT?this._trnMainService.priceChangeList[r].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].WNRATE_A,this.trnProd.MRP=this._trnMainService.priceChangeList[r].NRATE_A,this.trnProd.W_MRP=this._trnMainService.priceChangeList[r].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this.trnMain.PODetailList[r].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].NRATE_A,this.trnMain.PODetailList[r].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].WNRATE_A)}changeSellingPrice(r){for(const l of this._trnMainService.priceChangeList)l.SNO>1&&(l.NRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].NRATE_A,l.WNRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].WNRATE_A)}checkDeuplicateCodeAndRate(){let r=[],l=this.trnMain.ProdList.filter(c=>c.MCODE==this.trnProd.MCODE);if(null!=l&&l.length>1){let c=0;for(let u of this.trnMain.ProdList)u.MCODE==this.trnProd.MCODE&&r.push(c),c++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableDiscount(){return this.trnMain.VoucherType!==t.Km.TaxInvoice&&this.trnMain.VoucherType!==t.Km.Sales&&57!=this.trnMain.VoucherType&&this.trnMain.VoucherType!=t.Km.CreditNote?(this.trnMain.VoucherType===t.Km.Purchase||this.trnMain.VoucherType===t.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this.trnMain.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this.trnMain.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this.trnMain?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkEnteredProductStock(r){let l=this.trnMain.ProdList.filter(c=>c.Quantity>c.STOCK&&7!=c.NATURETYPE&&c.PTYPE<10&&9!=c.PTYPE)[0];return null==l||(this.stopEnterPropagation(r),this.alertService.info(l.BASEUNIT!=l.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(l.STOCK)} ${l.BASEUNIT}, Item : ${l.ITEMDESC} @Qty = ${l.Quantity} ${l.BASEUNIT} (${l.ALTERNATEQUANTIY} x ${l.ALTCONFACTOR} = ${l.Quantity} ${l.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(l.STOCK)} ${l.BASEUNIT}, Item : ${l.ITEMDESC} @Qty = ${l.Quantity} ${l.BASEUNIT} `),this.trnProd.ALTERNATEQUANTIY=0,this.isQtyZero=!1,this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{this.focusAltQty()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1)}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(r){this.trnProd.BC=r.BARCODE,this.ItemBarCodeClick(this.activerowIndex,r)}validateCostPrice(){this.trnProd.ALTRATE>this.trnProd.SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling price")}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}ECSFocusOut(){this.applyPipeInECS=!0,this._trnMainService.ReCalculateBillWithNormal()}ECSValueChange(){this.trnProd.Quantity||(this.alertService.warning("Please Enter Product Quantity!!"),this.trnProd.ECSAMOUNT=0),this.trnProd.ECSAMOUNT>this.trnProd.GROSSAMNT&&(this.alertService.warning("ECS amount cannot be more than Gross Amount!!"),this.trnProd.ECSAMOUNT=0)}ECSFocusIn(){this.applyPipeInECS=!1}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(r,l){6!=this.indexedProd(r).PTYPE&&this.focusToRate(r,l)}ItemBarCodeFoucusOut(r,l){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(r,l){this.barcodeDisplay=!0}checkBatchWiseEnterStock(r){let l=0;return 1==this.userSetting.EnableVariantCategory&&1==this._trnMainService.TrnMainObj.ProdList[r].HASVARIANT?this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BC==this._trnMainService.TrnMainObj.ProdList[r].BC).forEach(c=>l+=c.Quantity):2==this._trnMainService.userSetting.EnableBatch?this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BATCH&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[r].BATCH&&c.PRATE==this._trnMainService.TrnMainObj.ProdList[r].PRATE).forEach(c=>l+=c.Quantity):this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BATCH&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[r].BATCH).forEach(c=>l+=c.Quantity),l>this._trnMainService.TrnMainObj.ProdList[r].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.trnProd.ALTERNATEQUANTIY=0,this.isQtyZero=!1,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(r){this.indexedProd(r).ALTRATE=this._trnMainService.nullToZeroConverter(this.indexedProd(r).INVRATE)*this._trnMainService.nullToZeroConverter(this.trnMain.EXRATE),this.indexedProd(r).REALRATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR,this.indexedProd(r).RATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(r){this.FCRATEChangeEvent(r),this.masterService.focusAnyControl("discountAmt"+r)}RecalculateMRP(){this.trnProd.SPRICE=1==this.trnProd.ISVAT?this.trnProd.MRP/1.13:this.trnProd.MRP}onTabMRP(r,l){r.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+l).focus()}RecalculateSPRICE(){this.trnProd.MRP=1==this.trnProd.ISVAT?1.13*this.trnProd.SPRICE:this.trnProd.SPRICE}onTabSPRICE(r,l){r.preventDefault(),null!=document.getElementById("VSRATE"+this.activerowIndex)?this.focusService.autoFocus(l,document.getElementById("SPRICE"+l),{}):0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}RecalculateVSRATE(){this.trnProd.VPRATE=(this.trnProd.ISVAT=1)?this.trnProd.VSRATE/1.13:this.trnProd.VSRATE}onTabVSRATE(r){r.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this.trnProd.VSRATE=1.13*this.trnProd.VPRATE}onTabVPRATE(r,l){r.preventDefault(),this.RecalculateSPRICE(),0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,this._trnMainService.showCreditSalesAuth?this._trnMainService.showCreditSalesAuth=!1:1==this.userSetting.ENABLESINGLEBATCHMODE&&(this.trnProd.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal())}OrderComment(r){this.trnMain.VoucherType===t.Km.RequisitionEntry&&this.masterService.focusAnyControl("remarks"+r)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm(),1==this._trnMainService.showCreditSalesAuth&&this._trnMainService.CreditSalesAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this.trnMain.VoucherType===t.Km.BranchTransferIn||this.trnMain.VoucherType===t.Km.StockIssue||1==this.masterService.disableQtyInStockIssueReturn||("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}focusAfterItemSelect(){2==this.userSetting.EnableBatch||this.trnMain.VoucherType==t.Km.BatchAdjustment?null!=document.getElementById("batch"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},20):(null!=document.getElementById("alternateunit"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),74===this.trnMain.VoucherType&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{this.focusAltQty()},20),this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20))}itemFromBC(r){return 1==r&&1==this.loadFromBarcode}checkBatchSelectionInMultiplePrice(){return 1!=this.trnProd.HasMulitplePrice||1!=this.userSetting.EnableBatchWisePrice||!!this.trnProd.PriceSelected}checkQuantityInPOdeliveryMode(){7==this.trnProd.NATURETYPE&&1==this.userSetting.AllowQtyExceedInPo||null!=this.trnMain.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0]&&(this.alertService.info(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `:`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} )\n        exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `),this.trnProd.ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{this.focusAltQty()})}))}checkQuantityInSOLoadFromQT(){if(null!=this.trnMain.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0])return this.alertService.info(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT}\nexceed the item wise QT Quantity  ${this.trnProd.POSTOCK}\n${this.trnProd.BASEUNIT}\n`:`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} )\n        exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `),this.trnProd.ALTERNATEQUANTIY=this.trnProd.POSTOCK,void this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{this.focusAltQty()})})}checkQuantityInSOLoadFromQTin(){if(null!=this.trnMain.ProdList.filter(l=>l.Quantity<l.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this.trnProd.ALTERNATEQUANTIY=0,void this.focusAltQty()}checkSaleableQuantityInSalesOrder(){let r=this.trnProd,l=r.ALTUNIT==r.BASEUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTCONFACTOR;this.masterService.getSaleableQTY(r.MCODE,this.trnMain.DIVISION,this.trnMain.PhiscalID,this.trnMain.TRNDATE,this.trnMain.MWAREHOUSE,this.trnMain.VCHRNO).subscribe(c=>{if("ok"==c.status){let u=c.result[0].SALEABLE_SQTY;if(l>u)return 2==this.userSetting.EnableStockCheckInSO?(this._trnMainService.checkForUserMinusStockAuthorization()&&this.alertService.info("Entered qty is greater than its saleable qty:"+u),this._trnMainService.checkForUserMinusStockAuthorization()||(this._trnMainService.showNegativeBilling=!0,setTimeout(()=>{document.getElementById("AuthUserName").focus()},100))):(r.ALTERNATEQUANTIY=0,this.alertService.info("Entered qty is greater than its saleable qty:"+u),this.trnProd.ALTERNATEQUANTIY=0),this._trnMainService.ReCalculateBillWithNormal(),void this.alertService.emitShowHideSubject.subscribe(R=>{setTimeout(()=>{this.focusAltQty()},0)})}},c=>{this.alertService.info(c)})}checkQuantityInEditMode(){let r=this.trnMain.ProdList.filter(l=>l.Quantity<l.OUTQTY)[0];null!=r?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${r.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(r){this.trnProd.RATE=this.trnMain.VoucherType===t.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.ALTRATE=this.trnMain.VoucherType===t.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.RECRATE=r.RECRATE,this.trnProd.PORATE=this.trnMain.VoucherType===t.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.POSTOCK=0!==this.userSetting.ENABLE_SOINTI&&(this.trnMain.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===t.Km.PerformaSalesInvoice)?r.OPSTOCK:r.POSTOCK,this.trnMain.VoucherType===t.Km.SalesOrder&&(this._trnMainService.purchaseOrderQty=this.trnProd.POSTOCK)}assignOrderedDiscount(r){this.trnProd.INDDISCOUNT=r.INDDISCOUNT,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,r.RATEDISCOUNT>0&&(this.trnProd.UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE))}clickOnNetAmount(r){this._trnMainService.nullToZeroConverter(this.trnProd.NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this.trnMain.VoucherType===t.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(r)}changeONNetAmount(r,l){this.indexedProd(r).NETAMOUNT=this._trnMainService.nullToZeroConverter(l.target.value),this._trnMainService.nullToZeroConverter(this.trnProd.NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(r){if(r&&r?.length){let l=r.map(c=>c.ADJUSTQTY).reduce((c,u)=>c+u);this._trnMainService.nullToZeroConverter(l)>0&&(this.trnProd.ALTERNATEQUANTIY=l)}}checkRepackStock(){console.log("test item",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]);let r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&l.ROUTQTY>l.STOCK)[0];if(console.log("test prodStockObj",r),null!=r&&null!=r)return console.log("test prodStockObj",r),this.alertService.info(`Inserted Quantity of Repack Item: ${r.ITEMDESC} @Qty = (${r.Quantity} x ${this._trnMainService.nullToZeroConverter(r.CONFACTOR)} ${r.ALTUNIT}) = ${this._trnMainService.nullToZeroConverter(r.CONFACTOR)*r.Quantity} ${r.PUNIT} Is Greater Than Its Available Stock of Master Item: ${r.PDESCA} @Qty = ${this._trnMainService.nullToZeroConverter(r.TOTSTOCK)} ${r.PUNIT}`),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkItemQtyExceedBilledQty(){let r=0,l=this.trnProd.ALTERNATEQUANTIY;return r=this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?l:l*this.trnProd.ALTCONFACTOR,!(r<this.trnProd.BILLEDQTY)}checkItemStockINEditModeForOutQty(){let r={},l=0,c=this.trnProd.ALTERNATEQUANTIY;if(l=this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?c:c*this.trnProd.ALTCONFACTOR,"EDIT"!==this.trnProd.rowMode?.toUpperCase()&&l>this.trnProd.STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r;if("EDIT"===this.trnProd.rowMode?.toUpperCase()){let u=this.trnProd.BatchWiseEditList?.map(R=>R.INVOICEQTY).reduce((R,F)=>R+F,0);if(l-u>this.trnProd.STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(r=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},this.loader.hide(),"ok"==r.status?"ALLOW"==r.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,(this.trnMain.VoucherType==t.Km.Purchase||this.trnMain.VoucherType==t.Km.OpeningStockBalance)&&"EDIT"===this.trnProd.rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this.trnProd.ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this.trnProd.ITEMDESC} (${this.trnProd.MENUCODE}) ?`)&&(this.trnMain.ProdList.splice(this.activerowIndex,1),0===this.trnMain.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},r=>{this.loader.hide(),this.alertService.info(r)})}ValidateQuantityinEDITMode(){let r={},l=this._trnMainService.nullToZeroConverter(this.trnProd.EDITABLEQTY),c=this.trnProd.ALTERNATEQUANTIY,u=this.trnProd.BILLEDQTY,R=0;return this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?R=c:(R=c*this.trnProd.ALTCONFACTOR,u/=this.trnProd.ALTCONFACTOR),0==l&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&(console.log("stock",R,this.trnProd),R<this.trnProd.BILLEDQTY-this.trnProd.BSTOCK)?(r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n            ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT}) \n            ,Exceed the transaction qty (${this.trnProd.TOTALOUTWARDSTOCK}  ${this.trnProd.BASEUNIT}  ) ) `,r):l>0&&R<this.trnProd.TOTALOUTWARDSTOCK?(console.log("stock1",R,this.trnProd),r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n            ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} \n            ,Exceed the transaction qty (${this.trnProd.TOTALOUTWARDSTOCK}  ${this.trnProd.BASEUNIT}   ) ) `,r):void 0}checkBCForMatrxiItem(){this.trnMain.VoucherType===t.Km.BatchAdjustment&&1==this.trnProd.HASVARIANT&&(this.trnProd.BC||this.alertService.warning(`Variant Details is not selected for Item :${this.trnProd.ITEMDESC} `))}ValidateQtyINEditModeFroProduction(r){let l=0;return l=r.BASEUNIT===r.ALTUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTERNATEQUANTIY,!(l<r.OUTQTY&&(this.alertService.info(`Item : ${r.ITEMDESC} entered Qty:${l} ${r.BASEUNIT} is less than transaction Qty:${r.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let r={},c=(this._trnMainService.nullToZeroConverter(this.trnProd.EDITABLEQTY),this.trnProd.ALTERNATEQUANTIY),u=this.trnProd.BILLEDQTY,R=0;if(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?R=c:(R=c*this.trnProd.ALTCONFACTOR,u/=this.trnProd.ALTCONFACTOR),R>this.trnProd.STOCK)return r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT}) \n        ,Exceed the Stock qty (${this.trnProd.STOCK}  ${this.trnProd.BASEUNIT}  ) ) `,r}ValidateDuplicateItemEntry(r){let l=this.trnMain.VoucherType;if(l in t.NA){let c;return c=this.trnMain.ProdList.filter(u=>u.MENUCODE==r.MENUCODE),!(c.length>0&&80==l||c.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}if(l in t.$V||20==this._trnMainService.TrnMainObj.VoucherType||64==this._trnMainService.TrnMainObj.VoucherType){let c;return c=this._trnMainService.TrnMainObj.ProdList.filter(u=>u.MENUCODE==r.MENUCODE),!(1==this.userSetting.ENABLESINGLEBATCHMODE&&c.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(l=>"AllowQuantityApproval"==l.right)?.value}onUserRightReceived(r){this.alertService.success(r),this.authenticationPopup.hide(),this.trnMain.VoucherType==t.Km.RequisitionApproval&&(this.trnProd.isConfirmed=!0)}hoverDiscountt(r){this.hoverId=r,this.indexedProd(r).TotalDiscountDescription=this.productHelperService.hoverDiscount(r,this.indexedProd(r)),this.stringValue=this.productHelperService.hoverDiscount(r,this.indexedProd(r))}hoverLeaveDiscountt(r){this.hoverId=null}hoverIndDiscount(r){this.showHoverInd=!0,this.hoverIndId=r,this.rateValue=this.productHelperService.hoverIndDisRate(r,this.indexedProd(r))}hoverLeaveIndDiscount(){this.hoverIndId=null,this.showHoverInd=!1}ReadOnlyForDescription(r){return!(1==this.indexedProd(r).ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"production-entry"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"salesorder"==this.activeurlpath))}getSchemeDiscountForItem(r){this._trnMainService.getSchemeDiscount(r.MCODE,this.trnMain.DIVISION).subscribe(u=>{r.SchemeList="ok"==u.status?u.result:[]},u=>{})}hoverItemDesc(r){this.onHoverItemDesc=!0,this.hoverId=r,this.itemDescHoverValue=`<spam>Remarks: ${this.indexedProd(r).REMARKS}`}hoverLeaveItemDesc(r){this.hoverId=null,this.onHoverItemDesc=!1}hoverQty(r){this.qtyId=r,this.indexedProd(r),this.qtyValue=this.productHelperService.hoverQty(r,this.indexedProd(r)),this.trnMain.VoucherType==t.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFBILL&&2==this.userSetting.EnablePIReferenceInTransferOut&&"EDIT"!=this._trnMainService.TrnMainObj.ProdList[r].rowMode?.toUpperCase()&&(this.qtyValue=this.productHelperService.hoverQtyForTO(r,this.indexedProd(r)),this.showtooltip=!0)}hoverLeaveQty(){this.qtyId=null,this.showtooltip=!1}hoverRate(r){!this.indexedProd(r).HASBATCH||(this.rateId=r,this.rateInnerHTML="<span>Rate changing option is disabled when Enable Batch Wise Price is turned on </span>")}hoverLeaveRate(r){!this.indexedProd(r).HASBATCH||(this.rateId=void 0,this.rateInnerHTML=void 0)}focusRateOrDiscount(){0==this.masterService.userProfile.userRights.find(l=>"AllowRateChangeInSO"==l.right)?.value||1==this.masterService.userSetting.EnableBatchWisePrice||1===this.trnProd.HASBATCH?document.getElementById("discountAmt"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus()}stopEnterPropagation(r){r instanceof KeyboardEvent&&"Enter"==r.key&&r.stopImmediatePropagation()}focusAltQty(r){console.log("focusAltQty hit",{index:r,activeRowIndex:this.activerowIndex}),r||(r=this.activerowIndex),document.getElementById("alternateQty"+r).focus()}validateItemQuantity(r,l){var c=!0;return 0==this.indexedProd(r).ALTERNATEQUANTIY?(this.stopEnterPropagation(l),this.alertService.warning(`Zero Quantity Detected for Item ${this.indexedProd(r).ITEMDESC} (${this.indexedProd(r).MENUCODE}). Please Check Your Entry.`),c=!1):0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY)&&(this.stopEnterPropagation(l),this.alertService.warning(`Qty Is Not Specified For The Item ${this.indexedProd(r).ITEMDESC} (${this.indexedProd(r).MENUCODE}). Please Check Your Entry.`),c=!1),c||this.alertService.emitShowHideSubject.subscribe(u=>{this.focusAltQty()}),c}emittedBatch(r){r&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r.batchName,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=r.mfgDate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=r.expDate,setTimeout(()=>{this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)},301))}toggleCreateBatch(){this.showCreateBatch=!this.showCreateBatch,setTimeout(()=>{this.masterService.focusAnyControl("BATCH"+this.activerowIndex)},300)}showCreateBatchFromPopup(){this.showCreateBatch=!0,this.model1Closed()}disableSalesPriceWOVAT(r){return!(2==this.userSetting.EnableBatch&&this._trnMainService.TrnMainObj.ProdList[r].enableSalesPrice||1==this.userSetting.EnableBatch&&0!=this.userSetting.VatExcludingRate)}readOnlyBatch(){return!(this.trnMain.VoucherType!==t.Km.ProductionEntry||!this.userSetting.EnableManualBatchinproduction)}disableSalesPriceWVAT(r){return 2==this.userSetting.EnableBatch||1!=this.userSetting.EnableBatch||1==this.userSetting.VatExcludingRate}showRateField(){return 90==this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.LogBasedRequisitionApproval||90!=this._trnMainService.TrnMainObj.VoucherType}}return v.\u0275fac=function(r){return new(r||v)(e.Y36(k.P),e.Y36(X.p),e.Y36(H.R),e.Y36(j.uw),e.Y36(y.qu),e.Y36(f.gz),e.Y36(L.c),e.Y36(x.e),e.Y36(e.sBO),e.Y36(m.V),e.Y36(I.R),e.Y36(P.T),e.Y36(w.y),e.Y36(Q.h),e.Y36(U.i),e.Y36(Z.P))},v.\u0275cmp=e.Xpm({type:v,selectors:[["productentry"]],viewQuery:function(r,l){if(1&r&&(e.Gf(ee.q,5),e.Gf(M.K,5),e.Gf(Bi,5),e.Gf(ft,5),e.Gf(Ki,5),e.Gf(Ot,5),e.Gf(Zi,5),e.Gf(Fi,5),e.Gf(Qi,5),e.Gf(Hi,5),e.Gf(bt,5),e.Gf(Ct,5),e.Gf(nt,5),e.Gf(qe,5)),2&r){let c;e.iGM(c=e.CRH())&&(l.itemListChild=c.first),e.iGM(c=e.CRH())&&(l.batchlistChild=c.first),e.iGM(c=e.CRH())&&(l.genericGridSupplierPopup=c.first),e.iGM(c=e.CRH())&&(l.barCodeGridPopup=c.first),e.iGM(c=e.CRH())&&(l.discountPopup=c.first),e.iGM(c=e.CRH())&&(l.PetrolGrid=c.first),e.iGM(c=e.CRH())&&(l.genericGridMulitplePricePopup=c.first),e.iGM(c=e.CRH())&&(l.matrixitemgrid=c.first),e.iGM(c=e.CRH())&&(l.warehouseWiseStockPopup=c.first),e.iGM(c=e.CRH())&&(l.itemEditGrid=c.first),e.iGM(c=e.CRH())&&(l.authenticationPopup=c.first),e.iGM(c=e.CRH())&&(l.rateValidation=c.first),e.iGM(c=e.CRH())&&(l.genericGrid=c.first),e.iGM(c=e.CRH())&&(l.focusBatch=c.first)}},hostBindings:function(r,l){1&r&&e.NdJ("keydown",function(u){return l.updown(u)},!1,e.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit",activeRowEmit:"activeRowEmit",emitShowPopup:"emitShowPopup",activeRowEmitForEdit:"activeRowEmitForEdit"},decls:135,vars:130,consts:[[2,"margin-right","15px","position","relative",3,"ngClass"],[3,"ngClass"],[1,"wrapper","height-wrapper"],["id","productinserttable"],["id","prodlistTableheader",2,"background","silver","color","black","border-right","1px solid #b4b4b4","border-left","1px solid #b4b4b4"],[4,"ngIf"],["scope","col",2,"width","4%"],["style","width: 4%",4,"ngIf"],[3,"ngStyle"],["style","width: 190px",3,"ngStyle",4,"ngIf"],["style","width: 110px",4,"ngIf"],["style","width: 5%",4,"ngIf"],["style","width: 50px",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 100px",3,"ngStyle",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width: 100px",4,"ngIf"],["style","width: 120px",4,"ngIf"],["style","width: 60px",4,"ngIf"],["style","width: 95px",4,"ngIf"],["style","width: 10%",4,"ngIf"],["style","border: 1px",4,"ngFor","ngForOf"],["class","add",3,"disabled","click",4,"ngIf"],["class","PList","style","margin-top: 2%; height: 640px; width: 78%",4,"ngIf"],[3,"activeIndex","closeBatchPopupEvent","emitCreatedBatchEvent",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],[3,"rowIndex"],["discountPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["warehouseWiseStockPopup",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 370px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],["class","backdrop",4,"ngIf"],[2,"width","4%"],[2,"width","190px",3,"ngStyle"],[2,"width","110px"],[2,"width","5%"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","100px"],[2,"width","120px"],[2,"width","60px"],[2,"width","95px"],[2,"width","10%"],[2,"border","1px"],[2,"border","1px solid #b4b4b4","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #b4b4b4","width","20px",3,"id"],["style","width: 6%",4,"ngIf"],["style","width: 10%; border: 1px solid #b4b4b4",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","30%",3,"ngStyle","mouseover","mouseleave"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["style","height: 23px; border: 1px solid #b4b4b4; width: 5%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 6%",4,"ngIf"],["class","CellWithComment sourceBarCode",4,"ngIf"],["class","sourceBatchRate",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 4%",4,"ngIf"],["style","width: 100%; text-align: right","type","number",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 8%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",3,"id",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",3,"hidden",4,"ngIf"],["style","height:23px;border: 1px solid #b4b4b4; text-align: right;",3,"id",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",3,"change",4,"ngIf"],["id","amntId","style","\n            height: 23px;\n            border: 1px solid #b4b4b4;\n            background-color: #f9f9f9;\n            text-align: right;\n          ",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["id","vatvalue","style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 40px",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 100px",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 20%",4,"ngIf"],["id","mrpNoneditable","style","\n            height: 23px;\n            border: 1px solid #b4b4b4;\n            background-color: #f9f9f9;\n            text-align: right;\n          ",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center; width: 7%;",3,"id",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9; width: 7%;",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 12%",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center;",3,"id",4,"ngIf"],["style","width:2%;border: 1px solid #b4b4b4",4,"ngIf"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"disabled","click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"],[2,"width","6%"],[2,"width","10%","border","1px solid #b4b4b4"],["autocomplete","off","type","text",2,"width","100%",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"display","none",3,"ngClass","innerHTML"],[2,"height","23px","border","1px solid #b4b4b4","width","5%"],[2,"width","100%",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9"],["type","number",2,"width","100%","text-align","right",3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","6%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","readonly","ngModelChange","keydown.Tab","keydown","keydown.enter","focusout"],["focusBatch",""],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[1,"CellWithComment","sourceBarCode"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment","barCodeInput",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],["type","text",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","disabled","",2,"width","100%",3,"id","ngModel","ngModelChange"],[1,"sourceBatchRate"],["type","number",1,"batchRateInput",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.Enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["min","0","type","number","decimalPlacesRestriction","3",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","OnlyWholeNumber","ngModelChange","change","keydown.Tab","keydown.Enter","keypress","mouseover","mouseleave"],["type","number",2,"width","100%","text-align","right",3,"ngModel","disabled","ngModelChange"],["type","number","autocomplete","off",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange"],["type","text","autocomplete","off","placeholder","Please Enter to select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","8%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"id"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9",3,"hidden"],["min","0","type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout","mouseover","mouseleave"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right",3,"change"],["type","number","autocomplete","off",1,"CellWithComment",2,"height","23px","background-color","#f9f9f9","text-align","right",3,"id","ngModel","disabled","ngModelChange","focusout","focusin","keyup","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4"],["type","number","decimalPlacesRestriction","2",2,"width","100%","text-align","right",3,"id","ngModel","disabled","keydown","ngModelChange","focusout","mouseover","mouseleave"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id","mouseover","mouseleave"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","ngModelChange","keydown.tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.tab","keydown.enter"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","40px",3,"id"],["type","text",2,"width","3.5rem","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #b4b4b4","width","100px"],[3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","20%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange"],["type","number","autocomplete","off","readonly","",2,"width","80px","text-align","right",3,"id","ngModel","ngModelChange"],["id","mrpNoneditable",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center","width","7%",3,"id"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9","width","7%"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","12%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","keydown.Tab","keydown.enter","ngModelChange"],["selected",""],["type","text","autocomplete","off","disabled","true",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center",3,"id"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],[2,"width","2%","border","1px solid #b4b4b4"],[1,"add",3,"click"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81daac"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[3,"activeIndex","closeBatchPopupEvent","emitCreatedBatchEvent"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue","showCreateBatchEvent"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #b4b4b4","border-top","2px solid #b4b4b4","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #b4b4b4","max-height","25px"],[2,"border","1px solid #b4b4b4"],["style","border: 1px solid #b4b4b4",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #b4b4b4",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],[1,"backdrop"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem","bottom","85px"],["class","modal-title","style","padding-left: 5px",4,"ngIf"],["type","text","id","AuthUserName","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(r,l){1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"table",3)(4,"tr",4),e.YNc(5,At,2,0,"th",5),e.TgZ(6,"th",6),e._uU(7,"S.No."),e.qZA(),e.YNc(8,Et,2,0,"th",5),e.ALo(9,"activeColumn"),e.YNc(10,It,2,0,"th",5),e.ALo(11,"activeColumn"),e.YNc(12,We,2,0,"th",7),e.ALo(13,"activeColumn"),e.TgZ(14,"th",8),e._uU(15," Description "),e.qZA(),e.YNc(16,Pt,2,0,"th",5),e.YNc(17,yt,2,0,"th",5),e.YNc(18,xt,2,2,"th",9),e.ALo(19,"activeColumn"),e.TgZ(20,"th"),e._uU(21,"Unit"),e.qZA(),e.YNc(22,Rt,2,2,"th",9),e.YNc(23,Nt,2,0,"th",10),e.YNc(24,Lt,2,0,"th",10),e.YNc(25,wt,2,2,"th",9),e.YNc(26,rt,2,0,"th",11),e.YNc(27,Dt,2,0,"th",11),e.YNc(28,jt,2,0,"th",12),e.YNc(29,kt,2,0,"th",12),e.YNc(30,Vt,2,2,"th",9),e.YNc(31,Ut,2,2,"th",13),e.YNc(32,Bt,2,2,"th",13),e.YNc(33,Kt,2,2,"th",9),e.YNc(34,Zt,2,2,"th",9),e.YNc(35,Ft,2,3,"th",9),e.YNc(36,Qt,2,2,"th",9),e.YNc(37,Ht,2,3,"th",9),e.YNc(38,Gt,2,1,"th",10),e.ALo(39,"activeColumn"),e.YNc(40,qt,2,6,"th",14),e.ALo(41,"showColumn"),e.YNc(42,Wt,2,0,"th",10),e.YNc(43,$t,2,0,"th",15),e.YNc(44,zt,2,0,"th",10),e.ALo(45,"activeColumn"),e.YNc(46,Xt,2,0,"th",16),e.YNc(47,ei,2,0,"th",10),e.ALo(48,"activeColumn"),e.YNc(49,ti,2,4,"th",14),e.YNc(50,ii,2,0,"th",17),e.ALo(51,"activeColumn"),e.YNc(52,ni,2,0,"th",17),e.YNc(53,ri,2,0,"th",10),e.YNc(54,ze,2,0,"th",10),e.YNc(55,oi,2,0,"th",10),e.YNc(56,si,2,0,"th",10),e.YNc(57,ai,2,0,"th",18),e.ALo(58,"activeColumn"),e.YNc(59,ci,2,0,"th",17),e.ALo(60,"activeColumn"),e.YNc(61,li,2,0,"th",10),e.YNc(62,di,2,0,"th",10),e.ALo(63,"showColumn"),e.YNc(64,hi,2,0,"th",16),e.ALo(65,"showColumn"),e.YNc(66,ui,2,0,"th",5),e.YNc(67,pi,2,0,"th",5),e.YNc(68,_i,2,0,"th",5),e.YNc(69,Ti,2,0,"th",5),e.YNc(70,Mi,2,0,"th",5),e.YNc(71,mi,2,0,"th",5),e.YNc(72,gi,2,0,"th",5),e.YNc(73,vi,2,0,"th",19),e.YNc(74,Si,2,3,"th",13),e.ALo(75,"activeColumn"),e.YNc(76,fi,2,3,"th",13),e.ALo(77,"activeColumn"),e.YNc(78,Oi,2,0,"th",5),e.YNc(79,bi,2,0,"th",5),e.YNc(80,Ci,2,0,"th",5),e.YNc(81,Ai,2,0,"th",20),e.YNc(82,Ei,1,0,"th",5),e._UZ(83,"th"),e.qZA(),e.YNc(84,Un,100,140,"tbody",21),e.qZA(),e.YNc(85,Bn,3,2,"span",22),e.ALo(86,"hide"),e.qZA()()(),e.YNc(87,Zn,25,1,"div",5),e.YNc(88,Fn,2,1,"div",23),e.YNc(89,Qn,1,1,"create-manual-batch-popup",24),e.YNc(90,Hn,2,6,"div",25),e.YNc(91,Gn,2,1,"div",25),e.TgZ(92,"generic-popup-grid",26,27),e.NdJ("onItemDoubleClick",function(u){return l.dblClickPopupItem(u)}),e.qZA(),e.TgZ(94,"generic-popup-grid",26,28),e.NdJ("onItemDoubleClick",function(u){return l.dblClickPopupParty(u)}),e.qZA(),e._UZ(96,"app-discount-popup",29,30),e.TgZ(98,"barcode-popup-grid",26,31),e.NdJ("onItemDoubleClick",function(u){return l.dblClickbarcodePopUP(u)}),e.qZA(),e.TgZ(100,"multiple-price-popup-grid",26,32),e.NdJ("onItemDoubleClick",function(u){return l.dblClickPricePopUP(u)}),e.qZA(),e.TgZ(102,"matrix-item-grid",33,34),e.NdJ("onApplyClicked",function(u){return l.setVariantData(u)}),e.qZA(),e.TgZ(104,"batch-wise-item-edit",35,36),e.NdJ("onApplyClicked",function(u){return l.setBatchWiseEditData(u)}),e.qZA(),e.TgZ(106,"authentication-entry",37,38),e.NdJ("onUserRightReceived",function(u){return l.onUserRightReceived(u)}),e.qZA(),e._UZ(108,"popup-petrol",null,39)(110,"warehousewisestock",null,40),e.YNc(112,zn,39,5,"div",41),e.TgZ(113,"div")(114,"div",42,43)(116,"div",44)(117,"div",45)(118,"div",46)(119,"button",47),e.NdJ("click",function(){return l.onClickNo()}),e.TgZ(120,"span",48),e._uU(121,"\xd7"),e.qZA()()(),e.TgZ(122,"div",49)(123,"div",50)(124,"div",51),e._uU(125),e.qZA(),e.TgZ(126,"div",52)(127,"button",53),e.NdJ("click",function(){return l.onClickYes()}),e._uU(128," Yes "),e.qZA(),e.TgZ(129,"button",54),e.NdJ("click",function(){return l.onClickNo()}),e._uU(130," No "),e.qZA()()()()()()()(),e.YNc(131,Xn,36,4,"div",5),e.YNc(132,er,2,2,"div",5),e.YNc(133,tr,2,2,"div",5),e.YNc(134,rr,25,4,"div",55)),2&r&&(e.Q6J("ngClass",l.masterService.ShowMore?"":"classadded"),e.xp6(1),e.Q6J("ngClass",81==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType||74==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType?"inventorymngtclass2":""),e.xp6(4),e.Q6J("ngIf",l.approvalFlag),e.xp6(3),e.Q6J("ngIf",e.lcZ(9,85,"MENUCODE_HEADER")),e.xp6(2),e.Q6J("ngIf",e.lcZ(11,87,"BARCODE_HEADER")),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,89,"HS_CODE")),e.xp6(2),e.Q6J("ngStyle",24==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType||5==l._trnMainService.TrnMainObj.VoucherType?e.DdM(124,or):null)("ngStyle",8==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType?e.DdM(125,sr):null)("ngStyle",89==l._trnMainService.TrnMainObj.VoucherType?e.DdM(126,ar):null)("ngStyle",80==l._trnMainService.TrnMainObj.VoucherType?e.DdM(127,cr):null),e.xp6(2),e.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),e.xp6(1),e.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),e.xp6(1),e.Q6J("ngIf",e.lcZ(19,91,"BATCH_HEADER")),e.xp6(4),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90!=l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableOtherUnitQtyInTI),e.xp6(1),e.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType&&0==l.userSetting.LogBasedRequisitionApproval),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",e.xi3(39,93,"FCRATE_HEADER",0)),e.xp6(2),e.Q6J("ngIf",e.lcZ(41,96,"showRateHeader")),e.xp6(2),e.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType||16==l._trnMainService.TrnMainObj.VoucherType||40==l._trnMainService.TrnMainObj.VoucherType||31==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==l._trnMainService.TrnMainObj.AdditionalObj.tag),e.xp6(1),e.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",e.lcZ(45,98,"CONFACTOR")),e.xp6(2),e.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType||16===l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||73==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==l.activeurlpath),e.xp6(1),e.Q6J("ngIf",e.lcZ(48,100,"ECSAmount")),e.xp6(2),e.Q6J("ngIf",(-1==e.DdM(128,Gi).indexOf(l._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=l.activeurlpath&&!l.userSetting.IsBBSM||90==l._trnMainService.TrnMainObj.VoucherType&&0===l.userSetting.LogBasedRequisitionApproval&&l.userSetting.IsBBSM)&&l._trnMainService.showFieldFromRight("Amt")),e.xp6(1),e.Q6J("ngIf",e.xi3(51,102,"DISCOUNT_AMT_HEADER",0)),e.xp6(2),e.Q6J("ngIf",(14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType||1==l._trnMainService.TrnMainObj.VoucherType||3==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||16==l._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=l.activeurlpath),e.xp6(1),e.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE||74==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE),e.xp6(1),e.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",e.xi3(58,105,"DISCOUNT_IMPORTPURCHASE",0)),e.xp6(2),e.Q6J("ngIf",e.xi3(60,108,"DISCOUNT_IMPORTPURCHASE",0)),e.xp6(2),e.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableServiceCharge),e.xp6(1),e.Q6J("ngIf",e.lcZ(63,111,"showVATcolumn")),e.xp6(2),e.Q6J("ngIf",e.lcZ(65,113,"showNetAmtHeadercolumn")),e.xp6(2),e.Q6J("ngIf",(3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||31==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",l.approvalFlag),e.xp6(1),e.Q6J("ngIf","add-creditnote-itembase-approval"==l.activeurlpath||"add-stock-issue-approval"==l.activeurlpath||"transfer-out-approval"==l.activeurlpath||"stock-issue-approval"==l.activeurlpath),e.xp6(1),e.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",80==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",(19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||(5==l._trnMainService.TrnMainObj.VoucherType||81==l._trnMainService.TrnMainObj.VoucherType)&&1==l.userSetting.BATCHWISEPRICE||8==l._trnMainService.TrnMainObj.VoucherType)&&l._trnMainService.showFieldFromRight("MRP")),e.xp6(1),e.Q6J("ngIf",e.xi3(75,115,"MFGDATE_HEADER",0)),e.xp6(2),e.Q6J("ngIf",e.xi3(77,118,"EXPDATE_HEADER",0)),e.xp6(2),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),e.xp6(1),e.Q6J("ngIf",64==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||80==l._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.LinkProductionwithconsumption),e.xp6(2),e.Q6J("ngForOf",l._trnMainService.TrnMainObj.ProdList),e.xp6(1),e.Q6J("ngIf",e.xi3(86,121,"hideAddButton",l._trnMainService.callPipe)),e.xp6(2),e.Q6J("ngIf",l.isProductDetailView),e.xp6(1),e.Q6J("ngIf","itemList"==l.masterService.PlistTitle&&l.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf",l.showCreateBatch),e.xp6(1),e.Q6J("ngIf","Batch Price Selection"==l.masterService.PlistTitle||"Item Variant Selection"==l.masterService.PlistTitle||"Batch Selection"==l.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","partyPopUp"==l.masterService.PlistTitle),e.xp6(1),e.Q6J("popupsettings",l.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",l.gridPopupSettingsForSupplier),e.xp6(2),e.Q6J("rowIndex",l.activerowIndex),e.xp6(2),e.Q6J("popupsettings",l.barcodeGridSettings),e.xp6(2),e.Q6J("popupsettings",l.gridPopupSettingsForMultiplePrice),e.xp6(2),e.Q6J("activerowIndex",l.activerowIndex)("matrixItemAtrribute",l.matrixItemAtrribute),e.xp6(2),e.Q6J("BatchWiseEditList",l.BatchWiseEditList),e.xp6(8),e.Q6J("ngIf",l._trnMainService.showPriceChangeDetail&&1==l.userSetting.ShowPriceChangePopup),e.xp6(2),e.Q6J("config",e.DdM(129,lr)),e.xp6(11),e.hij(" ",l.rateValidationDisplayMessage," "),e.xp6(6),e.Q6J("ngIf",l.showDiscountAuth),e.xp6(1),e.Q6J("ngIf",l.showBatchPopup),e.xp6(1),e.Q6J("ngIf",l.showAdjustPopup),e.xp6(1),e.Q6J("ngIf",1==l._trnMainService.showNegativeBilling||1==l.userRightAuthService.showAuthPopup||l._trnMainService.showCreditSalesAuth))},dependencies:[B.oB,C.mk,C.sg,C.O5,C.PC,y.YN,y.Kr,y.Fj,y.wV,y.EJ,y.JJ,y.qQ,y.Fd,y.On,O.Zl,q.n,W.r,Y,z.F,ee.q,M.K,K.H,oe.j,S._v,me.ed,Ne.t,Ze.l,Fe.m,dt.l,pt,_t.B,C.JJ,Tt.g,Mt,Ui.e,mt.w,gt.R,vt.A,St],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}",'table[_ngcontent-%COMP%] {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 13%;\n\n  }\n\n  .disabled-rate[_ngcontent-%COMP%]{\n    background: rgb(75, 78, 77);\n    line-height:19px !important;\n  }\n\n  th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n    padding: 8px;\n  }\n\n  th[_ngcontent-%COMP%] {\n    text-align: left;\n    background: #eee;\n    position: sticky;\n    top: 0px;\n  }\n\n .add[_ngcontent-%COMP%]{\n  color: #04AA6D;\n  border: 2px solid #04AA6D;\n  margin-top: 5px;\n}\n.add.disabled[_ngcontent-%COMP%] {\n  pointer-events: none;\n  color: gray; \n  cursor: not-allowed;\n}\nspan.add[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{\n  position: absolute;\n  left: 50%;\n  top:50%;\n  transform: translate(-50%, -50%);\n\n}\n  span.add[_ngcontent-%COMP%]{\n   display: inline-block;\n    width: 22px;\n    height: 22px;\n    text-align: center;\n    font-size: 20px;\n    font-family: "Roboto";\n    border-radius: 50%;\n    background: #FFF;\n    position: relative;\n    cursor: pointer;\n}\n.closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}\n\n .tooltiptext[_ngcontent-%COMP%] {\n    \n     visibility: hidden;\n    opacity:0;\n      text-align: center;\n    border-radius: 3px;\n    \n    right: 0;\n    font-size: 7px;\n    \n    align-items: center;\n    line-height: 2;\n    z-index: 99;\n    margin-top: -14px;\n    display: block;\n    width: 30px;\n    \n    position: relative;\n    color: #000;\n    white-space: nowrap;\n}\n\n.close-wrapper[_ngcontent-%COMP%]:hover   .tooltiptext[_ngcontent-%COMP%] {\n  visibility: visible;\n  opacity:1;\n}\n\n  \n    \n  \n   \n\n  .col1[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 10em;\n    left: 0em;\n    top: auto;\n  }\n\n  .col2[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 5em;\n    left: 10em;\n    top: auto;\n  }\n\n  .modal-footer[_ngcontent-%COMP%] {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n    cursor: pointer;\n    position: absolute;\n    top: 10px;\n    right: 10px;\n  }\n\n  .modal-backdrop[_ngcontent-%COMP%] {\n    display: none;\n  }',".modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 13px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n    padding: 3px;\n  }\n\n  thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 94%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    white-space: nowrap;\n  }\n\n  .close[_ngcontent-%COMP%] {\n    margin: -9px 0px -9px 0px;\n  }\n\n  .highlighted[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n  .bgforlessstockitem[_ngcontent-%COMP%] {\n    background-color: #ffc107d2;\n  }"]}),v})()},32635:(ve,ce,b)=>{b.d(ce,{j:()=>Ni});var e=b(64537),t=b(42326),O=b(28698),M=b(37051),ee=b(82484),$=b(27009),S=b(64752),J=b(71732),C=b(92340),_=b(53074),Z=b(87584),k=b(69389),X=b(54536),H=b(20092),j=b(7976),y=b(67311),f=b(67297),L=b(14970),x=b(74263),m=b(60694),I=b(7782),P=b(33612),w=b(71800),Q=b(88692),U=b(98692),B=b(64657);const q=["inputBox"];function W(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"tbody",10),e.NdJ("dblclick",function(){const g=e.CHM(a).$implicit,N=e.oxw();return e.KtG(N.dblClickItemList(g))}),e.TgZ(1,"tr",11)(2,"td",12),e._uU(3),e.qZA(),e.TgZ(4,"td",13),e._uU(5),e.qZA(),e.TgZ(6,"td",13),e._uU(7),e.qZA(),e.TgZ(8,"td",13),e._uU(9),e.qZA()()()}if(2&D){const a=te.$implicit,h=te.index,d=e.oxw();e.ekj("active",h==d.selectedRow),e.xp6(3),e.Oqu(a.schemeName),e.xp6(2),e.Oqu(a.schemeType),e.xp6(2),e.Oqu(2==a.discountRateType?"Buy "+a.minQty+"Get "+a.schemeDisRate+" free":a.schemeDisRate),e.xp6(2),e.Oqu(0==a.discountRateType?"%":1==a.discountRateType?"Amount":2==a.discountRateType?"Quantity":"Type Not Found")}}let re=(()=>{class D{constructor(a,h){this.masterService=a,this._trnMainService=h,this.dbClickEvent=new e.vpe,this.schemeCloseClick=new e.vpe,this.schemeList=[],this.title="Available Active Schemes on Item"}ngAfterViewInit(){}ngOnInit(){}SearchList(a){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(a){this.dbClickEvent.emit(a)}schemeListClosed(){this.schemeCloseClick.emit()}}return D.\u0275fac=function(a){return new(a||D)(e.Y36(_.P),e.Y36(Z.p))},D.\u0275cmp=e.Xpm({type:D,selectors:[["PSalesSchemeList"]],viewQuery:function(a,h){if(1&a&&e.Gf(q,5),2&a){let d;e.iGM(d=e.CRH())&&(h._el=d.first)}},inputs:{schemeList:"schemeList"},outputs:{dbClickEvent:"dbClickEvent",schemeCloseClick:"schemeCloseClick"},decls:20,vars:2,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"active","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(a,h){1&a&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),e.NdJ("click",function(){return h.schemeListClosed()}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()(),e.TgZ(6,"h4",4),e._uU(7),e.qZA()(),e.TgZ(8,"div",5)(9,"table",6)(10,"tr",7)(11,"th",8),e._uU(12,"Scheme Name"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Scheme Type"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Discount"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Dis. Type"),e.qZA()(),e.YNc(19,W,10,6,"tbody",9),e.qZA()()()()),2&a&&(e.xp6(7),e.Oqu(h.title),e.xp6(12),e.Q6J("ngForOf",h.schemeList))},dependencies:[Q.sg],encapsulation:2}),D})();var ae=b(59963),Me=b(65171),G=b(32711),Y=b(87454),z=b(86857),K=b(94619),oe=b(14173),me=b(89952);const Ne=["genericGridSupplierPopup"],Ze=["barCodeGridPopup"],Fe=["PetrolGrid"],dt=["genericGridMulitplePricePopup"],ht=["matrixitemgrid"],ut=["itemEditGrid"],pt=["authenticationPopup"],_t=["rateValidatoin"],Tt=["genericGrid"],Mt=["focusBatch"];function Ui(D,te){1&D&&(e.TgZ(0,"th"),e._uU(1,"Approval Flag"),e.qZA())}function mt(D,te){1&D&&(e.TgZ(0,"th"),e._uU(1,"Code"),e.qZA())}function gt(D,te){1&D&&(e.TgZ(0,"th"),e._uU(1,"Barcode"),e.qZA())}const vt=function(){return{width:"10%"}};function St(D,te){if(1&D&&(e.TgZ(0,"th",47),e._uU(1,"BatchNo"),e.qZA()),2&D){const a=e.oxw();e.Q6J("ngStyle",89==a._trnMainService.TrnMainObj.VoucherType?e.DdM(1,vt):null)}}function Bi(D,te){1&D&&(e.TgZ(0,"th",48),e._uU(1," Quantity"),e.qZA())}const ft=function(){return{width:"15%"}},Ki=function(){return{width:"20%"}},Ot=function(){return{width:"8%"}};function Zi(D,te){if(1&D&&(e.TgZ(0,"th",49),e._uU(1," Rate"),e.qZA()),2&D){const a=e.oxw();e.Q6J("ngStyle",19==a._trnMainService.TrnMainObj.VoucherType||8==a._trnMainService.TrnMainObj.VoucherType?e.DdM(3,ft):null)("ngStyle",7==a._trnMainService.TrnMainObj.VoucherType?e.DdM(4,Ki):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?e.DdM(5,Ot):null)}}function Fi(D,te){1&D&&(e.TgZ(0,"th",50),e._uU(1,"MRP"),e.qZA())}function Qi(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"FC P.Rate"),e.qZA())}function Hi(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"P.Rate"),e.qZA())}function bt(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"Amount"),e.qZA())}function Ct(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"Con.Factor"),e.qZA())}function nt(D,te){1&D&&(e.TgZ(0,"th",52),e._uU(1," Amt"),e.qZA())}function qe(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"ECS"),e.qZA())}function At(D,te){1&D&&(e.TgZ(0,"th",53),e._uU(1," Dis%"),e.qZA())}function Et(D,te){1&D&&(e.TgZ(0,"th",54),e._uU(1,"Dis Amt"),e.qZA())}function It(D,te){1&D&&(e.TgZ(0,"th",55),e._uU(1,"Total Disc"),e.qZA())}const We=function(){return{width:"6.5%"}};function Pt(D,te){if(1&D&&(e.TgZ(0,"th",49),e._uU(1," Amt"),e.qZA()),2&D){const a=e.oxw();e.Q6J("ngStyle",8==a._trnMainService.TrnMainObj.VoucherType||15==a._trnMainService.TrnMainObj.VoucherType||1==a._trnMainService.TrnMainObj.VoucherType||7==a._trnMainService.TrnMainObj.VoucherType?e.DdM(2,We):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?e.DdM(3,Ot):null)}}function yt(D,te){1&D&&(e.TgZ(0,"th",53),e._uU(1," Dis%"),e.qZA())}function Ue(D,te){1&D&&(e.TgZ(0,"th",54),e._uU(1,"Dis Amt "),e.qZA())}function xt(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"S.Charge"),e.qZA())}function Rt(D,te){1&D&&(e.TgZ(0,"th",51),e._uU(1,"VAT"),e.qZA())}function Nt(D,te){1&D&&(e.TgZ(0,"th",52),e._uU(1," Net Amt"),e.qZA())}function Lt(D,te){1&D&&(e.TgZ(0,"th"),e._uU(1," Net Rate"),e.qZA())}function wt(D,te){1&D&&(e.TgZ(0,"th"),e._uU(1,"Approval Flag"),e.qZA())}const rt=function(){return{width:"130px"}};function Dt(D,te){if(1&D&&(e.TgZ(0,"th",5),e._uU(1,"Mfg Date "),e.qZA()),2&D){const a=e.oxw();e.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?e.DdM(1,We):e.DdM(2,rt))}}function jt(D,te){if(1&D&&(e.TgZ(0,"th",5),e._uU(1,"Exp Date "),e.qZA()),2&D){const a=e.oxw();e.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?e.DdM(1,We):e.DdM(2,rt))}}function kt(D,te){1&D&&(e.TgZ(0,"th",56),e._uU(1,"Remarks"),e.qZA())}function Qe(D,te){if(1&D&&(e.TgZ(0,"td",88),e._uU(1),e.qZA()),2&D){const a=e.oxw().$implicit;e.xp6(1),e.hij(" ",a.MENUCODE," ")}}function Vt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",89)(1,"input",90),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.BC=d)})("keydown.Tab",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.ItemBarCodeClick(g,d))})("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.ItemBarCodeClick(g,d))})("keydown.enter",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.ItemBarCodeClick(g,d))})("focusout",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.ItemBarCodeFoucusOut(g,d))})("focus",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.ItemBarCodeClickFocusIn(g,d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","barcode",h,""),e.Q6J("ngModel",d.BC)("readonly","VIEW"==d.rowMode)("disabled",g.disableBarcodeField(h))}}function Ut(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",91)(1,"input",92,93),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.BATCH=d)})("keydown.Tab",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.BatchTabClick(g,d))})("keydown",function(d){e.CHM(a);const g=e.oxw(2);return e.KtG(g.onKeydownOnBatch(d))})("keydown.enter",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.BatchEnter(g,d))}),e.qZA(),e.TgZ(3,"span",64),e._uU(4,"press ENTER or TAB to Select Batch"),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","batch",h,""),e.Q6J("ngModel",d.BATCH)("disabled",g.disableBatch(d))}}function Bt(D,te){if(1&D&&(e.ynx(0),e.TgZ(1,"option",97),e._uU(2),e.qZA(),e.BQk()),2&D){const a=te.$implicit;e.xp6(1),e.s9C("value",a.ALTUNIT),e.xp6(1),e.Oqu(a.ALTUNIT)}}function Kt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",94)(1,"select",95),e.NdJ("change",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.SelectUnit(d))})("keydown.Tab",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.AlternateUnitEnterEventClick(g,d))})("keydown.enter",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.AlternateUnitEnterEventClick(g,d))})("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.ALTUNIT=d)}),e.YNc(2,Bt,3,2,"ng-container",96),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","alternateunit",h,""),e.Q6J("ngModel",d.ALTUNIT)("disabled",g.disableAltUnit(h)),e.xp6(1),e.Q6J("ngForOf",null==d.Product?null:d.Product.AlternateUnits)}}function He(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",98)(1,"input",99),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.ALTERNATEQUANTIY=d)})("ngModelChange",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.QuantityChangeEvent(d))})("keydown.Tab",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.focusToRate(g,d))})("focusout",function(d){e.CHM(a);const g=e.oxw(2);return e.KtG(g.quantityFocusOut(d))})("keydown.Enter",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.AlternateQuantityEventClick(g,d))})("keyup",function(d){e.CHM(a);const g=e.oxw(2);return e.KtG(g.quantityChange(d))})("keypress",function(d){e.CHM(a);const g=e.oxw(),N=g.$implicit,ne=g.index,he=e.oxw();return e.KtG(6==N.PTYPE&&1!=N.isPurchaseOrder?he.AlternateQuantityEventClick(ne,d):he.return)}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","alternateqty",h,""),e.Q6J("ngModel",d.ALTERNATEQUANTIY)("readonly",d.isQuantityReadonly)("disabled",g.disableAltQty(h)||g.disableRequestQTY(h))}}function Zt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",100)(1,"input",101),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.INVRATE=d)})("change",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.FCRATEChangeEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.fcrateEnterEvent(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.fcrateEnterEvent(d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","fcrate",h,""),e.Q6J("ngModel",d.INVRATE)("disabled",g._trnMainService.disableRateOnPOselect)}}function Ft(D,te){if(1&D&&(e.TgZ(0,"td",102),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","grossamnt",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,g._trnMainService.nullToZeroConverter(d.GROSSAMNT))," ")}}function Qt(D,te){if(1&D&&(e.TgZ(0,"td",103),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","amount",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,g._trnMainService.nullToZeroConverter(d.AMOUNT)),"")}}function Ht(D,te){if(1&D&&(e.TgZ(0,"td",103),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","confactor",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,g._trnMainService.nullToZeroConverter(d.ALTCONFACTOR)),"")}}function Gt(D,te){if(1&D&&(e.TgZ(0,"td",104),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,a.ECSAMOUNT)," ")}}function Yt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",105)(1,"input",106,107),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.INDDISCOUNTRATE=d)})("change",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.IndDiscountRateChangeEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discRateEnterClicked(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discRateEnterClicked(d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","discount",h,""),e.Q6J("ngModel",d.INDDISCOUNTRATE)("readonly",g.disableDiscount())("disabled","VIEW"==d.rowMode||g.disableRAteDisandAmt()||1==g._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||null!=g._trnMainService.TrnMainObj.DCRATE&&0!=g._trnMainService.TrnMainObj.DCRATE&&16!==g._trnMainService.TrnMainObj.VoucherType||null!=g._trnMainService.TrnMainObj.FLATDCAMNT&&0!=g._trnMainService.TrnMainObj.FLATDCAMNT&&16!==g._trnMainService.TrnMainObj.VoucherType||g._trnMainService.disableOnPerFormaSelect||15==g._trnMainService.TrnMainObj.VoucherType&&0==g._trnMainService.TrnMainObj.DOFULLRETURN&&0==g._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&g._trnMainService.TrnMainObj.REFBILL&&0==g._trnMainService.userSetting.ENABLEMANUALSALESRETURN)}}function Jt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",105)(1,"input",108),e.NdJ("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.IndDiscountAmountChangeEvent(g,d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))})("click",function(){e.CHM(a);const d=e.oxw(2);return e.KtG(d.DisAmtclick())}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","discountAmt",h,""),e.Q6J("readonly",g.disableDiscount())("ngModel",e.lcZ(2,4,g._trnMainService.nullToZeroConverter(d.INDDISCOUNT)))("disabled","VIEW"==d.rowMode||g.disableRAteDisandAmt()||1==g._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||g._trnMainService.disableOnGRNload||null!=g._trnMainService.TrnMainObj.DCRATE&&0!=g._trnMainService.TrnMainObj.DCRATE&&16!==g._trnMainService.TrnMainObj.VoucherType||null!=g._trnMainService.TrnMainObj.FLATDCAMNT&&0!=g._trnMainService.TrnMainObj.FLATDCAMNT&&16!==g._trnMainService.TrnMainObj.VoucherType||g._trnMainService.disableOnPerFormaSelect||15==g._trnMainService.TrnMainObj.VoucherType&&0==g._trnMainService.TrnMainObj.DOFULLRETURN&&0==g._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&g._trnMainService.TrnMainObj.REFBILL&&0==g._trnMainService.userSetting.ENABLEMANUALSALESRETURN)}}const qt=function(D){return{tooltipChild:D}};function Wt(D,te){if(1&D&&(e.ynx(0),e.TgZ(1,"span",110)(2,"b"),e._uU(3,"Indv Discount "),e.qZA(),e._uU(4),e.ALo(5,"twoDigitNumber"),e._UZ(6,"br"),e.TgZ(7,"b"),e._uU(8,"Flat Dsicount"),e.qZA(),e._uU(9),e.ALo(10,"twoDigitNumber"),e.qZA(),e.BQk()),2&D){const a=e.oxw(2),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(7,qt,g.hoverId==h)),e.xp6(3),e.hij(" : ",e.lcZ(5,3,d.INDDISCOUNT)," "),e.xp6(5),e.hij(" : ",e.lcZ(10,5,d.FLATDISCOUNT)," ")}}function $t(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",109),e.NdJ("mouseover",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.hoverDiscount(d))})("mouseleave",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.hoverLeaveDiscount(d))}),e._uU(1),e.ALo(2,"twoDigitNumber"),e.YNc(3,Wt,11,9,"ng-container",3),e.qZA()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","totalDisc",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,3,g._trnMainService.nullToZeroConverter(d.DISCOUNT))," "),e.xp6(2),e.Q6J("ngIf",d.DISCOUNT>0)}}function zt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",105)(1,"input",111),e.NdJ("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.IndDiscountAmountChangeOfRetailerVATINCEvent(g,d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))}),e.ALo(2,"number"),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","discountAmtVATInclusiveForretailer",h,""),e.Q6J("ngModel",e.xi3(2,3,g._trnMainService.nullToZeroConverter(d.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==d.rowMode||d.isPurchaseOrderItem)}}function Xt(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",112),e.NdJ("change",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.MRPChangeEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.mrpEnterEvent(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.mrpEnterEvent(d))}),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()}if(2&D){const a=e.oxw().$implicit,h=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,h._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function ei(D,te){if(1&D&&(e.TgZ(0,"td",113),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw().$implicit,h=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,h._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function $e(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",105)(1,"input",106,107),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.INDDISCOUNTRATE=d)})("change",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.IndDiscountRateChangeEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discRateEnterClicked(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discRateEnterClicked(d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","discount",h,""),e.Q6J("ngModel",d.INDDISCOUNTRATE)("readonly",g._trnMainService.disableProd||g.disableDiscount())("disabled","VIEW"==d.rowMode||g.disableRAteDisandAmt()||1==g._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem)}}function ti(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",105)(1,"input",108),e.NdJ("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.IndDiscountAmountChangeEvent(g,d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.discEnterClicked(d))})("click",function(){e.CHM(a);const d=e.oxw(2);return e.KtG(d.DisAmtclick())}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","discountAmti",h,""),e.Q6J("readonly",g.disableDiscount())("ngModel",e.lcZ(2,4,g._trnMainService.nullToZeroConverter(d.INDDISCOUNT)))("disabled","VIEW"==d.rowMode||g.disableRAteDisandAmt()||1==g._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem)}}function ii(D,te){if(1&D&&(e.TgZ(0,"td",114),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw().$implicit,h=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,h._trnMainService.nullToZeroConverter(a.SERVICETAX)),"")}}function ni(D,te){if(1&D&&(e.TgZ(0,"td",115),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw().$implicit,h=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,h._trnMainService.nullToZeroConverter(a.VAT)),"")}}function ri(D,te){if(1&D&&(e.TgZ(0,"td",102),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","netamount",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,g._trnMainService.nullToZeroConverter(d.NETAMOUNT)),"")}}function ze(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",102)(1,"input",116),e.NdJ("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw();return e.KtG(N.changeONNetAmount(g,d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.clickOnNetAmount(d))})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.clickOnNetAmount(d))}),e.ALo(2,"twoDigitNumber"),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","netamount",h,""),e.xp6(1),e.MGl("id","netamounteditable",h,""),e.Q6J("ngModel",e.lcZ(2,4,g._trnMainService.nullToZeroConverter(d.NETAMOUNT)))("disabled","VIEW"==d.rowMode)}}function oi(D,te){if(1&D&&(e.TgZ(0,"td",117),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.MGl("id","mrp",h,""),e.xp6(1),e.hij(" ",e.lcZ(2,2,g._trnMainService.nullToZeroConverter(d.CRATE))," ")}}function si(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",118)(1,"select",119),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.IsApproveStockSettlement=d)}),e.TgZ(2,"option",97),e._uU(3,"Approved "),e.qZA(),e.TgZ(4,"option",97),e._uU(5,"Not Approved"),e.qZA()()()}if(2&D){const a=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",a.IsApproveStockSettlement),e.xp6(1),e.Q6J("value",1),e.xp6(2),e.Q6J("value",0)}}function ai(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",120)(1,"input",121),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.MFGDATE=d)})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.MFGDateEnterEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.MFGDateEnterEvent(d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","mfgdate",h,""),e.s9C("type",g.mfgExpDateType),e.Q6J("ngModel",d.MFGDATE)("disabled","VIEW"==d.rowMode||d.isDisabled||d.isPurchaseOrderItem||"stock-issue-approval"==g.activeurlpath||g._trnMainService.disableOnGRNload||null!=d.BATCH&&1==d.REQEXPDATE&&5==g._trnMainService.TrnMainObj.VoucherType||7==g._trnMainService.TrnMainObj.VoucherType)}}function ci(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",120)(1,"input",122),e.NdJ("change",function(){e.CHM(a);const d=e.oxw(2);return e.KtG(d.onChangeExpDate())})("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.EXPDATE=d)})("keydown.enter",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.expDateEnterEvent(d))})("keydown.Tab",function(){e.CHM(a);const d=e.oxw().index,g=e.oxw();return e.KtG(g.expDateEnterEvent(d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw();e.xp6(1),e.MGl("id","expdate",h,""),e.s9C("type",g.mfgExpDateType),e.Q6J("ngModel",d.EXPDATE)("disabled","VIEW"==d.rowMode||d.isDisabled||d.isPurchaseOrderItem||"stock-issue-approval"==g.activeurlpath||g._trnMainService.disableOnGRNload||null!=d.BATCH&&1==d.REQEXPDATE&&5==g._trnMainService.TrnMainObj.VoucherType||7==g._trnMainService.TrnMainObj.VoucherType)}}function li(D,te){if(1&D&&(e.TgZ(0,"td",123),e._uU(1),e.ALo(2,"date"),e.qZA()),2&D){const a=e.oxw().$implicit;e.xp6(1),e.hij("",e.xi3(2,1,a.MFGDATE,"dd-MM-yyyy")," ")}}function di(D,te){if(1&D&&(e.TgZ(0,"td",124),e._uU(1),e.ALo(2,"date"),e.qZA()),2&D){const a=e.oxw(),d=a.$implicit;e.MGl("id","expdate",a.index,""),e.xp6(1),e.hij("",e.xi3(2,2,d.EXPDATE,"dd-MM-yyyy")," ")}}const hi=function(){return{width:"22%"}};function ui(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"tbody",57)(1,"tr",58),e.NdJ("click",function(){const g=e.CHM(a).index,N=e.oxw();return e.KtG(N.RowClick(g))})("keydown.Shift.delete",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.deleteRow())}),e.TgZ(2,"td",59),e._uU(3),e.qZA(),e.YNc(4,Qe,2,1,"td",60),e.YNc(5,Vt,2,4,"td",61),e.TgZ(6,"td",62)(7,"input",63),e.NdJ("ngModelChange",function(d){const N=e.CHM(a).$implicit;return e.KtG(N.ITEMDESC=d)})("keydown.enter",function(d){const N=e.CHM(a).index,ne=e.oxw();return ne.ItemkeyEvent(N,d),e.KtG(ne.displayProductDetailInViewMode(ne.event))})("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.onClicked())}),e.qZA(),e.TgZ(8,"span",64),e._uU(9,"Press ENTER to Select Item"),e.qZA(),e.ynx(10),e._UZ(11,"br")(12,"span",65),e.BQk(),e.qZA(),e.YNc(13,Ut,5,3,"td",66),e.YNc(14,Kt,3,4,"td",67),e.YNc(15,He,2,4,"td",68),e.YNc(16,Zt,2,3,"td",69),e.TgZ(17,"td",70)(18,"input",71),e.NdJ("ngModelChange",function(d){const N=e.CHM(a).$implicit;return e.KtG(N.ALTRATE=d)})("change",function(){const d=e.CHM(a),g=d.$implicit,N=d.index,ne=e.oxw();return e.KtG(ne.MRPChangeEvent(g,N))})("keydown.Tab",function(){const d=e.CHM(a),g=d.$implicit,N=d.index,ne=e.oxw();return e.KtG(ne.mrpEnterEvent(g,N))})("keydown.enter",function(){const d=e.CHM(a),g=d.$implicit,N=d.index,ne=e.oxw();return e.KtG(ne.mrpEnterEvent(g,N))})("keyup",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.rateChange(d))})("focusout",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.rateFocusOut(d))}),e.ALo(19,"twoDigitNumber"),e.qZA()(),e.YNc(20,Ft,3,4,"td",72),e.YNc(21,Qt,3,4,"td",73),e.YNc(22,Ht,3,4,"td",73),e.YNc(23,Gt,3,3,"td",74),e.YNc(24,Yt,3,4,"td",75),e.YNc(25,Jt,3,6,"td",75),e.YNc(26,$t,4,5,"td",76),e.YNc(27,zt,3,6,"td",77),e.YNc(28,Xt,3,3,"td",78),e.YNc(29,ei,3,3,"td",79),e.YNc(30,$e,3,4,"td",75),e.YNc(31,ti,3,6,"td",75),e.YNc(32,ii,3,3,"td",80),e.YNc(33,ni,3,3,"td",81),e.YNc(34,ri,3,4,"td",82),e.YNc(35,ze,3,6,"td",82),e.YNc(36,oi,3,4,"td",83),e.YNc(37,si,6,3,"td",84),e.YNc(38,ai,2,4,"td",85),e.YNc(39,ci,2,4,"td",85),e.YNc(40,li,3,4,"td",86),e.YNc(41,di,3,5,"td",87),e.qZA()()}if(2&D){const a=te.$implicit,h=te.index,d=e.oxw();e.xp6(1),e.ekj("selected",d.isTableRowSelected(h))("highlighted",h+1==d.highlightBarCodeWiseRow())("bgforlessstockitem",d.highlightLessStockItem(h)),e.xp6(1),e.MGl("id","sno",h,""),e.xp6(1),e.Oqu(h+1),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("BARCODE_HEADER",h)),e.xp6(1),e.Q6J("ngStyle",3==d._trnMainService.TrnMainObj.VoucherType||89==d._trnMainService.TrnMainObj.VoucherType||74==d._trnMainService.TrnMainObj.VoucherType||31==d._trnMainService.TrnMainObj.VoucherType?e.DdM(49,hi):null),e.xp6(1),e.MGl("id","itemDesc",h,""),e.Q6J("readonly",d.ReadOnlyForDescription(h))("ngModel",a.ITEMDESC)("disabled",d.disableItemDesc(h)||d.disableGridForReqApproval(h)),e.xp6(5),e.Q6J("innerHtml",a.VARIANTDESCA,e.oJD),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("BATCH_EDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("UNIT_EDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("QUANTITY_EDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("FCRATE_EDITABLE",0)),e.xp6(1),e.Q6J("hidden",89==d._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.MGl("id","rate",h,""),e.Q6J("ngModel",d.applyPipeInRate?e.lcZ(19,47,a.ALTRATE):a.ALTRATE)("disabled",d.disableRateandDiscount(h))("readonly",d.disableRate()),e.xp6(2),e.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16==d._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType||57==d._trnMainService.TrnMainObj.VoucherType||64==d._trnMainService.TrnMainObj.VoucherType||73==d._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==d.activeurlpath),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("CONFACTOR",0)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("ECS_AMOUNT",0)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_PER_EDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE",h)),e.xp6(1),e.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16===d._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE_VATINCLU",h)),e.xp6(1),e.Q6J("ngIf",14!==d._trnMainService.TrnMainObj.VoucherType&&16!==d._trnMainService.TrnMainObj.VoucherType&&57!=d._trnMainService.TrnMainObj.VoucherType&&64!=d._trnMainService.TrnMainObj.VoucherType&&74!=d._trnMainService.TrnMainObj.VoucherType&&89!=d._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=d.activeurlpath&&3!=d._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",6===d.pType),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",h)),e.xp6(1),e.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType&&1==d.userSetting.EnableServiceCharge),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("GST_AMT_NONEDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.showNetAmtNonEditable()),e.xp6(1),e.Q6J("ngIf",d.showNetAmtEditable()),e.xp6(1),e.Q6J("ngIf",(3==d._trnMainService.TrnMainObj.VoucherType||37==d._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=d._trnMainService.TrnMainObj.AdditionalObj.tag),e.xp6(1),e.Q6J("ngIf",d.approvalFlag),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("MFGDATE_EDITABLE",h)&&"consumption-entry"!==d.activeurlpath),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("EXPDATE_EDITABLE",h)&&"consumption-entry"!==d.activeurlpath),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("MFGDATE_NONEDITABLE",h)),e.xp6(1),e.Q6J("ngIf",d.ShowProductInsertTableColumns("EXPDATE_NONEDITABLE",h))}}function pi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"tr",133),e.NdJ("click",function(){const g=e.CHM(a).$implicit,N=e.oxw(2);return e.KtG(N.selectProductDetails(g))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()}if(2&D){const a=te.$implicit;e.xp6(2),e.Oqu(a.color),e.xp6(2),e.Oqu(a.size),e.xp6(2),e.Oqu(a.imeI1),e.xp6(2),e.Oqu(a.imeI2)}}function _i(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div")(1,"div",125)(2,"div",126)(3,"div")(4,"div")(5,"div",127)(6,"h4",128),e._uU(7,"Product Details"),e.qZA(),e.TgZ(8,"button",39),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.closeProductDetails())}),e.TgZ(9,"span",40),e._uU(10,"\xd7"),e.qZA()()(),e.TgZ(11,"div",129)(12,"table",130)(13,"thead")(14,"tr",131)(15,"th"),e._uU(16,"Color Group"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Size Group"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"IMEI 1"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"IMEI 2"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,pi,9,4,"tr",132),e.qZA()()()()()()()()}if(2&D){const a=e.oxw();e.xp6(24),e.Q6J("ngForOf",a.selectedProductDetails)}}function Ti(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div",134)(1,"PItemList",135),e.NdJ("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.dblClickPopupItem(d))})("itemCloseClick",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.model1Closed())}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("title",a.masterService.PlistTitle)}}function Mi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div",136)(1,"PBatchList",137),e.NdJ("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.dblClickPopupBatch(d))})("BatchClosedClick",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.model1Closed())})("returnBatchValue",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.returnBatch(d))}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("AlternateUnits",a.AlternateUnits)("activerowIndex",a.activerowIndex)("title",a.masterService.PlistTitle)("BList",a.batchlist)("voucherType",a._trnMainService.TrnMainObj.VoucherType)("activeurlpath",a.activeurlpath)}}function mi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div",136)(1,"PSalesSchemeList",138),e.NdJ("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.dblClickPopupScheme(d))})("schemeCloseClick",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.schemepopupClosed())}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("schemeList",a.schemeList)}}function gi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div",136)(1,"popPartyChoose",139),e.NdJ("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.dblClickPopupParty(d))})("partyCloseClick",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.partypopunpClosed())}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("partyList",a._trnMainService.partyList)}}function vi(D,te){1&D&&(e.TgZ(0,"th",159),e._uU(1,"CURRENT WS-PRICE"),e.qZA())}function ot(D,te){1&D&&(e.TgZ(0,"th",160),e._uU(1,"NEW WS-PRICE"),e.qZA())}function Si(D,te){if(1&D&&(e.TgZ(0,"td",162),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&D){const a=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,a.WSRATE_A)," ")}}function fi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"td",162)(1,"input",164),e.NdJ("change",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw(2);return e.KtG(N.onChangePurchasePrice(g,d))})("ngModelChange",function(d){e.CHM(a);const g=e.oxw().$implicit;return e.KtG(g.WNRATE_A=d)})("keydown.enter",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw(2);return e.KtG(N.onChangePurchasePrice(g,d))})("keydown.Tab",function(d){e.CHM(a);const g=e.oxw().index,N=e.oxw(2);return e.KtG(N.onChangePurchasePrice(g,d))}),e.qZA()()}if(2&D){const a=e.oxw(),h=a.index,d=a.$implicit,g=e.oxw(2);e.xp6(1),e.MGl("id","newWholeSellingPrice",h,""),e.Q6J("ngModel",d.WNRATE_A)("disabled","VIEW"==d.rowMode||d.isPurchaseOrderItem||g._trnMainService.TrnMainObj.ProdList[g.activerowIndex].BASEUNIT!=d.UNIT)}}function Oi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"tbody")(1,"tr",161)(2,"td",162),e._uU(3),e.qZA(),e.TgZ(4,"td",162),e._uU(5),e.ALo(6,"twoDigitNumber"),e.qZA(),e.YNc(7,Si,3,3,"td",163),e.TgZ(8,"td",162)(9,"input",164),e.NdJ("change",function(d){const N=e.CHM(a).index,ne=e.oxw(2);return e.KtG(ne.onChangePurchasePrice(N,d))})("ngModelChange",function(d){const N=e.CHM(a).$implicit;return e.KtG(N.NRATE_A=d)})("keydown.enter",function(d){const N=e.CHM(a).index,ne=e.oxw(2);return e.KtG(ne.onChangePurchasePrice(N,d))})("keydown.Tab",function(d){const N=e.CHM(a).index,ne=e.oxw(2);return e.KtG(ne.onChangePurchasePrice(N,d))}),e.qZA()(),e.YNc(10,fi,2,3,"td",163),e.qZA()()}if(2&D){const a=te.$implicit,h=te.index,d=e.oxw(2);e.xp6(3),e.hij(" ",a.UNIT," "),e.xp6(2),e.hij(" ",e.lcZ(6,7,a.CRATE_A)," "),e.xp6(2),e.Q6J("ngIf",1==d.userSetting.ENABLEWSALESRATEBILLING),e.xp6(2),e.MGl("id","newSellingPrice",h,""),e.Q6J("ngModel",a.NRATE_A)("disabled","VIEW"==a.rowMode||a.isPurchaseOrderItem||d._trnMainService.TrnMainObj.ProdList[d.activerowIndex].BASEUNIT!=a.UNIT),e.xp6(1),e.Q6J("ngIf",1==d.userSetting.ENABLEWSALESRATEBILLING)}}function bi(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div",140)(1,"div",141)(2,"div",142)(3,"h4",143),e._uU(4,"Selling Price Setting "),e.qZA()(),e.TgZ(5,"div",144)(6,"div")(7,"h5",143),e._uU(8,"Cost Price has been changed.Please reset you new Selling Price"),e.qZA(),e._UZ(9,"hr",145),e.qZA(),e.TgZ(10,"div",42)(11,"label"),e._uU(12,"Label MRP:"),e.qZA(),e.TgZ(13,"input",146),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g._trnMainService.TrnMainObj.ProdList[g.activerowIndex].LABELMRP=d)}),e.qZA()(),e.TgZ(14,"fieldset")(15,"legend",147),e._uU(16,"New Selling Price Setting"),e.qZA(),e.TgZ(17,"table",130)(18,"thead")(19,"tr",148)(20,"th",149),e._uU(21,"UOM"),e.qZA(),e.TgZ(22,"th",150),e._uU(23,"CURRENT S-PRICE "),e.qZA(),e.YNc(24,vi,2,0,"th",151),e.TgZ(25,"th",152),e._uU(26,"NEW S-PRICE"),e.qZA(),e.YNc(27,ot,2,0,"th",153),e.qZA()(),e.YNc(28,Oi,11,9,"tbody",96),e.qZA(),e.TgZ(29,"div",42)(30,"div",154)(31,"h6"),e._uU(32),e.qZA()(),e.TgZ(33,"div",155),e._UZ(34,"div",156),e.qZA()()(),e.TgZ(35,"button",157),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.onApplyClickNewPrice())})("keydown.enter",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.onApplyClickNewPrice())}),e._uU(36," APPLY "),e.qZA(),e.TgZ(37,"button",158),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.onApplyOldPriceClick())})("keydown.enter",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.onApplyOldPriceClick())}),e._uU(38," APPLY OLD S-PRICE "),e.qZA()()()()}if(2&D){const a=e.oxw();e.xp6(13),e.Q6J("ngModel",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].LABELMRP),e.xp6(11),e.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),e.xp6(3),e.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngForOf",a._trnMainService.priceChangeList),e.xp6(4),e.hij(" Recommended Margin: ",a._trnMainService.selectedProdcutRecMargin,"%")}}function Ci(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h5",128),e._uU(5,"Discount authorization"),e.qZA(),e.TgZ(6,"button",39),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.closeModal())}),e.TgZ(7,"span",40),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",41)(10,"div",167)(11,"label",168),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",169)(14,"input",170),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.disAuthObj.username=d)}),e.qZA()()(),e.TgZ(15,"div",167)(16,"label",168),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",169)(19,"input",171),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.disAuthObj.password=d)}),e.qZA()()(),e.TgZ(20,"div",167)(21,"label",168),e._uU(22,"Discount:"),e.qZA(),e.TgZ(23,"div",172)(24,"input",173),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.disAuthObj.discount=d)}),e.qZA()(),e.TgZ(25,"div",174)(26,"a"),e._uU(27,"% \xa0"),e.qZA()()(),e.TgZ(28,"div",175)(29,"fieldset",176)(30,"legend",177),e._uU(31,"Discount authorization remarks:"),e.qZA(),e.TgZ(32,"textarea",178),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.disAuthObj.remarks=d)}),e.qZA()()()(),e.TgZ(33,"div",179)(34,"button",180),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.discountAuthConfirm())}),e._uU(35,"Confirm"),e.qZA()()()()()}if(2&D){const a=e.oxw();e.xp6(14),e.Q6J("ngModel",a.disAuthObj.username),e.xp6(5),e.Q6J("ngModel",a.disAuthObj.password),e.xp6(5),e.Q6J("ngModel",a.disAuthObj.discount),e.xp6(8),e.Q6J("ngModel",a.disAuthObj.remarks)}}function Ai(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div")(1,"itemwisebatch",181),e.NdJ("BatchClosedEmit",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.BatchPopupClosed())})("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.dblClickPopupBatchs(d))}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ei(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div")(1,"itemwisebatch",181),e.NdJ("BatchClosedEmit",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.AdjustPopupClosed())})("dbClickEvent",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g.DblClickPopupAdjust(d))}),e.qZA()()}if(2&D){const a=e.oxw();e.xp6(1),e.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ii(D,te){if(1&D){const a=e.EpF();e.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h6",128),e._uU(5,"Authorization for Negative Stock Entry"),e.qZA(),e.TgZ(6,"button",39),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.closeModal())}),e.TgZ(7,"span",40),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",41)(10,"div",167)(11,"label",168),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",169)(14,"input",170),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g._trnMainService.disAuthObj.username=d)}),e.qZA()()(),e.TgZ(15,"div",167)(16,"label",168),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",169)(19,"input",171),e.NdJ("ngModelChange",function(d){e.CHM(a);const g=e.oxw();return e.KtG(g._trnMainService.disAuthObj.password=d)}),e.qZA()()()(),e.TgZ(20,"div",179)(21,"button",180),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.confirmAuthorization())}),e._uU(22,"Confirm"),e.qZA(),e.TgZ(23,"button",182),e.NdJ("click",function(){e.CHM(a);const d=e.oxw();return e.KtG(d.closeModal())}),e._uU(24,"Cancel"),e.qZA()()()()()}if(2&D){const a=e.oxw();e.xp6(14),e.Q6J("ngModel",a._trnMainService.disAuthObj.username),e.xp6(5),e.Q6J("ngModel",a._trnMainService.disAuthObj.password)}}const Pi=function(){return{width:"28%"}},yi=function(){return{width:"25%"}},Ge=function(){return{width:"24%"}},xi=function(){return{width:"40%"}},Ri=function(){return{backdrop:"static"}};let Ni=(()=>{class D{constructor(a,h,d,g,N,ne,he,Ce,Le,Ee,Ie,Be,Ye,Xe){this.masterService=a,this._trnMainService=h,this.setting=d,this.dialog=g,this.fb=N,this.arouter=ne,this.alertService=he,this.authservice=Ce,this.changeDetection=Le,this.loader=Ee,this.validationService=Ie,this.responseMsgService=Be,this.userRightAuthService=Ye,this.focusService=Xe,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.TotalBill=new e.vpe,this.gridPopupSettingsForSupplier=new O.im,this.barcodeGridSettings=new O.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new e.vpe,this.onChangeProductionItem=new e.vpe,this.indexEmit=new e.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new O.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInQuantity=!0,this.applyPipeInSprice=!0,this.mfgExpDateType="month",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=et=>{let Oe=Object.assign({},this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),st=[],at=0;for(var be of(console.log("vardata",et),et))if(Oe.VaraintDetailS=[],this.masterService.nullToZeroConverter(be.QTY)>0){let it="";Oe.VARIANTDESCA="";var ct={};for(var Ke in be)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Ke)&&(it+=be[Ke].VARIANTBARCODE,Oe.VARIANTDESCA=Oe.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Ke)}</b>:${be[Ke].NAME} &nbsp;`,ct[be[Ke].VARIANTNAME]=be[Ke].NAME);Oe.VaraintDetailS.push(ct),Oe.VARIANTLIST=be,Oe.BC=be.BARCODE?be.BARCODE:Oe.MCODE+it,Oe.Quantity=be.QTY,Oe.MRP=be.MRP,Oe.ALTMRP=be.MRP,Oe.REALQTY_IN=be.QTY,Oe.ALTERNATEQUANTIY=be.QTY,Oe.AltQty=be.QTY,Oe.PRATE=be.PRATE,Oe.RATE=be.PRATE,Oe.REALRATE=be.PRATE,Oe.ALTRATE=be.PRATE,Oe.SPRICE=be.SRATE,Oe.SellingPrice=be.SRATE,Oe.ALTRATE2=be.SRATE,this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry&&(Oe.SELLRATEBEFORETAX=be.SRATE),Oe.BATCH=`-${at}`,st.push(Object.assign({},Oe)),at++}let tt=this._trnMainService.TrnMainObj.ProdList.slice(0,this.activerowIndex),Li=this._trnMainService.TrnMainObj.ProdList.slice(this.activerowIndex+1);for(var wi of(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex),st))tt.push(wi);for(var Di of Li)tt.push(Di);this._trnMainService.TrnMainObj.ProdList=tt,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)},this.hoverId=null,this.stringValue="",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),this.AppMode=C.N.appMode,1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this._trnMainService.TrnMainObj.VoucherType&&(this.AppSettings=d.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&(this.showDiscount=!1),a.ShowMore=!0}catch{}this.activeurlpath=ne.snapshot.url[0].path,this.form=this.fb.group({demoArray:this.fb.array([])}),this._trnMainService.TrnMainObj.CHALANNO=""}ngAfterContentChecked(){this.changeDetection.detectChanges()}updown(a){"ArrowRight"===a.code&&a.preventDefault(),"ArrowLeft"===a.code&&a.preventDefault(),("ArrowDown"==a.code||"ArrowUp"==a.code)&&a.preventDefault(),"F2"===a.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F5"===a.code&&(a.preventDefault(),this.petrolPopup(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])),"F7"==a.code&&(a.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===a.code&&(a.preventDefault(),this._trnMainService.inputCode&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.length>0&&this.dialougeOpen()),"F11"==a.code&&a.ctrlKey&&(a.preventDefault(),this._trnMainService.barCodes.BC||null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&this.checkBatchWiseRate()),"Escape"==a.code&&(a.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}ngAfterViewInit(){console.log("type",this._trnMainService.TrnMainObj.VoucherType)}model1Closed(){this.masterService.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;this.arrayItems=[],console.log("ptype",this.pType)}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(a=>{this.colorLists=a&&a.result?a.result:[]})}get demoArray(){return this.form.get("demoArray")}addItem(a){this.arrayItems.push(a),this.demoArray.push(this.fb.control(!1))}removeItem(){this.arrayItems.pop(),this.demoArray.removeAt(this.demoArray.length-1)}RowClick(a){this.activerowIndex=this.rowIndex=a,this.masterService.ShowMore=!1,console.log("row click",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(a)}descriptionEditOnRowClick(a){this._trnMainService.allowDescriptionEdit=1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let a=0;if(a=this._trnMainService.TrnMainObj.ProdList.length-1,this._trnMainService.TrnMainObj.ProdList&&null!=this._trnMainService.TrnMainObj.ProdList[0].MENUCODE)return this._trnMainService.TrnMainObj.ProdList.findIndex(d=>d.BC==this._trnMainService.barCodes.BC&&0==d.FulfillBatchQty)+1}highlightLessStockItem(a){return this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.ProdList[a].MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this._trnMainService.TrnMainObj.ProdList[a].APPROVEDALTQTY}showPOQtyRate(a){this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this._trnMainService.TrnMainObj.ProdList[a].POSTOCK,this._trnMainService.purchaseOrderRate=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE,this._trnMainService.produstWiseOrderUnit=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT)}openDialog(a){this.selectedIndex=a}ItemBarCodeClick(a,h){if(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType!=t.Km.ProductionEntry||this._trnMainService.TrnMainObj.BILLTO){if(!this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&"NEW"!==this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&"PI"===this._trnMainService.TrnMainObj.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this._trnMainService.TrnMainObj.Mode||"EDIT"===this._trnMainService.TrnMainObj.Mode)&&6===this._trnMainService.TrnMainObj.ProdList[a].Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC)1==this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix&&(this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this._trnMainService.TrnMainObj.ProdList[a]={}},0)),null!=document.getElementById("itemDesc"+a)&&setTimeout(()=>{document.getElementById("itemDesc"+a).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this._trnMainService.TrnMainObj.VoucherType!==t.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.SalesReturn){let d=this._trnMainService.TrnMainObj.ProdList.filter(N=>N.BC==this._trnMainService.TrnMainObj.ProdList[a].BC);if(null!=d&&d?.length>1)return this.alertService.info(`Duplicate barcode:${this._trnMainService.TrnMainObj.ProdList[a].BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(N=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)});this._trnMainService.TrnMainObj.ProdList.filter(N=>6==N.PTYPE).forEach(N=>N.ProductDetails?.forEach(ne=>{if(ne.IEMI1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)return this.alertService.info(`Duplicte IMEI1 :${ne.IEMI1} is found on Bulk Entry Grid`),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=null,!1}))}this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.REFBILL).subscribe(d=>{"ok"==d.status?(this._trnMainService.ReturnStockObj=d.result,this.loadBarcodeWiseProductList(d.result.TotalStock)):(this.alertService.info(d.result),this.alertService.emitShowHideSubject.subscribe(g=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)}))},d=>{this.alertService.info(d.result)}):this._trnMainService.checkBarcode(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(d=>{"ok"==d.status?this.loadBarcodeWiseProductList():this.alertService.info(d.result)},d=>{this.alertService.info(d.result)}))}}else this.alertService.info("Please select Production warehouse")}heightChange(){let a;return this.masterService.ShowMore?this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionApproval?(a=64,(this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=66)):this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry?a=67:this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder?a=61:this._trnMainService.TrnMainObj.VoucherType===t.Km.BatchAdjustment?a=72:this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice?(a=48,this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=51)):a=this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferIn?70:this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||1!==this.masterService.userSetting.GblBarcodeWiseBilling?55:49:a=(this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling?75:(this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote)&&1==this.masterService.userSetting.GblBarcodeWiseBilling?72:81,a}onChangeBarCode(a){}ItemkeyEvent(a,h){if(h.preventDefault(),this.activerowIndex=a,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this._trnMainService.TrnMainObj.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(d=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(d=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});console.log("Check Tna",this._trnMainService.TrnMainObj.TRNACName,this._trnMainService.TrnMainObj.REMARKS),this.showStockedQuantityOnly=0}else this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE??""):this.showStockedQuantityOnly=0;if(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&1!==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI){if(!this._trnMainService.TrnMainObj.REFORDBILL){let d=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(d),!1}}else if(null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else{let g,d="";"self-billing"===this.activeurlpath?d="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(d=this._trnMainService.TrnMainObj.VoucherPrefix);let N="";N=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,((0,J.isNullOrUndefined)(g)||0==this.userSetting.GblBarcodeWiseBilling||null==g||void 0===g||""==g)&&(g="A"),this.productListInGenericPopup(a,g,d,N)}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE){let d="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(d=this._trnMainService.TrnMainObj.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}return this._trnMainService.itemselectevent=!0,console.log("credinote",this._trnMainService.TrnMainObj.DOMANUALSALESRETURN),this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote?this._trnMainService.TrnMainObj.REFBILL:""),!1}this.displayProductDetailInViewMode(h)}}productListInGenericPopup(a,h,d,g){if(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let N=this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC;N&&""!=N?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+a).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${h}/all/${d}/${g}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${h}/all/${d}/${g}`}displayProductDetailInViewMode(a){console.log("eventlog",a),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==a.code&&this.dialougeOpen()}onChangeExpDate(){}loadBarcodeWiseProductList(a=0){this.loadFromBarcode=!1;let d=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(N=>{if("ok"===N.status)if(d=N.result.data,0===d.length)this.alertService.info("Product is out of Stock ");else if(1===d.length){this.loadFromBarcode=!0;var ne=d[0];if(this._trnMainService.CheckIfSalesReturn()){ne.STOCK=a;var he=0;for(let Ee of this._trnMainService.TrnMainObj.ProdList)Ee.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(he+=Ee.ALTERNATEQUANTIY);if(ne.STOCK<he)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(ne),this.loadFromBarcode=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",ne.barcodeDetails){var Ce=JSON.parse(ne.barcodeDetails);for(var Le in console.log("varDetail",Ce),Ce)this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${Le}</b>:${Ce[Le]} &nbsp;`}}else console.log("response data > 1",this.gridPopupSettings),this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(N.result.error)})}checkDuplicatProductWithBarcode(){let a=[];return a=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.BARCODE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE),a.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}checkBatchWiseRate(){this.batchlist=[];let a=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this.activeurlpath&&(a="SF");let h="";h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE;let d="";d=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${h}&voucherPrefix=${a}&warehouse=${d}&barcode=`).subscribe(g=>{"ok"===g.status&&(this.batchlist=g.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===g.message&&(this.changeBatchWiseRate(g.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(g.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=g.result[0].costprice),"SHOWPRICEPOPUP"===g.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!"))})}checkBatchWiseRateSettingZero(){console.log("check batch wise rate for setting"),this.batchlist=[];let h="",d="";h=this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,d=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${h}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${d}&barcode=`).subscribe(g=>{"ok"===g.status&&(this.batchlist=g.result,"SHOWPRICEPOPUP"===g.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(a){(this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(a)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):a,this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(a){null!=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.filter(d=>1==d.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(a){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a[0].MFGDATE?"":a[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a[0].EXPDATE?"":a[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a[0].BATCH)}batchWiseSalesRateBeforeTax(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a)}batchWiseStockTax(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.map(h=>h.STOCK).reduce((h,d)=>h+d,0))}BatchTabClick(a,h){if(console.log("BATCH TAB CLICK called"),h?.preventDefault(),this.activerowIndex=a,(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH||null==this._trnMainService.TrnMainObj.ProdList[a]||null==this._trnMainService.TrnMainObj.ProdList[a].MCODE||""===this._trnMainService.TrnMainObj.ProdList[a].MCODE)return!1;let d=this._trnMainService.userProfile.userWarehouse;return this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&(d=this._trnMainService.TrnMainObj.BILLTO),this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||0!=this._trnMainService.prodListForUnfinedBill||"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote||this.masterService.masterPostmethod("/getBatchListOfItem",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE,onlynonexpireditem:this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice?1:0,voucherprefix:this._trnMainService.TrnMainObj.VoucherPrefix,warehouse:d}).subscribe(g=>{"ok"==g.status?(console.log("Reus",g),this.batchlist=JSON.parse(g.result),1==this.batchlist.length?this.masterService.PlistTitle="Batch Price Selection":0==this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?alert("Rate not Detected!"):0==this.batchlist.length&&"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||(this.masterService.PlistTitle="Batch Price Selection")):console.log("error on getting BatchListOfItem "+g.result)},g=>{console.log("error on getting BatchListOfItem ",g)}),!1}onKeydownOnBatch(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||"Enter"===a.key||"Tab"===a.key||a.preventDefault()}assignedSchemeToBatch(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME;if(null!=a)if(null==a.batches||""===a.batches)this.batchlist.forEach(h=>{h.SCHEME=a,h.SCHEMERATE=a.schemeDisRate,h.SCHEMENAME=a.schemeName,h.SchemeRateType=a.discountRateType});else{let h=a.batches.toString().split(",");this.batchlist.forEach(d=>{null!=h.find(g=>g===d.BATCH)&&(d.SCHEME=a,d.SCHEMERATE=a.schemeDisRate,d.SCHEMENAME=a.schemeName,d.SchemeRateType=a.discountRateType)})}}ReturnedSchemeValue(){}BatchEnter(a,h){h.preventDefault();let d=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=h.LANDINGCOST,2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&d in t.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(console.log("rn"),this.checkBatchWiseRate()),null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){console.log("entewews"),this.batchList=[];let g=this._trnMainService.TrnMainObj.ProdList[a].MCODE,N=this.masterService.userProfile.userWarehouse;g&&this.masterService.getItemWiseBatch(g,N).subscribe(ne=>{console.log("get batch list",ne),"ok"==ne.status&&(this.batchList=ne.result.filter(he=>he.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}PstockEnter(a,h){h.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==t.Km.Stockadjustment&&document.getElementById("computerStock"+a).focus()}CstockEnter(a,h){h.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==t.Km.Stockadjustment&&document.getElementById("alternateqty"+a).focus()}AdjustBatchEnter(a){if(this._trnMainService.TrnMainObj.VoucherType=t.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let h=this._trnMainService.TrnMainObj.ProdList[a].MCODE,d=this.masterService.userProfile.userWarehouse;h&&this.masterService.getAdjustingBatch(h,d).subscribe(g=>{console.log("get batch list",g),"ok"==g.status&&(this.batchList=g.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(a){this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCHID=a.BATCHID)),this.checkDuplicateSourceBarcode(a.BATCHCODE)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BC),this.showBatchPopup=!1,this.masterService.focusAnyControl("alternateQty"+this.activerowIndex))}checkDuplicateSourceBarcode(a){return!a||!this._trnMainService.TrnMainObj.ProdList.find(h=>h.BATCH==a)||(this.alertService.info(`Batch ${a} is already selected as a source barcode.`),!1)}DblClickPopupAdjust(a){a.BATCHCODE!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INVRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MANUFACTURER=a.BATCHID),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBC=a.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}prepareProductDetails(){let h={color:""};h.quantity=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,h.IEMI1=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE,h.IEMI2="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(h)}selectProductDetails(a){let h=[];h=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(h),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,vchrno:this._trnMainService.TrnMainObj.REFBILL}).subscribe(h=>{h&&"ok"===h.status?(this.isProductDetailView=!0,this.selectedProductDetails=h.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},h=>{this.selectedProductDetails=[]})}dblClickPopupScheme(a){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME=a,this.assignedSchemeToBatch(),null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}discEnterClicked(a,h){return this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOFULLRETURN?0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(a)):document.getElementById("mfgdate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice?1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder?document.getElementById("remarks"+a).focus():this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?this.checkValidation(a):document.getElementById("mfgdate"+a).focus(),!1}approvedQtyEnter(a){console.log("hit while change");let d=this._trnMainService.TrnMainObj.ProdList[a];if(this.validationService.checkStockforApprovalQty(d)&&!d.isConfirmed){console.log("reach");let g=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(g,"ReqApproval")}d.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(d,a)&&setTimeout(()=>{null!=document.getElementById("remarks"+a)&&document.getElementById("remarks"+a).focus()},50),this.validationService.validateStockinReqApproval(d,a,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(a){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales){let h=this.masterService.userProfile.roleRights.find(d=>"DISLIMIT"==d.right);console.log("disLimt on discount rate",h),h&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>h?.value&&(this.alertService.warning("Discount limit of :"+h.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let h=this.masterService.userProfile.userRights.find(d=>"SODiscountLimit"==d.right);h&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>h?.value&&(this.alertService.warning("Discount limit for sales order ("+h.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():document.getElementById("remarks"+a).focus()},0)}))}return(this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&(console.log("DISCOUNT",this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?this._trnMainService.TrnMainObj.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder?document.getElementById("discountAmt"+a).focus():(console.log("reach12"),this.checkValidation(a)):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"purchase-import"==this.activeurlpath?document.getElementById("discountAmti"+a).focus():null!=document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():null!=document.getElementById("discountAmti"+a)&&document.getElementById("discountAmti"+a).focus():(console.log("quoatioin enter"),this._trnMainService.TrnMainObj.VoucherType==t.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+a).focus():document.getElementById("mfgdate"+a).focus())),!1}checkValidation(a){console.log("reached cehck validation");var h=this._trnMainService.TrnMainObj.ProdList[a];if(null!=h){if(null==h.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&0==h.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${h.ITEMDESC} (${h.MENUCODE}) Please Check Your Entry.`),!1}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&"self-billing"!=this.activeurlpath){var d=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(N=>0==N.ISUNKNOWN),function(N){return[N.MCODE,N.RATE,N.BC]});for(const N of d)if(N.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry){let N=this._trnMainService.TrnMainObj.ProdList.filter(ne=>1==ne.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(ne.EXPDATE))[0];if(null!=N&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${N.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+a).focus(),!1;if((this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[a].Quantity>this._trnMainService.TrnMainObj.ProdList[a].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[a].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this._trnMainService.TrnMainObj.ProdList[a].PTYPE<10)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():this._trnMainService.ReCalculateBillWithNormal(),!this._trnMainService.TrnMainObj.ProdList.some(N=>null==N.MCODE)&&!1===this._trnMainService.addRow())return;let g=a+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("barcode"+g)?(console.log("rn1"),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote?(document.getElementById("itemDesc"+g).focus(),this.resetDescriptionEdit()):document.getElementById("barcode"+g).focus()):document.getElementById("itemDesc"+g).focus()},50):setTimeout(()=>{null!=document.getElementById("itemDesc"+g)&&(document.getElementById("itemDesc"+g).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+g)&&document.getElementById("itemDesc"+g).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}onChangeColor(){}returnBatch(a){if("self-billing"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.filter(g=>g.BATCH==a.BATCH&&g.MCODE==a.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.assignBatchToActiveProdRow(a,this.activerowIndex),this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected=!0,console.log("priceselected",this._trnMainService.TrnMainObj.ProdList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT)for(var h in this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST=a.VARIANTDETAIL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST)console.log("Var attribute",h,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[h]),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${h}</b>:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[h]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack)&&this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)}}dblClickPopupBatch(a){console.log("value ma k aaucha",a),this.returnBatch(a)}QuantityChangeEvent(a){let h=this._trnMainService.TrnMainObj.VoucherType;if(this.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(h in t.SL&&(d=this.ValidateQuantityinEDITMode())&&!d.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d.userEnterQty,void this.alertService.info(d.message);if(h in t.fr){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase())if(!0!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected)this.checkBatchWiseRateinEditMode();else{var d;if((d=this.ValidateQtyEDITModeForOUt())&&!d.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d.userEnterQty,void this.alertService.info(d.message)}else if((d=this.ValidateQtyEDITModeForOUt())&&!d.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d.userEnterQty,void this.alertService.info(d.message);let N=this.checkItemStockINEditModeForOutQty();if(N&&!N.status)return void this.alertService.info(N.message)}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry&&(console.log("active",g),"EDIT"===g.RowMode.toUpperCase()&&g&&!this.ValidateQtyINEditModeFroProduction(g)))return}if((this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC} cannot have quantity more than one for membership sales invoice`),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(g=>{setTimeout(()=>{null!==document.getElementById("rate"+a)&&document.getElementById("rate"+a).focus()},100)})),this._trnMainService.calculateNetRATE(a),this._trnMainService.ReCalculateBillWithNormal(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry&&this.onChangeProductionItem.emit(),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&"lite"==this._trnMainService.AppMode&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL){console.log("STOCK CHECK IN CN",this._trnMainService.TrnMainObj.ProdList[a]);let g=this._trnMainService.TrnMainObj.ProdList[a];if(g.ALTERNATEQUANTIY>g.STOCK)return this.alertService.warning(`Entered quantity: ${g.ALTERNATEQUANTIY} is greater than issued quantity: ${g.STOCK}`),void(g.ALTERNATEQUANTIY=0)}if(this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,this.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)){if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&this.checkEnteredProductStock(),this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssueReturn){let g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(!this._trnMainService.validateIssueQtyInStockIssueReturn(g.PSTOCK,g.ALTERNATEQUANTIY,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(console.log("activerowinsert",this.activerowIndex),this._trnMainService.allowNegativeBilling(this.activerowIndex)?console.log("check user irghrs here"):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&(console.log("check entered product stock"),this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(console.log("selabel soprodlist",this._trnMainService.TrnMainObj.ProdList),this.checkSaleableQuantityInSalesOrder()),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),((this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&this._trnMainService.TrnMainObj.ProdList[a].Quantity<this._trnMainService.TrnMainObj.ProdList[a].POSTOCK){let g="Quantity is less than PO Stock!! Are you sure you want to proceed further";if((this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&(g="Quantity is less than SO Stock!! Are you sure you want to proceed further"),!confirm(g))return this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,document.getElementById("alternateqty"+a).focus(),void this._trnMainService.ReCalculateBillWithNormal()}if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn)&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseStockOut(),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE}),this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"===this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),h in t.po){let g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,N=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,ne=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT,he=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,Ce=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISUNKNOWN;console.log("activeulr",this.activeurlpath),!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkItemTotalQtyWithStock(g,he,ne,N,this.activerowIndex),"self-billing"!=this.activeurlpath&&this.valiadateDuplicateRateItem(ne,g,N,Ce,this.activerowIndex)}this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(console.log("JJJJJ"),this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n          Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n          @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `))}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}ratechangeEvent(a){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(a){this._trnMainService.calculateNetRATE(a),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=100),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeEvent(a,h){if(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.nullToZeroConverter(h.target.value),console.log("inddiscount",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales){let d=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),g=this.masterService.userProfile.roleRights.find(N=>"DISLIMIT"==N.right);console.log("dis rate",d,"dislimit",g),g&&d>g?.value&&(this.alertService.warning("Discount limit of :"+g.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(N=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if((this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[a].UNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE):(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[a].Quantity),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE)),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let d=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),g=this.masterService.userProfile.userRights.find(N=>"SODiscountLimit"==N.right);console.log(" so dis rate",d,"dislimit",g),g&&d>g?.value&&(this.alertService.warning("Discount limit of :"+g.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(N=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeOfRetailerVATINCEvent(a,h){this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(h.target.value),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT<0?this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=0:this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}discountRateToAmnt(){}QuantityEventClick(a){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)<1||(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived?document.getElementById("alternateunit"+a).focus():(this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote)&&document.getElementById("remarks"+a).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(a){return{status:"error",error:a}}}isTableRowSelected(a){return this.activerowIndex===a}deleteRow(){if("EDIT"==this._trnMainService.TrnMainObj?.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this._trnMainService.TrnMainObj.VoucherType))return;(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}`)}this._trnMainService.TrnMainObj.VoucherType!=t.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")}restrictPercentageNumeric(a,h){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNTRATE=0:(parseFloat(a)>100||isNaN(parseFloat(a)))&&(this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(a,h){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNT=0:parseFloat(a)>this._trnMainService.TrnMainObj.ProdList[h].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[h].AMOUNT)}catch{}}SelectUnit(a,h,d){this._trnMainService.TrnMainObj.ProdList[a].DiscountOnAltUnit=!1,this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[a].CRATE=0;let g=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.find(N=>N.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder?this._trnMainService.TrnMainObj.ProdList[a].BASERATE:this._trnMainService.TrnMainObj.ProdList[a].RATE,this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0):(this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=g.CONFACTOR,0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].BASERATE),this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE-this._trnMainService.TrnMainObj.ProdList[a].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT/100),this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR),console.log("prodlist1",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&this.applyDiscountOnUnitChange(g,a),(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&this.applyDiscountOnUnitChangeOnSales(g,a),this._trnMainService.ReCalculateBillWithNormal()),this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionApproval&&(console.log("something here",this._trnMainService.TrnMainObj.ProdList[a]),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT!=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR:this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY,this.approvedQtyEnter(a),this._trnMainService.CalculateApprovalBill())}applyDiscountOnUnitChange(a,h){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?a.WSRATE_DISCOUNT:a.SRATE_DISCOUNT;else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let d=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?a.SRATE_DISCOUNT:a.WSRATE_DISCOUNT);console.log("discount",d),this._trnMainService.TrnMainObj.ProdList[h].ALTRATE=this._trnMainService.TrnMainObj.ProdList[h].ALTRATE-this._trnMainService.TrnMainObj.ProdList[h].ALTRATE*(d/100)}}applyDiscountOnUnitChangeOnSales(a,h){this._trnMainService.TrnMainObj.ProdList[h].INDDISCOUNTRATE=a.SRATE_DISCOUNT}schemepopupClosed(){this.schemeList=[],document.getElementById("showScheme").style.display="none",null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}returnMultiBatchScheme(a){for(let h of a)this._trnMainService.assignBatchToActiveProdRow(h,this.activerowIndex)}flatDisChange(a){this.flatDiscountValue=a,this.flatDiscountAssign()}flatDiscountUnitChange(a){this.radioFlatDiscount=a,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let a=this._trnMainService.TrnMainObj.ProdList.reduce((h,d)=>h+(this._trnMainService.nullToZeroConverter(d.AMOUNT)-this._trnMainService.nullToZeroConverter(d.INDDISCOUNT)),0);this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue*a/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(a,h){this.showBatchWiseDetail=!1,this.checkValidation(h)||this.masterService.focusAnyControl("remarks"+h)}RemarksEnterCommand(a,h){if(a.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(h)||this.masterService.focusAnyControl("remarks"+h),this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval){let d=h+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+d)&&document.getElementById("alternateunit"+d).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let h="";h=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}&VCHRNO=${this._trnMainService.TrnMainObj.VCHRNO}&warehouse=${h}`).subscribe(d=>{if("ok"===d.status&&(this.batchlist=d.result,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===d.message&&(this.changeBatchWiseRate(d.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=d.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(d.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=d.result[0].costprice),"SHOWPRICEPOPUP"===d.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack&&this.changeBatchWiseRate(d.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){var g=this.ValidateQtyEDITModeForOUt();if(g&&!g.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=g.userEnterQty,void this.alertService.info(g.message)}})}dblClickPricePopUP(a){let h=this._trnMainService.mulitplePriceItemList.filter(Ee=>this._trnMainService.nullToZeroConverter(Ee.qty)>0),d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT,N=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,ne=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE,he=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC,Ce=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AlternateUnits,Le=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR;if(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(Ee=>0!=this._trnMainService.nullToZeroConverter(Ee.ALTERNATEQUANTIY)),null!=h)for(let Ee=0;Ee<h.length;Ee++){let Ie={Product:{}};Ie.MCODE=N,Ie.MENUCODE=ne,Ie.INDDISCOUNT=h[Ee].dcamount,Ie.INDDISCOUNTRATE=h[Ee].dcrate,Ie.ITEMDESC=he,Ie.UNIT=d,Ie.BASEUNIT=g,Ie.RATE=h[Ee].rate,Ie.ALTRATE=h[Ee].rate,Ie.ALTERNATEQUANTIY=h[Ee].qty,Ie.inputMode=!0,Ie.CRATE=h[Ee].netrate,Ie.ALTCONFACTOR=Le,Ie.Product.AlternateUnits=Ce,this._trnMainService.TrnMainObj.ProdList.push(Ie)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(a){console.log("dblclickpar"),null!=a&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TRNAC=a.ACID,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ACNAME=a.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this._trnMainService.TrnMainObj.PARAC=a.ACID,this._trnMainService.TrnMainObj.BILLTO=a.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=a.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=a.VATNO,this._trnMainService.TrnMainObj.BILLTOMOB=a.MOBILE,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=a.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}onKeydownPreventEdit(a){"Enter"===a.key||"Tab"===a.key||a.preventDefault()}batchKeyDownEvent(){return!1}popUpBatchList(){}MFGDateEnterEvent(a){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(a){return this._trnMainService.TrnMainObj.VoucherType==t.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction||this.checkValidation(a)||this.masterService.focusAnyControl("remarks"+a),!1}AlternateUnitEnterEventClick(a,h){h.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&(document.getElementById("alternateqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval&&document.getElementById("approvedQty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==t.Km.Stockadjustment&&document.getElementById("physicalStock"+a).focus()),this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this._trnMainService.TrnMainObj.ProdList[a].BC&&""!=this._trnMainService.TrnMainObj.ProdList[a].BC&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].BC&&document.getElementById("rate"+a).focus(),74==this._trnMainService.TrnMainObj.VoucherType&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&document.getElementById("alternaetqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&document.getElementById("alternateqty"+a).focus()}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discount"+this.activerowIndex).focus(),!1}mrpEnterEvent(a,h){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length&&0==this._trnMainService.TrnMainObj.ProdList[h].ALTUNITObj.RATE_A&&0==this._trnMainService.TrnMainObj.ProdList[h].MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(a,h),console.log("clicktab"),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance)null!=document.getElementById("MRP"+h)?document.getElementById("MRP"+h).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(h):document.getElementById("mfgdate"+h).focus();else if(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(h);else if(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice)"Non-Discountable"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].DISMODE?this.checkValidation(h):null!=document.getElementById("discount"+h)?document.getElementById("discount"+h).focus():document.getElementById("mfgdate"+h).focus();else if(this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(h)}else this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack?this.checkValidation(h):this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(h)):null!=document.getElementById("discount"+h)?document.getElementById("discount"+h).focus():null!=document.getElementById("remarks"+h)?document.getElementById("remarks"+h).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+h).focus());return(this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===t.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(h),this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),!1}setItemPopupUrl(){console.log("set item popup url",this.userSetting.DefaultFilterIndex);let a=!0,h=!0,d=!0,g=!0,N="STOCK",ne=!0,he=!0,Ce=!0,Le=!1,Ee=!0,Ie=!0,Be=!0,Ye=!1;this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssueReturn&&(h=!1),this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(a=!1,d=!1),(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote)&&(g=!1,N="Remaining QTY",Ee=!1,1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(Ee=!0,Ye=!0)),this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(ne=!1,Le=!0),this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE&&(ne=!1),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(he=!1),(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(Be=!0,Ce=!1,Le=!0):(Be=!1,Ce=!0,Le=!0)),this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(Ie=!1),this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:Le,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:a,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:h,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:d,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:g,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:Be,noSearch:!0},{key:"STOCK",title:N,hidden:Ye,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:Ie,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:Ee,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:ne,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:he,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:Ce,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:ne,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:Ce,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:Be,noSearch:!0,alignment:"right",pipe:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}ShowProductInsertTableColumns(a,h){let d=this._trnMainService.TrnMainObj.VoucherType,g={};null!=this._trnMainService.TrnMainObj.ProdList&&(g=this._trnMainService.TrnMainObj.ProdList[h]);let N=!1;switch(a){case"BATCH_HEADER":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(d===t.Km.Purchase||d===t.Km.OpeningStockBalance||d===t.Km.PurchaseReturn||d===t.Km.SalesReturn||d===t.Km.DebitNote)&&(N=!0);break;case"MENUCODE_HEADER":if(1==this.userSetting.GblBarcodeWiseBilling&&(d===t.Km.TaxInvoice||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote||d===t.Km.Sales))return!1;(d===t.Km.Purchase||d===t.Km.ReversePurchase||d===t.Km.DebitNote||d===t.Km.OpeningStockBalance)&&(N=!0);break;case"BARCODE_HEADER":if("self-billing"==this.activeurlpath||0==this.userSetting.GblBarcodeWiseBilling)return!1;(d===t.Km.TaxInvoice||d===t.Km.CreditNote||d===t.Km.Sales||d==t.Km.DebitNote)&&(N=!0);break;case"BATCH_EDITABLE":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(d===t.Km.Sales||d===t.Km.Purchase||d===t.Km.OpeningStockBalance||d===t.Km.DebitNote||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote)&&(N=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(N=!0);break;case"BATCH_NONEDITABLE":((d===t.Km.OpeningStockBalance||d===t.Km.Purchase||d===t.Km.PurchaseReturn||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.Quotation||d===t.Km.GoodsReceived)&&!1===g.inputMode||d===t.Km.CreditNote||d===t.Km.DebitNote||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"MFGDATE_HEADER":case"EXPDATE_HEADER":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(d===t.Km.ReversePurchase||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"MFGDATE_EDITABLE":case"EXPDATE_EDITABLE":if(0==this.userSetting.EnableBatch)return!1;d===t.Km.ReversePurchase&&(N=!0);break;case"MFGDATE_NONEDITABLE":case"EXPDATE_NONEDITABLE":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"QUANTITY_EDITABLE":(d===t.Km.OpeningStockBalance||d===t.Km.PurchaseReturn||d===t.Km.ReversePurchase||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.CreditNote||d===t.Km.DebitNote||d===t.Km.Purchase||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"QUANTITY_NONEDITABLE":(d===t.Km.OpeningStockBalance||d===t.Km.Purchase||d===t.Km.PurchaseReturn||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote||d===t.Km.DebitNote||this._trnMainService.showPerformaApproveReject)&&!1===g.inputMode&&(N=!0);break;case"MRP_NONEDITABLE":case"UNIT_EDITABLE":default:N=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"CONFACTOR":break;case"GST_AMT_NONEDITABLE":(d===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.PurchaseReturn||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoice||d===t.Km.TaxInvoiceCancel||d===t.Km.CreditNote||d===t.Km.DebitNote||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"COSTPRICE_HEADER":d===t.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||d===t.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||d===t.Km.CreditNote||d===t.Km.OpeningStockBalance||d===t.Km.StockSettlement||d===t.Km.StockIssue||d===t.Km.ReverseCreditNote||(N=!0);break;case"COSTPRICE2_NONEDITABLE":(d===t.Km.Sales||d===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||d===t.Km.SalesReturn)&&(N=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(d===t.Km.PurchaseOrder||d===t.Km.PurchaseOrderCancel||d===t.Km.SalesOrder||d===t.Km.PerformaSalesInvoice||d===t.Km.Quotation||d===t.Km.Purchase||d===t.Km.PurchaseReturn||d===t.Km.DebitNote||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.GoodsReceived||d===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(N=!0);break;case"SELLINGPRICE2_NONEDITABLE":(d===t.Km.PurchaseOrder||d===t.Km.Purchase||d==t.Km.GoodsReceived)&&(N=!0);break;case"SELLING_HEADER":(d===t.Km.PerformaSalesInvoice||d===t.Km.Quotation||d===t.Km.Purchase||d===t.Km.PurchaseReturn||d===t.Km.Sales||d===t.Km.GoodsReceived||d===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||d===t.Km.PurchaseOrder||d===t.Km.SalesOrder)&&(N=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this.activeurlpath)return void(N=!1);(d===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.PurchaseReturn||d===t.Km.ReversePurchase||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.DebitNote||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this.activeurlpath)return void(N=!1);(d===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.PurchaseReturn||d===t.Km.Sales||d===t.Km.ReversePurchase||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.DebitNote||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this.activeurlpath)return void(N=!1);(d===t.Km.PurchaseReturn||d===t.Km.ReversePurchase||d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoiceCancel||d===t.Km.TaxInvoice||d===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.DebitNote||d===t.Km.CreditNote||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this.activeurlpath)return void(N=!1);(d===t.Km.PurchaseReturn||d===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.Sales||d===t.Km.ReversePurchase||d===t.Km.SalesReturn||d===t.Km.DebitNote||d===t.Km.CreditNote||d===t.Km.TaxInvoice||d===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||d===t.Km.ReverseCreditNote)&&(N=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":N=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":d===t.Km.OpeningStockBalance&&(N=!0);break;case"OTHER_DIS_HEADER":(d===t.Km.Sales||d===t.Km.SalesReturn||d===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||d===t.Km.TaxInvoiceCancel&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(N=!0);break;case"UNIT_NONEDITABLE":(d===t.Km.CreditNote||d===t.Km.DebitNote||d===t.Km.ReverseCreditNote)&&(N=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(N=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(N=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":case"DISCOUNT_IMPORTPURCHASE":(d==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||d==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(N=!0);break;case"ECS_AMOUNT":1==this.userSetting.ENABLE_ECS?(d==t.Km.Purchase||d==t.Km.GoodsReceived)&&(N=!0):2==this.userSetting.ENABLE_ECS?(d==t.Km.TaxInvoice||d==t.Km.CreditNote)&&(N=!0):3==this.userSetting.ENABLE_ECS&&(d==t.Km.TaxInvoice||d==t.Km.Purchase||d==t.Km.GoodsReceived)&&(N=!0)}return N}assignValueForReturnModeInProd(a){console.log("ineditmode",a),this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.RATE,console.log("prodRAte",a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a.MFGDATE?"":a.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a.EXPDATE?"":a.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=a.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=a.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=a.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=a.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=a.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),0==a.INDDISCOUNTRATE&&a.INDDISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=100*a.INDDISCOUNT/(a.REALQTY*a.RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=a.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=a.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=a.ALTCONFACTOR,console.log("RATE",this._trnMainService.TrnMainObj.ProdList,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE),this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(a){this.activerowIndex=a,this.batchlist=[]}validateRate(a,h){if(0==this._trnMainService.nullToZeroConverter(a.ALTRATE))return confirm(" Zero  Rate Entry Detected For Item '"+a.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")?(console.log("reachq"),!1):(document.getElementById("rate"+h).focus(),console.log("reachq"),!0);if(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let d=0;if(d=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,d<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(g=>{setTimeout(()=>{null!==document.getElementById("discount"+h)?document.getElementById("discount"+h).focus():document.getElementById("remarks"+h).focus()},0)}),!1}}MRPChangeEvent(a,h){if("goods-received-note"==this.activeurlpath&&"NEW"==this._trnMainService.TrnMainObj.Mode){let d=this.masterService.userProfile.roleRights.find(g=>"ALLOWRATECHANGEINPI"==g.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==d.value&&(this._trnMainService.TrnMainObj.ProdList[h].TEMP_ALTRATE==this._trnMainService.TrnMainObj.ProdList[h].ALTRATE||confirm("PRATE DOEN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this._trnMainService.TrnMainObj.ProdList[h].ALTRATE=this._trnMainService.TrnMainObj.ProdList[h].TEMP_ALTRATE))}this.validateRate(a,h),this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&(this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&this.validateCostPrice(),this._trnMainService.TrnMainObj.ProdList[h].UNIT==this._trnMainService.TrnMainObj.ProdList[h].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[h].RATE=this._trnMainService.TrnMainObj.ProdList[h].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[h].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[h].RATE=this._trnMainService.TrnMainObj.ProdList[h].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[h].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkRateisChangedinSoFromQT()}checkRateisChangedinSoFromQT(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE&&(confirm("Rate is change Do you want to proceed .")||(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE))}BarcodeKeyDownEvent(a,h){}AlternateKeyUp(a,h){}AlternateQuantityEventClick(a,h){var d;if((h.preventDefault(),this.QuantityChangeEvent(a),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&setTimeout(()=>{document.getElementById("rate"+a).focus()},20),(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesReturn)&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DONONSALEABLERETURN)&&(d=this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE),this._trnMainService.TrnMainObj.ProdList[a].STOCK<d))return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity");(this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL>0&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL<this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE)?this.alertService.warning("Quantity cannot exceed the minimum stock level"):(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()),console.log("ITEM CHECK eneabletelecomdevices",this.userSetting.EnableTelcomDevices,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[]),(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&(0,J.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE)||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&(1!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE||this._trnMainService.TrnMainObj.VoucherType!==t.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC)&&this.dialougeOpen()),(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&this.checkMaxStockLevel(a),this._trnMainService.TrnMainObj.ProdList[a].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut)&&this.checkReorderStocklevel(a),this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN?this.checkValidation(a):this.focusToRate(a,h)),console.log(this.activeurlpath),"self-billing"===this.activeurlpath&&this.checkValidation(a),this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,h),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this.focusToRate(a,h))}focusAfterQuantityClick(){this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag?0!=this.userSetting.IMPORTPOBILLMODE?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType!==t.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.GoodsReceived||!this._trnMainService.TrnMainObj.REFORDBILL?"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL?document.getElementById("discount"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath?document.getElementById("adjustbatch"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==t.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType==t.Km.SalesOrder&&0==this.masterService.userProfile.userRights.find(h=>"AllowRateChangeInSO"==h.right)?.value?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus():document.getElementById("discount"+this.activerowIndex).focus()}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(d=>d.PMCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE&&d.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(d=>{a+=d.ROUTQTY}),console.log("total Enter qty",a,"stokc",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n        (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n        Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(d=>d.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&d.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(d=>{a+=d.ROUTQTY}),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n      (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n      Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(d=>d.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&d.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&d.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC).forEach(d=>{a+=d.Quantity}),console.log("totalEnterQuantitty",a),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)return this.alertService.info(`Inserted Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity :\n    ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity)}  \n    Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(a,h){console.log("FOCUS TO RATE",a,h),h.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect||this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&"self-billing"==this.activeurlpath?document.getElementById("discount"+a).focus():document.getElementById("rate"+a).focus()}newNulltoconverter(){}BaseQuantityEventClick(a,h){h.preventDefault(),this.activerowIndex=a,null!=document.getElementById("mrp"+a)?this.masterService.focusAnyControl("mrp"+a):this.masterService.focusAnyControl("remarks"+a),this.SelectUnit(a,"EACH",h.target.value)}stockCheck(a,h){this.realQty=0,this.realQtyin=0,this.finalRes=0,this.masterService.getStockForCheck(a).subscribe(d=>{if("ok"===d.status){if(this.stockList=d.result,this.stockList.forEach(g=>{this.realQty+=g.RealQty,this.realQtyin+=g.REALQTY_IN}),this.finalRes=this.realQty-this.realQtyin,this._trnMainService.TrnMainObj.TOTALQTY>this.finalRes)return this.alertService.info("Quantity exceed the transaction stock"),void(this._trnMainService.QuantityMsg="GreaterQuantity");this._trnMainService.QuantityMsg=""}else this.alertService.info(d.result)})}checkBatchWiseStockOut(){this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `)}checkItemTotalQtyWithStock(a,h,d,g,N){let ne=0;if(ne=1==d?this._trnMainService.TrnMainObj.ProdList.filter(he=>he.MCODE==a&&he.BC==h&&he.RATE==g).map(he=>he.Quantity).reduce((he,Ce)=>he+Ce,0):this._trnMainService.TrnMainObj.ProdList.filter(he=>he.MCODE==a&&he.RATE==g).map(he=>he.Quantity).reduce((he,Ce)=>he+Ce,0),ne>0)return ne>this._trnMainService.TrnMainObj.ProdList[N].STOCK&&9!=this._trnMainService.TrnMainObj.ProdList[N].PTYPE?(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[N].ITEMDESC} Entered  Quantity: ${ne}  exceed the available stock ${this._trnMainService.TrnMainObj.ProdList[N].STOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[N].ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(a,h,d,g,N){if(console.log("validate duplicate rate item"),0==a&&0==g){let ne=this._trnMainService.TrnMainObj.ProdList.filter(he=>he.MCODE==h&&he.RATE==d);if(ne&&ne?.length>1)return this.alertService.info(`Item:${ne[0].ITEMDESC} duplicate rate:${ne[0].RATE} is detected.`),void(this._trnMainService.TrnMainObj.ProdList[N].ALTERNATEQUANTIY=0)}}checkBatchWiseStock(){let a=[];this.masterService.getStockBatchWise(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(h=>{"ok"==h.status&&(a=h.result,null!=a&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity>a[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}getBatchWiseDateForNoBill(a){if(this.activerowIndex=a,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH)return!1;this.masterService.masterGetmethod("/batch/getmfgdate?batchCode="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH+"&&selfLife="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SHELFLIFE).subscribe(h=>{"ok"===h.status?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=h.result.mfgdate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=h.result.expdate,this.masterService.focusAnyControl("alternateqty"+a)):this.alertService.info("Invalid BatchCode.Error Details: "+h.message)},h=>{this.alertService.info("Invalid BatchCode.Error Details: "+h)})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(a){console.log("petrol pump fxn ",a.MRP,a.ISAMOUNTWISEBILL),(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==a.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(a.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}dblClickPopupItem(a){console.log("value",a.ISAMOUNTWISEBILL,a);let h=this._trnMainService.TrnMainObj.VoucherType;this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={};var d=this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,a);if(console.log("duplication",d),0==d)return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(N=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(a),0!=this.ValidateDuplicateItemEntry(a)){if("add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.WRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.WRATE),this._trnMainService.NeedToTakePriceFromMenuItem()&&(h in t.qK&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.WRATE),h in t.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.PRATE,a.CONFACTOR)),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE=a.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE=a.ECSRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE=a.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE=a.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ENABLEITEMWISEBATCH=a.ENABLEITEMWISEBATCH,6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isQuantityReadonly=!0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isPurchaseOrder=!1,("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isBarcodeOfPtypeSix=!0)),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=a.In_Rate_B,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=a.RATE_B)),this.focusService.afterEnterFocousItem(a.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]){this.batchlist=[];let N=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];N.REQEXPDATE=a.REQEXPDATE,N.DISMODE=a.DISMODE,N.PWEIGHT=a.GWEIGHT,N.PROMOTION=0,N.BATCHSCHEME=null,N.ALLSCHEME=null,N.ISVAT=a.ISVAT,N.MENUCODE=a.MENUCODE,N.ITEMDESC=a.DESCA,N.MCODE=a.MCODE,N.WEIGHT=a.GWEIGHT,N.Mcat=a.MCAT,N.BASEUNIT=a.BASEUNIT,N.SHELFLIFE=a.SHELFLIFE,N.Weighable=a.Weighable,N.MRP=a.MRP,N.ALTCONFACTOR=a.CONFACTOR,N.BARCODE=a.BARCODE,N.TOTSTOCK=a.STOCK,N.PSTOCK=a.PSTOCK,N.UNIT=a.BASEUNIT,N.WARRANTY=a.WARRANTY,N.W_MRP=a.W_MRP,N.W_SELLRATEBEFORETAX=a.W_SELLRATEBEFORETAX,N.STOCK=a.STOCK,N.WSRATE_DISCOUNT=a.WSRATE_DISCOUNT,N.MINLEVEL=a.MINLEVEL,N.MAXLEVEL=a.MAXLEVEL,N.ROLEVEL=a.ROLEVEL,N.ROWARN=a.ROWARN,N.MINWARN=a.MINWARN,N.HASVARIANT=a.HASVARIANT,N.Mcat=a.MCAT,N.REMARKS=a.REMARKS,N.PRATE=a.PRATE,N.ISRECURRING=a.ISRECURRING,N.HASCOMMISSIONCHARGE=a.HASCOMMISSIONCHARGE,N.ISAMOUNTWISEBILL=a.ISAMOUNTWISEBILL,N.ISUNKNOWN=a.ISUNKNOWN,1==a.HASVARIANT&&(N.BC=a.BC),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&!(0,J.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SUPCODE=a.SUPCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType in t.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DOFULLRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),this._trnMainService.NeedToTakePriceFromMenuItem()||((this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales)&&1===this.userSetting.EnableItemWiseBatch&&1===a.HASBATCH&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate()),this._trnMainService.NeedToTakePriceFromMenuItem()||(this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&a.PTYPE<10&&9!==a.PTYPE&&((this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&this._trnMainService.TrnMainObj.REFORDBILL||!1===this.itemFromBC(a.HASVARIANT)&&this.checkBatchWiseRate())),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&0===this.userSetting.EnableBatchWisePrice&&1===a.HASVARIANT&&this.checkBatchWiseRateSettingZero(),this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.OpeningStockBalance||"self-billing"===this.activeurlpath?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=a.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PREV_PRATE=a.PREV_PRATE):(this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(a),0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)&&(this.assignRateandQtyLoadFromSO(a),this.assignOrderedDiscount(a)),this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(a),this.emitReferenceQuantity(),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}`).subscribe(he=>{"ok"==he.status&&he.result&&he.result.length&&(this.matrixItemAtrribute=he.result,this.matrixitemgrid.show())})}6===a.PTYPE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex))}else this.alertService.warning("Cannot enter duplicate item!")}emitReferenceQuantity(){(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,BASEUNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT})}dialougeOpen(){console.log("dialouge open ProductDetails",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails),this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open($.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(d=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote?d?.data:d&&d.data&&d.data.productColorList?d.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else document.getElementById("rate"+this.activerowIndex).focus()},20)})}checkMaxStockLevel(a){0!==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL+" exceeded !")}checkReorderStocklevel(a){var h=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY);if(h<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))return;if(h<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL),1===this._trnMainService.TrnMainObj.ProdList[a].MINWARN&&(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL))return;1===this._trnMainService.TrnMainObj.ProdList[a].ROWARN&&this.alertService.warning("Re-Order level "+this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL+" has been reached !")}}}deleteRowBarCodeDetailRow(){confirm("Are you sure you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails[this.barcodeDetailActiverowIndex].splice(this.barcodeDetailActiverowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this.addNewBarCodeDetailRow(this.barcodeDetailActiverowIndex))}ItemIEMI1Click(a,h){}ItemIMEI2Click(a,h){this.addNewBarCodeDetailRow(a)}CancelCommand(){this.showBarCodeDetail=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!1}loadBarCodeRow(a){let d={IEMI1:"",IEMI2:""};d.MCODE=0===this.activerowIndex?"":this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,d.Color="",0===this.activerowIndex?(this._trnMainService.TrnMainObj.ProdList[0].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[0].ProductDetails.push(d)):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(d),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(a){let g={IEMI1:"",IEMI2:""};g.MCODE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,g.Color="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(g),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(a){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].BASEQUANTITY=this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}getProductPriceBatchWise(a){this.masterService.masterPostmethod("/getBatchwisePurchaseRate",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE}).subscribe(d=>{"ok"==d.status&&(this.batchWisePricList=JSON.parse(d.result),this.batchWisePricList.length>0&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this.batchWisePricList[0].RATE,this._trnMainService.TrnMainObj.ProdList[a].CRATE=this.batchWisePricList[0].NETRATE,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this.batchWisePricList[0].DCAMOUNT,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=this.batchWisePricList[0].DCRATE))})}onApplyOldPriceClick(){let a={};if(1==this.userSetting.EnableBatchWisePrice&&(a=this._trnMainService.priceChangeList.filter(h=>0==this._trnMainService.nullToZeroConverter(h.CRATE_A))[0],console.log("INVALID UOM",a),a))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${a.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}checkCarriedOnOpeninbgStock(){let d=[];this.masterService.masterGetmethod(`/getBatchWiseOPPreviousItemInfo/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH}`).subscribe(g=>{"ok"==g.status&&(d=g.result,d.length>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=d[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=d[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d[0].PREVIOUSINQTY,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isCarriedOnStock=1,this._trnMainService.ReCalculateBillWithNormal(),this.checkValidation(this.activerowIndex)))})}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let a of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AltSellingPrices.find(h=>h.UNIT==a.UNIT).NRATE_A=a.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1,console.log("prodlist",this._trnMainService.TrnMainObj.ProdList)}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let a={};return a=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(h=>0==this._trnMainService.nullToZeroConverter(h.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(h=>null==h.NRATE_A||0==h.NRATE_A)[0],!a||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${a.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(a,h){let d=0,g=0,N=0,ne=this._trnMainService.priceChangeList[a];if(null!=ne){if(ne.UNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let he=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*this.userSetting.VATRate;ne.NRATE_A<=he&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(N=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),ne.NRATE_A<=N+N*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?(N=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),ne.NRATE_A<=N&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):ne.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)),ne.NRATE_A<=d&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let he=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE;if(g=he+he*this.userSetting.VATRate,ne.NRATE_A<=g&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)){let Ce=he+he*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100);ne.NRATE_A<=Ce+Ce*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?ne.NRATE_A<=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):ne.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?ne.NRATE_A<=d+d*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):ne.NRATE_A<=d&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(a),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].WNRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_MRP=this._trnMainService.priceChangeList[a].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.PODetailList[a].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[a].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].WNRATE_A)}changeSellingPrice(a){for(const h of this._trnMainService.priceChangeList)h.SNO>1&&(h.NRATE_A=h.CONFACTOR*this._trnMainService.priceChangeList[a].NRATE_A,h.WNRATE_A=h.CONFACTOR*this._trnMainService.priceChangeList[a].WNRATE_A)}checkDeuplicateCodeAndRate(){let a=[],h=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE);if(null!=h){if(h.length>1){let g=0;for(let N of this._trnMainService.TrnMainObj.ProdList)N.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&a.push(g),g++}let d=1;for(let g of a)(this._trnMainService.TrnMainObj.ProdList[g].RATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE||this._trnMainService.TrnMainObj.ProdList[g].EXPDATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)&&(this._trnMainService.TrnMainObj.ProdList[g].BATCH=`-${d}`),d++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableRateandDiscount(a){let h=this._trnMainService.TrnMainObj.ProdList[a];if(this._trnMainService.TrnMainObj.VoucherType===t.Km.SalesOrder){let d=this.masterService.userProfile.userRights.find(g=>"AllowRateChangeInSO"==g.right);if(d&&0==d?.value)return!0}if(this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==t.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN)return!0;if(("add-purchase-invoice"==this.activeurlpath||"goods-received-note"==this.activeurlpath)&&"NEW"==this._trnMainService.TrnMainObj.Mode){let d=this.masterService.userProfile.roleRights.find(g=>"ALLOWRATECHANGEINPI"==g.right);if(d&&0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==d?.value)return!1}return!!(this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote&&this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"VIEW"==h.rowMode||h.isDisabled||this.disableRAteDisandAmt()||1==this._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||"purchase-import-order"==this.activeurlpath||this._trnMainService.disableRateOnPOselect||"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||this._trnMainService.disableRateOnGRNload||this._trnMainService.TrnMainObj.VoucherType==t.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||"self-billing"==this.activeurlpath)}disableRAteDisandAmt(){return this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINDNOTE}disableDiscount(){return this._trnMainService.TrnMainObj.VoucherType!==t.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.Sales?(this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===t.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this._trnMainService.TrnMainObj?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkRepackStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&h.ROUTQTY>h.STOCK)[0];if(null!=a&&null!=a)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.PUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.ALTUNIT} `),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkEnteredProductStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.Quantity>h.STOCK&&7!=h.NATURETYPE&&h.PTYPE<10)[0];if(console.log("prod stock obj",a),null!=a)return console.log("STOCK EXCEEDED"),this.alertService.info(a.BASEUNIT!=a.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} (${a.ALTERNATEQUANTIY} x ${a.ALTCONFACTOR} = ${a.Quantity} ${a.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE,this.ItemBarCodeClick(this.activerowIndex,a)}validateCostPrice(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling pirce")}rateChange(){this.applyPipeInRate=!1}quantityChange(){this.applyPipeInQuantity=!1}rateFocusOut(){this.applyPipeInRate=!0}quantityFocusOut(){this.applyPipeInQuantity=!0}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(a,h){6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,h)}ItemBarCodeFoucusOut(a,h){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(a,h){this.barcodeDisplay=!0}DisAmtclick(){}checkBatchWiseEnterStock(){let a=0;return this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(h=>a+=h.Quantity),console.log("total batch wise qty",a,"stock",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(a){this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INVRATE)*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EXRATE),this._trnMainService.TrnMainObj.ProdList[a].REALRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(a){this.FCRATEChangeEvent(a),this.masterService.focusAnyControl("discount"+a)}RecalculateMRP(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP}onTabMRP(a,h){a.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+h).focus()}RecalculateSPRICE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE,console.log("hit sprice")}onTabSPRICE(a,h){a.preventDefault(),this.RecalculateSPRICE(),null!=document.getElementById("VSRATE"+this.activerowIndex)?document.getElementById("VSRATE"+this.activerowIndex).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(h):document.getElementById("mfgdate"+h).focus()}RecalculateVSRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT=1)?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE}onTabVSRATE(a){a.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE}onTabVPRATE(a,h){a.preventDefault(),this.RecalculateSPRICE(),0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(h):document.getElementById("mfgdate"+h).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,1==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0),this.userRightAuthService.showAuthPopup=!1}OrderComment(a){this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionEntry&&this.checkValidation(a)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===t.Km.StockIssue||("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}disableBatch(a){return(2!=this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType!=t.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.ProductionEntry)&&(0===a.REQEXPDATE||null===a.REQEXPDATE||void 0===a.REQEXPDATE&&89!=this._trnMainService.TrnMainObj.VoucherType||void 0)}itemFromBC(a){return 1==a&&1==this.loadFromBarcode}disableItemDesc(a){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase())return!0;let h=this._trnMainService.TrnMainObj.ProdList[a];return!!(h.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||!0===this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)||(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice?(console.log("disableitemdesc2"),!0):this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN)}disableAltUnit(a){let h=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"===h.rowMode||h.isDisabled||1==this._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"===this.activeurlpath||"stock-issue-approval"===this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN}disableRequestQTY(a){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionApproval)return!0}disableGridForReqApproval(a){if(this._trnMainService.TrnMainObj.VoucherType===t.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.REFORDBILL)return!0}disableAltQty(a){let h=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"==h.rowMode||h.isDisabled||h.isBarcodeOfPtypeSix||1==this._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN}disableAprroveQty(a){if("VIEW"==this._trnMainService.TrnMainObj.ProdList[a].rowMode)return!0}disableBarcodeField(a){return!!(1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.ProdList[a].isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==t.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||"lite"==this.AppMode)}showVATcolumn(){return!(this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)}showNetAmtHeadercolumn(){return this._trnMainService.TrnMainObj.VoucherType!=t.Km.OpeningStockBalance}showNetAmtNonEditable(){return this._trnMainService.TrnMainObj.VoucherType!=t.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=t.Km.Stockadjustment&&!(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT)}showNetAmtEditable(){return this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT}checkBatchSelectionInMultiplePrice(){return 1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice||!!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected}checkQuantityInPOdeliveryMode(){console.log("reachdownpodelivery"),null!=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.Quantity>h.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQT(){null!=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.Quantity>h.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT}\n  exceed the item wise QT Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n  `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQTin(){if(null!=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.Quantity<h.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void document.getElementById("alternateqty"+this.activerowIndex).focus()}checkSaleableQuantityInSalesOrder(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],h=a.ALTUNIT==a.BASEUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTCONFACTOR;this.masterService.getSaleableQTY(a.MCODE,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNDATE,this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.TrnMainObj.VCHRNO).subscribe(d=>{if("ok"==d.status){let g=d.result[0].SALEABLE_SQTY;h>g&&(a.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),this.alertService.info("Entered qty is greater than its saleable qty:"+g),this.alertService.emitShowHideSubject.subscribe(N=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}))}},d=>{this.alertService.info(d)})}checkQuantityInEditMode(){let a=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.Quantity<h.OUTQTY)[0];null!=a?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${a.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice&&0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE/this.userSetting.VatConRate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE/this.userSetting.VatConRate),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=0!==this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===t.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===t.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===t.Km.PerformaSalesInvoice)?a.OPSTOCK:a.POSTOCK}assignOrderedDiscount(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=a.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE}clickOnNetAmount(a){this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===t.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(a)}changeONNetAmount(a,h){this._trnMainService.TrnMainObj.ProdList[a].NETAMOUNT=this._trnMainService.nullToZeroConverter(h.target.value),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(a){if(a&&a?.length){let h=a.map(d=>d.ADJUSTQTY).reduce((d,g)=>d+g);this._trnMainService.nullToZeroConverter(h)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h)}}checkItemQtyExceedBilledQty(){let a=0,h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;return a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?h:h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,!(a<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY)}checkItemStockINEditModeForOutQty(){let a={},h=0,d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;if(h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?d:d*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,"EDIT"!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&h>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a;if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()){let g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BatchWiseEditList?.map(N=>N.INVOICEQTY).reduce((N,ne)=>N+ne,0);if(h-g>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(a=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},console.log("Negative stock responee",a),this.loader.hide(),"ok"==a.status?"ALLOW"==a.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,console.log("ALLOW TO DELETE HERE",this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}) ?`)&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},a=>{this.loader.hide(),this.alertService.info(a)})}ValidateQuantityinEDITMode(){console.log("prdList",this._trnMainService.TrnMainObj.ProdList);let a={},h=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY,g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,N=0;return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?N=d:(N=d*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,g/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),0==h&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&N<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY-this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BSTOCK?(a.status=!1,a.userEnterQty=g,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a):h>0&&N<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK?(a.status=!1,a.userEnterQty=g,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}   ) ) `,a):void 0}checkBCForMatrxiItem(){this._trnMainService.TrnMainObj.VoucherType===t.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||this.alertService.warning(`Variant Details is not selected for Item :${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} `))}ValidateQtyINEditModeFroProduction(a){let h=0;return h=a.BASEUNIT===a.ALTUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTERNATEQUANTIY,!(h<a.OUTQTY&&(this.alertService.info(`Item : ${a.ITEMDESC} entered Qty:${h} ${a.BASEUNIT} is less than transaction Qty:${a.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let a={},d=(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY),g=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,N=0;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?N=d:(N=d*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,g/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),console.log("stock",N,this._trnMainService.TrnMainObj.ProdList),N>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.userEnterQty=g,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n          ,Exceed the Stock qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a}ValidateDuplicateItemEntry(a){if(this._trnMainService.TrnMainObj.VoucherType in t.NA){let d;return d=this._trnMainService.TrnMainObj.ProdList.filter(g=>g.MENUCODE==a.MENUCODE),!(d.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(h=>"AllowQuantityApproval"==h.right)?.value}AllowNegativeAuthConfirm(){console.log("AUTH ASEKD")}onUserRightReceived(a){console.log("ebent ma k aaucha",a,this._trnMainService.afterAutoloadCheck),this.alertService.success(a),this.authenticationPopup.hide(),this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isConfirmed=!0)}hoverDiscount(a){let h=this._trnMainService.TrnMainObj.ProdList[a];this.stringValue="",this.hoverId=a,console.log("prod discount",h.DISCOUNT),0!==h.DISCOUNT&&(this.stringValue=`<b>Indv Discount </b> : ${h.INDDISCOUNT} <br> <b>Flat Dsicount</b> : ${h.FLATDISCOUNT}`)}hoverLeaveDiscount(a){this.hoverId=null}ReadOnlyForDescription(a){return!(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath))}}return D.\u0275fac=function(a){return new(a||D)(e.Y36(_.P),e.Y36(Z.p),e.Y36(k.R),e.Y36(X.uw),e.Y36(H.qu),e.Y36(j.gz),e.Y36(y.c),e.Y36(f.e),e.Y36(e.sBO),e.Y36(L.V),e.Y36(x.R),e.Y36(m.T),e.Y36(I.y),e.Y36(P.i))},D.\u0275cmp=e.Xpm({type:D,selectors:[["productentryLite"]],viewQuery:function(a,h){if(1&a&&(e.Gf(ee.q,5),e.Gf(M.K,5),e.Gf(Ne,5),e.Gf(Ze,5),e.Gf(Fe,5),e.Gf(dt,5),e.Gf(ht,5),e.Gf(ut,5),e.Gf(pt,5),e.Gf(_t,5),e.Gf(Tt,5),e.Gf(Mt,5)),2&a){let d;e.iGM(d=e.CRH())&&(h.itemListChild=d.first),e.iGM(d=e.CRH())&&(h.batchlistChild=d.first),e.iGM(d=e.CRH())&&(h.genericGridSupplierPopup=d.first),e.iGM(d=e.CRH())&&(h.barCodeGridPopup=d.first),e.iGM(d=e.CRH())&&(h.PetrolGrid=d.first),e.iGM(d=e.CRH())&&(h.genericGridMulitplePricePopup=d.first),e.iGM(d=e.CRH())&&(h.matrixitemgrid=d.first),e.iGM(d=e.CRH())&&(h.itemEditGrid=d.first),e.iGM(d=e.CRH())&&(h.authenticationPopup=d.first),e.iGM(d=e.CRH())&&(h.rateValidation=d.first),e.iGM(d=e.CRH())&&(h.genericGrid=d.first),e.iGM(d=e.CRH())&&(h.focusBatch=d.first)}},hostBindings:function(a,h){1&a&&e.NdJ("keydown",function(g){return h.updown(g)},!1,e.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit"},decls:82,vars:58,consts:[[2,"margin-right","15px"],[1,"wrapper"],["id","prodlistTableheader",2,"background","silver","color","black"],[4,"ngIf"],["scope","col",2,"width","4%"],[3,"ngStyle"],["style","width: 190px;",3,"ngStyle",4,"ngIf"],["style","width: 50px;",4,"ngIf"],["style","width:100px",3,"ngStyle",4,"ngIf"],["style","width: 95px;",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width:100px",4,"ngIf"],["style","width: 60px;",4,"ngIf"],["style","width: 120px;",4,"ngIf"],["style","width: 90px;",4,"ngIf"],["style","width: 100px;",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 15%;",4,"ngIf"],["style","border: 1px;",4,"ngFor","ngForOf"],["class","PList","style","    margin-top: 2%;\nheight: 640px;\nwidth: 78%; ",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;height: 370px;\nposition: absolute;right: 20%;top: 5px;width: 50%;z-index: 9999999",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],[2,"width","190px",3,"ngStyle"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","95px"],[2,"width","110px"],[2,"width","100px"],[2,"width","60px"],[2,"width","120px"],[2,"width","90px"],[2,"width","15%"],[2,"border","1px"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #e6e6e6","width","20px",3,"id"],["style","width: 6%;",4,"ngIf"],["style","width: 10%;",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","30%",3,"ngStyle"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["class","CellWithComment","style","height:23px;border: 1px solid #e6e6e6;width:7%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:4%",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9",3,"hidden"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; width: 7rem; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;",4,"ngIf"],["id","amntId","style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px; text-align: right;",4,"ngIf"],["id","vatvalue","style","height:23px;border: 1px solid #e6e6e6;width:100px;text-align: right;",4,"ngIf"],["style","height:23px; border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width: 5vw; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px",4,"ngIf"],["style","border: 1px solid #e6e6e6;background-color: #f9f9f9;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",3,"id",4,"ngIf"],[2,"width","6%"],[2,"width","10%"],["autocomplete","off","type","text",2,"width","100%","border","1px solid",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","7%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],["focusBatch",""],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","focusout","keydown.Enter","keyup","keypress"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","width","7rem","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter","click"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id","mouseover","mouseleave"],[2,"display","none",3,"ngClass"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","width","5vw","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","width","100px"],[3,"ngModel","ngModelChange"],[2,"border","1px solid #e6e6e6","background-color","#f9f9f9"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","ngModelChange","keydown.enter","keydown.Tab"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%",3,"id"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81DAAC"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue"],[3,"schemeList","dbClickEvent","schemeCloseClick"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #E6E6E6","border-top","2px solid #E6E6E6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%;",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%;",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["style","border: 1px solid #e6e6e6;",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(a,h){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"table")(3,"tr",2),e.YNc(4,Ui,2,0,"th",3),e.TgZ(5,"th",4),e._uU(6,"S.No."),e.qZA(),e.YNc(7,mt,2,0,"th",3),e.YNc(8,gt,2,0,"th",3),e.TgZ(9,"th",5),e._uU(10," Description"),e.qZA(),e.YNc(11,St,2,2,"th",6),e.TgZ(12,"th"),e._uU(13," Unit"),e.qZA(),e.YNc(14,Bi,2,0,"th",7),e.YNc(15,Zi,2,6,"th",8),e.YNc(16,Fi,2,0,"th",9),e.YNc(17,Qi,2,0,"th",10),e.YNc(18,Hi,2,0,"th",10),e.YNc(19,bt,2,0,"th",10),e.YNc(20,Ct,2,0,"th",10),e.YNc(21,nt,2,0,"th",11),e.YNc(22,qe,2,0,"th",10),e.YNc(23,At,2,0,"th",12),e.YNc(24,Et,2,0,"th",13),e.YNc(25,It,2,0,"th",14),e.YNc(26,Pt,2,4,"th",8),e.YNc(27,yt,2,0,"th",12),e.YNc(28,Ue,2,0,"th",13),e.YNc(29,xt,2,0,"th",10),e.YNc(30,Rt,2,0,"th",10),e.YNc(31,Nt,2,0,"th",15),e.YNc(32,Lt,2,0,"th",3),e.YNc(33,wt,2,0,"th",3),e.YNc(34,Dt,2,3,"th",16),e.YNc(35,jt,2,3,"th",16),e.YNc(36,kt,2,0,"th",17),e.qZA(),e.YNc(37,ui,42,50,"tbody",18),e.qZA()()(),e.YNc(38,_i,25,1,"div",3),e.YNc(39,Ti,2,1,"div",19),e.YNc(40,Mi,2,6,"div",20),e.YNc(41,mi,2,1,"div",20),e.YNc(42,gi,2,1,"div",20),e.TgZ(43,"generic-popup-grid",21,22),e.NdJ("onItemDoubleClick",function(g){return h.dblClickPopupItem(g)}),e.qZA(),e.TgZ(45,"generic-popup-grid",21,23),e.NdJ("onItemDoubleClick",function(g){return h.dblClickPopupParty(g)}),e.qZA(),e.TgZ(47,"barcode-popup-grid",21,24),e.NdJ("onItemDoubleClick",function(g){return h.dblClickbarcodePopUP(g)}),e.qZA(),e.TgZ(49,"multiple-price-popup-grid",21,25),e.NdJ("onItemDoubleClick",function(g){return h.dblClickPricePopUP(g)}),e.qZA(),e.TgZ(51,"matrix-item-grid",26,27),e.NdJ("onApplyClicked",function(g){return h.setVariantData(g)}),e.qZA(),e.TgZ(53,"batch-wise-item-edit",28,29),e.NdJ("onApplyClicked",function(g){return h.setBatchWiseEditData(g)}),e.qZA(),e.TgZ(55,"authentication-entry",30,31),e.NdJ("onUserRightReceived",function(g){return h.onUserRightReceived(g)}),e.qZA(),e._UZ(57,"popup-petrol",null,32),e.YNc(59,bi,39,5,"div",33),e.TgZ(60,"div")(61,"div",34,35)(63,"div",36)(64,"div",37)(65,"div",38)(66,"button",39),e.NdJ("click",function(){return h.onClickNo()}),e.TgZ(67,"span",40),e._uU(68,"\xd7"),e.qZA()()(),e.TgZ(69,"div",41)(70,"div",42)(71,"div",43),e._uU(72),e.qZA(),e.TgZ(73,"div",44)(74,"button",45),e.NdJ("click",function(){return h.onClickYes()}),e._uU(75,"Yes"),e.qZA(),e.TgZ(76,"button",46),e.NdJ("click",function(){return h.onClickNo()}),e._uU(77,"No"),e.qZA()()()()()()()(),e.YNc(78,Ci,36,4,"div",3),e.YNc(79,Ai,2,2,"div",3),e.YNc(80,Ei,2,2,"div",3),e.YNc(81,Ii,25,2,"div",3)),2&a&&(e.xp6(1),e.Udp("height",h.heightChange()+"vh"),e.xp6(3),e.Q6J("ngIf",h.approvalFlag),e.xp6(3),e.Q6J("ngIf",h.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("BARCODE_HEADER",0)),e.xp6(1),e.Q6J("ngStyle",24==h._trnMainService.TrnMainObj.VoucherType||19==h._trnMainService.TrnMainObj.VoucherType||5==h._trnMainService.TrnMainObj.VoucherType?e.DdM(53,Pi):null)("ngStyle",8==h._trnMainService.TrnMainObj.VoucherType||7==h._trnMainService.TrnMainObj.VoucherType?e.DdM(54,yi):null)("ngStyle",89==h._trnMainService.TrnMainObj.VoucherType?e.DdM(55,Ge):null)("ngStyle",80==h._trnMainService.TrnMainObj.VoucherType?e.DdM(56,xi):null),e.xp6(2),e.Q6J("ngIf",h.ShowProductInsertTableColumns("BATCH_HEADER",0)),e.xp6(3),e.Q6J("ngIf",90!=h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",24==h._trnMainService.TrnMainObj.VoucherType||14==h._trnMainService.TrnMainObj.VoucherType||15==h._trnMainService.TrnMainObj.VoucherType||41==h._trnMainService.TrnMainObj.VoucherType||19==h._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=h._trnMainService.TrnMainObj.AdditionalObj.tag||1==h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",19==h._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=h._trnMainService.TrnMainObj.AdditionalObj.tag||(5==h._trnMainService.TrnMainObj.VoucherType||81==h._trnMainService.TrnMainObj.VoucherType)&&1==h.userSetting.BATCHWISEPRICE),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("FCRATE_HEADER",0)),e.xp6(1),e.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||37==h._trnMainService.TrnMainObj.VoucherType||16==h._trnMainService.TrnMainObj.VoucherType||19==h._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==h._trnMainService.TrnMainObj.AdditionalObj.tag),e.xp6(1),e.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16===h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("CONFACTOR",0)),e.xp6(1),e.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==h.activeurlpath),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("ECS_AMOUNT",0)),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_PER_HEADER",0)),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_AMT_HEADER",0)),e.xp6(1),e.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16===h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14!=h._trnMainService.TrnMainObj.VoucherType&&16!=h._trnMainService.TrnMainObj.VoucherType&&57!=h._trnMainService.TrnMainObj.VoucherType&&64!=h._trnMainService.TrnMainObj.VoucherType&&74!=h._trnMainService.TrnMainObj.VoucherType&&89!=h._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=h.activeurlpath&&3!=h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),e.xp6(1),e.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType&&1==h.userSetting.EnableServiceCharge),e.xp6(1),e.Q6J("ngIf",h.showVATcolumn()),e.xp6(1),e.Q6J("ngIf",h.showNetAmtHeadercolumn()),e.xp6(1),e.Q6J("ngIf",(3==h._trnMainService.TrnMainObj.VoucherType||37==h._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=h._trnMainService.TrnMainObj.AdditionalObj.tag||31==h._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",h.approvalFlag),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("MFGDATE_HEADER",0)&&"consumption-entry"!==h.activeurlpath),e.xp6(1),e.Q6J("ngIf",h.ShowProductInsertTableColumns("EXPDATE_HEADER",0)&&"consumption-entry"!==h.activeurlpath),e.xp6(1),e.Q6J("ngIf",64==h._trnMainService.TrnMainObj.VoucherType||20==h._trnMainService.TrnMainObj.VoucherType||89==h._trnMainService.TrnMainObj.VoucherType||90==h._trnMainService.TrnMainObj.VoucherType||19==h._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=h._trnMainService.TrnMainObj.AdditionalObj.tag),e.xp6(1),e.Q6J("ngForOf",h._trnMainService.TrnMainObj.ProdList),e.xp6(1),e.Q6J("ngIf",h.isProductDetailView),e.xp6(1),e.Q6J("ngIf","itemList"==h.masterService.PlistTitle&&h.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","Batch Price Selection"==h.masterService.PlistTitle||"Item Variant Selection"==h.masterService.PlistTitle||"Batch Selection"==h.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","schemelist"==h.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","partyPopUp"==h.masterService.PlistTitle),e.xp6(1),e.Q6J("popupsettings",h.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",h.gridPopupSettingsForSupplier),e.xp6(2),e.Q6J("popupsettings",h.barcodeGridSettings),e.xp6(2),e.Q6J("popupsettings",h.gridPopupSettingsForMultiplePrice),e.xp6(2),e.Q6J("activerowIndex",h.activerowIndex)("matrixItemAtrribute",h.matrixItemAtrribute),e.xp6(2),e.Q6J("BatchWiseEditList",h.BatchWiseEditList),e.xp6(6),e.Q6J("ngIf",h._trnMainService.showPriceChangeDetail&&1==h.userSetting.ShowPriceChangePopup),e.xp6(2),e.Q6J("config",e.DdM(57,Ri)),e.xp6(11),e.hij(" ",h.rateValidationDisplayMessage," "),e.xp6(6),e.Q6J("ngIf",h.showDiscountAuth),e.xp6(1),e.Q6J("ngIf",h.showBatchPopup),e.xp6(1),e.Q6J("ngIf",h.showAdjustPopup),e.xp6(1),e.Q6J("ngIf",1==h._trnMainService.showNegativeBilling||1==h.userRightAuthService.showAuthPopup))},dependencies:[w.oB,Q.mk,Q.sg,Q.O5,Q.PC,H.YN,H.Kr,H.Fj,H.wV,H.EJ,H.JJ,H.qQ,H.Fd,H.On,O.Zl,U.n,B.F,ee.q,M.K,re,ae.H,Me.j,S._v,G.ed,Y.t,z.l,K.m,oe.l,Q.JJ,Q.uU,me.g],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}","table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n}\n\nth[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n  padding: 8px;\n}\n\nth[_ngcontent-%COMP%] {\n  text-align: left;\n  background: #eee;\n  position: sticky;\n  top: 0px;\n}\n\n.wrapper[_ngcontent-%COMP%] {\n  border: 1px solid #ddd;\n  width: 100%;\n  overflow-x: hidden;\n  overflow-y:auto ;\n}\n    .col1[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 10em;\n        left: 0em;\n        top: auto;\n    }\n\n    .col2[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 5em;\n        left: 10em;\n        top: auto;\n    }\n\n    .modal-footer[_ngcontent-%COMP%] {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n        cursor: pointer;\n        position: absolute;\n        top: 10px;\n        right: 10px;\n    }\n\n    .modal-backdrop[_ngcontent-%COMP%] {\n        display: none;\n    }",".modal-content[_ngcontent-%COMP%] {\n        padding: 1px;\n        margin: 0px;\n        float: right;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n        background-color: #f3f5f4;\n        cursor: pointer;\n    }\n\n    tr[_ngcontent-%COMP%] {\n        font-size: 13px;\n    }\n\n    .selected-row[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n        line-height: 30px !important;\n        padding: 3px;\n    }\n\nthead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n        line-height: 5px !important;\n    }\n\n   tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n        text-align: left !important;\n        padding: 0px 0px 0px 11px !important;\n    }\n\n    .modal-content[_ngcontent-%COMP%] {\n        box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n\n    .modal-content-main-area[_ngcontent-%COMP%] {\n        max-height: 100%;\n        height: 94%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .modal-content-summary-area[_ngcontent-%COMP%] {\n        max-height: 20%;\n        height: 20%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .ellipsis[_ngcontent-%COMP%] {\n        white-space: nowrap;\n    }\n\n    .close[_ngcontent-%COMP%] {\n        margin: -9px 0px -9px 0px;\n    }\n\n    .highlighted[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n    .bgforlessstockitem[_ngcontent-%COMP%]{\n        background-color: #ffc107d2;\n    }\n    .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 15%;\n\n  }"]}),D})()},32404:(ve,ce,b)=>{b.d(ce,{i:()=>C});var e=b(92340),t=b(64537),O=b(67297),M=b(69389),ee=b(7976),$=b(87584),S=b(53074),J=b(67311);let C=(()=>{class _{constructor(k,X,H,j,y,f){this.authservice=k,this.setting=X,this.arouter=H,this._trnMainService=j,this.masterService=y,this.alertService=f,this.AppSettings=X.appSetting,this.userprofile=k.getUserProfile(),this.userSetting=k.getSetting(),this.AppMode=e.N.appMode}saveClickValidationForUnknownItem(k){let X=k.filter(H=>1==H.ISUNKNOWN).find(H=>null==H.ITEMDESC||""==H.ITEMDESC||null==H.ITEMDESC||""==H.ITEMDESC?.trim());return!(null==X||!X||(this.alertService.warning("Empty description for item detected, Please enter item description to proceed!!!"),0))}getDuplicatesForConsumptionList(k){let X=new Set,H=[];for(let j of k){let y=j.ITEMDESC;X.has(y)?H.push(j):X.add(y)}return H}}return _.\u0275fac=function(k){return new(k||_)(t.LFG(O.e),t.LFG(M.R),t.LFG(ee.gz),t.LFG($.p),t.LFG(S.P),t.LFG(J.c))},_.\u0275prov=t.Yz7({token:_,factory:_.\u0275fac}),_})()},58349:(ve,ce,b)=>{b.d(ce,{i:()=>so});var e=b(8239),t=b(64537),O=b(20092),M=b(10826),ee=b(86363),$=b(41439),S=b(42326),J=b(28698),C=b(25370),_=b(91605),Z=b(32265),k=b(92340),X=b(19102),H=b(67311),j=b(14970),y=b(87584),f=b(53074),L=b(88692);const x=["genericGridProduct"];function m(T,E){if(1&T&&(t.TgZ(0,"option",24),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.s9C("value",i.NAME),t.xp6(1),t.hij(" ",i.NAME," ")}}function I(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div")(1,"div")(2,"div",5)(3,"h4",6),t._uU(4),t.qZA(),t.TgZ(5,"button",7),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.hide())}),t.TgZ(6,"span",8),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"fieldset")(9,"div",9)(10,"div",10)(11,"div",11)(12,"label",12),t._uU(13,"Barcode:"),t.qZA(),t.TgZ(14,"input",13),t.NdJ("keydown.Enter",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onBarcodeEnter(s))}),t.qZA()()(),t.TgZ(15,"div",10)(16,"label",12),t._uU(17,"Item :"),t.qZA(),t.TgZ(18,"input",14),t.NdJ("keydown.Enter",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.showItemPopUp())})("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.DESCA=s)}),t.qZA()(),t.TgZ(19,"div",10)(20,"label",12),t._uU(21,"Warehouse :"),t.qZA(),t.TgZ(22,"select",15),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.MWAREHOUSE=s)}),t.YNc(23,m,2,2,"option",16),t.qZA()()()(),t.TgZ(24,"fieldset")(25,"legend",17),t._uU(26,"Details:"),t.qZA(),t.TgZ(27,"div",9)(28,"div",18)(29,"label",12),t._uU(30,"Item Name:"),t.qZA(),t.TgZ(31,"label",19),t._uU(32),t.qZA()(),t.TgZ(33,"div",20)(34,"label",12),t._uU(35,"Shelf :"),t.qZA(),t.TgZ(36,"label",21),t._uU(37),t.qZA()()(),t.TgZ(38,"div",9)(39,"div",18)(40,"label",12),t._uU(41,"Item Price:"),t.qZA(),t.TgZ(42,"label",21),t._uU(43),t.qZA()(),t.TgZ(44,"div",20)(45,"label",12),t._uU(46,"Row :"),t.qZA(),t.TgZ(47,"label",21),t._uU(48),t.qZA()()(),t.TgZ(49,"div",9)(50,"div",18)(51,"label",12),t._uU(52,"MRP :"),t.qZA(),t.TgZ(53,"label",21),t._uU(54),t.qZA()(),t.TgZ(55,"div",20)(56,"label",22),t._uU(57,"Stock:"),t.qZA(),t.TgZ(58,"label",21),t._uU(59),t.qZA()()(),t.TgZ(60,"div",9)(61,"div",23)(62,"label",12),t._uU(63,"Cost-Price:"),t.qZA(),t.TgZ(64,"label",21),t._uU(65),t.qZA()()()()()()}if(2&T){const i=t.oxw();t.xp6(4),t.hij(" ",i.itemInfopopupsettings.title," "),t.xp6(10),t.s9C("value",i.itemWiseInfoObj.BARCODE),t.xp6(4),t.s9C("value",i.itemWiseInfoObj.DESCA),t.Q6J("ngModel",i._trnMainService.TrnMainObj.DESCA),t.xp6(4),t.Q6J("ngModel",i._trnMainService.TrnMainObj.MWAREHOUSE),t.xp6(1),t.Q6J("ngForOf",i.warehouseList),t.xp6(9),t.Oqu(i.itemWiseInfoObj.DESCA),t.xp6(5),t.Oqu(i.itemWiseInfoObj.shelf),t.xp6(6),t.Oqu(i.itemWiseInfoObj.In_Rate_A),t.xp6(5),t.Oqu(i.itemWiseInfoObj.RACK),t.xp6(6),t.Oqu(i.itemWiseInfoObj.MRP),t.xp6(5),t.Oqu(i.itemWiseInfoObj.STOCK),t.xp6(6),t.Oqu(i.itemWiseInfoObj.IN_PRATE_A)}}let P=(()=>{class T{constructor(i,n,s,p,A,ie){this.alertService=i,this.loadingService=n,this._trnMainService=s,this.masterService=p,this.renderer=A,this.elem=ie,this.warehouseList=[],this.showStockedQuantityOnly=0,this.itemWiseInfoObj={},this.isActive=!1,this.gridPopupSettingsForproduct=new X.sG,this.doShowInfoPopup=!0,this.masterService.getWarehouseList().subscribe(se=>{this.warehouseList=se})}show(i=!0){this.isActive=!0,this.itemWiseInfoObj={},this.doShowInfoPopup=i}hide(){this.isActive=!1}ngOnInit(){this.gridPopupSettingsForproduct={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/A/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"MENUCODE",title:"PRODUCT CODE",hidden:!1,noSearch:!1},{key:"BASEUNIT",title:"UNIT",hidden:!1,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0},{key:"MRP",title:"MRP",hidden:!1,noSearch:!0,alignment:"right",pipe:!0}]}}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),console.log("info popup close"),this.hide())}showItemPopUp(){this.genericGridProduct.show()}onBarcodeEnter(i){console.log("on barcode enter",i),this.loadingService.show("Getting the item info..."),this.loadingService.hide(),this.masterService.loadItemInfo("",i.target.value,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}onProductSelected(i){console.log("on prodcut select",i.MCODE,i.MENUCODE),this.itemWiseInfoObj.MENUCODE=i.DESCA,this.itemWiseInfoObj.MCODE=i.MCODE,this.itemWiseInfoObj.BASEUNIT=i.BASEUNIT,this.itemWiseInfoObj.STOCK=i.STOCK,this.itemWiseInfoObj.MRP=i.MRP,this.itemWiseInfoObj.BARCODE=i.BARCODE,this.loadingService.show("Getting the item info..."),this.masterService.loadItemInfo(this.itemWiseInfoObj.MCODE,"",this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.BARCODE=n.result[0].BARCODE,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(H.c),t.Y36(j.V),t.Y36(y.p),t.Y36(f.P),t.Y36(t.Qsj),t.Y36(t.SBq))},T.\u0275cmp=t.Xpm({type:T,selectors:[["iteminfo-popup"]],viewQuery:function(i,n){if(1&i&&t.Gf(x,5),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGridProduct=s.first)}},hostBindings:function(i,n){1&i&&t.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,t.evT)},inputs:{itemInfopopupsettings:"itemInfopopupsettings"},decls:5,vars:4,consts:[[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-135px","width","768px"],[1,"modal-content","modal-content-main-area"],[4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridProduct",""],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"padding-left","5px","font-size","1.2rem"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row"],[1,"col-md-6",2,"margin","5px 0px","display","flex","padding","0px"],["for","type",1,"bold"],["type","text","required","",3,"value","keydown.Enter"],["placeholder","Press Enter to select Item","autocomplete","off","readonly","",1,"col-md-8",3,"ngModel","value","keydown.Enter","ngModelChange"],["id","wh","name","selectedWarehouse",1,"form-control",2,"width","67%","height","23px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[2,"font-size","0.8rem","font-weight","600","width","auto"],[1,"col-7"],["for","type",2,"width","65%","height","auto"],[1,"col-5"],["for","type"],["for","type",1,"bold-stock"],[1,"col-6"],[3,"value"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,I,66,13,"div",2),t.qZA()(),t.TgZ(3,"generic-popup-grid",3,4),t.NdJ("onItemDoubleClick",function(p){return n.onProductSelected(p)}),t.qZA()),2&i&&(t.ekj("modal-sticky-hide",!n.isActive),t.xp6(2),t.Q6J("ngIf",n.itemInfopopupsettings),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettingsForproduct))},dependencies:[L.sg,L.O5,O.YN,O.Kr,O.Fj,O.EJ,O.JJ,O.On,J.Zl],styles:[".modal-content[_ngcontent-%COMP%] {\n      padding: 1px;\n      margin-right: 65%;\n      float: right;\n      width: 85% !important;\n    }\n\n    .bold[_ngcontent-%COMP%]{\n      font-weight: 600;\n    }\n    .bold-stock[_ngcontent-%COMP%]{\n      font-weight: 600;\n      color:#249e24\n    }\n  \n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n      background-color: #f3f5f4;\n      cursor: pointer;\n    }\n  \n    tr[_ngcontent-%COMP%] {\n      font-size: 11px;\n    }\n  \n    .selected-row[_ngcontent-%COMP%] {\n      background-color: #ced6d3 !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n      line-height: 24px !important;\n      padding: 5px 10px;\n      vertical-align: middle;\n    }\n  \n    .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n      line-height: 5px !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n      text-align: left !important;\n      padding: 0px 0px 0px 11px !important;\n    }\n  \n    .modal-content[_ngcontent-%COMP%] {\n      box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n  \n    .modal-content-main-area[_ngcontent-%COMP%] {\n      max-height: 100%;\n      height: 65%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .modal-content-summary-area[_ngcontent-%COMP%] {\n      max-height: 20%;\n      height: 20%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .ellipsis[_ngcontent-%COMP%] {\n      \n      white-space: nowrap;\n    }\n\n    fieldset[_ngcontent-%COMP%] {\n    margin-top: 0.2rem;\n    margin-left: 0.3rem;\n    margin-right: 0.3rem;\n    border: 1px solid black;\n    color: black;\n    \n    background: #f3f5f4;\n    }"]}),T})();class w{}var Q=b(16738),U=b.n(Q),B=b(49457),q=b(23815),W=b(38011),re=b(5304),ae=b(94612),Me=b(43190),G=b(25917),Y=b(69389),z=b(54536),K=b(7976),oe=b(67297),me=b(28475);const Ne={alert:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>\n        </svg>\n    ',error:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0V0z" fill="none"/>\n            <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>\n        </svg>\n    ',info:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>\n        </svg>\n    ',success:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>\n        </svg>\n    ',warn:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="64" viewBox="0 0 64 64" height="64">\n          <circle cx="32.086" cy="50.142" r="2.256"/>\n          <path d="M30.08 25.012V42.32c0 1.107.897 2.005 2.006 2.005s2.006-.897 2.006-2.005V25.012c0-1.107-.897-2.006-2.006-2.006s-2.006.898-2.006 2.006z"/>\n          <path d="M63.766 59.234L33.856 3.082c-.697-1.308-2.844-1.308-3.54 0L.407 59.234c-.331.622-.312 1.372.051 1.975.362.605 1.015.975 1.72.975h59.816c.705 0 1.357-.369 1.721-.975.361-.603.381-1.353.051-1.975zM5.519 58.172L32.086 8.291l26.568 49.881H5.519z"/>\n        </svg>\n    '};var Ze=b(79765);let Fe=(()=>{class T{constructor(){this.emitter=new Ze.xQ,this.icons=Ne}set(i,n){return i.id=i.override&&i.override.id?i.override.id:Math.random().toString(36).substring(3),i.click=new t.vpe,i.timeoutEnd=new t.vpe,this.emitter.next({command:"set",notification:i,add:n}),i}success(i="",n="",s){return this.set({title:i,content:n||"",type:"success",icon:this.icons.success,override:s},!0)}error(i="",n="",s){return this.set({title:i,content:n||"",type:"error",icon:this.icons.error,override:s},!0)}alert(i="",n="",s){return this.set({title:i,content:n||"",type:"alert",icon:this.icons.alert,override:s},!0)}info(i="",n="",s){return this.set({title:i,content:n||"",type:"info",icon:this.icons.info,override:s},!0)}warn(i="",n="",s){return this.set({title:i,content:n||"",type:"warn",icon:this.icons.warn,override:s},!0)}bare(i="",n="",s){return this.set({title:i,content:n||"",type:"bare",icon:"bare",override:s},!0)}create(i="",n="",s="success",p){return this.set({title:i,content:n,type:s,icon:this.icons[s],override:p},!0)}html(i,n="success",s,p="bare"){return this.set({html:i,type:n,icon:this.icons[p],override:s},!0)}remove(i){this.emitter.next(i?{command:"clean",id:i}:{command:"cleanAll"})}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275prov=t.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var bt=b(74263),Ct=b(32404),nt=b(48063),qe=b(35732);let At=(()=>{class T{constructor(i,n){this.http=i,this.authService=n,this.apiUrl=k.N.apiUrl}printVoucher(i,n,s,p,A,ie){let se;return this.getBillFormat(i).pipe((0,ae.b)(de=>(se=de.result[0].BILLFORMATS,this.getPrintTitleAsCopy(i,n,s,p))),(0,ae.b)(de=>(A.title=de.result,this.getPrintFileName(ie,A.COMPANYID,se))),(0,ae.b)(de=>(A.filename=de.result[0].FileName,A.rownumber=de.result?de.result[0].RowsNumber:0,this.getNumberToWords(i,n,s,A.COMPANYID))),(0,ae.b)(de=>(A.numtowords=de.result?de.result[0].NUMTOWORDS:"",this.getAllInvoiceData(A)))).subscribe(de=>{this.print(de)})}getBillFormat(i){return this.http.post(this.apiUrl+"/getBillFormat",{voucherno:i})}getPrintTitleAsCopy(i,n,s,p){return this.http.get(this.apiUrl+`/getPrintInvoiceTitleAsCopy?VCHRNO=${i}&DIVISION=${n}&PHISCALID=${s}&TRNUSER=${p}`)}getAllInvoiceData(i){return this.http.post(`${this.apiUrl}/Pdf`,{filename:i.filename,Parameter:{voucherno:i.VCHRNO,rowsnumber:i.rownumber,companyname:i.NAME,companyaddress:i.ADDRESS,division:i.INITIAL,phiscalid:i.PhiscalID,companyid:i.COMPANYID,numtowords:i.numtowords,p1:i.panno1,p2:i.panno2,p3:i.panno3,p4:i.panno4,p5:i.panno5,p6:i.panno6,p7:i.panno7,p8:i.panno8,p9:i.panno9,title:i.title,caption:i.caption,phone1:i.phone1,phone2:i.phone2,email:i.EMAIL,vchrno:i.VCHRNO,PRINTBY:i.PRINTBY,companyemail:i.EMAIL,companyvat:i.COMPANYVAT}},this.getRequestOptionForPdfFile())}getRequestOptionForPdfFile(){return{responseType:"blob",headers:new qe.WM({Authorization:this.authService.getAuth().token})}}getPrintFileName(i,n,s){const p={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getPrintFileName",{voucherprefix:i,companyid:n,billformats:s},p)}getNumberToWords(i,n,s,p){const A={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getNumberToWords",{vchrno:i,division:n,phiscalid:s,companyid:p},A)}print(i){const n=new Blob([i],{type:"application/pdf"}),s=URL.createObjectURL(n),p=document.createElement("iframe");p.style.display="none",p.src=s,document.body.appendChild(p),p.contentWindow.print()}}return T.\u0275fac=function(i){return new(i||T)(t.LFG(qe.eN),t.LFG(oe.e))},T.\u0275prov=t.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var Et=b(71800),It=b(71259);function We(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"input",28),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw(2);return t.KtG(p.selectAll=s)})("change",function(s){t.CHM(i);const p=t.oxw(2);return t.KtG(p.onSelectAllChange(s))}),t.qZA()}if(2&T){const i=t.oxw(2);t.Q6J("ngModel",i.selectAll)}}function Pt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",29),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortChalanData("asc"))}),t._uU(1,"\u21c5"),t.qZA()}}function yt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",30),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortChalanData("desc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Ue(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",29),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemData("asc"))}),t._uU(1,"\u21c5"),t.qZA()}}function xt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",30),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemData("desc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Rt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",29),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemByName("asc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Nt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",30),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemByName("desc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Lt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"input",28),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.ISSELECTED=s)})("change",function(s){t.CHM(i);const p=t.oxw().$implicit,A=t.oxw(2);return t.KtG(A.onSelectChange(s,p))}),t.qZA()}if(2&T){const i=t.oxw().$implicit;t.Q6J("ngModel",i.ISSELECTED)}}function wt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td"),t.YNc(2,Lt,1,1,"input",18),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td")(15,"input",31),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.QTY=s)})("change",function(){const p=t.CHM(i).$implicit,A=t.oxw(2);return t.KtG(A.onChangeQty(p))}),t.qZA()()()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(2);t.xp6(2),t.Q6J("ngIf",0!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),t.xp6(1),t.hij(" ",n+1," "),t.xp6(2),t.Oqu(i.REF_VOUCHER),t.xp6(2),t.Oqu(i.MENUCODE),t.xp6(2),t.Oqu(i.ITEMDESC),t.xp6(2),t.Oqu(i.ALTUNIT),t.xp6(2),t.Oqu(i.DELIVEREDQTY),t.xp6(2),t.Q6J("ngModel",i.QTY)("disabled",2!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan||1==s.masterService.userSetting.EnablePetrolPumpFeatures)}}function rt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),t._uU(8,"Customer Name:"),t.qZA(),t.TgZ(9,"input",9),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.BILLTO=s)}),t.qZA()(),t.TgZ(10,"div",10)(11,"label"),t._uU(12,"As on Date:"),t.qZA(),t.TgZ(13,"input",11),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.toDate=s)})("change",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onDateChange())}),t.qZA()(),t.TgZ(14,"div",7)(15,"label"),t._uU(16,"Voucher No:"),t.qZA(),t.TgZ(17,"ng-multiselect-dropdown",12),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.DELIVERYREF=s)})("onSelect",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onSelect(s))})("onDeSelect",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onDeSelect(s))})("onSelectAll",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onSelectAll(s))})("onDeSelectAll",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onDeSelectAll(s))}),t.qZA()(),t.TgZ(18,"div",13)(19,"button",14),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.hide())}),t._uU(20," \xd7 "),t.qZA()()()()(),t._UZ(21,"hr"),t.qZA(),t.TgZ(22,"div",15)(23,"table")(24,"thead")(25,"tr",16)(26,"th",17),t.YNc(27,We,1,1,"input",18),t._uU(28," S.No. "),t.qZA(),t.TgZ(29,"th",19),t._uU(30," Chalan No "),t.YNc(31,Pt,2,0,"span",20),t.YNc(32,yt,2,0,"span",21),t.qZA(),t.TgZ(33,"th",19),t._uU(34," Item Code "),t.YNc(35,Ue,2,0,"span",20),t.YNc(36,xt,2,0,"span",21),t.qZA(),t.TgZ(37,"th",22),t._uU(38," Item Name "),t.YNc(39,Rt,2,0,"span",20),t.YNc(40,Nt,2,0,"span",21),t.qZA(),t.TgZ(41,"th",23),t._uU(42,"Unit"),t.qZA(),t.TgZ(43,"th",23),t._uU(44,"Delivered Qty"),t.qZA(),t.TgZ(45,"th",23),t._uU(46,"Billed Qty"),t.qZA()(),t.YNc(47,wt,16,9,"tr",24),t.qZA(),t._UZ(48,"tbody",25),t.qZA()(),t.TgZ(49,"div",26)(50,"button",27),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onApply())}),t._uU(51,"Apply"),t.qZA(),t.TgZ(52,"button",27),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onReset())}),t._uU(53,"Reset"),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(9),t.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),t.xp6(4),t.Q6J("ngModel",i.toDate),t.xp6(4),t.Q6J("placeholder","Select Voucher")("ngModel",i._trnMainService.TrnMainObj.DELIVERYREF)("settings",i.dropdownSettings)("data",i.vchrDetail),t.xp6(10),t.Q6J("ngIf",0!=i.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),t.xp6(4),t.Q6J("ngIf","asc"==i.chalanSortOrder),t.xp6(1),t.Q6J("ngIf","desc"==i.chalanSortOrder||!i.chalanSortOrder),t.xp6(3),t.Q6J("ngIf","asc"==i.itemSortOrder),t.xp6(1),t.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),t.xp6(3),t.Q6J("ngIf","asc"==i.itemNameSortOrder),t.xp6(1),t.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),t.xp6(7),t.Q6J("ngForOf",i._trnMainService.TrnMainObj.SalesDeliveryList)}}let Dt=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=p,this.isActive=!1,this.fromDate=new Date,this.vchrDetail=[],this.chalanSortOrder="asc",this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){this.dropdownSettings={singleSelection:!1,selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:2,allowSearchFilter:!0,maxHeight:170};const i=new Date;this.currDate=(0,L.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.vchrDetail=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO)),this.isActive=!0})}sortChalanData(i){this.chalanSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.REF_VOUCHER.localeCompare(s.REF_VOUCHER):(n,s)=>s.REF_VOUCHER.localeCompare(n.REF_VOUCHER))}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onSelect(i){this.spinnerService.show("Loading Data..."),this.masterService.getDeliveryChalanProdDetails(i,"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&n.result.forEach(s=>{this.assignInList(s)})),this.checkIsSelected()})}onDeSelect(i){this._trnMainService.TrnMainObj.SalesDeliveryList=this._trnMainService.TrnMainObj.SalesDeliveryList.filter(n=>n.REF_VOUCHER!==i),this.checkIsSelected()}onSelectAll(i){this.spinnerService.show("Loading data..."),this.masterService.getDeliveryChalanProdDetails(i.join(),"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&(this._trnMainService.TrnMainObj.SalesDeliveryList=[],n.result.forEach(s=>{this.assignInList(s)}))),this.checkIsSelected()})}onDeSelectAll(i){this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.selectAll=!1}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.SalesDeliveryList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.SalesDeliveryList?.length}assignInList(i){this._trnMainService.TrnMainObj.SalesDeliveryList||(this._trnMainService.TrnMainObj.SalesDeliveryList=[]);let n={};n.REF_VOUCHER=i.VCHRNO,n.MENUCODE=i.MENUCODE,n.BATCH=i.BATCH,n.DELIVEREDQTY=i.ALTERNATEQUANTIY,n.QTY=i.ALTERNATEQUANTIY,n.MCODE=i.MCODE,n.ITEMDESC=i.ITEMDESC,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.ISSELECTED=!0,n.ALTRATE=i.ALTRATE,n.BASEUNIT=i.BASEUNIT,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,n.DISMODE=i.DISMODE,this._trnMainService.TrnMainObj.SalesDeliveryList.push(n)}onSelectChange(i,n){n.QTY=i.target.checked?n.DELIVEREDQTY:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.QTY=n.DELIVEREDQTY):(n.ISSELECTED=!1,n.QTY=0)})}hide(){if(this._trnMainService.TrnMainObj.ProdList?.some(i=>i.ITEMDESC)){if(!confirm("Applied items in the list will be removed. Do you want to proceed?"))return;this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.addRow(),this.isActive=!1}else this.isActive=!1}onDateChange(){this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{this.vchrDetail=[],i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO))})}onChangeQty(i){i.QTY!==i.DELIVEREDQTY&&(i.ISSELECTED=!1,this.selectAll=!1),i.QTY>i.DELIVEREDQTY&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.DELIVEREDQTY}`),i.QTY=0)}onReset(){this.toDate=this.currDate,this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[]}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(i=>{let n={};n.ITEMDESC=i.ITEMDESC,n.BATCH=i.BATCH,n.ALTERNATEQUANTIY=i.QTY,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.BASEUNIT=i.BASEUNIT,n.ALTRATE=i.ALTRATE,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.REFDELIVERYBILL=i.REF_VOUCHER,n.RATE=n.ALTRATE/i.ALTCONFACTOR,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,i.QTY>0&&this._trnMainService.TrnMainObj.ProdList.push(n)}),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.MWAREHOUSE="Chalan Warehouse",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.isActive=!1,this._trnMainService.disableCustomerInputField=!0}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(H.c),t.Y36(j.V),t.Y36(y.p))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-delivery-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"custom-asset-dropdown","w-100",3,"placeholder","ngModel","settings","data","ngModelChange","onSelect","onDeSelect","onSelectAll","onDeSelectAll"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change",4,"ngIf"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","30%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","disabled","ngModelChange","change"]],template:function(i,n){1&i&&t.YNc(0,rt,54,14,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.Fj,O.wV,O.Wl,O.JJ,O.On,It.O],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),T})();function jt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",27),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemData("asc"))}),t._uU(1,"\u21c5"),t.qZA()}}function kt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",28),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemData("desc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Qe(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",27),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemByName("asc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Vt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"span",28),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.sortItemByName("desc"))}),t._uU(1,"\u21c5"),t.qZA()}}function Ut(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"input",17),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ISSELECTED=s)})("change",function(s){const A=t.CHM(i).$implicit,ie=t.oxw(2);return t.KtG(ie.onSelectChange(s,A))}),t.qZA(),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td")(13,"input",29),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ALTERNATEQUANTIY=s)})("change",function(){const p=t.CHM(i).$implicit,A=t.oxw(2);return t.KtG(A.onChangeQty(p))}),t.qZA()()()}if(2&T){const i=E.$implicit,n=E.index;t.xp6(2),t.Q6J("ngModel",i.ISSELECTED),t.xp6(1),t.hij(" ",n+1," "),t.xp6(2),t.Oqu(i.MENUCODE),t.xp6(2),t.Oqu(i.ITEMDESC),t.xp6(2),t.Oqu(i.ALTUNIT),t.xp6(2),t.Oqu(i.ALTQTY_IN),t.xp6(2),t.Q6J("ngModel",i.ALTERNATEQUANTIY)}}function Bt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),t._uU(8,"Supplier Name:"),t.qZA(),t.TgZ(9,"input",9),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.BILLTO=s)}),t.qZA()(),t.TgZ(10,"div",10)(11,"label"),t._uU(12,"As on Date:"),t.qZA(),t.TgZ(13,"input",11),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.toDate=s)})("change",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onDateChange())}),t.qZA()(),t.TgZ(14,"div",12)(15,"button",13),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.hide())}),t._uU(16," \xd7 "),t.qZA()()()()(),t._UZ(17,"hr"),t.qZA(),t.TgZ(18,"div",14)(19,"table")(20,"thead")(21,"tr",15)(22,"th",16)(23,"input",17),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.selectAll=s)})("change",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onSelectAllChange(s))}),t.qZA(),t._uU(24," S.No. "),t.qZA(),t.TgZ(25,"th",18),t._uU(26," Item Code "),t.YNc(27,jt,2,0,"span",19),t.YNc(28,kt,2,0,"span",20),t.qZA(),t.TgZ(29,"th",21),t._uU(30," Item Name "),t.YNc(31,Qe,2,0,"span",19),t.YNc(32,Vt,2,0,"span",20),t.qZA(),t.TgZ(33,"th",22),t._uU(34,"Unit"),t.qZA(),t.TgZ(35,"th",22),t._uU(36,"Approved Qty"),t.qZA(),t.TgZ(37,"th",22),t._uU(38,"Order Qty"),t.qZA()(),t.YNc(39,Ut,14,7,"tr",23),t.qZA(),t._UZ(40,"tbody",24),t.qZA()(),t.TgZ(41,"div",25)(42,"button",26),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onApply())}),t._uU(43,"Apply"),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(9),t.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),t.xp6(4),t.Q6J("ngModel",i.toDate),t.xp6(10),t.Q6J("ngModel",i.selectAll),t.xp6(4),t.Q6J("ngIf","asc"==i.itemSortOrder),t.xp6(1),t.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),t.xp6(3),t.Q6J("ngIf","asc"==i.itemNameSortOrder),t.xp6(1),t.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),t.xp6(7),t.Q6J("ngForOf",i._trnMainService.TrnMainObj.AdditionProdList)}}let Kt=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=p,this.isActive=!1,this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){const i=new Date;this.currDate=(0,L.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.isActive=!0,this.spinnerService.show("Loading data...."),this._trnMainService.TrnMainObj.AdditionProdList=[],this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}pushToList(i){null==this._trnMainService.TrnMainObj.AdditionProdList&&(this._trnMainService.TrnMainObj.AdditionProdList=[]);let n={};n.ALTCONFACTOR=i.ALTCONFACTOR,n.ALTERNATEQUANTIY=i.ALTERNATEQUANTIY,n.ALTUNIT=i.ALTUNIT,n.CRATE=i.CRATE,n.ALTRATE=i.CRATE,n.RATE=n.ALTRATE/n.ALTCONFACTOR,n.ITEMDESC=i.ITEMDESC,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.UNIT=i.BASEUNIT,n.BASEUNIT=i.BASEUNIT,n.WAREHOUSE=i.WAREHOUSE,n.ISSELECTED=!0,n.Product=i.Product,n.ALTQTY_IN=i.ALTERNATEQUANTIY,n.ISVAT=i.VAT,n.MRP=i.MRP,this._trnMainService.TrnMainObj.AdditionProdList.push(n)}onDateChange(){this.spinnerService.show("Loading data...."),this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),this._trnMainService.TrnMainObj.AdditionProdList=[],i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}hide(){this.isActive=!1}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onChangeQty(i){i.ALTERNATEQUANTIY!==i.ALTQTY_IN&&(i.ISSELECTED=!1,this.selectAll=!1),i.ALTERNATEQUANTIY>i.ALTQTY_IN&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.ALTQTY_IN}`),i.ALTERNATEQUANTIY=0)}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.AdditionProdList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.AdditionProdList?.length}onSelectChange(i,n){n.ALTERNATEQUANTIY=i.target.checked?n.ALTQTY_IN:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.ALTERNATEQUANTIY=n.ALTQTY_IN):(n.ISSELECTED=!1,n.ALTERNATEQUANTIY=0)})}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.ProdList=(0,q.cloneDeep)(this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.callPipe=!this._trnMainService.callPipe,this.hide()}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(H.c),t.Y36(j.V),t.Y36(y.p))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-requisition-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","45%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&t.YNc(0,Bt,44,8,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.Fj,O.wV,O.Wl,O.JJ,O.On],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),T})();var He=b(71180);let Zt=(()=>{class T{constructor(i,n){this.http=i,this.state=n;const s=this.state.getGlobalSetting("apiUrl");s&&s.length>0&&(this.apiUrl=s)}loadAdditionalCostDetailsInImportPI(i){return this.http.get(this.apiUrl+`/loadAdditionalCostDetailsInImportPI?vchrno=${i}`)}}return T.\u0275fac=function(i){return new(i||T)(t.LFG(qe.eN),t.LFG(He.q))},T.\u0275prov=t.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const Ft=["genericGridCreditAccount"];function Qt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",45),t.NdJ("keydown.F6",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.ok())})("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.ok())}),t._uU(1,"OK"),t.qZA()}if(2&T){const i=t.oxw(2);t.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode||"EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Ht(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.saveImportDetails())}),t._uU(1,"SAVE"),t.qZA()}if(2&T){const i=t.oxw(2);t.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Gt(T,E){1&T&&t._UZ(0,"option",57),2&T&&t.Q6J("value",E.$implicit.ITEMDESC)}function Yt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr",47),t.NdJ("click",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.rowClick(p))})("keydown.Shift.delete",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.deleteRow(p))}),t.TgZ(1,"td",48),t._uU(2),t.qZA(),t.TgZ(3,"td",49)(4,"input",50),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ITEMNAME=s)})("keydown.Enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.masterservice.focusAnyControl("importQty"+p))})("focus",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.rowClick(p))}),t.qZA(),t.TgZ(5,"datalist",51),t.YNc(6,Gt,1,1,"option",52),t.qZA()(),t.TgZ(7,"td",53)(8,"input",54),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.QUANTITY=s)})("keydown.Enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.masterservice.focusAnyControl("importTaxable"+p))})("change",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.onQuantityChange())}),t.qZA()(),t.TgZ(9,"td",53)(10,"input",55),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.TAXABLE=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.masterservice.focusAnyControl("importNonTaxable"+p))})("change",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.onTaxableChange())}),t.qZA()(),t.TgZ(11,"td",53)(12,"input",55),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.NONTAXABLE=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.masterservice.focusAnyControl("importVAT"+p))})("change",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.onNonTaxableChange())}),t.qZA()(),t.TgZ(13,"td",53)(14,"input",55),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.VAT=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.masterservice.focusAnyControl("importNetmant"+p))})("change",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.onVatChange())}),t.qZA()(),t.TgZ(15,"td",53)(16,"input",56),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.NETAMOUNT=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.nextRow(p))})("keydown.tab",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.nextRow(p))}),t.qZA()()()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(2);t.xp6(2),t.Oqu(n+1),t.xp6(2),t.MGl("id","importItemname",n,""),t.Q6J("ngModel",i.ITEMNAME)("disabled","EDIT"==s.tranMode),t.xp6(2),t.Q6J("ngForOf",s.productList),t.xp6(2),t.MGl("id","importQty",n,""),t.Q6J("ngModel",i.QUANTITY)("disabled","EDIT"==s.tranMode),t.xp6(2),t.MGl("id","importTaxable",n,""),t.Q6J("ngModel",i.TAXABLE)("disabled","EDIT"==s.tranMode),t.xp6(2),t.MGl("id","importNonTaxable",n,""),t.Q6J("ngModel",i.NONTAXABLE)("disabled","EDIT"==s.tranMode),t.xp6(2),t.MGl("id","importVAT",n,""),t.Q6J("ngModel",i.VAT)("disabled",!0),t.xp6(2),t.MGl("id","importNetmant",n,""),t.Q6J("ngModel",i.NETAMOUNT)("disabled","EDIT"==s.tranMode)}}function Jt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),t._uU(4,"IMPORT DOCUMENT DETAILS"),t.qZA(),t.TgZ(5,"div",7),t.YNc(6,Qt,2,1,"button",8),t.TgZ(7,"button",9),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onclear())})("keydown.F3",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onclear())}),t._uU(8,"RESET"),t.qZA(),t.YNc(9,Ht,2,2,"button",10),t.TgZ(10,"button",11),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(11,"CANCEL"),t.qZA()()(),t.TgZ(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16)(17,"span",17),t._uU(18,"Import Document No:"),t.qZA(),t.TgZ(19,"div",18)(20,"input",19,20),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO=s)}),t.qZA()()(),t.TgZ(22,"div",16),t._uU(23),t.TgZ(24,"fieldset",21)(25,"legend",22)(26,"input",23),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s)})("change",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s.target.checked?1:0)}),t.qZA(),t._uU(27,"Do Accounting of VAT Amount"),t.qZA(),t.TgZ(28,"div",14)(29,"span",24),t._uU(30,"VAT Credit A/C:"),t.qZA(),t.TgZ(31,"div",25)(32,"input",26),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=s)})("keydown.Enter",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.AccountEnterCommand(s))}),t.qZA()()()()()(),t.TgZ(33,"div",27)(34,"div",16)(35,"span",28),t._uU(36,"L/C No.:"),t.qZA(),t.TgZ(37,"div",18)(38,"input",29),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM=s)}),t.qZA()(),t.TgZ(39,"div",30)(40,"button",31),t.NdJ("keydown.Enter",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.loadImportDetails())})("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.loadImportDetails())}),t._uU(41,"LOAD INVOICE DETAIL"),t.qZA()()(),t.TgZ(42,"div",16)(43,"span",28),t._uU(44,"Declare VAT:"),t.qZA(),t.TgZ(45,"div",18)(46,"input",32),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT=s)})("keydown.enter",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onDeclareVat(s.target.value))})("input",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onDeclareVat(s.target.value))}),t.qZA()(),t.TgZ(47,"div",30)(48,"button",31),t.NdJ("keydown.Enter",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.loadAdditionalCost())})("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.loadAdditionalCost())}),t._uU(49,"LOAD FROM ADDITIONAL COST"),t.qZA()()()()(),t.TgZ(50,"div",14)(51,"label",33),t._uU(52,"Import Details "),t.qZA()(),t.TgZ(53,"div",14)(54,"div",34)(55,"table",35)(56,"thead")(57,"tr",36)(58,"th",37),t._uU(59,"Sn."),t.qZA(),t.TgZ(60,"th",38),t._uU(61,"Item Name"),t.qZA(),t.TgZ(62,"th",39),t._uU(63,"Qty"),t.qZA(),t.TgZ(64,"th",39),t._uU(65,"Taxable"),t.qZA(),t.TgZ(66,"th",39),t._uU(67,"Non-Taxable"),t.qZA(),t.TgZ(68,"th",39),t._uU(69,"VAT"),t.qZA(),t.TgZ(70,"th",39),t._uU(71,"Net amount"),t.qZA()()(),t.TgZ(72,"tbody",40),t.YNc(73,Yt,17,20,"tr",41),t.qZA()()()(),t.TgZ(74,"div",14)(75,"table",35)(76,"tr",42)(77,"th",43),t._uU(78,"TOTAL"),t.qZA(),t.TgZ(79,"th",44),t._uU(80),t.qZA(),t.TgZ(81,"th",44),t._uU(82),t.qZA(),t.TgZ(83,"th",44),t._uU(84),t.qZA(),t.TgZ(85,"th",44),t._uU(86),t.qZA(),t.TgZ(87,"th",44),t._uU(88),t.qZA()()()()()()()()}if(2&T){const i=t.oxw();t.xp6(6),t.Q6J("ngIf","NEW"==i._trnMainService.TrnMainObj.Mode),t.xp6(1),t.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),t.xp6(2),t.Q6J("ngIf","VIEW"==i._trnMainService.TrnMainObj.Mode),t.xp6(11),t.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)("disabled","EDIT"==i.tranMode),t.xp6(3),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport," "),t.xp6(3),t.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)("disabled","EDIT"==i.tranMode),t.xp6(6),t.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME)("disabled","EDIT"==i.tranMode),t.xp6(6),t.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)("disabled","EDIT"==i.tranMode),t.xp6(2),t.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),t.xp6(6),t.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)("disabled","EDIT"==i.tranMode),t.xp6(2),t.Q6J("disabled",null==i._trnMainService.TrnMainObj.ProdList[0].MENUCODE)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),t.xp6(25),t.Q6J("ngForOf",i._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),t.xp6(7),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALQTY," "),t.xp6(2),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE," "),t.xp6(2),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE,""),t.xp6(2),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,""),t.xp6(2),t.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.NETAMOUNT,"")}}let qt=(()=>{class T{constructor(i,n,s,p,A,ie){this.masterservice=i,this._trnMainService=n,this.spinnerService=s,this.alertservice=p,this.authservice=A,this.importPurchaseService=ie,this.productList=[],this.importrowindex=0,this.DoVatAmtAccountForImport=!0,this.loadFromAdditionalCost=!1,this.genericGridCreditAccountSetting=new J.im,this.userSetting=this.authservice.getSetting(),null==n.TrnMainObj.IMPORTDETAILS&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={})}onclear(){this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.masterservice.allowAddNextRow=!0,this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1,this.addRow()}closeDialog(){"NEW"==this._trnMainService.TrnMainObj.Mode?this._trnMainService.TrnMainObj?.IMPORTDETAILS?.prodList?.filter(i=>i.ITEMNAME)?.length>0?confirm("Applied Import Details will be removed. Click OK to confirm!")&&(this.onclear(),this.isActive=!1):(this.onclear(),this.isActive=!1):this.isActive=!1}show(){this.isActive=!0,setTimeout(()=>{document.getElementById("documentno").focus()},500),(!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList||!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length||null==this._trnMainService.TrnMainObj.IMPORTDETAILS)&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.addRow()),this.productList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.MENUCODE),console.log("product list",this.productList)}hide(){this.isActive=!1}ok(){if(console.log("IMPORTDETAILS",this._trnMainService.TrnMainObj.IMPORTDETAILS),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=this.DoVatAmtAccountForImport?1:0,("NEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode)&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C")}this.isActive=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}addRow(){try{console.log("add row"),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push({})}catch(n){console.log(n),alert(n)}}rowClick(i){this.importrowindex=i}focusToQty(){let i=this.importrowindex;setTimeout(()=>{document.getElementById("importQty"+i).focus()},200);var n=this.masterservice.groupBy(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList,function(s){return[s.ITEMNAME]});for(const s of n)if(s.length>1)return void this.alertservice.warning("Cannot enter same item")}nextRow(i){if(""==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME)return void this.alertservice.info("Item Description is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].QUANTITY))return void this.alertservice.info("Quantity is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NONTAXABLE)){if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].TAXABLE))return void this.alertservice.info("Taxable amount is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].VAT))return void this.alertservice.info("Vat amount is missing")}if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NETAMOUNT))return void this.alertservice.info("Net Amount is missing");this.RecalculateImportDetails();let n=this.importrowindex+1;1==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),this.addRow(),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200)),0==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200))}enterName(i){setTimeout(()=>{document.getElementById("importQty"+i).focus()},200)}RecalculateImportDetails(){try{this._trnMainService.TrnMainObj.IMPORTDETAILS&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this._trnMainService.calculateImportProdTotalValue()}catch(i){this.alertservice.info("Error in import details calculation: "+i)}}initializeTotalCalcProperty(){}onNonTaxableChange(){this.RecalculateImportDetails()}onTaxableChange(){this.RecalculateImportDetails()}onVatChange(){this.RecalculateImportDetails()}onQuantityChange(){this.RecalculateImportDetails()}deleteRow(i){confirm("Are you sure you want to delete this row ?")&&(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.splice(i,1),0===this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this.addRow())}loadImportDetails(){this.loadFromAdditionalCost=!1,this.masterservice.allowAddNextRow=!1,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.initializeTotalCalcProperty();for(const i of this._trnMainService.TrnMainObj.ProdList){let n={};n.ITEMNAME=i.ITEMDESC,n.QUANTITY=i.Quantity,n.VAT=1==i.ISVAT?(i.AMOUNT-i.DISCOUNT)*this.userSetting.VATRate:0,n.TAXABLE=0,n.NONTAXABLE=0,n.ISVAT=i.ISVAT,1==i.ISVAT&&(n.TAXABLE=i.AMOUNT-i.DISCOUNT),0==i.ISVAT&&(n.NONTAXABLE=i.AMOUNT-i.DISCOUNT),n.NETAMOUNT=n.TAXABLE+n.NONTAXABLE+n.VAT,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(n),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),this._trnMainService.calculateImportProdTotalValue()}this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}onDeclareVat(i){this.loadFromAdditionalCost?this.calculationForLoadFromAdditionalCost(this.loadFromAdditionalCostResponse):this.loadImportDetails(),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.filter(n=>1==n.ISVAT).forEach(n=>{n.VAT=this._trnMainService.nullToZeroConverter(Number((this._trnMainService.nullToZeroConverter(n.TAXABLE)/this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE*i).toFixed(2))),n.TAXABLE=this._trnMainService.nullToZeroConverter(n.VAT)/this.masterservice.userSetting.VATRate,n.NETAMOUNT=this._trnMainService.nullToZeroConverter(n.TAXABLE)+n.VAT}),this.adjustDifferenceInDeclareVatAndActualVat(),this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.AdditionalObj.VATAMNT=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,this._trnMainService.TrnMainObj.AdditionalObj.TAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE,this._trnMainService.TrnMainObj.AdditionalObj.NONTAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE}adjustDifferenceInDeclareVatAndActualVat(){const i=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.map(A=>A.VAT).reduce((A,ie)=>A+ie,0),n=Number((i-this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT).toFixed(2));let s=0,p=0;for(let A of this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)1==A.VAT&&(p=s),s++;if(Math.abs(n)>0){const ie=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[p];ie.VAT=Number(n<0?(ie.VAT+Math.abs(n)).toFixed(2):(ie.VAT-n).toFixed(2))}}removeInvalidRowFromImportDetils(i){return i.filter(n=>null!=n.ITEMNAME&&null!=n.ITEMNAME)}saveImportDetails(){if("VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C");if(this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT!=this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)return void this.alertservice.info("Declare vat and Total Vat amount is  not equall")}this.spinnerService.show("Saving import details....."),this._trnMainService.TrnMainObj.IMPORTDETAILS.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,this.masterservice.saveImportDetail(this._trnMainService.TrnMainObj.IMPORTDETAILS).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.alertservice.success("Import details saved Successfully !"),setTimeout(()=>{this.hide()},1200)):(this.spinnerService.hide(),this.alertservice.error(i.result))},i=>{this.spinnerService.hide(),this.alertservice.error(i)})}AccountEnterCommand(i){this.genericGridCreditAccountSetting={title:"Accounts",apiEndpoints:"/getAccountPagedListByMapId/Master/default",defaultFilterIndex:1,columns:[{key:"ACCODE",title:"AC CODE",hidden:!1,noSearch:!1},{key:"ACNAME",title:"A/C NAME",hidden:!1,noSearch:!1}]},this.genericGridCreditAccount.show()}onAccountSelect(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC=i.ACID,this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=i.ACNAME}calculationForLoadFromAdditionalCost(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.spinnerService.hide();for(const n of i){let s={};s.ITEMNAME=n.ITEMDESC,s.QUANTITY=n.Quantity,s.NETAMOUNT=n.NETAMOUNT,s.VAT=n.VAT,s.ISVAT=n.ISVAT,s.NONTAXABLE=0,1==n.ISVAT&&(s.TAXABLE=n.TAXABLE),0==n.ISVAT&&(s.NONTAXABLE=n.AMOUNT-n.DISCOUNT),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(s),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)}this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}loadAdditionalCost(){this.spinnerService.show("Loading Data, Please Wait...."),this.importPurchaseService.loadAdditionalCostDetailsInImportPI(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{i&&(this.loadFromAdditionalCost=!0,this.loadFromAdditionalCostResponse=i,this.calculationForLoadFromAdditionalCost(i))},i=>{this.spinnerService.hide(),this.alertservice.error(i.error)})}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(y.p),t.Y36(j.V),t.Y36(H.c),t.Y36(oe.e),t.Y36(Zt))},T.\u0275cmp=t.Xpm({type:T,selectors:[["import-purchase-details"]],viewQuery:function(i,n){if(1&i&&t.Gf(Ft,5),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGridCreditAccount=s.first)}},hostBindings:function(i,n){1&i&&t.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,t.evT)},inputs:{tranMode:"tranMode"},decls:3,vars:2,consts:[["class","importdetail_container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridCreditAccount",""],[1,"importdetail_container"],[1,"card"],[1,"card-header",2,"background","#cbcbcb"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"disabled","keydown.F6","click",4,"ngIf"],["type","button","title","reset",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click","keydown.F3"],["title","SaveImportDetails","type","button","class","btn btn-info","style","margin-right:2px",3,"disabled","click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-horizontal",2,"margin-top","15px"],[1,"row"],[1,"col-md-6","pd0"],[1,"form-group","row",2,"align-items","center"],[1,"col-sm-4","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7"],["id","documentno","type","text","placeholder","Import Document No","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],["DocumentNo",""],[2,"width","89%","border-radius","3px"],[1,"legend-class",2,"font-size","14px","width","45%"],["type","checkbox","id","vatAmountAccounting",2,"margin-right","3%",3,"ngModel","disabled","ngModelChange","change"],[1,"col-sm-3","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7",2,"margin-left","50px"],["type","text","autocomplete","off","placeholder","Press Enter to Select Account",1,"form-control",2,"width","113%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[1,"col-md-6"],[1,"col-sm-2","form-control-label","font",2,"margin-left","-12px"],["type","text","placeholder","L/C No.","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],[1,"col-sm-3"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.Enter","click"],["type","number","placeholder","Enter VAT amount","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange","keydown.enter","input"],[1,"form-control-label",2,"font-weight","bold","border-bottom","1px solid #e2e2e2","width","130px !important"],[1,"col-md-12","pd0",2,"height","40vh","margin-bottom","1rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","5%"],[2,"background-color","aliceblue"],["style","height: 28px;",3,"click","keydown.Shift.delete",4,"ngFor","ngForOf"],[2,"line-height","1.2rem"],["width","11%",2,"background","rgb(172 172 172)","border","2px white solid"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["title","SaveImportDetails","type","button",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click"],[2,"height","28px",3,"click","keydown.Shift.delete"],[2,"width","1%"],[2,"width","10%"],["type","text","list","product","autocomplete","off",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","focus"],["id","product"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","keydown.tab"],[3,"value"]],template:function(i,n){1&i&&(t.YNc(0,Jt,89,23,"div",0),t.TgZ(1,"generic-popup-grid",1,2),t.NdJ("onItemDoubleClick",function(p){return n.onAccountSelect(p)}),t.qZA()),2&i&&(t.Q6J("ngIf",n.isActive),t.xp6(1),t.Q6J("popupsettings",n.genericGridCreditAccountSetting))},dependencies:[L.sg,L.O5,O.YN,O.Kr,O.Fj,O.wV,O.Wl,O.JJ,O.On,J.Zl],styles:[".importdetail_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:80%;top:20.5%;left:14%}.font[_ngcontent-%COMP%]{font-size:12px;line-height:12px}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem;padding:0 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 4px 5px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}"]}),T})();function Wt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),t._uU(4,"Reverse Entry Confirmation"),t.qZA(),t.TgZ(5,"div",5)(6,"button",6),t.NdJ("keydown.F6",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit())})("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit())}),t._uU(7,"SAVE"),t.qZA(),t.TgZ(8,"button",7),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(9,"CANCEL"),t.qZA()()(),t.TgZ(10,"div",8)(11,"div",9)(12,"label",10),t._uU(13,"Invoice No :"),t.qZA(),t.TgZ(14,"div",11)(15,"input",12),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.AdditionalObj.CREFBILL=s)}),t.qZA()()(),t.TgZ(16,"div",13)(17,"label",14),t._uU(18,"Remarks of Reverse Entry:"),t.qZA(),t.TgZ(19,"div",11)(20,"textarea",15),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.AdditionalObj.CREMARKS=s)}),t.qZA()()()()()()}if(2&T){const i=t.oxw();t.xp6(15),t.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREFBILL),t.xp6(5),t.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREMARKS)}}let $t=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.isActive=!1,this.onClickReverse=new t.vpe}ngOnInit(){}submit(){null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL?null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL.toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL==this._trnMainService.TrnMainObj.VCHRNO?(this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL,this.onClickReverse.emit()):this.alertService.warning(`Character case of ${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed  should also \n      match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning(`${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed should match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning("Enter reverse entry confirmation remarks"):this.alertService.warning("Enter Voucher no.")}closeDialog(){this.isActive=!1}show(i){console.log("SHOWNN",i),this.vchrno=i,this.isActive=!0}hide(){this.isActive=!1}onclear(){}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["reverse-entry-dialog"]],outputs:{onClickReverse:"onClickReverse"},decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label"],[1,"col-md-7"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&t.YNc(0,Wt,21,2,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.O5,O.Fj,O.JJ,O.On],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:57%;top:29.5%;left:26%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}"]}),T})();var zt=b(27389);function Xt(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"button",3),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t.TgZ(3,"span",4),t._uU(4,"\xd7"),t.qZA()(),t._UZ(5,"qrcode",5)(6,"label",6)(7,"label",7),t.TgZ(8,"label",8)(9,"input",9),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.traceIdStatus=s)})("change",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onChangeInput(s))}),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(5),t.Q6J("qrdata",i.qrString)("errorCorrectionLevel","M"),t.xp6(4),t.Q6J("ngModel",i.traceIdStatus)}}let ei=(()=>{class T{constructor(i,n,s,p,A){this._trnMainService=i,this.fb=n,this.masterService=s,this.spinnerService=p,this.alertService=A,this.onRefreshClick=new t.vpe,this.onDialogClosed=new t.vpe,this.onPaymentSuccess=new t.vpe,this.isPaymentSuccess=!1}ngOnInit(){}openSocket(i){i.onopen=function(n){console.log("[open] Connection established"),console.log("Sending to server...")},i.onmessage=function(n){console.log("[message] Data received from server",n.data),this.socketResponseData=JSON.parse(n.data),this.transactionStatus=JSON.parse(this.socketResponseData.transactionStatus),this.transactionStatus.qrVerified?(console.log("enter at tran message"),document.getElementById("qr_response_message").innerHTML="QR Code Verified"):this.transactionStatus.paymentSuccess&&(document.getElementById("qr_response_message").innerHTML="Payment Confirmed",console.log("PAYMENT SUCCESS TRACE ID",this.transactionStatus.traceId),document.getElementById("qr_traceId").innerHTML=this.transactionStatus.traceId)},i.onclose=function(n){console.log("SOCKET CLOSED",n),n.wasClean?console.log(`[close] Connection closed cleanly, code=${n.code} reason=${n.reason}`):console.log("[close] Connection died")},i.onerror=function(n){console.log(`[error] ${n}`)}}messageReceive(i){}show(i,n){let s=new WebSocket(n);this.openSocket(s),this.isActive=!0,this.qrString=i,this.SktURL=n,console.log("response bata k k catch huncha",this.qrString,this.SktURL)}cancelPopup(){this.isActive=!1}closeDialog(){this.isActive=!1,console.log("socket reposnce data",document.getElementById("qr_traceId").innerHTML);let i=document.getElementById("qr_traceId").innerHTML;this.onDialogClosed.emit(i)}refreshClick(){this.masterService.refreshForQRCode=!0,this.onRefreshClick.emit(this.masterService.refreshForQRCode)}onChangeInput(i){"Success"==i.target.defaultValue?(this.isActive=!1,this.isPaymentSuccess=!0,this.closeDialog(),this.onPaymentSuccess.emit(this.isPaymentSuccess)):(this.isActive=!0,this.isPaymentSuccess=!1)}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(y.p),t.Y36(O.qu),t.Y36(f.P),t.Y36(j.V),t.Y36(H.c))},T.\u0275cmp=t.Xpm({type:T,selectors:[["fonepay-QR-popup"]],outputs:{onRefreshClick:"onRefreshClick",onDialogClosed:"onDialogClosed",onPaymentSuccess:"onPaymentSuccess"},decls:1,vars:1,consts:[["class","fonepatQR_container","role","document","style","max-width: 23%; max-height: 500px; margin-left: 31%;",4,"ngIf"],["role","document",1,"fonepatQR_container",2,"max-width","23%","max-height","500px","margin-left","31%"],[1,"card",2,"height","80vh"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px",3,"click"],["aria-hidden","true"],[2,"text-align","center","margin-top","14%","position","inherit",3,"qrdata","errorCorrectionLevel"],["id","qr_response_message"],["id","qr_traceId",2,"color","white"],["id","qr_success",2,"color","white"],["type","text","id","inputTraceSuccess","name","inputTraceSuccess","hidden","",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&t.YNc(0,Xt,10,3,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.O5,O.Fj,O.JJ,O.On,zt.V],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:2px;height:30px;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:14px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 1rem;\n    }\n  \n    .fonepatQR_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      top: 17%;\n      left: 16%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n    }\n\n    .card[_ngcontent-%COMP%]{\n        background-image: url('assets/fonepay-bg.jpg');\n        background-size: cover;\n        width: 100%;\n        height: 100%;\n    }\n\n    label[_ngcontent-%COMP%]{\n      \n      font-size: 14px;\n      margin-left: 5rem;\n      margin-top: 10px;\n    }\n\n    #qr_response_message[_ngcontent-%COMP%]{\n      margin-top: 40%; \n      margin-left: 0;\n      color: seagreen;\n      width: 100%;\n      text-align: center;\n      font-weight: 500;\n      font-size: large;\n    }"]}),T})();function $e(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",15)(1,"button",16),t.NdJ("click",function(){const p=t.CHM(i).$implicit,A=t.oxw(2);return t.KtG(A.showQR(p))}),t.qZA()()}if(2&T){const i=E.$implicit,n=t.oxw(2);t.xp6(1),t.Udp("background-image","url(assets/Images/"+i+".png)"),t.Q6J("disabled",n.isButtonDisabled)("value",i)}}function ti(T,E){if(1&T&&t._UZ(0,"img",21),2&T){const i=t.oxw(3);t.Q6J("src",i.qrString,t.LSH)}}function ii(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",17)(1,"button",18),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.closeDialogQR())}),t.TgZ(2,"span",19),t._uU(3,"\xd7"),t.qZA()(),t.YNc(4,ti,1,1,"img",20),t.qZA()}if(2&T){const i=t.oxw(2);t.xp6(4),t.Q6J("ngIf",i.qrString)}}function ni(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"button",7),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t.TgZ(4,"span",8),t._uU(5,"\xd7"),t.qZA()()(),t.TgZ(6,"div",9)(7,"h3",10),t._uU(8,"Please Select The Payment Method:"),t.qZA()(),t.YNc(9,$e,2,4,"div",11),t.TgZ(10,"div",12),t._UZ(11,"label",13),t.qZA()(),t.YNc(12,ii,5,1,"div",14),t.qZA()}if(2&T){const i=t.oxw();t.xp6(9),t.Q6J("ngForOf",i.mocoChannels),t.xp6(3),t.Q6J("ngIf",i.isActiveQR)}}let ri=(()=>{class T{constructor(i){this.masterService=i,this.onDialogClosed=new t.vpe,this.isButtonDisabled=!1}ngOnInit(){}showdata(i,n,s,p){this.isActiveShowChannel=!0,this.mocoChannels=i,this.selectedValue=this.mocoChannels[0],this.TenderAmt=n,this.CompanyId=s,this.trnmode=p}closeDialog(){this.isActiveShowChannel=!1,this.isActiveQR=!1}showQR(i){this.guid=_(),this.selectedValue=i,this.isButtonDisabled=!0,document.getElementById("qr_response_message").innerHTML="FetchingQR<br>Please wait...",this.masterService.getPaymentGateWayForMoco(this.TenderAmt,this.guid,this.CompanyId,this.trnmode,this.selectedValue).subscribe(n=>{if(this.isButtonDisabled=!1,"ok"==n.status&&n.result){document.getElementById("qr_response_message").innerHTML="pending",this.qrString=n.result,this.isActiveQR=!0;const s=this.qrString.split("/");this.token=s[s.length-2],this.rrn=n.result2,this.check()}else document.getElementById("qr_response_message").innerHTML="Please try again"},n=>{this.isButtonDisabled=!1,document.getElementById("qr_response_message").innerHTML="Please try again"})}check(){1==this.isActiveQR&&this.masterService.mococheck(this.token,this.selectedValue,this.rrn).subscribe(i=>{if("ok"==i.status)if(this.result=i.result,"Pending"==this.result)setTimeout(()=>{console.log("pending"),this.check()},5e3);else if("Approved"==this.result)console.log(i.result),this.onDialogClosed.emit(this.rrn),document.getElementById("qr_response_message").innerHTML=" Payment<br>Confirmed",setTimeout(()=>{this.isActiveQR=!1},1e3);else{if("Rejected"!=this.result)return void console.log(i.result);console.log(i.result)}})}closeDialogQR(){this.isActiveShowChannel=!0,this.isActiveQR=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-moco"]],hostBindings:function(i,n){1&i&&t.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,t.evT)},outputs:{onDialogClosed:"onDialogClosed"},decls:8,vars:1,consts:[["lang","en"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["class","mocoBody",4,"ngIf"],[1,"mocoBody"],[1,"MocoChannel_container"],[1,"close"],["aria-label","Close",2,"background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","20px"],[1,"div1"],[1,"heading"],["class","div2",4,"ngFor","ngForOf"],[1,"div3"],["id","qr_response_message"],["class","MOCOQR_container","role","document",4,"ngIf"],[1,"div2"],["type","button",1,"icon",3,"disabled","value","click"],["role","document",1,"MOCOQR_container"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px","background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","30px"],["alt","QR Code",3,"src",4,"ngIf"],["alt","QR Code",3,"src"]],template:function(i,n){1&i&&(t.TgZ(0,"html",0)(1,"head"),t._UZ(2,"meta",1)(3,"meta",2),t.TgZ(4,"title"),t._uU(5,"Fonepay QR Container"),t.qZA()(),t.TgZ(6,"body"),t.YNc(7,ni,13,2,"div",3),t.qZA()()),2&i&&(t.xp6(7),t.Q6J("ngIf",n.isActiveShowChannel))},dependencies:[L.sg,L.O5],styles:["body[_ngcontent-%COMP%] {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 0;\n    }\n\n    .mocoBody[_ngcontent-%COMP%] {\n      position: fixed;\n      z-index: 999999;\n      width: 100%;\n      height: 100%;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-between;\n      max-width: 400px;\n      max-height: 90vh;\n      background: #fffdfd;\n      border: 3px solid lightgray;\n      border-radius: 20px;\n      z-index: 99999;\n      padding-top: 20px;\n      padding-bottom: 20px\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      padding: 0;\n      font-size: 20px;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n      width: 200px;\n      margin-left: 5rem;\n      margin-top: 47px;\n      font-size: 14px;\n      padding: 5px;\n      height: auto;\n      padding-left: 68px;\n    }\n\n    .heading[_ngcontent-%COMP%] {\n      font-size: 20px;\n      font-weight: bold;\n      margin-bottom: 10px;\n      display: inline;\n\n    }\n\n\n    #qr_response_message[_ngcontent-%COMP%] {\n      margin-top: 11%;\n      color: seagreen;\n      text-align: center;\n      font-weight: 600;\n      font-size: large;\n      display: inline;\n    }\n\n    \n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div1[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-left: 37px;\n      width: 318px;\n      height: 23px;\n      left: 0px;\n      top: 45px;\n      position: absolute;\n      color: #1B62A3;\n      font-size: 16px;\n      font-family: Plus Jakarta Sans;\n      font-weight: 500;\n      word-wrap: break-word\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n\n      margin-left: 37px;\n      margin-top: -116px;\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div2[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      display: contents;\n      padding-bottom: 50px;\n\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div3[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-top: -46px;\n      align-self: center;\n      top: 346px;\n      position: absolute;\n      color: #0a0a0a;\n      font-size: 20px;\n      font-family: Plus Jakarta Sans;\n      font-weight: bold;\n      word-wrap: break-word\n    }\n\n\n\n\n    button[_ngcontent-%COMP%] {\n      margin-top: 117px;\n      padding: 6px 14px;\n      background-color: #007bff;\n      color: #ffffff;\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      font-size: 10px;\n      margin-left: 344px;\n      height: 26;\n    }\n\n    button.close[_ngcontent-%COMP%] {\n      color: #000;\n      background-color: transparent;\n\n    }\n\n    button[_ngcontent-%COMP%]:hover {\n      background-color: #0056b3;\n    }\n\n    .icon[_ngcontent-%COMP%] {\n      height: 60px;\n      width: 120px;\n      margin-left: 36px;\n      margin-right: 35px;\n      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\n\n      transition: border-color 0.2s;\n      margin-top: 65px;\n      margin-bottom: 0px;\n    }\n\n    .icon[_ngcontent-%COMP%]:hover {\n\n      background-color: #da3434;\n      transform: scale(1.1);\n      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);\n    }\n\n    .MOCOQR_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      max-height: 0;\n      top: -1%;\n      left: 22%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n      max-width: 23%;\n      margin-left: 31%;\n    }"]}),T})();var ze=b(89952);const oi=["genericGridAccount"],si=["fonePay"],ai=["moco"],ci=["genericGridSalesReturnVoucher"];function li(T,E){1&T&&t._UZ(0,"div",9)}function di(T,E){if(1&T&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&T){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.PAYMENTMODENAME)}}function hi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",82)(1,"div",48)(2,"button",83),t.NdJ("click",function(){const p=t.CHM(i).$implicit,A=t.oxw(2);return t.KtG(A.onClickTrnMode(p))}),t.TgZ(3,"span"),t._UZ(4,"img"),t.qZA(),t.YNc(5,di,2,1,"span",33),t.qZA()()()}if(2&T){const i=E.$implicit,n=t.oxw(2);t.xp6(2),t.Udp("background-image",n.logoURL(i.PAYMENTMODENAME)),t.ekj("clickedbutton",n.trnmode===i.PAYMENTMODENAME),t.Q6J("ngClass",i.noHoverEffect?"nohovereffect":"payment-button"),t.xp6(3),t.Q6J("ngIf",i.showAltText)}}function ui(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div")(1,"div",84)(2,"div",36)(3,"label",85),t._uU(4,"Account:"),t.qZA()(),t.TgZ(5,"div",37)(6,"input",86),t.NdJ("keydown.enter",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.showAccountList())}),t.qZA()()()()}}function pi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",84)(1,"div",36)(2,"label",85),t._uU(3,"CN No:"),t.qZA()(),t.TgZ(4,"div",37)(5,"input",87),t.NdJ("keydown.enter",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.showCreditNoteList())}),t.qZA()()()}}function _i(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td",88),t._uU(2),t.qZA(),t.TgZ(3,"td",89),t._uU(4),t.ALo(5,"number"),t.qZA(),t.TgZ(6,"td",90),t._uU(7),t.qZA(),t.TgZ(8,"td",91)(9,"button",92),t.NdJ("click",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.deletePayDetails(p))}),t._uU(10,"Remove"),t.qZA()()()}if(2&T){const i=E.$implicit;t.xp6(2),t.Oqu(i.TRNMODE),t.xp6(2),t.Oqu(t.xi3(5,3,i.ACTUALAMOUNT,"1.2-2")),t.xp6(3),t.Oqu(i.REMARKS)}}const Ti=function(T){return{tooltipChild:T}};function Mi(T,E){if(1&T){const i=t.EpF();t.ynx(0),t.TgZ(1,"span",93),t.NdJ("mouseleave",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.hoverLeaveDiscount())}),t.qZA(),t.BQk()}if(2&T){const i=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(2,Ti,1==i.hover))("innerHTML",i.hoverText,t.oJD)}}function mi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"h5"),t._uU(5,"BILL TENDER"),t.qZA(),t.TgZ(6,"h6",14),t._uU(7),t.qZA(),t.TgZ(8,"div",15)(9,"button",16),t.NdJ("keydown.F6",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit(s.form.value))})("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit())}),t._uU(10,"SAVE [End]"),t.qZA(),t.TgZ(11,"button",17),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(12,"CANCEL [Esc]"),t.qZA()()()(),t.TgZ(13,"div")(14,"form",18)(15,"div",19)(16,"div",20)(17,"div",21)(18,"ul",22)(19,"li",23)(20,"a",24),t._uU(21,"Payment Info"),t.qZA()()(),t.TgZ(22,"div",25)(23,"div",26)(24,"div",27)(25,"div",28)(26,"div",29)(27,"div"),t.YNc(28,hi,6,6,"div",30),t.qZA()()(),t.TgZ(29,"div",31)(30,"div",32),t.YNc(31,ui,7,0,"div",33),t.YNc(32,pi,6,0,"div",34),t.TgZ(33,"div",35)(34,"div",36)(35,"label"),t._uU(36,"Amount:"),t.qZA()(),t.TgZ(37,"div",37)(38,"input",38),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.changeAmount(s))})("keydown.enter",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.AmountOnEnter(s))})("keyup",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.rateChange(s))})("focusout",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.rateFocusOut(s))}),t.ALo(39,"twoDigitNumber"),t.qZA()()(),t.TgZ(40,"div",39)(41,"div",40)(42,"button",41),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.BalanceAmount())}),t._uU(43,"Balance Amount"),t.qZA()(),t.TgZ(44,"div",42)(45,"button",43),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.AddPayment())}),t._uU(46,"Add"),t.qZA()()(),t.TgZ(47,"div",44)(48,"div",45)(49,"div")(50,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("1"))}),t._uU(51,"1"),t.qZA()(),t.TgZ(52,"div")(53,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("2"))}),t._uU(54,"2"),t.qZA()(),t.TgZ(55,"div")(56,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("3"))}),t._uU(57,"3"),t.qZA()()(),t.TgZ(58,"div",45)(59,"div")(60,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("4"))}),t._uU(61,"4"),t.qZA()(),t.TgZ(62,"div")(63,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("5"))}),t._uU(64,"5"),t.qZA()(),t.TgZ(65,"div")(66,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("6"))}),t._uU(67,"6"),t.qZA()()(),t.TgZ(68,"div",45)(69,"div")(70,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("7"))}),t._uU(71,"7"),t.qZA()(),t.TgZ(72,"div")(73,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("8"))}),t._uU(74,"8"),t.qZA()(),t.TgZ(75,"div")(76,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("9"))}),t._uU(77,"9"),t.qZA()()(),t.TgZ(78,"div",45)(79,"div")(80,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("."))}),t._uU(81,"."),t.qZA()(),t.TgZ(82,"div")(83,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.pressKey("0"))}),t._uU(84,"0"),t.qZA()(),t.TgZ(85,"div")(86,"button",46),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(87,"Back"),t.qZA()()(),t.TgZ(88,"div",47)(89,"div",48)(90,"button",49),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.clearEntries())}),t._uU(91,"Clear"),t.qZA()()(),t.TgZ(92,"div",47)(93,"div",48)(94,"button",49),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.AddPayment())}),t._uU(95,"Enter"),t.qZA()()()()()(),t.TgZ(96,"div",50)(97,"fieldset",51)(98,"div")(99,"table",52)(100,"thead",53)(101,"tr",54)(102,"th",55),t._uU(103,"Mode"),t.qZA(),t.TgZ(104,"th",56),t._uU(105,"Amount"),t.qZA(),t.TgZ(106,"th",57),t._uU(107,"Account"),t.qZA(),t._UZ(108,"th",58),t.qZA()(),t.TgZ(109,"tbody",59),t.YNc(110,_i,11,6,"tr",60),t.qZA()()(),t.TgZ(111,"table",61)(112,"tbody",62)(113,"tr")(114,"td"),t._uU(115,"Tender Amount :"),t.qZA(),t.TgZ(116,"td",63),t._uU(117),t.ALo(118,"number"),t.qZA()(),t.TgZ(119,"tr")(120,"td"),t._uU(121,"Bill Amount :"),t.qZA(),t.TgZ(122,"td",63),t._uU(123),t.ALo(124,"number"),t.qZA()(),t.TgZ(125,"tr")(126,"td"),t._uU(127,"Due Amount :"),t.qZA(),t.TgZ(128,"td",63),t._uU(129),t.ALo(130,"number"),t.qZA()(),t.TgZ(131,"tr")(132,"td"),t._uU(133,"Change Amount :"),t.qZA(),t.TgZ(134,"td",63),t._uU(135),t.ALo(136,"number"),t.qZA()()()()()()()()()()(),t.TgZ(137,"div",64)(138,"fieldset",65)(139,"div",66)(140,"div",67)(141,"label",68),t._uU(142,"Gross:"),t.qZA()(),t.TgZ(143,"div",69)(144,"label",70),t._uU(145),t.ALo(146,"number"),t.qZA()()(),t.TgZ(147,"div",66)(148,"div",67)(149,"label",68),t._uU(150,"Discount:"),t.qZA()(),t.TgZ(151,"div",69)(152,"label",71),t.NdJ("mouseover",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.hoverDiscount())}),t._uU(153),t.ALo(154,"number"),t.qZA(),t.YNc(155,Mi,2,4,"ng-container",33),t.qZA()(),t.TgZ(156,"div",66)(157,"div",67)(158,"label",72),t._uU(159,"Taxable Amount:"),t.qZA()(),t.TgZ(160,"div",69)(161,"label",70),t._uU(162),t.ALo(163,"number"),t.qZA()()(),t.TgZ(164,"div",66)(165,"div",67)(166,"label",73),t._uU(167,"Non-Taxable Amount:"),t.qZA()(),t.TgZ(168,"div",69)(169,"label",70),t._uU(170),t.ALo(171,"number"),t.qZA()()(),t.TgZ(172,"div",66)(173,"div",67)(174,"label",68),t._uU(175,"VAT:"),t.qZA()(),t.TgZ(176,"div",69)(177,"label",70),t._uU(178),t.ALo(179,"number"),t.qZA()()(),t.TgZ(180,"div",66)(181,"div",67)(182,"label",68),t._uU(183,"Net Amount:"),t.qZA()(),t.TgZ(184,"div",69)(185,"label",70),t._uU(186),t.ALo(187,"number"),t.qZA()()(),t.TgZ(188,"div",74)(189,"div",75)(190,"label",76),t._uU(191,"Due Amount:"),t.qZA()(),t.TgZ(192,"div",77)(193,"label",78),t._uU(194),t.ALo(195,"number"),t.qZA()()(),t.TgZ(196,"div",79)(197,"div",80)(198,"label",76),t._uU(199,"Change Amount:"),t.qZA()(),t.TgZ(200,"div",81)(201,"label",78),t._uU(202),t.ALo(203,"number"),t.qZA()()()()()()()()()()}if(2&T){const i=t.oxw();t.xp6(7),t.hij(" : ",i.trnmode," "),t.xp6(2),t.Q6J("disabled",i.form.invalid),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(14),t.Q6J("ngForOf",i.paymentmodelist),t.xp6(3),t.Q6J("ngIf","CREDIT"==i.TenderMode||"CREDITCARD"==i.TenderMode||"OTHER"==i.TenderMode),t.xp6(1),t.Q6J("ngIf","salesreturnvoucher"==i.modevalue),t.xp6(6),t.Q6J("value",i.applyPipeInRate?t.lcZ(39,23,i.form.get("INPUTAMOUNT").value):i.form.get("INPUTAMOUNT").value)("readonly","Sales Return Voucher"==i.trnmode),t.xp6(4),t.Q6J("disabled","Sales Return Voucher"==i.trnmode),t.xp6(68),t.Q6J("ngForOf",i.paymentinfoList),t.xp6(7),t.Oqu(t.xi3(118,25,i.TENDERAMOUNT,"1.2-2")),t.xp6(6),t.Oqu(t.xi3(124,28,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),t.xp6(6),t.Oqu(t.xi3(130,31,i.DUEAMOUNT,"1.2-2")),t.xp6(6),t.Oqu(t.xi3(136,34,i.CHANGEAMOUNT,"1.2-2")),t.xp6(10),t.Oqu(t.xi3(146,37,i._trnMainService.TrnMainObj.GROSSAMNT,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(154,40,i._trnMainService.TrnMainObj.TOTALDISCOUNT,"1.2-2")),t.xp6(2),t.Q6J("ngIf",i._trnMainService.TrnMainObj.TOTALDISCOUNT>0),t.xp6(7),t.Oqu(t.xi3(163,43,i._trnMainService.TrnMainObj.TAXABLE,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(171,46,i._trnMainService.TrnMainObj.NONTAXABLE,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(179,49,i._trnMainService.TrnMainObj.VATAMNT,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(187,52,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(195,55,i.DUEAMOUNT,"1.2-2")),t.xp6(8),t.Oqu(t.xi3(203,58,i.CHANGEAMOUNT,"1.2-2"))}}let gi=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.okClicked=new t.vpe,this.isSubmitting=!1,this.isSubmitted=!1,this.onSave=new t.vpe,this.isActive=!1,this.mode="add",this.paymentinfoList=[],this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.gridPopupSettingsForAccount=new J.im,this.gridPopupSettingsForSalesReturn=new J.im,this.applyPipeInRate=!0,this.modeType="",this.TenderMode="",this.modevalue="",this.mainText="",this.hover=!1,this.hoverText="",this.totalFlatDiscount=0,this.forminit(),this.AppMode=k.N.appMode}get isTenderFormDisabled(){return this.moco.isActiveShowChannel||this.fonePay.isActive}ngOnInit(){}forminit(){this.initilizeForm(),this.masterService.masterGetmethod("/gettransactionmodes").subscribe(i=>{"ok"==i.status&&(this.paymentmodelist=i.result,this.paymentmodelist.forEach(n=>{n.character=n.ShortCutKey}),this.checkImage(this.paymentmodelist))},i=>{})}initilizeForm(){this.form=this.fb.group({INPUTAMOUNT:[""],TRNMODE:[""],BANKNAME:[""],ACID:[""]})}logoURL(i){return`url(assets/Images/${i.toUpperCase().replace(/\s/g,"")}.png`}submit(){if(!("salesreturnvoucher"==this._trnMainService.TrnMainObj.TRNMODE&&this.TENDERAMOUNT-this._trnMainService.TrnMainObj.NETAMNT>1e-5)||confirm("Bill Amount is Less Than Sales Return Voucher Amount. Do You Want To Proceed Anyway ?")){if(this.DUEAMOUNT>0)return void this.alertService.warning("Bill amount is due ! Cannot save..");this.paymentinfoList.filter(i=>"FONEPAY"==i.TRNMODE?.toUpperCase()&&"EPAYMENT"==i.MODE?.toUpperCase())[0]&&!this.validateFonepayTransaction()||this.paymentinfoList.filter(i=>"MOCO"==i.TRNMODE?.toUpperCase())[0]&&!this.validateMocoTransaction()||(this.isSubmitting=!0,console.log("list",this.paymentinfoList),this.okClicked.emit(this.paymentinfoList),this._trnMainService.onFlatDiscountClear(),this._trnMainService.discountSelectionEdit=!1)}}validateFonepayTransaction(){let i=this.paymentinfoList.filter(n=>"FONEPAY"==n.TRNMODE?.toUpperCase())[0];if(i)return null!=i.TRANSACTIONID&&null!=i.TRANSACTIONID&&""!=i.TRANSACTIONID||(this.alertService.warning("Transaction ID for FonePay not received yet. Cannot Save"),!1)}validateMocoTransaction(){let i=this.paymentinfoList.filter(n=>"MOCO"==n.TRNMODE?.toUpperCase())[0];if(i)return!!i.TRANSACTIONID||(console.log(i.TRANSACTIONID),this.alertService.warning("Payment is Not Completed"),!1)}onclear(){this.form.reset(),this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentinfoList=[],this.payDetails={}}closeDialog(){this.onclear(),this.isActive=!1}refreshClickHit(i){this.refreshHitValue=i,this.refreshHitValue&&this.AddPayment()}keyPress(i){const s=String.fromCharCode(i.charCode);/[0-9]/.test(s)||i.preventDefault()}show(){this.isActive=!0;let i=this.paymentmodelist.filter(n=>"Cash"===n.PAYMENTMODENAME)[0];this.onClickTrnMode(i),this.form.get("INPUTAMOUNT").enable(),this.payDetails.ACID=this.paymentmodelist.filter(n=>"CASH"===n.PAYMENTMODENAME?.toUpperCase())[0]?.ACID,setTimeout(()=>{document.getElementById("amountField").focus()},1e3)}hide(){this.onclear(),this.isActive=!1}AmountOnEnter(i){i.preventDefault();let n=i.target.value;0==n||null==n||null==n||""==n?this.BalanceAmount():this.AddPayment()}AddPayment(){if(this.payDetails.TRNMODE=this.form.get("TRNMODE").value,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),0==this._trnMainService.nullToZeroConverter(this.payDetails.TENDERAMT))return;let i=this.form.get("BANKNAME").value?.toUpperCase(),n=this.payDetails.TRNMODE;this.assignACIDValue(n,i),"FONEPAY"==n.toUpperCase()&&this.implementPhonePayLogic(),"MOCO"==this.payDetails.TRNMODE.toUpperCase()&&this.implementMOCOLogic();let s=this.paymentmodelist.filter(p=>p.PAYMENTMODENAME==this.payDetails.TRNMODE)[0]?.ACNAME;this.prepareRemarks(s),this.PaymentValidation(),this.initializeForm()}initializeForm(){this.form.patchValue({INPUTAMOUNT:null,BANKNAME:null})}assignACIDValue(i,n){this.payDetails.ACID="Sales Return Voucher"==i?this.form.get("ACID").value:"CREDIT"==this.TenderMode?.toUpperCase()||"CREDITCARD"==this.TenderMode?.toUpperCase()||"OTHER"==this.TenderMode?.toUpperCase()?this.paymentAccountList.filter(s=>s.ACNAME?.toUpperCase()===n)[0].ACID:this.paymentmodelist.find(s=>s.PAYMENTMODENAME==this.trnmode).ACID}prepareRemarks(i){console.log("tendermode",i,this.TenderMode),this.payDetails.REMARKS="FonePay"==this.payDetails.TRNMODE?"FonePay":"Sales Return Voucher"==this.payDetails.TRNMODE?this.form.get("BANKNAME").value:"MOCO"==this.payDetails.TRNMODE?"MOCO":"CREDIT"==this.TenderMode||"CREDITCARD"==this.TenderMode||"OTHER"==this.TenderMode?this.form.get("BANKNAME").value:i}implementPhonePayLogic(){this.payDetails.ACID=this.paymentmodelist.filter(i=>"FONEPAY"===i.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),this.payDetails.REMARKS="FonePay","EPAYMENT"==this.TenderMode?.toUpperCase()&&(this.guid=_(),this.masterService.getPaymentGateWayInfo(this.payDetails.TENDERAMT,this.guid,this.masterService.userProfile.CompanyInfo.COMPANYID,this.payDetails.TRNMODE).subscribe(i=>{"ok"==i.status&&(this.fonePayQRCode=i.result,this.scoketURL=i.result2,this.fonePay.show(this.fonePayQRCode,this.scoketURL))}))}implementMOCOLogic(){if(this.payDetails.ACID=this.paymentmodelist.filter(p=>"MOCO"===p.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),0==this.payDetails.TENDERAMT)return void this.alertService.info("Please Enter Tender Amount!");let i,n=this.payDetails.TENDERAMT,s=this.payDetails.TRNMODE;this.masterService.getMocoChannel().subscribe(p=>{"ok"==p.status&&(i=p.result,this.moco.showdata(i,n,this.masterService.userProfile.CompanyInfo.COMPANYID,s))})}BalanceAmount(){this.form.patchValue({INPUTAMOUNT:this.DUEAMOUNT}),this.masterService.focusAnyControl("amountField")}deletePayDetails(i){this.paymentinfoList.splice(i,1),this.totalCalculations(),this.genericFocus("Credit Card"==this.form.controls.TRNMODE.value||"Credit"==this.form.controls.TRNMODE.value?"accountfield":"salesreturnvoucher"==this.form.controls.TRNMODE.value?"cnnofield":"amountField")}onClickTrnMode(i){if(console.log("mvalue",i),i){let n=i.PAYMENTMODENAME;if(this.modeType=i.MODETYPE,this.TenderMode=i.MODE,this.modevalue=i.MODEVALUE,"EPAYMENT"==this.TenderMode?.toUpperCase()&&!i.GatewayInfo)return void this.alertService.info("Selected EPayment service is not activated yet!");this.form.patchValue({TRNMODE:n,INPUTAMOUNT:null,BANKNAME:null}),this.trnmode=n,this.TenderMode=this.TenderMode?.toUpperCase(),"CREDIT"==this.TenderMode||"CREDITCARD"==this.TenderMode||"OTHER"==this.TenderMode&&"Sales Return Voucher"!=n?(this.onpaymentmodechange(n),this.genericFocus("accountfield")):"Cash"==n?(this.form.get("INPUTAMOUNT").enable(),this.genericFocus("amountField")):"Sales Return Voucher"==n?(this.onpaymentmodechange(n),this.genericFocus("cnnofield")):(this.onpaymentmodechange(n),this.genericFocus("amountField"))}}totalCalculations(){this.TENDERAMOUNT=0,this.paymentinfoList?.length&&this.paymentinfoList.forEach(i=>this.TENDERAMOUNT+=i.AMOUNT),this.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT<1e-5?0:this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT,this.CHANGEAMOUNT=this.TENDERAMOUNT>this._trnMainService.TrnMainObj.NETAMNT?this.TENDERAMOUNT-this._trnMainService.TrnMainObj.NETAMNT:0}changeAmount(i){(null==i||null==i||0==i)&&(this.mainText="")}applyamount(i){}clearEntries(){this.mainText="",this.form.patchValue({INPUTAMOUNT:null})}pressKey(i){this.mainText+=i,this.form.patchValue({INPUTAMOUNT:this.mainText})}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}onpaymentmodechange(i){this.paymentAccountList=[];var n=this.paymentmodelist.filter(s=>(s.PAYMENTMODENAME??"").toUpperCase()==i.toUpperCase())[0];!this.validateBeforePaymentmodeChange(n)||(i&&(this._trnMainService.TrnMainObj.TRNMODE=n.MODEVALUE),this._trnMainService.TrnMainObj.TRNAC=null!=n.ACID&&""!=n.ACID?n.ACID:"",("CREDIT"==this.TenderMode?.toUpperCase()||"CREDITCARD"==this.TenderMode?.toUpperCase()||"OTHER"==this.TenderMode?.toUpperCase())&&this.masterService.masterGetmethod("/getpaymentmodelist?paymentmodename="+encodeURIComponent(i)).subscribe(s=>{"ok"==s.status?this.paymentAccountList=JSON.parse(s.result):alert(s.result)},s=>{alert(s)}))}validateBeforePaymentmodeChange(i){return!(null==this.paymentmodelist||0==this.paymentmodelist.length||null==i)}AddTender(i,n,s){let p={};p.TRNMODE=i.TRNMODE,p.VCHRNO=this.TrnmainObj.VCHRNO,p.DIVISION=this.TrnmainObj.DIVISION,p.REMARKS=i.REMARKS,p.AMOUNT=n,p.ACTUALAMOUNT=n,p.ACCOUNT=i.ACID,p.CARDNO=i.CARDNO,p.APPROVALCODE=i.APPROVALCODE,p.CARDHOLDERNAME=i.CARDHOLDERNAME,p.CHANGE=0,p.MODE=s,p.ADDRESS=i.ADDRESS,p.VATNO=i.VATNO,p.modevalue=this.modevalue,this.handleCashModeSecanarioWhileAddingTender(p,n,i),this.paymentinfoList.push(p),this.totalCalculations()}handleCashModeSecanarioWhileAddingTender(i,n,s){let p=0;"CASH"===s.TRNMODE.toUpperCase()&&(this._trnMainService.userProfile.CASH_AC&&this._trnMainService.userProfile.CASH_AC_NAME&&(i.ACCOUNT=this._trnMainService.userProfile.CASH_AC,i.REMARKS=this._trnMainService.userProfile.CASH_AC_NAME),p=n<this.getAmountWOCash()?n:this.getAmountWOCash(),i.ACTUALAMOUNT=p,i.CHANGE=n-i.ACTUALAMOUNT)}getAmountWOCash(){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.filter(i=>"CASH"!==i.TRNMODE.toUpperCase()).map(i=>i.AMOUNT).reduce((i,n)=>i+n,0)}getAmountWCash(){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.map(i=>i.AMOUNT).reduce((i,n)=>i+n,0)}PaymentValidation(){let i=this.payDetails.TRNMODE.toUpperCase();if("CASH"==i){var n=this.paymentinfoList.filter(s=>"Cash"==s.TRNMODE)[0];if(n)return void this.calculateCashAmount(n)}else if("CREDIT"==i||"CREDIT CARD"==i){if(!this.validatePaymentInCreditAndCard(i))return;if(this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return void this.validateDiscountAmount(0,this.DUEAMOUNT);if(this.payDetails.TENDERAMT>this._trnMainService.TrnMainObj.NETAMNT)return void this.alertService.info("Tender Amount is Greater Than Net Amount")}else if("Sales Return Voucher"==i&&this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return void this.validateDiscountAmount(1,this.DUEAMOUNT);console.log("detail",this.payDetails,this.TenderMode),this.AddTender(this.payDetails,this.payDetails.TENDERAMT,this.TenderMode)}validateDiscountAmount(i,n){if(0==this._trnMainService.nullToZeroConverter(n))return;let s="";0==i&&(s="Tender amount should not be greater than Due B/L Amount."),1==i&&(s='Total amount of the Voucher: "+ this.payDetails.REMARKS +" ,should not be greater than Due B/L Amount.'),this.alertService.emitShowHideSubject.subscribe(p=>{setTimeout(()=>{this.masterService.focusAnyControl("amountField")},0)})}calculateCashAmount(i){let n=0,s=this.getAmountWCash();n=this.payDetails.TENDERAMT<s?this.payDetails.TENDERAMT:this.getAmountWCash(),i.AMOUNT=this.payDetails.TENDERAMT,i.ACTUALAMOUNT=this.payDetails.TENDERAMT,this.totalCalculations()}validatePaymentInCreditAndCard(i){let n=this.paymentinfoList.filter(s=>"CREDIT"==s.TRNMODE.toUpperCase()||"CREDIT CARD"==s.TRNMODE.toUpperCase());if(this.paymentinfoList.length&&n.length>0){if("CREDIT"==i&&n.length>0){let s="";return s=this.paymentinfoList.filter(p=>p.REMARKS==this.payDetails?.REMARKS)?.length>0?"Amount already set for this party account ":"Cannot add amount for two different party accounts",this.alertService.info(s),!1}if(this.paymentinfoList.filter(s=>s.REMARKS==this.payDetails.REMARKS).length>0){let s="";return"CREDIT CARD"==i?s="Cannot add amount from same bank":"CREDIT"==i&&(s="Cannot add amount from party account"),this.alertService.info(s),!1}}return!0}checkBankName(i){let n=this.form.get("BANKNAME"),s=this.form.get("INPUTAMOUNT");""==n.value||null==n.value||null==n.value?s.disable():s.enable()}handleKeyDownboardEvent(i){if(!0===this.isActive){"Escape"==i.code?this.isTenderFormDisabled||(i.preventDefault(),this.closeDialog()):"End"==i.code&&(i.preventDefault(),1==this.isActive&&0!=this._trnMainService.nullToZeroConverter(this.TENDERAMOUNT)&&(console.log("save payment"),this.paymentinfoList?.length>0&&this.submit()));let s=this.paymentmodelist.filter(p=>p.ShortCutKey==i.code)[0];if(null!=s)i.preventDefault(),1==this.isActive&&this.onClickTrnMode(s);else if("PageUp"==i.code){if(1==this.isActive){let p=this.getIndex();console.log("index",p),this.onClickTrnMode(0==p?this.paymentmodelist[0]:this.paymentmodelist[p-1])}}else if("PageDown"==i.code&&1==this.isActive){let p=this.getIndex();this.onClickTrnMode(p==this.paymentmodelist.length-1?this.paymentmodelist[this.paymentmodelist.length-1]:this.paymentmodelist[p+1])}}}getIndex(){return this.paymentmodelist.lastIndexOf(this.paymentmodelist.filter(i=>i.PAYMENTMODENAME==this.form.get("TRNMODE").value)[0])}showAccountList(){this.gridPopupSettingsForAccount={title:"Account List",apiEndpoints:"/getpaymentmodepagedlist",defaultFilterIndex:1,columns:[{key:"ACID",title:"Account ID",hidden:!1,noSearch:!1},{key:"ACNAME",title:"Account Name",hidden:!1,noSearch:!1},{key:"VATNO",title:"VatNo",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"Address",hidden:!1,noSearch:!1},{key:"MOBILE",title:"Mobile",hidden:!1,noSearch:!1}]},this.genericGridAccount.show()}showCreditNoteList(){this.gridPopupSettingsForSalesReturn={title:"Credit Note List",apiEndpoints:"/getpaymentmodepagedlist",defaultFilterIndex:1,columns:[{key:"VCHRNO",title:"Voucher no.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Net amount",hidden:!1,noSearch:!1,pipe:!0,alignment:"right"}]},this.genericGridSalesReturnVoucher.show()}onAccountSelected(i){this._trnMainService.TrnMainObj.CREDITLIMIT=i.CRLIMIT,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this.TenderMode&&"CREDIT"==this.TenderMode.toUpperCase()&&this.replacePreviousCustomerWithTenderModeCustomer(this._trnMainService.TrnMainObj,i),this.masterService.getCustomerwiseCreditLimit(i.ACID,this._trnMainService.TrnMainObj.TRNDATE).subscribe(n=>{this._trnMainService.TrnMainObj.BLAMOUNT=n.BL}),this.form.patchValue({BANKNAME:i.ACNAME}),this.genericFocus("amountField")}replacePreviousCustomerWithTenderModeCustomer(i,n){i.PARAC=n.ACID,i.BILLTO=n.ACNAME,i.BILLTOADD=n.ADDRESS,i.BILLTOTEL=n.VATNO,i.RECEIVEBY=n.CUSTID}onQrDialogClosed(i){this.paymentinfoList.find(s=>"FonePay"==s.TRNMODE).TRANSACTIONID=i}onDialogClosedMoco(i){this.paymentinfoList.find(s=>"MOCO"==s.TRNMODE).TRANSACTIONID=i}onSalesReturnVoucherSelect(i){this.form.patchValue({BANKNAME:i.VCHRNO,INPUTAMOUNT:i.NETAMNT,ACID:i.TRNAC})}checkImage(i){if(console.log("item",this.paymentmodelist),i.length>0)for(const n of i){const s=new Image;s.src=`assets/Images/${n.PAYMENTMODENAME.toUpperCase().replace(/\s/g,"")}.png`,s.onload=()=>{n.showAltText=!1,n.noHoverEffect=!0},s.onerror=p=>{n.showAltText=!0,n.noHoverEffect=!1}}}genericFocus(i){setTimeout(()=>{document.getElementById(i).focus()},500)}hoverDiscount(){this.hover=!0,this.totalFlatDiscount=this._trnMainService.TrnMainObj.ProdList.reduce((i,n)=>i+(n.FLATDISCOUNT??0),0),0!==this._trnMainService.TrnMainObj.TOTALDISCOUNT&&(this.hoverText=`<span>Indv Discount </span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT).toFixed(2)} <br>\n                  <span>Flat Discount</span> : ${this._trnMainService.nullToZeroConverter(this.totalFlatDiscount).toFixed(2)} <br> \n                  <span>Loyalty Discount</span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLOYALTY).toFixed(2)} <br>\n                  <span>Promotional Discount </span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPROMOTION).toFixed(2)}\n    `)}hoverLeaveDiscount(i){this.hover=!1}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["payment-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(t.Gf(oi,5),t.Gf(si,5),t.Gf(ai,5),t.Gf(ci,5)),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGridAccount=s.first),t.iGM(s=t.CRH())&&(n.fonePay=s.first),t.iGM(s=t.CRH())&&(n.moco=s.first),t.iGM(s=t.CRH())&&(n.genericGridSalesReturnVoucher=s.first)}},hostBindings:function(i,n){1&i&&t.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,t.evT)},outputs:{okClicked:"okClicked",onSave:"onSave"},decls:10,vars:4,consts:[["class","backdrop",4,"ngIf"],["class","payment-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridAccount",""],["genericGridSalesReturnVoucher",""],[3,"onRefreshClick","onDialogClosed"],["fonePay",""],[3,"onDialogClosed"],["moco",""],[1,"backdrop"],[1,"payment-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[2,"position","relative","top","3px"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"form-horizontal",2,"margin-top","15px",3,"formGroup"],[1,"row","col-sm-12"],[1,"col-sm-10",2,"margin-top","-15px","margin-left","-15px"],[1,"tabbable",2,"margin-left","-15px"],[1,"nav","nav-tabs",2,"background-color","#138496"],[1,"nav-item"],["href","#payment-info","data-toggle","tab",1,"nav-link","active"],[1,"tab-content"],["id","payment-info",1,"tab-pane","active"],[1,"row","col-sm-12",2,"margin-top","5px"],[1,"col-sm-1",2,"position","relative","top","6px","left","-25px"],[1,"payment-mode-container"],["class","form-group row","style","margin-bottom: 10px !important;",4,"ngFor","ngForOf"],[1,"col-sm-5",2,"padding-left","0px","padding-right","15px","left","80px","max-width","37%"],[1,"col-sm-12",2,"background-color","#f7f7f7","margin-left","0px","border","solid 2px #999999","height","25rem","padding","5px 0px 0px"],[4,"ngIf"],["class","form-group row","style","margin-bottom: 0px !important;",4,"ngIf"],[1,"form-group","row","col-md-12","pd0",2,"margin-bottom","0px !important"],[1,"col-md-3"],[1,"col-sm-9"],["id","amountField","type","number","formControlName","INPUTAMOUNT",1,"form-control",2,"font-size","13px !important","font-weight","500","text-align","center",3,"value","readonly","ngModelChange","keydown.enter","keyup","focusout"],[1,"form-group","row",2,"margin-bottom","5px !important","justify-content","space-around","width","95%","padding-left","15px"],[1,"col-sm-6","pl-0"],["type","button",1,"btn","btn-info",2,"width","100%",3,"disabled","click"],[1,"col-sm-6",2,"padding-left","50px","padding-right","0px"],["type","button",1,"btn","btn-info",2,"width","100%","margin-right","0px",3,"click"],[2,"position","relative","top","1rem","padding-right","12px"],[1,"form-group","row","keypad-row"],["type","button",1,"btn","number-button",3,"click"],[1,"form-group","row",2,"margin-bottom","5px !important"],[1,"col"],["type","button",1,"btn","large-button",3,"click"],[1,"col-sm-6",2,"position","relative","left","60px","padding","0px 8px","max-width","49%"],[2,"height","25rem","border","2px solid #999999"],[1,"table-striped"],[2,"background-color","#63bbb2"],[2,"position","sticky","top","0","line-height","1.5rem"],["scope","col",2,"width","7%","padding-left","6px"],["scope","col",2,"width","10%","text-align","right","padding-right","1rem"],["scope","col",2,"width","14%"],["scope","col",2,"width","4%"],[1,"bodytable"],[4,"ngFor","ngForOf"],[1,"table-striped",2,"width","100%","position","relative","top","1rem","border","1.5px solid #c3c3c3"],[1,"total"],[2,"text-align","right"],[1,"col-sm-2"],[1,"fieldset-class"],[1,"col-sm-12","row","amount-section"],[1,"col-sm-6","pd0"],[1,"totalLabel"],[1,"col-sm-6","p-0"],[1,"totalValue","pull-right"],[1,"totalValue","pull-right",3,"mouseover"],[1,"totalLabel",2,"width","6rem"],[1,"totalLabel",2,"width","7rem","font-size","11px"],[1,"col-md-12","row","p-0",2,"position","relative","top","5rem","margin-right","0px"],[1,"col-md-6","pd0"],[1,"amountLabel"],[1,"col-md-6","pd0",2,"text-align","left"],[1,"amountValue","pull-right"],[1,"col-md-12","row","p-0",2,"position","relative","top","6rem","margin-right","0px"],[1,"col-md-7","pd0"],[1,"col-md-5","pd0",2,"text-align","left"],[1,"form-group","row",2,"margin-bottom","10px !important"],["type","button",1,"btn",3,"ngClass","click"],[1,"form-group","row",2,"margin-bottom","0px !important"],[2,"padding-top","5px"],["id","accountfield","formControlName","BANKNAME","placeholder","Press Enter to Select Account","autocomplete","off","readonly","",1,"form-control",2,"width","93%","padding","0px 5px",3,"keydown.enter"],["id","cnnofield","type","text","formControlName","BANKNAME","placeholder","Press Enter to Select Credit note voucher","autocomplete","off","readonly","",1,"form-control",2,"font-size","12px !important",3,"keydown.enter"],[2,"width","7%","padding-left","6px"],[2,"width","10%","text-align","right","padding-right","1rem"],[2,"width","14%","font-size","11px"],[2,"width","4%"],["type","button",1,"btn","btn-danger",2,"font-size","10px","padding","1px","line-height","15px",3,"click"],[2,"display","none",3,"ngClass","innerHTML","mouseleave"]],template:function(i,n){1&i&&(t.YNc(0,li,1,0,"div",0),t.YNc(1,mi,204,61,"div",1),t.TgZ(2,"generic-popup-grid",2,3),t.NdJ("onItemDoubleClick",function(p){return n.onAccountSelected(p)}),t.qZA(),t.TgZ(4,"generic-popup-grid",2,4),t.NdJ("onItemDoubleClick",function(p){return n.onSalesReturnVoucherSelect(p)}),t.qZA(),t.TgZ(6,"fonepay-QR-popup",5,6),t.NdJ("onRefreshClick",function(p){return n.refreshClickHit(p)})("onDialogClosed",function(p){return n.onQrDialogClosed(p)}),t.qZA(),t.TgZ(8,"app-moco",7,8),t.NdJ("onDialogClosed",function(p){return n.onDialogClosedMoco(p)}),t.qZA()),2&i&&(t.Q6J("ngIf",n.isActive),t.xp6(1),t.Q6J("ngIf",n.isActive),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettingsForAccount),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForSalesReturn))},dependencies:[L.mk,L.sg,L.O5,O._Y,O.Fj,O.wV,O.JJ,O.JL,O.sg,O.u,J.Zl,ei,ri,L.JJ,ze.g],styles:[".payment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:32rem;border:2px solid lightslategrey}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:13px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover{background-color:#138496;border-color:#117a8b;color:#fff;transform:scale(1.04)}.clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.btn[_ngcontent-%COMP%]{background-size:contain;background-repeat:no-repeat;background-position:center}.nohovereffect[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:14px;color:#138496;transition-duration:.3s}.nohovereffect[_ngcontent-%COMP%]:hover{border-color:#117a8b;transform:scale(1.04)}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:14px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}.keypad-row[_ngcontent-%COMP%]{margin-bottom:5px!important;width:100%;justify-content:space-between;padding-left:15px}.amount-section[_ngcontent-%COMP%]{margin-left:0;padding-left:0;padding-right:0;margin-right:0}.payment-mode-container[_ngcontent-%COMP%]{max-height:400px;width:-moz-fit-content;width:fit-content;overflow-y:scroll;overflow-x:hidden;padding:2px}.tooltipChild[_ngcontent-%COMP%]{display:block!important;position:absolute;border-radius:15px;text-align:left;color:#f9f6f6;width:max-content;padding:2px;background-color:#1f7748;z-index:9999;opacity:1;box-shadow:0 4px 8px #0003}"]}),T})();const vi=["genericGridSupplier"],ot=["genericGridRecurringItem"];function Si(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.saveRecurringLog())}),t._uU(1,"SAVE [End]"),t.qZA()}}function fi(T,E){1&T&&(t.TgZ(0,"th",24),t._uU(1,"Discontinue"),t.qZA())}function Oi(T,E){if(1&T&&(t.TgZ(0,"option",36),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.Q6J("value",i.category),t.xp6(1),t.Oqu(i.category)}}function bi(T,E){if(1&T&&(t.TgZ(0,"option",36),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.Q6J("value",i.MONTH),t.xp6(1),t.Oqu(i.NAME)}}function Ci(T,E){1&T&&t._UZ(0,"option",36),2&T&&t.Q6J("value",E.$implicit.COST_CENTER)}function Ai(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",38)(1,"input",47),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.STATUS=s)}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit;t.xp6(1),t.MGl("id","recurStatus",n,""),t.Q6J("ngModel",s.STATUS)}}function Ei(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr",30),t.NdJ("click",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.recurringRowClick(p))}),t.TgZ(1,"td",31),t._uU(2),t.qZA(),t.TgZ(3,"td",32),t._uU(4),t.qZA(),t.TgZ(5,"td",32)(6,"input",33),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.PARENT_NAME=s)})("keydown.enter",function(s){t.CHM(i);const p=t.oxw(3);return t.KtG(p.recurringItemEnter(s))})("focus",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.recurringRowClick(p))}),t.qZA()(),t.TgZ(7,"td",34)(8,"select",35),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.CATEGORY=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("recurAmount"+p))}),t._UZ(9,"option",36),t.YNc(10,Oi,2,2,"option",37),t.qZA()(),t.TgZ(11,"td",38)(12,"input",39),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.AMOUNT=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("recurMonth"+p))}),t.qZA()(),t.TgZ(13,"td",34),t._uU(14),t.ALo(15,"date"),t.qZA(),t.TgZ(16,"td",34)(17,"select",40),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.RECURRING_MONTH=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("recurDate"+p))})("change",function(){const s=t.CHM(i),p=s.$implicit,A=s.index,ie=t.oxw(3);return t.KtG(ie.addRecurringMonth(p,A))}),t._UZ(18,"option",36),t.YNc(19,bi,2,2,"option",37),t.qZA()(),t.TgZ(20,"td",41)(21,"input",42),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.RECURRING_DATE=s)})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("recurVendor"+p))}),t.qZA()(),t.TgZ(22,"td",34)(23,"input",43),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.COST_CENTER=s)}),t.qZA(),t.TgZ(24,"datalist",44),t.YNc(25,Ci,1,1,"option",37),t.qZA()(),t.TgZ(26,"td",34)(27,"input",45),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.REMARKS=s)})("keydown.enter",function(s){t.CHM(i);const p=t.oxw(3);return t.KtG(p.remarksEnter(s))}),t.qZA()(),t.YNc(28,Ai,2,2,"td",46),t.qZA()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(3);t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(i.NAME),t.xp6(2),t.MGl("id","recurItemName",n,""),t.Q6J("disabled","view"==s.mode)("ngModel",i.PARENT_NAME),t.xp6(2),t.MGl("id","recurCategory",n,""),t.Q6J("ngModel",i.CATEGORY)("disabled","view"==s.mode),t.xp6(2),t.Q6J("ngForOf",s.recurringItemCategory),t.xp6(2),t.MGl("id","recurAmount",n,""),t.Q6J("ngModel",i.AMOUNT)("disabled","view"==s.mode),t.xp6(2),t.hij(" ",t.xi3(15,29,i.LAST_RECUR_DATE,"mm-DD-yyy")," "),t.xp6(3),t.MGl("id","recurMonth",n,""),t.Q6J("ngModel",i.RECURRING_MONTH)("disabled","view"==s.mode),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Q6J("ngForOf",s.recurringmodelist),t.xp6(2),t.MGl("id","recurDate",n,""),t.Q6J("ngModel",i.RECURRING_DATE)("disabled","view"==s.mode),t.xp6(2),t.MGl("id","recurVendor",n,""),t.Q6J("ngModel",i.COST_CENTER)("disabled","view"==s.mode),t.xp6(2),t.Q6J("ngForOf",s.costcenterlist),t.xp6(2),t.MGl("id","recurRemarks",n,""),t.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),t.xp6(1),t.Q6J("ngIf","edit"==s.mode)}}function Ii(T,E){if(1&T&&(t.TgZ(0,"div",17)(1,"div",7)(2,"h6"),t._uU(3,"Recurring Item Info: "),t.qZA()(),t.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",21),t._uU(9,"Sn."),t.qZA(),t.TgZ(10,"th",22),t._uU(11,"Item Name"),t.qZA(),t.TgZ(12,"th",22),t._uU(13,"Recurring Item Name"),t.qZA(),t.TgZ(14,"th",23),t._uU(15,"Category"),t.qZA(),t.TgZ(16,"th",24),t._uU(17,"Amount"),t.qZA(),t.TgZ(18,"th",23),t._uU(19,"Last Recurr Date "),t.qZA(),t.TgZ(20,"th",25),t._uU(21,"Recurring Mode"),t.qZA(),t.TgZ(22,"th",26),t._uU(23,"Recurring Date"),t.qZA(),t.TgZ(24,"th",23),t._uU(25,"Cost Center"),t.qZA(),t.TgZ(26,"th",23),t._uU(27,"Remarks"),t.qZA(),t.YNc(28,fi,2,0,"th",27),t.qZA()(),t.TgZ(29,"tbody",28),t.YNc(30,Ei,29,32,"tr",29),t.qZA()()()()),2&T){const i=t.oxw(2);t.xp6(28),t.Q6J("ngIf","edit"==i.mode),t.xp6(2),t.Q6J("ngForOf",i.recurringItemList)}}function Pi(T,E){1&T&&(t.TgZ(0,"th",24),t._uU(1,"Discontinue"),t.qZA())}function yi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",38)(1,"input",47),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.STATUS=s)}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit;t.xp6(1),t.MGl("id","recurStatus",n,""),t.Q6J("ngModel",s.STATUS)}}function Ge(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr",30),t.NdJ("click",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.commissionRowClick(p))}),t.TgZ(1,"td",50),t._uU(2),t.qZA(),t.TgZ(3,"td",32),t._uU(4),t.qZA(),t.TgZ(5,"td",32),t._uU(6),t.qZA(),t.TgZ(7,"td",51),t._uU(8),t.ALo(9,"number"),t.qZA(),t.TgZ(10,"td",52)(11,"input",45),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.COMMISSION_PERCENTAGE=s)})("ngModelChange",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.commssionrateEnter(p))})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("commissionamount"+p))}),t.qZA()(),t.TgZ(12,"td",52)(13,"input",45),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).index,ie=t.oxw(3);return t.KtG(ie.commissionamountChange(s,A))})("keydown.enter",function(){const p=t.CHM(i).index,A=t.oxw(3);return t.KtG(A.masterService.focusAnyControl("commissionRemarks"+p))}),t.ALo(14,"number"),t.qZA()(),t.TgZ(15,"td",34)(16,"input",45),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.REMARKS=s)})("keydown.enter",function(s){t.CHM(i);const p=t.oxw(3);return t.KtG(p.remarksEnterPress(s))}),t.qZA()(),t.YNc(17,yi,2,2,"td",46),t.qZA()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(3);t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(i.NAME),t.xp6(2),t.hij(" ",i.SALESMANNAME,""),t.xp6(2),t.hij(" ",t.xi3(9,14,i.DEAL_AMOUNT,"1.2-2")," "),t.xp6(3),t.MGl("id","commissionrate",n,""),t.Q6J("ngModel",i.COMMISSION_PERCENTAGE)("disabled","view"==s.mode),t.xp6(2),t.MGl("id","commissionamount",n,""),t.Q6J("ngModel",t.xi3(14,17,i.COMMISSION_AMOUNT,"1.2-2"))("disabled","view"==s.mode),t.xp6(3),t.MGl("id","commissionRemarks",n,""),t.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),t.xp6(1),t.Q6J("ngIf","edit"==s.mode)}}function xi(T,E){if(1&T&&(t.TgZ(0,"div",17)(1,"div",7)(2,"h6"),t._uU(3,"Commission Chargeable Item Info: "),t.qZA()(),t.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",48),t._uU(9,"Sn."),t.qZA(),t.TgZ(10,"th",22),t._uU(11,"Item Name"),t.qZA(),t.TgZ(12,"th",22),t._uU(13,"Salesman"),t.qZA(),t.TgZ(14,"th",23),t._uU(15,"Deal Amount"),t.qZA(),t.TgZ(16,"th",24),t._uU(17,"Comission %"),t.qZA(),t.TgZ(18,"th",49),t._uU(19,"Comission Amount"),t.qZA(),t.TgZ(20,"th",23),t._uU(21,"Remarks"),t.qZA(),t.YNc(22,Pi,2,0,"th",27),t.qZA()(),t.TgZ(23,"tbody",28),t.YNc(24,Ge,18,20,"tr",29),t.qZA()()()()),2&T){const i=t.oxw(2);t.xp6(22),t.Q6J("ngIf","edit"==i.mode),t.xp6(2),t.Q6J("ngForOf",i.comissionItemList)}}function Ri(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h5"),t._uU(5,"Recurring Item Details Info:"),t.qZA(),t.TgZ(6,"div",8),t.YNc(7,Si,2,0,"button",9),t.TgZ(8,"button",10),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(9,"CANCEL [Esc]"),t.qZA()()(),t.TgZ(10,"div",7)(11,"h6"),t._uU(12,"Recurring Log No. :"),t.qZA(),t.TgZ(13,"label",11),t._uU(14),t.qZA(),t.TgZ(15,"h6"),t._uU(16," Customer Name: "),t.qZA(),t.TgZ(17,"label",12),t._uU(18),t.qZA()()(),t.TgZ(19,"div",13)(20,"div",14),t.YNc(21,Ii,31,2,"div",15),t.YNc(22,xi,25,2,"div",15),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(7),t.Q6J("ngIf","view"!=i.mode),t.xp6(7),t.Oqu(i.recurringLogID),t.xp6(4),t.Oqu(i.customerName),t.xp6(3),t.Q6J("ngIf",i.recurringItemList.length>0),t.xp6(1),t.Q6J("ngIf",i.comissionItemList.length>0)}}let Ni=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this._trnMainService=n,this.alertService=s,this.spinnerService=p,this.recurringlogsaved=new t.vpe,this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],this.gridPopupSettingsForSupplier=new X.sG,this.gridPopupSettingsForRecurringItems=new J.im,this.recurringrowIndex=0,this.commissionrowIndex=0}ngOnInit(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&(this.masterService.getRecurringCategoryList().subscribe(i=>{this.recurringItemCategory=i&&i||[]},i=>{this.recurringItemCategory=[]}),this.getRecurringModeList())}ngOnChanges(i){(i.RecurringItems||i.CommissionItems)&&this.LoadItemsIntoLog(),(i.RecurringItemsForEdit||i.CommissionItemsForEdit)&&this.LoadItemsForEdit()}LoadItemsIntoLog(){this.RecurringItems.length>0?(this.spinnerService.show("Loading items, please wait.."),this.RecurringItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,this.spinnerService.hide(),this.recurringItemList.push(n)}),console.log("items loadded",this.recurringItemList,"mian recur id",this.mainRecurringID,"ref id",this.proformaRefBill),""!==this.mainRecurringID&&""!==this.proformaRefBill&&this.loadDetailsFromProforma()):this.recurringItemList=[],this.CommissionItems.length>0?this.CommissionItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,n.DEAL_AMOUNT=i.NETAMOUNT-i.VAT,n.SALESMANNAME=this._trnMainService.TrnMainObj.SALESMAN,n.SALESMAN=this._trnMainService.TrnMainObj.SALESMANID,this.comissionItemList.push(n)}):this.comissionItemList=[]}loadDetailsFromProforma(){console.log("HHHHHHHH");let i={};i.MCODE=this.recurringItemList[0].MCODE,i.ENTRYNO=this.proformaRefBill,this.masterService.getRecurringItemDetails(i).subscribe(n=>{if(console.log("YOOOO",n),"ok"==n.status){this.recurringItemList[0].PARENT_MCODE=n.result.PARENT_MCODE,this.recurringItemList[0].PARENT_NAME=n.result.PARENT_NAME,this.recurringItemList[0].CATEGORY=n.result.CATEGORY,this.recurringItemList[0].AMOUNT=n.result.AMOUNT,this.recurringItemList[0].LAST_RECUR_DATE=n.result.LAST_RECUR_DATE?n.result.LAST_RECUR_DATE.toString().substring(0,10):"",this.recurringItemList[0].COST_CENTER=n.result.COST_CENTER,this.recurringItemList[0].REMARKS=n.result.REMARKS,this.recurringItemList[0].RECURRING_MONTH=n.result.RECURRING_MONTH,this.recurringItemList[0].MAIN_RECURRING_ID=this.mainRecurringID;let s=new Date(this.recurringItemList[0].LAST_RECUR_DATE);s.setMonth(s.getMonth()+Number(this.recurringItemList[0].RECURRING_MONTH)),this.recurringItemList[0].RECURRING_DATE=(0,L.p6)(s,"yyyy-MM-dd","en-US")}})}LoadItemsForEdit(){this.RecurringItemsForEdit.forEach(i=>{i.LAST_RECUR_DATE=i.LAST_RECUR_DATE?i.LAST_RECUR_DATE.toString().substring(0,10):"",i.RECURRING_DATE=i.RECURRING_DATE?i.RECURRING_DATE.toString().substring(0,10):""}),this.recurringItemList=this.RecurringItemsForEdit,this.comissionItemList=this.CommissionItemsForEdit,this.recurringLogID=this.RecurringItemsForEdit[0]?.ENTRYNO,this.customerName=this.RecurringItemsForEdit[0]?.VENDOR_NAME}recurringRowClick(i){this.recurringrowIndex=i}commissionRowClick(i){this.commissionrowIndex=i}closeDialog(){this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],"view"!=this.mode&&"edit"!=this.mode&&(this.RecurringItemsForEdit=[],this.CommissionItemsForEdit=[]),this.recurringLogID="",this.customerName="",this.mainRecurringID="",this.proformaRefBill=""}saveRecurringLog(){if(this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter recurring item for item: ${this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter category for item: ${this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return void this.alertService.warning(`Please make sure Recurring date is set for item: ${this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`);let i=this.recurringItemList.length;if(this.recurringItemList.filter(s=>null==s.AMOUNT||null==s.AMOUNT||0==s.AMOUNT).length>=i)this.alertService.info("Please enter amount for atleast 1 recurring item in Recurring item info !");else{if(this.recurringItemList.filter(s=>null==s.AMOUNT||0==s.AMOUNT||null==s.AMOUNT).length>0&&"ADD"==this.mode.toUpperCase()){if(!confirm("Amount for some recurring items are missing. Are you sure you want to save items with amount only ?"))return;this.recurringItemList=this.recurringItemList.filter(s=>null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)}console.log("recurring list",this.recurringItemList,"commsion list",this.comissionItemList),this.recurringlogsaved.emit({recurringItemList:this.recurringItemList,commissionItemList:this.comissionItemList})}}show(i="add",n="",s=""){console.log("mode",this.mode),console.log("local mode",i,"main recur id",n,"proforma ref bil",s),this.isActive=!0,setTimeout(()=>{document.getElementById("recurItemName0").focus()},500),this.getCostCenterList(),"ADD"==i.toUpperCase()&&(this.customerName=this._trnMainService.TrnMainObj.BILLTO,this.masterService.getVoucherNo({VoucherPrefix:"RL",DIVISION:this.masterService.userProfile.userDivision,PhiscalID:this.masterService.userProfile.PhiscalYearInfo.PhiscalID}).subscribe(p=>{console.log("voucer num recieved",p),"ok"==p.status?this.recurringLogID=p.result.VCHRNO:alert("Failed to retrieve voucherno")})),console.log("load entry details",n,s),this.mainRecurringID=n,this.proformaRefBill=s}getRecurringModeList(){this.masterService.getRecurringModeList().subscribe(i=>{"ok"==i.status?(this.recurringmodelist=i.result?i.result:[],console.log("recurring mode list",this.recurringmodelist)):this.recurringmodelist=[]},i=>{this.recurringmodelist=[]})}getCostCenterList(){this.masterService.getRecurringCostcenterList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{this.costcenterlist=i&&i||[]},i=>{this.costcenterlist=[]})}supplierEnterCommand(i){this.getSupplierList(),this.genericGridSupplier.show()}getSupplierList(){this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,useDefinefilterValue:null,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ACCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"VATNO",title:"VATNO",hidden:!1,noSearch:!1}]}}onSupplierSelected(i){console.log("sppulier select",i),this.recurringItemList[this.recurringrowIndex].VENDOR=i.ACID,this.recurringItemList[this.recurringrowIndex].VENDOR_NAME=i.ACNAME,setTimeout(()=>{document.getElementById("recurRemarks"+this.recurringrowIndex).focus()},500)}recurringItemEnter(i){this.gridPopupSettingsForRecurringItems={title:"Recurring Items",apiEndpoints:"/getRecurringItemPagesList",defaultFilterIndex:0,columns:[{key:"MENUCODE",title:"MENUCODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"ITEM NAME",hidden:!1,noSearch:!1}]},this.genericGridRecurringItem.show()}onRecurringItemSelected(i){console.log("item selecteted",i),this.recurringItemList[this.recurringrowIndex].PARENT_MCODE=i.MCODE,this.recurringItemList[this.recurringrowIndex].PARENT_NAME=i.DESCA,setTimeout(()=>{document.getElementById("recurCategory"+this.recurringrowIndex).focus()},500)}addRecurringMonth(i,n){let s;s=""==i.LAST_RECUR_DATE||null==i.LAST_RECUR_DATE?new Date(this._trnMainService.TrnMainObj.TRNDATE):new Date(i.LAST_RECUR_DATE),s.setMonth(s.getMonth()+Number(i.RECURRING_MONTH));let p=(0,L.p6)(s,"yyyy-MM-dd","en-US");this.recurringItemList[n].RECURRING_DATE=p}commssionrateEnter(i){let n=this.comissionItemList[i];if(console.log("commsission rate enter",n.COMMISSION_PERCENTAGE),n.COMMISSION_PERCENTAGE>100)return this.alertService.warning("Commission % should be limited to 100%"),this.comissionItemList[i].COMMISSION_PERCENTAGE=0,void(this.comissionItemList[i].COMMISSION_AMOUNT=0);n.COMMISSION_AMOUNT=n.DEAL_AMOUNT*(n.COMMISSION_PERCENTAGE/100)}remarksEnter(i){i.preventDefault();let n=this.recurringrowIndex+1;null!=document.getElementById("recurItemName"+n)&&setTimeout(()=>{document.getElementById("recurItemName"+n).focus()},500)}commissionamountChange(i,n){let s=this.comissionItemList[n];s.COMMISSION_AMOUNT=i,s.COMMISSION_PERCENTAGE=s.COMMISSION_AMOUNT/s.DEAL_AMOUNT*100}remarksEnterPress(i){i.preventDefault();let n=this.commissionrowIndex+1;null!=document.getElementById("commissionrate"+n)&&setTimeout(()=>{document.getElementById("commissionrate"+n).focus()},500)}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["recurringlog-popup"]],viewQuery:function(i,n){if(1&i&&(t.Gf(vi,5),t.Gf(ot,5)),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGridSupplier=s.first),t.iGM(s=t.CRH())&&(n.genericGridRecurringItem=s.first)}},inputs:{RecurringItems:"RecurringItems",CommissionItems:"CommissionItems",RecurringItemsForEdit:"RecurringItemsForEdit",CommissionItemsForEdit:"CommissionItemsForEdit",mode:"mode"},outputs:{recurringlogsaved:"recurringlogsaved"},features:[t.TTD],decls:5,vars:3,consts:[["class","recurring-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridSupplier",""],["genericGridRecurringItem",""],[1,"recurring-container"],[1,"card"],[1,"card-header"],[1,"row"],[2,"margin-left","60rem"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"width","8rem"],[2,"width","14rem"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],["style","width: 100%;",4,"ngIf"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],[2,"width","100%"],[1,"col-md-12",2,"height","20vh","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","6%"],["scope","col",2,"width","5%"],["scopr","col",2,"width","6%"],["scope","col",2,"width","0%"],["scope","col","style","width: 5%;",4,"ngIf"],[2,"background-color","aliceblue"],["style"," height:28px;",3,"click",4,"ngFor","ngForOf"],[2,"height","28px",3,"click"],[2,"width","1%"],[2,"width","10%"],["type","text","placeholder","Press Enter to select Item","autocomplete","off",3,"disabled","id","ngModel","ngModelChange","keydown.enter","focus"],[2,"width","6%"],[3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",2,"text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],[2,"width","0%"],["type","date",2,"width","130px",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","text","list","costcenter","autocomplete","off",3,"id","ngModel","disabled","ngModelChange"],["id","costcenter"],["type","text",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["style","width: 5%;",4,"ngIf"],["type","checkbox",2,"height","20px",3,"id","ngModel","change","ngModelChange"],["scope","col",2,"width","2%"],["scope","col",2,"width","8%"],[2,"width","2%"],[2,"width","5%","text-align","right"],[2,"width","8%"]],template:function(i,n){1&i&&(t.YNc(0,Ri,23,5,"div",0),t.TgZ(1,"generic-popup-grid",1,2),t.NdJ("onItemDoubleClick",function(p){return n.onSupplierSelected(p)}),t.qZA(),t.TgZ(3,"generic-popup-grid",1,3),t.NdJ("onItemDoubleClick",function(p){return n.onRecurringItemSelected(p)}),t.qZA()),2&i&&(t.Q6J("ngIf",n.isActive),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettingsForSupplier),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForRecurringItems))},dependencies:[L.sg,L.O5,O.YN,O.Kr,O.Fj,O.wV,O.Wl,O.EJ,O.JJ,O.On,J.Zl,L.JJ,L.uU],styles:[".recurring-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:23%;left:5%}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 3px 2px 4px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}.card-header[_ngcontent-%COMP%]{background-color:silver}label[_ngcontent-%COMP%]{font-size:14px}"]}),T})();var D=b(94619),te=b(6603);const a=["genericGridSupplier"],h=["genericGridRecurringItem"];function d(T,E){if(1&T&&(t.TgZ(0,"option",28),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.s9C("value",i.NAME),t.xp6(1),t.Oqu(i.NAME)}}function g(T,E){if(1&T&&(t.TgZ(0,"option",28),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.s9C("value",i.BATCH),t.xp6(1),t.Oqu(i.BATCH)}}function N(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),t._uU(5,"Stock Variance Adjustment"),t.qZA()()(),t.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"fieldset")(10,"legend",8),t._uU(11,"Warehouse Selection:"),t.qZA(),t.TgZ(12,"select",9),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.warehouse=s)}),t.YNc(13,d,2,2,"option",10),t.qZA()(),t.TgZ(14,"fieldset")(15,"legend",8),t._uU(16,"Batch Selection:"),t.qZA(),t.TgZ(17,"select",11),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.Batch=s)})("change",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.batchSelctionForDate(s.target.value))}),t._UZ(18,"option",12),t.YNc(19,g,2,2,"option",10),t.qZA()(),t.TgZ(20,"fieldset")(21,"legend",8),t._uU(22,"Batch Date:"),t.qZA(),t.TgZ(23,"input",13),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.Date=s)}),t.qZA()()(),t.TgZ(24,"div",7)(25,"fieldset")(26,"legend",8),t._uU(27,"Stock Variance Mode Selection:"),t.qZA(),t.TgZ(28,"div",14)(29,"div",15)(30,"div",16)(31,"input",17),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.reportmode=s)}),t.qZA()(),t.TgZ(32,"div",18)(33,"label",19),t._uU(34,"Excess Stock Adjustment"),t.qZA()()(),t.TgZ(35,"div",15)(36,"div",16)(37,"input",20),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.reportmode=s)}),t.qZA()(),t.TgZ(38,"div",18)(39,"label",21),t._uU(40,"Shortage Stock Adjustment"),t.qZA()()(),t.TgZ(41,"div",15)(42,"div",16)(43,"input",22),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.reportmode=s)}),t.qZA()(),t.TgZ(44,"div",18)(45,"label",21),t._uU(46,"Item than not comes in counting adjustment"),t.qZA()()(),t.TgZ(47,"div",15)(48,"div",16)(49,"input",23),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.stockAdjustObj.reportmode=s)}),t.qZA()(),t.TgZ(50,"div",18)(51,"label",21),t._uU(52,"Item counted but not in C-stock Adjustment"),t.qZA()()()()()()()(),t.TgZ(53,"div",24)(54,"div",25)(55,"button",26),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.run())}),t._uU(56,"Run"),t.qZA(),t.TgZ(57,"button",27),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(58,"Close"),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(12),t.Q6J("ngModel",i.stockAdjustObj.warehouse),t.xp6(1),t.Q6J("ngForOf",i.warehouseList),t.xp6(4),t.Q6J("ngModel",i.stockAdjustObj.Batch),t.xp6(2),t.Q6J("ngForOf",i.BatchSelectionList),t.xp6(4),t.Q6J("ngModel",i.stockAdjustObj.Date),t.xp6(8),t.Q6J("ngModel",i.stockAdjustObj.reportmode),t.xp6(6),t.Q6J("ngModel",i.stockAdjustObj.reportmode),t.xp6(6),t.Q6J("ngModel",i.stockAdjustObj.reportmode),t.xp6(6),t.Q6J("ngModel",i.stockAdjustObj.reportmode)}}let ne=(()=>{class T{constructor(i,n,s,p,A,ie){this.masterService=i,this._trnMainService=n,this.alertService=s,this.adjustmentService=p,this.loadingService=A,this.router=ie,this.isActive=!1,this.warehouseList=[],this.BatchSelectionList=[],this.stockAdjustmentLoaded=new t.vpe,this.gridPopupSettingsForSupplier=new X.sG,this.gridPopupSettingsForRecurringItems=new J.im,this.stockAdjustObj={}}ngOnInit(){this.getWarehouseList()}getWarehouseList(){this.adjustmentService.getWarehouses().subscribe(i=>{this.warehouseList=i})}getBatchList(){this.adjustmentService.getBatchSelectionList().subscribe(i=>{this.BatchSelectionList=i,console.log(this.BatchSelectionList)})}batchSelctionForDate(i){let n;n=this.BatchSelectionList.find(s=>s.BATCH==i),this.stockAdjustObj.Date=n.TRNDATE.substring(0,10),console.log(n)}show(){this.isActive=!0,this.getBatchList()}closeDialog(){this.isActive=!1,this.stockAdjustObj={}}run(){this.stockAdjustmentLoaded.emit(this.stockAdjustObj);let i={BATCH:this.stockAdjustObj.Batch,DATE:this.stockAdjustObj.Date,WARE:this.stockAdjustObj.warehouse,DIVISION:"%",VARIANCEMODE:this.stockAdjustObj.reportmode};this.loadingService.show("Loading data, please wait.."),this.adjustmentService.runBatches(i).subscribe(n=>{console.log("result on save",n),"ok"==n.status?(this.loadingService.hide(),this._trnMainService.TrnMainObj.ProdList=n.result,this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1):(this.loadingService.hide(),this.alertService.info(n.result.error))},n=>{this.loadingService.hide(),this.alertService.info(n)})}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(te.z),t.Y36(j.V),t.Y36(K.F0))},T.\u0275cmp=t.Xpm({type:T,selectors:[["stockadjustment-popup"]],viewQuery:function(i,n){if(1&i&&(t.Gf(a,5),t.Gf(h,5)),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGridSupplier=s.first),t.iGM(s=t.CRH())&&(n.genericGridRecurringItem=s.first)}},outputs:{stockAdjustmentLoaded:"stockAdjustmentLoaded"},decls:1,vars:1,consts:[["class","stockadjustment-container",4,"ngIf"],[1,"stockadjustment-container"],[1,"card"],[1,"card-header"],[1,"row"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],[1,"col-md-6"],[1,"legend-class"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange","change"],["value",""],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[2,"margin-top","4px"],[1,"row",2,"margin-bottom","-3%"],[1,"col-md-1","pd0"],["type","radio","name","reportOption","value","2",1,"radio",3,"ngModel","ngModelChange"],["calss","col"],[1,"variance-font",2,"width","100%"],["type","radio","name","reportOption","value","3",1,"radio",3,"ngModel","ngModelChange"],[2,"width","100%"],["type","radio","name","reportOption","value","5",1,"radio",3,"ngModel","ngModelChange"],["type","radio","name","reportOption","value","4",1,"radio",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"row","pull-right"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[3,"value"]],template:function(i,n){1&i&&t.YNc(0,N,59,9,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.YN,O.Kr,O.Fj,O.EJ,O._,O.JJ,O.On],styles:[".stockadjustment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:23%;left:50%}.card-header[_ngcontent-%COMP%]{background:#bcbebe}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px;height:25px;font-size:12px}fieldset[_ngcontent-%COMP%]{border:1.6px solid #bcbebe}legend[_ngcontent-%COMP%]{font-weight:700;font-size:13px;width:auto;margin-bottom:2px}.radio[_ngcontent-%COMP%]{margin-top:-1px;height:14px}.card-footer[_ngcontent-%COMP%]{padding:5px}"]}),T})(),he=(()=>{class T{transform(i,n){if(i)return""!=n&&null!=n?i.filter(s=>{const p=n.replace(/[^A-Z0-9]/gi,"").toLowerCase();if(-1!==(s.DESCA?s.DESCA.replace(/[^A-Z0-9]/gi,"").toLowerCase():"").indexOf(p))return s}):i}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275pipe=t.Yjl({name:"searchData",type:T,pure:!1}),T})();function Ce(T,E){1&T&&(t.TgZ(0,"th",21),t._uU(1,"BatchId"),t.qZA())}function Le(T,E){if(1&T&&(t.TgZ(0,"td",34),t._uU(1),t.qZA()),2&T){const i=t.oxw().$implicit;t.xp6(1),t.Oqu(i.BATCHID)}}function Ee(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td",26)(2,"input",27),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.CHECKED=s)}),t.qZA()(),t.TgZ(3,"td",28),t._uU(4),t.qZA(),t.TgZ(5,"td",29),t._uU(6),t.qZA(),t.TgZ(7,"td",30),t._uU(8),t.qZA(),t.YNc(9,Le,2,1,"td",31),t.TgZ(10,"td",32),t._uU(11),t.qZA(),t.TgZ(12,"td",33),t._uU(13),t.qZA()()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(2);t.xp6(2),t.Q6J("ngModel",i.CHECKED),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(i.MENUCODE),t.xp6(2),t.Oqu(i.DESCA),t.xp6(1),t.Q6J("ngIf",1==s._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(2),t.Oqu(i.BATCH),t.xp6(2),t.Oqu(i.totalNegativeQty)}}function Ie(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),t._uU(4,"Negative Stock Item List "),t.qZA(),t.TgZ(5,"div",5)(6,"button",6),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t.TgZ(7,"span",7),t._uU(8,"\xd7"),t.qZA()()()(),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"input",11),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.filter=s)}),t.qZA()()()(),t.TgZ(13,"div",12)(14,"table",13)(15,"thead")(16,"tr",14)(17,"th",15)(18,"input",16),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.selectAll(s.target.checked))}),t.qZA()(),t.TgZ(19,"th",17),t._uU(20,"Sn."),t.qZA(),t.TgZ(21,"th",18),t._uU(22,"Item Code"),t.qZA(),t.TgZ(23,"th",19),t._uU(24,"Item Name"),t.qZA(),t.YNc(25,Ce,2,0,"th",20),t.TgZ(26,"th",21),t._uU(27,"Batch"),t.qZA(),t.TgZ(28,"th",22),t._uU(29,"Negative Stock"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,Ee,14,7,"tr",23),t.ALo(32,"searchData"),t.qZA()()(),t.TgZ(33,"div",24)(34,"button",25),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.applyClicked())}),t._uU(35,"Apply"),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(12),t.Q6J("ngModel",i.filter),t.xp6(13),t.Q6J("ngIf",1==i._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(6),t.Q6J("ngForOf",t.xi3(32,3,i.negativeItemStockList,i.filter))}}let Be=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.isActive=!1,this.filter=""}ngOnInit(){}selectAll(i){this.negativeItemStockList.forEach(n=>n.CHECKED=i)}showDialog(i){console.log("negative item.",i),this.negativeItemStockList=i,this.isActive=!0}closeDialog(){this.isActive=!1}applyClicked(){let i;i=this.negativeItemStockList.filter(s=>1==s.CHECKED).map(s=>s.MCODE);let n=[...new Set(i)];this._trnMainService.AutoLoadNegativeStock(n).subscribe(s=>{console.log("auto load neg stock",s),"ok"==s.status?(this._trnMainService.TrnMainObj.ProdList=s.result,this._trnMainService.TrnMainObj.ProdList.forEach(p=>p.isDisabled=!0),this._trnMainService.calculateBatchAdjustmentVariance()):this.alertService.error("Failed to save..."),this.isActive=!1})}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["autoadjustment-popup"]],decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row",2,"margin-top","3px","margin-bottom","-2px"],[1,"col-md-6",2,"margin","2px 0px","display","flex","padding-left","0px","margin-left","-8px"],["type","search","name","filter","autocomplete","off","placeholder","Enter item name to search",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"card-body"],[1,"table","table-striped"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","4%"],["type","checkbox",2,"width","16px",3,"change"],["scope","col",2,"width","3%"],["scope","col",2,"width","6%"],["scope","col",2,"width","20%"],["scope","col","style","width: 10%;",4,"ngIf"],["scope","col",2,"width","10%"],["scope","col",2,"width","8%"],[4,"ngFor","ngForOf"],[1,"card-footer"],["type","button",1,"btn","btn-info",3,"click"],["scope","col",2,"width","5%"],["type","checkbox",2,"position","relative","height","20px","width","16px","margin-left","4px",3,"ngModel","ngModelChange"],[2,"width","3%"],[2,"width","6%"],[2,"width","20%"],["style","width: 13%;",4,"ngIf"],[2,"width","10%"],[2,"width","8%","text-align","center"],[2,"width","13%"]],template:function(i,n){1&i&&t.YNc(0,Ie,36,6,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.Fj,O.Wl,O.JJ,O.On,he],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:25%;left:52%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:3.7vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.8rem;padding:5px}.card-header[_ngcontent-%COMP%]{padding:5px 3px;background:silver}.card-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:43vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px 2px;vertical-align:middle}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:13px}"]}),T})();var Ye=b(19773),Xe=b(35531);let et=(()=>{class T{transform(i,n){if(i)return n?i.filter(s=>{const p=n.replace(/[^A-Z0-9]/gi,"").toLowerCase(),A=s.MENUCODE?s.MENUCODE.replace(/[^A-Z0-9]/gi,"").toLowerCase():"",ie=s.ITEMDESC?s.ITEMDESC.replace(/[^A-Z0-9]/gi,"").toLowerCase():"";if(-1!==A.indexOf(p)||-1!==ie.indexOf(p))return s}):i}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275pipe=t.Yjl({name:"searchId",type:T,pure:!0}),T})();function Oe(T,E){1&T&&(t.TgZ(0,"th",15),t._uU(1,"Edit Checkbox"),t.qZA())}function st(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td")(1,"input",28),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().$implicit,A=t.oxw(2);return t.KtG(A.checkBoxEvent(s,p))}),t.qZA()()}if(2&T){const i=t.oxw().$implicit;t.xp6(1),t.Q6J("checked",i.checked)}}function at(T,E){1&T&&t.GkF(0)}const be=function(){return{updateOn:"blur"}};function ct(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"input",29),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit,A=t.oxw(2);return t.KtG(A.amountChange(s,p))}),t.qZA()}if(2&T){const i=t.oxw().$implicit;t.Q6J("ngModel",i.ALTERNATEQUANTIY)("disabled",!(null!=i&&i.checked))("ngModelOptions",t.DdM(3,be))}}function Ke(T,E){if(1&T&&t._uU(0),2&T){const i=t.oxw().$implicit;t.hij(" ",i.ALTERNATEQUANTIY," ")}}function tt(T,E){1&T&&t.GkF(0)}function Li(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"input",29),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit,A=t.oxw(2);return t.KtG(A.rateChange(s,p))}),t.qZA()}if(2&T){const i=t.oxw().$implicit;t.Q6J("ngModel",i.ALTRATE)("disabled",!(null!=i&&i.checked))("ngModelOptions",t.DdM(3,be))}}function wi(T,E){if(1&T&&t._uU(0),2&T){const i=t.oxw().$implicit;t.hij(" ",i.ALTRATE," ")}}function Di(T,E){if(1&T&&(t.TgZ(0,"tr",19),t.YNc(1,st,2,1,"td",20),t.TgZ(2,"td",19),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td",19),t._uU(7),t.qZA(),t.TgZ(8,"td",19),t._uU(9),t.qZA(),t.TgZ(10,"td",21),t.YNc(11,at,1,0,"ng-container",22),t.YNc(12,ct,1,4,"ng-template",null,23,t.W1O),t.YNc(14,Ke,1,1,"ng-template",null,24,t.W1O),t.qZA(),t.TgZ(16,"td",25),t.YNc(17,tt,1,0,"ng-container",22),t.YNc(18,Li,1,4,"ng-template",null,26,t.W1O),t.YNc(20,wi,1,1,"ng-template",null,27,t.W1O),t.qZA(),t.TgZ(22,"td",19),t._uU(23),t.ALo(24,"number"),t.qZA(),t.TgZ(25,"td",19),t._uU(26),t.ALo(27,"number"),t.qZA(),t.TgZ(28,"td",19),t._uU(29),t.ALo(30,"number"),t.qZA(),t.TgZ(31,"td",19),t._uU(32),t.ALo(33,"number"),t.qZA(),t.TgZ(34,"td",19),t._uU(35),t.ALo(36,"number"),t.qZA(),t.TgZ(37,"td",19),t._uU(38),t.qZA(),t.TgZ(39,"td",19),t._uU(40),t.qZA()()),2&T){const i=E.$implicit,n=E.index,s=t.MAs(13),p=t.MAs(15),A=t.MAs(19),ie=t.MAs(21),se=t.oxw(2);t.xp6(1),t.Q6J("ngIf",se.editLargeEntry),t.xp6(2),t.hij(" ",n+1," "),t.xp6(2),t.Oqu(i.MENUCODE),t.xp6(2),t.Oqu(i.ITEMDESC),t.xp6(2),t.Oqu(i.ALTUNIT),t.xp6(2),t.Q6J("ngIf",se.editLargeEntry)("ngIfThen",s)("ngIfElse",p),t.xp6(6),t.Q6J("ngIf",se.editLargeEntry)("ngIfThen",A)("ngIfElse",ie),t.xp6(6),t.hij(" ",t.xi3(24,18,i.AMOUNT,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(27,21,i.SELLRATEBEFORETAX,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(30,24,i.MRP,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(33,27,i.W_SELLRATEBEFORETAX,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(36,30,i.W_MRP,"1.2-2")," "),t.xp6(3),t.Oqu(i.MFGDATE),t.xp6(2),t.Oqu(i.EXPDATE)}}function it(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h5",8),t._uU(8,"Previous Fiscal Year"),t.qZA(),t.TgZ(9,"span"),t._uU(10),t.qZA()(),t.TgZ(11,"div",9)(12,"input",10),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.searchbyid=s)}),t.qZA(),t.TgZ(13,"button",11),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.hide())}),t._uU(14," \xd7 "),t.qZA()()()()(),t._UZ(15,"hr"),t.qZA(),t.TgZ(16,"cdk-virtual-scroll-viewport",12)(17,"table")(18,"thead")(19,"tr",13),t.YNc(20,Oe,2,0,"th",14),t.TgZ(21,"th",15),t._uU(22,"S.No."),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Code"),t.qZA(),t.TgZ(25,"th",16),t._uU(26,"Description"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Unit"),t.qZA(),t.TgZ(29,"th"),t._uU(30,"Quantity"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Rate"),t.qZA(),t.TgZ(33,"th"),t._uU(34,"Amt"),t.qZA(),t.TgZ(35,"th"),t._uU(36,"Sales Price"),t.qZA(),t.TgZ(37,"th"),t._uU(38,"Sales Price(W/V)"),t.qZA(),t.TgZ(39,"th"),t._uU(40,"WSP"),t.qZA(),t.TgZ(41,"th"),t._uU(42,"WSP(W/V)"),t.qZA(),t.TgZ(43,"th"),t._uU(44,"Mfg Date"),t.qZA(),t.TgZ(45,"th"),t._uU(46,"Exp Date"),t.qZA()()(),t.TgZ(47,"tbody",17),t.YNc(48,Di,41,33,"tr",18),t.ALo(49,"searchId"),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(10),t.hij("[",i.OpeningList[0].VCHRNO,"]"),t.xp6(2),t.Q6J("ngModel",i.searchbyid),t.xp6(4),t.Q6J("itemSize",20),t.xp6(4),t.Q6J("ngIf",i.editLargeEntry),t.xp6(28),t.Q6J("cdkVirtualForOf",t.xi3(49,5,i.OpeningList,i.searchbyid))}}let zi=(()=>{class T{constructor(i,n,s,p){this._transactionService=i,this.productHelper=n,this.alert=s,this.spinnerService=p,this.isActive=!1,this.OpeningList=[],this.editLargeEntry=!1,this.dataToBeSent=[],this.total=0}ngOnInit(){this._transactionService.TrnMainObj.largeDataEntryEdit=!1,this.subscription=this.productHelper.saveButtonClickedSubject$.pipe((0,Ye.zg)(i=>(this.total=0,0===this.dataToBeSent.length?(this.alert.warning("No product is selected, First select a product and then only you can proceed"),(0,G.of)("end")):(this.OpeningList.forEach(s=>{this.total+=s.AMOUNT}),this.productHelper.saveEditDataOfUpdateOpeningFromCarryFarward({data:{ProdList:this.dataToBeSent,VCHRNO:this._transactionService.TrnMainObj.VCHRNO,DIVISION:this._transactionService.TrnMainObj.DIVISION,PhiscalID:this._transactionService.TrnMainObj.PhiscalID,guid:this.largeEntryGuid,MWAREHOUSE:this._transactionService.TrnMainObj.MWAREHOUSE,REMARKS:this._transactionService.TrnMainObj.REMARKS,TOTAMNT:this.total,NETAMNT:this.total}}).pipe((0,re.K)(s=>(this.alert.error(s.error),(0,G.of)("Error")))))))).subscribe({next:i=>{"end"!==i&&"Error"!==i&&(this.spinnerService.hide(),this.dataToBeSent=[],this.hide(),this.alert.success(i.result))}})}show(i,n,s){"largeDataEntryEdit"===n?(this.editLargeEntry=!0,this.largeEntryGuid=s):"noLargeDataEntryEdit"===n&&(this.editLargeEntry=!1),this.isActive=!0,this.OpeningList=i;let p=0,A=0;this.OpeningList?.length>0&&(this.OpeningList.forEach(ie=>{ie.checked=void 0,p+=ie.ALTERNATEQUANTIY,A+=ie.AMOUNT}),this._transactionService.TrnMainObj.TOTALQTY=p,this._transactionService.TrnMainObj.GROSSAMNT=A),this._transactionService.TrnMainObj.largeDataEntryEdit="largeDataEntryEdit"===n}hide(){this.dataToBeSent=[],this.isActive=!1,this._transactionService.TrnMainObj.largeDataEntryEdit=!1}checkBoxEvent(i,n){i.target.checked?(this.dataToBeSent.push(n),n.checked=!0):(n.checked=void 0,this.dataToBeSent=this.dataToBeSent.filter(s=>s?.MCODE!==n.MCODE))}amountChange(i,n){let s;if(s=i<0||null===i?0:i,console.log("data",n),s<n.TOTALOUTWARDSTOCK){this.alert.warning(`Entered quantity ${i} ${n.ALTUNIT} is less than out quantity ${n.TOTALOUTWARDSTOCK} ${n.ALTUNIT} for item: ${n.ITEMDESC}`);let p=0==this._transactionService.nullToZeroConverter(n.ALTERNATEQUANTIY)?n.Quantity:n.ALTERNATEQUANTIY;n.ALTERNATEQUANTIY=new Number(p)}else n.ALTERNATEQUANTIY=new Number(s),n.ALTQTY_IN=s,n.REALQTY_IN=s,n.QUANTITY=s,n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}rateChange(i,n){let s;s=i<0||null===i?0:i,n.ALTRATE=new Number(s),n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this._transactionService.TrnMainObj.largeDataEntryEdit=!1}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(y.p),t.Y36(nt.h),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-opening-from-previous-year"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-6",2,"display","flex","align-items","baseline"],[1,"modal-title"],[1,"col-md-6"],["type","text","placeholder","Search by Menu code or Description","name","searchbyid",1,"container-input","ms-2",3,"ngModel","ngModelChange"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"mb-4",3,"itemSize"],[2,"background","#eeeeee","color","black"],["scope","col",4,"ngIf"],["scope","col"],[2,"width","20%"],[2,"border","1px"],["style","border: 1px solid #e6e6e6",4,"cdkVirtualFor","cdkVirtualForOf"],[2,"border","1px solid #e6e6e6"],[4,"ngIf"],[2,"border","1px solid #e6e6e6","width","10px"],[4,"ngIf","ngIfThen","ngIfElse"],["inputQuantity",""],["quantity",""],[2,"border","1px solid #e6e6e6","width","10%"],["inputAltRate",""],["altRate",""],["type","checkbox",3,"checked","change"],["type","number",3,"ngModel","disabled","ngModelOptions","ngModelChange"]],template:function(i,n){1&i&&t.YNc(0,it,50,8,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.O5,Xe.xd,Xe.x0,Xe.N7,O.Fj,O.wV,O.JJ,O.On,L.JJ,et],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:98.4%;top:30%;left:4%;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{height:24rem;border:1px solid #D1D6D8;width:87%;margin-left:auto;margin-right:auto}tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}"]}),T})();const Xi=["Division"];function en(T,E){if(1&T&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.Q6J("value",i.INITIAL),t.xp6(1),t.hij(" ",i.NAME," ")}}function tn(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),t._uU(5,"Opening From Previous Fiscal Year"),t.qZA()(),t.TgZ(6,"div",6)(7,"button",7),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.cancelPopup())}),t._uU(8,"Cancel"),t.qZA(),t.TgZ(9,"button",8),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.savePopup())}),t._uU(10," Save "),t.qZA()()(),t.TgZ(11,"div",9)(12,"div",10)(13,"div")(14,"div",11)(15,"div",12)(16,"label",13),t._uU(17,"DIVISION:"),t.qZA()(),t.TgZ(18,"div",14)(19,"select",15,16),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.DIV=s)}),t._UZ(21,"option",17),t.YNc(22,en,2,2,"option",18),t.qZA()()()()()()()()}if(2&T){const i=t.oxw();t.xp6(19),t.Q6J("ngModel",i.DIV),t.xp6(3),t.Q6J("ngForOf",i.divisionLists)}}let nn=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this._trnMainService=s,this.spinnerService=p,this.DIV="",this.onSaveParty=new t.vpe,this.loggedinUserDetail={},this.divisionLists=[],this.masterService.getAllDivisions().subscribe(A=>{this.divisionLists=A})}ngOnInit(){}resetPopup(){}savePopup(){this.spinnerService.show("Data Procesing Please Wait... "),this.DIV&&this.masterService.saveFiscalYear(2,0,this.DIV).subscribe(i=>{"ok"==i.status?this.alertService.success(i.result):this.alertService.info(i.result.error),this.isActive=!1,this.spinnerService.hide()})}cancelPopup(){this.isActive=!1,this.resetPopup()}show(){this.isActive=!0,setTimeout(()=>{this.Division.nativeElement.focus()},10)}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(f.P),t.Y36(H.c),t.Y36(y.p),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["previous-year-opening"]],viewQuery:function(i,n){if(1&i&&t.Gf(Xi,5),2&i){let s;t.iGM(s=t.CRH())&&(n.Division=s.first)}},outputs:{onSaveParty:"onSaveParty"},decls:1,vars:1,consts:[["class","party_container","role","document",4,"ngIf"],["role","document",1,"party_container"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","42vw","height","24vh"],[1,"modal-header","row"],[1,"col-md-7"],[1,"modal-title","pull-right",2,"font-weight","600"],[1,"col-md-5"],["type","button",1,"btn","btn-info","pull-right",2,"width","80px",3,"click"],["type","button","title","onSave",1,"btn","btn-info","pull-right",2,"margin-right","10px","width","80px","margin-top","15px",3,"click"],[1,"row"],[1,"col-md-8"],[1,"form-group","row",2,"margin-left","4px"],[1,"col-md-4"],[1,"pull-right",2,"font-weight","bold","text-align","right","margin-top","24px"],[1,"col-md-8",2,"width","65%","margin-top","20px"],["id","partygroup",1,"form-control",2,"padding","0px 8px",3,"ngModel","ngModelChange"],["Division",""],["value","%"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,n){1&i&&t.YNc(0,tn,23,2,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.YN,O.Kr,O.EJ,O.JJ,O.On],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:23px;color:#000}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 0rem;\n    }\n  \n    .party_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      top: 30%;\n      left: 29%;\n    }"]}),T})();const rn=["genericGrid"],on=["genericGridTerms"];function sn(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td",25),t._uU(2),t.qZA(),t.TgZ(3,"td",26),t._uU(4),t.qZA(),t.TgZ(5,"td",27),t._UZ(6,"div",28),t.qZA(),t.TgZ(7,"td",29)(8,"div",30)(9,"button",31),t.NdJ("click",function(){const p=t.CHM(i).index,A=t.oxw(2);return t.KtG(A.deleteRow(p))}),t._UZ(10,"img",32),t.qZA()()()()}if(2&T){const i=E.$implicit,n=E.index;t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(i.label),t.xp6(2),t.Q6J("innerHTML",i.termConditions,t.oJD)}}function an(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"h5"),t._uU(5,"Apply Terms and Conditions"),t.qZA(),t.TgZ(6,"div",7)(7,"button",8),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit())}),t._uU(8,"APPLY"),t.qZA(),t.TgZ(9,"button",9),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(10,"CANCEL"),t.qZA()()()(),t.TgZ(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",6)(15,"div",13)(16,"label",14),t._uU(17,"Terms and Conditions Label: "),t.qZA(),t.TgZ(18,"input",15),t.NdJ("keydown.enter",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.customerEnterCommand(s))})("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.selectedTermsObject.label=s)}),t.qZA(),t.TgZ(19,"button",16),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onAddTerms())}),t._uU(20,"ADD"),t.qZA()()()(),t.TgZ(21,"table",17)(22,"thead",18)(23,"tr",19)(24,"th",20),t._uU(25,"S.N"),t.qZA(),t.TgZ(26,"th",21),t._uU(27,"Label"),t.qZA(),t.TgZ(28,"th",22),t._uU(29,"TermsAndConditions"),t.qZA()()(),t.TgZ(30,"tbody",23),t.YNc(31,sn,11,3,"tr",24),t.qZA()()()()()()}if(2&T){const i=t.oxw();t.xp6(18),t.Q6J("ngModel",i.selectedTermsObject.label),t.xp6(13),t.Q6J("ngForOf",i.valuesList)}}let cn=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.okClicked=new t.vpe,this.gridPopupSettings=new J.im,this.gridPopupSettingsForTerms=new X.sG,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.termConditionList=[],this.termsandconditionArray=[],this.termsCondSearched=new O.NI,this.selectTermsJSON="",this.tempTermsConditions=[],this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}ngOnInit(){this.getTermsandConditionsList()}valueChange(i){this._trnMainService.searchedTermsandCondition=i.TermsAndConditions,this.termsSearchedId=i.ID,this.selectTermsJSON=JSON.stringify(i)}getTermsandConditionsList(){this.masterService.getPOTermsAndConditions().subscribe(i=>{"ok"==i.status&&(this.termConditionList=i.result,this.termConditionList?.length>0&&this.termConditionList.forEach(n=>n.TermsAndConditions=this.formatTermsAndConditions(n.TermsAndConditions)))})}show(i,n){this.isActive=!0,this.mode=n,i&&0!==i.length?(this.valuesList=[...i],this.tempTermsConditions=[...this.valuesList],this.valuesList.forEach(s=>s.termConditions=this.formatTermsAndConditions(s.termConditions))):(this.valuesList=[],this.tempTermsConditions=[])}submit(){if(0==this.valuesList.length)return void this.alertService.warning("Please select terms and conditions!!!");this.isSubmitting=!0,this.spinnerService.show("Applying Terms and Conditions! wait....");let i=this.valuesList.map(n=>n.id).toString();this.okClicked.emit(i),this.spinnerService.hide(),this.isActive=!1,this.tempTermsConditions=[...this.valuesList]}closeDialog(){this.valuesList=[...this.tempTermsConditions];let i=this.valuesList.map(n=>n.id).toString();this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID=i,this.okClicked.emit(i),this.isActive=!1}hide(){this.isActive=!1}customerEnterCommand(i){this.getTermList(),this.genericGridTerms.show()}getTermList(){this.gridPopupSettingsForTerms={title:"Terms and Condition",apiEndpoints:"/getPOTermsAndConditionsPagedList",defaultFilterIndex:1,useDefinefilterValue:this._trnMainService.TrnMainObj.BILLTO,columns:[{key:"ID",title:"ID",hidden:!1,noSearch:!1},{key:"Label",title:"NAME",hidden:!1,noSearch:!1}]}}onCustomerSelected(i){i.TermsAndConditions=this.formatTermsAndConditions(i.TermsAndConditions),this.selectedTermsObject.id=i.ID,this.selectedTermsObject.label=i.Label,this.selectedTermsObject.termConditions=i.TermsAndConditions}onAddTerms(){if(""!=this.selectedTermsObject.id){if(this.valuesList&&this.valuesList.length>0&&this.valuesList?.find(n=>n.id==this.selectedTermsObject.id))return void this.alertService.info("Can not add duplicate terms and condition");this.valuesList.push(Object.assign({},this.selectedTermsObject)),this.selectedTermsObject={id:"",label:"",termConditions:""}}}formatTermsAndConditions(i){return(i=(i=i.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/  +/g,n=>"&nbsp;".repeat(n.length))).replace(/\n/g,"<br>")}clearTermsAndCondition(){this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}deleteRow(i){this.valuesList.splice(i,1)}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["termsncondition-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(t.Gf(rn,5),t.Gf(on,5)),2&i){let s;t.iGM(s=t.CRH())&&(n.genericGrid=s.first),t.iGM(s=t.CRH())&&(n.genericGridTerms=s.first)}},outputs:{okClicked:"okClicked"},decls:3,vars:2,consts:[["class","terms-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridTerms",""],[1,"terms-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body",2,"overflow","auto"],[1,"col-md-12",2,"margin-top","1rem"],[1,"col-md-8"],[1,"d-flex","align-items-center","custom-gap"],[2,"width","50%"],["type","text","id","customerselectid","placeholder","Press ENTER to Select","readonly","",3,"ngModel","keydown.enter","ngModelChange"],["type","button","title","Cancel",1,"btn","btn-info","ml-5",3,"click"],["id","BlueHeaderResizableTable",1,"table","table-striped","mt-3"],[1,"stickHead"],[2,"line-height","2rem"],[1,"fontsize",2,"width","5%","font-weight","bold"],[1,"fontsize",2,"width","15%","font-weight","bold"],[1,"fontsize",2,"width","20%","font-weight","bold"],[2,"scrollbar-3dlight-color","#FFFFFF","scrollbar-arrow-color","#000000","scrollbar-base-color","#FF9999","scrollbar-darkshadow-color","#000000","scrollbar-face-color","#000000","scrollbar-highlight-color","#000000","scrollbar-shadow-color","#0033CC"],[4,"ngFor","ngForOf"],[2,"width","5%"],[2,"width","15%"],[2,"width","20%"],[3,"innerHTML"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"]],template:function(i,n){1&i&&(t.YNc(0,an,32,2,"div",0),t.TgZ(1,"generic-popup-grid",1,2),t.NdJ("onItemDoubleClick",function(p){return n.onCustomerSelected(p)}),t.qZA()),2&i&&(t.Q6J("ngIf",n.isActive),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettingsForTerms))},dependencies:[L.sg,L.O5,O.Fj,O.JJ,O.On,J.Zl],styles:[".terms-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:30rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}.custom-gap[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:25px}",".closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}"]}),T})();function ln(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h6",5),t._uU(5,"Confirmation Popup"),t.qZA()()(),t.TgZ(6,"div",6)(7,"div",7)(8,"p",8),t._uU(9," Member has redeemable points remaining. Do you want to redeem points as discount? "),t.qZA(),t._UZ(10,"hr",9),t.TgZ(11,"p",8),t._uU(12," Total Points to be Redeemed: "),t.TgZ(13,"span",10),t._uU(14),t.ALo(15,"number"),t.qZA()(),t.TgZ(16,"p",8),t._uU(17," Discount to be applied on Points Redeemed: "),t.TgZ(18,"span",10),t._uU(19),t.ALo(20,"number"),t.qZA()()()()(),t.TgZ(21,"div",11)(22,"div",12)(23,"button",13),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.submit())}),t._uU(24,"OK"),t.qZA(),t.TgZ(25,"button",14),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(26,"CANCEL"),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(14),t.Oqu(t.xi3(15,2,i.redeemPoint,"1.2-2")),t.xp6(5),t.hij("Rs. ",t.xi3(20,5,i.discountOnRedeem,"1.2-2"),"")}}let dn=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.okClicked=new t.vpe,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.TrnMainObj={}}ngOnInit(){}submit(){this.isActive=!1,this.okClicked.emit(!0)}closeDialog(){this.isActive=!1,this.okClicked.emit(!1)}show(){this.isActive=!0,this._trnMainService.pointRedeem().subscribe(i=>{this.redeemPoint=i,this.discountOnRedeem=this._trnMainService.TrnMainObj.MEMBERSHIPDISCOUNT}),console.log("redeem ko log",this.redeemPoint)}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["member-point-confirm-popup"]],outputs:{okClicked:"okClicked"},decls:1,vars:1,consts:[["class","confirmation-container",4,"ngIf"],[1,"confirmation-container"],[1,"card"],[1,"card-header",2,"background-color","lightsteelblue","padding","0.5rem 1.25rem"],[1,"row"],[2,"font-size","1.1rem"],[1,"row",2,"margin-top","1rem"],[1,"mx-4"],[2,"font-size","15px","font-weight","500"],[2,"margin-top","4px","margin-bottom","2px"],[2,"color","green"],[1,"col-md-12",2,"display","flex","align-items","flex-end","justify-content","center"],[1,"button-group","my-2"],["type","button",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"]],template:function(i,n){1&i&&t.YNc(0,ln,27,8,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.O5,L.JJ],styles:[".confirmation-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:33%;top:33%;left:37%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute}.card[_ngcontent-%COMP%]{height:15rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),T})();function hn(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr",24)(1,"td",25),t._uU(2),t.qZA(),t.TgZ(3,"td",26)(4,"input",27),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ITEMDESC=s)}),t.qZA()(),t.TgZ(5,"td",28)(6,"input",27),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.MANUFACTURER=s)}),t.qZA()(),t.TgZ(7,"td",29)(8,"input",30),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ALTUNIT=s)}),t.qZA()(),t.TgZ(9,"td",31)(10,"input",32),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ALTERNATEQUANTIY=s)}),t.qZA()(),t.TgZ(11,"td",33),t._UZ(12,"input",34),t.ALo(13,"twoDigitNumber"),t.qZA(),t.TgZ(14,"td",29)(15,"input",35),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.INDDISCOUNTRATE=s)}),t.qZA()(),t.TgZ(16,"td",33),t._UZ(17,"input",36),t.ALo(18,"twoDigitNumber"),t.qZA(),t.TgZ(19,"td",37),t._UZ(20,"input",38),t.qZA(),t.TgZ(21,"td",39),t._uU(22),t.ALo(23,"twoDigitNumber"),t.qZA(),t.TgZ(24,"td",39),t._uU(25),t.ALo(26,"twoDigitNumber"),t.qZA(),t.TgZ(27,"td",39),t._uU(28),t.ALo(29,"twoDigitNumber"),t.qZA()()}if(2&T){const i=E.$implicit,n=E.index,s=t.oxw(2);t.xp6(1),t.MGl("id","sno",n,""),t.xp6(1),t.hij(" ",n+1," "),t.xp6(2),t.MGl("id","mixeddesc",n,""),t.Q6J("ngModel",i.ITEMDESC),t.xp6(2),t.MGl("id","account",n,""),t.Q6J("ngModel",i.MANUFACTURER),t.xp6(2),t.MGl("id","mixedunit",n,""),t.Q6J("ngModel",i.ALTUNIT),t.xp6(2),t.MGl("id","mixedquantity",n,""),t.Q6J("ngModel",i.ALTERNATEQUANTIY),t.xp6(2),t.MGl("id","mixedrate",n,""),t.Q6J("ngModel",s.applyPipeInRate?t.lcZ(13,26,i.ALTRATE):i.ALTRATE),t.xp6(3),t.MGl("id","mixeddiscount",n,""),t.Q6J("ngModel",i.INDDISCOUNTRATE),t.xp6(2),t.MGl("id","mixeddiscountAmt",n,""),t.Q6J("ngModel",t.lcZ(18,28,s._trnMainService.nullToZeroConverter(i.INDDISCOUNT))),t.xp6(2),t.MGl("id","mixedmrp",n,""),t.xp6(1),t.Q6J("ngModel",i.CRATE)("disabled",1==s._trnMainService.disableAllFieldinPurchase)("readonly",!0),t.xp6(1),t.MGl("id","mixedamntId",n,""),t.xp6(1),t.hij(" ",t.lcZ(23,30,s._trnMainService.nullToZeroConverter(i.AMOUNT))," "),t.xp6(2),t.MGl("id","mixedvatvalue",n,""),t.xp6(1),t.hij(" ",t.lcZ(26,32,s._trnMainService.nullToZeroConverter(i.VAT))," "),t.xp6(2),t.MGl("id","mixednetamount",n,""),t.xp6(1),t.hij(" ",t.lcZ(29,34,s._trnMainService.nullToZeroConverter(i.NETAMOUNT))," ")}}function un(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),t._uU(5,"Preview Bill"),t.qZA(),t.TgZ(6,"div",5)(7,"button",6),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeDialog())}),t._uU(8,"Close"),t.qZA()()()(),t.TgZ(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"table",11)(14,"thead")(15,"tr",12)(16,"th",13),t._uU(17,"Sn."),t.qZA(),t.TgZ(18,"th",14),t._uU(19,"Description"),t.qZA(),t.TgZ(20,"th",15),t._uU(21,"Account"),t.qZA(),t.TgZ(22,"th",16),t._uU(23,"Unit"),t.qZA(),t.TgZ(24,"th",17),t._uU(25,"Quantity"),t.qZA(),t.TgZ(26,"th",18),t._uU(27,"P.Rate"),t.qZA(),t.TgZ(28,"th",16),t._uU(29,"Dis%"),t.qZA(),t.TgZ(30,"th",18),t._uU(31,"Dis Amt"),t.qZA(),t.TgZ(32,"th",18),t._uU(33,"Net Rate"),t.qZA(),t.TgZ(34,"th",18),t._uU(35,"Amt"),t.qZA(),t.TgZ(36,"th",18),t._uU(37,"VAT"),t.qZA(),t.TgZ(38,"th",18),t._uU(39,"Net Amt"),t.qZA()()(),t.TgZ(40,"tbody",19),t.YNc(41,hn,30,36,"tr",20),t.qZA()()()()()(),t.TgZ(42,"div",21)(43,"table",11)(44,"tr",22)(45,"th",23),t._uU(46),t.qZA(),t.TgZ(47,"th",23),t._uU(48),t.qZA(),t.TgZ(49,"th",23),t._uU(50),t.qZA(),t.TgZ(51,"th",23),t._uU(52),t.qZA(),t.TgZ(53,"th",23),t._uU(54),t.qZA(),t.TgZ(55,"th",23),t._uU(56),t.qZA()()()()()()}if(2&T){const i=t.oxw();t.xp6(41),t.Q6J("ngForOf",i.mergedProductList),t.xp6(5),t.hij("TOTAL QTY: ",i._trnMainService.TrnMainObj.TOTALQTY," "),t.xp6(2),t.hij("GROSS: ",i._trnMainService.TrnMainObj.GROSSAMNT," "),t.xp6(2),t.hij("TAXABLE: ",i._trnMainService.TrnMainObj.TAXABLE," "),t.xp6(2),t.hij("NON TAXABLE: ",i._trnMainService.TrnMainObj.NONTAXABLE,""),t.xp6(2),t.hij("VAT: ",i._trnMainService.TrnMainObj.VATAMNT,""),t.xp6(2),t.hij("NET AMNT: ",i._trnMainService.TrnMainObj.NETAMNT,"")}}let pn=(()=>{class T{constructor(i,n,s,p,A){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=A,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.mergedProductList=[]}ngOnInit(){}closeDialog(){this.isActive=!1}show(i){this.mergedProductList=i,this.isActive=!0}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(O.qu),t.Y36(f.P),t.Y36(y.p),t.Y36(H.c),t.Y36(j.V))},T.\u0275cmp=t.Xpm({type:T,selectors:[["preview-bill-popup-dialog"]],decls:1,vars:1,consts:[["class","previewbill-container",4,"ngIf"],[1,"previewbill-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"overflow-y","scroll","overflow-x","hidden"],[2,"width","104%","margin-left","-25px"],[1,"row","col-md-12"],[1,"col-md-12"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4","width","100%"],["scope","col",2,"width","2%"],["scope","col",2,"width","9%","text-align","center"],["scope","col",2,"width","10%","text-align","center"],["scope","col",2,"width","3%","text-align","center"],["scope","col",2,"width","4%","text-align","center"],["scope","col",2,"width","5%","text-align","center"],[2,"background-color","aliceblue"],["style","height: 28px;",4,"ngFor","ngForOf"],[1,"row",2,"margin-top","auto","width","100%","margin-bottom","-15px"],[2,"line-height","1.2rem"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],[2,"height","28px"],[2,"border","1px solid #e6e6e6","width","2%",3,"id"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","9%"],["type","text","autocomplete","off","readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","10%"],[2,"height","23px","border","1px solid #e6e6e6","width","3%"],["readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel"],["type","number","decimalPlacesRestriction","2","min","0","max","100","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],["type","number","decimalPlacesRestriction","2","step","0.01","readonly","",2,"width","98%","text-align","right",3,"id","ngModel"],[2,"height","23px","border","1px solid #e6e6e6","width","5%",3,"id"],["type","text","readonly","",2,"width","98%","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #e6e6e6","width","5%","text-align","right",3,"id"]],template:function(i,n){1&i&&t.YNc(0,un,57,7,"div",0),2&i&&t.Q6J("ngIf",n.isActive)},dependencies:[L.sg,L.O5,O.Fj,O.wV,O.JJ,O.qQ,O.Fd,O.On,ze.g],styles:[".previewbill-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:20%;left:5%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:83vh;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),T})();var _n=b(11728),Tn=b(7838),Mn=b(8630),mn=b(23707);const gn=["digitalSignUpload"],vn=["genericGrid"],Sn=["genericimageupload"],fn=["genericTender"],On=["genericGridHoldBill"],bn=["Transport"],Cn=["genericGridIntend"],An=["printSetupModal"],En=["genericGridReverseView"],In=["genericGridPerformaView"],Pn=["genericGridForRecurring"],yn=["genericGridforPreviousOpening"],xn=["deliverySelectPopup"],Rn=["requisitionSelectPopup"],Nn=["genericGridExpList"],Ln=["genericGridForTaxCancel"],wn=["ImportPurchaseDetail"],Dn=["reverseEntryConfirm"],jn=["authenticationPopup"],kn=["itemInfo"],Gi=["itemSearchPopup"],Vn=["genericGridForLargeDataEntry"],Un=["genericGridTransferOut"],Bn=["rateValidatoin"],Kn=["PaymentPopup"],Zn=["RecurringLog"],Fn=["StockAdjustment"],Qn=["CreateCustomerPopup"],Hn=["AutoAdjustment"],Gn=["OpeningFromPreviousYear"],Yn=["TermConditionPopup"],Jn=["PrevYearOpening"],qn=["MemberPointConfirmationPopup"],Wn=["BillPreviewPopup"],$n=["multiselectGenericGrid"];function zn(T,E){1&T&&(t.TgZ(0,"span",79),t._uU(1,"Post By :"),t.qZA())}function Xn(T,E){if(1&T&&(t.TgZ(0,"span",80),t._uU(1),t.qZA()),2&T){const i=t.oxw();t.xp6(1),t.hij("",i._trnMainService.TrnMainObj.TRNUSER,"\n")}}function er(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",2),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.OpenBOMListPopup())}),t._uU(1," List BOM\n"),t.qZA()}}function tr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onImportPurchaseInvoice())}),t._uU(1," IMPORT PO F2\n"),t.qZA()}}function ir(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onImportPurchaseInvoice())}),t._uU(1," IMPORT PI F2\n"),t.qZA()}}function nr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",82),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.forceCloseClick())}),t._uU(1," FORCE CLOSE\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode&&(1==i._trnMainService.TrnMainObj.STATUS||10==i._trnMainService.TrnMainObj.STATUS&&20!=i._trnMainService.TrnMainObj.VoucherType))}}function rr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.forceCloseClick())}),t._uU(1," APPROVAL REJECTION\n"),t.qZA()}}function or(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.showBillTender())}),t._uU(1," Tender List\n"),t.qZA()}}function sr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",83),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onPrintClicked())}),t._uU(1," PRINT F8\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",1!=i.checkstatus)}}function ar(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",84),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onPrintVoucher())}),t._uU(1,"\nPRINT VOUCHER\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",1!=i.checkstatus)}}function cr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",85),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.stockSettlementApprovalLoad())}),t._uU(1," UNAPPROVED LIST\n"),t.qZA()}}function lr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onReverseEntry())}),t._uU(1," Proforma Cancel\n"),t.qZA()}}function dr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onReverseEntry())}),t._uU(1," Reverse Chalan\n"),t.qZA()}}function v(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",87),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onPerformaViewRequest())}),t._uU(1," View Canceled Proforma\n"),t.qZA()}}function V(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",87),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onPerformaViewRequest())}),t._uU(1," View Reverse Delivery Chalan\n"),t.qZA()}}function r(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.rejectPerformInvoice())}),t._uU(1," Reject\n"),t.qZA()}}function l(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.approvePerformInvoice())}),t._uU(1," Approve\n"),t.qZA()}}function c(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",88),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onLoadSalesCancel())}),t._uU(1," Cancel SC\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",1!=i.checkstatus)}}function u(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",89),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onShowImportSO())}),t._uU(1," IMPORT SO\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",1!=i.checkstatus)}}function R(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",90),t.NdJ("click",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.onShowExpiredSO(s))}),t._uU(1," Expired Order List\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",1!=i.checkstatus)}}function F(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",91),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onReverseEntry())}),t._uU(1," Reverse Entry\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",i._trnMainService.disableReverseEntryForLatePost)}}function le(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onViewCarrryForwardClicked())}),t._uU(1," View Carry Forward Voucher\n"),t.qZA()}}function Se(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onEditLargeEntryClicked())}),t._uU(1,"\nEdit Large Entry\n"),t.qZA()}}function Re(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.carryForwardPreviousFiscalYearVoucher())}),t._uU(1," Opening From Previous Fiscal Year\n"),t.qZA()}}function xe(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.forRequisition())}),t._uU(1," From Requisition\n"),t.qZA()}}function ye(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.forStockAdjustment())}),t._uU(1," Stock Adjusment\n"),t.qZA()}}function ji(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onViewClicked())}),t._uU(1," VIEW F4\n"),t.qZA()}}function hr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onViewSignatureClicked())}),t._uU(1," VIEW SIGNATURE\n"),t.qZA()}}function ur(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onViewReverseClick())}),t._uU(1," View Reverse\n"),t.qZA()}}function pr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",91),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onEditClicked())}),t._uU(1," EDIT F7\n"),t.qZA()}if(2&T){const i=t.oxw();t.Q6J("disabled",14==i._trnMainService.TrnMainObj.VoucherType&&"self-billing"==i.activeurlpath)}}function _r(T,E){1&T&&(t.ynx(0),t._uU(1," POST [End]\n"),t.BQk())}function Tr(T,E){1&T&&t._uU(0," SAVE [End]\n")}function Yi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",91),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onSaveClicked())}),t.YNc(1,_r,2,0,"ng-container",92),t.YNc(2,Tr,1,0,"ng-template",null,93,t.W1O),t.qZA()}if(2&T){const i=t.MAs(3),n=t.oxw(),s=t.MAs(116);t.Q6J("disabled",1==n._trnMainService.disableAllFieldinSales||19===n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode||n.disableSaveBtnINCaseOfSingleBatch()||"VIEW"==n._trnMainService.TrnMainObj.Mode||n.validateBeforeSave()||"StockSettlementEntry"==n.activeurlpath&&"VIEW"==n._trnMainService.buttonMode||s.isActive),t.xp6(1),t.Q6J("ngIf",71==n._trnMainService.TrnMainObj.VoucherType)("ngIfElse",i)}}function Ae(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onApplyTC())}),t._uU(1),t.qZA()}if(2&T){const i=t.oxw();t.xp6(1),t.hij(" ",i.TermsButtonTag,"\n")}}function Ji(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onNewClick())}),t._uU(1," RESET F3\n"),t.qZA()}}function qi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",94),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onImageClick())}),t.TgZ(1,"span",95),t._UZ(2,"i",96),t.qZA(),t._uU(3,"Image Upload\n"),t.qZA()}}function Pe(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onRefershRateClicked())}),t._uU(1," REFRESH RATE\n"),t.qZA()}}function Wi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",97),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onRecurringClick())}),t._uU(1," From Recurring Log\n"),t.qZA()}}function Je(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onSyncClicked())}),t._uU(1," SYNC\n"),t.qZA()}}function ki(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onLoadFromPerformaInvoice())}),t._uU(1," FROM PROFORMA\n"),t.qZA()}}function Mr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onLoadFromDeliveryChalan())}),t._uU(1," FROM DELIVERY CHALAN\n"),t.qZA()}}function mr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.viewRecurringDetails())}),t._uU(1," View Recurring Info\n"),t.qZA()}}function gr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.newSalesman())}),t._uU(1," SALESMAN F2\n"),t.qZA()}}function Vi(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onCancelClick())}),t._uU(1," VOID\n"),t.qZA()}}function fr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",98),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onImportDetailsClick())}),t._uU(1," IMPORT DETAILS\n"),t.qZA()}}function Or(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",98),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onExportClick())}),t._uU(1," EXPORT NEGATIVE STOCK\n"),t.qZA()}}function br(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"button",98),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.OnBatchAdjustmentClick())}),t._uU(1," AUTO ADJUSTMENT\n"),t.qZA()}}function Cr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"generic-popup-Tender",35,99),t.NdJ("okClicked",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.okClicked(s))}),t.qZA()}}function Ar(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"Transport-Popup",35,100),t.NdJ("okClicked",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.TenderOkClick(s))}),t.qZA()}}function Er(T,E){if(1&T&&(t.ynx(0),t._UZ(1,"input",107),t._uU(2,"3mm POS Printer"),t._UZ(3,"br"),t.BQk()),2&T){const i=t.oxw(2);t.xp6(1),t.Q6J("formControl",i.printControl)}}function Ir(T,E){if(1&T&&(t.ynx(0),t._UZ(1,"input",108,109),t._uU(3,"A4 Printer"),t._UZ(4,"br"),t.BQk()),2&T){const i=t.oxw(2);t.xp6(1),t.Q6J("formControl",i.printControl)}}function Pr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",101)(1,"div",102)(2,"div",56)(3,"h4",103),t._uU(4,"Printing Device"),t.qZA()(),t.TgZ(5,"div",59)(6,"form"),t.YNc(7,Er,4,1,"ng-container",49),t.YNc(8,Ir,5,1,"ng-container",49),t.qZA()(),t.TgZ(9,"div",104)(10,"button",105),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.cancelprint())}),t._uU(11," Cancel "),t.qZA(),t.TgZ(12,"button",106),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.setPrinterAndprint())}),t._uU(13," Print "),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(7),t.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||1==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType||3==i._trnMainService.TrnMainObj.VoucherType||16==i._trnMainService.TrnMainObj.VoucherType)}}function yr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"tr")(1,"td",118)(2,"input",119),t.NdJ("ngModelChange",function(s){const A=t.CHM(i).$implicit;return t.KtG(A.ischecked=s)}),t.qZA()(),t.TgZ(3,"td",118),t._uU(4),t.qZA(),t.TgZ(5,"td",118),t._uU(6),t.qZA(),t.TgZ(7,"td",118),t._uU(8),t.qZA(),t.TgZ(9,"td",118),t._uU(10),t.qZA(),t.TgZ(11,"td",118),t._uU(12),t.qZA(),t.TgZ(13,"td",118),t._uU(14),t.qZA(),t.TgZ(15,"td",118),t._uU(16),t.qZA(),t.TgZ(17,"td",118),t._uU(18),t.qZA(),t.TgZ(19,"td",118),t._uU(20),t.qZA(),t.TgZ(21,"td",118),t._uU(22),t.qZA(),t.TgZ(23,"td",118),t._uU(24),t.qZA()()}if(2&T){const i=E.$implicit;t.xp6(2),t.Q6J("ngModel",i.ischecked),t.xp6(2),t.Oqu(i.schemeno),t.xp6(2),t.Oqu(i.schemetype),t.xp6(2),t.Oqu(i.budget),t.xp6(2),t.Oqu(i.prorata),t.xp6(2),t.Oqu(i.qps),t.xp6(2),t.Oqu(i.areabudget),t.xp6(2),t.Oqu(i.aboveqty),t.xp6(2),t.Oqu(i.unit),t.xp6(2),t.Oqu(i.value),t.xp6(2),t.Oqu(i.valuetype),t.xp6(2),t.Oqu(i.discountamount)}}function xr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",110)(1,"div",102)(2,"div",56)(3,"h4",103),t._uU(4,"Available Schemes"),t.qZA()(),t.TgZ(5,"div",59)(6,"div",111)(7,"table",112)(8,"thead")(9,"tr",113)(10,"th")(11,"span",114),t._uU(12,"SCHEME APPLY"),t.qZA()(),t.TgZ(13,"th")(14,"span",114),t._uU(15,"SCHEME NO"),t.qZA()(),t.TgZ(16,"th")(17,"span",114),t._uU(18,"SCHEMETYPE"),t.qZA()(),t.TgZ(19,"th")(20,"span",114),t._uU(21,"BUDGET"),t.qZA()(),t.TgZ(22,"th")(23,"span",114),t._uU(24,"PRORATA"),t.qZA()(),t.TgZ(25,"th")(26,"span",114),t._uU(27,"QPS"),t.qZA()(),t.TgZ(28,"th")(29,"span",114),t._uU(30,"AREABUDGET"),t.qZA()(),t.TgZ(31,"th")(32,"span",114),t._uU(33,"ABOVEQTY"),t.qZA()(),t.TgZ(34,"th")(35,"span",114),t._uU(36,"UNIT"),t.qZA()(),t.TgZ(37,"th")(38,"span",114),t._uU(39,"VALUE"),t.qZA()(),t.TgZ(40,"th")(41,"span",114),t._uU(42,"VALUETYPE"),t.qZA()(),t.TgZ(43,"th")(44,"span",114),t._uU(45,"DISCOUNTAMOUNT"),t.qZA()()()(),t.TgZ(46,"tbody",115),t.YNc(47,yr,25,12,"tr",116),t.qZA()()()(),t.TgZ(48,"div",104)(49,"button",117),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.OkSchemeCommand())}),t._uU(50," Apply "),t.qZA(),t.TgZ(51,"button",117),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.CancelSchemeCommand())}),t._uU(52," Cancel "),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(47),t.Q6J("ngForOf",i.schemeFilterList)}}function Rr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",120)(1,"div",121)(2,"div",56)(3,"h4",103),t._uU(4,"Print Preview"),t.qZA()(),t.TgZ(5,"div",122)(6,"pre"),t._uU(7),t.qZA()(),t.TgZ(8,"div",104)(9,"button",105),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.cancelprint())}),t._uU(10," Close "),t.qZA(),t.TgZ(11,"button",106),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.printPosBill())}),t._uU(12," Print "),t.qZA()()()()}if(2&T){const i=t.oxw();t.xp6(7),t.hij("        ",i.TrnMainObj.printStringForPos,"\n      ")}}function Nr(T,E){1&T&&(t.TgZ(0,"label",132),t._uU(1,"Requisition From :"),t.qZA())}function Lr(T,E){if(1&T&&(t.TgZ(0,"option",133),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.Q6J("ngValue",i.INITIAL),t.xp6(1),t.hij(" ",i.NAME," ")}}function wr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",60),t.YNc(1,Nr,2,0,"label",129),t.TgZ(2,"select",130),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw(2);return t.KtG(p._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),t.YNc(3,Lr,2,2,"option",131),t.qZA()()}if(2&T){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),t.xp6(1),t.Q6J("ngForOf",i.divisionList)}}function Dr(T,E){if(1&T&&(t.TgZ(0,"option",133),t._uU(1),t.qZA()),2&T){const i=E.$implicit;t.Q6J("ngValue",i.NAME),t.xp6(1),t.hij(" ",i.NAME," ")}}function jr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",60)(1,"label",132),t._uU(2,"From Warehouse:"),t.qZA(),t.TgZ(3,"select",130),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw(2);return t.KtG(p._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),t.YNc(4,Dr,2,2,"option",131),t.qZA()()}if(2&T){const i=t.oxw(2);t.xp6(3),t.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),t.xp6(1),t.Q6J("ngForOf",i.warehouseList)}}function kr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",60)(1,"label",132),t._uU(2,"Requisition No :"),t.qZA(),t.TgZ(3,"input",134),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw(2);return t.KtG(p._trnMainService.TrnMainObj.REFORDBILL=s)})("keydown.Enter",function(){t.CHM(i);const s=t.oxw(2);return t.KtG(s.fromTransferOut())}),t.qZA()()}if(2&T){const i=t.oxw(2);t.xp6(3),t.Q6J("ngModel",i._trnMainService.TrnMainObj.REFORDBILL)}}function Vr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div")(1,"div",123)(2,"div",124)(3,"div",125)(4,"h5",126),t._uU(5,"From Requisition"),t.qZA(),t.TgZ(6,"button",57),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeReqModal())}),t.TgZ(7,"span",58),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",59),t.YNc(10,wr,4,3,"div",127),t.YNc(11,jr,5,2,"div",127),t.YNc(12,kr,4,1,"div",127),t.qZA(),t.TgZ(13,"div",104)(14,"button",128),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.saveRequisition())}),t._uU(15," Save "),t.qZA(),t.TgZ(16,"button",128),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.resetRequisition())}),t._uU(17," Reset "),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(10),t.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",5==i._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||5==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType)}}function Ur(T,E){1&T&&(t.TgZ(0,"th",157),t._uU(1," CURRENT WS-PRICE "),t.qZA())}function Br(T,E){1&T&&(t.TgZ(0,"th",158),t._uU(1,"NEW S-PRICE INCLUDING VAT"),t.qZA())}function Kr(T,E){1&T&&(t.TgZ(0,"th",158),t._uU(1,"NEW S-PRICE EXCLUDING VAT"),t.qZA())}function Zr(T,E){1&T&&(t.TgZ(0,"th",158),t._uU(1," NEW WS-PRICE EXCLUDING VAT "),t.qZA())}function Fr(T,E){1&T&&(t.TgZ(0,"th",158),t._uU(1," NEW WS-PRICE INCLUDING VAT "),t.qZA())}function Qr(T,E){if(1&T&&(t.TgZ(0,"td",160),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&T){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,i.WSRATE_A)," ")}}function Hr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",160)(1,"input",162),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.NRATE_A=s)})("keyup",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.actualMarginCalculation(p,s))})("keydown.enter",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit,p=t.oxw(2);t.xp6(1),t.MGl("id","newSellingPrice",n,""),t.Q6J("ngModel",s.NRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Gr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",160)(1,"input",162),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.EX_NRATE_A=s)})("keyup",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.actualMarginCalculation(p,s))})("keydown.enter",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit,p=t.oxw(2);t.xp6(1),t.MGl("id","newSellingPrice",n,""),t.Q6J("ngModel",s.EX_NRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Yr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",160)(1,"input",162),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.WNRATE_A=s)})("keyup",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.actualMarginCalculation(p,s))})("keydown.enter",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit,p=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",n,""),t.Q6J("ngModel",s.WNRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Jr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"td",160)(1,"input",162),t.NdJ("change",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("ngModelChange",function(s){t.CHM(i);const p=t.oxw().$implicit;return t.KtG(p.EX_WNRATE_A=s)})("keyup",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.actualMarginCalculation(p,s))})("keydown.enter",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){t.CHM(i);const p=t.oxw().index,A=t.oxw(2);return t.KtG(A.onChangePurchasePrice(p,s))}),t.qZA()()}if(2&T){const i=t.oxw(),n=i.index,s=i.$implicit,p=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",n,""),t.Q6J("ngModel",s.EX_WNRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function qr(T,E){if(1&T&&(t.TgZ(0,"tbody")(1,"tr",159)(2,"td",160),t._uU(3),t.qZA(),t.TgZ(4,"td",160),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA(),t.YNc(7,Qr,3,3,"td",161),t.YNc(8,Hr,2,3,"td",161),t.YNc(9,Gr,2,3,"td",161),t.YNc(10,Yr,2,3,"td",161),t.YNc(11,Jr,2,3,"td",161),t.qZA()()),2&T){const i=E.$implicit,n=t.oxw(2);t.xp6(3),t.hij(" ",i.UNIT," "),t.xp6(2),t.hij(" ",t.lcZ(6,7,i.CRATE_A)," "),t.xp6(2),t.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",0===(null==n.userSetting?null:n.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1===(null==n.userSetting?null:n.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING&&0==(null==n.userSetting?null:n.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING&&1==(null==n.userSetting?null:n.userSetting.VatExcludingRate))}}function Wr(T,E){if(1&T&&(t.TgZ(0,"h6",163),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&T){const i=t.oxw(2);t.xp6(1),t.hij(" Actual Margin (RETAIL): ",t.lcZ(2,1,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginRetial),"% ")}}function $r(T,E){if(1&T&&(t.TgZ(0,"div",164)(1,"h6",165),t._uU(2),t.ALo(3,"twoDigitNumber"),t.qZA(),t.TgZ(4,"h6",165),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA()()),2&T){const i=t.oxw(2);t.xp6(2),t.hij("Actual Margin (RETAIL): ",t.lcZ(3,2,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginRetial),"%"),t.xp6(3),t.hij("Actual Margin (Wholesale): ",t.lcZ(6,4,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginWholeSale),"%")}}function zr(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",135)(1,"div",136)(2,"div",137)(3,"h4",138),t._uU(4," Selling Price Setting "),t.qZA()(),t.TgZ(5,"div",139)(6,"div")(7,"h5",138),t._uU(8," Cost Price has been changed.Please reset your new Selling Price "),t.qZA(),t._UZ(9,"hr",140),t.qZA(),t.TgZ(10,"fieldset")(11,"legend",141),t._uU(12," New Selling Price Setting "),t.qZA(),t.TgZ(13,"div",142)(14,"table",143)(15,"thead")(16,"tr",144)(17,"th",145),t._uU(18,"UOM"),t.qZA(),t.TgZ(19,"th",146),t._uU(20,"CURRENT S-PRICE"),t.qZA(),t.YNc(21,Ur,2,0,"th",147),t.YNc(22,Br,2,0,"th",148),t.YNc(23,Kr,2,0,"th",148),t.YNc(24,Zr,2,0,"th",149),t.YNc(25,Fr,2,0,"th",149),t.qZA()(),t.YNc(26,qr,12,9,"tbody",116),t.qZA()(),t.TgZ(27,"div",60)(28,"div",150)(29,"div",151)(30,"h6"),t._uU(31),t.qZA()(),t.TgZ(32,"div",152),t.YNc(33,Wr,3,3,"h6",153),t.YNc(34,$r,7,6,"div",154),t.qZA()()()(),t.TgZ(35,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onApplyClickNewPrice())}),t._uU(36," APPLY "),t.qZA(),t.TgZ(37,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onApplyOldPriceClick())}),t._uU(38," APPLY OLD S-PRICE "),t.qZA(),t.TgZ(39,"button",86),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onCloseClick())}),t._uU(40," CLOSE "),t.qZA(),t.TgZ(41,"div",60)(42,"label",155),t._uU(43,"ITEM:"),t.qZA(),t.TgZ(44,"label",156),t._uU(45),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(21),t.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",0==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING&&1==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING&&0==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),t.xp6(1),t.Q6J("ngForOf",i._trnMainService.priceChangeList),t.xp6(5),t.hij(" Recommended Margin: ",i._trnMainService.selectedProdcutRecMargin,"% "),t.xp6(2),t.Q6J("ngIf",!i.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING),t.xp6(11),t.hij(" ",i._trnMainService.TrnMainObj.ProdList[i.activeindex].ITEMDESC,"")}}function Xr(T,E){1&T&&(t.TgZ(0,"h5",181),t._uU(1," Force Close Confirmation "),t.qZA())}function eo(T,E){1&T&&(t.TgZ(0,"h5",181),t._uU(1," Approval Rejection Confirmation "),t.qZA())}function to(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div",166)(1,"div",167)(2,"div",168),t.YNc(3,Xr,2,0,"h5",169),t.YNc(4,eo,2,0,"h5",169),t.TgZ(5,"div",170)(6,"button",171),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.forceCloseSubmit())}),t._uU(7," SUBMIT "),t.qZA(),t.TgZ(8,"button",172),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeForceClose())}),t._uU(9," CANCEL "),t.qZA()()(),t.TgZ(10,"div",173)(11,"div",174)(12,"label",175),t._uU(13,"Invoice No :"),t.qZA(),t.TgZ(14,"div",176)(15,"input",177),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.forceCloseObj.VCHRNO=s)}),t.qZA()()(),t.TgZ(16,"div",178)(17,"label",179),t._uU(18),t.qZA(),t.TgZ(19,"div",176)(20,"textarea",180),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.forceCloseObj.REMARKS=s)}),t.qZA()()()()()()}if(2&T){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",90!=i._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==i._trnMainService.TrnMainObj.VoucherType),t.xp6(11),t.Q6J("ngModel",i.forceCloseObj.VCHRNO),t.xp6(3),t.hij("Remarks for ",i.displayNameForceClose,":"),t.xp6(2),t.Q6J("ngModel",i.forceCloseObj.REMARKS)}}function io(T,E){if(1&T&&(t.TgZ(0,"tr")(1,"td",192),t._uU(2),t.qZA(),t.TgZ(3,"td",193),t._uU(4),t.ALo(5,"number"),t.qZA(),t.TgZ(6,"td",194),t._uU(7),t.qZA()()),2&T){const i=E.$implicit;t.xp6(2),t.Oqu(i.TRNMODE),t.xp6(2),t.hij(" ",t.xi3(5,3,i.AMOUNT,"1.2-2")," "),t.xp6(3),t.Oqu(i.REMARKS)}}function no(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div")(1,"div",182)(2,"div",183)(3,"div",125)(4,"h6",126),t._uU(5,"Bill tender list"),t.qZA(),t.TgZ(6,"button",57),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeTenderList())}),t.TgZ(7,"span",58),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",59)(10,"table",184)(11,"thead")(12,"tr",185)(13,"th",186),t._uU(14,"Tender Mode"),t.qZA(),t.TgZ(15,"th",187),t._uU(16,"Amount"),t.qZA(),t.TgZ(17,"th",188),t._uU(18,"Account"),t.qZA()()(),t.TgZ(19,"tbody",189),t.YNc(20,io,8,6,"tr",116),t.qZA()()(),t.TgZ(21,"div",190)(22,"button",191),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeTenderList())}),t._uU(23," Close "),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(20),t.Q6J("ngForOf",i._trnMainService.TrnMainObj.TenderList)}}function ro(T,E){if(1&T){const i=t.EpF();t.TgZ(0,"div")(1,"div",195)(2,"div",124)(3,"div",125)(4,"h5",126),t._uU(5," Reverse Entry authorization "),t.qZA(),t.TgZ(6,"button",57),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.closeReverseEntryAuthPopup())}),t.TgZ(7,"span",58),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",59)(10,"div",196)(11,"label",197),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",198)(14,"input",199),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.reverseEntryAuthObj.username=s)}),t.qZA()()(),t.TgZ(15,"div",196)(16,"label",197),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",198)(19,"input",200),t.NdJ("ngModelChange",function(s){t.CHM(i);const p=t.oxw();return t.KtG(p.reverseEntryAuthObj.password=s)}),t.qZA()()()(),t.TgZ(20,"div",104)(21,"button",128),t.NdJ("click",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.reverseEntryAuthConfirm())}),t._uU(22," Confirm "),t.qZA()()()()()}if(2&T){const i=t.oxw();t.xp6(14),t.Q6J("ngModel",i.reverseEntryAuthObj.username),t.xp6(5),t.Q6J("ngModel",i.reverseEntryAuthObj.password)}}const oo=function(){return{backdrop:"static"}};let so=(()=>{class T{constructor(i,n,s,p,A,ie,se,de,pe,ue,ke,we,De,je,_e,Te,fe){this._trnMainService=i,this.setting=n,this.dialog=s,this.router=p,this.arouter=A,this.alertService=ie,this.spinnerService=se,this.authService=de,this.loadingService=pe,this.invoicePrint=ue,this.notificationService=ke,this.notificationsService=we,this.validationService=De,this.masterService=je,this.onSaveClickValidationService=_e,this.productHelperSerivce=Te,this.PrintHelperService=fe,this.buttonShow=!0,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.forceCloseObj={},this.additionalcostEmit=new t.vpe,this.deliveryChalanEmit=new t.vpe,this.onViewClickEmit=new t.vpe,this.onLoadFromSOClickEmit=new t.vpe,this.onLoadFromPOClickEmit=new t.vpe,this.onLoadFromHOPerformaInvoiceClickEmit=new t.vpe,this.onLoadFromPerformaInvoiceClickEmit=new t.vpe,this.onLoadFromReverseEntryEmit=new t.vpe,this.onLoadFromHoTaxInvoiceClickEmit=new t.vpe,this.onLoadFromSAPFTPClickEmit=new t.vpe,this.onShowFileUploadPopupEmit=new t.vpe,this.onLoadFromStockSettlementApproval=new t.vpe,this.onSettlementStockApprove=new t.vpe,this.onApproveStockSettlementList=new t.vpe,this.onFileUploadPopupEmit=new t.vpe,this.onSaveINVAllocation=new t.vpe,this.onSaveSelfBilling=new t.vpe,this.onclickOnResetPopupEmit=new t.vpe,this.onLoadCancelSalesEmit=new t.vpe,this.gridPopupSettingForPreviousOpening=new J.im,this.gridPopupSettingsForExpList=new X.sG,this.onAddNewCustomerClickEmit=new t.vpe,this.onClickCustomer=new t.vpe,this.onClickSalesMan=new t.vpe,this.gridPopupSettingsForTaxCancel=new J.im,this.itemInfoPopupSettings=new w,this.gridPopupSettingForLargeEntry=new J.im,this.checkstatus=!0,this.viewSubscription=new M.w,this.gridPopupSettings=new J.im,this.gridPopupSettingsForReverse=new J.im,this.gridPopupSettingsForViewPerforma=new J.im,this.gridPopupSettingsForRecurring=new J.im,this.gridPopupSettingsForHoldBill=new J.im,this.trialUrl=!1,this.showUnApprove=!1,this.gridPopupSettingsForIntend=new J.im,this.showschemePopup=!1,this.editClicked=!1,this.viewClicked=!1,this.RouteList=[],this.CustomerList=[],this.hideButton=!1,this.addForRequisition=!1,this.divisionList=[],this.warehouseList=[],this.showReverseEntryAuth=!1,this.reverseEntryAuthObj={username:"",password:""},this.multiselectPopupSettings=new W.oe,this.genericGridTransferOutSetting=new J.im,this.showEdit=!1,this.showPriceChangeDetail=!1,this.showPriceChangeDetailINDisc=!1,this.recurringItems=[],this.commissionChargeable=[],this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this.showForceClose=!1,this.showTenderList=!1,this.recurringLogMode="add",this.displayNameForceClose="Force Close",this.TermsButtonTag="APPLY T&C",this.NegativeBillAuthObj={username:"",password:"",remarks:""},this.termnConditionMode="",this.promptPrintDevice=!1,this.printControl=new O.NI(0),this.ConsumptionArray=[],this.reportData=[],this.menudata=[],this.reportHeaders=["ProductCode","ProductName","BatchNumber","MfgDate","ExpDate","Case","Each","Rate","Vat","NetAmount"],this.reportBody=["MCODE","ITEMDESC","BATCH","MFGDATE","EXPDATE","AltQty","BASEQUANTITY","ALTRATE","VAT","NETAMOUNT"],this.schemeFilterList=[],this._trnMainService.TrnMainObj.IsWholesale=!1,this.appType=this.masterService.appType,this.TrnMainObj=i.TrnMainObj,this.masterService.ShowMore=!1,this.AppSettings=this.setting.appSetting,this.userProfile=de.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.showSecondaryButtons=!1,"VIEW"==this._trnMainService.TrnMainObj.Mode&&(this.showSecondaryButtons=!0),this.masterService.refreshTransactionList(),this.orgtype=this._trnMainService.userProfile.CompanyInfo.ORG_TYPE,this.userSetting=de.getSetting(),(this.TrnMainObj.VoucherType==S.Km.CreditNote||this.TrnMainObj.VoucherType==S.Km.SalesReturn)&&(this.transactionType="creditnote"),this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&1==this.userSetting.PODELIVERYMODE&&(this.TermsButtonTag="VIEW T&C"),this.gridPopupSettings="add-creditnote-itembase-approval"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSALESRETURN"):"add-stock-issue-approval"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSTOCKTRANSFER"):"export-sales-invoice"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"EXPORT_SALES"):"purchase-import"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE"):"goods-received-note-import"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,this._trnMainService.TrnMainObj.AdditionalObj.tag):"add-membership-sales-invoice"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"MembershipSalesInvoice"):"transfer-out-approval"==A.snapshot.url[0]?.path||"stock-issue-approval"==A.snapshot.url[0]?.path?this.getPopUpSettingForApproval():"purchase-import-order"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE_ORDER"):"asset-purchase-invoice"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"ASSET_PURCHASE"):"assets-openingstockentry"==A.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("OP_ASSET","ASSET_OPENING"):this.masterService.getGenericGridPopUpSettings("shortage-adjustment"==A.snapshot.url[0]?.path?"CENTRAL_SHORTAGE_ADJUSTMENT":"excess-adjustment"==A.snapshot.url[0]?.path?"EXCESS_ADJUSTMENT":this.TrnMainObj.VoucherPrefix),"DL"==this.TrnMainObj.VoucherPrefix&&this.addCustomerfilterforDeliveryViewPopup(),this.gridPopupSettingsForHoldBill=this.masterService.getGenericGridPopUpSettings("HOLDBILLLIST"),this.gridPopupSettingsForIntend=this.masterService.getGenericGridPopUpSettings("INTENDLIST"),this.activeurlpath=A.snapshot.url[0].path,this.itemInfoPopupSettings={title:"Item Info"}}addCustomerfilterforDeliveryViewPopup(){this.gridPopupSettings.columns.splice(1,0,{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1})}ngOnInit(){console.log("voucher master action",this.arouter.snapshot),this.arouter.queryParams.subscribe(i=>{if("DRILL"==i.mode&&i.returnUrl)this.returnUrl="/pages/reports/"+i.returnUrl;else{if(this.returnUrl="/pages/dashboard/dashboard",this._trnMainService.TrnMainObj.Mode="NEW",this.viewClicked=!1,this.editClicked=!1,this.hideButton=!0,this.masterService.headerMode="(NEW)",this.arouter.snapshot.params.returnUrl&&(this.returnUrl=this.arouter.snapshot.params.returnUrl),"StockSettlementEntryApproval"==this.activeurlpath)return this.trialUrl=!0;if("StockSettlementEntry"==this.activeurlpath)return this.showUnApprove=!0}}),90===this._trnMainService.TrnMainObj.VoucherType&&(this.displayNameForceClose="Rejection"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue)&&1==this.userSetting.EnableRequisitionApproval&&(this.requisitionApprovalValue=1)}filterloginDivision(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||"add-branch-out"==this._trnMainService.activeurlpath)&&(this.divisionList=this.divisionList.filter(i=>i.INITIAL!=this.userProfile.userDivision))}ngAfterViewInit(){(8===this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType)&&(this.masterService.getNotLoginDivisionList().subscribe(i=>{this.divisionList=i,8===this._trnMainService.TrnMainObj.VoucherType&&this.filterloginDivision()}),this.masterService.getWarehouseList().subscribe(i=>{this.warehouseList=i}))}ngOnDestroy(){try{this.subscriptions.forEach(i=>{i.unsubscribe()})}catch{}}checkOfflineBilling(){return!((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&1==this.userProfile.isOfflineBilling)}editButtonCheck(){return 1!==this._trnMainService.TrnMainObj.VoucherType&&14!==this._trnMainService.TrnMainObj.VoucherType&&(3===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType||64===this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType||9===this._trnMainService.TrnMainObj.VoucherType||31===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryReturn||24===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry||82===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&0==this.userSetting.INVBASEPROFORMA)}checkUserRights(i){const n=this.userProfile.menuRights.find(s=>s.menu==this.activeurlpath);if(n){let p,s=n.right,A=!0;switch(i){case"add":p=s.find(ie=>"add"==ie),null==p&&(A=!1);break;case"edit":p=s.find(ie=>"edit"==ie),null==p&&(A=!1);break;case"delete":p=s.find(ie=>"delete"==ie),null==p&&(A=!1);break;case"print":p=s.find(ie=>"print"==ie),null==p&&(A=!1),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"add-creditnote-itembase"==this.activeurlpath)&&(A=!0);break;case"view":p=s.find(ie=>"view"==ie),null==p&&(A=!1)}return console.log("allowedd?",A),!!A||(this.alertService.warning("Current user has no rights to "+i),!1)}return this.alertService.warning("Cannot find any user rights."),!1}stockSettlementApprovalLoad(){this.onLoadFromStockSettlementApproval.emit(!0)}stockSettlementOnApproveList(){this.onApproveStockSettlementList.emit(!0)}productionConsumptionList(){let i="";"production-entry"==this.activeurlpath||"newproduction-entry"==this.activeurlpath?i="production":"consumption-entry"==this.activeurlpath&&(i="consumption"),this.gridPopupSettings={title:"Vouchers",apiEndpoints:`/getProductionConsumptionPagedList/${i}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"VCHRNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}stockSettlement(){var i=this._trnMainService.TrnMainObj.Mode="NEW";this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.IsApproveStockSettlement),(null==this._trnMainService.TrnMainObj.ProdList||null==this.TrnMainObj.ProdList)&&this.alertService.info("Product List is empty"),this.masterService.saveTransaction(i,this._trnMainService.TrnMainObj).subscribe(n=>{"ok"==n.status&&this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)})}onLoadFromSalesOrder(){this.onLoadFromSOClickEmit.emit(!0)}onLoadSalesCancel(){this.onLoadCancelSalesEmit.emit(!0)}onLoadFromPurchaseOrder(){this.onLoadFromPOClickEmit.emit(!0)}onLoadFromHOPerformaInvoiceClick(){this.onLoadFromHOPerformaInvoiceClickEmit.emit(!0)}onLoadFromHoTaxInvoiceClick(){this.onLoadFromHoTaxInvoiceClickEmit.emit(!0)}onLoadFromSAPFTPClick(){this.onLoadFromSAPFTPClickEmit.emit(!0)}onCloseClicked(){this.router.navigate(["/pages/dashboard"])}onEditClicked(){this.checkUserRights("edit")&&(this.onViewClicked("EDIT"),this.editClicked=!0,this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)",this._trnMainService.disableCustomerInputField=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.isRatePartial=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.disableNepaliDate=24===this._trnMainService.TrnMainObj.VoucherType)}onSyncClicked(){if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.alertService.warning("Please load voucher to sycn"),!1;this.loadingService.show("Syncing data, please wait"),this.masterService.syncBranchTransferOut(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.alertService.success(i.result),this.onReset()):"error"==i.status&&(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}onViewClicked(i=""){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.billFormatsForPrint=null,this.viewClicked=!0,"canceladdsientry"==this.activeurlpath?(this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this.onViewTaxCancel(),this.genericGrid.show()):"StockSettlementEntry"==this.activeurlpath?(this.stockSettlementOnApproveList(),this.viewClicked=!0,this._trnMainService.viewModeForStockSettle=!0):"PD"==this.TrnMainObj.VoucherPrefix?(this._trnMainService.TrnMainObj.Mode=i,this.productionConsumptionList(),this.genericGrid.show()):"PP"==this.TrnMainObj.VoucherPrefix?(this.gridPopupSettings.apiEndpoints="EDIT"==i?"/getTrnMainPagedList/PP/EDIT":"/getTrnMainPagedList/PP/tag",this.genericGrid.show()):"ER"==this.TrnMainObj.VoucherPrefix?("excess-goods-acknowledgement"==this.activeurlpath?this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreceive":"excess-goods-return"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreturn"),this.genericGrid.show()):("add-sales-invoice-wholesale"===this?.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/TI/wholeSale"),"self-billing"===this?.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/TI/selfBilling"),this.genericGrid.show()),this.clearQtyRate(),"VIEW T&C"==this.TermsButtonTag&&(this.TermsButtonTag="APPLY T&C")}gridPopupDataforPreviousOpening(){this.gridPopupSettingForPreviousOpening={title:"Vouchers",apiEndpoints:"/getCarryForwardOpeningVouchers",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}gridPopupDataforLargeDataEntry(){this.gridPopupSettingForLargeEntry={title:"Vouchers",apiEndpoints:"/getTrnMainPagedList/OP/tag",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onViewCarrryForwardClicked(){this.gridPopupDataforPreviousOpening(),this.genericGridforPreviousOpening.show()}onEditLargeEntryClicked(){this.gridPopupDataforLargeDataEntry(),this.genericGridForLargeDataEntry.show()}onRecurringClick(){this.gridPopupSettingsForRecurring={title:"Recurring Log List",apiEndpoints:"/getRecurringItemList",defaultFilterIndex:3,columns:[{key:"ACNAME",title:"Customer Name",hidden:!1,noSearch:!1},{key:"RECURRING_DATE",title:"Recurring Date",hidden:!1,noSearch:!1,format:!0},{key:"DESCA",title:"Recurring Item",hidden:!1,noSearch:!1},{key:"AMOUNT",title:"Amount",hidden:!1,noSearch:!1},{key:"ENTRYNO",title:"Entry No",hidden:!1,noSearch:!1}]},this.genericGridForRecurring.show()}promptPrinterDevice(){this.promptPrintDevice=!0,setTimeout(()=>{console.log("nativelem",this.printSetupModal),null!=this.printSetupModal&&this.printSetupModal.nativeElement.focus()},500)}printPosBill(){var i;this.showPosPrinterPreview=!1,(i=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function s(p){},!1),i.addEventListener("open",function n(p){i.onopen=()=>i.send(p)}(this.TrnMainObj.printStringForPos),!1),this._trnMainService.TrnMainObj.VoucherType=61==this._trnMainService.TrnMainObj.VoucherType?14:this._trnMainService.TrnMainObj.VoucherType}setPrinterAndprint(){if(this.promptPrintDevice=!1,this.userProfile.PrintMode=this.printControl.value,this._trnMainService.printModeForInvoice=this.userProfile.PrintMode,this.modeis=this._trnMainService.TrnMainObj.Mode,0==this.masterService.userSetting.DISPLAY&&(this.userProfile.PrintMode=99),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales){let i=JSON.parse(localStorage.getItem("USER_PROFILE"))?.isIRDVerified;if(1==JSON.parse(localStorage.getItem("USER_PROFILE"))?.isOfflineBilling)return;if(0==i)return void this.alertService.info("IRD approved Invoice Format is not available for printing.")}if("add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales&&(this.userProfile.PrintMode=0),"export-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableExportTaxInvoice&&(this.userProfile.PrintMode=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&(this.userProfile.PrintMode=0==this.userSetting.showLaserPintInSi||2==this.userSetting.showLaserPintInTi&&1==this.printControl.value?1:0),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(1==this.userSetting.showLaserPintInTi||2==this.userSetting.showLaserPintInTi&&0==this.printControl.value?this.userProfile.PrintMode=0:0==this.userSetting.showLaserPintInTi&&(this.userProfile.PrintMode=1)),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&(this.userProfile.PrintMode=1==this.userSetting.showLaserPintInSi&&1==this.userSetting.showLaserPintInTi&&1==this.userSetting.ENABLEMANUALSALESRETURN||1!=this.userSetting.ENABLEMANUALSALESRETURN&&(1==this.userSetting.showLaserPintInTi&&this._trnMainService.TrnMainObj.REFBILL?.startsWith("TI")||1==this.userSetting.showLaserPintInSi&&this._trnMainService.TrnMainObj.REFBILL?.startsWith("SI"))||1==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.printControl.value?0:1),console.log("voucher type in print mode",this._trnMainService.TrnMainObj.VoucherType),(this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseTaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote)&&(this.userProfile.PrintMode=1),0!=this.userProfile.PrintMode){this.loadingService.show("please wait. Getting invoice data ready for printing.");try{if(this.parac=this._trnMainService.TrnMainObj.PARAC,"VIEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode){this.billFormatsForPrint=null,1!=this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),1==this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS});try{this.voucher=this._trnMainService.TrnMainObj.VCHRNO,this.masterService.savePrintLog(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockSettlement?this.masterService.getPrintTitleAsCopy(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}1==this.userSetting.EnableBillFormatInBilling&&this.masterService.getBillUnits(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{"ok"==i.status&&(this._trnMainService.qtyCheckForPrint="CASE"==i.result)})}else if("NEW"==this.modeis)try{this.masterService.savePrintLog(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this.phiscalid,this.trnuser).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"add-membership-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleNEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockSettlement?this.masterService.getPrintTitleAsCopy(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(console.log("PRINT-TITLE-as copy",n.result),this.titleNEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}}catch(i){this.alertService.info(i)}setTimeout(()=>{this._trnMainService.TrnMainObj.VoucherType=this._trnMainService.ReturnVoucherType(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)},100)}else try{"NEW"==this.modeis?this.masterService.getReprintData(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)}):this.masterService.getReprintData(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)})}catch(i){return void this.alertService.info(i)}}onPrintClicked(){this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation&&(this.TermsButtonTag="APPLY T&C"),this.modeForPrint=(0,q.cloneDeep)(this._trnMainService.TrnMainObj.Mode),this.checkUserRights("print")&&(1==this.masterService.userSetting.DISPLAY||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&2==this.userSetting.showLaserPintInSi||"add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales||(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&2==this.userSetting.showLaserPintInTi||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(1!=this.userSetting.showLaserPintInTi||1!=this.userSetting.showLaserPintInSi)?this.promptPrinterDevice():this.setPrinterAndprint())}print(i){var n;(n=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function p(){},!1),n.addEventListener("open",function s(A){n.onopen=()=>n.send(A)}(i),!1)}onApplyTC(){const i=this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID;"VIEW T&C"==this.TermsButtonTag&&(this.termnConditionMode="VIEW"),i?this.getTermsAndConditionForViewMode(i).subscribe(n=>{this.showTermConditionPopUp(n)}):("add-purchase-order"==this.activeurlpath&&this._trnMainService.TrnMainObj.BILLTO&&(this.TermnCondId=null),this.termnConditionMode="",this.showTermConditionPopUp())}showTermConditionPopUp(i=[]){this.TermConditionPopup.show(i,this.termnConditionMode)}getTermsAndConditionForViewMode(i){if(i)return this.masterService.getMultipleTermsAndCondition(i)}onSaveClicked(){if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance||5!=this._trnMainService.TrnMainObj.CNDN_MODE||this.validationService.validateEmptyACName(this._trnMainService.TrnMainObj.AssetsProdList)&&this.validationService.validateEmptySubLedger(this._trnMainService.TrnMainObj.AssetsProdList)){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&this._trnMainService.TrnMainObj.REFBILL?.trim().toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.info("Refno and Bill No cannot be same");if(this.validationService.validateVariantProduct(this._trnMainService.TrnMainObj)){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder){if(!this.validationService.validateSalesOrderAdvancePayment(this._trnMainService.TrnMainObj))return;1==this.userSetting.ENABLE_WSRATE_INSORDER&&(this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate=1)}if("export-sales-invoice"!=this.activeurlpath||!this.validationService.validateExportsales(this._trnMainService.TrnMainObj)){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return void this.productHelperSerivce.saveButtonClicked();if(this._trnMainService.TrnMainObj.VoucherType in S.lK&&1==this._trnMainService.showFlatDiscOption)return void this.alertService.info("Please apply the inserted Flat discount before saving");if("add-branch-in"==this._trnMainService.activeurlpath&&null==this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please Select the Warehouse.");if(88==this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.LinkProductionwithconsumption){for(const n of this._trnMainService.TrnMainObj.ProdList)if(!n.EXPDATE&&n.REQEXPDATE)return void this.alertService.info("Please select expiry date for item: "+n.ITEMDESC);let i=this.onSaveClickValidationService.getDuplicatesForConsumptionList(this._trnMainService.TrnMainObj.ConsumptionProdList);if(i=i.filter(n=>!n.BATCH),i.length>0)return void this.alertService.info("Items: "+[...i.map(n=>n.ITEMDESC)]+" have empty batch. Please Review your Entry!!")}if(this.checkUserRights("add")){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&"export-sales-invoice"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&1==this.userSetting.GblEnableMixedTenderMode&&"B2C"==this.userSetting.CompanyType)return 1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTMEMPOINTS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)?void this.MemberPointConfirmationPopup.show():(this.NETAMNTWITHROUNDOFF=this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.calculateAvailableScheme(),this._trnMainService.assignNetAmntWithRoundOff(this.NETAMNTWITHROUNDOFF),void this.paymentClick());if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SchemeList?.length>0).length>0&&confirm("Do you want to apply scheme before saving ?")&&this._trnMainService.calculateAvailableScheme(),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&1===this.userSetting.EnableDigitalSignature)return this.clearSignature(),void this.digitalSignUpload.show();if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)this.masterService.getAssetDepreciationDoneMonths().subscribe(i=>{const n=this._trnMainService.TrnMainObj.BSDATE.split("/")[1];for(const s of i.result)if(s.MONTHNO===n)return void this.alertService.info(`Depreciation cancellation is required to proceed for this month(${s.MONTHNAME.toLowerCase()})`);this.onSaveTransactionClicked(),this.clearQtyRate()});else{if("delivery-chalan"===this.activeurlpath||"delivery-chalan-return"===this.activeurlpath){const i=this._trnMainService.TrnMainObj?.ProdList?.find(n=>0===n.RATE);if(i)return void this.alertService.info(`Please enter rate for ${i.ITEMDESC}!`)}this.onSaveTransactionClicked(),this.clearQtyRate()}}}}}}doAutoRoundingInSales(){1==this.userSetting.EnableRoundoff&&!this._trnMainService.isPurchaseModule()&&this._trnMainService.rounding()}clearSignature(){return(0,e.Z)(function*(){const{SigCapture:i}=yield Promise.resolve().then(b.bind(b,46241)),{SessionControl:n}=yield Promise.resolve().then(b.bind(b,5881));null!=i.HTMLTagIds?.imageBox?.firstChild&&(i.HTMLTagIds.imageBox.removeChild(i.HTMLTagIds.imageBox.firstChild),n.actionWhenRestarted())})()}validationInImportDocumentDetails(){if("purchase-import"===this.activeurlpath){if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return this.alertService.info("Please enter Import Document No!"),!0;if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)return this.alertService.info("Please enter L/C No!"),!0;if(1==this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport&&(!this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME))return this.alertService.info("Please select VAT Credit A/C!"),!0}return!1}confirmationOkClicked(i){i?(this._trnMainService.calculatePointRedemptionDiscount(),this.paymentClick()):(this._trnMainService.TrnMainObj.ProdList.forEach(n=>n.LOYALTY=0),this._trnMainService.TrnMainObj.MEMREDEEMPOINT=0,this._trnMainService.ReCalculateBillWithNormal(),this.paymentClick())}checkRedeemablePoint(){1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)&&confirm("Member has redeemable points remaining. Do you want to redeem points as discount?")&&(this._trnMainService.TrnMainObj.TOTALLOYALTY=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)*this._trnMainService.nullToZeroConverter(this.userSetting.PointConversionRate),console.log("TOTALLOYALTY value",this._trnMainService.TrnMainObj.TOTALLOYALTY,this._trnMainService.TrnMainObj.NETAMNT))}showNotificationCount(){this.connection=(new Z.su).withUrl(`${k.N.apiUrl}/notificationConnection`,{transport:Z.n4.WebSockets}).withAutomaticReconnect().build();var i=this;this.connection.start().then(()=>{console.log("start"),this.connection.invoke("GetConnectionId").then(function(n){console.log(n),i.socketId=n,i.connection.on("ReceiveMessage",s=>{console.log("connected"),this.notificationsService.info("Report Status",s.message),console.log(s.message)})})}).catch(n=>{})}onNewProductionEntrySave(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ConsumptionList.forEach(n=>{n.MasterMCode=i.MCODE,this.ConsumptionArray.push(n)})}),this._trnMainService.TrnMainObj.ConsumptionProdList=this.ConsumptionArray,this.ConsumptionArray=[]}onSaveTransactionClicked(){if("performa-invoice"==this.activeurlpath&&null==this._trnMainService.TrnMainObj.BILLTO)return this.alertService.warning("Please select customer first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("customerselectid").focus()},100)});if(2==this.userSetting.enablesalesman&&!this._trnMainService.TrnMainObj.SALESMAN&&(this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation))return this.alertService.warning("Please select salesman first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("salesmanselect").focus()},100)});if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation&&1==this.userSetting.ApplyTermsAndCondition){if(!this._trnMainService.TrnMainObj.AdditionalObj.PAYMENTTERMS)return void this.alertService.warning("Please select payment term!!!");if(!this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID)return void this.alertService.warning("Please select terms and conditions!!!")}if("RQ"!=this._trnMainService.TrnMainObj.VoucherPrefix||"EDIT"!=this._trnMainService.TrnMainObj.Mode||10!=this._trnMainService.TrnMainObj.STATUS)if(this.TrnMainObj.VoucherType==S.Km.RequisitionEntry&&this.showNotificationCount(),"newproduction-entry"===this.activeurlpath&&this.onNewProductionEntrySave(),this.TrnMainObj.VoucherType==S.Km.OpeningStockBalance||1!=this.userSetting.EnableRefno||""!=this._trnMainService.TrnMainObj.CHALANNO&&""!=this._trnMainService.TrnMainObj.CHALANNOPREFIX)if(this._trnMainService.saveButton=!0,this._trnMainService.TrnMainObj.VoucherType!=S.Km.Repack||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"QuantityExceed"!=this._trnMainService.quantityExceedCheck||"edit"!=this._trnMainService.TrnMainObj.Mode?.toLocaleLowerCase())if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssueReturn||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.AdditionalObj&&(this.billformat=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS),"GreaterQuantity"!=this._trnMainService.QuantityMsg)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoiceCancel||null!=this._trnMainService.TrnMainObj.REMARKS&&""!=this._trnMainService.TrnMainObj.REMARKS&&null!=this._trnMainService.TrnMainObj.REMARKS){if((this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Sales||"credit"!=this._trnMainService.TrnMainObj.TRNMODE||this.checkCreditLimitForTransaction())&&(this._trnMainService.TrnMainObj.VoucherType!=S.Km.SalesOrder||1!=this.userSetting.EnableCreditLimitInSO||this.checkCreditLimitForTransaction())){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder){let n="";if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder?(this._trnMainService.TrnMainObj.PARAC||(this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC),n="Supplier"):this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(n="Customer"),null==this._trnMainService.TrnMainObj.BILLTO||""==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please Choose "+n+" to proceed...")}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this._trnMainService.salesmanID=this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.salesmanName=this._trnMainService.TrnMainObj.SALESMAN,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,"add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.IsWholesale=!0,this._trnMainService.TrnMainObj.INVOICETYPE="wholeSale")),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase-approval"==this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.isApproved)),this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote){if(1==this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry){if(this._trnMainService.TrnMainObj.TRNDATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Entry date cannot be set before of Sales Invoice date!!!");if(this._trnMainService.TrnMainObj.TRN_DATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Invoice date cannot be set before of Sales Invoice date!!!")}if("DN"==this._trnMainService.TrnMainObj.REFORDBILL?.substring(0,2)&&!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REMARKS)return void this.alertService.info("Remarks cannot be empty");if(!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if("salesreturn"==this._trnMainService.TrnMainObj.TRNMODE&&"error"==this._trnMainService.TrnMainObj.TRNACName&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.warning("Default Sales return voucher AC' on database not set. Cannot save !")}if(!(this._trnMainService.TrnMainObj.VoucherType!==S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.PurchaseOrder&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.TaxInvoice||"purchase-import"!=this.activeurlpath&&"purchase-import-order"!=this.activeurlpath&&"export-sales-invoice"!=this.activeurlpath&&"goods-received-note-import"!=this.activeurlpath)){this.removeInvalidRowsFromprod();let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.INVRATE||null==s.INVRATE)[0];if(null!=n)return void this.alertService.info(`Rate cannot be 0 for item ${n.ITEMDESC} !!!`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice){if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Payment Terms cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account  not be empty");if("export-sales-invoice"===this.activeurlpath&&!this._trnMainService.TrnMainObj.COUNTRY)return void this.alertService.info("Country cannot be empty");if(!this._trnMainService.TrnMainObj.BILLTO)return this.alertService.info("Customer cannot be empty"),void("add-membership-sales-invoice"==this.activeurlpath&&this.alertService.info("Member cannot be empty"));if("add-membership-sales-invoice"==this.activeurlpath){let n=U()(new Date(this.masterService.userSetting.MEMBERITEMSPERIODS)).format("YYYY-MM-DD");if(this._trnMainService.TrnMainObj.TRNDATE>n)return void this.alertService.info("Transaction cannot be done...Exceeds item period")}}if(!(this._trnMainService.TrnMainObj.VoucherType!==S.Km.Sales||"cash"!=this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()||"B2B"!=this.userSetting.CompanyType||this._trnMainService.TrnMainObj.BILLTO&&this._trnMainService.TrnMainObj.PARAC))return void this.alertService.info("Customer cannot be empty. Select Customer Party to proceed");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Return Mode cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder&&!this._trnMainService.TrnMainObj.COSTCENTER&&1==this.userSetting.enabledistributedpurchase)return void this.alertService.info("Cost Center cannot be empty");if((this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&"goods-received-note"==this._trnMainService.activeurlpath)&&!this._trnMainService.TrnMainObj.COSTCENTER&&0!=this.userSetting.enableCostCenter&&1==this.userSetting.EnableCompulsoryCostCenter)return void this.alertService.info("Cost Center cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Please Enter the Invoice Number");if(!this._trnMainService.TrnMainObj.TRNAC&&"GOODS_RECEIVED_NOTE_IMPORT"!=this._trnMainService.TrnMainObj.AdditionalObj.tag)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE&&"goods-received-note-import"!=this.activeurlpath)return void this.alertService.info("Payment Terms cannot be empty");if("purchase-import"!=this.activeurlpath&&!this._trnMainService.TrnMainObj.BILLTOTEL&&0==this._trnMainService.TrnMainObj.VATBILL)return void this.alertService.info("Supplier VATNO cannot be empty");if("cheque"==this._trnMainService.TrnMainObj.TRNMODE){if(!this._trnMainService.TrnMainObj.CHEQUENO)return void this.alertService.info("Cheque No cannot be null");if(!this._trnMainService.TrnMainObj.CHEQUEDATE)return void this.alertService.info("Cheque Date cannot be null")}}if("add-purchase-invoice"==this.activeurlpath||"add-debitnote-itembase"==this.activeurlpath){if(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT)>0&&!this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME)return void this.alertService.info("Please press F10 and select the TDS Account to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT))return void this.alertService.info("Please press F10 and enter the TDS Amount to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.SubLedgerValidation)return void this.alertService.info("Please press F10 and select the TDS Sub Ledger Account to proceed!!!")}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Production warehouse cannot be empty");if(!this._trnMainService.TrnMainObj.BILLTOADD&&1==this.userSetting.EnableCompulsaryConsumption)return void this.alertService.warning("Consumption warehouse cannot be empty");this.assignWarehouseInProduction()}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&1==this.userSetting.EnableProperExpTracking||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&1==this.userSetting.EnableProperExpTracking||this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry)&&!this.checkExpiry())return!1;if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferIn){if(0===this.userSetting.centralizeddbmode&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userDivision),!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.warning("Ref No. cannot be empty.");if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Transfer from field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){let n=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>new Date(s.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=s.MCODE&&1==s.REQEXPDATE)[0];if(console.log("expdta",n),null!=n&&this._trnMainService.TrnMainObj.ConsumptionProdList.some(s=>6!==s.PTYPE))return void this.alertService.info("Expired Item Detected : "+n.ITEMDESC+"..Please Review the list...")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("To Warehouse field cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry){if("TransferOut"==this._trnMainService.TrnMainObj.INVOICETYPE&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision),""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Requisition To field cannot be empty");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut){if(1===this.userSetting.REMARKSCOMPULSORYINBTRANSFEROUT&&!this._trnMainService.TrnMainObj.REMARKS?.trim())return void this.alertService.warning("Remarks is Mandatory");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected");var i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(n){return[n.MCODE,n.BATCH,n.ALTUNIT,n.ALTRATE,n.BC]});for(const n of i)if(n.length>1){const s=n[0];return this.alertService.warning(`Cannot save same item "${s.ITEMDESC}" with same rate "${s.ALTRATE}".`),!1}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){const n=this._trnMainService.TrnMainObj.ProdList.some(s=>1===s.REQEXPDATE);i=2==this.userSetting.EnableBatch?this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(s){return n?[s.MCODE,s.BATCH,s.RATE,s.BC,s.CRATE,s.EXPDATE]:[s.MCODE,s.BATCH,s.RATE,s.BC,s.CRATE]}):this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.ISUNKNOWN),function(s){return n?[s.MCODE,s.BATCH,s.RATE,s.BC,s.EXPDATE]:[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const s of i)if(s.length>1&&1!=this._trnMainService.TrnMainObj.isDeliveryOrder){const p=s[0];return this.alertService.warning(`Cannot save same item "${p.ITEMDESC}" with same rate "${p.ALTRATE}".`),!1}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction){i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>0==s.ISUNKNOWN),function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const s of i)if(s.length>1){const p=s[0];return this.alertService.warning(`Cannot save same item "${p.ITEMDESC}" with same rate "${p.ALTRATE}".`),!1}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&2==this.userSetting.EnableOnetoOneProduction){this.removeInvalidRowsFromprod();let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==this._trnMainService.nullToZeroConverter(s.AMOUNT))[0];if(n)return void this.alertService.info(`Amount can not be empty for item ${n.ITEMDESC}`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&!this._trnMainService.TrnMainObj.RECEIVEBY)return void this.alertService.warning("Please select customer to save !");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&"VIEW"!=this._trnMainService.buttonMode&&1===this.userSetting.ShowPriceChangePopup){let n=this._trnMainService.TrnMainObj.ProdList.lastIndexOf(this._trnMainService.TrnMainObj.ProdList.filter(s=>s.PREV_PRATE!==s.ALTRATE&&!s.HasSellingPriceChange)[0]);if(this.activeindex=n,n>=0)return this._trnMainService.getAllSelingPriceOfItem(n),void(this.showPriceChangeDetail=!0)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation&&(this.recurringItems=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.ISRECURRING),this.commissionChargeable=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.HASCOMMISSIONCHARGE),this.recurringItems?.length>0||this.commissionChargeable?.length>0))return this.commissionChargeable.length>0&&(null==this._trnMainService.TrnMainObj.SALESMANID||""==this._trnMainService.TrnMainObj.SALESMANID)?(this.alertService.warning("Please select salesman for entering commission chargeable item details !"),this.commissionChargeable=[],void(this.recurringItems=[])):(this.recurringLogMode="add",void this.RecurringLog.show("add",this._trnMainService.TrnMainObj.MAIN_RECURRING_ID,this._trnMainService.TrnMainObj.RECURREFBILL));if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation){let n=this._trnMainService.TrnMainObj.ProdList,s=this._trnMainService.TrnMainObj.RecurringItemList,A=this._trnMainService.TrnMainObj.CommissionItemList?.filter(ie=>n.find(se=>se.MCODE==ie.MCODE));if(this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],s?.length>0&&(this.recurringItemsForEdit=s),A?.length>0&&(this.commissionItemsForEdit=A),this.recurringItemsForEdit?.length>0||this.commissionItemsForEdit?.length>0)return this.recurringLogMode="edit",void this.RecurringLog.show("edit")}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice)&&0===this.userSetting.DisableCostPriceValidationInSO){let n=this.checkForUserRigths("AllowSalesBelowCRate");if(n&&0==n?.value&&!this.checkSalesRateBeforeCrate())return}if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.BranchTransferOut||this.checkExpItem()){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&"asset-purchase-invoice"!=this.activeurlpath&&"NONTRADING"==this._trnMainService.TrnMainObj.INVOICETYPE&&1==this.userSetting.EnableSubLedger){let n=this._trnMainService.TrnMainObj.AdditionProdList.filter(s=>1==s.HASSUBLEDGER).find(s=>null==s.SL_ACNAME);if(n)return void this.alertService.warning(`Subledger field cannot be left empty for the item: ${n.ITEMDESC}!!!`)}!this.transactionValidator()||(this.onSubmit(),this._trnMainService.onFlatDiscountClear(),this._trnMainService.isRatePartial=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE)}}}else this.alertService.info("Remarks is required...");else this.alertService.info("Quantity exceed the transaction stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Refno or Prefix cannot be empty");else this.alertService.info(`Cannot save ${this._trnMainService.TrnMainObj.VCHRNO} voucher no as it is already forced closed.`)}onBarCodeClicked(){this._trnMainService.showBarCodePopUPinViewMode=!0,this._trnMainService.showBarCodePopUPSubject.next()}assignWarehouseInProduction(){for(const i of this._trnMainService.TrnMainObj.ProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTO;for(const i of this._trnMainService.TrnMainObj.ConsumptionProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTOADD}onPerformaViewRequest(){this._trnMainService.buttonMode="VIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice?i="PQ":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&(i="CD"),this.gridPopupSettingsForViewPerforma=this.masterService.getGenericGridPopUpSettings(i),this.genericGridPerformaView.show()}checkCreditLimitForTransaction(){return!(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.CREDITLIMIT)>0&&this.validationService.validateCreditLimit(this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.TrnMainObj.BLAMOUNT,this._trnMainService.TrnMainObj.CREDITLIMIT)&&!this.checkCreditLimitRights())}onViewReverseClick(){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this.billFormatsForPrint=null,this._trnMainService.reverseViewTag="REVERSEVIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&(i="PX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&(i="RR"),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(i="DX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(i="RE"),this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry?i="PE":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn&&(i="RX"),this.gridPopupSettingsForReverse=this.masterService.getGenericGridPopUpSettings(i,this._trnMainService.TrnMainObj.AdditionalObj.tag),console.log("modevalue",this._trnMainService.TrnMainObj),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&5==this._trnMainService.TrnMainObj.CNDN_MODE&&this.prepareApiUrlforAssetPurchaseReverseView(this.gridPopupSettingsForReverse),this.genericGridReverseView.show()}prepareApiUrlforAssetPurchaseReverseView(i){i.apiEndpoints="/getTrnMainPagedList/PX/assetPurchaseReverse"}checkItemIsSelectedINProduction(){return!!this._trnMainService.TrnMainObj.ProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)>0)||(this.alertService.warning("Please enter Production Quantity."),!1)}checkItemIsSelectedINConsumption(){return!(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(n=>null==n.MCODE||""==n.MCODE)?.length>0&&(this.alertService.info("Items are not selected for consumption"),1))}checkInvalidQtyINConsumption(){let i=this._trnMainService.TrnMainObj.ConsumptionProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)<=0);return!i||(this.alertService.info(`Invalid Quantity is found in item: ${i.ITEMDESC}`),!1)}checkInvalidityInAdditionalPurchase(){if(!this._trnMainService.TrnMainObj.AdditionProdList.length)return!0;for(const i of this._trnMainService.TrnMainObj.AdditionProdList){if(this._trnMainService.nullToZeroConverter(i.ALTERNATEQUANTIY)<=0)return this.alertService.info(`Invalid Quantity is found in Account: ${i.MANUFACTURER}`),!1;if(!i.ITEMDESC)return this.alertService.info(`Description cannot be empty: ${i.ITEMDESC}`),!1;if(this._trnMainService.nullToZeroConverter(i.NETAMOUNT)<=0)return this.alertService.info(`NetAmount is Invalid: ${i.NETAMOUNT}`),!1}return!0}transactionValidator(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&(this._trnMainService.TrnMainObj?.ConsumptionProdList?.length>1&&this.removeInvalidRowsFromConsumptionprod(),!(this.checkItemIsSelectedINProduction()&&(0==this.userSetting.EnableCompulsaryConsumption&&this.removeInvalidRowsFromConsumptionprod(),1!=this.userSetting.EnableCompulsaryConsumption||this.checkItemIsSelectedINConsumption()&&this.checkInvalidQtyINConsumption())))||(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&this._trnMainService.TrnMainObj.AdditionProdList?.length>0&&(this._trnMainService.removeInvalidRowsFromAdditionalprod(),!this.checkInvalidityInAdditionalPurchase()))return!1;if(this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length>1&&this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&this.removeRejectedQtyFromprod(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue)&&0==this.userSetting.ENABLESINGLEBATCHMODE){let n=this.findDuplicates(this._trnMainService.TrnMainObj.ProdList.map(s=>`${s.MCODE}|${s.RATE}`));if(n&&n.length>0){let s="";for(const p of n){const[A,ie]=p.split("|"),se=this._trnMainService.TrnMainObj.ProdList.filter(de=>de.MCODE==A&&de.RATE==Number(ie))?.find(de=>!de.BATCH);se&&(s=s+" "+se.ITEMDESC)}if(""!=s)return this.alertService.info(` following items ${s} have empty batch. Please check the entered items list`),!1}}if(!this._trnMainService.checkTransactionValidation())return null!=this.genericTender&&this.genericTender.hide(),!1;if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&!this._trnMainService.checkBatchWisePriceSelectedorNot())return!1;let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>1===n.HASVARIANT);if(i&&i?.length>0)for(const n of i)if(null==n.BC||""==n.BC)return this.alertService.info(`Variant Details is not selected for Item:${n.ITEMDESC}`),!1;return!!this._trnMainService.setDefaultValueInTransaction()}findDuplicates(i){const n=new Map,s=[];return i.forEach(p=>{n.has(p)?n.set(p,n.get(p)+1):n.set(p,1)}),n.forEach((p,A)=>{p>1&&s.push(A)}),s}disableSaveBtnINCaseOfSingleBatch(){if(1==this.userSetting.ENABLESINGLEBATCHMODE&&((this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&2==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&2==this.userSetting.ALLOWMINUSTOCK_STOCKISSUE||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&2==this.userSetting.ALLOWMINUSTOCK_SALES||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry&&2==this.userSetting.ALLOWMINUSTOCK_CONSUMPTION||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&2==this.userSetting.ALLOWMINUSTOCK_DEBITNOTE)&&(this._trnMainService.showNegativeBilling||this._trnMainService.showNegativeBillingAuthForMain)||this._trnMainService.TrnMainObj.VoucherType==S.Km.Repack&&2==this.userSetting.ALLOWMINUSTOCK_REPACK&&this._trnMainService.showNegativeBillingInConsumption))return!0}checkZeroRate(i){return i.filter(n=>!n.ALTRATE).length>0}onSubmit(){if(this.doAutoRoundingInSales(),("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.AssetsProdList=this._trnMainService.TrnMainObj.AssetsProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales){let i=this._trnMainService.TrnMainObj.PARAC;if(0==this.userSetting.EnablePanBill&&this._trnMainService.TrnMainObj.NETAMNT>this.userSetting.ABBlimit)return this.masterService.TempTrnMainObj=this._trnMainService.TrnMainObj,void(confirm(`Net amount is greater than ${this.userSetting.ABBlimit}, Bill cannot proceed. Do want to change to tax invoice ?`)&&(console.log("pac",i),this.router.navigate(["/pages/transaction/sales/add-sales-invoice"],{queryParams:{mode:"FROMSI",ID:i}})))}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase"==this.activeurlpath)this.saveSalesReturnDamageValueToTMP();else if("transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath)this.saveTransactionApproval();else if("add-stock-issue-approval"==this.activeurlpath)this.saveApproveStockTransfer();else if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Stockadjustment)this.saveStockSettlement();else{if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(null!=this._trnMainService.TrnMainObj.TransporterEway&&(this._trnMainService.TrnMainObj.TransporterEway.TOTALWEIGHT=this._trnMainService.TrnMainObj.TOTALWEIGHT),this.memberID=this._trnMainService.TrnMainObj.MEMBERNO,this.memberName=this._trnMainService.TrnMainObj.MEMBERNAME,this.schemeID=this._trnMainService.TrnMainObj.SCHEMENAME),"VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoiceCancel&&(this._trnMainService.TrnMainObj.Mode="NEW"),this.modeis=this._trnMainService.TrnMainObj.Mode,"NEW"==this.modeis?this._trnMainService.TrnMainObj.AdditionalObj&&(this.billFormatsForPrint=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this.billFormatsForPrint=null,this._trnMainService.TrnMainObj.PCL="pc002",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(14==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType)&&this.masterService.updateBillFormats(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS="FULL"),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&(this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.TrnMainObj.BILLTO),"requisition-entry"==this.activeurlpath&&1==this.userSetting.EnableRQLogInRQEntry){let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.checkInRQentry);if(0==i?.length)return void this.alertService.info("Please recheck the list and tick at least one of items to be requisite before saving.");this._trnMainService.TrnMainObj.ProdList=i,this._trnMainService.TrnMainObj.ProdList.forEach(n=>{n.UNIT==n.ALTUNIT&&(n.SPRICE=n.ALTRATE,n.ALTRATE=0,n.RATE=0),n.ALTQTY_IN=n.ALTERNATEQUANTIY,n.REALQTY_IN=n.ALTERNATEQUANTIY*n.ALTCONFACTOR})}if(80==this._trnMainService.TrnMainObj.VoucherType&&1==this.userSetting.EnableRQLogInRQEntry&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BASEQUANTITY=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.Quantity=i.BASEQUANTITY}),95==this._trnMainService.TrnMainObj.VoucherType||"shortage-adjustment"==this.activeurlpath){let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.checkInExcessAdj);if(0==i?.length)return void this.alertService.info("Please recheck the list and tick atleast one of the items to be adjusted before saving.");this._trnMainService.TrnMainObj.ProdList=i}if(82==this._trnMainService.TrnMainObj.VoucherType){if(this.assignRateAndQtyForAllocation(),this.mergeBranchList(),0==this._trnMainService.TrnMainObj.ProdList.filter(n=>n.TotalDispatch>0)?.length)return void this.alertService.info("No Product to Dispatch!");this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.TotalDispatch>0)}if(71==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.DIVISION=this._trnMainService.TrnMainObj.AdditionalObj.DIVISION),this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&"supplier"==this._trnMainService.TrnMainObj.filterByInReqApproval&&(this._trnMainService.TrnMainObj.INVOICETYPE="supplier",this.assignQtyInReqApp(),this.mergeBranchList()),this.ExcessAndShortageAdjustment(),"add-purchase-order"===this.activeurlpath&&(this._trnMainService.TrnMainObj.AdditionProdList=[]),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"FROMNOTIFICATION"==this._trnMainService.TrnMainObj.CHALANNOPREFIX&&(this._trnMainService.TrnMainObj.CHALANNOPREFIX=""),this._trnMainService.TrnMainObj.ProdList?.some(i=>i.MCODE)||this._trnMainService.TrnMainObj.AssetsProdList?.some(i=>i.MCODE)){let i="asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath?this._trnMainService.TrnMainObj.AssetsProdList.find(n=>!n.ALTUNIT):this._trnMainService.TrnMainObj.ProdList.find(n=>!n.ALTUNIT);if(this.validationService.checkEmptyUnit(i))return}if("asset-purchase-invoice"===this.activeurlpath&&!this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please enter Location!");if("assets-openingstockentry"===this.activeurlpath)for(const i of this._trnMainService.TrnMainObj.AssetsProdList){if(!i.ACNAME)return void this.alertService.warning("Account cannot be empty");if(!i.PurchaseDate)return void this.alertService.warning("Please enter purchase date!");if(!i.LocID)return void this.alertService.warning("Please enter Location!");if(!i.BOOKVALUE||i.BOOKVALUE<0)return void this.alertService.warning("Please enter valid Bookvalue! Cannot be negative and empty");if(1===i.HASSUBLEDGER&&!i.SL_ACNAME)return void this.alertService.warning("Please enter Subledger")}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales)&&this.userSetting?.EnableUserWiseCreditSalesRights&&!this._trnMainService.checkUserRightsForCreditSales()){const i=this.PaymentPopup?.paymentinfoList.some(s=>"CREDIT"===s.TRNMODE.trim().toUpperCase()),n="CREDIT"==this._trnMainService.TrnMainObj.TRNMODE.toUpperCase();if((this.userSetting.GblEnableMixedTenderMode&&i||n)&&!this._trnMainService.authGrantedForCreditSales)return void(this._trnMainService.showCreditSalesAuth=!0)}if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return this._trnMainService.TrnMainObj.CNDN_MODE=5,this.spinnerService.show("Saving data..."),void this.masterService.saveAssetsTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),this.alertService.success(i.result),this._trnMainService.TrnMainObj.AssetsProdList=[],this.onReset(),this._trnMainService.TrnMainObj.CNDN_MODE=5)},i=>{this.spinnerService.hide()});this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{if("ok"==i.status){this._trnMainService.prodCheckSubject.next(!0);let n=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=n.CompanyInfo.PhiscalID,this.voucherno=i.savedvchrno?i.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj?.AdditionalObj?.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableCalculateButton=!0,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.disableOnCreditSelect=!1,this._trnMainService.callPipe=!this._trnMainService.callPipe,this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.requisitionFromNotification=!1,this._trnMainService.authGrantedForCreditSales=!1,this._trnMainService.buttonMode="",this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID="",0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.productHelperSerivce.clearBarcodeGrid(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),null==this._trnMainService.TrnMainObj.ProdList)return void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn||"quotation"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&confirm("Do you want to print bill ?")&&this.onPrintClicked(),this.onReset(),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=i.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=i.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(s=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=s.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=s.BILLUNITS}),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==i.status&&this.alertService.info(i.result.error)},i=>{this.alertService.info(i)})}}mergeProdAndAdditionProdList(){console.log("AdditionalProdList",this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.ITEMDESC==n.ITEMDESC&&(i.RealQty+=n.RealQty,n.BranchWiseDistributionList.forEach(s=>{i.BranchWiseDistributionList.push(s)}))})})}assignRateAndQtyForAllocation(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.TotalDispatch,i.Quantity=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.AMOUNT=0,i.NETAMOUNT=0})}ExcessAndShortageAdjustment(){"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReceive",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.WAREHOUSE=this.userProfile.userWarehouse,i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"excess-goods-return"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReturn"),"shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="central",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"close-requisition-approval"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.Quantity=i.REALQTY_IN=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.ALTQTY_IN=i.ALTERNATEQUANTIY}),"branch-shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="branch",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.RealQty=i.REALQTY_IN,i.AltQty=i.ALTQTY_IN,i.REALQTY_IN=0,i.ALTQTY_IN=0}))}assignQtyInReqApp(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.AltQty=i.Quantity=i.RealQty,i.AMOUNT=0,i.NETAMOUNT=0})}mergeBranchList(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BranchWiseDistributionList=[],i.BranchWiseDistributionList=i.BranchWiseDistributionList.concat(i.BranchWiseDistributionList1,i.BranchWiseDistributionList2)})}saveStockSettlement(){this.spinnerService.show("Saving data Please wait a moment..."),this.masterService.saveStockSettlement(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{if("ok"==i.status){this.spinnerService.hide();let n=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=n.CompanyInfo.PhiscalID,this.voucherno=i.savedvchrno?i.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableAllFieldinSales=!1,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.loadFromRequisitionLog=0,0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.onReset(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),null==this._trnMainService.TrnMainObj.ProdList)return console.log("message error!!!"),void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),"inventory-allocation"===this.activeurlpath&&this.onSaveINVAllocation.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||"quotation"==this.activeurlpath)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,console.log("showprint"),this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&(console.log("after purchase save"),confirm("Do you want to print bill ?")&&this.onPrintClicked()),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=i.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=i.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(s=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=s.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=s.BILLUNITS}),57==this._trnMainService.TrnMainObj.VoucherType&&(this.menudata=this.TrnMainObj.ProdList),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==i.status&&(this.spinnerService.hide(),this.alertService.info(i.result.error))},i=>{this.spinnerService.hide(),this.alertService.info(i)})}excelDownloadFromHtml_manualTable(){try{this.reportData=this.menudata;let ie='<table style="border: thin solid black;">  <thead>   <tr>';for(let se of this.reportHeaders)ie+='<th style="border: thin solid black;">'+se+"</th>";ie+="</tr> </thead>",ie+="<tbody>";for(let se of this.reportData){ie+="<tr>";for(let de of this.reportBody){var i=se[de];null==i&&(i=""),ie+='<td style="border: thin solid black;">'+i+"</td>"}}ie+="</tbody></table>";var s=new Blob([ie],{type:"application/vnd.ms-excel"}),p=URL.createObjectURL(s),A=document.createElement("a");A.href=p,A.download=this.excelReportNameProvide()+".xls",document.body.appendChild(A),A.click(),document.body.removeChild(A)}catch(ie){alert(ie)}}excelReportNameProvide(){return"Proforma - "+this.TrnMainObj.BILLTO}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeRejectedQtyFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>this._trnMainService.nullToZeroConverter(i.APPROVEDALTQTY)>0)}removeInvalidRowsFromConsumptionprod(){this._trnMainService.TrnMainObj.ConsumptionProdList=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeInvaldRowsFromAdditionProd(){this._trnMainService.TrnMainObj.AdditionProdList=this._trnMainService.TrnMainObj.AdditionProdList.filter(i=>{})}nullToZeroConverter(i){return null==i||null==i||""==i?0:parseFloat(i)}viewVoucerForAssets(i){if("EDIT"===this._trnMainService.buttonMode){const n=this.masterService.checkAssetDepreciation(i.VCHRNO).pipe((0,re.K)(s=>(0,G.of)("blocked-becauseOfAssetDepreciation")),(0,ae.b)(s=>"blocked-becauseOfAssetDepreciation"===s?(0,G.of)("blocked-becauseOfAssetDepreciation"):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).pipe((0,ae.b)(p=>(0,ee.s)(()=>"ok"===p.status,(0,G.of)("ok"),(0,G.of)("blocked-becauseOfReverseEntry")))))).subscribe(s=>{"blocked-becauseOfAssetDepreciation"!==s?"blocked-becauseOfReverseEntry"!==s?this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID):this.alertService.info("Cannot edit because reverse entry of this voucher is already done"):this.alertService.info("Depreciation cancellation is required for edit command.")});this.subscriptions.push(n)}else this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID)}onItemDoubleClick(i){if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return void this.viewVoucerForAssets(i);let n=this.masterService.userProfile.userRights.find(s=>"L_EDIT"==s.right);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&1==i.POST&&"VIEW"==this._trnMainService.buttonMode&&0==n?.value&&(this._trnMainService.disableReverseEntryForLatePost=!0),this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"EDIT"!=this._trnMainService.buttonMode||0==i.POST||0!=n?.value){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&("GR"==i.REFORDBILL?.substring(0,2)||"PO"==i.REFORDBILL?.substring(0,2))||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived&&"PO"==i.REFORDBILL?.substring(0,2)&&1==this.userSetting.ENABLE_GRN_IN_PI&&"EDIT"==this._trnMainService.buttonMode?(this._trnMainService.disableAccountInputField=!0,this._trnMainService.disablePaymentTerms=!0):(this._trnMainService.disableAccountInputField=!1,this._trnMainService.disablePaymentTerms=!1),"StockSettlementEntry"!=this.activeurlpath&&null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length>0){let s=this._trnMainService.TrnMainObj.ProdList[0];if(null!=s&&null!=s.MCODE)return confirm("You are about to load the bill.Do you want to continue?")?void this.loadVoucher(i):void 0}this.loadVoucher(i)}else this.alertService.info(`Voucher Approval for ${i.VCHRNO} is already done!. You are not authorized to edit this voucher.`)}onPerformaDoubleClick(i){this.loadVoucher(i)}onRecurringDoubleClick(i){this.onReset(),this.loadingService.show("Getting Details, Please Wait..."),this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=i.VATNO,this._trnMainService.TrnMainObj.REFBILL=i.ENTRYNO,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNACName=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this.getProdListData(i),this._trnMainService.getAllUnitsOfItem(0),this.focusAfterSelectItem(),this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}getProdListData(i){let n=this._trnMainService.TrnMainObj.ProdList[0];n.PTYPE=i.PTYPE,n.ECSRATE=i.ECSRATE,n.HASECSCHARGE=i.HASECSCHARGE,n.HASECSRATE=i?.HASECSRATE,n.NATURETYPE=i.NATURETYPE,n.ENABLEITEMWISEBATCH=i.ENABLEITEMWISEBATCH,n.ITEMDESC=i.DESCA,n.ALTRATE=i.RATE,n.RATE=i.RATE,n.BASERATE=i.RATE,n.MENUCODE=i.MENUCODE,n.MCODE=i.PARENT_MCODE,n.PRATE=i.PRATE,n.HASVARIANT=i.HASVARIANT,n.ISRECURRING=i.ISRECURRING,n.ISVAT=i.ISVAT,n.MRP=i.MRP,n.ALTCONFACTOR=i.CONFACTOR,n.WARRANTY=i.WARRANTY,n.Mcat=i.MCAT,n.UNIT=i.BASEUNIT,n.HASCOMMISSIONCHARGE=i.HASCOMMISSIONCHARGE,n.DISMODE=i.DISMODE,n.WSRATE_DISCOUNT=i.WSRATE_DISCOUNT,n.ROWARN=i.ROWARN,n.MINWARN=i.MINWARN,n.PWEIGHT=i.GWEIGHT,n.ALTERNATEQUANTIY=1,n.Quantity=1}focusAfterSelectItem(){2==this.userSetting.EnableBatch?null!=document.getElementById("batch0")&&setTimeout(()=>{document.getElementById("batch0").focus()},20):null!=document.getElementById("alternateunit0")&&setTimeout(()=>{document.getElementById("alternateunit0").focus()},20)}onLoadFromPerformaInvoice(){this.onLoadFromPerformaInvoiceClickEmit.emit(!0)}onLoadFromDeliveryChalan(){this._trnMainService.TrnMainObj.TRNAC?this.deliverySelectPopup.show():this.alertService.info("Please select account first!")}onMultiItemSelected(i){let n=[];i.forEach(s=>{n.push(s.VCHRNO)}),i.every(s=>s.TRNAC===i[0].TRNAC)&&(this._trnMainService.TrnMainObj.TRNAC=i[0].TRNAC,this._trnMainService.TrnMainObj.BILLTO=i[0].BILLTO,this._trnMainService.TrnMainObj.BILLTOADD=i[0].BILLTOADD,this._trnMainService.TrnMainObj.BILLTOTEL=i[0].VATNO),this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.DELIVERYREF=n.join(","),this.multiselectGenericGrid.hide(),1==this.userSetting.EnablePartialDCInTI?this.deliveryChalanEmit.emit(n):this._trnMainService.getDeliveryChalanProdDetails(n)}getChalanList(){this.multiselectPopupSettings=this.masterService.getGenericGridPopUpSettings("DeliveryInTI",this._trnMainService.TrnMainObj.TRNAC)}onShowImport(){this.onShowFileUploadPopupEmit.emit(!0)}onImportPurchaseInvoice(){this.onFileUploadPopupEmit.emit(!0)}onShowImportSO(){this.onFileUploadPopupEmit.emit(!0)}getExpList(){this.gridPopupSettingsForExpList={title:"Expired Order List",apiEndpoints:"/getExpiredOrderVouchersList",defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"VCHRNO",title:"SONO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]}}onShowExpiredSO(i){this.getExpList(),this.genericGridExpList.show()}onListSelected(i){i&&(this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this.masterService.getExpiredOrderVouchersProdList(i.VCHRNO).subscribe(n=>{n&&(this._trnMainService.TrnMainObj.ProdList=n)}))}loadVoucher(i){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DeliveryChalan||10!=i.STATUS||"EDIT"!==this._trnMainService.buttonMode){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI){if(1==i.STATUS&&"EDIT"===this._trnMainService.buttonMode)return void this.alertService.info("Cannot edit this voucher!");(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI||"goods-received-note-import"==this.activeurlpath)&&"EDIT"===this._trnMainService.buttonMode?(this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.enableRefreshRateInSO=!0),this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result&&"PARTIAL-EXISTED"!=n.result?this._trnMainService.TrnMainObj.VoucherType!==S.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.PurchaseOrder&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.RequisitionEntry||10!=i.STATUS?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i.VCHRNO}).subscribe(s=>{"FORCECLOSED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("This Voucher is force closed, cannot edit")}):this.alertService.info("Transaction already exist under selected voucher no")})):(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.enableRefreshRateInSO=!1)}else this._trnMainService.TrnMainObj.VoucherType!==S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DeliveryChalan||"EDIT"!==this._trnMainService.buttonMode?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).subscribe(n=>{"ok"==n.status?(0,ee.s)(()=>this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote,(0,$.P)(()=>this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO})),(0,G.of)("dummy")).subscribe(s=>{"EXISTED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("Transfer out has been done with reference to this voucher. Cannot edit.")}):this.alertService.info(n.result.error)},n=>{this.alertService.info(n)});"VIEW"==this._trnMainService.buttonMode&&(this.TermsButtonTag="VIEW T&C")}else this.alertService.info(this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan?`Voucher No. ${i.VCHRNO} is Already Reversed/Billed. Cannot Edit!`:"Cannot edit this voucher!")}onNewClick(){confirm("Are you sure to Reset the transaction? ")&&(this._trnMainService.prodCheckSubject.next(!0),this._trnMainService.buttonMode="",this.masterService.disableQtyInStockIssueReturn=!1,this._trnMainService.saveButton=!1,this._trnMainService.disableConsumption=!1,this._trnMainService.itemselectevent=!1,this._trnMainService.currentIndexProductDetails=[],this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.barCodes={},this._trnMainService.barCodes.Quantity=1,this._trnMainService.disableNepaliDate=!0,this._trnMainService.enableRefreshRateInSO=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.viewModeForStockSettle=!1,this._trnMainService.disableCalculateButton=!0,this._trnMainService.disableOnCreditSelect=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.disableAccountInputField=!1,this._trnMainService.requisitionFromNotification=!1,this._trnMainService.disableCustomerInputField=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.isRatePartial=!1,this._trnMainService.showPriceChangeDetail=!1,this._trnMainService.showPriceChangeDetailINDisc=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.disableNepaliDate=(24===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&("add-sales-invoice"!=this.activeurlpath&&"add-sales-invoice-wholesale"!=this.activeurlpath&&"abbreviated-sales-invoice"!=this.activeurlpath&&"add-creditnote-itembase"!=this.activeurlpath||1!=this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry),"canceladdsientry"==this.activeurlpath&&(this.viewClicked=!1),this._trnMainService.urlpath=this.arouter.snapshot.url[0].path,this._trnMainService.TrnMainObj.VoucherType===S.Km.ReversePurchase&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.Purchase),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseCreditNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.CreditNote),this._trnMainService.TrnMainObj.VoucherType===S.Km.CancelProforma&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.PerformaSalesInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryChalan&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryChalan),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseTaxInvoice&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseProductionEntry&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.ProductionEntry),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryReturn&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryReturn),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDebitNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DebitNote),this._trnMainService.onFlatDiscountClear(),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableOnGRNload=!1,this._trnMainService.disableCostCenterForCargo=!1,this._trnMainService.disablePaymentTerms=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),this.userSetting.enableCostCenter>0&&1==this.userSetting.EnableCostCenterWiseAccounting&&("add-creditnote-itembase"==this.activeurlpath||"add-sales-invoice"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.COSTCENTER=this._trnMainService.accountWiseCostCenter),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation=""),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_QUOTATTION_INSO)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),"self-billing"==this.activeurlpath&&this.onclickOnResetPopupEmit.emit(),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),this._trnMainService.hideProductDescriptionPopUp=!1,this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),14==this._trnMainService.TrnMainObj.VoucherType&&"export-sales-invoice"!=this.activeurlpath&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.TRNMODE=1==this.userSetting.GblEnableMixedTenderMode?"cash":"credit","B2C"==this.userSetting.CompanyType.toUpperCase()&&1==this.userSetting.GblEnableMixedTenderMode&&"cash"==this._trnMainService.TrnMainObj.TRNMODE.toLowerCase()&&this.setCashProperty(),this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput")),(this.TrnMainObj.VoucherType===S.Km.TaxInvoice||this.TrnMainObj.VoucherType===S.Km.Sales||this.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1),(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesReturn)&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),90===this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.IsBBSM&&(this._trnMainService.TrnMainObj.filterByInReqApproval="requisition",this._trnMainService.TrnMainObj.MWAREHOUSE=""),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1==this.userSetting.REFBILLCOMPULSORINDNOTE?1:0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this.masterService.ShowMore=!0,(0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("invoiceNO")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this.masterService.ShowMore=!0,0!=this.userSetting.ENABLE_QUOTATTION_INSO&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("stockissueFromWH")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,0!=this.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&(this.masterService.ShowMore=!0,setTimeout(()=>{1==this.userSetting.GblEnableMixedTenderMode?document.getElementById("itemDesc0").focus():document.getElementById("paymentTerms").focus()},200)),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath,"self-billing"==this.activeurlpath&&(this._trnMainService.TrnMainObj.TRNMODE="credit"),this.clearQtyRate(),this.TermConditionPopup.clearTermsAndCondition(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME&&"cash"==this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()&&(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME),this._trnMainService.TrnMainObj.VoucherType==S.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.TRNDATE=(0,L.p6)(this.userProfile?.PhiscalYearInfo.BeginDate,"yyyy-MM-dd","en-US"),this._trnMainService.TrnMainObj.BSDATE=this._trnMainService.getBsDate(this._trnMainService.TrnMainObj.TRNDATE)),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&1==this.userSetting.enabledistributedpurchase&&(this._trnMainService.TrnMainObj.COSTCENTER=this.userProfile.costCenter))}onReset(){this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.enableRefreshRateInSO=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.showModesForCC=!0,this._trnMainService.showCertainModes=!0,this._trnMainService.disableAccountInputField=!1,this._trnMainService.fromRequistionToTransferOut=!1,this._trnMainService.showPriceChangeDetail=!1,this._trnMainService.showPriceChangeDetailINDisc=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this.masterService.ShowMore=!0,this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput"),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"IMPOR_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_GRN_IN_PI)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),"goods-received-note"===this.activeurlpath&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),("goods-received-note-import"===this.activeurlpath||"purchase-import"===this.activeurlpath)&&0!=this.userSetting.IMPORTPOBILLMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),90===this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.IsBBSM&&(this._trnMainService.TrnMainObj.filterByInReqApproval="requisition"),(this.TrnMainObj.VoucherType===S.Km.TaxInvoice||this.TrnMainObj.VoucherType===S.Km.Sales||this.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.TRNDATE=(0,L.p6)(this.userProfile?.PhiscalYearInfo.BeginDate,"yyyy-MM-dd","en-US"),this._trnMainService.TrnMainObj.BSDATE=this._trnMainService.getBsDate(this._trnMainService.TrnMainObj.TRNDATE))}onRefershRateClicked(){let i;i=this._trnMainService.TrnMainObj.ProdList.filter(n=>null!=n.MCODE).map(n=>n.MCODE),this.loadingService.show("Refreshing.Please Wait..."),this.masterService.getMultipleItemPriceInSO(i).subscribe(n=>{if("ok"==n.status){for(let s=0;s<n.result.length;s++)console.log("index here",s),this._trnMainService.TrnMainObj.ProdList[s].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[s].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A):(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A*this._trnMainService.TrnMainObj.ProdList[s].ALTCONFACTOR);this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}})}okClicked(i){this._trnMainService.TrnMainObj.TenderList=i;let n=this._trnMainService.TrnMainObj.TenderList[0];null!=n?(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this.transactionValidator()&&(this.onSubmit(),this.genericTender.hide())):this.alertService.info("Tender Amount not detected")}approvePerformInvoice(){this.masterService.approvePerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully approved")},n=>{this.alertService.info(n)})}rejectPerformInvoice(){this.masterService.rejectPerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully rejected")},n=>{this.alertService.info(n)})}okAddNewClicked(i){let n=i;n.PRICELEVEL=i.GEO,n.TYPE="A",n.PARENT="PA",n.PType="C",n.COMPANYID=this._trnMainService.userProfile.CompanyInfo.COMPANYID}onRecallClick(){this.genericGridHoldBill.show()}onHoldClick(){null!=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.BATCH)[0]?this.masterService.masterPostmethod("/saveholdbill",this.HoldBillPreparationForSave()).subscribe(i=>{"ok"==i.status&&this._trnMainService.initialFormLoad(S.Km.TaxInvoice)},i=>{alert(i)}):this.alertService.info("No Valid Products entries Detect...")}HoldBillPreparationForSave(){let i={},n=[];for(let s of this._trnMainService.TrnMainObj.ProdList)null!=s.MCODE&&null!=s.BATCH&&n.push({MCODE:s.MCODE,UNIT:s.ALTUNIT,Quantity:s.Quantity,BATCH:s.BATCH,BC:s.BC,REMARKS:s.REMARKS,INVDISRATE:s.INDDISCOUNTRATE,INVDISAMOUNT:s.INDDISCOUNT,CONFACTOR:s.CONFACTOR});return i={PARAC:this._trnMainService.TrnMainObj.PARAC,REMARKS:this._trnMainService.TrnMainObj.REMARKS,DATE:this._trnMainService.TrnMainObj.TRNDATE,NETAMNT:this._trnMainService.TrnMainObj.NETAMNT,FLATDISRATE:this._trnMainService.TrnMainObj.DCRATE,FLATDISAMOUNT:this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT,INVOICETYPE:"retailinvoice",PAYMENTSTATUS:"Hold",holdBillProdList:n,SNO:this._trnMainService.TrnMainObj.HOLDBILLID},i}onHoldBillDoubleClick(i){this.loadingService.show("Recalling Bill.Please Wait..."),this.masterService.masterPostmethod("/recallholdbill",i).subscribe(n=>{"ok"==n.status?(this._trnMainService.initialFormLoad(S.Km.TaxInvoice),this.convertingRecallBillToMainBill(JSON.parse(n.result)),this._trnMainService.TrnMainObj.HOLDBILLID=i.SNO,this.loadingService.hide()):(this.loadingService.hide(),this.alertService.info(n.result._body))},n=>{alert(n)})}convertingRecallBillToMainBill(i){this._trnMainService.TrnMainObj.TRNAC=this._trnMainService.TrnMainObj.PARAC=i.PARAC,null!=i.customer&&(this._trnMainService.TrnMainObj.BILLTO=i.customer.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.customer.ADDRESS,this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=i.customer.PSTYPE,this._trnMainService.TrnMainObj.TRNMODE=i.customer.PMODE,this._trnMainService.TrnMainObj.PARTY_ORG_TYPE=i.customer.ORG_TYPE),this._trnMainService.TrnMainObj.REMARKS=i.REMARKS,this._trnMainService.TrnMainObj.INVOICETYPE=i.INVOICETYPE,this._trnMainService.TrnMainObj.DiscRate=this._trnMainService.nullToZeroConverter(i.FLATDISRATE),this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this._trnMainService.nullToZeroConverter(i.FLATDISAMOUNT),this._trnMainService.TrnMainObj.ProdList=[];let n=0;for(let p of i.holdBillProdList)if(null!=p.MCODE&&null!=p.BATCH){var s={};s.MCODE=p.MCODE,s.SELECTEDITEM=p.SELECTEDITEM,s.BC=p.BC,s.ISVAT=p.SELECTEDITEM.ISVAT,s.MENUCODE=p.SELECTEDITEM.MENUCODE,s.ITEMDESC=p.SELECTEDITEM.DESCA,s.MCODE=p.SELECTEDITEM.MCODE,s.GSTRATE_ONLYFORSHOWING=p.SELECTEDITEM.GST,s.GSTRATE=p.SELECTEDITEM.GST,s.WEIGHT=p.SELECTEDITEM.GWEIGHT,s.Mcat=p.SELECTEDITEM.MCAT,s.MRP=p.SELECTEDBATCH.MRP,s.BATCH=p.BATCH,s.MFGDATE=null==p.SELECTEDBATCH.MFGDATE?"":p.SELECTEDBATCH.MFGDATE.toString().substring(0,10),s.EXPDATE=null==p.SELECTEDBATCH.EXPIRY?"":p.SELECTEDBATCH.EXPIRY.toString().substring(0,10),s.UNIT=p.SELECTEDBATCH.UNIT,s.STOCK=p.SELECTEDBATCH.STOCK,s.WAREHOUSE=p.SELECTEDBATCH.WAREHOUSE,s.BATCHSCHEME=p.SELECTEDBATCH.SCHEMENAME,s.Quantity=this._trnMainService.nullToZeroConverter(p.Quantity),s.INDDISCOUNTRATE=this._trnMainService.nullToZeroConverter(p.INVDISRATE),s.INDDISCOUNT=this._trnMainService.nullToZeroConverter(p.INVDISAMOUNT),s.inputMode=!1,s.Product={},s.Product.MCODE=p.MCODE,s.Product.AlternateUnits=p.ALTUNITLIST,s.ALTUNITObj=s.Product.AlternateUnits.filter(A=>A.ALTUNIT==p.UNIT)[0],this._trnMainService.TrnMainObj.ProdList.push(s),this._trnMainService.AssignSellingPriceAndDiscounts(p.PClist,n),this._trnMainService.RealQuantitySet(n,p.CONFACTOR),n++}this._trnMainService.ReCalculateBillWithNormal()}onTransportClick(){this.Transport.show()}handleKeyDownboardEvent(i){if(0==this.PaymentPopup.isActive)if("ControlLeft"==i.code||"ControlRight"==i.code)i.preventDefault(),this.showSecondaryButtons=!this.showSecondaryButtons;else if("F3"==i.code)i.preventDefault(),this.onNewClick();else if("F12"==i.code)i.preventDefault(),this.showItemSearchPopup();else if("End"==i.code)i.preventDefault(),"VIEW"!=this._trnMainService.TrnMainObj.Mode&&!this.masterService.customerpopup&&!this._trnMainService.showPerformaApproveReject&&!this._trnMainService.showDiscountAuth&&this.onSaveClicked();else if("F4"==i.code)i.preventDefault(),!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&this.onViewClicked();else if("F7"==i.code){i.preventDefault();let n=this._trnMainService.TrnMainObj.VoucherType;!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&!(n in S.$V)&&7!=n&&5!=n&&10!==this._trnMainService.TrnMainObj.VoucherType&&(this.onViewClicked(),this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)")}else"F8"==i.code?(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||57==this._trnMainService.TrnMainObj.VoucherType||83==this._trnMainService.TrnMainObj.VoucherType||21==this._trnMainService.TrnMainObj.VoucherType||3==this._trnMainService.TrnMainObj.VoucherType||16==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType||61==this._trnMainService.TrnMainObj.VoucherType||5==this._trnMainService.TrnMainObj.VoucherType)&&this.onPrintClicked()):"F2"==i.code?(i.preventDefault(),(3==this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType&&"NEW"==this._trnMainService.TrnMainObj.Mode||19==this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||89===this._trnMainService.TrnMainObj.VoucherType||88===this._trnMainService.TrnMainObj.VoucherType&&0===this.userSetting.LinkProductionwithconsumption||15===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&this.onImportPurchaseInvoice()):"F11"==i.code&&(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==this._trnMainService.TrnMainObj.Mode&&1==this.userSetting.GblEnableMixedTenderMode&&this.showBillTender())}showItemSearchPopup(){this.itemSearchPopup.show()}cancelprint(){this.promptPrintDevice=!1,this.showPosPrinterPreview=!1}onSchemeClick(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(s=>null!=s.MCODE&&""!=s.MCODE);let i=[];if(this._trnMainService.TrnMainObj.ProdList.length>0){for(var n of this._trnMainService.TrnMainObj.ProdList)i.push({mcode:n.MCODE,qty:n.Quantity,retailer:this._trnMainService.TrnMainObj.PARAC,rate:n.RATE});this.masterService.masterPostmethod("/dmsScheme/searchscheme",{data:i}).subscribe(s=>{if("ok"==s.status)if(null==s.result)this.alertService.info("No Scheme Found ...");else{for(let p of s.result)p.ischecked=!0;this._trnMainService.availableSchemes=s.result,(null!=this._trnMainService.availableSchemes||this._trnMainService.availableSchemes?.length>0)&&(this.schemeFilterList=this._trnMainService.availableSchemes.filter((p,A,ie)=>ie.findIndex(se=>se.schemeno===p.schemeno)===A)),this.showschemePopup=!0}else this.alertService.info("Error on getting scheme.Error Details:"+s.result)})}else this.alertService.warning("No Valid product entered for scheme"),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)}OkSchemeCommand(){if(null==this._trnMainService.availableSchemes||this._trnMainService.availableSchemes)return;this.showschemePopup=!1;let i=[];for(var n in this.schemeFilterList.filter(p=>p.ischecked)){this._trnMainService.availableSchemes[n].SchemeAmount=this._trnMainService.availableSchemes[n].discountamount;for(let p in this._trnMainService.TrnMainObj.ProdList)if(this._trnMainService.TrnMainObj.ProdList[p].MCODE==this._trnMainService.availableSchemes[n].mcode){var s=this._trnMainService.availableSchemes.filter(A=>A.schemeno==this._trnMainService.availableSchemes[n].schemeno).length;if(s<1)return;this._trnMainService.TrnMainObj.ProdList[p].BaseSecondaryDiscount=this._trnMainService.availableSchemes[n].discountamount/s,i.push(this._trnMainService.availableSchemes[n])}}this._trnMainService.TrnMainObj.DmsSchemesApplied=i,this._trnMainService.ReCalculateBillWithNormal()}CancelSchemeCommand(){this.showschemePopup=!1}markAsReadNotifications(){this.notificationService.markAsReadAfterSave().subscribe(i=>{"ok"==i.status&&(this._trnMainService.fromNotification=!1)})}newSalesman(){confirm("Are you sure to choose new salesman?")&&this.onClickSalesMan.emit()}onCustomerSelected(i){this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""==i.PMODE?"credit":i.PMODE,this.masterService.focusAnyControl("unit")}createCustomer(){this.router.navigate(["./pages/masters/PartyLedger/CustomerList"])}onCancelClick(){if(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoiceCancel,this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.VoucherAbbName="SC",this._trnMainService.TrnMainObj.guid=_(),this.viewClicked)this.alertService.info("cannot save in View Mode.");else{if(this._trnMainService.TrnMainObj.ProdList.filter(n=>{}).length>0)return void this.alertService.info("Product list is empty");this.onSaveClicked()}}onLoadClick(){this._trnMainService.TrnMainObj.Mode="NEW",this.genericGridForTaxCancel.show(),this.viewClicked=!1}onViewTaxCancel(){this.TrnMainObj.VoucherPrefix="SC",this.gridPopupSettings=this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix)}onClickReverseSave(){this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE="REVERSE",this.onSaveTransactionClicked()}saveSalesReturnDamageValueToTMP(){this.spinnerService.show("Data is Saving..."),this.masterService.saveDamageSalesReturnToTMP(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))})}saveTransactionApproval(){this.spinnerService.show("Data is Saving..."),this.masterService.saveApprovalTmptoActual(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}saveApproveStockTransfer(){this.spinnerService.show("Data is Saving..."),this.masterService.SaveApprovedStockTransfer(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this._trnMainService.pageHeading="Stock Transfer Approval",this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}onDeleteClick(){confirm("Permanently delete this Voucher. Do you want to continue?")&&(this.editClicked=!1,this.viewClicked=!1,this.onclickDeleteYes())}onclickDeleteYes(){this._trnMainService.TrnMainObj.Mode="New",this._trnMainService.TrnMainObj.VoucherType=73,this._trnMainService.TrnMainObj.VoucherPrefix="CP",this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.VCHRNO;const i=b(67816);this._trnMainService.TrnMainObj.guid=i(),this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(s=>{"ok"==s.status&&(this.alertService.success("Deleted Succesfully"),this._trnMainService.initialFormLoad(this.TrnMainObj.VoucherType),this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP")},s=>{})}onDeleteTransactionClick(){this.checkUserRights("delete")&&1==this.userSetting.EnableAmdinSB&&this.deleteTransaction()}deleteTransaction(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(i=>{if("EXISTED"!=i.result){this.spinnerService.show("Please Wait..");let n={};n.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,n.DIVISION=this._trnMainService.TrnMainObj.DIVISION,n.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:n,mode:this._trnMainService.buttonMode}).subscribe(p=>{"ok"==p.status?(this.spinnerService.hide(),this.alertService.info(p.result),this.onReset()):(this.alertService.info(p.result),this.spinnerService.hide())},p=>{this.spinnerService.hide()})}else this.alertService.info("Transaction exist under selected voucher no")});else{this.spinnerService.show("Please Wait..");let i={};i.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,i.DIVISION=this._trnMainService.TrnMainObj.DIVISION,i.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:i,mode:this._trnMainService.buttonMode}).subscribe(s=>{"ok"==s.status?(this.spinnerService.hide(),this.alertService.info(s.result),this.onReset()):(this.alertService.info(s.result),this.spinnerService.hide())},s=>{this.spinnerService.hide()})}}onProformaEditClick(){this.masterService.headerMode="(EDIT)",this._trnMainService.TrnMainObj.Mode="EDIT",this.editClicked=!0,this.viewClicked=!1,this.genericGrid.show()}assigngMode(){this.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice&&("(VIEW)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="VIEW"),"(EDIT)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="EDIT"))}pdfDesingerPrintFormat(i,n,s,p,A){(null==A||null==A)&&(A="FULL");let ie=i.substring(0,2);"purchase-import"==this.activeurlpath&&(ie="IMPORTPURCHASE"),"export-sales-invoice"==this.activeurlpath&&(ie="EXPORTSI"),"asset-purchase-invoice"==this.activeurlpath&&(ie="ASSETPURCHASE"),"assets-openingstockentry"==this.activeurlpath&&(ie="ASSETOPENING");let se=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,de=se?.split("");this.masterService.getPrintFileName(ie,this.userProfile.CompanyInfo.COMPANYID,A).subscribe(pe=>{if("ok"==pe.status){this.filename=pe.result?pe.result[0].FileName:"",this.rownumber=pe.result?pe.result[0].RowsNumber:0;let ue=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL;this.masterService.getNumberToWords(i,ue,n,this.userProfile.CompanyInfo.COMPANYID).subscribe(ke=>{if("ok"==ke.status){this.numtowords=ke.result?ke.result[0].NUMTOWORDS:"";let we=this.userProfile.CompanyInfo.ADDRESS,De=this.userProfile.CompanyInfo.NAME,je=this.userProfile.CompanyInfo.TELA,_e=this.userProfile.CompanyInfo.TELB,Te=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(ue).subscribe(fe=>{if("ok"==fe.status){fe.result&&fe.result.length>0&&fe.result[0]&&fe.result[0].COMADD&&(we=fe.result[0].COMADD),(null==we||""===we)&&(we=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),fe.result&&fe.result.length>0&&fe.result[0]&&fe.result[0].COMNAME&&(De=fe.result[0].COMNAME),(null==De||""===De)&&(De=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),fe.result&&fe.result.length>0&&fe.result[0]&&fe.result[0].TELA&&(je=fe.result[0].TELA),(null==je||""===je)&&(je=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),fe.result&&fe.result.length>0&&fe.result[0]&&fe.result[0].TELB&&(_e=fe.result[0].TELB),(null==_e||""===_e)&&(_e=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),fe.result&&fe.result.length>0&&fe.result[0]&&fe.result[0].EMAIL&&(Te=fe.result[0].EMAIL),(null==Te||""===Te)&&(Te=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let lt,ge={};ge.filename=this.filename,ge.rownumber=this.rownumber,ge.VCHRNO=i,ge.NAME=De||this.userProfile.CompanyInfo.NAME,ge.ADDRESS=we||" ",ge.INITIAL=ue||this.userProfile.CompanyInfo.INITIAL,ge.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,ge.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,ge.phone1=je||" ",ge.phone2=_e||" ",ge.EMAIL=Te||" ",ge.numtowords=this.numtowords?this.numtowords:" ",ge.panno1=de[0]?de[0]:" ",ge.panno2=de[1]?de[1]:" ",ge.panno3=de[2]?de[2]:" ",ge.panno4=de[3]?de[3]:" ",ge.panno5=de[4]?de[4]:" ",ge.panno6=de[5]?de[5]:" ",ge.panno7=de[6]?de[6]:" ",ge.panno8=de[7]?de[7]:" ",ge.panno9=de[8]?de[8]:" ",ge.title=s||" ",ge.caption=p||" ",ge.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,ge.PRINTBY=this.userProfile.username?this.userProfile.username:" ",ge.COMPANYVAT=se||this.userProfile.CompanyInfo.VAT,this.masterService.getAllInvoiceData(ge).subscribe(Ve=>{lt=new Blob([Ve],{type:"application/pdf"});const vr=URL.createObjectURL(lt),$i=document.createElement("iframe");$i.style.display="none",$i.src=vr,document.body.appendChild($i),$i.contentWindow.print()},Ve=>{console.log("error",Ve,JSON.parse(this.blobToString(Ve.error)));let vr=JSON.parse(this.blobToString(Ve.error));this.alertService.error(vr.result)}),2==this.userSetting.SendInvoiceEmail&&(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales)&&"NEW"==this.modeForPrint&&(ge.title="Invoice",ge.caption="Copy of Original (1)",this.masterService.TaxinvoiceEmail(ge,this._trnMainService.CUSEMAIL).subscribe(Ve=>{console.log("result after print",Ve)}))}})}})}})}blobToString(i){const n=URL.createObjectURL(i);let s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(),URL.revokeObjectURL(n),s.responseText}cancel(){try{this.router.navigate([this.returnUrl])}catch(i){console.log(i),this.alertService.info(i)}}onImportDetailsClick(){this.ImportPurchaseDetail.show(),this.masterService.allowAddNextRow=!0}onExportClick(){this.spinnerService.show("Downloading file, Please wait..."),this.masterService.getExcelFileForBA().subscribe(s=>{this.spinnerService.hide();let p=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});B.saveAs(p,"Negative Stock Report.xlsx")},s=>{this.spinnerService.hide()})}clearQtyRate(){this._trnMainService.purchaseOrderQty=null,this._trnMainService.purchaseOrderRate=null,this._trnMainService.produstWiseOrderUnit=null}pdfDesingerPrintFormatForTransferIn(i,n,s,p,A){(null==A||null==A)&&(A="FULL");let se=(1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT).split("");this.masterService.getPrintFileName(this._trnMainService.TrnMainObj.VoucherPrefix,this.userProfile.CompanyInfo.COMPANYID,A).subscribe(de=>{if("ok"==de.status){this.filename=de.result?de.result[0].FileName:"",this.rownumber=de.result?de.result[0].RowsNumber:0,this.numtowords="";let pe=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,ue=this.userProfile.CompanyInfo.ADDRESS,ke=this.userProfile.CompanyInfo.NAME,we=this.userProfile.CompanyInfo.TELA,De=this.userProfile.CompanyInfo.TELB,je=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(pe).subscribe(_e=>{if("ok"==_e.status){_e.result&&_e.result.length>0&&_e.result[0]&&_e.result[0].COMADD&&(ue=_e.result[0].COMADD),(null==ue||""===ue)&&(ue=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),_e.result&&_e.result.length>0&&_e.result[0]&&_e.result[0].COMNAME&&(ke=_e.result[0].COMNAME),(null==ke||""===ke)&&(ke=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),_e.result&&_e.result.length>0&&_e.result[0]&&_e.result[0].TELA&&(we=_e.result[0].TELA),(null==we||""===we)&&(we=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),_e.result&&_e.result.length>0&&_e.result[0]&&_e.result[0].TELB&&(De=_e.result[0].TELB),(null==De||""===De)&&(De=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),_e.result&&_e.result.length>0&&_e.result[0]&&_e.result[0].EMAIL&&(je=_e.result[0].EMAIL),(null==je||""===je)&&(je=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let fe,Te={};Te.filename=this.filename,Te.rownumber=this.rownumber,Te.VCHRNO=i,Te.NAME=ke||this.userProfile.CompanyInfo.NAME,Te.ADDRESS=ue||" ",Te.INITIAL=pe||this.userProfile.CompanyInfo.INITIAL,Te.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,Te.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,Te.phone1=we||" ",Te.phone2=De||" ",Te.EMAIL=je||" ",Te.numtowords=this.numtowords?this.numtowords:" ",Te.panno1=se[0]?se[0]:" ",Te.panno2=se[1]?se[1]:" ",Te.panno3=se[2]?se[2]:" ",Te.panno4=se[3]?se[3]:" ",Te.panno5=se[4]?se[4]:" ",Te.panno6=se[5]?se[5]:" ",Te.panno7=se[6]?se[6]:" ",Te.panno8=se[7]?se[7]:" ",Te.panno9=se[8]?se[8]:" ",Te.title=s||" ",Te.caption=p||" ",Te.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,Te.PRINTBY=this.userProfile.username?this.userProfile.username:" ",this.masterService.getAllInvoiceData(Te).subscribe(ge=>{fe=new Blob([ge],{type:"application/pdf"});const lt=URL.createObjectURL(fe),Ve=document.createElement("iframe");Ve.style.display="none",Ve.src=lt,document.body.appendChild(Ve),Ve.contentWindow.print()},ge=>{let lt=JSON.parse(this.blobToString(ge.error));this.alertService.error(lt.result)})}})}})}onReverseEntry(){let i=this.masterService.userProfile.userRights.find(n=>"AllowReverseEntry"==n.right);0!=i?.value?1==i?.value&&(this._trnMainService.reverseEntry(this.TrnMainObj.VoucherType),(0,ee.s)(()=>"asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath,this.masterService.checkAssetDepreciation(this._trnMainService.TrnMainObj.VCHRNO),(0,G.of)("notAssets")).pipe((0,re.K)(()=>{throw"checkAssetDepreciation"}),(0,Me.w)(n=>this.masterService.checkDuplicateReverseEntry(this._trnMainService.TrnMainObj.VCHRNO).pipe((0,re.K)(s=>(0,G.of)(s))))).subscribe(n=>{"ok"==n.status?this.showReverseEntryAuth=!0:this.alertService.info(n.result.error)},n=>{this.alertService.info("checkAssetDepreciation"===n?"Depreciation cancellation is required for reverse entry command.":n)})):this.alertService.info("No rights for Reverse Entry!!!")}openReverseEntry(){this.reverseEntryConfirm.show(this._trnMainService.TrnMainObj.VCHRNO)}closeReverseEntryAuthPopup(){this.showReverseEntryAuth=!1}reverseEntryAuthConfirm(){this.spinnerService.show("Authorizing Please wait..."),this.masterService.reverseEntryAutorisation(this.reverseEntryAuthObj).subscribe(i=>{this.spinnerService.hide(),"ok"==i.status&&(this.alertService.success("Authorization Sucessfull"),this.closeReverseEntryAuthPopup(),this.openReverseEntry())}),this.spinnerService.hide()}forRequisition(){this.addForRequisition=!0,this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this._trnMainService.TrnMainObj.DOFULLRETURN=1}forStockAdjustment(){this.StockAdjustment.show()}carreiedOnPreviousFiscalYearOpening(i){this.spinnerService.show("Opening stock is saving please wait.."),this.masterService.saveFiscalYear(i,0).subscribe(n=>{"ok"==n.status?(console.log("RESULT",n),this.alertService.success("Year Data Saved Successfully"),this.authService.showfiscalPopup=!1,this.spinnerService.hide()):(this.spinnerService.hide(),console.log("data",n),this.alertService.info("Error in Saving Data:"+n.result.error))},n=>{this.alertService.info(n)})}closeReqModal(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}fromTransferOut(){let i="";i=this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder?this._trnMainService.TrnMainObj.AdditionalObj.REFORDID:this._trnMainService.TrnMainObj.BILLTO;let n=`/getTransferOutPagedList/${i}/${this._trnMainService.TrnMainObj.VoucherPrefix}`;this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(n=`/getRequisitionListForStockIssue/${i}`),this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&(n=`/getTransferOutForRequisionPagedList/${i}`),this.genericGridTransferOutSetting={title:"Requisition List",apiEndpoints:n,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Requisition From",hidden:5==this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1},{key:"BILLTO",title:"From Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"BILLTOADD",title:"To Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1}]},this.genericGridTransferOut.show(),this._trnMainService.fromRequistionToTransferOut=!1}dblClickLoadTransferOutData(i){this._trnMainService.fromRequistionToTransferOut=!0,(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,1===this._trnMainService.TrnMainObj.DOFULLRETURN?(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&this.loadFullRequesitoninTo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder&&this.loadFullRequesitoninPo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadFullRequisitioninIS(i),this.closeReqModal()):(this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadPartialRequisitioninIS(i),this.closeReqModal())),this.loadPartialRequisitionVoucher(i)}loadPartialRequisitionVoucher(i){0===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&(this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.addRow(),this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.BILLTOADD=i.BILLTO)}loadFullRequesitoninTo(i){this._trnMainService.loadFullRequesitoninTo(i,!1)}loadFullRequesitoninPo(i){let n=this._trnMainService.TrnMainObj.MWAREHOUSE;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForPurchaseOrder(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMTO").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=b(67816);this._trnMainService.TrnMainObj=s.result,this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=19,this._trnMainService.TrnMainObj.VoucherPrefix="PO",this._trnMainService.TrnMainObj.VoucherAbbName="PO",this._trnMainService.TrnMainObj.COMPANYID=this.masterService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.DIVISION=this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.masterService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const A of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(A.ALTCONFACTOR)&&(A.ALTCONFACTOR=1),A.BASEUNIT===A.ALTUNIT&&(A.RATE=A.ALTRATE);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD="",this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=n}},s=>{this.loadingService.hide(),this.alertService.info(s._body)})}loadFullRequisitioninIS(i){let n=i.BILLTOADD;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMIS").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=b(67816);this._trnMainService.TrnMainObj=s.result;let A=this._trnMainService.TrnMainObj.BILLTOADD,ie=this._trnMainService.TrnMainObj.BILLTO;this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.PhiscalYearInfo.PhiscalID,this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.userProfile.userWarehouse,this._trnMainService.callPipe=!this._trnMainService.callPipe,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const se of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(se.ALTCONFACTOR)&&(se.ALTCONFACTOR=1),se.BASEUNIT===se.ALTUNIT&&(se.RATE=se.ALTRATE),se.MFGDATE=null==se.MFGDATE?"":se.MFGDATE.toString().substring(0,10),se.EXPDATE=null==se.EXPDATE?"":se.EXPDATE.toString().substring(0,10);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD=ie,this._trnMainService.TrnMainObj.BILLTO=A,this._trnMainService.TrnMainObj.MWAREHOUSE=n;for(const se of this._trnMainService.TrnMainObj.ProdList)se.rowMode="VIEW"}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}loadPartialRequisitioninIS(i){let n=i.BILLTOADD;this.loadingService.show("Loading requisition details. Please wait!"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMIS").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=b(67816);let A=s.result.BILLTOADD,ie=s.result.BILLTO;this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.BILLTOADD=ie,this._trnMainService.TrnMainObj.BILLTO=A,this._trnMainService.TrnMainObj.MWAREHOUSE=n,this._trnMainService.callPipe=!this._trnMainService.callPipe}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}saveRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this.addForRequisition=!1}resetRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}getPopUpSettingForApproval(){return{title:"Vouchers",apiEndpoints:`/getApprovedPagedListForView/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onChangePurchasePrice(i,n){const s=this._trnMainService.TrnMainObj.ProdList[this.activeindex],p=this._trnMainService.priceChangeList[i],A=0===this.userSetting.VatExcludingRate?p.NRATE_A:p.EX_NRATE_A,ie=0===this.userSetting.VatExcludingRate?p.WNRATE_A:p.EX_NRATE_A;if(!p)return;const se=s.NETRATE?s.NETRATE:s.RATE,pe=this.calculateRecommendedMarginRate(s,se);console.log("margin2",A,p,pe,se),A<=pe&&(console.log("margin1",p,pe),this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),this.userSetting.ENABLEWSALESRATEBILLING&&void 0!==ie&&""!==ie&&ie<=pe&&(console.log("margin1",p,pe),this.rateValidationDisplayMessage="NEW WHOLESALE SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),this.focusOnNextInput(),this.updateSellingPrices(i),this.actualMarginCalculation(i),this.updateProdListWithUserInput(i,s,p),this.masterService.is_PurchaseOrder&&this.updatePODetailList(i)}calculateRecommendedMarginRate(i,n){let s=n*(i.RECRATE/100);return 0==this.userSetting.VatExcludingRate?s=(s+n)*this.userSetting.VatConRate:s+=n,i.RECRATE?s:n}applyVAT(i,n){return 0===this.userSetting.VatExcludingRate&&1===n.ISVAT?i*(1+this.userSetting.VATRate):i}focusOnNextInput(){setTimeout(()=>{(document.getElementById("newWholeSellingPrice0")||document.getElementById("apply"))?.focus()},0)}updateSellingPrices(i){this.changeSellingPrice(i),this.actualMarginCalculation(i)}updateProdListWithUserInput(i,n,s){const p=this.getUserInputRate(s),A=this.getUserInputRate(s,!0),ie=this.userSetting.VatConRate||1;n.SELLRATEBEFORETAX=1==n.ISVAT&&0==this.userSetting.VatExcludingRate?p/ie:p,n.W_SELLRATEBEFORETAX=1==n.ISVAT&&0==this.userSetting.VatExcludingRate?A/ie:A,n.MRP=0===this.userSetting.VatExcludingRate?p:p*ie,n.W_MRP=0===this.userSetting.VatExcludingRate?A:A*ie}getUserInputRate(i,n=!1){return this.userSetting.VatExcludingRate?n?i.EX_WNRATE_A:i.EX_NRATE_A:n?i.WNRATE_A:i.NRATE_A}updatePODetailList(i){this._trnMainService.TrnMainObj.PODetailList[i].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[i].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].WNRATE_A}changeSellingPrice(i){const n=1===this.userSetting.VatExcludingRate?"EX_NRATE_A":"NRATE_A",s=1===this.userSetting.VatExcludingRate?"EX_WNRATE_A":"WNRATE_A";for(const p of this._trnMainService.priceChangeList)p.SNO>1&&(p[n]=p.CONFACTOR*this._trnMainService.priceChangeList[i][n],p[s]=p.CONFACTOR*this._trnMainService.priceChangeList[i][s])}onApplyOldPriceClick(){!this.validateUpdatedSellingRate(!0)||(this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginRetial=0,this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginWholeSale=0,this.showPriceChangeDetail=!1)}actualMarginCalculation(i){const n=this._trnMainService.TrnMainObj.ProdList[this.activeindex],A=(0,this._trnMainService.nullToZeroConverter)(n.NETRATE)||n.RATE,ie=this._trnMainService.priceChangeList[0],se=this.getUserRate(ie,"NRATE_A"),de=this.getUserRate(ie,"WNRATE_A"),pe=this.userSetting.VatConRate||1;n.ActualmarginRetial=this.calculateMargin(se,A,pe,n.ISVAT),this.userSetting.ENABLEWSALESRATEBILLING&&(n.ActualmarginWholeSale=this.calculateMargin(de,A,pe,n.ISVAT)),n.ActualmarginRetial=this.isInvalidMargin(n.ActualmarginRetial,se)?0:n.ActualmarginRetial,n.ActualmarginWholeSale=this.isInvalidMargin(n.ActualmarginWholeSale,de)?0:n.ActualmarginWholeSale}getUserRate(i,n){return this._trnMainService.nullToZeroConverter(i[this.userSetting.VatExcludingRate?`EX_${n}`:n])}calculateMargin(i,n,s,p){return 100*((this.userSetting.VatExcludingRate||0===p?i:i/s)-n)/n}isInvalidMargin(i,n){return-100===i||0===n}validateUpdatedSellingRate(i){for(let n of this._trnMainService.priceChangeList)if(!this.masterService.is_PurchaseOrder){const s=this._trnMainService.TrnMainObj.ProdList[this.activeindex],p=this.getProductRate(s.NETRATE,s.RATE),A=this.calculatePurchaseRate(p,s.ISVAT);return i?this.validateOldPrice(A):this.validateNewPrice(A)}}getProductRate(i,n){const s=this._trnMainService.nullToZeroConverter(i);return 0===s?n:s}calculatePurchaseRate(i,n){return 0===this.userSetting.VatExcludingRate&&1===n?i+i*this.userSetting.VATRate:i}validateOldPrice(i){const n=this._trnMainService.priceChangeList[0];if(1===this.userSetting.EnableBatchWisePrice){const s=this._trnMainService.priceChangeList.find(p=>0===this._trnMainService.nullToZeroConverter(p.CRATE_A));if(s)return this.alertService.warning(`Selling price for this item with UOM: ${s.UNIT} cannot be 0, Please enter valid selling rate`),!1}return!this.checkPriceAboveCost(i,n)&&(this.updatePriceConversionRates(n),this.markSellingPriceChangedIfNeeded(),!0)}checkPriceAboveCost(i,n){return i>n.CRATE_A?(this.alertService.warning("Cost price for this item cannot be more than Sales price"),!0):1===this.userSetting.ENABLEWSALESRATEBILLING&&i>n.WSRATE_A&&(this.alertService.warning("New Cost price for this item cannot be more than Old Wholesale Sales price"),!0)}updatePriceConversionRates(i){i.CRATE_A&&(i.NRATE_A=i.CRATE_A,i.EX_NRATE_A=this.convertToExclusiveRate(i.CRATE_A)),i.WSRATE_A&&(i.WNRATE_A=i.WSRATE_A,i.EX_WNRATE_A=this.convertToExclusiveRate(i.WSRATE_A)),this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}convertToExclusiveRate(i){return this._trnMainService.nullToZeroConverter(i/(this.userSetting.VatConRate||1))}validateNewPrice(i){const n=this._trnMainService.priceChangeList[0],s=this.getExclusiveOrRegularRate(n.NRATE_A,n.EX_NRATE_A),p=this.getExclusiveOrRegularRate(n.WNRATE_A,n.EX_WNRATE_A);if(this.checkNewSaleRateBelowCost(s,i,"NEW SELLING PRICE")||this.userSetting.ENABLEWSALESRATEBILLING&&null!=p&&this.checkNewSaleRateBelowCost(p,i,"NEW WHOLESALE PRICE")||!this.validateSellingRates(n))return!1;for(let A of this._trnMainService.priceChangeList)if(!this.masterService.is_PurchaseOrder){const ie=this._trnMainService.TrnMainObj.ProdList[this.activeindex].Product.AltSellingPrices.find(se=>se.UNIT===A.UNIT);ie&&(ie.NRATE_A=A.NRATE_A)}return this.markSellingPriceChangedIfNeeded(),!0}getExclusiveOrRegularRate(i,n){return this._trnMainService.nullToZeroConverter(this.userSetting.VatExcludingRate?n:i)}checkNewSaleRateBelowCost(i,n,s){return i<=n&&(this.alertService.error(`${s} ${i} IS BELOW OR EQUAL TO NEW PURCHASE PRICE ${n}`),!0)}validateSellingRates(i){if(this.userSetting.VatExcludingRate){if(!i.EX_NRATE_A)return this.alertService.warning("Invalid selling rate"),!1;if(this.userSetting.ENABLEWSALESRATEBILLING&&!i.EX_WNRATE_A)return this.alertService.warning("Invalid Wholesale selling rate"),!1;this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}else{const n=this.findInvalidUOM();if(n)return this.alertService.warning(`Invalid new selling price for this item with UOM: ${n.UNIT}, Please enter valid selling rate`),!1}return!0}findInvalidUOM(){return this._trnMainService.priceChangeList.find(1===this.userSetting.EnableBatchWisePrice?i=>0===this._trnMainService.nullToZeroConverter(i.NRATE_A):i=>!i.NRATE_A)}markSellingPriceChangedIfNeeded(){this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}checkExpiry(){let i=this._trnMainService.TrnMainObj.ProdList.filter(p=>new Date(p.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=p.MCODE&&1==p.REQEXPDATE)[0],n=this.TrnMainObj.ProdList.filter(p=>1==p.REQEXPDATE&&0==this.nullToZeroConverter(p.EXPDATE))[0];return null!=n?(this.alertService.info(`EXP date missing on item with compulsory Expiry:${n.ITEMDESC}`),!1):null==i||null==i||!this._trnMainService.TrnMainObj.ProdList.some(p=>6!==p.PTYPE)||(this.alertService.info("Expired Item Detected : "+i.ITEMDESC+"..Please Review the list..."),!1)}onApplyClickNewPrice(){!this.validateUpdatedSellingRate(!1)||(this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginRetial=0,this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginWholeSale=0,this.showPriceChangeDetail=!1)}onCloseClick(){this.showPriceChangeDetail=!1}onClickYes(){this.rateValidation.hide()}onClickNo(){this.rateValidation.hide()}onLoadFromReverseEntry(){this.onLoadFromReverseEntryEmit.emit(!0)}viewRecurringDetails(){this.recurringLogMode="view",this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this._trnMainService.TrnMainObj.RecurringItemList.length>0&&(this.recurringItemsForEdit=this._trnMainService.TrnMainObj.RecurringItemList),this._trnMainService.TrnMainObj.CommissionItemList.length>0&&(this.commissionItemsForEdit=this._trnMainService.TrnMainObj.CommissionItemList),(this.recurringItemsForEdit.length>0||this.commissionItemsForEdit.length>0)&&this.RecurringLog.show("view")}carryForwardPreviousFiscalYearVoucher(){confirm("Previous Fiscal Year Opening Stock is already carried on, Do you want Re-Carried on Opening Stock?")&&(console.log("popup ya lyaune"),this.PrevYearOpening.show())}paymentClick(){this.doAutoRoundingInSales(),this.PaymentPopup.show(),this.PaymentPopup.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT?this._trnMainService.TrnMainObj.NETAMNT:0}onSavePayment(i){if(i?.length){let n=i.filter(s=>"CREDIT"==s.TRNMODE?.toUpperCase())[0];if(n&&(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=n.REMARKS,this._trnMainService.TrnMainObj.PARAC=n.ACCOUNT,this._trnMainService.TrnMainObj.BILLTO=n.REMARKS,this.masterService.getCustomerIDFromCProfile(i[0].ACCOUNT).subscribe(s=>{s.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=s[0].CUSTID)})),i?.length>1){this._trnMainService.TrnMainObj.TRNMODE="mixed";let s=i.filter(A=>"Cash"==A.TRNMODE)[0],p=i.filter(A=>"Credit Card"==A.TRNMODE)[0];s?(this._trnMainService.TrnMainObj.TRNAC=s.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=s.REMARKS):p&&(this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS)}else 1==i.length&&(this._trnMainService.TrnMainObj.TRNMODE=i[0].modevalue,this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS,"Cash"==i[0].TRNMODE?14!=this._trnMainService.TrnMainObj.VoucherType&&1!=this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC?this.masterService.userSetting.CASHINHAND_AC:null,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C"):this._trnMainService.TrnMainObj.TRNMODE=i[0].modevalue);this._trnMainService.TrnMainObj.TenderList=i,this.onSaveTransactionClicked()}}onSaveTermsnConditions(i){this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID=i}onSaveRecurringLog(i){this._trnMainService.TrnMainObj.RecurringItemList=i.recurringItemList,this._trnMainService.TrnMainObj.CommissionItemList=i.commissionItemList,this.transactionValidator()&&this.onSubmit()}forceCloseClick(){let i;i=this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.VCHRNO,this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result?this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i}).subscribe(s=>{"FORCECLOSED"!=s.result?this.showForceClose=!0:this.alertService.info("This Voucher is already closed")}):this.alertService.info(`Transaction already exist under selected voucher: ${this._trnMainService.TrnMainObj.VCHRNO} . Cannot Force Close !`)})}forceCloseSubmit(){if(""!==this.forceCloseObj.REMARKS&&null!=this.forceCloseObj.REMARKS){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.RequisitionApproval){if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.warning("Invoice no. for force close confirmation should match with loaded voucher no.")}else if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.REFORDBILL)return void this.alertService.warning("Invoice no. for rejection confirmation should match with loaded requistion no.");this.loadingService.show(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Rejecting the Requisition No."+this.forceCloseObj.VCHRNO:"Force Closing Purchase Order No."+this.forceCloseObj.VCHRNO),this.masterService.masterPostmethod("/saveForceClosedVoucher",this.forceCloseObj).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.showForceClose=!1,this.forceCloseObj={},this.onReset(),this.alertService.success(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Requisition rejected sucessfully.":i.result)):(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}else this.alertService.warning("Please enter remarks !")}closeForceClose(){this.showForceClose=!1}showBillTender(){this.showTenderList=!0}showInfoPopup(){"VIEW"!=this._trnMainService.TrnMainObj.Mode&&this.itemInfo.show()}OpenBOMListPopup(){this.productHelperSerivce.showBOMListPopupFn(!0)}closeTenderList(){this.showTenderList=!1}checkSalesRateBeforeCrate(){return this.filterList=[],this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(1==i.ISVAT?(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE<i.PRATE||0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE/this.userSetting.VatConRate<i.PRATE)&&this.filterList.push(i):i.ALTRATE<i.PRATE&&this.filterList.push(i)),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&i.RATE<i.PRATE&&this.filterList.push(i)}),!(this.filterList?.length>0&&(confirm("The sales rate for items are less than its cost rate. Ask for authorization?")&&this.authenticationPopup.show(this.filterList,"prateCheck"),1))}checkSODiscountLimit(){let i=this.masterService.userProfile.userRights.find(s=>"SODiscountLimit"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm("The discount applied to items exceed the discount limit. Ask for authorization?")&&this.authenticationPopup.show(n,"discountCheck"),1))}checkGblDiscountLimit(){let i=this.masterService.userProfile.roleRights.find(s=>"DISLIMIT"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm(`The discount applied to items exceed the discount limit: ${i?.value}%. Ask for authorization?`)&&this.authenticationPopup.show(n,"GblDiscountCheck"),1))}checkExpItem(){let i=[];return i=this._trnMainService.TrnMainObj.ProdList.filter(n=>new Date(n.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=n.MCODE&&1==n.REQEXPDATE),!(i&&i.length>0&&(confirm("Expiry Items detected. Do you want continue with transaction ?")&&this.authenticationPopup.show(i,"showExpItemList"),1))}onUserRightReceived(i){if("ALLOW"==i){if(!this.checkSODiscountLimit()||!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to do sales below Cost rate of respective items");this.authenticationPopup.closeDialog()}onCreditLimitReceived(i){if("ALLOW"==i){if(this._trnMainService.TrnMainObj.isAuthorized=!0,!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to save Bill exceeding the credit limit of the selected Credit Account");this.authenticationPopup.closeDialog()}allowExpiredItemforSave(i){if(console.log("save garda ya aaucha ta",i),"ALLOWSAVE"==i){if(!this.transactionValidator())return;this.onSubmit()}this.authenticationPopup.closeDialog()}onDiscountLimitReceived(i){if(this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)}),this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+i+"%)");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}onRoleRightsReceived(i){let s=JSON.parse(i).find(A=>"DISLIMIT"==A.right);if(this._trnMainService.TrnMainObj.ProdList.filter(A=>A.INDDISCOUNTRATE>s.value).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+s.value+")");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}stockAdjustmentLoaded(i){this._trnMainService.TrnMainObj.TRNDATE=i.Date;var n=b(10484),s=i.Date.replace("-","/").replace("-","/"),p=n.ad2bs(s);this._trnMainService.TrnMainObj.BSDATE=("1"==p.en.day||"2"==p.en.day||"3"==p.en.day||"4"==p.en.day||"5"==p.en.day||"6"==p.en.day||"7"==p.en.day||"8"==p.en.day||"9"==p.en.day?"0"+p.en.day:p.en.day)+"/"+("1"==p.en.month||"2"==p.en.month||"3"==p.en.month||"4"==p.en.month||"5"==p.en.month||"6"==p.en.month||"7"==p.en.month||"8"==p.en.month||"9"==p.en.month?"0"+p.en.month:p.en.month)+"/"+p.en.year}OnBatchAdjustmentClick(){this._trnMainService.BatchAdjustment().subscribe(i=>{"ok"==i.status?this.AutoAdjustment.showDialog(i.result):this.alertService.warning("Negatice Stock list not found")})}checkForUserRigths(i){if(i)return this.masterService.userProfile.userRights.find(n=>n.right==i)}checkCreditLimitRights(){let i=this.checkForUserRigths("AuthorizeCreditLimit");return i&&1==i?.value?!!confirm(`Credit Limit has Exceeded for the selected customer.. Credit Limit : ${this._trnMainService.TrnMainObj.CREDITLIMIT}, Credit Amount : ${this._trnMainService.TrnMainObj.BLAMOUNT} and bill amount : ${this._trnMainService.TrnMainObj.NETAMNT}. Save anyway ? `):(confirm("Credit limit is Exceed. Ask For Authorization?")&&this.authenticationPopup.show(this.filterList,"AuthorizeCreditLimitCheck"),!1)}onItemDoubleClickForOpening(i){this.spinnerService.show("Getting data, please wait..."),this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","VIEW").subscribe(n=>{n&&(this.spinnerService.hide(),this.OpeningFromPreviousYear.show(n.result.ProdList,"noLargeDataEntryEdit"))})}onItemDoubleClickForLargeDataEntry(i){this.spinnerService.show("Getting data, please wait...");const n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.TRNDATE;this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","EDIT").subscribe({next:p=>{if(console.log(p),"ok"===p.status){this.spinnerService.hide();const{guid:A}=p.result;this.OpeningFromPreviousYear.show(p.result.ProdList,"largeDataEntryEdit",A)}else this._trnMainService.TrnMainObj.VCHRNO=n,this._trnMainService.TrnMainObj.TRNDATE=s,this.spinnerService.hide(),this.alertService.info(p.result.error)}})}validateBeforeSave(){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return!1;if("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)return!(this._trnMainService.TrnMainObj?.AssetsProdList[0]?.MCODE&&this._trnMainService.TrnMainObj.NETAMNT);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.BatchAdjustment)return!1;if(this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(null==this._trnMainService.TrnMainObj.ProdList[0]?.MCODE&&null==this._trnMainService.TrnMainObj.AdditionProdList[0]?.TRNAC||null==this._trnMainService.TrnMainObj.NETAMNT))return!0;if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.DebitNote||"NONTRADING"!=this._trnMainService.TrnMainObj.INVOICETYPE){if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.DebitNote&&null==this._trnMainService.TrnMainObj.ProdList[0]?.MCODE||null==this._trnMainService.TrnMainObj.NETAMNT)return!0}else if(this._trnMainService.TrnMainObj?.AdditionProdList&&null==this._trnMainService.TrnMainObj?.AdditionProdList[0].TRNAC)return!0;return!1}onSaveImageCaptured(i){i?(this._trnMainService.TrnMainObj.UserSignature=i,this.onSaveTransactionClicked()):this.alertService.error("Error on Digital Signature!")}setCashProperty(){this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME?(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME,this._trnMainService.disableAccountInputField=!0):this.masterService.userSetting.CASHINHAND_AC?(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C"):(alert("'Default Cash' on database not found. Please Contact to Administrator for this!"),this._trnMainService.TrnMainObj.TRNACName="error...")}onViewSignatureClicked(){this.digitalSignUpload.show(this._trnMainService.TrnMainObj.UserSignature,this._trnMainService.TrnMainObj.Mode)}onPrintVoucher(){let n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.DIVISION,p=this._trnMainService.TrnMainObj.PhiscalID,A=this._trnMainService.TrnMainObj.TRNUSER,ie=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,se=this._trnMainService.TrnMainObj.PhiscalID,de=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,pe=de.split(""),ue={filename:"",rownumber:""};ue.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,ue.NAME=this.userProfile.CompanyInfo.NAME,ue.ADDRESS=this.userProfile.CompanyInfo.ADDRESS,ue.INITIAL=ie||this.userProfile.CompanyInfo.INITIAL,ue.PhiscalID=se||this.userProfile.CompanyInfo.PhiscalID,ue.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,ue.phone1=this.userProfile.CompanyInfo.TELA,ue.phone2=this.userProfile.CompanyInfo.TELB,ue.EMAIL=this.userProfile.CompanyInfo.EMAIL,ue.numtowords="",ue.panno1=pe[0]?pe[0]:" ",ue.panno2=pe[1]?pe[1]:" ",ue.panno3=pe[2]?pe[2]:" ",ue.panno4=pe[3]?pe[3]:" ",ue.panno5=pe[4]?pe[4]:" ",ue.panno6=pe[5]?pe[5]:" ",ue.panno7=pe[6]?pe[6]:" ",ue.panno8=pe[7]?pe[7]:" ",ue.panno9=pe[8]?pe[8]:" ",ue.title=" ",ue.caption=this.caption?this.caption:" ",ue.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,ue.PRINTBY=this.userProfile.username?this.userProfile.username:" ",ue.COMPANYVAT=de||this.userProfile.CompanyInfo.VAT,this.PrintHelperService.printVoucher(n,s,p,A,ue,"PIVOUCHER")}onImageClick(){this.genericimageupload.show("TaxInvoice",this._trnMainService.TrnMainObj.VCHRNO)}}return T.\u0275fac=function(i){return new(i||T)(t.Y36(y.p),t.Y36(Y.R),t.Y36(z.uw),t.Y36(K.F0),t.Y36(K.gz),t.Y36(H.c),t.Y36(j.V),t.Y36(oe.e),t.Y36(j.V),t.Y36(C.C),t.Y36(me.g),t.Y36(Fe),t.Y36(bt.R),t.Y36(f.P),t.Y36(Ct.i),t.Y36(nt.h),t.Y36(At))},T.\u0275cmp=t.Xpm({type:T,selectors:[["voucher-master-action"]],viewQuery:function(i,n){if(1&i&&(t.Gf(gn,5),t.Gf(vn,5),t.Gf(Sn,5),t.Gf(fn,5),t.Gf(On,5),t.Gf(bn,5),t.Gf(Cn,5),t.Gf(An,5),t.Gf(En,5),t.Gf(In,5),t.Gf(Pn,5),t.Gf(yn,5),t.Gf(xn,5),t.Gf(Rn,5),t.Gf(Nn,5),t.Gf(Ln,5),t.Gf(wn,5),t.Gf(Dn,5),t.Gf(jn,5),t.Gf(kn,5),t.Gf(Gi,5),t.Gf(Vn,5),t.Gf(Un,5),t.Gf(Bn,5),t.Gf(Kn,5),t.Gf(Zn,5),t.Gf(Fn,5),t.Gf(Qn,5),t.Gf(Hn,5),t.Gf(Gn,5),t.Gf(Yn,5),t.Gf(Jn,5),t.Gf(qn,5),t.Gf(Wn,5),t.Gf($n,5)),2&i){let s;t.iGM(s=t.CRH())&&(n.digitalSignUpload=s.first),t.iGM(s=t.CRH())&&(n.genericGrid=s.first),t.iGM(s=t.CRH())&&(n.genericimageupload=s.first),t.iGM(s=t.CRH())&&(n.genericTender=s.first),t.iGM(s=t.CRH())&&(n.genericGridHoldBill=s.first),t.iGM(s=t.CRH())&&(n.Transport=s.first),t.iGM(s=t.CRH())&&(n.genericGridIntend=s.first),t.iGM(s=t.CRH())&&(n.printSetupModal=s.first),t.iGM(s=t.CRH())&&(n.genericGridReverseView=s.first),t.iGM(s=t.CRH())&&(n.genericGridPerformaView=s.first),t.iGM(s=t.CRH())&&(n.genericGridForRecurring=s.first),t.iGM(s=t.CRH())&&(n.genericGridforPreviousOpening=s.first),t.iGM(s=t.CRH())&&(n.deliverySelectPopup=s.first),t.iGM(s=t.CRH())&&(n.requisitionSelectPopup=s.first),t.iGM(s=t.CRH())&&(n.genericGridExpList=s.first),t.iGM(s=t.CRH())&&(n.genericGridForTaxCancel=s.first),t.iGM(s=t.CRH())&&(n.ImportPurchaseDetail=s.first),t.iGM(s=t.CRH())&&(n.reverseEntryConfirm=s.first),t.iGM(s=t.CRH())&&(n.authenticationPopup=s.first),t.iGM(s=t.CRH())&&(n.itemInfo=s.first),t.iGM(s=t.CRH())&&(n.itemSearchPopup=s.first),t.iGM(s=t.CRH())&&(n.genericGridForLargeDataEntry=s.first),t.iGM(s=t.CRH())&&(n.genericGridTransferOut=s.first),t.iGM(s=t.CRH())&&(n.rateValidation=s.first),t.iGM(s=t.CRH())&&(n.PaymentPopup=s.first),t.iGM(s=t.CRH())&&(n.RecurringLog=s.first),t.iGM(s=t.CRH())&&(n.StockAdjustment=s.first),t.iGM(s=t.CRH())&&(n.CreateCustomerPopup=s.first),t.iGM(s=t.CRH())&&(n.AutoAdjustment=s.first),t.iGM(s=t.CRH())&&(n.OpeningFromPreviousYear=s.first),t.iGM(s=t.CRH())&&(n.TermConditionPopup=s.first),t.iGM(s=t.CRH())&&(n.PrevYearOpening=s.first),t.iGM(s=t.CRH())&&(n.MemberPointConfirmationPopup=s.first),t.iGM(s=t.CRH())&&(n.BillPreviewPopup=s.first),t.iGM(s=t.CRH())&&(n.multiselectGenericGrid=s.first)}},hostBindings:function(i,n){1&i&&t.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,t.evT)},inputs:{isSales:"isSales",buttonShow:"buttonShow",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit",deliveryChalanEmit:"deliveryChalanEmit",onViewClickEmit:"onViewClickEmit",onLoadFromSOClickEmit:"onLoadFromSOClickEmit",onLoadFromPOClickEmit:"onLoadFromPOClickEmit",onLoadFromHOPerformaInvoiceClickEmit:"onLoadFromHOPerformaInvoiceClickEmit",onLoadFromPerformaInvoiceClickEmit:"onLoadFromPerformaInvoiceClickEmit",onLoadFromReverseEntryEmit:"onLoadFromReverseEntryEmit",onLoadFromHoTaxInvoiceClickEmit:"onLoadFromHoTaxInvoiceClickEmit",onLoadFromSAPFTPClickEmit:"onLoadFromSAPFTPClickEmit",onShowFileUploadPopupEmit:"onShowFileUploadPopupEmit",onLoadFromStockSettlementApproval:"onLoadFromStockSettlementApproval",onSettlementStockApprove:"onSettlementStockApprove",onApproveStockSettlementList:"onApproveStockSettlementList",onFileUploadPopupEmit:"onFileUploadPopupEmit",onSaveINVAllocation:"onSaveINVAllocation",onSaveSelfBilling:"onSaveSelfBilling",onclickOnResetPopupEmit:"onclickOnResetPopupEmit",onLoadCancelSalesEmit:"onLoadCancelSalesEmit",onAddNewCustomerClickEmit:"onAddNewCustomerClickEmit",onClickCustomer:"onClickCustomer",onClickSalesMan:"onClickSalesMan"},features:[t._Bn([C.C])],decls:133,vars:76,consts:[["class","wp-hdr-login",4,"ngIf"],["class","wp-hdr-login-txt",4,"ngIf"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px","data-toggle","modal",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","voucher","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","data-toggle","modal","style","margin: 0pcx 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal","data-target","#InvoiceNewPrint",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","expiredSO","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-info pull-right",3,"click",4,"ngIf"],["data-toggle","modal","style","margin: 0pcx 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right",3,"click",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["itemSearchPopup",""],["genericGridforPreviousOpening",""],["genericGridForLargeDataEntry",""],["genericGridForRecurring",""],["genericGridReverseView",""],["genericGridPerformaView",""],["genericGridHoldBill",""],[3,"okClicked",4,"ngIf"],[3,"popupsettings"],["genericGridIntend",""],[3,"tranMode"],["ImportPurchaseDetail",""],[3,"onClickReverse"],["reverseEntryConfirm",""],[3,"okClicked"],["PaymentPopup",""],[3,"onUserRightReceived","onDiscountLimitReceived","onRoleRightsReceived","onCreditLimitReceived","allowExpiredItemforSave"],["authenticationPopup",""],[3,"RecurringItems","CommissionItems","RecurringItemsForEdit","CommissionItemsForEdit","mode","recurringlogsaved"],["RecurringLog",""],[3,"itemInfopopupsettings"],["itemInfo",""],[3,"stockAdjustmentLoaded"],["StockAdjustment",""],["AutoAdjustment",""],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 65%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 500px;\n    position: absolute;\n    right: 15%;\n    top: 5px;\n    width: 1100px;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 30vw;\n    width: 30vw;\n    z-index: 9999999;\n  ",4,"ngIf"],[4,"ngIf"],["genericGridTransferOut",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 330px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 140%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],["class","forceClose_container",4,"ngIf"],["OpeningFromPreviousYear",""],["PrevYearOpening",""],["TermConditionPopup",""],["genericGridExpList",""],["MemberPointConfirmationPopup",""],["BillPreviewPopup",""],[3,"onSaveImageCaptured"],["digitalSignUpload",""],[3,"popupsettings","onItemsSelected"],["multiselectGenericGrid",""],["deliverySelectPopup",""],["requisitionSelectPopup",""],["genericimageupload",""],[1,"wp-hdr-login"],[1,"wp-hdr-login-txt"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","voucher","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0pcx 4px",3,"click"],["id","C","data-toggle","modal","data-target","#InvoiceNewPrint",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","C","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","expiredSO","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[4,"ngIf","ngIfElse"],["save",""],["type","button",1,"btn","btn-info","pull-right",3,"click"],[1,"btn-label"],[1,"glyphicon","glyphicon-upload"],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",3,"click"],["genericTender",""],["Transport",""],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","65%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area"],["id","myModalLabel",1,"modal-title"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","printOption","value","0",3,"formControl"],["type","radio","name","printOption","value","1","checked","",3,"formControl"],["printSetupModal",""],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","500px","position","absolute","right","15%","top","5px","width","1100px","z-index","9999999"],[1,"col-md-12",2,"height","350px","overflow-y","auto"],[1,"table",2,"margin-bottom","5px","font-size","12.5px"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","#2dacd1","color","black"],[1,"texttitle",2,"color","black"],[2,"border","1px"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary",2,"margin-top","20px",3,"click"],[2,"width","55px"],["type","checkbox",2,"width","100%",3,"ngModel","ngModelChange"],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","30vw","width","30vw","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-body",2,"height","420px","overflow-y","scroll"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px","margin-right","8rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["class","row",4,"ngIf"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],["style","width: 25%",4,"ngIf"],[2,"width","63%",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"width","25%"],[3,"ngValue"],["type","text","placeholder","Press Enter For Transferred List","autocomplete","off",2,"width","63%",3,"ngModel","ngModelChange","keydown.Enter"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","330px","position","absolute","right","20%","top","5px","width","140%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","3px"],[2,"margin-top","4px","margin-bottom","2px"],[2,"font-size","13px","width","30%"],[2,"height","8rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","17%"],["scope","col","style","width: 18%",4,"ngIf"],["scope","col","style","width: 25%",4,"ngIf"],["scope","col","style","width: 25%;",4,"ngIf"],[1,"col-md-12","row",2,"padding","0px"],[1,"col-md-4"],[1,"col-md-8","row","justify-content-end",2,"text-align","right"],["style","margin-right: 0;\n              font-size: 0.9rem;",4,"ngIf"],["class","d-flex justify-content-end",4,"ngIf"],[1,"form-control-label",2,"font-weight","bold","font-size","14px","width","auto"],[1,"form-control-label",2,"font-size","14px","width","auto"],["scope","col",2,"width","18%"],["scope","col",2,"width","25%"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["style","border: 1px solid #e6e6e6",4,"ngIf"],["appSalesRateDisableFromUserProfile","","type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keyup","keydown.enter","keydown.Tab"],[2,"margin-right","0","font-size","0.9rem"],[1,"d-flex","justify-content-end"],[2,"font-size","0.9rem"],[1,"forceClose_container"],[1,"card"],[1,"card-header"],["style","text-align: center",4,"ngIf"],[2,"position","absolute","right","2%","top","5%"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label",2,"font-weight","bold"],[1,"col-md-7"],["type","text",1,"form-control",2,"height","4vh","font-size","12px",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label",2,"font-weight","bold"],[1,"form-control",2,"width","100%","font-size","12px",3,"ngModel","ngModelChange"],[2,"text-align","center"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","60%","width","51%"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"table","table-striped"],[2,"position","sticky","top","0","line-height","1.5rem","font-size","12px"],["scope","col",2,"width","10%","line-height","14px","white-space","nowrap"],["scope","col",2,"width","10%","text-align","right","line-height","14px","white-space","nowrap"],["scope","col",2,"width","30%","line-height","14px","white-space","nowrap"],[1,"tenderList"],[1,"modal-footer",2,"padding","2px"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","11px","height","25ox",3,"click"],[2,"width","10%"],[2,"width","10%","text-align","right"],[2,"width","30%"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&(t.YNc(0,zn,2,0,"span",0),t.YNc(1,Xn,2,1,"span",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return n.cancel()}),t._uU(3," BACK\n"),t.qZA(),t.YNc(4,er,2,0,"button",3),t.YNc(5,tr,2,0,"button",4),t.YNc(6,ir,2,0,"button",4),t.YNc(7,nr,2,1,"button",5),t.YNc(8,rr,2,0,"button",4),t.YNc(9,or,2,0,"button",4),t.YNc(10,sr,2,1,"button",6),t.YNc(11,ar,2,1,"button",7),t.YNc(12,cr,2,0,"button",8),t.YNc(13,lr,2,0,"button",9),t.YNc(14,dr,2,0,"button",9),t.YNc(15,v,2,0,"button",10),t.YNc(16,V,2,0,"button",10),t.YNc(17,r,2,0,"button",9),t.YNc(18,l,2,0,"button",11),t.YNc(19,c,2,1,"button",12),t.YNc(20,u,2,1,"button",13),t.YNc(21,R,2,1,"button",14),t.YNc(22,F,2,1,"button",15),t.YNc(23,le,2,0,"button",9),t.YNc(24,Se,2,0,"button",9),t.YNc(25,Re,2,0,"button",9),t.YNc(26,xe,2,0,"button",9),t.YNc(27,ye,2,0,"button",9),t.YNc(28,ji,2,0,"button",9),t.YNc(29,hr,2,0,"button",9),t.YNc(30,ur,2,0,"button",9),t.YNc(31,pr,2,1,"button",15),t.YNc(32,Yi,4,3,"button",15),t.YNc(33,Ae,2,1,"button",9),t.YNc(34,Ji,2,0,"button",9),t.YNc(35,qi,4,0,"button",16),t.YNc(36,Pe,2,0,"button",9),t.YNc(37,Wi,2,0,"button",17),t.YNc(38,Je,2,0,"button",9),t.YNc(39,ki,2,0,"button",9),t.YNc(40,Mr,2,0,"button",9),t.YNc(41,mr,2,0,"button",9),t.YNc(42,gr,2,0,"button",9),t.YNc(43,Vi,2,0,"button",9),t.YNc(44,fr,2,0,"button",18),t.YNc(45,Or,2,0,"button",18),t.YNc(46,br,2,0,"button",18),t.TgZ(47,"generic-popup-grid",19,20),t.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClick(p)}),t.qZA(),t._UZ(49,"app-item-search-popup",null,21),t.TgZ(51,"generic-popup-grid",19,22),t.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClickForOpening(p)}),t.qZA(),t.TgZ(53,"generic-popup-grid",19,23),t.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClickForLargeDataEntry(p)}),t.qZA(),t.TgZ(55,"generic-popup-grid",19,24),t.NdJ("onItemDoubleClick",function(p){return n.onRecurringDoubleClick(p)}),t.qZA(),t.TgZ(57,"generic-popup-grid",19,25),t.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClick(p)}),t.qZA(),t.TgZ(59,"generic-popup-grid",19,26),t.NdJ("onItemDoubleClick",function(p){return n.onPerformaDoubleClick(p)}),t.qZA(),t.TgZ(61,"generic-popup-grid",19,27),t.NdJ("onItemDoubleClick",function(p){return n.onHoldBillDoubleClick(p)}),t.qZA(),t.YNc(63,Cr,2,0,"generic-popup-Tender",28),t.YNc(64,Ar,2,0,"Transport-Popup",28),t._UZ(65,"generic-popup-grid",29,30)(67,"import-purchase-details",31,32),t.TgZ(69,"reverse-entry-dialog",33,34),t.NdJ("onClickReverse",function(){return n.onClickReverseSave()}),t.qZA(),t.TgZ(71,"payment-popup-dialog",35,36),t.NdJ("okClicked",function(p){return n.onSavePayment(p)}),t.qZA(),t.TgZ(73,"authentication-entry",37,38),t.NdJ("onUserRightReceived",function(p){return n.onUserRightReceived(p)})("onDiscountLimitReceived",function(p){return n.onDiscountLimitReceived(p)})("onRoleRightsReceived",function(p){return n.onRoleRightsReceived(p)})("onCreditLimitReceived",function(p){return n.onCreditLimitReceived(p)})("allowExpiredItemforSave",function(p){return n.allowExpiredItemforSave(p)}),t.qZA(),t.TgZ(75,"recurringlog-popup",39,40),t.NdJ("recurringlogsaved",function(p){return n.onSaveRecurringLog(p)}),t.qZA(),t._UZ(77,"iteminfo-popup",41,42),t.TgZ(79,"stockadjustment-popup",43,44),t.NdJ("stockAdjustmentLoaded",function(p){return n.stockAdjustmentLoaded(p)}),t.qZA(),t._UZ(81,"autoadjustment-popup",null,45),t.YNc(83,Pr,14,2,"div",46),t.YNc(84,xr,53,1,"div",47),t.YNc(85,Rr,13,1,"div",48),t.YNc(86,Vr,18,3,"div",49),t.TgZ(87,"generic-popup-grid",19,50),t.NdJ("onItemDoubleClick",function(p){return n.dblClickLoadTransferOutData(p)}),t.qZA(),t.YNc(89,zr,46,10,"div",51),t.TgZ(90,"div")(91,"div",52,53)(93,"div",54)(94,"div",55)(95,"div",56)(96,"button",57),t.NdJ("click",function(){return n.onClickNo()}),t.TgZ(97,"span",58),t._uU(98,"\xd7"),t.qZA()()(),t.TgZ(99,"div",59)(100,"div",60)(101,"div",61),t._uU(102),t.qZA(),t.TgZ(103,"div",62)(104,"button",63),t.NdJ("click",function(){return n.onClickYes()}),t._uU(105," Yes "),t.qZA(),t.TgZ(106,"button",64),t.NdJ("click",function(){return n.onClickNo()}),t._uU(107," No "),t.qZA()()()()()()()(),t.YNc(108,to,21,5,"div",65),t.YNc(109,no,24,1,"div",49),t.YNc(110,ro,23,2,"div",49),t._UZ(111,"app-opening-from-previous-year",null,66)(113,"previous-year-opening",null,67),t.TgZ(115,"termsncondition-popup-dialog",35,68),t.NdJ("okClicked",function(p){return n.onSaveTermsnConditions(p)}),t.qZA(),t.TgZ(117,"generic-popup-grid",19,69),t.NdJ("onItemDoubleClick",function(p){return n.onListSelected(p)}),t.qZA(),t.TgZ(119,"member-point-confirm-popup",35,70),t.NdJ("okClicked",function(p){return n.confirmationOkClicked(p)}),t.qZA(),t._UZ(121,"preview-bill-popup-dialog",null,71),t.TgZ(123,"digital-signature-popup",72,73),t.NdJ("onSaveImageCaptured",function(p){return n.onSaveImageCaptured(p)}),t.qZA(),t.TgZ(125,"multiselect-generic-grid",74,75),t.NdJ("onItemsSelected",function(p){return n.onMultiItemSelected(p)}),t.qZA(),t._UZ(127,"app-delivery-select-popup",null,76)(129,"app-requisition-select-popup",null,77)(131,"generic-img-upload",null,78)),2&i&&(t.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),t.xp6(1),t.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),t.xp6(3),t.Q6J("ngIf",80==n._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",19==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf","add-purchase-invoice"==n.activeurlpath&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",(19==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",90==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&(null!=n._trnMainService.TrnMainObj.REFORDBILL||null!=n._trnMainService.TrnMainObj.REFORDBILL)),t.xp6(1),t.Q6J("ngIf",(14==n._trnMainService.TrnMainObj.VoucherType||1==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.GblEnableMixedTenderMode&&n.showSecondaryButtons&&"lite"!=n.AppMode),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&(1==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||57==n._trnMainService.TrnMainObj.VoucherType||83==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType||41==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||43==n._trnMainService.TrnMainObj.VoucherType||64==n._trnMainService.TrnMainObj.VoucherType||8==n._trnMainService.TrnMainObj.VoucherType||9==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType||71==n._trnMainService.TrnMainObj.VoucherType||81==n._trnMainService.TrnMainObj.VoucherType||37==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType||7==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||3==n._trnMainService.TrnMainObj.VoucherType||40==n._trnMainService.TrnMainObj.VoucherType)&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton&&n.checkOfflineBilling()),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&3==n._trnMainService.TrnMainObj.VoucherType&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton),t.xp6(1),t.Q6J("ngIf","StockSettlementEntryApproval"==n.activeurlpath),t.xp6(1),t.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",(!n._trnMainService.showPerformaApproveReject&&57==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&"retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE),t.xp6(1),t.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&1==n.userSetting.EnableAutoSOExpiry),t.xp6(1),t.Q6J("ngIf",(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.hideButton&&n.showSecondaryButtons&&n.buttonShow),t.xp6(1),t.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&"assets-openingstockentry"!=n.activeurlpath&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType&&n.userSetting.IsBBSM)&&n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",8==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&1==n._trnMainService.userSetting.ENABLESINGLEBATCHMODE),t.xp6(1),t.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf","VIEW"===n._trnMainService.TrnMainObj.Mode&&1===n.userSetting.EnableDigitalSignature&&5===n._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&n.hideButton&&"add-membership-sales-invoice"!=n.activeurlpath&&n.buttonShow),t.xp6(1),t.Q6J("ngIf",n.userSetting.IsBBSM?n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton&&80!=n._trnMainService.TrnMainObj.VoucherType&&0==n.userSetting.EnableRQLogInRQEntry:n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf","canceladdsientry"!=n.activeurlpath&&("VIEW"!=n._trnMainService.TrnMainObj.Mode||!n._trnMainService.showPerformaApproveReject)&&!n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&(19===n._trnMainService.TrnMainObj.VoucherType||64===n._trnMainService.TrnMainObj.VoucherType||3===n._trnMainService.TrnMainObj.VoucherType&&1==n.userSetting.PODELIVERYMODE)&&1==n.userSetting.ApplyTermsAndCondition),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton&&14===n._trnMainService.TrnMainObj.VoucherType&&"add-sales-invoice"==n._trnMainService.activeurlpath),t.xp6(1),t.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton&&20===n._trnMainService.TrnMainObj.VoucherType&&1==n._trnMainService.enableRefreshRateInSO&&"EDIT"==n._trnMainService.buttonMode),t.xp6(1),t.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton&&1==n.userSetting.RECURRING_TRANSACTION),t.xp6(1),t.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&0==n.userSetting.centralizeddbmode&&!n.showSecondaryButtons),t.xp6(1),t.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath&&("export-sales-invoice"!=n.activeurlpath||1==n.userSetting.EnableGRNInPIForCargo)),t.xp6(1),t.Q6J("ngIf",n.showSecondaryButtons&&"add-sales-invoice"==n.activeurlpath&&1==n.userSetting.EnableDeliveryChalan),t.xp6(1),t.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.EnableRecurringItem&&1==n.userSetting.EnableCommissionCalculation),t.xp6(1),t.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&1===n.userSetting.ENABLE_SALESMAN_ROUTE&&"self-billing"!=n.activeurlpath),t.xp6(1),t.Q6J("ngIf","canceladdsientry"==n.activeurlpath),t.xp6(1),t.Q6J("ngIf",3==n._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE"==(null==n._trnMainService.TrnMainObj||null==n._trnMainService.TrnMainObj.AdditionalObj?null:n._trnMainService.TrnMainObj.AdditionalObj.tag)),t.xp6(1),t.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettings),t.xp6(4),t.Q6J("popupsettings",n.gridPopupSettingForPreviousOpening),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingForLargeEntry),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForRecurring),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForReverse),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForViewPerforma),t.xp6(2),t.Q6J("popupsettings",n.gridPopupSettingsForHoldBill),t.xp6(2),t.Q6J("ngIf","retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&14==n._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&("superdistributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"distributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE)),t.xp6(1),t.Q6J("popupsettings",n.gridPopupSettingsForIntend),t.xp6(2),t.Q6J("tranMode",n._trnMainService.TrnMainObj.Mode),t.xp6(8),t.Q6J("RecurringItems",n.recurringItems)("CommissionItems",n.commissionChargeable)("RecurringItemsForEdit",n.recurringItemsForEdit)("CommissionItemsForEdit",n.commissionItemsForEdit)("mode",n.recurringLogMode),t.xp6(2),t.Q6J("itemInfopopupsettings",n.itemInfoPopupSettings),t.xp6(6),t.Q6J("ngIf",n.promptPrintDevice),t.xp6(1),t.Q6J("ngIf",n.showschemePopup),t.xp6(1),t.Q6J("ngIf",n.showPosPrinterPreview),t.xp6(1),t.Q6J("ngIf",n.addForRequisition),t.xp6(1),t.Q6J("popupsettings",n.genericGridTransferOutSetting),t.xp6(2),t.Q6J("ngIf",n.showPriceChangeDetail&&1==n.userSetting.ShowPriceChangePopup),t.xp6(2),t.Q6J("config",t.DdM(75,oo)),t.xp6(11),t.hij(" ",n.rateValidationDisplayMessage," "),t.xp6(6),t.Q6J("ngIf",n.showForceClose),t.xp6(1),t.Q6J("ngIf",n.showTenderList),t.xp6(1),t.Q6J("ngIf",n.showReverseEntryAuth),t.xp6(7),t.Q6J("popupsettings",n.gridPopupSettingsForExpList),t.xp6(8),t.Q6J("popupsettings",n.multiselectPopupSettings))},dependencies:[Et.oB,L.sg,L.O5,O._Y,O.YN,O.Kr,O.Fj,O.wV,O.Wl,O.EJ,O._,O.JJ,O.JL,O.On,O.F,O.oH,J.Zl,Dt,Kt,qt,$t,gi,Ni,D.m,P,ne,Be,zi,nn,cn,dn,pn,_n.q,W.ky,Tn.b,Mn.n,mn.O,L.JJ,ze.g],styles:["span[_ngcontent-%COMP%] {\n    font-weight: bold;\n  }\n  .modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 11px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #ced6d3 !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 100%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    \n    white-space: nowrap;\n  }\n\n  .forceClose_container[_ngcontent-%COMP%] {\n    position: fixed !important;\n    transform: translate(-50px, -50px);\n    \n    background: #ffffff;\n    z-index: 99999;\n    width: 57%;\n    top: 29.5%;\n    left: 26%;\n  }\n\n  \n\n  .tenderList[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n    padding: 0rem 0.75rem;\n    font-size: 12px;\n  }"]}),T})()},68527:(ve,ce,b)=>{b.d(ce,{q:()=>H});var e=b(93105),O=b(42326),M=b(64537),ee=b(53074),$=b(87584),S=b(69389),J=b(67297),C=b(54536),_=b(7976),Z=b(88692);function k(j,y){1&j&&(M.TgZ(0,"span"),M._uU(1,"Show Detail [F1]"),M.qZA())}function X(j,y){1&j&&(M.TgZ(0,"span"),M._uU(1,"Hide Detail [F1]"),M.qZA())}let H=(()=>{class j{constructor(f,L,x,m,I,P){this.masterService=f,this._trnMainService=L,this.setting=x,this.dialog=I,this.arouter=P,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new e.EventEmitter,this.TrnMainObj=L.TrnMainObj,this.AppSettings=this.setting.appSetting,this.userProfile=m.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.activeurlpath=P.snapshot.url[0].path,this.masterService.refreshTransactionList(),(this.TrnMainObj.VoucherType==O.Km.CreditNote||this.TrnMainObj.VoucherType==O.Km.SalesReturn)&&(this.transactionType="creditnote")}ngOnInit(){this.masterService.ShowMore=!0}ngOnDestroy(){try{this.subscriptions.forEach(f=>{f.unsubscribe()})}catch{}}ShowMore(){this.masterService.ShowMore=!this.masterService.ShowMore,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0)}nullToZeroConverter(f){return null==f||null==f||""==f?0:parseFloat(f)}handleKeyDownboardEvent(f){"F1"==f.code&&(f.preventDefault(),this.ShowMore())}}return j.\u0275fac=function(f){return new(f||j)(M.Y36(ee.P),M.Y36($.p),M.Y36(S.R),M.Y36(J.e),M.Y36(C.uw),M.Y36(_.gz))},j.\u0275cmp=M.Xpm({type:j,selectors:[["voucher-master-toggler"]],hostBindings:function(f,L){1&f&&M.NdJ("keydown",function(m){return L.handleKeyDownboardEvent(m)},!1,M.evT)},inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:3,vars:2,consts:[[1,"btn","btn-info",3,"click"],[4,"ngIf"]],template:function(f,L){1&f&&(M.TgZ(0,"button",0),M.NdJ("click",function(){return L.ShowMore()}),M.YNc(1,k,2,0,"span",1),M.YNc(2,X,2,0,"span",1),M.qZA()),2&f&&(M.xp6(1),M.Q6J("ngIf",!L.masterService.ShowMore),M.xp6(1),M.Q6J("ngIf",L.masterService.ShowMore))},dependencies:[Z.O5],encapsulation:2}),j})()},78159:(ve,ce,b)=>{b.d(ce,{u:()=>w});var e=b(93105),O=b(42326),M=b(64537),ee=b(53074),$=b(87584),S=b(67297),J=b(88692),C=b(89952),_=b(79700),Z=b(63688);function k(Q,U){if(1&Q&&(M.TgZ(0,"div",5)(1,"h6"),M._uU(2),M.ALo(3,"twoDigitNumber"),M.qZA()()),2&Q){const B=M.oxw(2);M.xp6(2),M.hij("ECS: ",M.lcZ(3,1,B._trnMainService.TrnMainObj.TOTALECS),"")}}function X(Q,U){if(1&Q&&(M.TgZ(0,"div",5)(1,"h6"),M._uU(2),M.ALo(3,"twoDigitNumber"),M.qZA()()),2&Q){const B=M.oxw(2);M.xp6(2),M.hij("VAT: ",M.lcZ(3,1,B._trnMainService.TrnMainObj.VATAMNT),"")}}function H(Q,U){if(1&Q&&(M.TgZ(0,"div",8)(1,"h6"),M._uU(2),M.ALo(3,"twoDigitNumber"),M.qZA()()),2&Q){const B=M.oxw(2);M.xp6(2),M.AsE("",B._trnMainService.TrnMainObj.FCurrency," TOTAL: ",M.lcZ(3,2,B._trnMainService.TrnMainObj.fcTotal),"")}}function j(Q,U){if(1&Q&&(M.TgZ(0,"div",4)(1,"div",5)(2,"h6"),M._uU(3),M.ALo(4,"threeDigitNumber"),M.qZA()(),M.TgZ(5,"div",5)(6,"h6"),M._uU(7),M.ALo(8,"twoDigitNumber"),M.qZA()(),M.YNc(9,k,4,3,"div",6),M.ALo(10,"activeColumn"),M.TgZ(11,"div",5)(12,"h6"),M._uU(13),M.ALo(14,"twoDigitNumber"),M.qZA()(),M.TgZ(15,"div",5)(16,"h6"),M._uU(17),M.ALo(18,"twoDigitNumber"),M.qZA()(),M.TgZ(19,"div",5)(20,"h6"),M._uU(21),M.ALo(22,"twoDigitNumber"),M.qZA()(),M.YNc(23,X,4,3,"div",6),M.TgZ(24,"div",5)(25,"h6"),M._uU(26),M.ALo(27,"twoDigitNumber"),M.qZA()(),M.YNc(28,H,4,4,"div",7),M.qZA()),2&Q){const B=M.oxw();M.xp6(3),M.hij("TOTAL QTY: ",M.lcZ(4,9,B._trnMainService.TrnMainObj.TOTALSQTY),""),M.xp6(4),M.hij("GROSS: ",M.lcZ(8,11,B._trnMainService.TrnMainObj.GROSSAMNT),""),M.xp6(2),M.Q6J("ngIf",M.lcZ(10,13,"ECSAmount")),M.xp6(4),M.hij("DISCOUNT: ",M.lcZ(14,15,B._trnMainService.TrnMainObj.TOTALDISCOUNT),""),M.xp6(4),M.hij("TAXABLE: ",M.lcZ(18,17,B._trnMainService.TrnMainObj.TAXABLE),"\xa0"),M.xp6(4),M.hij("NON TAXABLE: ",M.lcZ(22,19,B._trnMainService.TrnMainObj.NONTAXABLE),"\xa0"),M.xp6(2),M.Q6J("ngIf",B.showVatTotal()),M.xp6(3),M.hij("NET AMNT: ",M.lcZ(27,21,B._trnMainService.TrnMainObj.NETAMNT),""),M.xp6(2),M.Q6J("ngIf",10==B._trnMainService.TrnMainObj.CNDN_MODE&&(3==B._trnMainService.TrnMainObj.VoucherType||37==B._trnMainService.TrnMainObj.VoucherType||14==B._trnMainService.TrnMainObj.VoucherType)&&B._trnMainService.TrnMainObj.FCurrency)}}function y(Q,U){if(1&Q&&(M.TgZ(0,"div",12)(1,"h6",11),M._uU(2),M.ALo(3,"twoDigitNumber"),M.qZA()()),2&Q){const B=M.oxw(2);M.xp6(2),M.hij("",M.lcZ(3,1,B._trnMainService.TrnMainObj.GROSSAMNT)," ")}}function f(Q,U){if(1&Q&&(M.TgZ(0,"div",9)(1,"div",10)(2,"h6",11),M._uU(3,"TOTAL:"),M.qZA()(),M.TgZ(4,"div",12)(5,"h6",11),M._uU(6),M.ALo(7,"threeDigitNumber"),M.qZA()(),M.YNc(8,y,4,3,"div",13),M.qZA()),2&Q){const B=M.oxw();M.xp6(6),M.hij("",M.lcZ(7,2,B._trnMainService.TrnMainObj.TOTALQTY)," "),M.xp6(2),M.Q6J("ngIf",B._trnMainService.showFieldFromRight("Amnt")&&B._trnMainService.showFieldFromRight("Amt"))}}function L(Q,U){if(1&Q&&(M.TgZ(0,"div",10)(1,"h6"),M._uU(2),M.ALo(3,"twoDigitNumber"),M.qZA()()),2&Q){const B=M.oxw(2);M.xp6(2),M.hij("TOTAL AMNT: ",M.lcZ(3,1,B._trnMainService.TrnMainObj.NETAMNT),"")}}function x(Q,U){if(1&Q&&(M.TgZ(0,"div",9),M._UZ(1,"div",14),M.TgZ(2,"div",15)(3,"div",10)(4,"h6"),M._uU(5),M.ALo(6,"threeDigitNumber"),M.qZA()(),M.YNc(7,L,4,3,"div",16),M.qZA()()),2&Q){const B=M.oxw();M.xp6(5),M.hij("TOTAL QTY: ",M.lcZ(6,2,B._trnMainService.TrnMainObj.TOTALSQTY)," "),M.xp6(2),M.Q6J("ngIf",B._trnMainService.showFieldFromRight("Amnt")&&B._trnMainService.showFieldFromRight("Amt"))}}function m(Q,U){if(1&Q&&(M.TgZ(0,"div",9),M._UZ(1,"div",14),M.TgZ(2,"div",15)(3,"div",10)(4,"h6"),M._uU(5),M.ALo(6,"threeDigitNumber"),M.qZA()(),M.TgZ(7,"div",10)(8,"h6"),M._uU(9),M.ALo(10,"twoDigitNumber"),M.qZA()()()()),2&Q){const B=M.oxw();M.xp6(5),M.hij("TOTAL QTY: ",M.lcZ(6,2,B._trnMainService.TrnMainObj.TOTALSQTY)," "),M.xp6(4),M.hij("TOTAL AMNT: ",M.lcZ(10,4,B._trnMainService.TrnMainObj.GROSSAMNT),"")}}function I(Q,U){if(1&Q&&(M.TgZ(0,"div",9)(1,"div",17),M._UZ(2,"div",18),M.TgZ(3,"label",19),M._uU(4),M.qZA(),M._UZ(5,"div",20),M.TgZ(6,"label",19),M._uU(7),M.qZA(),M._UZ(8,"div",21),M.TgZ(9,"label",19),M._uU(10),M.qZA(),M._UZ(11,"div",22),M.TgZ(12,"label",19),M._uU(13),M.qZA()()()),2&Q){const B=M.oxw();M.xp6(4),M.hij("Request is equal to ",B.qtyLabel,""),M.xp6(3),M.hij("Request is more than ",B.qtyLabel,""),M.xp6(3),M.hij("",B.qtyLabel," is more than Request"),M.xp6(3),M.hij("",B.qtyLabel," quantity is Zero")}}function P(Q,U){if(1&Q&&(M.TgZ(0,"div",9),M._UZ(1,"div",23),M.TgZ(2,"div",24)(3,"h6"),M._uU(4),M.ALo(5,"threeDigitNumber"),M.qZA()()()),2&Q){const B=M.oxw();M.xp6(4),M.hij("TOTAL QTY: ",M.lcZ(5,1,B._trnMainService.TrnMainObj.TOTALQTY)," ")}}let w=(()=>{class Q{constructor(B,q,W){this.masterService=B,this._trnMainService=q,this._authservice=W,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new e.EventEmitter,82==this._trnMainService.TrnMainObj.VoucherType?this.qtyLabel="Dispatch":90==this._trnMainService.TrnMainObj.VoucherType&&(this.qtyLabel="Approved"),this.userSetting=W.getSetting()}ngOnInit(){}ngOnDestroy(){try{this.subscriptions.forEach(B=>{B.unsubscribe()})}catch{}}onKeydownPreventEdit(B){B.preventDefault()}showTotalDetails(){return!(this._trnMainService.TrnMainObj.VoucherType==O.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==O.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==O.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==O.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==O.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==O.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==O.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==O.Km.ReverseProductionEntry||this._trnMainService.TrnMainObj.VoucherType==O.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==O.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==O.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==O.Km.InventoryAllocation||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==O.Km.ApprovalClose)}showTotalQtyAmnt(){return(this._trnMainService.TrnMainObj.VoucherType==O.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==O.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.RequisitionApproval&&"requisition"==this._trnMainService.TrnMainObj.filterByInReqApproval)&&"requisition-log"!=this._trnMainService.activeurlpath}showTotalQty(){return this._trnMainService.TrnMainObj.VoucherType==O.Km.RequisitionEntry||"requisition-log"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==O.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==O.Km.ApprovalClose}showColorLabel(){return!(!(82==this._trnMainService.TrnMainObj.VoucherType||90==this._trnMainService.TrnMainObj.VoucherType&&this.userSetting.IsBBSM)||"VIEW"==this._trnMainService.TrnMainObj.Mode)}showVatTotal(){return"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj?.tag&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj?.tag&&!((this._trnMainService.TrnMainObj.VoucherType==O.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==O.Km.Quotation)&&0==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)}}return Q.\u0275fac=function(B){return new(B||Q)(M.Y36(ee.P),M.Y36($.p),M.Y36(S.e))},Q.\u0275cmp=M.Xpm({type:Q,selectors:[["voucher-total-area"]],inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:8,vars:6,consts:[[1,"row","clearfix","footer"],[1,"col-md-12",2,"vertical-align","center","padding-right","0px"],["class","row total-details",4,"ngIf"],["class","row",4,"ngIf"],[1,"row","total-details"],[1,"detail-item"],["class","detail-item",4,"ngIf"],["class","detail-item foreign-currency",4,"ngIf"],[1,"detail-item","foreign-currency"],[1,"row"],[1,"col-md-6"],[1,"pull-right"],[1,"col-md-2"],["class","col-md-2",4,"ngIf"],[1,"col-md-7"],[1,"col-md-5","row"],["class","col-md-6",4,"ngIf"],[1,"col-md-12",2,"display","flex","align-items","center"],[1,"green"],[1,"label-color"],[1,"yellow"],[1,"red"],[1,"brown"],[1,"col-md-9"],[1,"col-md-3","row"]],template:function(B,q){1&B&&(M.TgZ(0,"div",0)(1,"div",1),M.YNc(2,j,29,23,"div",2),M.YNc(3,f,9,4,"div",3),M.YNc(4,x,8,4,"div",3),M.YNc(5,m,11,6,"div",3),M.YNc(6,I,14,4,"div",3),M.YNc(7,P,6,3,"div",3),M.qZA()()),2&B&&(M.xp6(2),M.Q6J("ngIf",q.showTotalDetails()),M.xp6(1),M.Q6J("ngIf",24==q._trnMainService.TrnMainObj.VoucherType||5==q._trnMainService.TrnMainObj.VoucherType||88==q._trnMainService.TrnMainObj.VoucherType||75==q._trnMainService.TrnMainObj.VoucherType||89==q._trnMainService.TrnMainObj.VoucherType),M.xp6(1),M.Q6J("ngIf",7==q._trnMainService.TrnMainObj.VoucherType||8==q._trnMainService.TrnMainObj.VoucherType||9==q._trnMainService.TrnMainObj.VoucherType||74==q._trnMainService.TrnMainObj.VoucherType),M.xp6(1),M.Q6J("ngIf",q.showTotalQtyAmnt()),M.xp6(1),M.Q6J("ngIf",q.showColorLabel()),M.xp6(1),M.Q6J("ngIf",q.showTotalQty()))},dependencies:[J.O5,C.g,_.w,Z.v],styles:[".footer[_ngcontent-%COMP%] {\n    \n    \n    margin-right: 1px;\n    margin-bottom: 2.8%;\n    clear: both;\n    padding-top: 20px;\n    border-top: 1px solid #eaeaea;\n    border-left: 1px solid #eaeaea;\n    border-right: 1px solid #eaeaea;\n    background-color: #fff;\n  }\n\n  .green[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #26ef01;\n    border-radius: 50%;\n  }\n\n  .red[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #ff4141;\n    border-radius: 50%;\n  }\n\n  .yellow[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: yellow;\n    border-radius: 50%;\n  }\n\n  .brown[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #9602c7;\n    border-radius: 50%;\n  }\n\n  .label-color[_ngcontent-%COMP%]{\n    font-size: 14px;\n    width: 18%;\n    margin-left: 1%;\n  }\n\n\n  .foreign-currency[_ngcontent-%COMP%]{\n    width: 14.25%; \n    font-style: italic; \n    color:#021691;\n  }\n\n  .total-details[_ngcontent-%COMP%] {\n   padding-right: 0px;\n  display: flex;\n  flex-wrap: nowrap;\n  overflow-x: auto;\n  padding: 0 1rem; \n  justify-content:space-between;\n\n}\n\n.detail-item[_ngcontent-%COMP%] {\n  flex: 0 0 auto;\n  margin: 0.5rem;\n  min-width: 100px; \n\n}\n\n.detail-item[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%] {\n  margin: 0;\n}\n\n\n@media (max-width: 768px) {\n  .detail-item[_ngcontent-%COMP%] {\n    min-width: 120px; \n  }\n}"]}),Q})()},29242:(ve,ce,b)=>{b.d(ce,{$x:()=>S,LD:()=>k,LX:()=>Z,_f:()=>_,_n:()=>$,gQ:()=>C,jT:()=>H,q7:()=>J,qU:()=>ee,rb:()=>X});var e=b(26215);const ee=16777215,$="bmp",S=0,J=.7,C=4,_=4,Z=1500,k=8e3,X="eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImV4cCI6MjE0NzQ4MzY0NywiaWF0IjoxNTYwOTUwMjcyLCJyaWdodHMiOlsiU0lHX1NES19DT1JFIiwiU0lHQ0FQVFhfQUNDRVNTIl0sImRldmljZXMiOlsiV0FDT01fQU5ZIl0sInR5cGUiOiJwcm9kIiwibGljX25hbWUiOiJTaWduYXR1cmUgU0RLIiwid2Fjb21faWQiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImxpY191aWQiOiJiODUyM2ViYi0xOGI3LTQ3OGEtYTlkZS04NDlmZTIyNmIwMDIiLCJhcHBzX3dpbmRvd3MiOltdLCJhcHBzX2lvcyI6W10sImFwcHNfYW5kcm9pZCI6W10sIm1hY2hpbmVfaWRzIjpbXX0.ONy3iYQ7lC6rQhou7rz4iJT_OJ20087gWz7GtCgYX3uNtKjmnEaNuP3QkjgxOK_vgOrTdwzD-nm-ysiTDs2GcPlOdUPErSp_bcX8kFBZVmGLyJtmeInAW6HuSp2-57ngoGFivTH_l1kkQ1KMvzDKHJbRglsPpd4nVHhx9WkvqczXyogldygvl0LRidyPOsS5H2GYmaPiyIp9In6meqeNQ1n9zkxSHo7B11mp_WXJXl0k1pek7py8XYCedCNW5qnLi4UCNlfTd6Mk9qz31arsiWsesPeR9PN121LBJtiPi023yQU8mgb9piw_a-ccciviJuNsEuRDN3sGnqONG3dMSA";class H{constructor(){this.fullName="",this.reason="document Approval",this.date="",this.eventSubject=new e.X(""),this.imageString$=this.eventSubject.asObservable(),this.setHTMLTags()}emitValue(y){this.eventSubject.next(y)}getImageString$(){return this.eventSubject.pipe(y=>y)}setHTMLTags(){this.btnRestore=document.getElementById("restore"),this.checkBoxUseB64=document.getElementById("chkUseB64Image"),this.checkShowSigtext=document.getElementById("chkShowSigText"),this.firstName=document.getElementById("fname"),this.imageBox=document.getElementById("imageBox"),this.lastName=document.getElementById("lname"),this.textSig=document.getElementById("txtSignature"),this.txtDisplay=document.getElementById("txtDisplay"),console.log({imageid:[this.imageBox,this.btnRestore,this.checkBoxUseB64,this.firstName,this.lastName]})}}},5881:(ve,ce,b)=>{b.r(ce),b.d(ce,{SessionControl:()=>ee});var e=b(29242),t=b(46241);const O={map:{},counter:0,getJSON:function($,S,J){var C=$+($.indexOf("?")+1?"&":"?"),_=document.getElementsByTagName("head")[0],Z=document.createElement("script"),k=[],X="",H="json-"+this.counter;for(X in this.counter++,S.script_name=H,S._rand=Math.random(),this.map[H]=J,S.callback="JSONreq.success",S)k.push(X+"="+encodeURIComponent(S[X]));C+=k.join("&"),Z.type="text/javascript",Z.src=C,Z.id=H,_.appendChild(Z)},success:function($){var S=$.script_name;delete $.script_name,this.map[S]($);var J=document.getElementsByTagName("head")[0],C=document.getElementById(S);J.removeChild(C),delete this.map.script_name}};class M{constructor(S,J){Sr(this,"_onDetectRunning"),Sr(this,"service_port"),this._onDetectRunning=S,this.service_port=J,this.running=!1,this.session=null,this.service_detected=!1;let C=this;window.sdkPtr=C;var _="https://localhost:";function Z(y){0==y.status?(C.session=y.session,C.running=!0,S(),setTimeout(C.keepAlive,2e3)):console.log("Signature SDK local server error: "+y.status)}function k(y){0==y.status?(C.service_detected=!0,O.getJSON((_+=y.port+"/")+"wacom.js",{CreateSession:1},Z)):console.log("Signature SDK Service error: "+y.status)}function j(y){return typeof y>"u"||null==y?"":y}this.RBFlags={RenderOutputPicture:2097152,RenderOutputBase64:8192,RenderBackgroundTransparent:65536,RenderColor1BPP:131072,RenderColor24BPP:262144,RenderColor32BPP:524288,RenderColorAntiAlias:1048576,RenderEncodeData:4194304,RenderWatermark:8388608,RenderClipped:16777216,RenderRelative:33554432},this.IntegrityStatus={IntegrityOK:0,IntegrityFail:1,IntegrityMissing:2,IntegrityWrongType:3,IntegrityInsufficientData:4,IntegrityUncertain:5,IntegrityUnsupported:6},this.HashType={HashNone:0,HashMD5:1,HashSHA1:2,HashSHA224:3,HashSHA256:4,HashSHA384:5,HashSHA512:6},this.KeyType={KeyNone:0,KeyMD5:1,KeyMD5MAC:2,KeySHA1:3,KeySHA224:4,KeySHA256:5,KeySHA384:6,KeySHA512:7,KeyCAPICOM:8},this.SignedData={DataGood:0,DataNoHash:1,DataBadType:2,DataBadHash:3,DataError:4,DataUncertain:5,DataSigMoved:6},this.CaptData={CaptDigitizer:26,CaptDigitizerDriver:27,CaptMachineOS:28,CaptNetworkCard:29},this.DynamicCaptureResult={DynCaptOK:0,DynCaptCancel:1,DynCaptPadError:100,DynCaptError:101,DynCaptNotLicensed:103,DynCaptAbort:200,DynCaptIntegrityKeyInvalid:102},this.TimeZone={TimeLocal:0,TimeGMT:1,TimeUTC:1},this.DisplayMode={DspForceFit:0,DspUseZoom:1,DspBestFit:2},this.ShowText={TxtDontShow:0,TxtShowLeft:1,TxtShowCenter:2,TxtShowRight:4},this.ObjectType={ObjectText:0,ObjectButton:1,ObjectCheckbox:2,ObjectSignature:3,ObjectInput:4,ObjectInputEcho:5,ObjectHash:6,ObjectImage:7,ObjectDisplayAtShutdown:8,ObjectInking:9,ObjectRadioButton:10},this.TextOptions={TextAlignLeft:0,TextAlignRight:1,TextAlignCentre:2,TextAlignJustify:3},this.ButtonOptions={BtnAlignCentre:0,BtnAlignMiddle:0,BtnAlignLeft:1,BtnAlignRight:2,BtnAlignTop:4,BtnAlignBottom:8},this.CheckBoxOptions={CheckboxUnchecked:0,CheckboxChecked:1,CheckboxDisplayTick:2,CheckboxDisplayCross:4},this.ObjectOptionType={OBJECTOPTION_STRING:0,OBJECTOPTION_INT:1,OBJECTOPTION_BOOL:2},this.VariantType={VARIANT_EMPTY:0,VARIANT_TEXT:1,VARIANT_NUM:2,VARIANT_OBJECTOPTIONS:3,VARIANT_SIGOBJ:4,VARIANT_SIGCTL:5,VARIANT_INPUTOBJ:6,VARIANT_HASH:7,VARIANT_IMGURL:8,VARIANT_BASE64:9,VARIANT_DYNCAP:10,VARIANT_WIZCTL:11,VARIANT_FONT:12,VARIANT_KEY:13},this.PrimitiveType={PrimitiveLine:0,PrimitiveRectangle:1,PrimitiveEllipse:2},this.PrimitiveOptions={PrimitiveLineSolid:1,PrimitiveLineDashed:2,PrimitiveOutline:4,PrimitiveFill:8,PrimitiveFillXOR:16},this.EventType={EvTextClicked:0,EvButtonClicked:1,EvCheckboxChecked:2,EvCheckboxUnchecked:3,EvInputMinReached:4,EvInputMaxReached:5,EvInputExceeded:6},this.EncryptAlg={EncryptNone:0,EncryptTripleDES:1},this.ResponseStatus={OK:0,FAILED:1,INVALID_SESSION:3},this.FontWeight={FW_DONTCARE:0,FW_THIN:100,FW_EXTRALIGHT:200,FW_LIGHT:300,FW_NORMAL:400,FW_MEDIUM:500,FW_SEMIBOLD:600,FW_BOLD:700,FW_EXTRABOLD:800,FW_HEAVY:900,FW_ULTRALIGHT:200,FW_REGULAR:400,FW_DEMIBOLD:600,FW_ULTRABOLD:800,FW_BLACK:900},this.FontCharset={ANSI_CHARSET:0,DEFAULT_CHARSET:1,SYMBOL_CHARSET:2,SHIFTJIS_CHARSET:128,HANGEUL_CHARSET:129,HANGUL_CHARSET:129,GB2312_CHARSET:134,CHINESEBIG5_CHARSET:136,OEM_CHARSET:255,JOHAB_CHARSET:130,HEBREW_CHARSET:177,ARABIC_CHARSET:178,GREEK_CHARSET:161,TURKISH_CHARSET:162,VIETNAMESE_CHARSET:163,THAI_CHARSET:222,EASTEUROPE_CHARSET:238,RUSSIAN_CHARSET:204,MAC_CHARSET:77,BALTIC_CHARSET:186,FS_LATIN1:1,FS_LATIN2:2,FS_CYRILLIC:4,FS_GREEK:8,FS_TURKISH:16,FS_HEBREW:32,FS_ARABIC:64,FS_BALTIC:128,FS_VIETNAMESE:256,FS_THAI:65536,FS_JISJAPAN:131072,FS_CHINESESIMP:262144,FS_WANSUNG:524288,FS_CHINESETRAD:1048576,FS_JOHAB:2097152,FS_SYMBOL:2147483648},this.Font=function(y,f,L,x,m,I,P){this.type=C.VariantType.VARIANT_FONT,this.fontName=typeof y>"u"?"Arial":y,this.fontSize=typeof f>"u"?8:f,this.sWeight=typeof L>"u"?C.FontWeight.FW_NORMAL:L,this.sCharset=typeof x>"u"?C.FontCharset.ANSI_CHARSET:x,this.fItalic=typeof fItalic>"u"?0:fItalic,this.fUnderline=typeof I>"u"?0:fUnderline,this.fStrikethrough=typeof P>"u"?0:P},this.keepAlive=function(){O.getJSON(_+"wacom.js",{session:C.session,KeepAlive:1},function(){}),setTimeout(C.keepAlive,2e3)},window.addEventListener("unload",function(y){!function X(){if(0!=C.session){var y=_+"wacom.js?DestroySession=1&session="+C.session;if(C.session=0,null!=self.Navigator.sendBeacon)self.Navigator.sendBeacon(y);else{var f=new XMLHttpRequest;f.open("GET",y,!1),f.send(null)}}}()}),function H(){O.getJSON(_+J+"/wacom.js",{GetPort:1},k)}(),this.getVersion=function(y){O.getJSON(_+"wacom.js",{GetVersion:1,session:C.session},function L(x){y(x.version,parseInt(x.status))})},this.Hash=function(y){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_HASH,O.getJSON(_+"wacom.js",{Hash:"Constructor",session:C.session},function x(m){f.handle=m.handle,y(f,parseInt(m.status))}),this.Add=function(m,I){var P={Hash:"Add",session:C.session,handle:f.handle};m.Stringify(P,"hData"),O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.Clear=function(m){O.getJSON(_+"wacom.js",{Hash:"Clear",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.status))})},this.GetType=function(m){O.getJSON(_+"wacom.js",{Hash:"GetType",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.hashType),parseInt(w.status))})},this.PutType=function(m,I){var P={Hash:"PutType",session:C.session,handle:f.handle,type:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})}},this.Key=function(y){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_KEY,O.getJSON(_+"wacom.js",{Key:"Constructor",session:C.session},function x(m){f.handle=m.handle,y(f,parseInt(m.status))}),this.GetType=function(m){O.getJSON(_+"wacom.js",{Key:"GetType",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.type),parseInt(w.status))})},this.Set=function(m,I,P){var w={Key:"Set",session:C.session,handle:f.handle,type:j(m)};I.Stringify(w,"value"),O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})}},this.Bitmap=function(){this.handle=null,this.isBase64=!1,this.mime_type=null,this.image=new Image},this.SigObj=function(){var y=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGOBJ,this.CheckIntegrity=function(f,L){var x={SigObj:"CheckIntegrity",session:C.session,handle:y.handle},m=new C.Variant;m.Set(f),m.Stringify(x,"key"),O.getJSON(_+"wacom.js",x,function I(P){L(y,parseInt(P.status))})},this.CheckSignedData=function(f,L){var x={SigObj:"CheckSignedData",session:C.session,handle:y.handle,HashHandle:j(f.handle)};O.getJSON(_+"wacom.js",x,function m(I){L(y,parseInt(I.status))})},this.Clear=function(f){O.getJSON(_+"wacom.js",{SigObj:"Clear",session:C.session,handle:y.handle},function x(m){f(y,parseInt(m.status))})},this.GetAdditionalData=function(f,L){var x={SigObj:"GetAdditionalData",session:C.session,handle:y.handle,captData:j(f)};O.getJSON(_+"wacom.js",x,function m(I){L(y,I.additionalData,parseInt(I.status))})},this.GetCrossedOut=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetCrossedOut",session:C.session,handle:y.handle},function x(m){f(y,Boolean(1==parseInt(m.crossedOut)),parseInt(m.status))})},this.GetExtraData=function(f,L){var x={SigObj:"GetExtraData",session:C.session,handle:y.handle,key:j(f)};O.getJSON(_+"wacom.js",x,function m(I){L(y,I.extraData,parseInt(I.status))})},this.GetHeight=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetHeight",session:C.session,handle:y.handle},function x(m){f(y,parseInt(m.height),parseInt(m.status))})},this.GetInk=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetInk",session:C.session,handle:y.handle},function x(m){f(y,m.ink,parseInt(m.status))})},this.GetIsCaptured=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetIsCaptured",session:C.session,handle:y.handle},function x(m){f(y,Boolean(1==parseInt(m.isCaptured)),parseInt(m.status))})},this.GetProperty=function(f,L){var x={SigObj:"GetProperty",session:C.session,handle:y.handle,key:j(f)};O.getJSON(_+"wacom.js",x,function m(I){var P=new C.Variant;P.Parse(I,"property"),L(y,P,parseInt(I.status))})},this.GetSigData=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetSigData",session:C.session,handle:y.handle},function x(m){var I=new C.Variant;I.Parse(m,"sigData"),f(y,I,parseInt(m.status))})},this.GetSigText=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetSigText",session:C.session,handle:y.handle},function x(m){f(y,m.sigText,parseInt(m.status))})},this.GetWhen=function(f,L){var x={SigObj:"GetWhen",session:C.session,handle:y.handle,timeZone:j(f)};O.getJSON(_+"wacom.js",x,function m(I){var P=new Date(parseFloat(I.year),parseFloat(I.month)-1,parseFloat(I.day),parseFloat(I.hour),parseFloat(I.minute),parseFloat(I.second));P.dayOfWeek=parseFloat(I.dayOfWeek),L(y,P,parseInt(I.status))})},this.GetWho=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetWho",session:C.session,handle:y.handle},function x(m){f(y,m.who,parseInt(m.status))})},this.GetWhy=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetWhy",session:C.session,handle:y.handle},function x(m){f(y,m.why,parseInt(m.status))})},this.GetWidth=function(f){O.getJSON(_+"wacom.js",{SigObj:"GetWidth",session:C.session,handle:y.handle},function x(m){f(y,parseInt(m.width),parseInt(m.status))})},this.PutExtraData=function(f,L,x){var m={SigObj:"PutExtraData",session:C.session,handle:y.handle,key:j(f),value:j(L)};O.getJSON(_+"wacom.js",m,function I(P){x(y,parseInt(P.status))})},this.PutInk=function(f,L){var x={SigObj:"PutInk",session:C.session,handle:y.handle,ink:j(f)};O.getJSON(_+"wacom.js",x,function m(I){L(y,parseInt(I.status))})},this.PutSigData=function(f,L){var x={SigObj:"PutSigData",session:C.session,handle:y.handle};f.Stringify(x,"sigData"),O.getJSON(_+"wacom.js",x,function m(I){L(y,parseInt(I.status))})},this.PutSigText=function(f,L){var x={SigObj:"PutSigText",session:C.session,handle:y.handle,sigText:j(f)};O.getJSON(_+"wacom.js",x,function m(I){L(y,parseInt(I.status))})},this.ReadEncodedBitmap=function(f,L){var x={SigObj:"ReadEncodedBitmap",session:C.session,handle:y.handle},m=new C.Variant;m.type=C.VariantType.VARIANT_IMGURL,m.url=f,m.Stringify(x,"bitmapURL"),O.getJSON(_+"wacom.js",x,function I(P){L(y,parseInt(P.status))})},this.RenderBitmap=function(f,L,x,m,I,P,w,Q,U,B){var q={SigObj:"RenderBitmap",session:C.session,handle:y.handle,mimetype:j(f),width:j(L),height:j(x),ink_width:j(m),ink_color:j(I),bg_color:j(P),flags:j(w),paddingX:j(Q),paddingY:j(U)};O.getJSON(_+"wacom.js",q,function W(re){var ae=parseInt(re.status);if(0==ae)if(w&C.RBFlags.RenderOutputPicture){var Me=new C.Bitmap;Me.handle=re.bitmapHandle,Me.isBase64=1==re.isBase64,Me.image.onload=function(){B(y,Me,ae)},Me.image.src=Me.isBase64?"data:image/"+f+";base64,"+re.base64:_+re.bitmapHandle+"?session="+C.session}else 1==re.isBase64&&B(y,re.base64,ae);else B(y,null,ae)})},this.SetProperty=function(f,L,x){var m={SigObj:"SetProperty",session:C.session,handle:y.handle,key:j(f)};L.Stringify(m,"value"),O.getJSON(_+"wacom.js",m,function I(P){x(y,parseInt(P.status))})}},this.DynamicCapture=function(y){var f=this;this.handle=null,O.getJSON(_+"wacom.js",{DynamicCapture:"Constructor",session:C.session},function x(m){f.handle=m.handle,y(f,parseInt(m.status))}),this.Capture=function(m,I,P,w,Q,U){var B=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,q=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,W=window.screenLeft?window.screenLeft:window.screenX,re=window.screenTop?window.screenTop:window.screenY,ae={DynamicCapture:"Capture",session:C.session,who:j(I),why:j(P),width:j(B),height:j(q),left:j(W),top:j(re),SigCtlHandle:j(m.handle),handle:f.handle},Me=new C.Variant;Me.Set(w),Me.Stringify(ae,"what");var G=new C.Variant;G.Set(Q),G.Stringify(ae,"key"),O.getJSON(_+"wacom.js",ae,function Y(z){var K=new C.SigObj;K.handle=z.handle,U(f,K,parseInt(z.status))})},this.GetLicence=function(m){O.getJSON(_+"wacom.js",{DynamicCapture:"GetLicence",session:C.session,handle:f.handle},function P(w){m(f,w.licence,parseInt(w.status))})},this.GetProperty=function(m,I){var P={DynamicCapture:"GetProperty",session:C.session,handle:f.handle,key:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){var U=new C.Variant;U.Parse(Q,"property"),I(f,U,parseInt(Q.status))})},this.PutLicence=function(m,I){var P={DynamicCapture:"PutLicence",session:C.session,handle:f.handle,licence:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.SetProperty=function(m,I,P){var w={DynamicCapture:"SetProperty",session:C.session,handle:f.handle,key:j(m)};I.Stringify(w,"value"),O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})}},this.SigCtl=function(y){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGCTL,O.getJSON(_+"wacom.js",{SigCtl:"Constructor",session:C.session},function x(m){f.handle=m.handle,y(f,parseInt(m.status))}),this.AboutBox=function(m){var I=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,P=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,w=window.screenLeft?window.screenLeft:window.screenX,Q=window.screenTop?window.screenTop:window.screenY,U={SigCtl:"AboutBox",session:C.session,width:j(I),height:j(P),left:j(w),top:j(Q),handle:f.handle};O.getJSON(_+"wacom.js",U,function B(q){m(f,parseInt(q.status))})},this.GetAppData=function(m,I){var P={SigCtl:"GetAppData",session:C.session,handle:f.handle,key:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){var U=new C.Variant;U.Parse(Q,"appData"),I(f,U,parseInt(Q.status))})},this.GetInputData=function(m){O.getJSON(_+"wacom.js",{SigCtl:"GetInputData",session:C.session,handle:f.handle},function P(w){m(f,w.inputData,parseInt(w.status))})},this.GetLicence=function(m){O.getJSON(_+"wacom.js",{SigCtl:"GetLicence",session:C.session,handle:f.handle},function P(w){m(f,w.licence,parseInt(w.status))})},this.GetProperty=function(m,I){var P={SigCtl:"GetProperty",session:C.session,handle:f.handle,key:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){var U=new C.Variant;U.Parse(Q,"property"),I(f,U,parseInt(Q.status))})},this.GetSignature=function(m){O.getJSON(_+"wacom.js",{SigCtl:"GetSignature",session:C.session,handle:f.handle},function P(w){var Q=new C.SigObj;Q.handle=w.signatureHandle,m(f,Q,parseInt(w.status))})},this.PutAppData=function(m,I,P){var w={SigCtl:"PutAppData",session:C.session,handle:f.handle,key:j(m)};I.Stringify(w,"val"),O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})},this.PutInputData=function(m,I){var P={SigCtl:"PutInputData",session:C.session,handle:f.handle,inputData:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.PutLicence=function(m,I){var P={SigCtl:"PutLicence",session:C.session,handle:f.handle,licence:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.PutProperties=function(m,I){var P={SigCtl:"PutProperties",session:C.session,handle:f.handle,properties:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.PutSignature=function(m,I){var P={SigCtl:"PutSignature",session:C.session,handle:f.handle,signatureHandle:j(m.handle)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.SetProperty=function(m,I,P){var w={SigCtl:"SetProperty",session:C.session,handle:f.handle,key:j(m)};I.Stringify(w,"value"),O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})}},this.InputObj=function(y){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_INPUTOBJ,O.getJSON(_+"wacom.js",{InputObj:"Constructor",session:C.session},function x(m){f.handle=m.handle,y(f,parseInt(m.status))}),this.Clear=function(m){O.getJSON(_+"wacom.js",{InputObj:"Clear",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.status))})},this.GetData=function(m){O.getJSON(_+"wacom.js",{InputObj:"GetData",session:C.session,handle:f.handle},function P(w){m(f,w.data,parseInt(w.status))})},this.GetEncryptionType=function(m){O.getJSON(_+"wacom.js",{InputObj:"GetEncryptionType",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.encryptionType),parseInt(w.status))})},this.GetMaxLength=function(m){O.getJSON(_+"wacom.js",{InputObj:"GetMaxLength",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.maxLength),parseInt(w.status))})},this.GetMinLength=function(m){O.getJSON(_+"wacom.js",{InputObj:"GetMinLength",session:C.session,handle:f.handle},function P(w){m(f,parseInt(w.minLength),parseInt(w.status))})},this.GetProperty=function(m,I){var P={InputObj:"GetProperty",session:C.session,handle:f.handle,name:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){(new C.Variant).Parse(Q,"property"),I(f,Q.property,parseInt(Q.status))})},this.GetText=function(m){O.getJSON(_+"wacom.js",{InputObj:"GetText",session:C.session,handle:f.handle},function P(w){m(f,w.text,parseInt(w.status))})},this.PutMaxLength=function(m,I){var P={InputObj:"PutMaxLength",session:C.session,handle:f.handle,maxLength:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.PutMinLength=function(m,I){var P={InputObj:"PutMinLength",session:C.session,handle:f.handle,minLength:j(m)};O.getJSON(_+"wacom.js",P,function w(Q){I(f,parseInt(Q.status))})},this.SetEncryption=function(m,I,P){var w={InputObj:"SetEncryption",session:C.session,handle:f.handle,type:j(m)};I.Stringify(w,"key"),O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})},this.SetProperty=function(m,I,P){var w={InputObj:"SetProperty",session:C.session,handle:f.handle,name:j(m),value:j(I)};O.getJSON(_+"wacom.js",w,function Q(U){P(f,parseInt(U.status))})}},this.ObjectOptions=function(){var y=this;this.type=C.VariantType.VARIANT_OBJECTOPTIONS,this.AddOption=function(f,L){y[f]=L}},this.Variant=function(){var y=this;this.type=C.VariantType.VARIANT_EMPTY,this.Parse=function(f,L){var x=parseInt(f[L+".type"]);switch(x){case C.VariantType.VARIANT_TEXT:y.type=x,y.text=f[L+".text"];break;case C.VariantType.VARIANT_NUM:y.type=x,y.num=parseFloat(f[L+".num"]);break;case C.VariantType.VARIANT_OBJECTOPTIONS:y.type=x;break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:y.type=x,y.handle=f[L+".handle"];break;case C.VariantType.VARIANT_BASE64:y.type=x,y.base64=f[L+".base64"];break;case C.VariantType.VARIANT_IMGURL:y.type=x,y.url=f[L+".url"];break;case C.VariantType.VARIANT_FONT:y.type=x,y.fontName=f[L+".fontName"],y.fontSize=f[L+".fontSize"],y.sWeight=f[L+".sWeight"],y.sCharset=f[L+".sCharset"],y.fItalic=f[L+".fItalic"],y.fUnderline=f[L+".fUnderline"],y.fStrikethrough=f[L+".fStrikethrough"];break;default:y.type=C.VariantType.VARIANT_EMPTY}},this.Set=function(f){if("string"==typeof f)y.type=C.VariantType.VARIANT_TEXT,y.text=f;else if("number"==typeof f)y.type=C.VariantType.VARIANT_NUM,y.num=f;else if(null!=f&&"object"==typeof f&&typeof f.type<"u"&&null!=f.type)switch(f.type){case C.VariantType.VARIANT_OBJECTOPTIONS:for(o in y.type=C.VariantType.VARIANT_OBJECTOPTIONS,f)"type"!=o&&("string"==typeof f[o]?(y[o]=f[o],y[o+".type"]=C.ObjectOptionType.OBJECTOPTION_STRING):"number"==typeof f[o]?(y[o]=f[o]>0?Math.floor(f[o]):Math.ceil(f[o]),y[o+".type"]=C.ObjectOptionType.OBJECTOPTION_INT):"boolean"==typeof f[o]&&(y[o]=1==f[o]?1:0,y[o+".type"]=C.ObjectOptionType.OBJECTOPTION_BOOL));break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:y.type=f.type,y.handle=f.handle;break;case C.VariantType.VARIANT_IMGURL:y.type=C.VariantType.VARIANT_IMGURL,y.url=f.url;break;case C.VariantType.VARIANT_BASE64:y.type=C.VariantType.VARIANT_BASE64,y.base64=f.base64;break;case C.VariantType.VARIANT_FONT:y.type=C.VariantType.VARIANT_FONT,y.fontName=f.fontName,y.fontSize=f.fontSize,y.sWeight=f.sWeight,y.sCharset=f.sCharset,y.fItalic=f.fItalic,y.fUnderline=f.fUnderline,y.fStrikethrough=f.fStrikethrough;break;case C.VariantType.VARIANT_TEXT:y.type=f.type,y.text=f.text;break;case C.VariantType.VARIANT_NUM:y.type=f.type,y.num=f.num;break;default:y.type=C.VariantType.VARIANT_EMPTY}},this.Stringify=function(f,L){for(var x in y)"string"==typeof x&&"function"!=typeof y[x]&&"symbol"!=typeof y[x]&&("object"==typeof y[x]||"string"==typeof y[x]||"number"==typeof y[x])&&(f[L+"."+x]=y[x.toString()])}},this.WizCtl=function(y){var f=this;this.handle=null;var Q,L=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,x=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,m=window.screenLeft?window.screenLeft:window.screenX,I=window.screenTop?window.screenTop:window.screenY;O.getJSON(_+"wacom.js",{WizCtl:"Constructor",session:C.session,width:L,height:x,left:m,top:I},function w(U){f.handle=U.handle,y(f,parseInt(U.status))}),this.AddObject=function(U,B,q,W,re,ae,Me){var G={WizCtl:"AddObject",session:C.session,handle:f.handle,objType:j(U),id:j(B)},Y=new C.Variant,z=new C.Variant;Y.Set(q),z.Set(W),Y.Stringify(G,"X"),z.Stringify(G,"Y"),re.Stringify(G,"objData"),ae.Stringify(G,"options"),O.getJSON(_+"wacom.js",G,function K(oe){Me(f,parseInt(oe.status))})},this.AddPrimitive=function(U,B,q,W,re,ae,Me,G){var Y={WizCtl:"AddPrimitive",session:C.session,handle:f.handle,primType:j(U)},z=new C.Variant,K=new C.Variant,oe=new C.Variant,me=new C.Variant;z.Set(B),K.Set(q),oe.Set(W),me.Set(re),z.Stringify(Y,"X1"),K.Stringify(Y,"Y1"),oe.Stringify(Y,"X2"),me.Stringify(Y,"Y2"),ae.Stringify(Y,"primData"),Me.Stringify(Y,"options"),O.getJSON(_+"wacom.js",Y,function Ne(Ze){G(f,parseInt(Ze.status))})},this.Close=function(U){O.getJSON(_+"wacom.js",{WizCtl:"Close",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.status))})},this.Display=function(U){O.getJSON(_+"wacom.js",{WizCtl:"Display",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.status))})},this.FireClick=function(U,B){O.getJSON(_+"wacom.js",{WizCtl:"FireClick",session:C.session,handle:f.handle,fireClickId:U},function W(re){B(f,parseInt(re.status))})},this.GetBackColor=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetBackColor",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.backColor),parseInt(W.status))})},this.GetBorderColor=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetBorderColor",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.borderColor),parseInt(W.status))})},this.GetBorderStyle=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetBorderStyle",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.borderStyle),parseInt(W.status))})},this.GetBorderVisible=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetBorderVisible",session:C.session,handle:f.handle},function q(W){U(f,Boolean(1==parseInt(W.borderVisible)),parseInt(W.status))})},this.GetBorderWidth=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetBorderWidth",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.borderWidth),parseInt(W.status))})},this.GetEnableWizardDisplay=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetEnableWizardDisplay",session:C.session,handle:f.handle},function q(W){U(f,Boolean(1==parseInt(W.enableWD)),parseInt(W.status))})},this.GetFont=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetFont",session:C.session,handle:f.handle},function q(W){var re=new C.Variant;re.Parse(W,"font"),U(f,re,parseInt(W.status))})},this.GetInkingPad=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetInkingPad",session:C.session,handle:f.handle},function q(W){U(f,Boolean(1==parseInt(W.inkingPad)),parseInt(W.status))})},this.GetLicence=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetLicence",session:C.session,handle:f.handle},function q(W){U(f,W.licence,parseInt(W.status))})},this.GetObjectState=function(U,B){var q={WizCtl:"GetObjectState",session:C.session,handle:f.handle,objectId:j(U)};O.getJSON(_+"wacom.js",q,function W(re){var ae=new C.Variant;ae.Parse(re,"objState"),B(f,ae,parseInt(re.status))})},this.GetPadHeight=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetPadHeight",session:C.session,handle:f.handle},function q(W){U(f,parseFloat(W.height),parseInt(W.status))})},this.GetPadWidth=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetPadWidth",session:C.session,handle:f.handle},function q(W){U(f,parseFloat(W.width),parseInt(W.status))})},this.GetProperty=function(U,B){var q={WizCtl:"GetProperty",session:C.session,handle:f.handle,key:j(U)};O.getJSON(_+"wacom.js",q,function W(re){var ae=new C.Variant;ae.Parse(re,"property"),B(f,ae,parseInt(re.status))})},this.GetVisibleWindow=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetVisibleWindow",session:C.session,handle:f.handle},function q(W){U(f,Boolean(1==parseInt(W.visible)),parseInt(W.status))})},this.GetZoom=function(U){O.getJSON(_+"wacom.js",{WizCtl:"GetZoom",session:C.session,handle:f.handle},function q(W){U(f,parseFloat(W.zoom),parseInt(W.status))})},this.PadConnect=function(U){O.getJSON(_+"wacom.js",{WizCtl:"PadConnect",session:C.session,handle:f.handle},function q(W){U(f,Boolean(1==parseInt(W.padConnect)),parseInt(W.status))})},this.PadDisconnect=function(U){O.getJSON(_+"wacom.js",{WizCtl:"PadDisconnect",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.status))})},this.PutBackColor=function(U,B){var q={WizCtl:"PutBackColor",session:C.session,handle:f.handle,backColor:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutBorderColor=function(U,B){var q={WizCtl:"PutBorderColor",session:C.session,handle:f.handle,borderColor:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutBorderStyle=function(U,B){var q={WizCtl:"PutBorderStyle",session:C.session,handle:f.handle,borderStyle:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutBorderVisible=function(U,B){var q={WizCtl:"PutBorderVisible",session:C.session,handle:f.handle,borderVisible:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutBorderWidth=function(U,B){var q={WizCtl:"PutBorderWidth",session:C.session,handle:f.handle,borderWidth:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutEnableWizardDisplay=function(U,B){var q={WizCtl:"PutEnableWizardDisplay",session:C.session,handle:f.handle,enableWD:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutFont=function(U,B){var q={WizCtl:"PutFont",session:C.session,handle:f.handle};U.Stringify(q,"font"),O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutLicence=function(U,B){var q={WizCtl:"PutLicence",session:C.session,handle:f.handle,licence:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutPadHeight=function(U,B){var q={WizCtl:"PutPadHeight",session:C.session,handle:f.handle,height:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutPadWidth=function(U,B){var q={WizCtl:"PutPadWidth",session:C.session,handle:f.handle,width:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutProperties=function(U,B){var q={WizCtl:"PutProperties",session:C.session,handle:f.handle,properties:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutRefFont=function(U,B){var q={WizCtl:"PutRefFont",session:C.session,handle:f.handle};U.Stringify(q,"font"),O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutVisibleWindow=function(U,B){var q={WizCtl:"PutVisibleWindow",session:C.session,handle:f.handle,visible:Number(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.PutZoom=function(U,B){var q={WizCtl:"PutZoom",session:C.session,handle:f.handle,zoom:j(U)};O.getJSON(_+"wacom.js",q,function W(re){B(f,parseInt(re.status))})},this.Reset=function(U){O.getJSON(_+"wacom.js",{WizCtl:"Reset",session:C.session,handle:f.handle},function q(W){U(f,parseInt(W.status))})},this.SetProperty=function(U,B,q){var W={WizCtl:"SetProperty",session:C.session,handle:f.handle,key:U};B.Stringify(W,"value"),O.getJSON(_+"wacom.js",W,function re(ae){q(f,parseInt(ae.status))})},this.SetEventHandler=function(U){Q=U,O.getJSON(_+"wacom.js",{WizCtl:"SetEventHandler",session:C.session,handle:f.handle},function q(W){var re={WizCtl:"UpdateEventHandler",session:C.session,handle:f.handle};if(0==parseInt(W.status))O.getJSON(_+"wacom.js",re,q);else if(typeof W.status>"u")return;setTimeout(function(){Q(f.handle,W["event-id"],parseInt(W["event-type"]),parseInt(W.status))},0)})}}}}class ee{static actionWhenRestarted(){t.SigCapture.sigCtl=null,t.SigCapture.dynCapt=null,null!=t.SigCapture.HTMLTagIds.imageBox.firstChild&&t.SigCapture.HTMLTagIds.imageBox.removeChild(t.SigCapture.HTMLTagIds.imageBox.firstChild),this.timeout=setTimeout(ee.timedDetect,e.LX),console.log({msg:"Starting up WacomGSS_SignatureSDK",timeout:this.timeout}),window.JSONreq=O;let S=new M(ee.onDetectRunning,e.LD);window.sdkPtr=S,console.log({window})}static timedDetect(){window.sdkPtr.running?(t.SigCapture.print("Signature SDK Service detected."),ee.start()):t.SigCapture.print("Signature SDK Service not detected.")}static onDetectRunning(){window.sdkPtr.running?(t.SigCapture.print("Signature SDK Service detected."),console.log({msg:"signature sdk service detected"}),t.SigCapture.print("Starting..."),ee.start()):t.SigCapture.print("Signature SDK Service not detected.")}static start(){window.sdkPtr.running&&(t.SigCapture.print("Checking components ..."),t.SigCapture.sigCtl=new window.sdkPtr.SigCtl(ee.onSigCtlConstructor))}static onSigCtlConstructor(S,J){t.SigCapture.callbackStatusOK("SigCtl Constructor",J)&&S.PutLicence(e.rb,ee.onSigCtlPutLicence)}static onDynCaptConstructor(S,J){t.SigCapture.callbackStatusOK("DynCapt Constructor",J)&&t.SigCapture.sigCtl.GetSignature(ee.onGetSignature)}static onSigCtlPutLicence(S,J){t.SigCapture.callbackStatusOK("SigCtl PutLicence",J)&&(t.SigCapture.dynCapt=new window.sdkPtr.DynamicCapture(ee.onDynCaptConstructor))}static onGetSignature(S,J,C){t.SigCapture.callbackStatusOK("SigCapt GetSignature",C)&&S.GetProperty("Component_FileVersion",ee.onSigCtlGetFileVersion)}static onGetSigCaptXVersion(S,J){t.SigCapture.callbackStatusOK("SigCaptX GetVersion",J)&&(t.SigCapture.print("SigCaptX  v"+S),t.SigCapture.sigCtl.GetProperty("Component_FileVersion",ee.onSigCtlGetFileVersion))}static onSigCtlGetFileVersion(S,J,C){t.SigCapture.callbackStatusOK("SigCtl GetProperty",C)&&(t.SigCapture.print("DLL: flSigCOM.dll  v"+J.text),t.SigCapture.dynCapt.GetProperty("Component_FileVersion",ee.onDynCaptGetFileVersion))}static onDynCaptGetFileVersion(S,J,C){t.SigCapture.callbackStatusOK("DynCapt GetProperty",C)&&(t.SigCapture.print("DLL: flSigCapt.dll v"+J.text),t.SigCapture.print("Test application ready."),t.SigCapture.print("Press 'Capture' to capture a signature."))}}},46241:(ve,ce,b)=>{b.r(ce),b.d(ce,{SigCapture:()=>M});var e=b(29242),t=b(5881),O=b(64537);class M{constructor(){this.reason=""}ngAfterViewInit(){M.HTMLTagIds=new e.jT}capturesig(){this.reason.length>0&&(M.HTMLTagIds.reason=this.reason),null!=M.HTMLTagIds?.imageBox?.firstChild&&M.HTMLTagIds.imageBox.removeChild(M.HTMLTagIds.imageBox.firstChild),window.sdkPtr.running?M.Capture():t.SessionControl.actionWhenRestarted()}static print($){}static callbackStatusOK($,S){return window.sdkPtr.ResponseStatus.OK===S||(M.print($+" error: "+S),!1)}static Capture(){M.hash=new window.sdkPtr.Hash(M.onHashConstructor)}static onHashConstructor($,S){window.sdkPtr.ResponseStatus.OK==S?M.GetHash($,M.onGetInitialHash):(M.print("Hash Constructor error: "+S),window.sdkPtr.ResponseStatus.INVALID_SESSION==S&&(M.print("Error: invalid session. Restarting the session."),t.SessionControl.actionWhenRestarted()))}}M.HTMLTagIds=new e.jT,M.onGetInitialHash=()=>{M.HTMLTagIds.fullName=M.HTMLTagIds.firstName.value;var $=M.HTMLTagIds.fullName,S=M.HTMLTagIds.reason;console.log({fullName:$,reason:S}),M.dynCapt.Capture(M.sigCtl,$,S,M.hash,null,M.onDynCaptCapture)},M.onDynCaptCapture=(ee,$,S)=>{if(window.sdkPtr.ResponseStatus.INVALID_SESSION==S)M.print("Error: invalid session. Restarting the session."),t.SessionControl.actionWhenRestarted();else switch(S){case window.sdkPtr.DynamicCaptureResult.DynCaptOK:M.sigObj=$,M.print("Signature captured successfully");var J=window.sdkPtr.RBFlags.RenderOutputBase64|window.sdkPtr.RBFlags.RenderColor32BPP;$.RenderBitmap(e._n,M.HTMLTagIds.imageBox.clientWidth,M.HTMLTagIds.imageBox.clientHeight,e.q7,e.$x,e.qU,J,e.gQ,e._f,M.onRenderBitmap);break;case window.sdkPtr.DynamicCaptureResult.DynCaptCancel:M.print("Signature capture cancelled");break;case window.sdkPtr.DynamicCaptureResult.DynCaptPadError:M.print("No capture service available");break;case window.sdkPtr.DynamicCaptureResult.DynCaptError:M.print("Tablet Error");break;case window.sdkPtr.DynamicCaptureResult.DynCaptNotLicensed:M.print("No valid Signature Capture licence found");break;default:M.print("Capture Error "+S)}},M.onRenderBitmap=(ee,$,S)=>{if(M.callbackStatusOK("Signature Render Bitmap",S)){M.print("base64_image:>"+$+"<"),M.HTMLTagIds.imageData="data:image/png;base64,"+$;let J=new Image;J.src="data:image/png;base64,"+$,console.log({imgValue:"data:image/png;base64,"+$}),M.HTMLTagIds.emitValue("data:image/png;base64,"+$),null==M.HTMLTagIds.imageBox.firstChild?M.HTMLTagIds.imageBox.appendChild(J):M.HTMLTagIds.imageBox.replaceChild(J,M.HTMLTagIds.imageBox.firstChild)}},M.onGetSigText=(ee,$,S)=>{M.callbackStatusOK("Signature Render Bitmap",S)&&(M.HTMLTagIds.textSig.value=$,M.HTMLTagIds.imageText=$)},M.GetHash=(ee,$)=>{M.callbackFunc=$,M.print("Creating hash:"),ee.Clear(M.onClear)},M.onClear=(ee,$)=>{M.callbackStatusOK("Hash Clear",$)&&ee.PutType(window.sdkPtr.HashType.HashMD5,M.onPutType)},M.onPutType=(ee,$)=>{if(M.callbackStatusOK("Hash PutType",$)){var S=new window.sdkPtr.Variant;S.Set(M.HTMLTagIds.firstName.value),console.log({onPUtVname:S}),ee.Add(S,M.onAddFname)}},M.onAddFname=(ee,$)=>{M.callbackStatusOK("Hash Add",$)&&M.callbackFunc()},M.onAddLname=(ee,$)=>{M.callbackStatusOK("Hash Add",$)&&M.callbackFunc()},M.\u0275fac=function($){return new($||M)},M.\u0275cmp=O.Xpm({type:M,selectors:[["btn-capture"]],inputs:{reason:"reason"},decls:1,vars:0,consts:[["type","button","value","Capture","title","Starts signature capture",2,"height","10mm","width","35mm",3,"click"]],template:function($,S){1&$&&(O.TgZ(0,"input",0),O.NdJ("click",function(){return S.capturesig()}),O.qZA())},encapsulation:2})},98692:(ve,ce,b)=>{b.d(ce,{n:()=>t});var e=b(64537);let t=(()=>{class O{constructor(ee){this.el=ee}onKeyDown(ee){let $=ee;if(this.OnlyNumber){if(-1!==[46,8,9,27,13,110].indexOf($.keyCode)||190==$.keyCode&&!1===$.shiftKey||65==$.keyCode&&!0===$.ctrlKey||67==$.keyCode&&!0===$.ctrlKey||88==$.keyCode&&!0===$.ctrlKey||$.keyCode>=35&&$.keyCode<=39)return;($.shiftKey||$.keyCode<48||$.keyCode>57)&&($.keyCode<96||$.keyCode>105)&&$.preventDefault()}}}return O.\u0275fac=function(ee){return new(ee||O)(e.Y36(e.SBq))},O.\u0275dir=e.lG2({type:O,selectors:[["","OnlyNumber",""]],hostBindings:function(ee,$){1&ee&&e.NdJ("keydown",function(J){return $.onKeyDown(J)})},inputs:{OnlyNumber:"OnlyNumber"}}),O})()},79700:(ve,ce,b)=>{b.d(ce,{w:()=>ee});var e=b(42326),t=b(64537),O=b(87584),M=b(7976);let ee=(()=>{class ${constructor(J,C){this._trnMainService=J,this.router=C}transform(J,C){return this.ShowProductInsertTableColumns(J,C)}ShowProductInsertTableColumns(J,C){var _=this._trnMainService.TrnMainObj.VoucherType;let Z={};null!=this._trnMainService.TrnMainObj.ProdList&&(Z=this._trnMainService.TrnMainObj.ProdList[C]);let k=!1;switch(J){case"BATCH_HEADER":if(_===e.Km.ProductionEntry||(_===e.Km.StockIssue||_===e.Km.OpeningStockBalance||_===e.Km.StockIssueReturn||_===e.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableBatch)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking&&0===this._trnMainService.userSetting.EnableBatchWisePrice||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;((_===e.Km.BranchTransferOut||_===e.Km.OpeningStockBalance||_===e.Km.StockIssueReturn)&&2==this._trnMainService.userSetting.EnableBatch||(_===e.Km.PerformaSalesInvoice||_==e.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===e.Km.Purchase||_===e.Km.OpeningStockBalance||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.TaxInvoice||_===e.Km.TaxInvoiceCancel||_===e.Km.CreditNote||_===e.Km.DebitNote)&&(k=!0);break;case"MENUCODE_HEADER":if(1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(_===e.Km.TaxInvoice||_===e.Km.CreditNote||_===e.Km.ReverseCreditNote||_===e.Km.Sales||_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation))return!1;(_===e.Km.Purchase||_===e.Km.ReversePurchase||_===e.Km.DebitNote||_===e.Km.OpeningStockBalance||_===e.Km.PurchaseOrder||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.SalesOrder||_==e.Km.BranchTransferIn||_==e.Km.BranchTransferOut||_==e.Km.GoodsReceived||_==e.Km.ProductionEntry||_==e.Km.Stockadjustment||_==e.Km.RequisitionApproval||_===e.Km.ReverseProductionEntry||_==e.Km.RequisitionEntry||_==e.Km.Repack)&&(k=!0);break;case"BARCODE_HEADER":if(0==this._trnMainService.userSetting.GblBarcodeWiseBilling)return!1;(_===e.Km.TaxInvoice||_===e.Km.CreditNote||_===e.Km.ReverseCreditNote||_===e.Km.ReverseTaxInvoice||_===e.Km.Sales||_===e.Km.PerformaSalesInvoice||_==e.Km.CancelProforma||_==e.Km.StockIssue||_===e.Km.StockIssueReturn||_==e.Km.BranchTransferOut||_==e.Km.BranchTransferIn||_==e.Km.ProductionEntry||_==e.Km.DebitNote||_===e.Km.StockSettlement||_===e.Km.ReverseProductionEntry||_===e.Km.Quotation||_===e.Km.SalesOrder||_===e.Km.OpeningStockBalance||_===e.Km.RequisitionEntry||_===e.Km.Stockadjustment)&&(k=!0);break;case"HS_CODE":if("self-billing"==this._trnMainService.activeurlpath)return!0;(_===e.Km.TaxInvoice||_===e.Km.CreditNote||_===e.Km.Sales||_===e.Km.ExportSalesInvoice)&&(k=!!this._trnMainService.userSetting.CompulsoryHSCodeInput);break;case"BATCH_EDITABLE":if(_===e.Km.ProductionEntry||(_===e.Km.StockIssue||_===e.Km.OpeningStockBalance||_===e.Km.StockIssueReturn||_===e.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableBatch)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking&&0===this._trnMainService.userSetting.EnableBatchWisePrice||"add-membership-sales-invoice"==this._trnMainService.activeurlpath||"StockSettlementEntry"==this._trnMainService.activeurlpath)return!1;if(((_===e.Km.StockIssue||_===e.Km.OpeningStockBalance||_===e.Km.StockIssueReturn||_===e.Km.BranchTransferOut)&&2==this._trnMainService.userSetting.EnableBatch||(_===e.Km.PerformaSalesInvoice||_==e.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===e.Km.Sales||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.Purchase||_===e.Km.OpeningStockBalance||_===e.Km.DebitNote||_===e.Km.CreditNote||_===e.Km.ReverseCreditNote||_===e.Km.ReverseProductionEntry)&&(k=!0),(_===e.Km.StockIssue||_===e.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableProperExpTracking)return!0;((_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===e.Km.Sales||_===e.Km.StockSettlement||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.DebitNote||_===e.Km.CreditNote)&&(k=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(k=!0);break;case"BATCH_NONEDITABLE":((_===e.Km.OpeningStockBalance||_===e.Km.PerformaSalesInvoice||_===e.Km.Purchase||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.Quotation||_===e.Km.GoodsReceived)&&!1===Z.inputMode||_===e.Km.CreditNote||_===e.Km.DebitNote||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"MFGDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===e.Km.OpeningStockBalance||_===e.Km.Purchase||_===e.Km.DebitNote||_===e.Km.PurchaseReturn||_===e.Km.ReversePurchase||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.GoodsReceived||_===e.Km.ProductionEntry||_===e.Km.BranchTransferIn||_===e.Km.Repack||_===e.Km.BranchTransferOut||_===e.Km.ReverseCreditNote||_===e.Km.ReverseProductionEntry)&&(k=!0);break;case"MFGDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(_===e.Km.Purchase||_===e.Km.OpeningStockBalance||_===e.Km.ReversePurchase||_===e.Km.StockIssueReturn||_===e.Km.GoodsReceived||_===e.Km.ProductionEntry||_===e.Km.BranchTransferIn||_===e.Km.Repack||_===e.Km.ReverseProductionEntry)&&(k=!0);break;case"MFGDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===e.Km.SalesReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseReturn||_===e.Km.DebitNote||_===e.Km.BranchTransferOut||_===e.Km.StockIssue)&&(k=!0);break;case"EXPDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.DebitNote||_===e.Km.TaxInvoice||_===e.Km.ReversePurchase||_===e.Km.SalesReturn||_===e.Km.StockIssueReturn||_===e.Km.StockIssue||_===e.Km.TaxInvoiceCancel||_===e.Km.CreditNote||_===e.Km.Purchase||_===e.Km.OpeningStockBalance||_===e.Km.GoodsReceived||_===e.Km.ProductionEntry||_===e.Km.BranchTransferIn||_===e.Km.Repack||_===e.Km.BranchTransferOut||_===e.Km.ReverseCreditNote||_===e.Km.ReverseProductionEntry)&&(k=!0);break;case"EXPDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(_===e.Km.Purchase||_===e.Km.OpeningStockBalance||_===e.Km.StockIssueReturn||_===e.Km.ReversePurchase||_===e.Km.GoodsReceived||_===e.Km.ProductionEntry||_===e.Km.BranchTransferIn||_===e.Km.Repack||_===e.Km.ReverseProductionEntry)&&(k=!0);break;case"EXPDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.DebitNote||_===e.Km.StockIssue||_===e.Km.BranchTransferOut||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseReturn||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.CreditNote||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"QUANTITY_EDITABLE":(_===e.Km.OpeningStockBalance||_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.PurchaseReturn||_===e.Km.ReversePurchase||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.StockSettlement||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.PurchaseOrder||_===e.Km.SalesOrder||_===e.Km.CreditNote||_===e.Km.DebitNote||_===e.Km.Purchase||_===e.Km.BranchTransferIn||_===e.Km.BranchTransferOut||_===e.Km.Quotation||_===e.Km.Repack||_===e.Km.RequisitionEntry||_===e.Km.GoodsReceived||_==e.Km.ProductionEntry||_==e.Km.BatchAdjustment||_===e.Km.ReverseCreditNote||_==e.Km.Stockadjustment||_===e.Km.RequisitionApproval||_===e.Km.ReverseProductionEntry)&&(k=!0);break;case"QUANTITY_NONEDITABLE":(_===e.Km.OpeningStockBalance||_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Purchase||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.StockIssueReturn||_===e.Km.StockSettlement||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.PurchaseOrder||_===e.Km.SalesOrder||_===e.Km.PurchaseOrderCancel||_===e.Km.CreditNote||_===e.Km.ReverseCreditNote||_===e.Km.DebitNote||_===e.Km.Quotation||_===e.Km.GoodsReceived||this._trnMainService.showPerformaApproveReject)&&!1===Z.inputMode&&(k=!0);break;case"MRP_NONEDITABLE":default:k=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"GST_PER_NONEDITABLE_EXCLUSIVE_FOR_RETAILER":break;case"COSTPRICE_HEADER":_===e.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||_===e.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||_===e.Km.CreditNote||_===e.Km.OpeningStockBalance||_===e.Km.StockSettlement||_===e.Km.StockIssue||_===e.Km.ReverseCreditNote||_===e.Km.ReverseTaxInvoice||(k=!0);break;case"COSTPRICE2_NONEDITABLE":(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation||_===e.Km.Sales||_===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||_===e.Km.SalesReturn||_===e.Km.PurchaseOrderCancel||_===e.Km.SalesOrder)&&(k=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(_===e.Km.PurchaseOrder||_===e.Km.PurchaseOrderCancel||_===e.Km.SalesOrder||_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation||_===e.Km.Purchase||_===e.Km.PurchaseReturn||_===e.Km.DebitNote||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.GoodsReceived||_===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(k=!0);break;case"SELLINGPRICE2_NONEDITABLE":(_===e.Km.PurchaseOrder||_===e.Km.Purchase||_==e.Km.GoodsReceived)&&(k=!0);break;case"SELLING_HEADER":(_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation||_===e.Km.Purchase||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.GoodsReceived||_===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||_===e.Km.PurchaseOrder||_===e.Km.SalesOrder)&&(k=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(k=!1);(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.PurchaseReturn||_===e.Km.ReversePurchase||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.DebitNote||_===e.Km.CreditNote||_===e.Km.GoodsReceived||_===e.Km.SalesOrder||_===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(k=!1);(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.ReversePurchase||_===e.Km.SalesReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.DebitNote||_===e.Km.CreditNote||_===e.Km.GoodsReceived||_===e.Km.SalesOrder||_===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(k=!1);(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation||_===e.Km.PurchaseReturn||_===e.Km.ReversePurchase||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.TaxInvoiceCancel||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.DebitNote||_===e.Km.CreditNote||_===e.Km.GoodsReceived||_===e.Km.SalesOrder||_===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(k=!1);(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation||_===e.Km.PurchaseReturn||_===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_==e.Km.GoodsReceived||_===e.Km.Sales||_===e.Km.ReversePurchase||_===e.Km.SalesReturn||_===e.Km.DebitNote||_===e.Km.CreditNote||_===e.Km.SalesOrder||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":k=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":_===e.Km.OpeningStockBalance&&(k=!0);break;case"GST_PER_HEADER":(_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation||_===e.Km.Purchase||_===e.Km.GoodsReceived||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.TaxInvoice||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseOrder||_===e.Km.PurchaseOrderCancel||_===e.Km.SalesOrder)&&(k=!0);break;case"GST_PER_NONEDITABLE":(_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation||_===e.Km.Purchase||_===e.Km.GoodsReceived||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.TaxInvoice||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseOrder||_===e.Km.SalesOrder)&&(k=!0);break;case"GST_AMT_HEADER":(_===e.Km.PerformaSalesInvoice||_===e.Km.Quotation||_===e.Km.Purchase||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.SalesReturn||_===e.Km.StockIssue||_===e.Km.TaxInvoice||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseOrder||_===e.Km.PurchaseOrderCancel||_===e.Km.SalesOrder||_===e.Km.GoodsReceived)&&(k=!0);break;case"GST_AMT_NONEDITABLE":(_===e.Km.PerformaSalesInvoice||_===e.Km.CancelProforma||_===e.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.PurchaseReturn||_===e.Km.Sales||_===e.Km.ReversePurchase||_===e.Km.SalesReturn||_===e.Km.TaxInvoice||_===e.Km.ReverseTaxInvoice||_===e.Km.TaxInvoiceCancel||_===e.Km.PurchaseOrderCancel||_===e.Km.SalesOrder&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===e.Km.CreditNote||_===e.Km.DebitNote||_===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===e.Km.GoodsReceived||_===e.Km.ReverseCreditNote)&&(k=!0);break;case"UNIT_EDITABLE":k=_===e.Km.TaxInvoice||_===e.Km.Purchase||_===e.Km.GoodsReceived||_===e.Km.DebitNote||_===e.Km.Stockadjustment||_!=e.Km.Repack;break;case"UNIT_NONEDITABLE":(_===e.Km.CreditNote||_===e.Km.DebitNote||_===e.Km.ReverseCreditNote)&&(k=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(k=!0);break;case"CONFACTOR":this._trnMainService.userSetting.showConFactorInGrid&&(_===e.Km.BranchTransferOut||_===e.Km.BranchTransferIn||_===e.Km.RequisitionApproval&&0==this._trnMainService.userSetting.LogBasedRequisitionApproval)&&(k=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(k=!0);break;case"DISCOUNT_IMPORTPURCHASE":(_==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(k=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":(_==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==e.Km.TaxInvoice&&"export-sales-invoice"==this._trnMainService.activeurlpath)&&(k=!0);break;case"ECSAmount":"purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath||"export-sales-invoice"===this._trnMainService.activeurlpath?k=!1:1==this._trnMainService.userSetting.ENABLE_ECS?(_===e.Km.Purchase||_===e.Km.GoodsReceived||_==e.Km.DebitNote)&&(k=!0):2==this._trnMainService.userSetting.ENABLE_ECS?(_==e.Km.TaxInvoice||_==e.Km.CreditNote)&&(k=!0):3==this._trnMainService.userSetting.ENABLE_ECS&&(_===e.Km.Purchase||_===e.Km.GoodsReceived||_===e.Km.TaxInvoice||_==e.Km.CreditNote||_==e.Km.DebitNote)&&(k=!0)}return k}}return $.\u0275fac=function(J){return new(J||$)(t.Y36(O.p,16),t.Y36(M.F0,16))},$.\u0275pipe=t.Yjl({name:"activeColumn",type:$,pure:!0}),$})()},63213:(ve,ce,b)=>{b.d(ce,{u:()=>ee});var e=b(42326),t=b(64537),O=b(87584),M=b(7976);let ee=(()=>{class ${constructor(J,C){this._trnMainService=J,this.arouter=C,this.activeurlpath=C._routerState.snapshot.url.split("/").pop()}transform(J){return console.log("field name",J),this.disableFieldInTransaction(J)}disableFieldInTransaction(J){switch(J){case"disableWareHouse":return(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||"abbreviated-sales-invoice"==this._trnMainService.activeurlpath||"self-billing"==this._trnMainService.activeurlpath||"add-membership-sales-invoice"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||"stockageing-report"==this.activeurlpath||"stock-issue-report"==this.activeurlpath||"stock-variance-report"==this.activeurlpath||"reorder-levelstock-report"==this.activeurlpath||"max-stocklevel-report"==this.activeurlpath||"minimum-stocklevel-report"==this.activeurlpath||"item-expiry-report"==this.activeurlpath||"stock-ledger-report"==this.activeurlpath||"stock-summary-report"==this.activeurlpath||"requisition-report"==this.activeurlpath||"openingstock-report"==this.activeurlpath)&&1==this._trnMainService.userSetting.UserWiseWarehouse;case"disableGridInMixedPurchase":return!!("VIEW"==this._trnMainService.TrnMainObj.Mode||1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE)}}}return $.\u0275fac=function(J){return new(J||$)(t.Y36(O.p,16),t.Y36(M.gz,16))},$.\u0275pipe=t.Yjl({name:"disableField",type:$,pure:!0}),$})()},62490:(ve,ce,b)=>{b.d(ce,{VO:()=>M,gB:()=>t});var e=b(64537);let t=(()=>{class ee{transform(S,J,C){return null==J||null==J||""==J||null==C||null==C||""==C?S:C?S.filter(_=>null!=_[J]&&null!=_[J]&&-1!==_[J].toLowerCase().indexOf(C.toLowerCase())):S}}return ee.\u0275fac=function(S){return new(S||ee)},ee.\u0275pipe=e.Yjl({name:"filter",type:ee,pure:!1}),ee})(),M=(()=>{class ee{transform(S,J){let C=[];for(let _ in S)C.push(_);return C}}return ee.\u0275fac=function(S){return new(S||ee)},ee.\u0275pipe=e.Yjl({name:"keys",type:ee,pure:!0}),ee})()},65171:(ve,ce,b)=>{b.d(ce,{j:()=>y});var e=b(64537),t=b(53074),O=b(87584),M=b(88692),ee=b(20092),$=b(28096);function S(f,L){1&f&&(e.TgZ(0,"th"),e._uU(1,"BATCHID"),e.qZA())}function J(f,L){1&f&&(e.TgZ(0,"th"),e._uU(1,"Barcode"),e.qZA())}function C(f,L){1&f&&(e.TgZ(0,"th",11),e._uU(1,"S-Price(Exc VAT)"),e.qZA())}function _(f,L){1&f&&(e.TgZ(0,"th",11),e._uU(1,"S-Price(Inc VAT)"),e.qZA())}function Z(f,L){if(1&f&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&f){const x=e.oxw().$implicit;e.xp6(1),e.Oqu(x.BATCHID)}}function k(f,L){if(1&f&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&f){const x=e.oxw().$implicit;e.xp6(1),e.Oqu(x.BC)}}function X(f,L){if(1&f&&(e.TgZ(0,"td",18),e._uU(1),e.ALo(2,"number"),e.qZA()),2&f){const x=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,x.SELLRATEBEFORETAX,"1.2-2"))}}function H(f,L){if(1&f&&(e.TgZ(0,"td",18),e._uU(1),e.ALo(2,"number"),e.qZA()),2&f){const x=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,x.MRP,"1.2-2"))}}function j(f,L){if(1&f){const x=e.EpF();e.TgZ(0,"tr",14),e.NdJ("click",function(){const P=e.CHM(x).index,w=e.oxw();return e.KtG(w.RowClickEvent(P))})("dblclick",function(){const P=e.CHM(x).$implicit,w=e.oxw();return e.KtG(w.dblClickBatchObj(P))}),e.TgZ(1,"td",15),e._uU(2),e.qZA(),e.YNc(3,Z,2,1,"td",16),e.TgZ(4,"td",17),e._uU(5),e.qZA(),e.YNc(6,k,2,1,"td",16),e.TgZ(7,"td",17),e._uU(8),e.qZA(),e.TgZ(9,"td",18),e._uU(10),e.ALo(11,"number"),e.qZA(),e.YNc(12,X,3,4,"td",19),e.YNc(13,H,3,4,"td",19),e.qZA()}if(2&f){const x=L.$implicit,m=L.index,I=e.oxw();e.ekj("selected-row",m===I.selectedRowIndex),e.xp6(2),e.Oqu(m+1),e.xp6(1),e.Q6J("ngIf",1==I._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(2),e.Oqu(x.BATCHCODE),e.xp6(1),e.Q6J("ngIf",1==I.HASVARIANT),e.xp6(2),e.Oqu(x.STOCK),e.xp6(2),e.Oqu(e.xi3(11,10,x.LANDINGCOST,"1.2-2")),e.xp6(2),e.Q6J("ngIf",89!=I._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89!=I._trnMainService.TrnMainObj.VoucherType)}}let y=(()=>{class f{constructor(x,m){this.masterRepo=x,this._trnMainService=m,this.Blist=[],this.BatchClosedEmit=new e.vpe,this.dbClickEvent=new e.vpe,this.showPopup=!1}ngOnInit(){console.log("batch popup shown",this.Blist)}RowClickEvent(x){this.selectedRowIndex=x}dblClickBatchObj(x){this.dbClickEvent.emit(x)}itemBatchClosed(){this.BatchClosedEmit.emit()}updown(x){null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===x.code?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>this.Blist.length-1&&(this.selectedRowIndex=this.Blist.length-1)):"ArrowUp"===x.code&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===x.code||"NumpadEnter"==x.code?null!=this.selectedRowIndex&&null!=this.Blist[this.selectedRowIndex]&&this.dblClickBatchObj(this.Blist[this.selectedRowIndex]):"Escape"===x.code&&this.itemBatchClosed()}}return f.\u0275fac=function(x){return new(x||f)(e.Y36(t.P),e.Y36(O.p))},f.\u0275cmp=e.Xpm({type:f,selectors:[["itemwisebatch"]],hostBindings:function(x,m){1&x&&e.NdJ("keydown",function(P){return m.updown(P)},!1,e.evT)},inputs:{Blist:"Blist",HASVARIANT:"HASVARIANT"},outputs:{BatchClosedEmit:"BatchClosedEmit",dbClickEvent:"dbClickEvent"},decls:27,vars:9,consts:[[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[2,"float","right"],["type","search","autocomplete","off","placeholder","Search..","name","filter","id","filter",2,"height","1.5rem","font-size","13px","width","755px",3,"ngModel","ngModelChange"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],[4,"ngIf"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["aria-disabled","true","class","highlight",3,"selected-row","click","dblclick",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight",3,"click","dblclick"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],["style","border-bottom: 1px solid #ddd;height: 23px;width:20%",4,"ngIf"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"],[2,"border-bottom","1px solid #ddd","height","23px","width","15%","text-align","right"],["style","border-bottom: 1px solid #ddd;height: 23px;width:15%;text-align: right;",4,"ngIf"]],template:function(x,m){1&x&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),e._uU(4,"Item Wise Batch List"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return m.itemBatchClosed()}),e.TgZ(6,"span",5),e._uU(7,"\xd7"),e.qZA()()(),e.TgZ(8,"div",6)(9,"input",7),e.NdJ("ngModelChange",function(P){return m.filter=P}),e.qZA()(),e.TgZ(10,"table",8)(11,"tr",9)(12,"th"),e._uU(13,"Sn."),e.qZA(),e.YNc(14,S,2,0,"th",10),e.TgZ(15,"th"),e._uU(16,"BATCH"),e.qZA(),e.YNc(17,J,2,0,"th",10),e.TgZ(18,"th"),e._uU(19,"STOCK"),e.qZA(),e.TgZ(20,"th",11),e._uU(21,"P-Rate"),e.qZA(),e.YNc(22,C,2,0,"th",12),e.YNc(23,_,2,0,"th",12),e.qZA(),e.TgZ(24,"tbody"),e.YNc(25,j,14,13,"tr",13),e.ALo(26,"searchData"),e.qZA()()()()),2&x&&(e.xp6(9),e.Q6J("ngModel",m.filter),e.xp6(5),e.Q6J("ngIf",1==m._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(3),e.Q6J("ngIf",1==m.HASVARIANT),e.xp6(5),e.Q6J("ngIf",89!=m._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89!=m._trnMainService.TrnMainObj.VoucherType),e.xp6(2),e.Q6J("ngForOf",e.xi3(26,6,m.Blist,m.filter)))},dependencies:[M.sg,M.O5,ee.Fj,ee.JJ,ee.On,M.JJ,$.C],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }\n \n   .unitLabel[_ngcontent-%COMP%]{\n     width: auto;\n     font-size: 14px;\n     margin-left: 5px;\n   }"]}),f})()},82484:(ve,ce,b)=>{b.d(ce,{q:()=>J});var e=b(64537),t=b(53074),O=b(87584),M=b(88692);function ee(C,_){if(1&C){const Z=e.EpF();e.TgZ(0,"tr",12),e.NdJ("dblclick",function(){const H=e.CHM(Z).$implicit,j=e.oxw(2);return e.KtG(j.doubleClick(H))})("click",function(){const H=e.CHM(Z).index,j=e.oxw(2);return e.KtG(j.singleClick(H))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()}if(2&C){const Z=_.$implicit,k=_.index,X=e.oxw(2);e.ekj("selected-row",X.selectedRowIndex==k),e.xp6(2),e.hij("",Z.DESCA," "),e.xp6(2),e.hij("",Z.MENUCODE," "),e.xp6(2),e.hij("",Z.STOCK," "),e.xp6(2),e.hij("",Z.MRP," ")}}function $(C,_){if(1&C&&(e.TgZ(0,"tbody"),e.YNc(1,ee,9,6,"tr",11),e.qZA()),2&C){const Z=e.oxw();e.xp6(1),e.Q6J("ngForOf",Z._trnMainService.ItemsListForMultiItemBarcode)}}function S(C,_){if(1&C&&e._UZ(0,"div",13),2&C){const Z=e.oxw();e.Q6J("innerHTML",Z.summary,e.oJD)}}let J=(()=>{class C{constructor(Z,k){this.masterService=Z,this._trnMainService=k,this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){}hide(){this.masterService.PlistTitle=""}doubleClick(Z){this.masterService.masterPostmethod("/getbatchWithAlternateUnitList",Z).subscribe(k=>{if("ok"==k.status){let X=JSON.parse(k.result),H=this._trnMainService.TrnMainObj.ProdList.findIndex(j=>j.MCODE==X.MCODE);if(H<0)this._trnMainService.addRow(),this._trnMainService.assignValueToProdFromBarcode(X,this._trnMainService.TrnMainObj.ProdList.findIndex(j=>null==j.MCODE));else{let j=this._trnMainService.TrnMainObj.ProdList[H];this._trnMainService.TrnMainObj.ProdList[H].Quantity+=1,this._trnMainService.RealQuantitySet(H,j.CONFACTOR),this._trnMainService.ReCalculateBillWithNormal()}this.masterService.PlistTitle="",document.getElementById("itembarcode").focus()}else alert(k.result)},()=>{})}singleClick(Z){this.selectedRowIndex=Z,this.summary=this._trnMainService.ItemsListForMultiItemBarcode[Z].itemSummary}updown(Z){"ArrowDown"==Z.code&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length-1?(Z.preventDefault(),this.selectedRowIndex++,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"ArrowUp"==Z.code&&this.selectedRowIndex-1>-1?(Z.preventDefault(),this.selectedRowIndex--,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"Enter"==Z.code&&this.selectedRowIndex>=0&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length?(Z.preventDefault(),this.doubleClick(this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]),this.hide()):"Escape"==Z.code&&(Z.preventDefault(),this.hide())}}return C.\u0275fac=function(Z){return new(Z||C)(e.Y36(t.P),e.Y36(O.p))},C.\u0275cmp=e.Xpm({type:C,selectors:[["PItemList"]],hostBindings:function(Z,k){1&Z&&e.NdJ("keydown",function(H){return k.updown(H)},!1,e.evT)},decls:24,vars:2,consts:[[1,"modal-sticky",2,"display","block","padding","0px","height","400px","margin-bottom","60px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#7ed0ff"],[4,"ngIf"],["style","margin-left: 25px ",3,"innerHTML",4,"ngIf"],["class","highlight","title","double click for detail view",3,"selected-row","dblclick","click",4,"ngFor","ngForOf"],["title","double click for detail view",1,"highlight",3,"dblclick","click"],[2,"margin-left","25px",3,"innerHTML"]],template:function(Z,k){1&Z&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div")(4,"div",2)(5,"button",3),e.NdJ("click",function(){return k.hide()}),e.TgZ(6,"span",4),e._uU(7,"\xd7"),e.qZA()(),e.TgZ(8,"h4",5),e._uU(9," ITEMS "),e.qZA()(),e.TgZ(10,"div",6)(11,"table",7)(12,"thead")(13,"tr",8)(14,"th"),e._uU(15," DESCRIPTION"),e.qZA(),e.TgZ(16,"th"),e._uU(17," CODE"),e.qZA(),e.TgZ(18,"th"),e._uU(19," STOCK"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"MRP"),e.qZA()()(),e.YNc(22,$,2,1,"tbody",9),e.qZA()()(),e.YNc(23,S,1,1,"div",10),e.qZA()()()),2&Z&&(e.xp6(22),e.Q6J("ngIf",k._trnMainService.ItemsListForMultiItemBarcode.length),e.xp6(1),e.Q6J("ngIf",k.summary))},dependencies:[M.sg,M.O5],styles:[".modal-content[_ngcontent-%COMP%] {\n          padding: 1px;\n          margin: 0px;\n          float: right;\n        }\n        .table-scroll[_ngcontent-%COMP%] {\n          overflow-y: scroll;\n          overflow-x: hidden;\n        }\n      \n        tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n          background-color: #f3f5f4;\n          cursor: pointer;\n        }\n        tr[_ngcontent-%COMP%] {\n          font-size: 11px;\n        }\n        .selected-row[_ngcontent-%COMP%] {\n          background-color: #ced6d3 !important;\n        }\n      \n        .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n          text-align: left !important;\n          padding: 0px 0px 0px 11px !important;\n        } \n      \n        .modal-content[_ngcontent-%COMP%]{\n          box-shadow: -10px 0px 10px 1px #aaaaaa;\n        }\n      \n        .modal-content-main-area[_ngcontent-%COMP%] { \n          max-height: 100%;\n          height: 100%;\n          overflow: auto;\n          overflow-x: hidden;\n        } \n      \n        .modal-content-summary-area[_ngcontent-%COMP%] {\n          max-height: 20%;\n          height: 20%;\n          overflow: auto;\n          overflow-x: hidden;\n        }"]}),C})()},59963:(ve,ce,b)=>{b.d(ce,{H:()=>J});var e=b(64537),t=b(53074),O=b(88692),M=b(20092),ee=b(62490);const $=["inputBox"];function S(C,_){if(1&C){const Z=e.EpF();e.TgZ(0,"tbody",12),e.NdJ("dblclick",function(){const X=e.CHM(Z),H=X.$implicit,j=X.index,y=e.oxw();return e.KtG(y.dblClickItemList(H,j))}),e.TgZ(1,"tr",13)(2,"td",14),e._uU(3),e.qZA(),e.TgZ(4,"td",15),e._uU(5),e.qZA(),e.TgZ(6,"td",15),e._uU(7),e.qZA(),e.TgZ(8,"td",15),e._uU(9),e.qZA()()()}if(2&C){const Z=_.$implicit,k=_.index,X=e.oxw();e.ekj("highlighted",k===X.selectedRowIndex),e.xp6(3),e.Oqu(Z.ACNAME),e.xp6(2),e.Oqu(Z.ACCODE),e.xp6(2),e.Oqu(Z.ADDRESS),e.xp6(2),e.Oqu(Z.EMAIL)}}let J=(()=>{class C{constructor(Z){this.masterService=Z,this.dbClickEvent=new e.vpe,this.partyCloseClick=new e.vpe,this.partyList=[],this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){setTimeout(()=>{this.setFocus()},50)}SearchList(Z){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(Z,k){this.selectedRowIndex=k,this.dbClickEvent.emit(Z)}partyPopClosed(){this.partyCloseClick.emit()}onKeydown(Z){return this.setFocus(),null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===Z.key?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>9&&(this.selectedRowIndex=9)):"ArrowUp"===Z.key&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===Z.key?(null!=this.selectedRowIndex&&null!=this.partyList[this.selectedRowIndex]&&this.dblClickItemList(this.partyList[this.selectedRowIndex],this.selectedRowIndex),!1):"Delete"===Z.key?(this.partyPopClosed(),!1):void 0}}return C.\u0275fac=function(Z){return new(Z||C)(e.Y36(t.P))},C.\u0275cmp=e.Xpm({type:C,selectors:[["popPartyChoose"]],viewQuery:function(Z,k){if(1&Z&&e.Gf($,5),2&Z){let X;e.iGM(X=e.CRH())&&(k._el=X.first)}},inputs:{partyList:"partyList"},outputs:{dbClickEvent:"dbClickEvent",partyCloseClick:"partyCloseClick"},decls:24,vars:6,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],["type","text","id","partysearchpopup","autofocus","",2,"width","100%","/* padding","1px","*/padding-left","0px","margin-left","-13px",3,"ngModel","ngModelChange","keydown"],["inputBox",""],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"highlighted","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(Z,k){1&Z&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),e.NdJ("click",function(){return k.partyPopClosed()}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()(),e.TgZ(6,"h4",4),e._uU(7),e.qZA()(),e.TgZ(8,"div",5)(9,"input",6,7),e.NdJ("ngModelChange",function(H){return k.filter=H})("keydown",function(H){return k.onKeydown(H)}),e.qZA()(),e.TgZ(11,"div",5)(12,"table",8)(13,"tr",9)(14,"th",10),e._uU(15,"Name"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Code"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Address"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Email"),e.qZA()(),e.YNc(22,S,10,6,"tbody",11),e.ALo(23,"filter"),e.qZA()()()()),2&Z&&(e.xp6(7),e.Oqu(k.masterService.partyPopUpHeaderText),e.xp6(2),e.Q6J("ngModel",k.filter),e.xp6(13),e.Q6J("ngForOf",e.xi3(23,3,k.partyList,k.filter)))},dependencies:[O.sg,M.Fj,M.JJ,M.On,ee.gB],encapsulation:2}),C})()},86857:(ve,ce,b)=>{b.d(ce,{l:()=>J});var e=b(64537),t=b(67311),O=b(88692),M=b(20092);function ee(C,_){if(1&C){const Z=e.EpF();e.TgZ(0,"tr",18),e.NdJ("click",function(){const H=e.CHM(Z).index,j=e.oxw(3);return e.KtG(j.SELECTEDINDEX=H)}),e.TgZ(1,"th",15)(2,"input",19),e.NdJ("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.BATCH=X)}),e.qZA()(),e.TgZ(3,"th",15)(4,"input",20),e.NdJ("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.ALTUNIT=X)}),e.qZA()(),e.TgZ(5,"th",15)(6,"input",21),e.NdJ("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.INVOICEQTYA=X)}),e.qZA()(),e.TgZ(7,"th",15)(8,"input",21),e.NdJ("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.TOTALOUTWARDSTOCKA=X)}),e.qZA()(),e.TgZ(9,"th",15)(10,"input",21),e.NdJ("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.EDITABLEQTYA=X)}),e.qZA()(),e.TgZ(11,"th",15)(12,"input",22),e.NdJ("change",function(){const H=e.CHM(Z).index,j=e.oxw(3);return e.KtG(j.onChangeAdjustQty(H))})("ngModelChange",function(X){const j=e.CHM(Z).$implicit;return e.KtG(j.ADJUSTQTY=X)}),e.qZA()()()}if(2&C){const Z=_.$implicit,k=_.index;e.xp6(2),e.MGl("id","batch",k,""),e.Q6J("disabled",!0)("ngModel",Z.BATCH),e.xp6(2),e.MGl("id","altunit",k,""),e.Q6J("disabled",!0)("ngModel",Z.ALTUNIT),e.xp6(2),e.MGl("id","invoiceqty",k,""),e.Q6J("disabled",!0)("ngModel",Z.INVOICEQTYA),e.xp6(2),e.MGl("id","invoiceqty",k,""),e.Q6J("disabled",!0)("ngModel",Z.TOTALOUTWARDSTOCKA),e.xp6(2),e.MGl("id","invoiceqty",k,""),e.Q6J("disabled",!0)("ngModel",Z.EDITABLEQTYA),e.xp6(2),e.MGl("id","adjustQty",k,""),e.Q6J("disabled",Z.isDisabled)("ngModel",Z.ADJUSTQTY)}}function $(C,_){if(1&C&&(e.TgZ(0,"div",11)(1,"table",12,13)(3,"thead")(4,"tr",14)(5,"th",15),e._uU(6,"Batch"),e.qZA(),e.TgZ(7,"th",15),e._uU(8,"Unit"),e.qZA(),e.TgZ(9,"th",15),e._uU(10,"Issue Qty"),e.qZA(),e.TgZ(11,"th",15),e._uU(12,"Transaction Qty"),e.qZA(),e.TgZ(13,"th",15),e._uU(14,"Editable Qty"),e.qZA(),e.TgZ(15,"th",15),e._uU(16,"Edit Qty"),e.qZA()()(),e.TgZ(17,"tbody",16),e.YNc(18,ee,13,18,"tr",17),e.qZA()()()),2&C){const Z=e.oxw(2);e.xp6(18),e.Q6J("ngForOf",Z.BatchWiseEditList)}}function S(C,_){if(1&C){const Z=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.NdJ("click",function(){e.CHM(Z);const X=e.oxw();return e.KtG(X.hide())}),e.TgZ(4,"span",5),e._uU(5,"\xd7"),e.qZA()(),e.TgZ(6,"h4",6),e._uU(7),e.qZA()(),e.YNc(8,$,19,1,"div",7),e.TgZ(9,"div",8)(10,"button",9),e.NdJ("click",function(){e.CHM(Z);const X=e.oxw();return e.KtG(X.okClicked())}),e._uU(11,"Apply"),e.qZA(),e.TgZ(12,"button",10),e.NdJ("click",function(){e.CHM(Z);const X=e.oxw();return e.KtG(X.hide())}),e._uU(13,"cancel"),e.qZA()()()()}if(2&C){const Z=e.oxw();e.ekj("modal-sticky-hide",!Z.isActive),e.xp6(7),e.hij(" ",Z.itemname," "),e.xp6(1),e.Q6J("ngIf",Z.BatchWiseEditList&&Z.BatchWiseEditList.length)}}let J=(()=>{class C{constructor(Z){this.alertService=Z,this.itemname="",this.isActive=!1,this.keys=[],this.headerKeys=[],this.matrixItemRows=[],this.SELECTEDINDEX=0,this.onApplyClicked=new e.vpe,this.addRows=k=>{},this.onAttributeChange=(k,X)=>{let H=this.keys.findIndex(f=>f==k),j=[];for(var y in j=H>-1?this.keys.slice(H+1):this.keys,j)if(document.getElementById(j[y]+X))return void setTimeout(()=>document.getElementById(j[y]+X).focus())},this.okClicked=()=>{this.validateEditedQty()&&(this.onApplyClicked.emit(this.BatchWiseEditList),this.hide())},this.show=()=>{this.isActive=!0,setTimeout(()=>{this.onAttributeChange("NONE",0)},0)},this.hide=()=>{this.isActive=!1,this.keys=[],this.matrixItemRows=[]},this.calculateUnitWiseQty()}ngOnInit(){}calculateUnitWiseQty(){console.log("new",this.BatchWiseEditList)}ngOnChanges(Z){this.BatchWiseEditList=Z.BatchWiseEditList.currentValue,this.BatchWiseEditList&&this.BatchWiseEditList.length&&(this.BatchWiseEditList=this.BatchWiseEditList.filter(k=>k.INVOICEQTY>0),this.BatchWiseEditList.forEach(k=>{k.INVOICEQTY-k.TOTALOUTWARDSTOCK==0&&(k.ADJUSTQTY=k.INVOICEQTY,k.isDisabled=!0)}))}onChangeAdjustQty(Z){this.BatchWiseEditList[Z].ADJUSTQTY<this.BatchWiseEditList[Z].TOTALOUTWARDSTOCK&&this.alertService.info("Quantity Exceed the transaction stock")}validateEditedQty(){return!0}}return C.\u0275fac=function(Z){return new(Z||C)(e.Y36(t.c))},C.\u0275cmp=e.Xpm({type:C,selectors:[["batch-wise-item-edit"]],inputs:{itemname:"itemname",BatchWiseEditList:"BatchWiseEditList"},outputs:{onApplyClicked:"onApplyClicked"},features:[e.TTD],decls:1,vars:1,consts:[["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;",3,"modal-sticky-hide",4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#ecad79"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],["class","modal-body","style","max-height: 63vh;overflow-y: auto;",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-info","pull-right",3,"click"],[1,"btn","btn-info","pull-right",2,"margin-right","5px",3,"click"],[1,"modal-body",2,"max-height","63vh","overflow-y","auto"],["id","BlueHeaderResizableTable",1,"matrix-table",2,"font-size","12px","width","98%","overflow-x","auto"],["reportHtmlTable",""],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["width","100px"],[2,"width","fit-content"],["style","border: 1px solid #e6e6e6; max-height: 25px",3,"click",4,"ngFor","ngForOf"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click"],["type","text","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","text","name","altunit",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","change","ngModelChange"]],template:function(Z,k){1&Z&&e.YNc(0,S,14,4,"div",0),2&Z&&e.Q6J("ngIf",k.isActive)},dependencies:[O.sg,O.O5,M.Fj,M.wV,M.JJ,M.On],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content-main-area[_ngcontent-%COMP%]{height:75vh!important}.modal-sticky[_ngcontent-%COMP%]{width:70vw im!important}tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{background-color:#f3f5f4;cursor:pointer}tr[_ngcontent-%COMP%]{font-size:11px}.selected-row[_ngcontent-%COMP%]{background-color:#ced6d3!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{line-height:30px!important}.table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{line-height:5px!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important;padding:0 0 0 11px!important}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.modal-content-main-area[_ngcontent-%COMP%]{max-height:100%;height:100%;width:100%!important}.modal-content-summary-area[_ngcontent-%COMP%]{max-height:20%;height:20%;overflow:auto;overflow-x:hidden}.ellipsis[_ngcontent-%COMP%]{white-space:nowrap}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#CED6D3;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{height:30px;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   .borderdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15)}.matrix-table[_ngcontent-%COMP%]   .rowdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15);text-align:center}.matrix-table[_ngcontent-%COMP%]   .smalllabeldiv[_ngcontent-%COMP%]{height:16px}.matrix-table[_ngcontent-%COMP%]   .smallHeader[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0}.matrix-table[_ngcontent-%COMP%]   .scrolldiv[_ngcontent-%COMP%]{max-height:75px;padding-right:30px;overflow:auto;scrollbar-3dlight-color:#FFFFFF;scrollbar-arrow-color:#000000;scrollbar-base-color:#FF9999;scrollbar-darkshadow-color:#000000;scrollbar-face-color:#000000;scrollbar-highlight-color:#000000;scrollbar-shadow-color:#0033CC}.matrix-table[_ngcontent-%COMP%]   .multiboxspan[_ngcontent-%COMP%]{font-size:11px;font-weight:700;position:relative;float:left;display:block;margin:2px;border:1px solid silver;border-radius:5px;background-color:#fff0f5}.matrix-table[_ngcontent-%COMP%]   .smallBoldLabel[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0;float:left;color:#222}.matrix-table[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:77vh}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:95%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{flex:0 0 auto;width:calc(100% - .9em)}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{flex:1 1 auto;display:block;overflow-y:scroll}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{width:99.6%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;table-layout:fixed}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#deb887!important;color:#fff}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f2f2f2}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#fff}.matrix-table[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#222;width:auto}.matrix-table[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]{margin-bottom:1%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]{margin-top:10%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:600;font-size:15px;padding:0 5px}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{height:25px!important;padding:0 5px!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{overflow:hidden}"]}),C})()},471:(ve,ce,b)=>{b.d(ce,{X:()=>G});var e=b(64537),t=b(20092),O=b(92340),M=b(53074),ee=b(87584),$=b(67311),S=b(14970),J=b(88692);const C=["customerName"];function _(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Name is required."),e.qZA())}function Z(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,_,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.name.errors.required)}}function k(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Name is required."),e.qZA())}function X(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,k,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.name.errors.required)}}function H(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Address is required."),e.qZA())}function j(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,H,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.address.errors.required)}}function y(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Pan No is required."),e.qZA())}function f(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,y,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.pan.errors.required)}}function L(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Pan No is required."),e.qZA())}function x(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,L,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.pan.errors.required)}}function m(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"PAN No must be 9 digit long."),e.qZA())}function I(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,m,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.pan.errors.minlength||K.form.controls.pan.errors.maxlength)}}function P(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Mobile No is required."),e.qZA())}function w(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,P,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.mobNo.errors.required)}}function Q(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Mobile No is required."),e.qZA())}function U(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,Q,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.mobNo.errors.required)}}function B(Y,z){1&Y&&(e.TgZ(0,"span"),e._uU(1,"Mobile No must be 10 digit long."),e.qZA())}function q(Y,z){if(1&Y&&(e.TgZ(0,"div",25),e.YNc(1,B,2,0,"span",26),e.qZA()),2&Y){const K=e.oxw(2);e.xp6(1),e.Q6J("ngIf",K.form.controls.mobNo.errors.minlength||K.form.controls.mobNo.errors.maxlength)}}function W(Y,z){1&Y&&(e.TgZ(0,"div",11)(1,"label",12),e._uU(2,"MOBILE NO REGISTER IN:"),e.qZA(),e.TgZ(3,"div",13)(4,"select",27),e._UZ(5,"option",28),e.TgZ(6,"option",29),e._uU(7,"Viber"),e.qZA(),e.TgZ(8,"option",30),e._uU(9,"Whatsapp"),e.qZA()()()())}function re(Y,z){if(1&Y&&(e.ynx(0),e.TgZ(1,"option",31),e._uU(2),e.qZA(),e.BQk()),2&Y){const K=z.$implicit;e.xp6(1),e.Q6J("ngValue",K.SCHEMEID),e.xp6(1),e.Oqu(K.NAME)}}function ae(Y,z){if(1&Y){const K=e.EpF();e.TgZ(0,"div",11)(1,"div",13)(2,"input",32),e.NdJ("change",function(me){e.CHM(K);const Ne=e.oxw(2);return e.KtG(Ne.form.value.createMember=me.target.checked?1:0)}),e.qZA(),e.TgZ(3,"label",33),e._uU(4,"Create Customer Profile as Member Also"),e.qZA()(),e._UZ(5,"div",34),e.qZA()}}function Me(Y,z){if(1&Y){const K=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"CREATE CUSTOMER PROFILE"),e.qZA(),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("keydown.F6",function(){e.CHM(K);const me=e.oxw();return e.KtG(me.submit(me.form.value))})("click",function(){e.CHM(K);const me=e.oxw();return e.KtG(me.submit(me.form.value))}),e._uU(7,"SAVE [End]"),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){e.CHM(K);const me=e.oxw();return e.KtG(me.onclear())})("keydown.F3",function(){e.CHM(K);const me=e.oxw();return e.KtG(me.onclear())}),e._uU(9,"RESET"),e.qZA(),e.TgZ(10,"button",8),e.NdJ("click",function(){e.CHM(K);const me=e.oxw();return e.KtG(me.closeDialog())}),e._uU(11,"CANCEL"),e.qZA()()(),e.TgZ(12,"div",9)(13,"form",10)(14,"div",11)(15,"label",12),e._uU(16,"NAME:"),e.qZA(),e.TgZ(17,"div",13),e._UZ(18,"input",14,15),e.YNc(20,Z,2,1,"div",16),e.YNc(21,X,2,1,"div",16),e.qZA()(),e.TgZ(22,"div",11)(23,"label",12),e._uU(24,"ADDRESS:"),e.qZA(),e.TgZ(25,"div",13),e._UZ(26,"input",17),e.YNc(27,j,2,1,"div",16),e.qZA()(),e.TgZ(28,"div",11)(29,"label",12),e._uU(30,"PANNO:"),e.qZA(),e.TgZ(31,"div",13)(32,"input",18),e.NdJ("keypress",function(me){e.CHM(K);const Ne=e.oxw();return e.KtG(Ne.keyPress(me))}),e.qZA(),e.YNc(33,f,2,1,"div",16),e.YNc(34,x,2,1,"div",16),e.YNc(35,I,2,1,"div",16),e.qZA()(),e.TgZ(36,"div",11)(37,"label",12),e._uU(38,"PHONE NO:"),e.qZA(),e.TgZ(39,"div",13),e._UZ(40,"input",19),e.qZA()(),e.TgZ(41,"div",11)(42,"label",12),e._uU(43,"MOBILE NO:"),e.qZA(),e.TgZ(44,"div",13)(45,"input",20),e.NdJ("keypress",function(me){e.CHM(K);const Ne=e.oxw();return e.KtG(Ne.keyPress(me))}),e.qZA(),e.YNc(46,w,2,1,"div",16),e.YNc(47,U,2,1,"div",16),e.YNc(48,q,2,1,"div",16),e.qZA()(),e.YNc(49,W,10,0,"div",21),e.TgZ(50,"div",11)(51,"label",12),e._uU(52,"EMAIL:"),e.qZA(),e.TgZ(53,"div",13),e._UZ(54,"input",22),e.qZA()(),e.TgZ(55,"div",11)(56,"label",12),e._uU(57,"Scheme:"),e.qZA(),e.TgZ(58,"div",13)(59,"select",23),e.YNc(60,re,3,2,"ng-container",24),e.qZA()()(),e.YNc(61,ae,6,0,"div",21),e.qZA()()()()}if(2&Y){const K=e.oxw();e.xp6(6),e.Q6J("disabled",K.form.invalid),e.xp6(7),e.Q6J("formGroup",K.form),e.xp6(7),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.name.invalid&&(K.form.controls.name.dirty||K.form.controls.name.touched)),e.xp6(1),e.Q6J("ngIf",K.isSubmitting&&K.form.controls.name.invalid),e.xp6(6),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.address.invalid&&(K.form.controls.address.dirty||K.form.controls.address.touched)),e.xp6(6),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.pan.invalid&&(K.form.controls.pan.dirty||K.form.controls.pan.touched)),e.xp6(1),e.Q6J("ngIf",K.isSubmitting&&K.form.controls.pan.invalid),e.xp6(1),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.pan.invalid&&(K.form.controls.pan.dirty||K.form.controls.pan.touched)),e.xp6(11),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.mobNo.invalid&&(K.form.controls.mobNo.dirty||K.form.controls.mobNo.touched)),e.xp6(1),e.Q6J("ngIf",K.isSubmitting&&K.form.controls.mobNo.invalid),e.xp6(1),e.Q6J("ngIf",!K.isSubmitting&&K.form.controls.mobNo.invalid&&(K.form.controls.mobNo.dirty||K.form.controls.mobNo.touched)),e.xp6(1),e.Q6J("ngIf",K.form.controls.mobNo.valid&&"lite"!=K.AppMode),e.xp6(11),e.Q6J("ngForOf",K.schemeList),e.xp6(1),e.Q6J("ngIf",1==K.masterservice.userSetting.CREATE_CPROFILE_AS_MEMBER&&"lite"!=K.AppMode)}}let G=(()=>{class Y{constructor(K,oe,me,Ne,Ze){this.fb=K,this.masterservice=oe,this._trnMainService=me,this.alertService=Ne,this.spinnerService=Ze,this.isSubmitting=!1,this.isSubmitted=!1,this.onSave=new e.vpe,this.mode="add",this.dropdownList=[],this.selectedItems=[],this.activerowIndex=0,this.AppMode=O.N.appMode,this.masterservice.getAllDivisions().subscribe(Fe=>{this.dropdownList=Fe}),this.masterservice.getMemCatList().subscribe(Fe=>{this.schemeList=Fe})}ngOnInit(){this.dropdownSettings={singleSelection:!1,idField:"INITIAL",textField:"NAME",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:3,allowSearchFilter:!1,maxHeight:100}}forminit(){this.form=this.fb.group({name:["",[t.kI.required]],address:[""],pan:["",[t.kI.minLength(9),t.kI.maxLength(9)]],phoneNo:[""],mobNo:["",[t.kI.minLength(10),t.kI.maxLength(10)]],email:[""],createMember:[""],MOBILENO_REG_IN:[""],FurtherProceed:[""],divisionMapping:[""],ShippingList:[[]],VehicleList:[[]],STATUS:[1],SCHEMEID:[""]}),this.form.controls.createMember.patchValue(1==this.masterservice.userSetting.CREATE_CPROFILE_AS_MEMBER?1:0)}submit(K){this.isSubmitting=!0,1!=this.masterservice.userSetting.CREATE_CPROFILE_AS_MEMBER||1!=this.form.value.createMember||14===this._trnMainService.TrnMainObj.VoucherType||1===this._trnMainService.TrnMainObj.VoucherType||""!=this.form.value.mobNo?((""==this.form.value.mobNo||null==this.form.value.mobNo)&&(this.form.value.MOBILENO_REG_IN=""),"B2B"!==this.masterservice.userSetting.CompanyType||""!=this.form.value.pan?(this.spinnerService.show("Please Wait Data is Saving"),console.log("saveing cutomer prodile",this.form.value),this.masterservice.saveCustomerProfile(this.form.value,this.mode).subscribe(oe=>{"ok"==oe.status?(this.closeDialog(),this.spinnerService.hide(),"ProceedConfirmation"==oe.result?confirm("Member is not Created in  Server.Do you want to Process..")?(this.form.value.FurtherProceed="ProceedConfirmationYes",this.submit(this.form.value)):(this.onclear(),this.alertService.hide()):(this.onclear(),this.alertService.info(oe.result),setTimeout(()=>{this.alertService.hide()},500),this.alertService.emitShowHideSubject.subscribe(me=>{setTimeout(()=>{document.getElementById("barcode"+this.activerowIndex).focus()},0)}),this.onSave.emit(oe.result2))):(this.alertService.info(oe.result),this.spinnerService.hide())},oe=>{this.spinnerService.hide()})):this.alertService.info("PAN/VAT No is Required")):this.alertService.info("Please Enter Mobile No. First!")}onclear(){this.form.reset(),1==this.masterservice.userSetting.CREATE_CPROFILE_AS_MEMBER&&this.form.controls.createMember.patchValue(!0)}closeDialog(){this.isActive=!1,this.masterservice.customerpopup=!1}keyPress(K){const me=String.fromCharCode(K.charCode);/[0-9]/.test(me)||K.preventDefault()}show(){this.isActive=!0,this.forminit(),this.masterservice.customerpopup=!0,setTimeout(()=>{this.customerName.nativeElement.focus()},10)}hide(){this.isActive=!1,this.masterservice.customerpopup=!1}handleKeyDownboardEvent(K){"Escape"==K.code&&(K.preventDefault(),this.closeDialog()),"End"==K.code&&(this.form.invalid||(K.preventDefault(),this.submit(this.form.value)))}onItemSelect(K){console.log(K)}onSelectAll(K){console.log(K)}}return Y.\u0275fac=function(K){return new(K||Y)(e.Y36(t.qu),e.Y36(M.P),e.Y36(ee.p),e.Y36($.c),e.Y36(S.V))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["create-customer-dialog"]],viewQuery:function(K,oe){if(1&K&&e.Gf(C,5),2&K){let me;e.iGM(me=e.CRH())&&(oe.customerName=me.first)}},hostBindings:function(K,oe){1&K&&e.NdJ("keydown",function(Ne){return oe.handleKeyDownboardEvent(Ne)},!1,e.evT)},outputs:{onSave:"onSave"},decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["type","button","title","reset",1,"btn","btn-info",2,"margin-right","2px",3,"click","keydown.F3"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-horizontal",2,"margin-top","15px",3,"formGroup"],[1,"form-group","row"],[1,"col-sm-3","form-control-label",2,"margin-left","-12px"],[1,"col-sm-5"],["type","text","placeholder","NAME","formControlName","name",1,"form-control"],["customerName",""],["class","invalid-feedback d-block",4,"ngIf"],["type","text","placeholder","ADDRESS","formControlName","address",1,"form-control"],["type","text","placeholder","PANNO","formControlName","pan","maxlength","9","minlength","9",1,"form-control",3,"keypress"],["type","text","placeholder","PHONE NO","formControlName","phoneNo",1,"form-control"],["type","text","placeholder","MOBILE NO","formControlName","mobNo","maxlength","10","minlength","10",1,"form-control",3,"keypress"],["class","form-group row",4,"ngIf"],["type","email","placeholder","EMAIL","formControlName","email",1,"form-control"],["formControlName","SCHEMEID",1,"form-control",2,"padding","0px 5px"],[4,"ngFor","ngForOf"],[1,"invalid-feedback","d-block"],[4,"ngIf"],["formControlName","MOBILENO_REG_IN",1,"form-control",2,"padding","0px 5px"],["value",""],["value","VIBER"],["value","WHATSAPP"],[3,"ngValue"],["type","checkbox","id","createMember","formControlName","createMember",1,"form-control",2,"height","59%","width","5%",3,"change"],[1,"form-control-label",2,"width","100%","margin-top","-3%","margin-left","6%"],[1,"col-sm-3"]],template:function(K,oe){1&K&&e.YNc(0,Me,62,14,"div",0),2&K&&e.Q6J("ngIf",oe.isActive)},dependencies:[J.sg,J.O5,t._Y,t.YN,t.Kr,t.Fj,t.Wl,t.EJ,t.JJ,t.JL,t.wO,t.nD,t.sg,t.u],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:60%;top:14.5%;left:22%;border-radius:.65rem}.card[_ngcontent-%COMP%]{box-shadow:#00000026 0 2px 8px;border-radius:.65rem}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}.selectbox[_ngcontent-%COMP%]{padding:0 8px}"]}),Y})()},65705:(ve,ce,b)=>{b.d(ce,{C:()=>Z});var e=b(88692),t=b(54536),O=b(42326),M=b(64537),ee=b(53074),$=b(67311),S=b(87584),J=b(20092),C=b(89952);function _(k,X){if(1&k){const H=M.EpF();M.TgZ(0,"tr")(1,"td")(2,"input",21),M.NdJ("ngModelChange",function(y){const L=M.CHM(H).$implicit;return M.KtG(L.sno=y)}),M.qZA()(),M.TgZ(3,"td"),M._UZ(4,"input",22),M.qZA(),M.TgZ(5,"td")(6,"input",23),M.NdJ("ngModelChange",function(y){const L=M.CHM(H).$implicit;return M.KtG(L.discountRate=y)})("blur",function(){const f=M.CHM(H).index,L=M.oxw();return M.KtG(L.onChangeDiscountRate(f))}),M.qZA()(),M.TgZ(7,"td")(8,"input",23),M.NdJ("ngModelChange",function(y){const L=M.CHM(H).$implicit;return M.KtG(L.discountAmount=y)})("blur",function(){const f=M.CHM(H).index,L=M.oxw();return M.KtG(L.calculateAmount(f))}),M.qZA()(),M.TgZ(9,"td"),M._UZ(10,"input",24),M.qZA()()}if(2&k){const H=X.$implicit,j=X.index,y=M.oxw();M.xp6(2),M.MGl("id","sno",j,""),M.Q6J("ngModel",H.sno),M.xp6(2),M.MGl("id","discountName",j,""),M.Q6J("value",H.discountName),M.xp6(2),M.MGl("id","discountRate",j,""),M.Q6J("ngModel",H.discountRate)("disabled",y.disableContent()||y.shouldDisableRow(j)),M.xp6(2),M.MGl("id","discountAmount",j,""),M.Q6J("ngModel",H.discountAmount)("disabled",y.disableContent()||y.shouldDisableRow(j)),M.xp6(2),M.MGl("id","amountAfterDiscount",j,""),M.Q6J("value",H.amountAfterDiscount)}}let Z=(()=>{class k{constructor(H,j,y,f,L,x){this.dialogRef=H,this.masterService=j,this._alertService=y,this._trnMainService=f,this.decimalPipe=L,this.discountNameList=[],this.DiscountObj={discountRowDetail:[],totalAmount:0,totalDiscountAmount:0,netAmount:0},this.totalAmount=0,this.discountableAmount=0,this.totalDiscount=0,this.netAmount=0,this.originalNetAmount=0,this.mode="ADD",this.flatRate=0,this.indDiscountSum=0,this.totalECSAmount=0,this.isDiscountsAvailable=!1,this.isSO=!1,this.data=x,this.totalAmount=x.grossAmount?x.grossAmount:0,this.DiscountObj.totalAmount=x.grossAmount?x.grossAmount:0,this.indDiscountSum=x.totalIndDiscount?x.totalIndDiscount:0,this.totalECSAmount=x.ecsAmount?x.ecsAmount:0,this.flatDiscountCalcType=x.flatDisCalcType,this.formMode=x.object.Mode,this.voucherabbName=x.object.VoucherAbbName,this.trnObject=x.object,this.activeurlpath=x.urlPath,this._trnMainService.TrnMainObj.VoucherType=x.object.VoucherType,this.trnObject.ProdList.forEach("after"===this.flatDiscountCalcType?m=>{this._trnMainService.checkDiscountMode(m)&&null!=m.MENUCODE&&null!=m.MENUCODE&&(this.discountableAmount+=this._trnMainService.nullToZeroConverter(m.ALTERNATEQUANTIY*m.ALTRATE)+this._trnMainService.nullToZeroConverter(m.ECSAMOUNT)-this._trnMainService.nullToZeroConverter(m.RATEDISCOUNT)-this._trnMainService.nullToZeroConverter(m.INDDISCOUNT))}:m=>{this._trnMainService.checkDiscountMode(m)&&null!=m.MENUCODE&&null!=m.MENUCODE&&(this.discountableAmount+=this._trnMainService.nullToZeroConverter(m.ALTERNATEQUANTIY*m.ALTRATE)+this._trnMainService.nullToZeroConverter(m.ECSAMOUNT)-this._trnMainService.nullToZeroConverter(m.RATEDISCOUNT))}),this.netAmount=this.discountableAmount,this.originalNetAmount=this.discountableAmount,this.isSO=!(!this.trnObject.REFORDBILL||!this.trnObject.REFORDBILL.startsWith("SO")),this.initialDiscountObj?.discountRowDetail.forEach(m=>{m.discountAmount=0,m.discountRate=0,m.amountAfterDiscount=0}),this.initialDiscountObj=x.listDiscounts}ngOnInit(){this.masterService.getDiscountNames().subscribe(H=>{this.discountNameList=H.result,this.populateDiscountDetails()})}onKeydownHandler(H){this.cancel()}cancel(){this.DiscountObj.totalDiscountAmount=this.totalDiscount?this.totalDiscount:0,this.DiscountObj.netAmount=this.netAmount?this.netAmount:0;const H=Array.isArray(this.initialDiscountObj?.discountRowDetail)&&this.initialDiscountObj.discountRowDetail.some(j=>j.discountAmount>0&&null!=j.discountAmount);("abbreviated-sales-invoice"===this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"add-sales-invoice"==this.activeurlpath)&&this.isSO||this._trnMainService.TrnMainObj.VoucherType!=O.Km.PerformaSalesInvoice&&"PP"==this._trnMainService.TrnMainObj.VoucherAbbName||"VIEW"==this.formMode?this.dialogRef.close(this.DiscountObj):"NEW"!=this.formMode&&"EDIT"!=this.formMode||!H?this.dialogRef.close(null):(this.initialDiscountObj.totalDiscountAmount=this.initialDiscountObj?.discountRowDetail.reduce((j,y)=>j+(y.discountAmount??0),0),this.dialogRef.close(this.initialDiscountObj))}apply(){this.DiscountObj.discountRowDetail.some(j=>j.discountAmount>0&&null!=j.discountAmount)?(this.DiscountObj.totalDiscountAmount=parseFloat(Number(this.totalDiscount?this.totalDiscount:0).toFixed(2)),this.DiscountObj.netAmount=parseFloat(Number(this.netAmount?this.netAmount:0).toFixed(2))):(this.resetDiscountDetails(),this.DiscountObj.totalDiscountAmount=0),this.dialogRef.close(this.DiscountObj)}resetDiscountDetails(){this.DiscountObj.discountRowDetail.forEach(H=>{H.discountAmount=0,H.discountRate=0,H.amountAfterDiscount=0}),this.updateTotalDiscountAndNetAmount()}populateDiscountDetails(){this.data.listDiscounts&&this.data.listDiscounts.discountRowDetail&&this.data.listDiscounts.discountRowDetail.length>0?(this.DiscountObj.discountRowDetail=this.data.listDiscounts.discountRowDetail.map((H,j)=>({sno:j+1,discountName:H.discountName,discountAmount:H.discountAmount,discountRate:H.discountRate,amountAfterDiscount:H.amountAfterDiscount})),this.mode="VIEW"):this.discountNameList.forEach(H=>{this.DiscountObj.discountRowDetail.push({sno:this.DiscountObj.discountRowDetail.length+1,discountName:H.discountName,discountAmount:0,discountRate:0,amountAfterDiscount:0})}),this.updateTotalDiscountAndNetAmount()}calculateAmount(H,j=!0){const y=this.DiscountObj.discountRowDetail[H];let f=y.discountAmount;if(f<0&&(this._alertService.info("Discount amount cannot be negative!!!"),y.discountAmount=0,f=0),f>this.netAmount)return this._alertService.info("Discount amount cannot be greater than the total amount!!!"),void(y.discountAmount=0);this.changedAmount!=f&&(0===H?y.amountAfterDiscount=this.originalNetAmount-f:(y.amountAfterDiscount=(this.DiscountObj.discountRowDetail[H-1].amountAfterDiscount||this.originalNetAmount)-f,y.amountAfterDiscount=parseFloat(y.amountAfterDiscount.toFixed(2))),j&&(y.discountRate=100*f/(0===H?this.originalNetAmount:this.DiscountObj.discountRowDetail[H-1].amountAfterDiscount||this.originalNetAmount),y.discountRate=parseFloat(y.discountRate.toFixed(2))),this.updateTotalDiscountAndNetAmount())}onChangeDiscountRate(H){const j=this.DiscountObj.discountRowDetail[H];let y=j.discountRate;if(y<0)return this._alertService.info("Discount rate cannot be negative!!!"),j.discountRate=0,void(y=0);if(y>100)return this._alertService.info("Discount rate cannot be more than 100%!!!"),void(j.discountRate=0);if(0===H)j.discountAmount=parseFloat((y/100*this.originalNetAmount).toFixed(2)),j.amountAfterDiscount=parseFloat((this.originalNetAmount-j.discountAmount).toFixed(2));else{const f=this.DiscountObj.discountRowDetail[H-1];j.discountAmount=parseFloat((y/100*(f.amountAfterDiscount||this.originalNetAmount)).toFixed(2)),j.amountAfterDiscount=parseFloat(((f.amountAfterDiscount||this.originalNetAmount)-j.discountAmount).toFixed(2))}this.changedAmount=j.discountAmount,this.updateTotalDiscountAndNetAmount()}updateTotalDiscountAndNetAmount(){this.totalDiscount=this.DiscountObj.discountRowDetail.reduce((H,j)=>H+(j.discountAmount||0),0),this.netAmount=parseFloat((this.originalNetAmount-this.totalDiscount).toFixed(2)),this.DiscountObj.discountRowDetail.forEach((H,j)=>{0===j&&H.discountAmount>0?H.amountAfterDiscount=parseFloat((this.originalNetAmount-H.discountAmount).toFixed(2)):H.discountAmount>0&&(H.amountAfterDiscount=parseFloat(((this.DiscountObj.discountRowDetail[j-1].amountAfterDiscount||this.originalNetAmount)-H.discountAmount).toFixed(2))),H.discountAmount=parseFloat((H.discountAmount||0).toFixed(2))})}shouldDisableRow(H){for(let j=H+1;j<this.DiscountObj.discountRowDetail.length;j++){const y=this.DiscountObj.discountRowDetail[j];if(0!=y.discountAmount||0!=y.discountRate)return!0}return!1}disableContent(){return!("abbreviated-sales-invoice"!==this.activeurlpath&&"add-sales-invoice-wholesale"!=this.activeurlpath&&"add-sales-invoice"!=this.activeurlpath||!this.isSO)||("EDIT"!=this.formMode||"PP"!=this.voucherabbName)&&("VIEW"==this.formMode||"PP"==this.voucherabbName)}}return k.\u0275fac=function(H){return new(H||k)(M.Y36(t.so),M.Y36(ee.P),M.Y36($.c),M.Y36(S.p),M.Y36(e.JJ),M.Y36(t.WI))},k.\u0275cmp=M.Xpm({type:k,selectors:[["app-discount-detail-popup"]],hostBindings:function(H,j){1&H&&M.NdJ("keydown.escape",function(f){return j.onKeydownHandler(f)},!1,M.evT)},features:[M._Bn([e.JJ])],decls:64,vars:16,consts:[[1,"backdrop","mt-5","pt-5"],[1,"container","main-container"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-lg-7","col-md-7","col-sm-12"],[1,"legend-class"],[1,"col-lg-6","col-md-6","col-sm-12"],[1,"m-0"],[1,"ml-2"],[1,"col-lg-5","col-md-5","col-sm-12"],[1,"btn","btn-info","pull-right",3,"disabled","click"],[1,"btn","btn-info","pull-right",3,"click"],[1,"table-wrap","col-md-12"],[1,"input-width","table","table-striped"],[1,"snWidth"],[4,"ngFor","ngForOf"],[1,"card-footer"],[1,"col-md-12"],[1,"ml-5","mr-5","pull-right"],["disabled","",1,"input-width","input-number",3,"id","ngModel","ngModelChange"],["type","text","disabled","",1,"input-width",3,"id","value"],["type","number",1,"input-width","input-number",3,"id","ngModel","disabled","ngModelChange","blur"],["type","number","disabled","",1,"input-width","input-number",3,"id","value"]],template:function(H,j){1&H&&(M.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4"),M._uU(5,"Additional Discount Detail"),M.qZA()(),M.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"fieldset")(10,"legend",7),M._uU(11,"Discount Details :"),M.qZA(),M.TgZ(12,"div",5)(13,"div",8)(14,"p",9),M._uU(15,"Gross Amount:"),M.TgZ(16,"span",10),M._uU(17),M.ALo(18,"twoDigitNumber"),M.qZA()()(),M.TgZ(19,"div",8)(20,"p",9),M._uU(21,"Discountable Amount:"),M.TgZ(22,"span",10),M._uU(23),M.ALo(24,"twoDigitNumber"),M.qZA()()()()()(),M.TgZ(25,"div",11)(26,"button",12),M.NdJ("click",function(){return j.apply()}),M._uU(27,"Apply"),M.qZA(),M.TgZ(28,"button",12),M.NdJ("click",function(){return j.resetDiscountDetails()}),M._uU(29,"Reset"),M.qZA(),M.TgZ(30,"button",13),M.NdJ("click",function(){return j.cancel()}),M._uU(31,"Cancel"),M.qZA()()(),M.TgZ(32,"div",5)(33,"div",14)(34,"table",15)(35,"thead")(36,"tr")(37,"th",16),M._uU(38,"S.No."),M.qZA(),M.TgZ(39,"th"),M._uU(40,"Discount Name"),M.qZA(),M.TgZ(41,"th"),M._uU(42,"Discount Rate"),M.qZA(),M.TgZ(43,"th"),M._uU(44,"Discount Amount"),M.qZA(),M.TgZ(45,"th"),M._uU(46,"Amount(After Discount)"),M.qZA()()(),M.TgZ(47,"tbody"),M.YNc(48,_,11,12,"tr",17),M.qZA()()()()(),M.TgZ(49,"div",18)(50,"div",5)(51,"div",19)(52,"div",20)(53,"p"),M._uU(54,"Net Amount:"),M.TgZ(55,"span",10),M._uU(56),M.ALo(57,"number"),M.qZA()()(),M.TgZ(58,"div",20)(59,"p"),M._uU(60,"Total Additional Discount:"),M.TgZ(61,"span",10),M._uU(62),M.ALo(63,"twoDigitNumber"),M.qZA()()()()()()()()()),2&H&&(M.xp6(17),M.Oqu(M.lcZ(18,7,j.DiscountObj.totalAmount)),M.xp6(6),M.Oqu(M.lcZ(24,9,j.discountableAmount)),M.xp6(3),M.Q6J("disabled",j.disableContent()),M.xp6(2),M.Q6J("disabled",j.disableContent()),M.xp6(20),M.Q6J("ngForOf",j.DiscountObj.discountRowDetail),M.xp6(8),M.Oqu(M.xi3(57,11,j.netAmount,"1.2-2")),M.xp6(6),M.Oqu(M.lcZ(63,14,j.totalDiscount)))},dependencies:[e.sg,J.Fj,J.wV,J.JJ,J.On,e.JJ,C.g],styles:[".main-container[_ngcontent-%COMP%]{height:auto}.card[_ngcontent-%COMP%]{height:auto;margin-left:auto;margin-right:auto}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}legend[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#222;width:auto}fieldset[_ngcontent-%COMP%]{margin-bottom:1%;border:1px solid #dbd7d7}.legend-class[_ngcontent-%COMP%]{font-size:13px;font-weight:700;width:auto;margin-bottom:-4px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:26px;font-size:14px;padding-top:0;padding-bottom:0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.2rem;vertical-align:top;border-top:1px solid #dee2e6;font-size:14px}th[_ngcontent-%COMP%]{position:sticky;top:-1px;z-index:1;background-color:#6599ff;color:#fff}th[_ngcontent-%COMP%]:first-child{border-bottom:1px solid #dee2e6}.input-width[_ngcontent-%COMP%]{width:100%}.input-number[_ngcontent-%COMP%], .footer-number[_ngcontent-%COMP%]{text-align:right}.btn-info[_ngcontent-%COMP%]{padding:8px 20px;border-radius:2px;font-size:12px;margin:13px 3px!important}.snWidth[_ngcontent-%COMP%]{width:8%}"]}),k})()},11728:(ve,ce,b)=>{b.d(ce,{q:()=>f});var e=b(64537),t=b(5881),O=b(92886),M=b(67311),ee=b(14970),$=b(87584),S=b(53074),J=b(46241),C=b(20092);let _=(()=>{class L{clearSignature(){L.clearSignature()}static onClearSig(m,I){window.sdkPtr.ResponseStatus.OK!=I&&(J.SigCapture.print("ClearSignature() error: "+I),window.sdkPtr.ResponseStatus.INVALID_SESSION==I&&(J.SigCapture.print("Session error. Restarting the session."),t.SessionControl.actionWhenRestarted()))}}return L.clearSignature=()=>{null!=J.SigCapture.HTMLTagIds.imageBox.firstChild&&J.SigCapture.HTMLTagIds.imageBox.removeChild(J.SigCapture.HTMLTagIds.imageBox.firstChild),null!=J.SigCapture.sigObj?J.SigCapture.sigObj.Clear(L.onClearSig):t.SessionControl.actionWhenRestarted()},L.\u0275fac=function(m){return new(m||L)},L.\u0275cmp=e.Xpm({type:L,selectors:[["btn-clear"]],decls:1,vars:0,consts:[["type","button","value","Clear","title","Clears the signature",2,"height","10mm","width","35mm",3,"click"]],template:function(m,I){1&m&&(e.TgZ(0,"input",0),e.NdJ("click",function(){return I.clearSignature()}),e.qZA())},encapsulation:2}),L})();var Z=b(88692);function k(L,x){1&L&&(e.TgZ(0,"td",10),e._UZ(1,"btn-capture"),e.qZA())}function X(L,x){1&L&&(e.TgZ(0,"td",10),e._UZ(1,"btn-clear"),e.qZA())}function H(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"td",10)(1,"input",11),e.NdJ("click",function(){e.CHM(m);const P=e.oxw();return e.KtG(P.onSaveClick())}),e.qZA()()}}let j=(()=>{class L{constructor(m){this._trnMainService=m,this.firstName="",this.lastName="",this.reason="Inventory Assign Approval",this.onImageCaptured=new e.vpe}ngOnChanges(){}ngAfterViewInit(){t.SessionControl.actionWhenRestarted()}onSaveClick(){t.SessionControl.actionWhenRestarted(),J.SigCapture.HTMLTagIds.getImageString$().subscribe(m=>{this.onImageCaptured.emit(m)})}}return L.\u0275fac=function(m){return new(m||L)(e.Y36($.p))},L.\u0275cmp=e.Xpm({type:L,selectors:[["signature-pad"]],inputs:{firstName:"firstName",lastName:"lastName",reason:"reason"},outputs:{onImageCaptured:"onImageCaptured"},features:[e.TTD],decls:16,vars:5,consts:[[2,"width","100%"],[1,"col-md-12","row","pd0","mb-3","mt-3"],[1,"col-md-10","pd0"],[2,"width","25%"],["id","fname","type","text","autocomplete","off","placeholder","Enter First Name","readonly","",2,"width","50%",3,"ngModel","value","ngModelChange"],[1,"mb-4"],["rowspan","3"],["id","imageBox","ondblclick","displaySignatureDetails(sigObj)","title","Double-click a signature to display its details",1,"boxed",2,"height","45mm","width","70mm","border","1px solid #d3d3d3"],["style","padding: 10px 20px;",4,"ngIf"],["style","padding: 10px 20px",4,"ngIf"],[2,"padding","10px 20px"],["type","button","value","Save",2,"height","10mm","width","35mm",3,"click"]],template:function(m,I){1&m&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),e._uU(4,"From Warehouse :"),e.qZA(),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(w){return I.firstName=w}),e.qZA()()(),e.TgZ(6,"table",5)(7,"tr")(8,"td",6),e._UZ(9,"div",7),e.qZA(),e.YNc(10,k,2,0,"td",8),e.qZA(),e.TgZ(11,"tr"),e.YNc(12,X,2,0,"td",8),e.qZA(),e.TgZ(13,"tr"),e.YNc(14,H,2,0,"td",9),e.qZA(),e._UZ(15,"tr"),e.qZA()()),2&m&&(e.xp6(5),e.Q6J("ngModel",I.firstName)("value",I.firstName),e.xp6(5),e.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode))},dependencies:[C.Fj,C.JJ,C.On,_,J.SigCapture,Z.O5],encapsulation:2}),L})();const y=["fileSelect"];let f=(()=>{class L{constructor(m,I,P,w,Q){this.digitalSignatureService=m,this.alertService=I,this.loadingService=P,this._trnMainService=w,this.masterService=Q,this.selectedFileNames=[],this.isActive=!1,this.dragging=!1,this.doUploadFile=!0,this.onPopUpClose=new e.vpe,this.onSaveImageCaptured=new e.vpe}onDragOver(m){this.dragging=!0,m.preventDefault()}show(m,I){this.isActive=!0;let P=document.getElementById("imageBox");t.SessionControl.actionWhenRestarted();let w=new Image;"VIEW"==I&&m&&(w.src=m,P.appendChild(w))}hide(){this.isActive=!1}popupClose(){this.onPopUpClose.emit(),this.hide()}ngOnChanges(m){}onImageCaptured(m){m&&(this.onSaveImageCaptured.emit(m),this.hide())}}return L.\u0275fac=function(m){return new(m||L)(e.Y36(O.M),e.Y36(M.c),e.Y36(ee.V),e.Y36($.p),e.Y36(S.P))},L.\u0275cmp=e.Xpm({type:L,selectors:[["digital-signature-popup"]],viewQuery:function(m,I){if(1&m&&e.Gf(y,5),2&m){let P;e.iGM(P=e.CRH())&&(I.fileSelect=P.first)}},outputs:{onPopUpClose:"onPopUpClose",onSaveImageCaptured:"onSaveImageCaptured"},features:[e.TTD],decls:11,vars:3,consts:[[1,"modal-sticky",2,"display","block","padding","0px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"text-align","center"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"upload-area","container"],["lastName","","reason","document app",3,"firstName","onImageCaptured"]],template:function(m,I){1&m&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"h5",3),e._uU(5," Digital Signature "),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return I.popupClose()}),e.TgZ(7,"span",5),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",6)(10,"signature-pad",7),e.NdJ("onImageCaptured",function(w){return I.onImageCaptured(w)}),e.qZA()()()()()),2&m&&(e.ekj("modal-sticky-hide",!I.isActive),e.xp6(10),e.Q6J("firstName",I._trnMainService.TrnMainObj.BILLTO))},dependencies:[j],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.form-control[_ngcontent-%COMP%]{height:35px}.modal-sticky[_ngcontent-%COMP%]{position:fixed;top:330px;right:20px;width:40%;z-index:9999999}"]}),L})()},9267:(ve,ce,b)=>{b.d(ce,{r:()=>re});var e=b(64537),t=b(53074),O=b(67311),M=b(87584),ee=b(14970),$=b(67297),S=b(88692),J=b(20092);const C=function(){return{width:"80px"}},_=function(){return{width:"118px"}};function Z(ae,Me){if(1&ae&&(e.TgZ(0,"th",21),e._uU(1,"Dis%"),e.qZA()),2&ae){const G=e.oxw(2);e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(1,C):e.DdM(2,_))}}function k(ae,Me){if(1&ae&&(e.TgZ(0,"th",21),e._uU(1,"Dis Amt"),e.qZA()),2&ae){const G=e.oxw(2);e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(1,C):e.DdM(2,_))}}function X(ae,Me){if(1&ae&&(e.TgZ(0,"th",21),e._uU(1,"Net Rate"),e.qZA()),2&ae){const G=e.oxw(2);e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(1,C):e.DdM(2,_))}}function H(ae,Me){if(1&ae){const G=e.EpF();e.TgZ(0,"td",31)(1,"input",42),e.NdJ("ngModelChange",function(z){e.CHM(G);const K=e.oxw().$implicit;return e.KtG(K.DISCOUNT_RATE=z)})("change",function(){e.CHM(G);const z=e.oxw().index,K=e.oxw(2);return e.KtG(K.DiscountPercentChange(z))})("keyup.Tab",function(){e.CHM(G);const z=e.oxw().index,K=e.oxw(2);return e.KtG(K.DiscountPercentChange(z))})("keyup.Enter",function(){e.CHM(G);const z=e.oxw().index,K=e.oxw(2);return e.KtG(K.DiscountPercentChange(z))}),e.qZA()()}if(2&ae){const G=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",G.DISCOUNT_RATE)}}function j(ae,Me){if(1&ae){const G=e.EpF();e.TgZ(0,"td",31)(1,"input",48),e.NdJ("ngModelChange",function(z){e.CHM(G);const K=e.oxw().$implicit;return e.KtG(K.DISCOUNT_AMOUNT=z)}),e.qZA()()}if(2&ae){const G=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",G.DISCOUNT_AMOUNT)}}function y(ae,Me){if(1&ae){const G=e.EpF();e.TgZ(0,"td",31)(1,"input",48),e.NdJ("ngModelChange",function(z){e.CHM(G);const K=e.oxw().$implicit;return e.KtG(K.NET_RATE=z)}),e.qZA()()}if(2&ae){const G=e.oxw().$implicit;e.xp6(1),e.Q6J("ngModel",G.NET_RATE)}}const f=function(){return{width:"150px"}},L=function(){return{width:"165px"}};function x(ae,Me){if(1&ae){const G=e.EpF();e.TgZ(0,"tr")(1,"td",29)(2,"label",30),e._uU(3),e.qZA()(),e.TgZ(4,"td",31)(5,"input",32),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.MENUCODE=z)}),e.qZA()(),e.TgZ(6,"td",33)(7,"input",34),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.DESCA=z)}),e.qZA()(),e.TgZ(8,"td",35)(9,"input",32),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.UNIT=z)}),e.qZA()(),e.TgZ(10,"td",36)(11,"input",37),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.RATE=z)}),e.qZA()(),e.TgZ(12,"td",38)(13,"input",39),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.ORDERQTY=z)}),e.qZA()(),e.TgZ(14,"td",40)(15,"input",41),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.DELIVERQTY=z)})("change",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverQty(K))})("keyup.Tab",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverQty(K))})("keyup.Enter",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverQty(K))}),e.qZA()(),e.TgZ(16,"td",31)(17,"input",42),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.DELIVERRATE=z)})("change",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverRate(K))})("keyup.Tab",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverRate(K))})("keyup.Enter",function(){const K=e.CHM(G).index,oe=e.oxw(2);return e.KtG(oe.ValidateDeliverRate(K))}),e.qZA()(),e.YNc(18,H,2,1,"td",43),e.YNc(19,j,2,1,"td",43),e.YNc(20,y,2,1,"td",43),e.TgZ(21,"td",44)(22,"input",45),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.AMOUNT=z)}),e.qZA()(),e.TgZ(23,"td",46)(24,"input",47),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.MFGDATE=z)}),e.qZA()(),e.TgZ(25,"td",46)(26,"input",47),e.NdJ("ngModelChange",function(z){const oe=e.CHM(G).$implicit;return e.KtG(oe.EXPIRYDATE=z)}),e.qZA()()()}if(2&ae){const G=Me.$implicit,Y=Me.index,z=e.oxw(2);e.xp6(3),e.Oqu(Y+1),e.xp6(2),e.Q6J("ngModel",G.MENUCODE),e.xp6(2),e.Q6J("ngModel",G.DESCA),e.xp6(2),e.Q6J("ngModel",G.UNIT),e.xp6(2),e.Q6J("ngModel",G.RATE),e.xp6(2),e.Q6J("ngModel",G.ORDERQTY),e.xp6(2),e.Q6J("ngModel",G.DELIVERQTY),e.xp6(2),e.Q6J("ngModel",G.DELIVERRATE),e.xp6(1),e.Q6J("ngIf",z.masterService.is_PurchaseOrder),e.xp6(1),e.Q6J("ngIf",z.masterService.is_PurchaseOrder),e.xp6(1),e.Q6J("ngIf",z.masterService.is_PurchaseOrder),e.xp6(2),e.Q6J("ngModel",G.AMOUNT)("readonly",!0),e.xp6(2),e.Q6J("ngStyle",1==z.masterService.is_PurchaseOrder?e.DdM(17,f):e.DdM(18,L))("ngModel",G.MFGDATE),e.xp6(2),e.Q6J("ngStyle",1==z.masterService.is_PurchaseOrder?e.DdM(19,f):e.DdM(20,L))("ngModel",G.EXPIRYDATE)}}const m=function(){return{width:"45px"}},I=function(){return{width:"0px"}},P=function(){return{width:"60px"}},w=function(){return{width:"100px"}},Q=function(){return{width:"65px"}},U=function(){return{width:"55px"}},B=function(){return{width:"70px"}},q=function(){return{width:"180px"}};function W(ae,Me){if(1&ae){const G=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h4",5),e._uU(5),e.qZA()()(),e.TgZ(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",7)(10,"div",9)(11,"label"),e._uU(12,"Order No. :"),e.qZA(),e.TgZ(13,"label",10),e._uU(14),e.qZA()()(),e.TgZ(15,"div",7)(16,"div",9)(17,"label"),e._uU(18,"Order Date :"),e.qZA(),e.TgZ(19,"label",10),e._uU(20),e.qZA()()()(),e.TgZ(21,"div",8)(22,"div",7)(23,"div")(24,"label"),e._uU(25,"Supplier Name :"),e.qZA(),e.TgZ(26,"label",11),e._uU(27),e.qZA()()()(),e.TgZ(28,"div",8)(29,"div",7)(30,"div",9)(31,"input",12),e.NdJ("ngModelChange",function(z){e.CHM(G);const K=e.oxw();return e.KtG(K.sameQty=z)})("change",function(){e.CHM(G);const z=e.oxw();return e.KtG(z.QtySameAsOrderQty(z.sameQty))}),e.qZA(),e.TgZ(32,"label",10),e._uU(33,"Qty Same as Order Qty"),e.qZA()()(),e.TgZ(34,"div",7)(35,"div",9)(36,"input",12),e.NdJ("ngModelChange",function(z){e.CHM(G);const K=e.oxw();return e.KtG(K.sameRate=z)})("change",function(){e.CHM(G);const z=e.oxw();return e.KtG(z.QtySameAsOrderRate(z.sameRate))}),e.qZA(),e.TgZ(37,"label",10),e._uU(38,"Rate Same as Order Rate"),e.qZA()()()()(),e.TgZ(39,"table",13)(40,"thead",14)(41,"tr")(42,"th",15),e._uU(43,"SI NO "),e.qZA(),e.TgZ(44,"th",16),e._uU(45,"Item Code"),e.qZA(),e.TgZ(46,"th",17),e._uU(47,"Item Name"),e.qZA(),e.TgZ(48,"th",18),e._uU(49,"Unit"),e.qZA(),e.TgZ(50,"th",19),e._uU(51,"Order Rate"),e.qZA(),e.TgZ(52,"th",20),e._uU(53,"Order Qty"),e.qZA(),e.TgZ(54,"th",20),e._uU(55,"Deliver Qty"),e.qZA(),e.TgZ(56,"th",21),e._uU(57,"Rate"),e.qZA(),e.YNc(58,Z,2,3,"th",22),e.YNc(59,k,2,3,"th",22),e.YNc(60,X,2,3,"th",22),e.TgZ(61,"th",23),e._uU(62,"Amount"),e.qZA(),e.TgZ(63,"th",24),e._uU(64,"Mfg Date"),e.qZA(),e.TgZ(65,"th",24),e._uU(66,"Exp Date"),e.qZA()()(),e.TgZ(67,"tbody",25),e.YNc(68,x,27,21,"tr",26),e.qZA()()(),e.TgZ(69,"div",27)(70,"button",28),e.NdJ("click",function(){e.CHM(G);const z=e.oxw();return e.KtG(z.OkCommand())}),e._uU(71,"Ok"),e.qZA(),e.TgZ(72,"button",28),e.NdJ("click",function(){e.CHM(G);const z=e.oxw();return e.KtG(z.hide())}),e._uU(73,"Cancel"),e.qZA()()()()}if(2&ae){const G=e.oxw();e.xp6(5),e.Oqu(G.masterService.Popup_Heading),e.xp6(9),e.Oqu(G.masterService.PO_Voucherno),e.xp6(6),e.Oqu(G.masterService.PO_Date),e.xp6(7),e.Oqu(G.masterService.SupplierName),e.xp6(4),e.Q6J("ngModel",G.sameQty),e.xp6(5),e.Q6J("ngModel",G.sameRate),e.xp6(6),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(19,m):e.DdM(20,I)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(21,P):e.DdM(22,w)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(23,w):e.DdM(24,f)),e.xp6(2),e.Q6J("ngStyle",e.DdM(1==G.masterService.is_PurchaseOrder?25:26,Q)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(27,C):e.DdM(28,I)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(29,U):e.DdM(30,I)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(31,P):e.DdM(32,I)),e.xp6(2),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(33,B):e.DdM(34,_)),e.xp6(2),e.Q6J("ngIf",G.masterService.is_PurchaseOrder),e.xp6(1),e.Q6J("ngIf",G.masterService.is_PurchaseOrder),e.xp6(1),e.Q6J("ngIf",G.masterService.is_PurchaseOrder),e.xp6(1),e.Q6J("ngStyle",1==G.masterService.is_PurchaseOrder?e.DdM(35,C):e.DdM(36,q)),e.xp6(7),e.Q6J("ngForOf",G._trnMainService.TrnMainObj.PODetailList)}}let re=(()=>{class ae{constructor(G,Y,z,K,oe){this.masterService=G,this.alertService=Y,this._trnMainService=z,this.spinnerService=K,this._authService=oe,this.onLoadPO=new e.vpe,this.userSetting=oe.getSetting()}ngOnInit(){}show(){this.isActive=!0}hide(){this.isActive=!1}CalculateAmount(G){this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE&&(this._trnMainService.TrnMainObj.PODetailList[G].AMOUNT=this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY*this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE)}ValidateDeliverRate(G){if(this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE&&this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE<this._trnMainService.TrnMainObj.PODetailList[G].RATE){if(!confirm("Deliver Rate is less than Order Rate.Do you want to continue?"))return;1==this.masterService.is_PurchaseOrder&&1===this.userSetting.HALTSPRICECHAGEDASKED&&(this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(G)),this.CalculateAmount(G)}if(this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE>this._trnMainService.TrnMainObj.PODetailList[G].RATE)return this.alertService.info("Deliver Rate is greater than Order Rate"),void this.alertService.emitShowHideSubject.subscribe(Y=>{setTimeout(()=>{this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE=0,this.CalculateAmount(G)},0)});this.CalculateAmount(G)}ValidateDeliverQty(G){if(this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY&&this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY<this._trnMainService.TrnMainObj.PODetailList[G].ORDERQTY){if(!confirm("Deliver Qty is less than Order Qty.Do you want to continue?"))return;this.CalculateAmount(G)}if(this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY>this._trnMainService.TrnMainObj.PODetailList[G].ORDERQTY)return this.alertService.info("Deliver Qty is greater than Order Qty"),void this.alertService.emitShowHideSubject.subscribe(Y=>{setTimeout(()=>{this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY=0,this.CalculateAmount(G)},0)});this.CalculateAmount(G)}OkCommand(){this._trnMainService.TrnMainObj.PODetailList.forEach(z=>z.MCODE=z.MCODE),this._trnMainService.TrnMainObj.PODetailList.forEach(z=>z.VCHRNO=this.masterService.PO_Voucherno);let G=this._trnMainService.TrnMainObj.PODetailList.filter(z=>z.DELIVERRATE==z.RATE);if(G.length>0)for(let z in G)if(G[z].DELIVERRATE==G[z].DELIVERRATE&&!confirm(`Same rate detected in ${G[z].DESCA} . Do you want to continue?`))return;let Y=this._trnMainService.TrnMainObj.PODetailList.filter(z=>0==z.DELIVERRATE||null==z.DELIVERRATE||null==z.DELIVERRATE);if(Y.length>0){for(let K in Y)if(!confirm(`Rate not entered in ${Y[K].DESCA} . Do you want to assign it with Order Rate?`))return;Y.forEach(K=>K.DELIVERRATE=K.RATE),Y.filter(K=>0==K.DELIVERQTY||null==K.DELIVERQTY||null==K.DELIVERQTY).length>0&&Y.forEach(K=>K.DELIVERQTY=K.ORDERQTY),Y.forEach(K=>K.AMOUNT=K.DELIVERRATE*K.DELIVERQTY)}this.onLoadPO.emit(this._trnMainService.TrnMainObj.PODetailList)}QtySameAsOrderQty(G){1==G?(this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.DELIVERQTY=Y.ORDERQTY),this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.AMOUNT=Y.DELIVERQTY*Y.DELIVERRATE)):(this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.DELIVERQTY=0),this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.AMOUNT=Y.DELIVERQTY*Y.DELIVERRATE))}QtySameAsOrderRate(G){1==G?(this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.DELIVERRATE=Y.RATE),this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.AMOUNT=Y.DELIVERQTY*Y.DELIVERRATE)):(this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.DELIVERRATE=0),this._trnMainService.TrnMainObj.PODetailList.forEach(Y=>Y.AMOUNT=Y.DELIVERQTY*Y.DELIVERRATE))}DiscountPercentChange(G){this._trnMainService.TrnMainObj.PODetailList[G].DISCOUNT_AMOUNT=this._trnMainService.TrnMainObj.PODetailList[G].DISCOUNT_RATE/100*this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE,this._trnMainService.TrnMainObj.PODetailList[G].NET_RATE=this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE-this._trnMainService.TrnMainObj.PODetailList[G].DISCOUNT_RATE/100*this._trnMainService.TrnMainObj.PODetailList[G].DELIVERRATE,this._trnMainService.TrnMainObj.PODetailList[G].AMOUNT=this._trnMainService.TrnMainObj.PODetailList[G].NET_RATE*this._trnMainService.TrnMainObj.PODetailList[G].DELIVERQTY}}return ae.\u0275fac=function(G){return new(G||ae)(e.Y36(t.P),e.Y36(O.c),e.Y36(M.p),e.Y36(ee.V),e.Y36($.e))},ae.\u0275cmp=e.Xpm({type:ae,selectors:[["load-purchase-order"]],outputs:{onLoadPO:"onLoadPO"},decls:1,vars:1,consts:[["class","purchaseorder_container","role","document","style","max-width: 100%; max-height: 500px; overflow:hidden",4,"ngIf"],["role","document",1,"purchaseorder_container",2,"max-width","100%","max-height","500px","overflow","hidden"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","90vw","height","70vh"],[1,"modal-header","row"],[1,"col-md-7"],[1,"modal-title","pull-right"],[1,"table-responsive"],[1,"row"],[1,"col-md-4"],[1,"col"],[1,"label-class"],[2,"width","200px !important"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"table","columformat-class",2,"display","grid","font-size","12px"],[2,"background-color","rgb(184, 184, 184)"],[2,"width","80px",3,"ngStyle"],["scope","col",2,"width","100px","text-align","center",3,"ngStyle"],["scope","col",2,"width","150px","text-align","center",3,"ngStyle"],["scope","col",2,"width","65px","text-align","center",3,"ngStyle"],["scope","col",2,"width","120px","text-align","center",3,"ngStyle"],["scope","col",2,"width","90px","text-align","center",3,"ngStyle"],["scope","col",2,"width","118px","text-align","center",3,"ngStyle"],["scope","col","style","width: 118px; text-align: center;",3,"ngStyle",4,"ngIf"],["scope","col",2,"width","180px","text-align","center",3,"ngStyle"],["scope","col",2,"width","150px","text-align","center"],[2,"font-size","17px","height","190px"],[4,"ngFor","ngForOf"],[1,"modal-footer",2,"height","20px"],["type","button",1,"btn","btn-primary",3,"click"],[1,"columformat-class",2,"width","60px"],[2,"font-size","12px","width","10px"],[1,"columformat-class",2,"width","120px","line-height","32px"],["type","text",1,"form-control",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange"],[1,"columformat-class",2,"width","150px","line-height","32px"],["type","text",1,"form-control",2,"color","black","height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange"],[1,"columformat-class",2,"width","85px","line-height","32px"],[1,"columformat-class",2,"width","110px","line-height","32px"],["type","text",1,"form-control","number-field",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange"],[1,"columformat-class",2,"width","90px","line-height","32px","font-size","12px"],["type","number",1,"form-control",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange"],[1,"columformat-class",2,"width","90px","line-height","32px"],["type","number",1,"form-control",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange","change","keyup.Tab","keyup.Enter"],["type","number",1,"form-control","number-field",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange","change","keyup.Tab","keyup.Enter"],["style","width: 120px;line-height: 32px; ","class","columformat-class",4,"ngIf"],[1,"columformat-class",2,"width","180px","line-height","32px"],["type","number",1,"form-control","number-field",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","readonly","ngModelChange"],[1,"columformat-class",2,"line-height","32px"],["type","month","max","2999-12-31",1,"form-control",2,"height","26px","margin-top","2px","font-size","12px","width","165px",3,"ngStyle","ngModel","ngModelChange"],["type","number",1,"form-control","number-field",2,"height","26px","margin-top","2px","font-size","12px",3,"ngModel","ngModelChange"]],template:function(G,Y){1&G&&e.YNc(0,W,74,37,"div",0),2&G&&e.Q6J("ngIf",Y.isActive)},dependencies:[S.sg,S.O5,S.PC,J.Fj,J.wV,J.Wl,J.JJ,J.On],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:23px;color:#000}","td[_ngcontent-%COMP%] {\n        border: 1px solid #e6e6e6;\n        padding: 1px !important;\n    }\n    \n    input[_ngcontent-%COMP%] {\n        padding: 8px;\n    }\n    \n    .form-group[_ngcontent-%COMP%] {\n        margin-bottom: 0rem;\n    }\n    \n    .purchaseorder_container[_ngcontent-%COMP%] {\n        position: fixed !important;\n        transform: translate(0px, -35px);\n        background: #ffffff;\n        z-index: 99999;\n        width: 90%;\n        top: 22.5%;\n        left: 5%;\n    }\n    \n    .label-class[_ngcontent-%COMP%] {\n        width: 135px;\n    }\n    \n    .btn[_ngcontent-%COMP%] {\n        margin-top: 60px;\n    }\n\n    .number-field[_ngcontent-%COMP%]{\n        text-align: right;\n    }"]}),ae})()},14173:(ve,ce,b)=>{b.d(ce,{l:()=>S});var e=b(64537),t=b(53074),O=b(87584),M=b(67311),ee=b(20092),$=b(88692);let S=(()=>{class J{constructor(_,Z,k){this.masterService=_,this._trnMainService=Z,this.alertService=k,this.isActive=!1,this.petval={}}ngOnInit(){}show(_,Z){console.log("SHOW",_,Z),this.isActive=!0,this.petval.rate=_,this.indexRow=Z}cancel(){this.isActive=!1,setTimeout(()=>{this.masterService.focusAnyControl("alternateQty"+this.indexRow)},50)}hide(){this.isActive=!1,console.log("INDEX",this.indexRow+1),setTimeout(()=>{this.masterService.focusAnyControl("itemDesc"+(this.indexRow+1))},50)}quant(_,Z){this._trnMainService.PetrolQuant=_/Z}OnSubmit(){this._trnMainService.TrnMainObj.ProdList[this.indexRow].ALTERNATEQUANTIY=this._trnMainService.PetrolQuant,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.addRow(),this.petval.amount=null,this._trnMainService.PetrolQuant=null,this.hide()}handleKeyDown(_){_.preventDefault(),this.cancel()}}return J.\u0275fac=function(_){return new(_||J)(e.Y36(t.P),e.Y36(O.p),e.Y36(M.c))},J.\u0275cmp=e.Xpm({type:J,selectors:[["popup-petrol"]],hostBindings:function(_,Z){1&_&&e.NdJ("keydown.esc",function(X){return Z.handleKeyDown(X)},!1,e.Jf7)},decls:31,vars:8,consts:[[1,"modal-sticky"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body",2,"margin","10px"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-md-3","form-control-label"],[1,"col-md-8"],["id","modalquant","type","number",2,"width","100%",3,"ngModel","ngModelChange","keydown.enter"],["type","text",2,"width","100%",3,"ngModel"],["type","text","readonly","",2,"width","100%",3,"ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-info","TopMargin",2,"width","80px",3,"click"],["type","button",1,"btn","btn-info","TopMargin",2,"margin-right","10px",3,"click"]],template:function(_,Z){1&_&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),e._uU(4,"Calculation"),e.qZA(),e.TgZ(5,"div",4)(6,"button",5),e.NdJ("click",function(){return Z.hide()}),e.TgZ(7,"span",6),e._uU(8,"\xd7"),e.qZA()()()(),e.TgZ(9,"div",7)(10,"div",8)(11,"label",9),e._uU(12,"Amount:"),e.qZA(),e.TgZ(13,"div",10)(14,"input",11),e.NdJ("ngModelChange",function(X){return Z.petval.amount=X})("ngModelChange",function(){return Z.quant(Z.petval.amount,Z.petval.rate)})("keydown.enter",function(){return Z.OnSubmit()}),e.qZA()()(),e.TgZ(15,"div",8)(16,"label",9),e._uU(17,"Rate:"),e.qZA(),e.TgZ(18,"div",10),e._UZ(19,"input",12),e.qZA()(),e.TgZ(20,"div",8)(21,"label",9),e._uU(22,"Quantity:"),e.qZA(),e.TgZ(23,"div",10),e._UZ(24,"input",13),e.ALo(25,"number"),e.qZA()(),e.TgZ(26,"div",14)(27,"button",15),e.NdJ("click",function(){return Z.OnSubmit()}),e._uU(28,"Submit"),e.qZA(),e.TgZ(29,"button",16),e.NdJ("click",function(){return Z.hide()}),e._uU(30,"Cancel"),e.qZA()()()()()),2&_&&(e.ekj("modal-sticky-hide",!Z.isActive),e.xp6(14),e.Q6J("ngModel",Z.petval.amount),e.xp6(5),e.Q6J("ngModel",Z.petval.rate),e.xp6(5),e.Q6J("ngModel",e.xi3(25,5,Z._trnMainService.PetrolQuant,"1.0-3")))},dependencies:[ee.Fj,ee.wV,ee.JJ,ee.On,$.JJ],styles:[".modal-sticky[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:20%;top:25%;left:60%;height:40%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000;margin-left:-8%}.model-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.modal-body[_ngcontent-%COMP%]{line-height:.4rem;padding:5px}.modal-header[_ngcontent-%COMP%]{padding:5px 3px;background:#7ed0ff}.modal-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:11vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}th[_ngcontent-%COMP%]{font-size:14px}td[_ngcontent-%COMP%]{font-size:13px}"]}),J})()},90253:(ve,ce,b)=>{b.d(ce,{c:()=>f});var e=b(64537),t=b(53074),O=b(67311),M=b(87584),ee=b(14970),$=b(88692),S=b(20092);const J=["partyGroup"];function C(L,x){if(1&L&&(e.TgZ(0,"option",43),e._uU(1),e.qZA()),2&L){const m=x.$implicit;e.s9C("value",m.ACID),e.xp6(1),e.Oqu(m.ACNAME)}}function _(L,x){if(1&L&&(e.TgZ(0,"option",43),e._uU(1),e.qZA()),2&L){const m=x.$implicit;e.s9C("value",m.OrgTypeCode),e.xp6(1),e.Oqu(m.OrgTypeName)}}function Z(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"div",18)(1,"div",26)(2,"label",31),e._uU(3,"PARTY CAT: "),e.qZA()(),e.TgZ(4,"div",44)(5,"select",45),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.partymasterObj.GEO=P)}),e.YNc(6,_,2,2,"option",17),e.qZA()()()}if(2&L){const m=e.oxw(2);e.xp6(5),e.Q6J("ngModel",m.partymasterObj.GEO),e.xp6(1),e.Q6J("ngForOf",m.GeoList)}}function k(L,x){if(1&L&&(e.TgZ(0,"option",43),e._uU(1),e.qZA()),2&L){const m=x.$implicit;e.s9C("value",m.AREANAME),e.xp6(1),e.Oqu(m.AREANAME)}}function X(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"div",18)(1,"div",26)(2,"label",31),e._uU(3,"AREA:"),e.qZA()(),e.TgZ(4,"div",46)(5,"input",47),e.NdJ("change",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.onChangeArea(P))})("ngModelChange",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.partymasterObj.CITY=P)}),e.qZA(),e.TgZ(6,"datalist",48),e.YNc(7,k,2,2,"option",17),e.qZA()()()}if(2&L){const m=e.oxw(2);e.xp6(5),e.Q6J("ngModel",m.partymasterObj.CITY),e.xp6(2),e.Q6J("ngForOf",m.areaList)}}function H(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"div",18),e._UZ(1,"div",26),e.TgZ(2,"div",32)(3,"input",49),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.createMember=P)}),e.qZA(),e.TgZ(4,"label",50),e._uU(5,"Create Customer A/C as Member Also"),e.qZA()()()}if(2&L){const m=e.oxw(2);e.xp6(3),e.Q6J("ngModel",m.createMember)("disabled","V"==m.partymasterObj.PType)}}function j(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"div",51)(1,"fieldset",52)(2,"legend",53),e._uU(3,"Supplier Type :"),e.qZA(),e.TgZ(4,"div",54)(5,"div",55)(6,"input",56),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.partymasterObj.SUPTYPE=P)})("change",function(){e.CHM(m);const P=e.oxw(2);return e.KtG(P.onSupplierTypeChange())}),e.qZA(),e.TgZ(7,"label",57),e._uU(8,"Is VAT Supplier"),e.qZA()(),e.TgZ(9,"div",55)(10,"input",58),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw(2);return e.KtG(w.partymasterObj.SUPTYPE=P)})("change",function(){e.CHM(m);const P=e.oxw(2);return e.KtG(P.onSupplierTypeChange())}),e.qZA(),e.TgZ(11,"label",57),e._uU(12,"Is PAN Supplier"),e.qZA()()()()()}if(2&L){const m=e.oxw(2);e.xp6(6),e.Q6J("ngModel",m.partymasterObj.SUPTYPE),e.xp6(4),e.Q6J("ngModel",m.partymasterObj.SUPTYPE)}}function y(L,x){if(1&L){const m=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h4",5),e._uU(5,"PARTY MASTER"),e.qZA()(),e.TgZ(6,"div",6)(7,"button",7),e.NdJ("click",function(){e.CHM(m);const P=e.oxw();return e.KtG(P.cancelPartyPopup())}),e._uU(8,"Cancel"),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){e.CHM(m);const P=e.oxw();return e.KtG(P.savePartyMaster())}),e._uU(10," Save "),e.qZA()()(),e.TgZ(11,"div",9)(12,"div",10)(13,"div")(14,"div",11)(15,"div",12)(16,"label",13),e._uU(17,"PARTY GROUP:"),e.qZA()(),e.TgZ(18,"div",14)(19,"select",15,16),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.ACID=P)}),e.YNc(21,C,2,2,"option",17),e.qZA()()(),e.TgZ(22,"div",18)(23,"div",12)(24,"label",19),e._uU(25,"PARTY NAME:"),e.qZA()(),e.TgZ(26,"div",20)(27,"input",21),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.ACNAME=P)}),e.qZA()()(),e.TgZ(28,"div",18)(29,"div",12)(30,"label",22),e._uU(31,"ADDRESS:"),e.qZA()(),e.TgZ(32,"div",20)(33,"textarea",23),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.ADDRESS=P)}),e.qZA()()()(),e.TgZ(34,"div",24)(35,"div",25)(36,"div",18)(37,"div",26)(38,"label",27),e._uU(39,"VAT NO:"),e.qZA()(),e.TgZ(40,"div",28)(41,"input",29),e.NdJ("keypress",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.keyPress(P))})("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.VATNO=P)}),e.qZA()()(),e.YNc(42,Z,7,2,"div",30),e.YNc(43,X,8,2,"div",30),e.TgZ(44,"div",18)(45,"div",26)(46,"label",31),e._uU(47," CREDIT LIMIT:"),e.qZA()(),e.TgZ(48,"div",32)(49,"input",21),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.CRLIMIT=P)}),e.qZA()()(),e.TgZ(50,"div",18)(51,"div",26)(52,"label",31),e._uU(53,"CREDIT DAYS:"),e.qZA()(),e.TgZ(54,"div",32)(55,"input",21),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.CRPERIOD=P)}),e.qZA()()(),e.YNc(56,H,6,2,"div",30),e.qZA(),e.TgZ(57,"div",33)(58,"fieldset",34)(59,"legend",35),e._uU(60,"Party Type:"),e.qZA(),e.TgZ(61,"input",36),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.PType=P)}),e.qZA(),e.TgZ(62,"label"),e._uU(63,"\xa0Customer"),e.qZA(),e._UZ(64,"br"),e.TgZ(65,"input",37),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.PType=P)}),e.qZA(),e.TgZ(66,"label"),e._uU(67,"\xa0Supplier"),e.qZA()()()(),e.YNc(68,j,13,2,"div",38),e.qZA(),e.TgZ(69,"div",12)(70,"div",18)(71,"label",39),e._uU(72,"PARTY CODE:"),e.qZA(),e.TgZ(73,"input",40),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.ACCODE=P)}),e.qZA()(),e.TgZ(74,"div",18)(75,"label",41),e._uU(76,"Mobile No.:"),e.qZA(),e.TgZ(77,"input",42),e.NdJ("ngModelChange",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.partymasterObj.MOBILE=P)})("keypress",function(P){e.CHM(m);const w=e.oxw();return e.KtG(w.keyPress(P))}),e.qZA()()()()()()}if(2&L){const m=e.oxw();e.xp6(19),e.Q6J("ngModel",m.partymasterObj.ACID),e.xp6(2),e.Q6J("ngForOf",m.PartyGroupPartyMaster),e.xp6(6),e.Q6J("ngModel",m.partymasterObj.ACNAME),e.xp6(6),e.Q6J("ngModel",m.partymasterObj.ADDRESS),e.xp6(8),e.Q6J("ngModel",m.partymasterObj.VATNO),e.xp6(1),e.Q6J("ngIf","pro"==m.AppMode),e.xp6(1),e.Q6J("ngIf","pro"==m.AppMode),e.xp6(6),e.Q6J("ngModel",m.partymasterObj.CRLIMIT),e.xp6(6),e.Q6J("ngModel",m.partymasterObj.CRPERIOD),e.xp6(1),e.Q6J("ngIf",1==m.masterService.userSetting.CREATE_CPROFILE_AS_MEMBER&&1==m.masterService.isSalesPage),e.xp6(5),e.Q6J("ngModel",m.partymasterObj.PType)("disabled",0==m.masterService.isSalesPage),e.xp6(4),e.Q6J("ngModel",m.partymasterObj.PType)("disabled",1==m.masterService.isSalesPage),e.xp6(3),e.Q6J("ngIf","V"===m.partymasterObj.PType),e.xp6(5),e.Q6J("ngModel",m.partymasterObj.ACCODE),e.xp6(4),e.Q6J("ngModel",m.partymasterObj.MOBILE)}}let f=(()=>{class L{constructor(m,I,P,w){this.masterService=m,this.alertService=I,this._trnMainService=P,this.spinnerService=w,this.PartyGroupPartyMaster=[],this.GeoList=[],this.areaList=[],this.partymasterObj={ACID:"",ACCODE:"",ACNAME:"",ADDRESS:"",VATNO:"",GEO:"",CRLIMIT:"",CRPERIOD:"",PType:"",MOBILE:"",SUPTYPE:""},this.newAccountDetails=[],this.onSaveParty=new e.vpe,this.partymasterObj.CRLIMIT=0,this.partymasterObj.CRPERIOD=0,"TI"==this._trnMainService.TrnMainObj.VoucherPrefix&&(this.partymasterObj.PType="C"),"PI"==this._trnMainService.TrnMainObj.VoucherPrefix&&(this.masterService.isSalesPage=!1,this.partymasterObj.PType="V"),this.masterService.getAreaDetail().subscribe(Q=>{this.areaList=Q.result}),this.masterService.getPartyGroupForQuickPartyMaster().subscribe(Q=>{this.PartyGroupPartyMaster=Q.result}),this.masterService.getGeoList().subscribe(Q=>{"ok"==Q.status&&(this.GeoList=Q.result)}),1==this.masterService.userSetting.CREATE_CPROFILE_AS_MEMBER&&"C"==this.partymasterObj.PType&&(this.createMember=!0)}ngOnInit(){}resetPartyAccount(){this.partymasterObj.ACID="",this.partymasterObj.ACCODE="",this.partymasterObj.ACNAME="",this.partymasterObj.ADDRESS="",this.partymasterObj.VATNO="",this.partymasterObj.GEO="",this.partymasterObj.CITY="",this.partymasterObj.CRLIMIT=0,this.partymasterObj.CRPERIOD=0,this.partymasterObj.MOBILE="",this.partymasterObj.PType=1==this.masterService.isSalesPage?"C":"V"}savePartyMaster(){let m=Object.assign({},this.partymasterObj);if(m.PARENT=this.partymasterObj.ACID,m.CRLIMIT=this.partymasterObj.CRLIMIT?this.partymasterObj.CRLIMIT:0,m.CRPERIOD=this.partymasterObj.CRPERIOD?this.partymasterObj.CRPERIOD:0,m.CATEGORY=this.partymasterObj.GEO,m.ISACTIVE=1,m.PCL="pc002",null!=this.partymasterObj.CITY){let P=this.areaList.filter(w=>w.AREANAME.toUpperCase()==this.partymasterObj.CITY.toUpperCase());m.AREA_ID=P[0]?P[0].AREAID:null}""!=m.ACID?""!=m.ACNAME?""!=m.ADDRESS?("TI"==this._trnMainService.TrnMainObj.VoucherPrefix?(this.partymasterObj.PType="C",m.PType="C"):"PI"==this._trnMainService.TrnMainObj.VoucherPrefix&&(this.partymasterObj.PType="V",m.PType="V",m.SUPTYPE=this.partymasterObj.SUPTYPE),this._trnMainService.TrnMainObj.BILLTO=this.partymasterObj.ACNAME,this._trnMainService.TrnMainObj.BILLTOTEL=this.partymasterObj.VATNO,this._trnMainService.TrnMainObj.BILLTOADD=this.partymasterObj.ADDRESS,this._trnMainService.TrnMainObj.BILLTOMOB=this.partymasterObj.PHONE,("V"!=m.PType||""!=m.VATNO||confirm("VAT NO. is empty!! Are you sure you want to continue ?"))&&(""==m.VATNO||9==m.VATNO.length?1!=this.masterService.userSetting.CREATE_CPROFILE_AS_MEMBER||1!=this.createMember||"C"!=m.PType||""!=m.MOBILE?""==m.MOBILE||10==m.MOBILE.length?("V"==this.partymasterObj.PType&&(this.createMember=!1),this.mode="add",this.spinnerService.show("Data is saving Please Wait.."),this.masterService.savePartyMaster(this.mode,m,this.createMember).subscribe(P=>{"ok"==P.status?"ProceedConfirmation"==P.result?confirm("Member is not Creadted on server.Do you want to Proced")?(this.createMember=!1,this.savePartyMaster()):this.spinnerService.hide():(this._trnMainService.TrnMainObj.PARAC=P.result2.ACID,this.cancelPartyPopup(),this.alertService.success("Data Saved Successfully"),this.spinnerService.hide(),setTimeout(()=>{this.alertService.hide()},500),this.onSaveParty.emit(P.result2)):(this.spinnerService.hide(),this.alertService.info("Error in Saving Data:"+P))},P=>{this.alertService.info(P.error),this.spinnerService.hide()})):alert("Mobile No. should be nine digit length!"):alert("Please Enter Mobile No. First!"):alert("VAT NO should be nine digit length!"))):alert("Please Enter Address First!"):alert("Please Enter Party Name First!"):alert("Please Select Party Group First!")}cancelPartyPopup(){this.isActive=!1,this.resetPartyAccount()}keyPress(m){const P=String.fromCharCode(m.charCode);/[0-9]/.test(P)||m.preventDefault()}onChangeArea(m){let I=m.target.value,P=[];null!=I&&(P=this.areaList.filter(w=>w.AREANAME.toUpperCase()==I.toUpperCase()),0==P.length&&confirm("Do you want to add new Area"))}show(){this.isActive=!0,setTimeout(()=>{this.partyGroup.nativeElement.focus()},10)}hide(){this.isActive=!1}onSupplierTypeChange(){this.partymasterObj.PType="V"}}return L.\u0275fac=function(m){return new(m||L)(e.Y36(t.P),e.Y36(O.c),e.Y36(M.p),e.Y36(ee.V))},L.\u0275cmp=e.Xpm({type:L,selectors:[["quick-party-master"]],viewQuery:function(m,I){if(1&m&&e.Gf(J,5),2&m){let P;e.iGM(P=e.CRH())&&(I.partyGroup=P.first)}},outputs:{onSaveParty:"onSaveParty"},decls:1,vars:1,consts:[["class","party_container","role","document","style","max-width: 100%; max-height: 500px;",4,"ngIf"],["role","document",1,"party_container",2,"max-width","100%","max-height","500px"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","77vw","height","65vh"],[1,"modal-header","row"],[1,"col-md-7"],[1,"modal-title","pull-right"],[1,"col-md-5"],["type","button",1,"btn","btn-info","pull-right",2,"width","80px",3,"click"],["type","button","title","onSave",1,"btn","btn-info","pull-right",2,"margin-right","10px","width","80px","margin-top","15px",3,"click"],[1,"row",2,"overflow-y","auto","overflow-x","hidden"],[1,"col-md-8"],[1,"form-group","row",2,"margin-left","4px"],[1,"col-md-4"],[1,"pull-right","required",2,"font-weight","bold","text-align","right","margin-top","24px","width","92px"],[1,"col-md-8",2,"width","65%","margin-top","20px"],["id","partygroup",1,"form-control",2,"padding","0px 8px",3,"ngModel","ngModelChange"],["partyGroup",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","row"],[1,"pull-right","required",2,"font-weight","bold","text-align","right","margin-top","4px"],[1,"col-md-8",2,"width","65%","margin-top","4px"],["type","text",1,"form-control",2,"color","black",3,"ngModel","ngModelChange"],[1,"pull-right","required",2,"margin-top","4px","text-align","right","font-weight","bold"],["rows","2","cols","50",1,"form-control",2,"width","100%","height","40px",3,"ngModel","ngModelChange"],[1,"row"],[1,"col-md-9",2,"padding","0px"],[1,"col-md-5",2,"padding","0px"],[1,"pull-right","required",2,"margin-top","7px","text-align","right","font-weight","bold"],[1,"col-md-7",2,"width","54%","margin-top","9px","padding-left","29px"],["type","text","placeholder","Enter 9 digit vat no.","required","","maxlength","9",1,"form-control",2,"color","black",3,"ngModel","keypress","ngModelChange"],["class","form-group row",4,"ngIf"],[1,"pull-right",2,"margin-top","4px","text-align","right","font-weight","bold"],[1,"col-md-7",2,"width","54%","margin-top","4px","padding-left","30px"],[1,"col-md-3"],[2,"width","125px","height","100px","margin-top","5px"],[2,"font-size","13px","font-weight","bold","text-align","center"],["type","radio","value","C","name","pTypeCustomer",2,"padding-right","15px","height","13px",3,"ngModel","disabled","ngModelChange"],["type","radio","value","V","name","pTypeSupplier",2,"padding-right","15px","height","13px",3,"ngModel","disabled","ngModelChange"],["class","row","style","margin-bottom: 10px !important; padding-left: 270px;",4,"ngIf"],[1,"label","required",2,"margin-top","20px","font-weight","bold"],["type","text",1,"form-control",2,"color","black","width","60%","margin-top","20px",3,"ngModel","ngModelChange"],[1,"label",2,"margin-top","20px","font-weight","bold"],["type","text","maxlength","10",1,"form-control",2,"color","black","width","60%","margin-top","20px",3,"ngModel","ngModelChange","keypress"],[3,"value"],[1,"col-md-7",2,"width","54%","margin-top","5px","padding-left","29px"],[1,"form-control","form-control-sm",2,"padding","0px 8px",3,"ngModel","ngModelChange"],[1,"col-md-7",2,"width","54%","margin-top","4px","padding-left","29px"],["type","text","name","product","list","areaName",1,"form-control",3,"ngModel","change","ngModelChange"],["id","areaName"],["type","checkbox","id","createMember",1,"form-control",2,"height","59%","width","5%",3,"ngModel","disabled","ngModelChange"],[1,"form-control-label",2,"width","100%","margin-top","-12%","margin-left","7%"],[1,"row",2,"margin-bottom","10px !important","padding-left","270px"],[1,"fieldset",2,"width","97%"],[1,"legend",2,"font-size","13px","font-weight","bold","text-align","center"],[1,"row",2,"margin-top","2%","margin-bottom","2%"],[1,"col-sm-6"],["type","radio","value","0","name","supTypeisVAT",2,"height","13px","font-size","12px !important","width","20%",3,"ngModel","ngModelChange","change"],[2,"width","70%","margin-left","-5px","padding-top","7px"],["type","radio","value","1","name","supTypeisPAN",2,"height","13px","font-size","12px !important","width","20%",3,"ngModel","ngModelChange","change"]],template:function(m,I){1&m&&e.YNc(0,y,78,17,"div",0),2&m&&e.Q6J("ngIf",I.isActive)},dependencies:[$.sg,$.O5,S.YN,S.Kr,S.Fj,S.Wl,S.EJ,S._,S.JJ,S.Q7,S.nD,S.On],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:23px;color:#000}",'td[_ngcontent-%COMP%] {\n    border: 1px solid #e6e6e6;\n  }\n\n  input[_ngcontent-%COMP%] {\n    padding: 8px;\n  }\n\n  .form-group[_ngcontent-%COMP%] {\n    margin-bottom: 0rem;\n  }\n\n  .party_container[_ngcontent-%COMP%] {\n    position: fixed !important;\n    transform: translate(0px, -35px);\n    background: #ffffff;\n    z-index: 99999;\n    width: 77%;\n    top: 22.5%;\n    left: 10%;\n  }\n  .required[_ngcontent-%COMP%]:after {\n  content:" *";\n  color: red;\n}']}),L})()}}]);