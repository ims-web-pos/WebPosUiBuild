"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[5155],{89952:(b,h,d)=>{d.d(h,{g:()=>m});var p=d(36336);let m=(()=>{class c{transform(e){return e||(e=0),Number(e).toFixed(2)}}return c.\u0275fac=function(e){return new(e||c)},c.\u0275pipe=p.Yjl({name:"twoDigitNumber",type:c,pure:!0}),c})()},5155:(b,h,d)=>{d.r(h),d.d(h,{MeterReadingModule:()=>U});var p=d(92752),m=d(45365),c=d(82661),E=d(28698),e=d(36336),D=d(53074),A=d(67311),C=d(14970),O=d(87584),_=d(63504),S=d(89952);const v=["genericGridMeterEntry"],N=["firstMeterEndInput"];function P(s,g){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"td",29),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"input",30),e.NdJ("ngModelChange",function(i){const r=e.CHM(n).$implicit;return e.KtG(r.PUMP=i)}),e.qZA()(),e.TgZ(5,"td")(6,"input",31),e.NdJ("ngModelChange",function(i){const r=e.CHM(n).$implicit;return e.KtG(r.PRODUCT=i)}),e.qZA()(),e.TgZ(7,"td"),e._UZ(8,"input",32),e.ALo(9,"twoDigitNumber"),e.qZA(),e.TgZ(10,"td")(11,"input",33),e.NdJ("ngModelChange",function(i){const r=e.CHM(n).$implicit;return e.KtG(r.METER_END=i)})("ngModelChange",function(){const o=e.CHM(n).index,r=e.oxw();return e.KtG(r.calulateSalesQuantity(o))})("keydown.enter",function(i){const r=e.CHM(n).index,a=e.oxw();return e.KtG(a.focusNextMeterEnd(r,i))})("keydown.Tab",function(i){const r=e.CHM(n).index,a=e.oxw();return e.KtG(a.focusNextMeterEnd(r,i))}),e.qZA()(),e.TgZ(12,"td"),e._UZ(13,"input",34),e.ALo(14,"twoDigitNumber"),e.qZA(),e.TgZ(15,"td")(16,"input",35),e.NdJ("ngModelChange",function(i){const r=e.CHM(n).$implicit;return e.KtG(r.UNIT=i)}),e.qZA()(),e.TgZ(17,"td")(18,"input",35),e.NdJ("ngModelChange",function(i){const r=e.CHM(n).$implicit;return e.KtG(r.METER_MAX=i)}),e.qZA()()()}if(2&s){const n=g.$implicit,t=g.index,i=e.oxw();e.xp6(1),e.MGl("id","sno",t,""),e.xp6(1),e.hij(" ",t+1," "),e.xp6(2),e.MGl("id","pump",t,""),e.Q6J("ngModel",n.PUMP)("disabled","View"==i.mode),e.xp6(2),e.MGl("id","menuCode",t,""),e.Q6J("ngModel",n.PRODUCT)("disabled","View"==i.mode),e.xp6(2),e.MGl("id","METER_START",t,""),e.Q6J("value",e.lcZ(9,24,n.METER_START))("disabled","View"==i.mode),e.xp6(3),e.MGl("id","METER_END",t,""),e.Q6J("ngModel",n.METER_END)("min",n.METER_START)("disabled","View"==i.mode),e.xp6(2),e.MGl("id","SALES_QTY",t,""),e.Q6J("value",e.lcZ(14,26,n.SALES_QTY))("disabled","View"==i.mode),e.xp6(3),e.MGl("id","UNIT",t,""),e.Q6J("ngModel",n.UNIT)("disabled","View"==i.mode),e.xp6(2),e.MGl("id","UNIT",t,""),e.Q6J("ngModel",n.METER_MAX)("disabled","View"==i.mode)}}const w=[{path:"",component:(()=>{class s{constructor(n,t,i,o,r,a){this.masterService=n,this.alertService=t,this.loadingService=i,this.MasterRepo=o,this._trnMainService=r,this.router=a,this.mode="Add",this.meterReadingObj={},this.ISNOTUPDATABLE=!1,this.gridMeterEntryPopupSettings=new E.im,this.activerowIndex=0}refreshPage(){location.reload()}ngOnInit(){this.reset(),this.getAllPumpDetails(),this.firstMeterEndInput&&this.firstMeterEndInput.nativeElement&&this.firstMeterEndInput.nativeElement.focus()}getAllPumpDetails(){this.masterService.getPumpDetails().subscribe(n=>{if("ok"==n.status){n.result.forEach(l=>{if(0===l.STATUS)return;let M={};M.METER_START=l.METER_END_VALUE>0?l.METER_END_VALUE:l.OPENING_METER?l.OPENING_METER:0,M.PRODUCT_CODE=l.MCODE,M.PRODUCT=l.PRODUCT_NAME,M.UNIT=l.PRODUCT_UNIT,M.METER_MAX=l.METER_MAX_VALUE?l.METER_MAX_VALUE:0,M.PUMP=l.PUMP_NAME,M.PUMP_ID=l.PUMP_ID,M.SALES_QTY=0,M.METER_END=0,this.meterReadingObj.MeterRowDetailList.push(M)});const t=new Date(n.result2),i=t.getFullYear(),o=t.getMonth()+1,r=t.getDate();this.minDate=`${i}-${o<10?"0"+o:o}-${r<10?"0"+r:r}`;const a=new Date,T=a.getFullYear(),u=a.getMonth()+1,R=a.getDate();this.maxDate=`${T}-${u<10?"0"+u:u}-${R<10?"0"+R:R}`,this.calculateTotal()}},n=>{this.alertService.info(n.error.message)})}onDateChange(){const n=new Date(this.meterReadingObj.READING_DATE),t=new Date(this.minDate),i=new Date(this.maxDate);(n<t||n>i)&&(this.meterReadingObj.READING_DATE=n<t?this.minDate:this.maxDate)}DisplayGenericListOfEntry(){this.gridMeterEntryPopupSettings=Object.assign(new E.im,{title:"METER READING LIST",apiEndpoints:"/getMeterReadingPagedList",defaultFilterIndex:1,columns:[{key:"ENTRY_DATE",title:"Entry Date",hidden:!1,noSearch:!1,format:"shortDate"},{key:"ENTRY_NO",title:"Entry Number",hidden:!1,noSearch:!1}]}),this.genericGridForProduct.show()}dblClickPopupMeterItem(n,t){let i=n.ENTRY_NO;this.mode=t,this.loadingService.show("Data Loading..."),this.masterService.getMeterReadingDetails(i).subscribe(o=>{"ok"==o.status&&(this.meterReadingObj.MeterRowDetailList=[],o.result.forEach(r=>{let a={};a.PRODUCT=r.Product,a.PUMP=r.Pump,a.PUMP_ID=r.PumpID,a.METER_END=r.MeterStart,a.METER_START=r.MeterStart<r.SalesQty?r.METER_MAX_VALUE-r.SalesQty+r.MeterStart:r.MeterStart-r.SalesQty,a.SALES_QTY=r.SalesQty?r.SalesQty:0,a.UNIT=r.Unit,a.METER_MAX=r.METER_MAX_VALUE?r.METER_MAX_VALUE:0,this.meterReadingObj.MeterRowDetailList.push(a)}),o.result.length>0&&(this.ISNOTUPDATABLE=1==o.result[0].ISNOTUPDATABLE,this._trnMainService.TrnMainObj.VCHRNO=o.result[0].ENTRY_NO,this.meterReadingObj.READING_DATE=o.result[0].Date.substring(0,10),this.ISNOTUPDATABLE&&"Edit"==this.mode&&(this.alertService.info("Only the latest Meter Reading Entry is Editable."),this.mode="View"),this.minDate=new Date(o.result[0].Date).toJSON().split("T")[0],this.calculateTotal()),this.loadingService.hide())},o=>{this.loadingService.hide(),this.alertService.warning(o._body)})}reset(){this.meterReadingObj.READING_DATE=(new Date).toJSON().split("T")[0],this._trnMainService.TrnMainObj.MWAREHOUSE=this.masterService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.DIVISION=this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.PhiscalID=this.masterService.userProfile.PhiscalYearInfo.PhiscalID,this._trnMainService.TrnMainObj.VoucherPrefix="MR",this._trnMainService.getVoucherNumber(),this.meterReadingObj.MeterRowDetailList=[],this.meterReadingObj.TOTAL_PUMP=0,this.meterReadingObj.TOTAL_SALES_QTY=0,this.maxDate=(new Date).toJSON().split("T")[0]}calulateSalesQuantity(n){const t=this.meterReadingObj.MeterRowDetailList[n].METER_START,i=this.meterReadingObj.MeterRowDetailList[n].METER_END;this.meterReadingObj.MeterRowDetailList[n].SALES_QTY=i<t?this.meterReadingObj.MeterRowDetailList[n].METER_MAX-t+i:i>t&&i?i-t:0,this.calculateTotal()}calculateTotal(){this.meterReadingObj.TOTAL_SALES_QTY=this.meterReadingObj.MeterRowDetailList.reduce((n,t)=>n+t.SALES_QTY,0),this.meterReadingObj.TOTAL_PUMP=this.meterReadingObj.MeterRowDetailList.length}saveMeterReading(){if(this.ISNOTUPDATABLE)return void this.alertService.info("Only the latest Meter Reading Entry is Editable.");if(this.meterReadingObj.MeterRowDetailList.some(t=>null==t.METER_END||0==t.METER_END||t.METER_END<0)){const t=this.meterReadingObj.MeterRowDetailList.find(i=>null==i.METER_END||0==i.METER_END||i.METER_END<0);return void this.alertService.info("Meter End Can't be Zero or Negative for "+t.PUMP+".")}if(this.meterReadingObj.MeterRowDetailList.some(t=>t.METER_END>t.METER_MAX)){const t=this.meterReadingObj.MeterRowDetailList.find(i=>i.METER_END>i.METER_MAX);return void this.alertService.info("Meter End/Close Value ("+t.METER_END+") must be less than Meter Max value ("+t.METER_MAX+") for "+t.PUMP+".")}let n=[];this.meterReadingObj.MeterRowDetailList.forEach(t=>{let i={};i.ENTRY_DATE=this.meterReadingObj.READING_DATE,i.PRODUCT=t.PRODUCT_CODE,i.PUMP=t.PUMP_ID,i.READING_VALUE=t.METER_END>0?t.METER_END:t.METER_START,i.SALES_QTY=t.SALES_QTY,i.METER_MAX_VALUE=t.METER_MAX,i.ENTRY_NO=this._trnMainService.TrnMainObj.VCHRNO,n.push(i)}),this.loadingService.show("Data Saving..."),"Edit"==this.mode?this.masterService.updateMeterReadingDetails(n).subscribe(t=>{"ok"==t.status&&(this.alertService.success(t.message),this.loadingService.hide(),this.reset(),this.getAllPumpDetails())},t=>{this.alertService.info(t.error.message),this.loadingService.hide()}):this.masterService.saveMeterReadingDetails(n).subscribe(t=>{"ok"==t.status&&(this.alertService.success(t.message),this.loadingService.hide(),this.reset())},t=>{this.alertService.info(t.error.message),this.loadingService.hide()})}focusNextMeterEnd(n,t){t.preventDefault();const o=this.meterReadingObj.MeterRowDetailList[n].METER_END,r=this.meterReadingObj.MeterRowDetailList[n].METER_MAX;if(this.meterReadingObj.MeterRowDetailList[n].METER_START>o&&null!=o&&0!=o&&o>0&&!window.confirm("Meter End Value is Less than Meter Start Value. Do You Want To Proceed or Not ?"))return this.meterReadingObj.MeterRowDetailList[n].METER_END=null,void(this.meterReadingObj.MeterRowDetailList[n].SALES_QTY=null);if(null==o||0==o||o<=0)return this.alertService.warning("Meter End Can't be Zero or Negative."),this.meterReadingObj.MeterRowDetailList[n].METER_END=0,void(this.meterReadingObj.MeterRowDetailList[n].SALES_QTY=0);if(o>r)return this.alertService.warning("Meter End/Close Value must be less than Meter Max value."),this.meterReadingObj.MeterRowDetailList[n].METER_END=0,void(this.meterReadingObj.MeterRowDetailList[n].SALES_QTY=0);const T=document.getElementById(`METER_END${n+1}`);if(T)T.focus();else{const u=document.getElementById("saveButton");u&&u.focus()}}formatDate(){const n=new Date(this.meterReadingObj.READING_DATE),t=n.getFullYear(),i=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");this.meterReadingObj.READING_DATE=`${i}/${o}/${t}`}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(D.P),e.Y36(A.c),e.Y36(C.V),e.Y36(D.P),e.Y36(O.p),e.Y36(m.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-meter-reading"]],viewQuery:function(n,t){if(1&n&&(e.Gf(v,5),e.Gf(N,5)),2&n){let i;e.iGM(i=e.CRH())&&(t.genericGridForProduct=i.first),e.iGM(i=e.CRH())&&(t.firstMeterEndInput=i.first)}},decls:69,vars:12,consts:[[1,"heading"],[1,"row"],[1,"col-md-4"],[1,"col-md-8"],[1,"btn","btn-info","pull-right","header-buttons",3,"click"],["ButtonType",""],["viewButton",""],["id","saveButton",1,"btn","btn-info","pull-right","header-buttons",3,"disabled","click"],[1,"col-md-8","inner-row"],[1,"main-wrap"],[1,"bom-body"],[1,"card","mt-2"],[1,"card-body"],[1,"inner-body"],[1,"form-group","row"],[1,"col-sm-4"],[1,"col-sm-5","form-control-label","reading-label"],["type","date","autocomplete","off",1,"col-md-6",3,"ngModel","disabled","min","max","ngModelChange","change","blur"],["for","type",1,"col-sm-5","form-control-label","entry-label"],["type","text","autocomplete","off","readonly","",1,"form-control","col-md-6","entry-input",3,"ngModel","ngModelChange"],[1,"table-wrap"],[1,"table","table-striped"],[1,"five"],[1,"ten"],[4,"ngFor","ngForOf"],[1,"row","total-row"],[1,"total-css"],[3,"popupsettings","onItemDoubleClick"],["genericGridMeterEntry",""],[3,"id"],["type","text","readonly","",1,"input-width",3,"id","ngModel","disabled","ngModelChange"],["type","text","autocomplete","off","readonly","",1,"CellWithComment",3,"id","ngModel","disabled","ngModelChange"],["type","text","autocomplete","off","readonly","",1,"CellWithComment",3,"id","value","disabled"],["type","number","autocomplete","off","autofocus","",1,"input-width",3,"id","ngModel","min","disabled","ngModelChange","keydown.enter","keydown.Tab"],["type","number","readonly","",1,"input-width",3,"id","value","disabled"],["type","text","readonly","",1,"CellWithComment",3,"id","ngModel","disabled","ngModelChange"]],template:function(n,t){if(1&n){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",0)(4,"h5"),e._uU(5,"Meter Reading"),e.qZA()()(),e.TgZ(6,"div",3)(7,"button",4),e.NdJ("click",function(){return t.refreshPage()}),e._uU(8,"Back"),e.qZA(),e.TgZ(9,"button",4,5),e.NdJ("click",function(){e.CHM(i);const r=e.MAs(10);return t.DisplayGenericListOfEntry(),e.KtG(r.value="Edit")}),e._uU(11,"Edit"),e.qZA(),e.TgZ(12,"button",4,6),e.NdJ("click",function(){e.CHM(i);const r=e.MAs(10);return t.DisplayGenericListOfEntry(),e.KtG(r.value="View")}),e._uU(14,"View"),e.qZA(),e.TgZ(15,"button",7),e.NdJ("click",function(){return t.saveMeterReading()}),e._uU(16,"Save"),e.qZA()()()(),e.TgZ(17,"div",1)(18,"div",8)(19,"div",9)(20,"div")(21,"div",10)(22,"div",11)(23,"div",12)(24,"div",13),e.ynx(25),e.TgZ(26,"div",14)(27,"div",15)(28,"div",1)(29,"label",16),e._uU(30,"Reading Date :"),e.qZA(),e.TgZ(31,"input",17),e.NdJ("ngModelChange",function(r){return t.meterReadingObj.READING_DATE=r})("change",function(){return t.onDateChange()})("blur",function(){return t.formatDate()}),e.qZA()()(),e.TgZ(32,"div",15)(33,"div",1)(34,"label",18),e._uU(35,"Entry No :"),e.qZA(),e.TgZ(36,"input",19),e.NdJ("ngModelChange",function(r){return t._trnMainService.TrnMainObj.VCHRNO=r}),e.qZA()()()(),e.BQk(),e.qZA()()()()(),e.TgZ(37,"div",20)(38,"table",21)(39,"thead")(40,"tr")(41,"th",22),e._uU(42,"S.No."),e.qZA(),e.TgZ(43,"th",23),e._uU(44,"Pump"),e.qZA(),e.TgZ(45,"th",23),e._uU(46,"Product"),e.qZA(),e.TgZ(47,"th",23),e._uU(48,"Meter Start"),e.qZA(),e.TgZ(49,"th",23),e._uU(50,"Meter End"),e.qZA(),e.TgZ(51,"th",23),e._uU(52,"Sales Qty"),e.qZA(),e.TgZ(53,"th",23),e._uU(54,"Unit"),e.qZA(),e.TgZ(55,"th",23),e._uU(56,"Meter Max"),e.qZA()()(),e.TgZ(57,"tbody"),e.YNc(58,P,19,28,"tr",24),e.qZA()()(),e.TgZ(59,"div",25)(60,"div",26)(61,"h6"),e._uU(62),e.qZA()(),e.TgZ(63,"div",26)(64,"h6"),e._uU(65),e.ALo(66,"twoDigitNumber"),e.qZA()()()()()(),e.TgZ(67,"generic-popup-grid",27,28),e.NdJ("onItemDoubleClick",function(r){e.CHM(i);const a=e.MAs(10);return e.KtG(t.dblClickPopupMeterItem(r,a.value))}),e.qZA()}2&n&&(e.xp6(15),e.Q6J("disabled","View"==t.mode),e.xp6(16),e.Q6J("ngModel",t.meterReadingObj.READING_DATE)("disabled","View"==t.mode||"Edit"==t.mode)("min",t.minDate)("max",t.maxDate),e.xp6(5),e.Q6J("ngModel",t._trnMainService.TrnMainObj.VCHRNO),e.xp6(22),e.Q6J("ngForOf",t.meterReadingObj.MeterRowDetailList),e.xp6(4),e.hij("TOTAL PUMP: ",t.meterReadingObj.TOTAL_PUMP,""),e.xp6(3),e.hij("TOTAL SALES QTY: ",e.lcZ(66,10,t.meterReadingObj.TOTAL_SALES_QTY),""),e.xp6(2),e.Q6J("popupsettings",t.gridMeterEntryPopupSettings))},dependencies:[p.sg,_.Fj,_.wV,_.JJ,_.qQ,_.On,E.Zl,S.g],styles:[".form-control[_ngcontent-%COMP%]{color:#000}.closeTooltip[_ngcontent-%COMP%]{display:inline-block;transition:.3s ease;border:none}.card-body[_ngcontent-%COMP%]{padding:0!important}.form-group.row[_ngcontent-%COMP%]{margin-bottom:5px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:26px;font-size:14px;padding-top:0;padding-bottom:0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.2rem;vertical-align:top;border-top:1px solid #dee2e6;font-size:14px}th[_ngcontent-%COMP%]{position:sticky;top:-1px;z-index:1;background-color:#6599ff;color:#fff}th[_ngcontent-%COMP%]:first-child{border-bottom:1px solid #dee2e6}.highlighted[_ngcontent-%COMP%]{background-color:#ced6d3}.footer[_ngcontent-%COMP%]{margin-right:1px;margin-bottom:2.8%;clear:both;padding-top:20px;border-top:1px solid #eaeaea;border-left:1px solid #eaeaea;border-right:1px solid #eaeaea;background-color:#eaeaea}.headerbuttons[_ngcontent-%COMP%]{font-size:12px}.input-width[_ngcontent-%COMP%]{width:100%}.card-body[_ngcontent-%COMP%]{background-color:#336799;color:#fff}.inner-body[_ngcontent-%COMP%]{margin-top:10px}.inner-row[_ngcontent-%COMP%]{margin-left:20%}.reading-label[_ngcontent-%COMP%]{font-size:13px;width:auto}.entry-label[_ngcontent-%COMP%]{font-size:13px}.total-row[_ngcontent-%COMP%]{justify-content:flex-end;.table-wrap{overflow: auto; height: 70vh;} .total-css{width: 23.25%;}}.entry-input[_ngcontent-%COMP%]{width:70%}.table-width[_ngcontent-%COMP%]{width:100%;.five{width: 5%;} .ten{width: 10%;}}"]}),s})(),canActivate:[c.C]}];let y=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[m.Bz.forChild(w),m.Bz]}),s})();var f=d(12640),L=d(53181);let U=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[c.C,{provide:f.op,useValue:f.op}],imports:[p.ez,y,L.Is]}),s})()}}]);