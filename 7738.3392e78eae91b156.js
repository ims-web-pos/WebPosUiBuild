"use strict";var ao=Object.defineProperty,co=(pe,ne,E)=>ne in pe?ao(pe,ne,{enumerable:!0,configurable:!0,writable:!0,value:E}):pe[ne]=E,gr=(pe,ne,E)=>(co(pe,"symbol"!=typeof ne?ne+"":ne,E),E);(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[7738],{93105:pe=>{var t,ne="object"==typeof Reflect?Reflect:null,E=ne&&"function"==typeof ne.apply?ne.apply:function(O,I,L){return Function.prototype.apply.call(O,I,L)};t=ne&&"function"==typeof ne.ownKeys?ne.ownKeys:Object.getOwnPropertySymbols?function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:function(O){return Object.getOwnPropertyNames(O)};var g=Number.isNaN||function(O){return O!=O};function v(){v.init.call(this)}pe.exports=v,pe.exports.once=function N(P,O){return new Promise(function(I,L){function V(j){P.removeListener(O,F),L(j)}function F(){"function"==typeof P.removeListener&&P.removeListener("error",V),I([].slice.call(arguments))}w(P,O,F,{once:!0}),"error"!==O&&function f(P,O,I){"function"==typeof P.on&&w(P,"error",O,I)}(P,V,{once:!0})})},v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var q=10;function Y(P){if("function"!=typeof P)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}function S(P){return void 0===P._maxListeners?v.defaultMaxListeners:P._maxListeners}function Q(P,O,I,L){var V,F,j;if(Y(I),void 0===(F=P._events)?(F=P._events=Object.create(null),P._eventsCount=0):(void 0!==F.newListener&&(P.emit("newListener",O,I.listener?I.listener:I),F=P._events),j=F[O]),void 0===j)j=F[O]=I,++P._eventsCount;else if("function"==typeof j?j=F[O]=L?[I,j]:[j,I]:L?j.unshift(I):j.push(I),(V=S(P))>0&&j.length>V&&!j.warned){j.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+j.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=P,k.type=O,k.count=j.length,function e(P){console&&console.warn&&console.warn(P)}(k)}return P}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(P,O,I){var L={fired:!1,wrapFn:void 0,target:P,type:O,listener:I},V=C.bind(L);return V.listener=I,L.wrapFn=V,V}function B(P,O,I){var L=P._events;if(void 0===L)return[];var V=L[O];return void 0===V?[]:"function"==typeof V?I?[V.listener||V]:[V]:I?function Z(P){for(var O=new Array(P.length),I=0;I<O.length;++I)O[I]=P[I].listener||P[I];return O}(V):z(V,V.length)}function U(P){var O=this._events;if(void 0!==O){var I=O[P];if("function"==typeof I)return 1;if(void 0!==I)return I.length}return 0}function z(P,O){for(var I=new Array(O),L=0;L<O;++L)I[L]=P[L];return I}function w(P,O,I,L){if("function"==typeof P.on)L.once?P.once(O,I):P.on(O,I);else{if("function"!=typeof P.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P);P.addEventListener(O,function V(F){L.once&&P.removeEventListener(O,V),I(F)})}}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(P){if("number"!=typeof P||P<0||g(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");q=P}}),v.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(O){if("number"!=typeof O||O<0||g(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this},v.prototype.getMaxListeners=function(){return S(this)},v.prototype.emit=function(O){for(var I=[],L=1;L<arguments.length;L++)I.push(arguments[L]);var V="error"===O,F=this._events;if(void 0!==F)V=V&&void 0===F.error;else if(!V)return!1;if(V){var j;if(I.length>0&&(j=I[0]),j instanceof Error)throw j;var k=new Error("Unhandled error."+(j?" ("+j.message+")":""));throw k.context=j,k}var H=F[O];if(void 0===H)return!1;if("function"==typeof H)E(H,this,I);else{var G=H.length,ee=z(H,G);for(L=0;L<G;++L)E(ee[L],this,I)}return!0},v.prototype.on=v.prototype.addListener=function(O,I){return Q(this,O,I,!1)},v.prototype.prependListener=function(O,I){return Q(this,O,I,!0)},v.prototype.once=function(O,I){return Y(I),this.on(O,_(this,O,I)),this},v.prototype.prependOnceListener=function(O,I){return Y(I),this.prependListener(O,_(this,O,I)),this},v.prototype.off=v.prototype.removeListener=function(O,I){var L,V,F,j,k;if(Y(I),void 0===(V=this._events))return this;if(void 0===(L=V[O]))return this;if(L===I||L.listener===I)0==--this._eventsCount?this._events=Object.create(null):(delete V[O],V.removeListener&&this.emit("removeListener",O,L.listener||I));else if("function"!=typeof L){for(F=-1,j=L.length-1;j>=0;j--)if(L[j]===I||L[j].listener===I){k=L[j].listener,F=j;break}if(F<0)return this;0===F?L.shift():function $(P,O){for(;O+1<P.length;O++)P[O]=P[O+1];P.pop()}(L,F),1===L.length&&(V[O]=L[0]),void 0!==V.removeListener&&this.emit("removeListener",O,k||I)}return this},v.prototype.removeAllListeners=function(O){var I,L,V;if(void 0===(L=this._events))return this;if(void 0===L.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==L[O]&&(0==--this._eventsCount?this._events=Object.create(null):delete L[O]),this;if(0===arguments.length){var j,F=Object.keys(L);for(V=0;V<F.length;++V)"removeListener"!==(j=F[V])&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(I=L[O]))this.removeListener(O,I);else if(void 0!==I)for(V=I.length-1;V>=0;V--)this.removeListener(O,I[V]);return this},v.prototype.listeners=function(O){return B(this,O,!0)},v.prototype.rawListeners=function(O){return B(this,O,!1)},v.listenerCount=function(P,O){return"function"==typeof P.listenerCount?P.listenerCount(O):U.call(P,O)},v.prototype.listenerCount=U,v.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},82661:(pe,ne,E)=>{E.d(ne,{C:()=>w});var t=E(26215),e=E(53181),g=E(66274),v=E(92752);let q=(()=>{class P{constructor(I,L){this.dialogref=I,this.data=L,this.heading="Information",this.heading=L.header,this.message$=L.message}authResult(I){this.dialogref.close(I)}}return P.\u0275fac=function(I){return new(I||P)(g.Y36(e.so),g.Y36(e.WI))},P.\u0275cmp=g.Xpm({type:P,selectors:[["result-dialog"]],decls:11,vars:4,consts:[[1,"modal-dialog","modal-md"],[1,"modal-content"],[1,"modal-header","custom-modal-header"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],[1,"modal-body"],[2,"display","inline-block"]],template:function(I,L){1&I&&(g.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),g._uU(4),g.qZA(),g.TgZ(5,"div",4),g.NdJ("click",function(){return L.authResult(!0)}),g._uU(6,"\xd7"),g.qZA()(),g.TgZ(7,"div",5),g._UZ(8,"div",6),g._uU(9),g.ALo(10,"async"),g.qZA()()()),2&I&&(g.xp6(4),g.Oqu(L.heading),g.xp6(5),g.hij(" ",g.lcZ(10,2,L.message$)," "))},dependencies:[v.Ov],encapsulation:2}),P})();var Y=E(67297),S=E(53074),Q=E(14970),C=E(48083),_=E(67311);function B(P,O){1&P&&(g.TgZ(0,"h4",5),g._uU(1,"Your Fiscal Year is Changed. Year End Process will generate new sequence for transaction. Would you like to start Inventry year Ending Process ? "),g.qZA())}function U(P,O){1&P&&(g.TgZ(0,"h4",5),g._uU(1,"Your Fiscal Year is Changed.Please do year end process from Online portal and sync the transaction.If you want do back date Sales invoice Click Ok to continue.Thank you... "),g.qZA())}function z(P,O){if(1&P){const I=g.EpF();g.TgZ(0,"button",6),g.NdJ("click",function(){g.CHM(I);const V=g.oxw();return g.KtG(V.YesClick())}),g._uU(1,"Yes"),g.qZA()}}function $(P,O){if(1&P){const I=g.EpF();g.TgZ(0,"button",6),g.NdJ("click",function(){g.CHM(I);const V=g.oxw();return g.KtG(V.NoClick())}),g._uU(1,"No"),g.qZA()}}function Z(P,O){if(1&P){const I=g.EpF();g.TgZ(0,"button",6),g.NdJ("click",function(){g.CHM(I);const V=g.oxw();return g.KtG(V.offlinelineOK())}),g._uU(1,"OK"),g.qZA()}}let N=(()=>{class P{constructor(I,L,V,F,j,k){this.dialogref=I,this.authSerice=L,this.masterService=V,this.spinnerService=F,this.router=j,this.alertService=k}YesClick(){1!==this.masterService.userSetting.ENABLEOFFLINESALE&&(this.spinnerService.show("Processing...Please Wait..."),this.masterService.masterGetmethod("/yearEndingInventory").subscribe(I=>{"ok"===I.status?(this.authSerice.setSessionVariable("isIYE",1),this.dialogref.close(),this.alertService.success("The year end for inventory are done successfully..."),setTimeout(()=>{console.log("from logout"),this.router.navigate(["login",{logout:"logout"}]).then(()=>{window.location.reload()})},5e3)):(this.spinnerService.hide(),alert(I.result.error))},I=>{this.spinnerService.hide(),alert(JSON.parse(I._body))}))}NoClick(){this.authSerice.setSessionVariable("isIYE",2),this.dialogref.close()}offlinelineOK(){this.authSerice.setSessionVariable("isIYE",2),this.dialogref.close()}}return P.\u0275fac=function(I){return new(I||P)(g.Y36(e.so),g.Y36(Y.e),g.Y36(S.P),g.Y36(Q.V),g.Y36(C.F0),g.Y36(_.c))},P.\u0275cmp=g.Xpm({type:P,selectors:[["inventry-yearend-dialog"]],decls:8,vars:5,consts:[[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-header"],["class","modal-title","id","myModalLabel",4,"ngIf"],[1,"modal-body"],["class","btn btn-info",3,"click",4,"ngIf"],["id","myModalLabel",1,"modal-title"],[1,"btn","btn-info",3,"click"]],template:function(I,L){1&I&&(g.TgZ(0,"div",0)(1,"div",1),g.YNc(2,B,2,0,"h4",2),g.YNc(3,U,2,0,"h4",2),g.qZA(),g.TgZ(4,"div",3),g.YNc(5,z,2,0,"button",4),g.YNc(6,$,2,0,"button",4),g.YNc(7,Z,2,0,"button",4),g.qZA()()),2&I&&(g.xp6(2),g.Q6J("ngIf",1!=L.masterService.userSetting.ENABLEOFFLINESALE),g.xp6(1),g.Q6J("ngIf",1==L.masterService.userSetting.ENABLEOFFLINESALE),g.xp6(2),g.Q6J("ngIf",1!=L.masterService.userSetting.ENABLEOFFLINESALE),g.xp6(1),g.Q6J("ngIf",1!=L.masterService.userSetting.ENABLEOFFLINESALE),g.xp6(1),g.Q6J("ngIf",1==L.masterService.userSetting.ENABLEOFFLINESALE))},dependencies:[v.O5],styles:[".md-dialog-container[_ngcontent-%COMP%]{height:auto!important;width:auto!important;overflow:hidden!important;box-shadow:0!important}.mat-dialog-container[_ngcontent-%COMP%]{background:transparent!important;box-shadow:none!important;margin-left:auto;margin-right:auto;overflow:hidden!important;height:350px!important}.auth-main[_ngcontent-%COMP%]{position:inherit!important;display:inherit!important}.cdk-overlay-pane[_ngcontent-%COMP%], .md-overlay-pane[_ngcontent-%COMP%]{height:auto!important}.cdk-overlay-pane[_ngcontent-%COMP%], .md-overlay-pane[_ngcontent-%COMP%]{flex:1 1 0}"]}),P})();var f=E(71180);let w=(()=>{class P{constructor(I,L,V,F,j){this.gblstate=I,this._authService=L,this.masterService=V,this.router=F,this.dialog=j,this.viewPermission=[],this.userSetting={},this.enableFiscalYearEnd=!1,this.viewPermission=I.getGlobalSetting("View-Permission")||[],this.userSetting=this.masterService.userSetting}canActivate(I,L){const V=new t.X(""),F=V.asObservable(),j=this._authService.getAuth();let k="";null!=I.url[0]&&(k=I.url[0].path),console.log("path",k);let H=I.params.mode;if(void 0===H&&(H="list"),!j||!j.profile){V.next("Your session has expired. You have been logged out of your account in another tab. Please log in again to continue.");const ee=this.dialog.open(q,{hasBackdrop:!0,data:{header:"Information",message:F}});return setTimeout(()=>{ee.close()},1e4),!1}if(this.masterService.checkUserValid().subscribe(de=>{if(!1===de){V.next("Your session has expired. You have been logged out of your account in another tab. Please log in again to continue.");const be=this.dialog.open(q,{hasBackdrop:!0,data:{header:"Information",message:F}});return setTimeout(()=>(be.close(),!1),1e4),!1}}),0===this._authService.getSessionVariable("isIYE")&&(this.dialog.closeAll(),this.dialog.open(N,{hasBackdrop:!0,data:{header:"Information",message:""}}),"dashboard"!==k))return!1;if(j&&j.profile&&"dashboard"===k||"SYSTEMUSER"===this._authService?.getUserProfile()?.username.toUpperCase()&&("division"==k||"payment-mode-master"==k))return!0;("adduser"==k&&"role"==H||"adduser"==k&&"user"==H)&&(H="add"),"adduser"==k&&"editRole"==H&&(H="edit");const G=this._authService.getMenuRight(k,H);return k?!0===G.right||"list"===H&&!0===G.list:!0===G.list||void 0}}return P.\u0275fac=function(I){return new(I||P)(g.LFG(f.q),g.LFG(Y.e),g.LFG(S.P),g.LFG(C.F0),g.LFG(e.uw))},P.\u0275prov=g.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},53704:(pe,ne,E)=>{E.d(ne,{x:()=>lr});var t=E(66274),e=E(42326),g=E(28698),v=E(37051),q=E(82484),Y=E(27009),S=E(64752),Q=E(71732),C=E(92752),_=E(23815),B=E(15613),U=E(53074),z=E(87584),$=E(69389),Z=E(53181),N=E(7587),f=E(48083),w=E(67311),P=E(67297),O=E(14970),I=E(74263),L=E(60694),V=E(7782),F=E(48063),j=E(33612),k=E(71800),H=E(98692),G=E(90994);const ee=["discountPercentageInput"],de=["discountAmountInput"],be=["applyButton"];function Oe(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div")(1,"div",17)(2,"div",18)(3,"div",19)(4,"h5",20),t._uU(5,"Discount authorization"),t.qZA(),t.TgZ(6,"button",21),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t.TgZ(7,"span",22),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",23)(10,"div",24)(11,"div",25)(12,"div",26)(13,"label",27),t._uU(14,"User Name:"),t.qZA(),t.TgZ(15,"div",28)(16,"input",29),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disLimitAuthObj.username=c)}),t.qZA()()()(),t.TgZ(17,"div",25)(18,"div",26)(19,"label",27),t._uU(20,"Password:"),t.qZA(),t.TgZ(21,"div",28)(22,"input",30),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disLimitAuthObj.password=c)}),t.qZA()()()()(),t.TgZ(23,"div",24)(24,"div",25)(25,"div",26)(26,"label",27),t._uU(27,"Discount Percent:"),t.qZA(),t.TgZ(28,"input",31),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disLimitAuthObj.discountRate=c)}),t.qZA()()(),t.TgZ(29,"div",25)(30,"div",26)(31,"label",27),t._uU(32,"Discount Amount:"),t.qZA(),t.TgZ(33,"input",31),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disLimitAuthObj.discountAmt=c)}),t.qZA()()()(),t.TgZ(34,"div",32)(35,"fieldset",33)(36,"legend",34),t._uU(37,"Discount authorization remarks:"),t.qZA(),t.TgZ(38,"textarea",35),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disLimitAuthObj.remarks=c)}),t.qZA()()()(),t.TgZ(39,"div",36)(40,"button",37),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.discountIndAuthConfirm())}),t._uU(41,"Confirm"),t.qZA()()()()()}if(2&m){const r=t.oxw();t.xp6(16),t.Q6J("ngModel",r._trnMainService.disLimitAuthObj.username),t.xp6(6),t.Q6J("ngModel",r._trnMainService.disLimitAuthObj.password),t.xp6(6),t.Q6J("disabled",r._trnMainService.nullToZeroConverter(r._trnMainService.disLimitAuthObj.discountAmt)>0)("ngModel",r._trnMainService.disLimitAuthObj.discountRate),t.xp6(5),t.Q6J("disabled",r._trnMainService.nullToZeroConverter(r._trnMainService.disLimitAuthObj.discountRate)>0)("ngModel",r._trnMainService.disLimitAuthObj.discountAmt),t.xp6(5),t.Q6J("ngModel",r._trnMainService.disLimitAuthObj.remarks)}}let Ee=(()=>{class m{constructor(r,l,c,u){this._trnMainService=r,this.alertService=l,this.masterService=c,this.loader=u,this.discountPercentage=0,this.discountAmount=0,this.isActive=!1,this.isPercentageChanged=!1,this.UserDisLimit=this.masterService.userProfile.userRights.filter(y=>"DISLIMIT"==y.right)[0]?.value,this.RoleDisLimit=this.masterService.userProfile.roleRights.find(y=>"DISLIMIT"==y.right).value,this.disLimit=0!=this._trnMainService.nullToZeroConverter(this.UserDisLimit)?this.UserDisLimit:this.RoleDisLimit}ngOnInit(){}submitDiscountValues(){this.discountAmount<0&&(this.discountAmount=0),null!=this.discountAmount&&(this._trnMainService.TrnMainObj.ProdList[this.rowIndex].INDDISCOUNTRATE=this.isPercentageChanged?this.discountPercentage:0,this._trnMainService.TrnMainObj.ProdList[this.rowIndex].INDDISCOUNT=this.discountAmount),this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1,document.getElementById("discountAmt"+this.rowIndex).focus()}show(){this.discountPercentage=null,this.discountAmount=0,this.isActive=!0,setTimeout(()=>this.focusOnDiscountPercentageInput(),0)}hide(){this.isActive=!1}onKeydownHandler(r){["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","End","Insert","Escape"].includes(r.key)&&this.hide()}focusOnDiscountPercentageInput(){this.discountPercentageInput&&this.discountPercentageInput.nativeElement.focus()}onDiscRateChange(r){if(this.discountPercentage=Number(r.target.value),this.discountPercentage<0)return this.discountPercentage=0,void this.alertService.warning("Discount percentage cannot be less than 0");if(this.discountPercentage>100)return this.discountPercentage=0,void this.alertService.warning("Discount percentage cannot be more than 100");if(this.discountPercentage>this.disLimit&&!this._trnMainService.isPurchaseModule()){if(!confirm("Discount limit of :"+this.disLimit+"% exceeded. Do You Want To Ask for Discount Authorization ???"))return this._trnMainService.clearDisAuthValues(),void(this.discountPercentage=0);this._trnMainService.disLimitAuthObj.discountRate=this.discountPercentage,this._trnMainService.showIndDiscountAuth=!0}let l=this._trnMainService.TrnMainObj.ProdList[this.rowIndex].RATE;l=parseFloat(Number(this._trnMainService.nullToZeroConverter(l)).toFixed(3));let c=this._trnMainService.TrnMainObj.ProdList[this.rowIndex].ALTERNATEQUANTIY,u=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.rowIndex].ECSAMOUNT);this.discountAmount=(l*c+u)*(this.discountPercentage/100),this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)).toFixed(2)),this.isPercentageChanged=!0}focusOnDiscountAmountInput(){this.discountAmountInput&&this.discountAmountInput.nativeElement.focus()}onDiscAmountChange(r){if(this.discountAmount=Number(r.target.value),this.discountAmount<0)return this.discountAmount=0,void this.alertService.warning("Discount amount cannot be less than 0");if(this.discountAmount>this._trnMainService.TrnMainObj.ProdList[this.rowIndex].NETAMOUNT)return this.discountAmount=0,void this.alertService.warning("Discount amount cannot be more than "+this._trnMainService.TrnMainObj.ProdList[this.rowIndex].NETAMOUNT);if(this.discountAmount>this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT*this.disLimit/100&&!this._trnMainService.isPurchaseModule()){if(!confirm("Discount limit of :"+this.disLimit+"% exceeded. Do You Want To Ask for Discount Authorization ???"))return this._trnMainService.clearDisAuthValues(),void(this.discountAmount=0);this._trnMainService.disLimitAuthObj.discountAmt=this.discountAmount,this._trnMainService.showIndDiscountAuth=!0}this._trnMainService.TrnMainObj.ProdList[this.rowIndex]?.ISVAT&&1==this._trnMainService.userSetting?.EnableVatExcludingDiscount&&!this._trnMainService.isPurchaseModule()&&(this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)/this._trnMainService.userSetting.VatConRate).toFixed(2))),this.discountPercentage=100*this.discountAmount/this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT,this.discountPercentage=parseFloat(this.discountPercentage.toFixed(3)),this.isPercentageChanged=!1}focusOnApplyButton(){this.applyButton&&this.applyButton.nativeElement.focus()}onKeydown(r,l){("Enter"===r.key||"Tab"===r.key)&&(r.preventDefault(),l?this[l].nativeElement.focus():r.target.focus())}closeModal(){this._trnMainService.clearDisAuthValues(),this.discountAmount=0,this.discountPercentage=0,this._trnMainService.showIndDiscountAuth=!1}discountIndAuthConfirm(){this._trnMainService.disLimitAuthObj.isAuthDisLim=!0,this.loader.show("Authorizing Please wait"),this.masterService.authorizeDiscountLimitInSO(this._trnMainService.disLimitAuthObj).subscribe(r=>{if(this.loader.hide(),"ok"==r.status){let l=0!=this._trnMainService.nullToZeroConverter(r.result.userDisLimit)?r.result.userDisLimit:r.result.roleDisLimit;this._trnMainService.limitValue=this._trnMainService.disLimitAuthObj.discountRate,this.discountPercentage=this._trnMainService.limitValue,this._trnMainService.nullToZeroConverter(this._trnMainService.disLimitAuthObj.discountAmt)>0&&(this._trnMainService.limitValue=100*Number(this._trnMainService.disLimitAuthObj.discountAmt)/this._trnMainService.TrnMainObj.ProdList[this.rowIndex].AMOUNT,this.discountPercentage=this._trnMainService.limitValue,this.discountAmount=this._trnMainService.disLimitAuthObj.discountAmt,this._trnMainService.TrnMainObj.ProdList[this.rowIndex]?.ISVAT&&1==this._trnMainService.userSetting?.EnableVatExcludingDiscount&&!this._trnMainService.isPurchaseModule()&&(this.discountAmount=parseFloat(Number(this._trnMainService.nullToZeroConverter(this.discountAmount)/this._trnMainService.userSetting.VatConRate).toFixed(2)))),this._trnMainService.limitValue>l?(this.alertService.error("Specified discount value exceeded authorized discount limit!!!"),this.isActive=!0,this.discountAmount=0,this.discountPercentage=0,this._trnMainService.onFlatDiscountClear(),this._trnMainService.clearDisAuthValues()):(this.alertService.success("Authorization Sucessfull"),this._trnMainService.resetDisLimitAuthObj()),this._trnMainService.showIndDiscountAuth=!1}else this._trnMainService.clearDisAuthValues(),this._trnMainService.onFlatDiscountClear()})}ngOnDestroy(){this.discountAmount=0,this.discountPercentage=0}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(z.p),t.Y36(w.c),t.Y36(U.P),t.Y36(O.V))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-discount-popup"]],viewQuery:function(r,l){if(1&r&&(t.Gf(ee,5),t.Gf(de,5),t.Gf(be,5)),2&r){let c;t.iGM(c=t.CRH())&&(l.discountPercentageInput=c.first),t.iGM(c=t.CRH())&&(l.discountAmountInput=c.first),t.iGM(c=t.CRH())&&(l.applyButton=c.first)}},hostBindings:function(r,l){1&r&&t.NdJ("keydown",function(u){return l.onKeydownHandler(u)},!1,t.evT)},inputs:{rowIndex:"rowIndex"},decls:22,vars:4,consts:[[1,"backdrop",3,"hidden"],[1,"discount-popup-box"],[1,"discount-popup-box-header"],[1,"text-white","py-2","ms-4",2,"margin-left","10px"],[1,"discount-popup-box-header-button",3,"click"],[1,"discount-popup-box-contents","mt-3"],[2,"display","flex"],[2,"width","40px"],["type","number","name","discount_percentage","tabindex","1",2,"width","100px","border-radius","5px",3,"ngModel","ngModelChange","change","keydown"],["discountPercentageInput",""],[2,"display","flex","justify-content","center"],[2,"width","50px"],["type","number","name","discount_amount","tabindex","2",2,"width","100px","border-radius","5px",3,"ngModel","ngModelChange","change","keydown"],["discountAmountInput",""],["tabindex","3",1,"discount-popup-box-submit-button","btn","btn-info",3,"keydown","click","keydown.enter"],["applyButton",""],[4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","20rem"],[1,"modal-content","modal-content-main-area",2,"width","auto","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group","row","mb-2",2,"margin","0.5rem"],[1,"col-md-6","col-sm-12"],[1,"row"],[1,"col-5","form-control-label","p-0","m-0",2,"font-size","13px"],[1,"col-6",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","number","id","Parent","autocomplete","off",1,"col-6","form-control",2,"height","4vh","font-size","13px",3,"disabled","ngModel","ngModelChange"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(r,l){1&r&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4,"SET INDIVIDUAL DISCOUNT"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return l.hide()}),t._uU(6,"\xd7"),t.qZA()(),t.TgZ(7,"div",5)(8,"div",6)(9,"label",7),t._uU(10,"Dis %: "),t.qZA(),t.TgZ(11,"input",8,9),t.NdJ("ngModelChange",function(u){return l.discountPercentage=u})("change",function(u){return l.onDiscRateChange(u)})("keydown",function(u){return l.onKeydown(u,"discountAmountInput")}),t.qZA()(),t.TgZ(13,"div",10)(14,"label",11),t._uU(15,"Dis Amt: "),t.qZA(),t.TgZ(16,"input",12,13),t.NdJ("ngModelChange",function(u){return l.discountAmount=u})("change",function(u){return l.onDiscAmountChange(u)})("keydown",function(u){return l.onKeydown(u,"applyButton")}),t.qZA()()(),t.TgZ(18,"button",14,15),t.NdJ("keydown",function(u){return l.onKeydown(u,null)})("click",function(){return l.submitDiscountValues()})("keydown.enter",function(){return l.submitDiscountValues()}),t._uU(20,"Apply"),t.qZA()()(),t.YNc(21,Oe,42,7,"div",16)),2&r&&(t.Q6J("hidden",!l.isActive),t.xp6(11),t.Q6J("ngModel",l.discountPercentage),t.xp6(5),t.Q6J("ngModel",l.discountAmount),t.xp6(5),t.Q6J("ngIf",l._trnMainService.showIndDiscountAuth))},dependencies:[C.O5,N.Fj,N.wV,N.JJ,N.On],styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}.discount-popup-box[_ngcontent-%COMP%]{position:fixed;top:35%;left:35%;background-color:#fff;width:400px;height:186px;border:2px solid #888888;border-radius:5px}.discount-popup-box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background:#4472C4;width:100%}.discount-popup-box-header-button[_ngcontent-%COMP%]{margin:8px;background-color:#375892;color:#000;border:0;border-radius:5px;height:25px;width:25px;font-weight:700;outline:none}.discount-popup-box-contents[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;margin-top:35px!important}.discount-popup-box-submit-button[_ngcontent-%COMP%]{border-radius:5px;font-size:medium;padding:3px 25px;margin:20px 150px!important;background-color:#007bff}@media (max-width: 900px){.discount-popup-box[_ngcontent-%COMP%]{left:20%}}"]}),m})();var Ne=E(64657),Re=E(59963),we=E(65171),Ke=E(32711),Ge=E(87454),Ye=E(86857),lt=E(94619),ht=E(14173);function dt(m,D){if(1&m&&(t.TgZ(0,"tr",10)(1,"td",11),t._uU(2),t.qZA(),t.TgZ(3,"td",12),t._uU(4),t.qZA(),t.TgZ(5,"td",12),t._uU(6),t.qZA()()),2&m){const r=D.$implicit,l=D.index;t.xp6(2),t.Oqu(l+1),t.xp6(2),t.Oqu(r.Warehouse),t.xp6(2),t.Oqu(r.Stock)}}function ut(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),t._uU(4,"Warehouse Wise Stock"),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.itemBatchClosed())}),t.TgZ(6,"span",6),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"table",7)(9,"tr",8)(10,"th"),t._uU(11,"Sn."),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Warehouse"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Stock"),t.qZA()(),t.TgZ(16,"tbody"),t.YNc(17,dt,7,3,"tr",9),t.qZA()()()()}if(2&m){const r=t.oxw();t.xp6(17),t.Q6J("ngForOf",r.wareHouseStockList)}}let pt=(()=>{class m{constructor(r,l){this.masterRepo=r,this._trnMainService=l,this.isActive=!1,this.wareHouseStockList=[]}ngOnInit(){}show(r,l){this.isActive=!0,this.wareHouseStockList=[],this.indexRow=l,this.masterRepo.getWarehouseWiseStock(r).subscribe(c=>{this.wareHouseStockList=c})}itemBatchClosed(){this.isActive=!1,setTimeout(()=>{this.masterRepo.focusAnyControl("alternateQty"+this.indexRow)},50)}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(U.P),t.Y36(z.p))},m.\u0275cmp=t.Xpm({type:m,selectors:[["warehousewisestock"]],decls:1,vars:1,consts:[["class","modal-sticky","style","width: 50vw;",4,"ngIf"],[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],["aria-disabled","true","class","highlight",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"]],template:function(r,l){1&r&&t.YNc(0,ut,18,1,"div",0),2&r&&t.Q6J("ngIf",l.isActive)},dependencies:[C.sg,C.O5],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }"]}),m})();var _t=E(88762),Tt=E(89952);let Mt=(()=>{class m{constructor(r){this._trnMainService=r}transform(r){return this.showColumnInProductInsert(r)}showColumnInProductInsert(r){switch(r){case"showNetAmtHeadercolumn":return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment);case"showVATcolumn":return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||(this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation)&&0==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment);case"showNetAmtNonEditable":return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Stockadjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ReverseProductionEntry&&!(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT);case"showNetAmtEditable":return this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT;case"showRateHeader":return[1,5,7,8,9,10,14,15,19,20,24,41,43,57,64,73,74,75,80,81,88,90].includes(this._trnMainService.TrnMainObj.VoucherType)&&!(19===this._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"===this._trnMainService.TrnMainObj.AdditionalObj?.tag)&&!(90===this._trnMainService.TrnMainObj.VoucherType&&1===this._trnMainService.userSetting.LogBasedRequisitionApproval)&&!this._trnMainService.hideColumn("Rate",e.Km[this._trnMainService.TrnMainObj.VoucherType])}}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(z.p,16))},m.\u0275pipe=t.Yjl({name:"showColumn",type:m,pure:!0}),m})();var Vi=E(77398),mt=E(79700),St=E(84260),vt=E(56529);let gt=(()=>{class m{constructor(r,l){this.authservice=r,this._trnMainService=l}transform(r){return this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1!==this.authservice.getSetting().ENABLESINGLEBATCHMODE}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(P.e,16),t.Y36(z.p,16))},m.\u0275pipe=t.Yjl({name:"checkBatchMode",type:m,pure:!0}),m})();const Ui=["genericGridSupplierPopup"],ft=["barCodeGridPopup"],Bi=["discountPopup"],Ot=["PetrolGrid"],Ki=["genericGridMulitplePricePopup"],Zi=["matrixitemgrid"],Fi=["warehouseWiseStockPopup"],Hi=["itemEditGrid"],bt=["authenticationPopup"],Ct=["rateValidatoin"],it=["genericGrid"],Je=["focusBatch"];function At(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function Et(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1,"Code"),t.qZA())}function It(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Barcode "),t.qZA())}function qe(m,D){1&m&&(t.TgZ(0,"th",56),t._uU(1,"HS Code"),t.qZA())}function Pt(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Alt.Unit "),t.qZA())}function yt(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Alt.Qty "),t.qZA())}const ke=function(){return{width:"10%"}};function xt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," BatchNo "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function Rt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Source Barcode "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function Nt(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," Source Batch Rate "),t.qZA())}function Lt(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," S.. BatchId "),t.qZA())}function wt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Source Batch "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function nt(m,D){1&m&&(t.TgZ(0,"th",59),t._uU(1," P-Stock "),t.qZA())}function Dt(m,D){1&m&&(t.TgZ(0,"th",59),t._uU(1," C-Stock "),t.qZA())}function jt(m,D){1&m&&(t.TgZ(0,"th",60),t._uU(1," Quantity "),t.qZA())}function kt(m,D){1&m&&(t.TgZ(0,"th",60),t._uU(1," Other Unit Qty "),t.qZA())}const Be=function(){return{width:"8%"}};function Vt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Request Qty "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Be):null)}}function Ut(m,D){if(1&m&&(t.TgZ(0,"th",8),t._uU(1," Approved Qty "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Be):null)}}function Bt(m,D){if(1&m&&(t.TgZ(0,"th",8),t._uU(1," Sellable Stock "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Be):null)}}function Kt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Adjusting Barcode "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}const Ze=function(){return{width:"7%"}};function Zt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Adjusting Batch "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Ze):null)}}function Ft(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Adjusting Batch Rate "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?t.DdM(1,Ze):t.DdM(2,ke))}}function Ht(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," A.. BatchId "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Ze):null)}}function Qt(m,D){if(1&m&&(t.TgZ(0,"th",57),t._uU(1," Variance Amnt "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?t.DdM(1,Ze):t.DdM(2,ke))}}function Gt(m,D){if(1&m&&(t.TgZ(0,"th",58),t._uU(1),t.qZA()),2&m){const r=t.oxw();t.xp6(1),t.hij(" ",r.FCRATELABEL," ")}}const Yt=function(){return{width:"15%"}},Jt=function(){return{width:"20%"}};function qt(m,D){if(1&m&&(t.TgZ(0,"th",61),t._uU(1," Rate "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",19==r._trnMainService.TrnMainObj.VoucherType||8==r._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Yt):null)("ngStyle",7==r._trnMainService.TrnMainObj.VoucherType?t.DdM(4,Jt):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?t.DdM(5,Be):null)}}function Wt(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," P.Rate "),t.qZA())}function $t(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1,"Amount"),t.qZA())}function zt(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," Con.Factor "),t.qZA())}function Xt(m,D){1&m&&(t.TgZ(0,"th",62),t._uU(1," Amt "),t.qZA())}function ei(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," ECS "),t.qZA())}const We=function(){return{width:"6.5%"}};function ti(m,D){if(1&m&&(t.TgZ(0,"th",61),t._uU(1," Amt "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",8==r._trnMainService.TrnMainObj.VoucherType||15==r._trnMainService.TrnMainObj.VoucherType||1==r._trnMainService.TrnMainObj.VoucherType||7==r._trnMainService.TrnMainObj.VoucherType?t.DdM(2,We):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Be):null)}}function ii(m,D){1&m&&(t.TgZ(0,"th",63),t._uU(1," Ind. Disc "),t.qZA())}function ni(m,D){1&m&&(t.TgZ(0,"th",63),t._uU(1," Total Disc "),t.qZA())}function ri(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," Sales Price "),t.qZA())}function $e(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," Sales Price(W/V) "),t.qZA())}function oi(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," WSP "),t.qZA())}function si(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," WSP(W/V) "),t.qZA())}function ai(m,D){1&m&&(t.TgZ(0,"th",64),t._uU(1," Dis% "),t.qZA())}function ci(m,D){1&m&&(t.TgZ(0,"th",63),t._uU(1," Dis Amt "),t.qZA())}function li(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1," S.Charge "),t.qZA())}function hi(m,D){1&m&&(t.TgZ(0,"th",58),t._uU(1,"VAT"),t.qZA())}function di(m,D){1&m&&(t.TgZ(0,"th",62),t._uU(1,"Net Amt"),t.qZA())}function ui(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Net Rate "),t.qZA())}function pi(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function _i(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Approval "),t.qZA())}function Ti(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," MASTER ITEM "),t.qZA())}function Mi(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1,"OUT-QTY"),t.qZA())}function mi(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1,"UNIT"),t.qZA())}function Si(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Order Comments "),t.qZA())}function vi(m,D){1&m&&(t.TgZ(0,"th",65),t._uU(1," MRP "),t.qZA())}const rt=function(){return{width:"130px"}};function gi(m,D){if(1&m&&(t.TgZ(0,"th",8),t._uU(1," Mfg Date "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,We):t.DdM(2,rt))}}function fi(m,D){if(1&m&&(t.TgZ(0,"th",8),t._uU(1," Exp Date "),t.qZA()),2&m){const r=t.oxw();t.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,We):t.DdM(2,rt))}}function Oi(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," Old Expiry Date "),t.qZA())}function bi(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," New Mfg Date "),t.qZA())}function Ci(m,D){1&m&&(t.TgZ(0,"th"),t._uU(1," New Exp Date "),t.qZA())}function Ai(m,D){1&m&&(t.TgZ(0,"th",66),t._uU(1," Remarks "),t.qZA())}function Ei(m,D){1&m&&t._UZ(0,"th")}function Ii(m,D){if(1&m&&(t.TgZ(0,"td",111),t._uU(1),t.qZA()),2&m){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",r.MENUCODE," ")}}function Pi(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",112)(1,"input",113),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.BC=c)})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ItemBarCodeClick(u,c))})("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ItemBarCodeClick(u,c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ItemBarCodeClick(u,c))})("focusout",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ItemBarCodeFoucusOut(u,c))})("focus",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ItemBarCodeClickFocusIn(u,c))}),t.ALo(2,"disable"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","barcode",l,""),t.Q6J("ngModel",c.BC)("readonly","VIEW"==c.rowMode)("disabled",t.Dn7(2,5,"disableBarcodeField",l,u._trnMainService.callPipe)),t.uIk("disabled",!0)}}function yi(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",112)(1,"input",114),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.HS_Code=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","hsCode",l,""),t.Q6J("ngModel",c.HS_Code),t.uIk("disabled",!0)}}const Fe=function(m){return{tooltipChild:m}};function xi(m,D){if(1&m&&(t.ynx(0),t._UZ(1,"span",115),t.BQk()),2&m){const r=t.oxw().index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Fe,l.hoverId==r))("innerHTML",l.itemDescHoverValue,t.oJD)}}function Ri(m,D){if(1&m&&(t.ynx(0),t.TgZ(1,"option",119),t._uU(2),t.qZA(),t.BQk()),2&m){const r=D.$implicit;t.xp6(1),t.s9C("value",r.ALTUNIT),t.xp6(1),t.Oqu(r.ALTUNIT)}}function Ni(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",116)(1,"select",117),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ALTERNATEUNIT=c)}),t.YNc(2,Ri,3,2,"ng-container",118),t.qZA()()}if(2&m){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.ALTERNATEUNIT),t.xp6(1),t.Q6J("ngForOf",null==r.Product?null:r.Product.AlternateUnits)}}function R(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",120)(1,"input",121),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.OPQTY=c)}),t.qZA()()}if(2&m){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.OPQTY)}}function J(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",122)(1,"input",123,124),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.BATCH=c)})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))})("keydown",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.onKeydownOnBatch(c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))})("focusout",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.batchFocusOut(u,c))}),t.ALo(3,"disable"),t.qZA(),t.TgZ(4,"span",74),t._uU(5,"press ENTER or TAB to Select Batch"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","batch",l,""),t.Q6J("ngModel",c.BATCH)("disabled",t.Dn7(3,4,"disableBatch",l,u._trnMainService.callPipe))("readonly",u.readOnlyBatch())}}function a(m,D){if(1&m&&(t.ynx(0),t.TgZ(1,"option",119),t._uU(2),t.qZA(),t.BQk()),2&m){const r=D.$implicit;t.xp6(1),t.s9C("value",r.ALTUNIT),t.xp6(1),t.Oqu(r.ALTUNIT)}}function d(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",116)(1,"select",125),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.SelectUnit(c))})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.AlternateUnitEnterEventClick(u,c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.AlternateUnitEnterEventClick(u,c))})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ALTUNIT=c)}),t.ALo(2,"disable"),t.YNc(3,a,3,2,"ng-container",118),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","alternateunit",l,""),t.Q6J("ngModel",c.ALTUNIT)("disabled",t.Dn7(2,4,"disableAltUnit",l,u._trnMainService.callPipe)),t.xp6(2),t.Q6J("ngForOf",null==c.Product?null:c.Product.AlternateUnits)}}function h(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",126)(1,"input",127),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.BC=c)})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebc",l,""),t.Q6J("ngModel",c.BC)("disabled",0==c.HASVARIANT)}}function M(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",120)(1,"input",128),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.BATCHID=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebatchId",l,""),t.Q6J("ngModel",c.BATCHID)("readonly",!0)}}function x(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",116)(1,"input",129),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ALTUNIT=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","punit",l,""),t.Q6J("ngModel",c.ALTUNIT)}}function X(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",130)(1,"input",131),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.VRATE=c)}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","sourceRate",l,""),t.Q6J("ngModel",u.applyPipeInRate?t.lcZ(2,3,c.VRATE):c.VRATE)("readonly",!0)}}function re(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",122)(1,"input",132),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.BATCH=c)})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))})("keydown",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.onKeydownOnBatch(c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.BatchEnter(u,c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebatch",l,""),t.Q6J("ngModel",c.BATCH)("disabled",c.isDisabled||"VIEW"==c.rowMode)}}function me(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",134),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.PSTOCK=c)})("keydown.Enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.PstockEnter(u,c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","physicalStock",l,""),t.Q6J("ngModel",c.PSTOCK)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||"stock-adjustment"===u.activeurlpath)}}function Ie(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",135),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.CSTOCK=c)})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.CstockEnter(u,c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","computerStock",l,""),t.Q6J("ngModel",c.CSTOCK)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||"stock-adjustment"===u.activeurlpath)}}function ve(m,D){if(1&m&&(t.ynx(0),t._UZ(1,"span",115),t.BQk()),2&m){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Fe,l.qtyId==r))("innerHTML",l.qtyValue,t.oJD)}}function ge(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",136),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ALTERNATEQUANTIY=c)})("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.QuantityChangeEvent(u,c))})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.AlternateQuantityEventClick(u,c))})("keydown.Enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.AlternateQuantityEventClick(u,c))})("keypress",function(c){t.CHM(r);const u=t.oxw(),y=u.$implicit,K=u.index,ie=t.oxw();return t.KtG(1==y.NATURETYPE&&1!=y.isPurchaseOrder?ie.AlternateQuantityEventClick(K,c):ie.return)})("mouseover",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverQty(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverLeaveQty(c))}),t.ALo(2,"disable"),t.qZA(),t.YNc(3,ve,2,4,"ng-container",5),t.qZA()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","alternateQty",l,""),t.Q6J("ngModel",c.ALTERNATEQUANTIY)("readonly",c.isQuantityReadonly)("disabled",t.Dn7(2,6,"disableAltQty",l,u._trnMainService.callPipe))("OnlyWholeNumber",1==c.StopDecimal),t.xp6(2),t.Q6J("ngIf",u.showtooltip)}}function Ve(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"input",137),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.OtherUnitQty=c)}),t.ALo(1,"disable"),t.qZA()}if(2&m){const r=t.oxw(),l=r.$implicit,c=r.index,u=t.oxw();t.Q6J("ngModel",l.OtherUnitQty)("disabled",t.Dn7(1,2,"disableAltQty",c,u._trnMainService.callPipe))}}function He(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",138),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.APPROVEDALTQTY=c)})("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.approvedQtyEnter(u,c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.approvedQtyEnter(c))}),t.ALo(2,"disable"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","approvedQty",l,""),t.Q6J("ngModel",c.APPROVEDALTQTY)("disabled",t.Dn7(2,3,"disableAprroveQty",l,u._trnMainService.callPipe))}}function ze(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",139),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.STOCK=c)}),t.ALo(2,"disable"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","stock",l,""),t.Q6J("ngModel",c.STOCK)("disabled",t.Dn7(2,3,"disableGridForReqApproval",l,u._trnMainService.callPipe))}}function Xe(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",122)(1,"input",140),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ADJUSTBC=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.AdjustBatchEnter(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustbc",l,""),t.Q6J("ngModel",c.ADJUSTBC)("disabled",0==c.HASVARIANT)}}function _e(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",141)(1,"input",140),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ADJUSTBATCH=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.AdjustBatchEnter(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustbatch",l,""),t.Q6J("ngModel",c.ADJUSTBATCH)("disabled",c.isDisabled)}}function ot(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",120)(1,"input",142),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.INVRATE=c)}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","sourceRate",l,""),t.Q6J("ngModel",u.applyPipeInRate?t.lcZ(2,3,c.INVRATE):c.INVRATE)("readonly",!0)}}function st(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",120)(1,"input",128),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.MANUFACTURER=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustBatchId",l,""),t.Q6J("ngModel",c.MANUFACTURER)("readonly",!0)}}function Te(m,D){if(1&m&&(t.TgZ(0,"td",143),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","varianceAmount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function at(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",145),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.INVRATE=c)})("change",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.FCRATEChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.fcrateEnterEvent(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.fcrateEnterEvent(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","fcrate",l,""),t.Q6J("ngModel",c.INVRATE)("disabled",u._trnMainService.disableRateOnPOselect)}}const Ue=function(m){return{"tooltipChild disabled-rate":m}};function et(m,D){if(1&m&&(t.ynx(0),t._UZ(1,"span",115),t.BQk()),2&m){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Ue,l.rateId===r))("innerHTML",l.rateInnerHTML,t.oJD)}}function Li(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",146)(1,"input",147),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ALTRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.MRPChangeEvent(u,y))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.mrpEnterEvent(u,y))})("keydown.enter",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.mrpEnterEvent(u,y))})("keyup",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.rateChange(c))})("focusout",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.rateFocusOut(c))})("mouseover",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverRate(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverLeaveRate(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.ALo(4,"checkBatchMode"),t.qZA(),t.YNc(5,et,2,4,"ng-container",5),t.qZA()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.Q6J("hidden",89==u._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.MGl("id","rate",l,""),t.Q6J("ngModel",u.applyPipeInRate?t.lcZ(2,6,c.ALTRATE):c.ALTRATE)("disabled",t.Dn7(3,8,"disableRateandDiscount",l,u._trnMainService.callPipe))("readonly",t.lcZ(4,12,u.disableRate())),t.xp6(4),t.Q6J("ngIf",u.showtooltip)}}function wi(m,D){if(1&m&&(t.TgZ(0,"td",148),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","grossamnt",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.GROSSAMNT))," ")}}function Di(m,D){if(1&m&&(t.TgZ(0,"td",143),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","amount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function tt(m,D){if(1&m&&(t.TgZ(0,"td",143),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","confactor",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.ALTCONFACTOR))," ")}}function $i(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",149),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.MRPChangeEvent(c))}),t.TgZ(1,"input",150),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ECSAMOUNT=c)})("focusout",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSFocusOut())})("focusin",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSFocusIn())})("keyup",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSValueChange())})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ECSEnterClicked(u,c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.ECSEnterClicked(u,c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","ECSAmount",l,""),t.Q6J("ngModel",u.applyPipeInECS?t.lcZ(2,3,c.ECSAMOUNT):c.ECSAMOUNT)("disabled",u.disableECS(c))}}function zi(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",151),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.MRPChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.mrpEnterEvent(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.mrpEnterEvent(c))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()}if(2&m){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function Xi(m,D){if(1&m&&(t.ynx(0),t._UZ(1,"span",115),t.BQk()),2&m){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Fe,l.hoverIndId==r))("innerHTML",l.rateValue,t.oJD)}}function en(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",152)(1,"input",153),t.NdJ("keydown",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.indDiscEnterClicked(u,c))})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.INDDISCOUNT=c)})("focusout",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.rateFocusOut(c))})("mouseover",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverIndDiscount(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverLeaveIndDiscount(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.qZA(),t.YNc(4,Xi,2,4,"ng-container",5),t.qZA()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","discountAmt",l,""),t.Q6J("ngModel",u.applyPipeInRate?t.lcZ(2,4,c.INDDISCOUNT):c.INDDISCOUNT)("disabled",t.Dn7(3,6,"disableDiscountAmount",l,u._trnMainService.callPipe)),t.xp6(3),t.Q6J("ngIf",c.INDDISCOUNTRATE>0&&1==u.showHoverInd)}}function tn(m,D){if(1&m&&(t.ynx(0),t._UZ(1,"span",115),t.BQk()),2&m){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Fe,l.hoverId==r))("innerHTML",l.stringValue,t.oJD)}}function nn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",154),t.NdJ("mouseover",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverDiscountt(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.hoverLeaveDiscountt(c))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.YNc(3,tn,2,4,"ng-container",5),t.qZA()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","totalDisc",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,3,u._trnMainService.nullToZeroConverter(c.DISCOUNT))," "),t.xp6(2),t.Q6J("ngIf",c.DISCOUNT>0)}}function rn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",152)(1,"input",155),t.NdJ("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.IndDiscountAmountChangeOfRetailerVATINCEvent(u,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discEnterClicked(c))}),t.ALo(2,"number"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","discountAmtVATInclusiveForretailer",l,""),t.Q6J("ngModel",t.xi3(2,3,u._trnMainService.nullToZeroConverter(c.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem)}}function on(m,D){if(1&m&&(t.TgZ(0,"td",156),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function sn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",157)(1,"input",158),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.MRP=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateMRP())})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabMRP(c,u))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabMRP(c,u))})("keyup",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.rateChange(c))})("focusout",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.rateFocusOut(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","MRP",l,""),t.Q6J("ngModel",u.applyPipeInRate?t.lcZ(2,3,c.MRP):c.MRP)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode||u.disableSalesPriceWOVAT(l))}}function an(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",157)(1,"input",159),t.NdJ("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateSPRICE())})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.SPRICE=c)})("keydown.tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabSPRICE(c,u))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabSPRICE(c,u))})("keyup",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.spriceChange(c))})("focusout",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.spriceFocusOut(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","SPRICE",l,""),t.Q6J("ngModel",u.applyPipeInSprice?t.lcZ(2,3,c.SPRICE):c.SPRICE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWVAT(l))}}function cn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",157)(1,"input",160),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.VSRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateVSRATE())})("keydown.tab",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.onTabVSRATE(c))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw(2);return t.KtG(u.onTabVSRATE(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","VSRATE",l,""),t.Q6J("ngModel",c.VSRATE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWOVAT(l))}}function ln(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",157)(1,"input",160),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.VPRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateVPRATE())})("keydown.tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabVPRATE(c,u))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.onTabVPRATE(c,u))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","VPRATE",l,""),t.Q6J("ngModel",c.VPRATE)("disabled","VIEW"==c.rowMode||u.disableSalesPriceWVAT(l))}}function hn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",152)(1,"input",161,162),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.INDDISCOUNTRATE=c)})("change",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.IndDiscountRateChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discRateEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discRateEnterClicked(c))}),t.ALo(3,"disable"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","discountIP",l,""),t.Q6J("ngModel",c.INDDISCOUNTRATE)("readonly",u._trnMainService.disableProd||u.disableDiscount())("disabled",t.Dn7(3,4,"disableDiscountRateImpPurchase",l,u._trnMainService.callPipe))}}function dn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",152)(1,"input",163),t.NdJ("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.IndDiscountAmountChangeEvent(u,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.discEnterClicked(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","discountAmti",l,""),t.Q6J("readonly",u.disableDiscount())("ngModel",t.lcZ(2,4,u._trnMainService.nullToZeroConverter(c.INDDISCOUNT)))("disabled",t.Dn7(3,6,"disableDiscountAmountImpPurchase",l,u._trnMainService.callPipe))}}function un(m,D){if(1&m&&(t.TgZ(0,"td",164),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.SERVICETAX))," ")}}function pn(m,D){if(1&m&&(t.TgZ(0,"td",165),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.VAT))," ")}}function _n(m,D){if(1&m&&(t.TgZ(0,"td",148),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","netamount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.NETAMOUNT))," ")}}function Tn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",148)(1,"input",166),t.NdJ("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.changeONNetAmount(u,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.clickOnNetAmount(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.clickOnNetAmount(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","netamount",l,""),t.xp6(1),t.MGl("id","netamounteditable",l,""),t.Q6J("ngModel",t.lcZ(2,4,u._trnMainService.nullToZeroConverter(c.NETAMOUNT)))("disabled","VIEW"==c.rowMode)}}function Mn(m,D){if(1&m&&(t.TgZ(0,"td",167),t._UZ(1,"input",168),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","mrp",l,""),t.xp6(1),t.Q6J("ngModel",c.CRATE)("disabled",1==u._trnMainService.disableAllFieldinPurchase||u._trnMainService.disableOnGRNload)("readonly",!0)}}function mn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",169)(1,"select",170),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.IsApproveStockSettlement=c)}),t.TgZ(2,"option",119),t._uU(3,"Approved"),t.qZA(),t.TgZ(4,"option",119),t._uU(5,"Not Approved"),t.qZA()()()}if(2&m){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.IsApproveStockSettlement),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function Sn(m,D){if(1&m&&(t.TgZ(0,"td",143),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.MGl("id","amount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,u._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function vn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",169)(1,"select",170),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.isApproved=c)}),t.TgZ(2,"option",119),t._uU(3,"Approved"),t.qZA(),t.TgZ(4,"option",119),t._uU(5,"Not Approved"),t.qZA()()()}if(2&m){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.isApproved),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function gn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",171)(1,"input",172),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.PDESCA=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","masteritem",l,""),t.Q6J("ngModel",c.PDESCA)("disabled","VIEW"==u._trnMainService.TrnMainObj.Mode)}}function fn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",133)(1,"input",173),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.ROUTQTY=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","outqty",l,""),t.Q6J("ngModel",c.ROUTQTY)}}function On(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",116)(1,"input",129),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.PUNIT=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","punit",l,""),t.Q6J("ngModel",c.PUNIT)}}function bn(m,D){if(1&m&&(t.TgZ(0,"td",174),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.MRP))," ")}}function Cn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",175)(1,"input",176),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.MFGDATE=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.productHelperService.CalculateExpiryDate(u.MFGDATE,y,u))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.MFGDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.MFGDateEnterEvent(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","mfgdate",l,""),t.s9C("type",u.mfgExpDateType),t.Q6J("ngModel",c.MFGDATE)("max",u.maxDate)("disabled","VIEW"==c.rowMode||2==u.userSetting.EnableBatch&&88==!u._trnMainService.TrnMainObj.VoucherType||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==u.activeurlpath||u._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==u._trnMainService.TrnMainObj.VoucherType||7==u._trnMainService.TrnMainObj.VoucherType||1==u.masterService.disableQtyInStockIssueReturn||0==c.REQEXPDATE&&24==u._trnMainService.TrnMainObj.VoucherType||(0==c.REQEXPDATE||1==u.userSetting.EnableManualBatchinproduction)&&88==u._trnMainService.TrnMainObj.VoucherType)}}function An(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",175)(1,"input",177),t.NdJ("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.onChangeExpDate())})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.EXPDATE=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.expDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.expDateEnterEvent(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","expdate",l,""),t.s9C("type",u.mfgExpDateType),t.Q6J("ngModel",c.EXPDATE)("max",u.maxDate)("min",u.currDate)("disabled","VIEW"==c.rowMode||2==u.userSetting.EnableBatch&&88==!u._trnMainService.TrnMainObj.VoucherType||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==u.activeurlpath||u._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==u._trnMainService.TrnMainObj.VoucherType||7==u._trnMainService.TrnMainObj.VoucherType||1==u.masterService.disableQtyInStockIssueReturn||0==c.REQEXPDATE&&24==u._trnMainService.TrnMainObj.VoucherType||(0==c.REQEXPDATE||1==u.userSetting.EnableManualBatchinproduction)&&88==u._trnMainService.TrnMainObj.VoucherType)}}function En(m,D){if(1&m&&(t.TgZ(0,"td",178),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&m){const r=t.oxw(),c=r.$implicit;t.MGl("id","oldexpiry",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.EXPDATE)," ")}}function In(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",179)(1,"input",176),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.TransferMfgDate=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.productHelperService.CalculateExpiryDate(u.TransferMfgDate,y,u))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.newMFGDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.newMFGDateEnterEvent(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","newmanufacture",l,""),t.s9C("type",u.mfgExpDateType),t.Q6J("ngModel",c.TransferMfgDate)("max",u.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function Pn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",179)(1,"input",180),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.TransferExpiryDate=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),u=c.$implicit,y=c.index,K=t.oxw();return t.KtG(K.productHelperService.CalculateExpiryDate(u.TransferExpiryDate,y,u))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.newExpDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.newExpDateEnterEvent(c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw();t.xp6(1),t.MGl("id","newexpiry",l,""),t.s9C("type",u.mfgExpDateType),t.Q6J("ngModel",c.TransferExpiryDate)("max",u.maxDate)("min",u.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function yn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",181)(1,"select",182),t.NdJ("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.OrderComment(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.OrderComment(c))})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.COMMENTS=c)}),t.TgZ(2,"option",183),t._uU(3,"Urgent"),t.qZA(),t.TgZ(4,"option"),t._uU(5,"Needed"),t.qZA(),t.TgZ(6,"option"),t._uU(7,"Nil"),t.qZA()()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","OrderComment",l,""),t.Q6J("ngModel",c.COMMENTS)}}function xn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",181)(1,"input",184),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.COMMENTS=c)}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","Comment",l,""),t.Q6J("ngModel",c.COMMENTS)}}function Rn(m,D){if(1&m&&(t.TgZ(0,"td",185),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&m){const r=t.oxw(),c=r.$implicit;t.MGl("id","mfgdateNonedit",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.MFGDATE)," ")}}function Nn(m,D){if(1&m&&(t.TgZ(0,"td",185),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&m){const r=t.oxw(),c=r.$implicit;t.MGl("id","expdateNonedit",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.EXPDATE)," ")}}function Ln(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",152)(1,"input",186),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.REMARKS=c)})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.RemarksEnterCommand(c,u))})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw();return t.KtG(y.RemarksEnterCommand(c,u))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","remarks",l,""),t.Q6J("ngModel",c.REMARKS)("disabled","VIEW"==c.rowMode)}}function wn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",187)(1,"div",108)(2,"button",109),t.NdJ("click",function(){t.CHM(r);const c=t.oxw().index,u=t.oxw();return t.KtG(u.editRow(c))}),t.TgZ(3,"span"),t._uU(4,"Edit"),t.qZA()()()()}if(2&m){const r=t.oxw().$implicit;t.xp6(2),t.Q6J("disabled","VIEW"==r.rowMode)}}const Dn=function(){return{width:"22%"}},jn=function(){return[14,16,57,64,73]},Qi=function(){return[3,14,16,57,64,73,64,74,89]},kn=function(){return[5,81]};function Vn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"tbody",67)(1,"tr",68),t.NdJ("click",function(){const u=t.CHM(r).index,y=t.oxw();return t.KtG(y.RowClick(u))})("keydown.Shift.delete",function(){const u=t.CHM(r).index,y=t.oxw();return t.KtG(y.deleteRow(u))}),t.TgZ(2,"td",69),t._uU(3),t.qZA(),t.YNc(4,Ii,2,1,"td",70),t.ALo(5,"activeColumn"),t.YNc(6,Pi,3,9,"td",71),t.ALo(7,"activeColumn"),t.YNc(8,yi,2,3,"td",71),t.ALo(9,"activeColumn"),t.TgZ(10,"td",72),t.NdJ("mouseover",function(){const u=t.CHM(r).index,y=t.oxw();return t.KtG(y.hoverItemDesc(u))})("mouseleave",function(){const u=t.CHM(r).index,y=t.oxw();return t.KtG(y.hoverLeaveItemDesc(u))}),t.TgZ(11,"input",73),t.NdJ("ngModelChange",function(c){const y=t.CHM(r).$implicit;return t.KtG(y.ITEMDESC=c)})("keydown.enter",function(c){const y=t.CHM(r).index,K=t.oxw();return K.ItemkeyEvent(y,c),t.KtG(K.displayProductDetailInViewMode(K.event))})("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onClicked())}),t.ALo(12,"disable"),t.qZA(),t.TgZ(13,"span",74),t._uU(14,"Press ENTER to Select Item"),t.qZA(),t.ynx(15),t._UZ(16,"br")(17,"span",75),t.BQk(),t.YNc(18,xi,2,4,"ng-container",5),t.qZA(),t.YNc(19,Ni,3,2,"td",76),t.YNc(20,R,2,1,"td",77),t.YNc(21,J,6,8,"td",78),t.ALo(22,"activeColumn"),t.YNc(23,d,4,8,"td",76),t.ALo(24,"activeColumn"),t.YNc(25,h,2,3,"td",79),t.YNc(26,M,2,3,"td",77),t.YNc(27,x,2,2,"td",76),t.YNc(28,X,3,5,"td",80),t.YNc(29,re,2,3,"td",78),t.YNc(30,me,2,3,"td",81),t.YNc(31,Ie,2,3,"td",81),t.YNc(32,ge,4,10,"td",81),t.ALo(33,"activeColumn"),t.YNc(34,Ve,2,6,"input",82),t.YNc(35,He,3,7,"td",81),t.YNc(36,ze,3,7,"td",81),t.YNc(37,Xe,2,3,"td",78),t.YNc(38,_e,2,3,"td",83),t.YNc(39,ot,3,5,"td",77),t.YNc(40,st,2,3,"td",77),t.YNc(41,Te,3,4,"td",84),t.YNc(42,at,2,3,"td",85),t.ALo(43,"activeColumn"),t.YNc(44,Li,6,14,"td",86),t.YNc(45,wi,3,4,"td",87),t.YNc(46,Di,3,4,"td",84),t.YNc(47,tt,3,4,"td",84),t.ALo(48,"activeColumn"),t.YNc(49,$i,3,5,"td",88),t.ALo(50,"activeColumn"),t.YNc(51,zi,3,3,"td",89),t.YNc(52,en,5,10,"td",90),t.YNc(53,nn,4,5,"td",91),t.YNc(54,rn,3,6,"td",90),t.ALo(55,"activeColumn"),t.YNc(56,on,3,3,"td",92),t.YNc(57,sn,3,5,"td",93),t.YNc(58,an,3,5,"td",93),t.YNc(59,cn,2,3,"td",93),t.YNc(60,ln,2,3,"td",93),t.YNc(61,hn,4,8,"td",90),t.ALo(62,"activeColumn"),t.YNc(63,dn,4,10,"td",90),t.ALo(64,"activeColumn"),t.YNc(65,un,3,3,"td",94),t.YNc(66,pn,3,3,"td",95),t.ALo(67,"activeColumn"),t.YNc(68,_n,3,4,"td",96),t.ALo(69,"showColumn"),t.YNc(70,Tn,3,6,"td",96),t.ALo(71,"showColumn"),t.YNc(72,Mn,2,4,"td",97),t.YNc(73,mn,6,3,"td",98),t.YNc(74,Sn,3,4,"td",84),t.YNc(75,vn,6,3,"td",98),t.YNc(76,gn,2,3,"td",99),t.YNc(77,fn,2,2,"td",81),t.YNc(78,On,2,2,"td",76),t.YNc(79,bn,3,3,"td",100),t.YNc(80,Cn,2,5,"td",101),t.ALo(81,"activeColumn"),t.YNc(82,An,2,6,"td",101),t.ALo(83,"activeColumn"),t.YNc(84,En,3,4,"td",102),t.YNc(85,In,2,5,"td",103),t.YNc(86,Pn,2,6,"td",103),t.YNc(87,yn,8,2,"td",104),t.YNc(88,xn,2,2,"td",104),t.YNc(89,Rn,3,4,"td",105),t.ALo(90,"activeColumn"),t.YNc(91,Nn,3,4,"td",105),t.ALo(92,"activeColumn"),t.YNc(93,Ln,2,3,"td",90),t.YNc(94,wn,5,1,"td",106),t.TgZ(95,"td",107)(96,"div",108)(97,"button",109),t.NdJ("click",function(){const u=t.CHM(r).index,y=t.oxw();return t.KtG(y.deleteRow(u))}),t.ALo(98,"disable"),t._UZ(99,"img",110),t.qZA()()()()()}if(2&m){const r=D.$implicit,l=D.index,c=t.oxw();t.xp6(1),t.ekj("selected",c.isTableRowSelected(l))("highlighted",l+1==c.highlightBarCodeWiseRow())("bgforlessstockitem",c.highlightLessStockItem(l)),t.xp6(1),t.MGl("id","sno",l,""),t.xp6(1),t.hij(" ",l+1," "),t.xp6(1),t.Q6J("ngIf",t.lcZ(5,79,"MENUCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,81,"BARCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(9,83,"HS_CODE")),t.xp6(2),t.Q6J("ngStyle",3==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||74==c._trnMainService.TrnMainObj.VoucherType||31==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType?t.DdM(136,Dn):null),t.xp6(1),t.MGl("id","itemDesc",l,""),t.Q6J("readonly",c.ReadOnlyForDescription(l))("ngModel",r.ITEMDESC)("disabled",t.Dn7(12,85,"disableItemDesc",l,c._trnMainService.callPipe)),t.xp6(6),t.Q6J("innerHtml",r.VARIANTDESCA,t.oJD),t.xp6(1),t.Q6J("ngIf","export-sales-invoice"===c.activeurlpath&&r.REMARKS),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",t.lcZ(22,89,"BATCH_EDITABLE")),t.xp6(2),t.Q6J("ngIf",t.xi3(24,91,"UNIT_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(33,94,"QUANTITY_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableOtherUnitQtyInTI),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType&&0==c.userSetting.LogBasedRequisitionApproval),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",t.xi3(43,97,"FCRATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",c.showRateField()&&c._trnMainService.showFieldFromRight("Rate")),t.xp6(1),t.Q6J("ngIf",3==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.DdM(137,jn).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1||"add-purchase-order"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.lcZ(48,100,"CONFACTOR")),t.xp6(2),t.Q6J("ngIf",t.lcZ(50,102,"ECSAmount")),t.xp6(2),t.Q6J("ngIf",(-1==t.DdM(138,Qi).indexOf(c._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=c.activeurlpath&&!c.userSetting.IsBBSM||90==c._trnMainService.TrnMainObj.VoucherType&&0===c.userSetting.LogBasedRequisitionApproval&&c.userSetting.IsBBSM)&&c._trnMainService.showFieldFromRight("Amt")),t.xp6(1),t.Q6J("ngIf",(14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||3==c._trnMainService.TrnMainObj.VoucherType||64==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||16==c._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=c.activeurlpath),t.xp6(1),t.Q6J("ngIf",(14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||3==c._trnMainService.TrnMainObj.VoucherType||64==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||16==c._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=c.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.xi3(55,104,"DISCOUNT_AMT_EDITABLE_VATINCLU",l)),t.xp6(2),t.Q6J("ngIf",6===c.pType),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE||74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",t.xi3(62,107,"DISCOUNT_IMPORTPURCHASE",l)),t.xp6(2),t.Q6J("ngIf",t.xi3(64,110,"DISCOUNT_IMPORTPURCHASE",l)),t.xp6(2),t.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",t.xi3(67,113,"GST_AMT_NONEDITABLE",l)),t.xp6(2),t.Q6J("ngIf",t.lcZ(69,116,"showNetAmtNonEditable")),t.xp6(2),t.Q6J("ngIf",t.lcZ(71,118,"showNetAmtEditable")),t.xp6(2),t.Q6J("ngIf",(3==c._trnMainService.TrnMainObj.VoucherType||37==c._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||31==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",c.approvalFlag),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf","add-creditnote-itembase-approval"==c.activeurlpath||"add-stock-issue-approval"==c.activeurlpath||"transfer-out-approval"==c.activeurlpath||"stock-issue-approval"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",(19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||t.DdM(139,kn).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1&&1==c.userSetting.BATCHWISEPRICE||8==c._trnMainService.TrnMainObj.VoucherType)&&c._trnMainService.showFieldFromRight("MRP")),t.xp6(1),t.Q6J("ngIf",t.xi3(81,120,"MFGDATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(83,123,"EXPDATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY&&1==c.userSetting.enableDayWiseMfgEXPDate),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",80==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(90,126,"MFGDATE_NONEDITABLE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(92,129,"EXPDATE_NONEDITABLE",0)),t.xp6(2),t.Q6J("ngIf",64==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||90==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||80==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",88==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.LinkProductionwithconsumption),t.xp6(3),t.Q6J("disabled",t.Dn7(98,132,"disableRowDelete",l,c._trnMainService.callPipe))}}function Un(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"span",188),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.addRowInsert())}),t.TgZ(1,"p"),t._uU(2,"+"),t.qZA()()}if(2&m){const r=t.oxw();t.ekj("disabled",r.disableAddRow())}}function Bn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"tr",197),t.NdJ("click",function(){const u=t.CHM(r).$implicit,y=t.oxw(2);return t.KtG(y.selectProductDetails(u))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&m){const r=D.$implicit;t.xp6(2),t.Oqu(r.color),t.xp6(2),t.Oqu(r.size),t.xp6(2),t.Oqu(r.imeI1),t.xp6(2),t.Oqu(r.imeI2)}}function Kn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div")(1,"div",189)(2,"div",190)(3,"div")(4,"div")(5,"div",191)(6,"h4",192),t._uU(7," Product Details "),t.qZA(),t.TgZ(8,"button",47),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeProductDetails())}),t.TgZ(9,"span",48),t._uU(10,"\xd7"),t.qZA()()(),t.TgZ(11,"div",193)(12,"table",194)(13,"thead")(14,"tr",195)(15,"th"),t._uU(16,"Color Group"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Size Group"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"IMEI 1"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"IMEI 2"),t.qZA()()(),t.TgZ(23,"tbody"),t.YNc(24,Bn,9,4,"tr",196),t.qZA()()()()()()()()}if(2&m){const r=t.oxw();t.xp6(24),t.Q6J("ngForOf",r.selectedProductDetails)}}function Zn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",198)(1,"PItemList",199),t.NdJ("dbClickEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.dblClickPopupItem(c))})("itemCloseClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.model1Closed())}),t.qZA()()}if(2&m){const r=t.oxw();t.xp6(1),t.Q6J("title",r.masterService.PlistTitle)}}function Fn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"create-manual-batch-popup",200),t.NdJ("closeBatchPopupEvent",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.toggleCreateBatch())})("emitCreatedBatchEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.emittedBatch(c))}),t.qZA()}if(2&m){const r=t.oxw();t.Q6J("activeIndex",r.activerowIndex)}}function Hn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",201)(1,"PBatchList",202),t.NdJ("dbClickEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.dblClickPopupBatch(c))})("BatchClosedClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.model1Closed())})("returnBatchValue",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.returnBatch(c))})("showCreateBatchEvent",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.showCreateBatchFromPopup())}),t.qZA()()}if(2&m){const r=t.oxw();t.xp6(1),t.Q6J("AlternateUnits",r.AlternateUnits)("activerowIndex",r.activerowIndex)("title",r.masterService.PlistTitle)("BList",r.batchlist)("voucherType",r._trnMainService.TrnMainObj.VoucherType)("activeurlpath",r.activeurlpath)}}function Qn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",201)(1,"popPartyChoose",203),t.NdJ("dbClickEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.dblClickPopupParty(c))})("partyCloseClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.partypopupClosed())}),t.qZA()()}if(2&m){const r=t.oxw();t.xp6(1),t.Q6J("partyList",r._trnMainService.partyList)}}function Gn(m,D){1&m&&(t.TgZ(0,"th",223),t._uU(1," CURRENT WS-PRICE "),t.qZA())}function Yn(m,D){1&m&&(t.TgZ(0,"th",224),t._uU(1," NEW WS-PRICE "),t.qZA())}function Jn(m,D){if(1&m&&(t.TgZ(0,"td",226),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&m){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,r.WSRATE_A)," ")}}function qn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"td",226)(1,"input",228),t.NdJ("change",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw(2);return t.KtG(y.onChangePurchasePrice(u,c))})("ngModelChange",function(c){t.CHM(r);const u=t.oxw().$implicit;return t.KtG(u.WNRATE_A=c)})("keydown.enter",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw(2);return t.KtG(y.onChangePurchasePrice(u,c))})("keydown.Tab",function(c){t.CHM(r);const u=t.oxw().index,y=t.oxw(2);return t.KtG(y.onChangePurchasePrice(u,c))}),t.qZA()()}if(2&m){const r=t.oxw(),l=r.index,c=r.$implicit,u=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",l,""),t.Q6J("ngModel",c.WNRATE_A)("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem||u._trnMainService.TrnMainObj.ProdList[u.activerowIndex].BASEUNIT!=c.UNIT)}}function Wn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"tbody")(1,"tr",225)(2,"td",226),t._uU(3),t.qZA(),t.TgZ(4,"td",226),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA(),t.YNc(7,Jn,3,3,"td",227),t.TgZ(8,"td",226)(9,"input",228),t.NdJ("change",function(c){const y=t.CHM(r).index,K=t.oxw(2);return t.KtG(K.onChangePurchasePrice(y,c))})("ngModelChange",function(c){const y=t.CHM(r).$implicit;return t.KtG(y.NRATE_A=c)})("keydown.enter",function(c){const y=t.CHM(r).index,K=t.oxw(2);return t.KtG(K.onChangePurchasePrice(y,c))})("keydown.Tab",function(c){const y=t.CHM(r).index,K=t.oxw(2);return t.KtG(K.onChangePurchasePrice(y,c))}),t.qZA()(),t.YNc(10,qn,2,3,"td",227),t.qZA()()}if(2&m){const r=D.$implicit,l=D.index,c=t.oxw(2);t.xp6(3),t.Oqu(r.UNIT),t.xp6(2),t.hij(" ",t.lcZ(6,7,r.CRATE_A)," "),t.xp6(2),t.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(2),t.MGl("id","newSellingPrice",l,""),t.Q6J("ngModel",r.NRATE_A)("disabled","VIEW"==r.rowMode||r.isPurchaseOrderItem||c._trnMainService.TrnMainObj.ProdList[c.activerowIndex].BASEUNIT!=r.UNIT),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING)}}function $n(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",204)(1,"div",205)(2,"div",206)(3,"h4",207),t._uU(4," Selling Price Setting "),t.qZA()(),t.TgZ(5,"div",208)(6,"div")(7,"h5",207),t._uU(8," Cost Price has been changed.Please reset your new Selling Price "),t.qZA(),t._UZ(9,"hr",209),t.qZA(),t.TgZ(10,"div",50)(11,"label"),t._uU(12,"Label MRP:"),t.qZA(),t.TgZ(13,"input",210),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.TrnMainObj.ProdList[u.activerowIndex].LABELMRP=c)}),t.qZA()(),t.TgZ(14,"fieldset")(15,"legend",211),t._uU(16," New Selling Price Setting "),t.qZA(),t.TgZ(17,"table",194)(18,"thead")(19,"tr",212)(20,"th",213),t._uU(21,"UOM"),t.qZA(),t.TgZ(22,"th",214),t._uU(23,"CURRENT S-PRICE"),t.qZA(),t.YNc(24,Gn,2,0,"th",215),t.TgZ(25,"th",216),t._uU(26,"NEW S-PRICE"),t.qZA(),t.YNc(27,Yn,2,0,"th",217),t.qZA()(),t.YNc(28,Wn,11,9,"tbody",118),t.qZA(),t.TgZ(29,"div",50)(30,"div",218)(31,"h6"),t._uU(32),t.qZA()(),t.TgZ(33,"div",219),t._UZ(34,"div",220),t.qZA()()(),t.TgZ(35,"button",221),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyClickNewPrice())})("keydown.enter",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyClickNewPrice())}),t._uU(36," APPLY "),t.qZA(),t.TgZ(37,"button",222),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyOldPriceClick())})("keydown.enter",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyOldPriceClick())}),t._uU(38," APPLY OLD S-PRICE "),t.qZA()()()()}if(2&m){const r=t.oxw();t.xp6(13),t.Q6J("ngModel",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].LABELMRP),t.xp6(11),t.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),t.xp6(3),t.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngForOf",r._trnMainService.priceChangeList),t.xp6(4),t.hij(" Recommended Margin: ",r._trnMainService.selectedProdcutRecMargin,"% ")}}function zn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div")(1,"div",229)(2,"div",230)(3,"div",191)(4,"h5",192),t._uU(5," Discount authorization "),t.qZA(),t.TgZ(6,"button",47),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t.TgZ(7,"span",48),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",49)(10,"div",231)(11,"label",232),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",233)(14,"input",234),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.disAuthObj.username=c)}),t.qZA()()(),t.TgZ(15,"div",231)(16,"label",232),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",233)(19,"input",235),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.disAuthObj.password=c)}),t.qZA()()(),t.TgZ(20,"div",231)(21,"label",232),t._uU(22,"Discount:"),t.qZA(),t.TgZ(23,"div",236)(24,"input",237),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.disAuthObj.discount=c)}),t.qZA()(),t.TgZ(25,"div",238)(26,"a"),t._uU(27,"% \xa0"),t.qZA()()(),t.TgZ(28,"div",239)(29,"fieldset",240)(30,"legend",241),t._uU(31," Discount authorization remarks: "),t.qZA(),t.TgZ(32,"textarea",242),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.disAuthObj.remarks=c)}),t.qZA()()()(),t.TgZ(33,"div",243)(34,"button",244),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.discountAuthConfirm())}),t._uU(35," Confirm "),t.qZA()()()()()}if(2&m){const r=t.oxw();t.xp6(14),t.Q6J("ngModel",r.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",r.disAuthObj.password),t.xp6(5),t.Q6J("ngModel",r.disAuthObj.discount),t.xp6(8),t.Q6J("ngModel",r.disAuthObj.remarks)}}function Xn(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",245),t.NdJ("BatchClosedEmit",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.BatchPopupClosed())})("dbClickEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.dblClickPopupBatchs(c))}),t.qZA()()}if(2&m){const r=t.oxw();t.xp6(1),t.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function er(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",245),t.NdJ("BatchClosedEmit",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.AdjustPopupClosed())})("dbClickEvent",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u.DblClickPopupAdjust(c))}),t.qZA()()}if(2&m){const r=t.oxw();t.xp6(1),t.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function tr(m,D){1&m&&(t.TgZ(0,"h6",192),t._uU(1," Authorization for Negative Stock Entry "),t.qZA())}function ir(m,D){1&m&&(t.TgZ(0,"h6",192),t._uU(1," Credit Sales Authorization "),t.qZA())}function nr(m,D){if(1&m){const r=t.EpF();t.TgZ(0,"div",246)(1,"div",247)(2,"div",230)(3,"div",191),t.YNc(4,tr,2,0,"h6",248),t.YNc(5,ir,2,0,"h6",248),t.TgZ(6,"button",47),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t.TgZ(7,"span",48),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",49)(10,"div",231)(11,"label",232),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",233)(14,"input",249),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disAuthObj.username=c)}),t.qZA()()(),t.TgZ(15,"div",231)(16,"label",232),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",233)(19,"input",235),t.NdJ("ngModelChange",function(c){t.CHM(r);const u=t.oxw();return t.KtG(u._trnMainService.disAuthObj.password=c)}),t.qZA()()()(),t.TgZ(20,"div",243)(21,"button",244),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.confirmAuthorization())}),t._uU(22," Confirm "),t.qZA(),t.TgZ(23,"button",250),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t._uU(24," Cancel "),t.qZA()()()()()}if(2&m){const r=t.oxw();t.xp6(4),t.Q6J("ngIf",1==r._trnMainService.showNegativeBilling||1==r.userRightAuthService.showAuthPopup),t.xp6(1),t.Q6J("ngIf",r._trnMainService.showCreditSalesAuth),t.xp6(9),t.Q6J("ngModel",r._trnMainService.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",r._trnMainService.disAuthObj.password)}}const rr=function(){return{width:"28%"}},or=function(){return{width:"25%"}},sr=function(){return{width:"24%"}},ar=function(){return{width:"40%"}},cr=function(){return{backdrop:"static"}};let lr=(()=>{class m{constructor(r,l,c,u,y,K,ie,Me,De,Ae,Ce,hr,dr,ur,pr,_r){this.masterService=r,this._trnMainService=l,this.setting=c,this.dialog=u,this.fb=y,this.arouter=K,this.alertService=ie,this.authservice=Me,this.changeDetection=De,this.loader=Ae,this.validationService=Ce,this.responseMsgService=hr,this.userRightAuthService=dr,this.productHelperService=ur,this.focusService=pr,this.salesRateDisabled=_r,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.stringValue="",this.hoverId=null,this.hoverIndId=null,this.onHoverItemDesc=!1,this.itemDescHoverValue="",this.showCreateBatch=!1,this.TotalBill=new t.vpe,this.gridPopupSettingsForSupplier=new g.im,this.barcodeGridSettings=new g.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new t.vpe,this.onChangeProductionItem=new t.vpe,this.indexEmit=new t.vpe,this.activeRowEmit=new t.vpe,this.emitShowPopup=new t.vpe,this.activeRowEmitForEdit=new t.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.showtooltip=!1,this.qtyValue="",this.qtyId=null,this.rateValue="",this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new g.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showHoverInd=!1,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInSprice=!0,this.applyPipeInECS=!0,this.mfgExpDateType="month",this.currDate="",this.maxDate="",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=Gi=>{let Se=Object.assign({},this.trnProd),Yi=[],Ji=0;for(var fe of Gi)if(Se.VaraintDetailS=[],this.masterService.nullToZeroConverter(fe.QTY)>0){let ki="";Se.VARIANTDESCA="";var qi={};for(var Qe in fe)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Qe)&&(ki+=fe[Qe].VARIANTBARCODE,Se.VARIANTDESCA=Se.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Qe)}</b>:${fe[Qe].NAME} &nbsp;`,qi[fe[Qe].VARIANTNAME]=fe[Qe].NAME);Se.VaraintDetailS.push(qi),Se.VARIANTLIST=fe,Se.BC=fe.BARCODE?fe.BARCODE:Se.MCODE+ki,Se.Quantity=fe.QTY,Se.MRP=fe.MRP,Se.ALTMRP=fe.MRP,Se.REALQTY_IN=fe.QTY,Se.ALTERNATEQUANTIY=fe.QTY,Se.AltQty=fe.QTY,Se.PRATE=fe.PRATE,Se.RATE=fe.PRATE,Se.REALRATE=fe.PRATE,Se.ALTRATE=fe.PRATE,Se.SPRICE=fe.SRATE,Se.SellingPrice=fe.SRATE,Se.ALTRATE2=fe.SRATE,this.trnMain.VoucherType==e.Km.ProductionEntry&&(Se.SELLRATEBEFORETAX=fe.SRATE),Se.BATCH=`-${Ji}`,Yi.push(Object.assign({},Se)),Ji++}let ji=this.trnMain.ProdList.slice(0,this.activerowIndex),Mr=this.trnMain.ProdList.slice(this.activerowIndex+1);for(var mr of(this.trnMain.ProdList.splice(this.activerowIndex),Yi))ji.push(mr);for(var Sr of Mr)ji.push(Sr);this.trnMain.ProdList=ji,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)};const Tr=new Date;this.currDate=(0,C.p6)(Tr,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this.trnMain.VoucherType&&(this.AppSettings=c.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this.trnMain.VoucherType===e.Km.StockIssue&&(this.showDiscount=!1),r.ShowMore=!0}catch{}this.activeurlpath=K.snapshot.url[0].path,this.trnMain.CHALANNO="","export-sales-invoice"==this.activeurlpath?this.FCRATELABEL="FC E.Rate":(e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag)&&(this.FCRATELABEL="FC P.Rate")}ngAfterContentChecked(){this.changeDetection.detectChanges()}get trnMain(){return this._trnMainService.TrnMainObj}get trnProd(){return this.indexedProd(this.activerowIndex)}indexedProd(r){return this.trnMain.ProdList[r]}updown(r){"number"===r.target.type&&("-"===r.key||"Minus"===r.key)&&r.preventDefault(),"F2"===r.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F7"==r.code&&(r.preventDefault(),this.trnMain.VoucherType===e.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===r.code&&(r.preventDefault(),"VIEW"==this.trnMain.Mode.toUpperCase()&&this._trnMainService.inputCode&&this.trnProd.ProductDetails.length>0&&this.dialougeOpen()),"F11"==r.code&&r.ctrlKey&&(r.preventDefault(),this._trnMainService.barCodes.BC||null!=this.trnProd.MCODE&&this.checkBatchWiseRate()),"Escape"==r.code&&(r.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}model1Closed(){this.masterService.PlistTitle="",1==this.trnProd.REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{this.focusAltQty()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;const r=new Date;0==this.userSetting.EnablePreviousDateInExpiry&&(this.currDate=(0,C.p6)(r,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",0==this.userSetting.enableDayWiseMfgEXPDate&&(this.currDate=(0,C.p6)(r,"yyyy-MM","en-US"),this.maxDate="2999-12"))}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this.trnProd.MCODE).subscribe(r=>{this.colorLists=r&&r.result?r.result:[]})}RowClick(r){this.activerowIndex=this.rowIndex=r,this.masterService.ShowMore=!1,console.log("row click",this.trnProd.POSTOCK,this.trnProd.PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(r),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])}disableECS(r){return!!(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL.startsWith("SO")&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)||r.ECSRATE>0||0==r.HASECSCHARGE)}disableAddRow(){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.REFORDBILL)return!0}descriptionEditOnRowClick(r){this._trnMainService.allowDescriptionEdit=1==this.trnProd.ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let r=0;if(r=this.trnMain.ProdList.length-1,this.trnMain.ProdList&&null!=this.indexedProd(0).MENUCODE)return this.trnMain.ProdList.findIndex(c=>c.BC==this._trnMainService.barCodes.BC&&0==c.FulfillBatchQty)+1}highlightLessStockItem(r){return!!(this.trnMain.VoucherType===e.Km.RequisitionApproval&&null!=this.indexedProd(r).MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this.indexedProd(r).APPROVEDALTQTY||this.trnMain.VoucherType===e.Km.BranchTransferOut&&2==this.userSetting.EnablePIReferenceInTransferOut&&this._trnMainService.TrnMainObj.REFBILL&&"EDIT"!=this._trnMainService.TrnMainObj.ProdList[r].rowMode?.toUpperCase()&&this.indexedProd(r).PSTOCK>this.indexedProd(r).TOTALSTOCK)}showPOQtyRate(r){this.trnMain.REFORDBILL&&(this.trnMain.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===e.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||0!==this.userSetting.ENABLE_SOINTI&&(this.trnMain.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)||this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this.indexedProd(r).POSTOCK,this._trnMainService.purchaseOrderRate=this.indexedProd(r).ALTRATE,this._trnMainService.produstWiseOrderUnit=this.indexedProd(r).BASEUNIT)}openDialog(r){this.selectedIndex=r}ItemBarCodeClick(r,l){if(this.activerowIndex=r,this.trnMain.VoucherType!=e.Km.ProductionEntry||this.trnMain.BILLTO){if(!this.indexedProd(r).BC&&(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&"NEW"!==this.trnMain.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this.indexedProd(r).ProductDetails,this.indexedProd(r).visible=!0,this.getProductColorMcodeWise(),!1;if(this.trnMain.VoucherType===e.Km.DebitNote&&"PI"===this.trnMain.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this.indexedProd(r).ProductDetails,this.indexedProd(r).visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this.trnMain.Mode||"EDIT"===this.trnMain.Mode)&&6===this.indexedProd(r).Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this.indexedProd(r).BC||null==this.indexedProd(r).BC||""==this.indexedProd(r).BC)1==this.indexedProd(r).isBarcodeOfPtypeSix&&(this.indexedProd(r).isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this.trnMain.ProdList[r]={}},0)),null!=document.getElementById("itemDesc"+r)&&setTimeout(()=>{document.getElementById("itemDesc"+r).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this.trnMain.VoucherType!==e.Km.CreditNote&&this.trnMain.VoucherType!==e.Km.SalesReturn){let c=this.trnMain.ProdList.filter(y=>y.BC==this.indexedProd(r).BC);if(null!=c&&c?.length>1)return this.alertService.info(`Duplicate barcode:${this.indexedProd(r).BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)});this.trnMain.ProdList.filter(y=>6==y.PTYPE).forEach(y=>y.ProductDetails?.forEach(K=>{if(K.IEMI1==this.trnProd.BC)return this.alertService.info(`Duplicte IMEI1 :${K.IEMI1} is found on Bulk Entry Grid`),this.trnProd.BC=null,!1}))}this.indexedProd(r).BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this.indexedProd(r).BC,this.trnMain.REFBILL).subscribe(c=>{"ok"==c.status?(this._trnMainService.ReturnStockObj=c.result,this.loadBarcodeWiseProductList(c.result.TotalStock)):(this.alertService.info(c.result),this.alertService.emitShowHideSubject.subscribe(u=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)}))},c=>{this.alertService.info(c.result)}):this._trnMainService.checkBarcode(this.indexedProd(r).BC,this.trnMain.MWAREHOUSE).subscribe(c=>{"ok"==c.status?this.loadBarcodeWiseProductList():this.alertService.info(c.result)},c=>{this.alertService.info(c.result)}))}}else this.alertService.info("Please select Production warehouse")}ItemkeyEvent(r,l){if(this.trnMain.VoucherType===e.Km.TaxInvoice&&"export-sales-invoice"===this.activeurlpath){if(""===this.trnMain.FCurrency||null==this.trnMain.FCurrency)return this.masterService.ShowMore=!0,void this.alertService.info("Please specify currency value first");if(null==this.trnMain.EXRATE)return void this.alertService.info("EX Rate cannnot be null")}if(l.preventDefault(),this.activerowIndex=r,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this.trnMain.VoucherType===e.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this.trnMain.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this.trnMain.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this.trnMain.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this.trnMain.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this.trnMain.TRNACName||null==this.trnMain.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this.trnMain.TRNACName||null==this.trnMain.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this.trnMain.REMARKS||null==this.trnMain.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});this.showStockedQuantityOnly=0}else this.trnMain.VoucherType===e.Km.PerformaSalesInvoice||this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.Repack||this.trnMain.VoucherType===e.Km.Quotation?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this.trnProd.BARCODE??""):this.showStockedQuantityOnly=0;if("performa-invoice"==this.activeurlpath&&null==this.trnMain.BILLTO)return void this.alertService.info("Please select customer first");if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this.trnMain.VoucherType===e.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===e.Km.Purchase&&(0!==this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_GRN_IN_PI)&&"purchase-import"!==this.activeurlpath&&0==this.userSetting.DisablePOReferenceRequired||this.trnMain.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&0==this.userSetting.DisablePOReferenceRequired||this.trnMain.VoucherType===e.Km.SalesOrder&&this.trnMain.REFORDBILL&&0!==this.userSetting.ENABLE_QUOTATTION_INSO||this.trnMain.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this.trnMain.VoucherType===e.Km.BranchTransferOut&&1===this.trnMain.ISLOADFROMORDER||this.trnMain.VoucherType===e.Km.StockIssue&&1===this.trnMain.ISLOADFROMORDER){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0!=this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER){if(!this.trnMain.REFORDBILL){console.log("ETA ROKYO ?");let c=this.responseMsgService.getProperMessageForRefBill(this.trnMain);return this.alertService.info(c),!1}}else if(null==this.trnMain.REFBILL||""==this.trnMain.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this.trnMain.VoucherType===e.Km.StockIssueReturn){if(!this.trnMain.REFORDBILL)return this.alertService.info(this.responseMsgService.getProperMessageForRefBill(this.trnMain)),!1;this.gridPopupSettings.apiEndpoints=`/getMenuitemFromProdForIssueReturnPagedList/${this.trnMain.BILLTO}`}else if(this.trnMain.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this.trnMain.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this.trnMain.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath&&1==this.userSetting.DisablePOReferenceRequired&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&1==this.userSetting.DisablePOReferenceRequired&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&0==this.userSetting.SOREFERENCE_REQUIRED&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType==e.Km.Sales&&0!==this.userSetting.ENABLE_SOINTI&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===e.Km.PerformaSalesInvoice&&null!=this.trnMain.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this.trnMain.VoucherType===e.Km.BranchTransferOut&&0==this.trnMain.DOFULLRETURN)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else{let u,c="";"self-billing"===this.activeurlpath?c="SB":null!=this.trnMain.VoucherPrefix&&(c=this.trnMain.VoucherPrefix);let y="";if(y=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.trnMain.VoucherType===e.Km.StockIssue&&(y=this.trnMain.BILLTO,null==this.trnMain.BILLTO))return void this.alertService.info("Please select From Warehouse before selecting an item ");if(this.trnMain.VoucherType===e.Km.RequisitionEntry&&(null==this.trnMain.MWAREHOUSE||""==this.trnMain.MWAREHOUSE))return void this.alertService.info("Please select Warehouse before selecting item");if(u=this.trnProd.BC,(0==this.userSetting.GblBarcodeWiseBilling||null==u||void 0===u||""==u)&&(u="A"),this.productListInGenericPopup(r,u,c,y),this.trnMain.VoucherType==e.Km.ProductionEntry){if(!this.trnMain.BILLTO)return void this.alertService.info("Please select Production warehouse");y=this.trnMain.BILLTO}this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.INVOICETYPE&&"StockIssue"==this._trnMainService.TrnMainObj.INVOICETYPE&&(y=this._trnMainService.TrnMainObj.BILLTO),this.gridPopupSettings.apiEndpoints=this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder&&this.userSetting.EnableDeliveryWarehouseSelectionInSO&&this._trnMainService.deliveryWarehouse&&this._trnMainService.deliveryWarehouse!=y?`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${u}/all/${c}/${this._trnMainService.deliveryWarehouse}`:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${u}/all/${c}/${y}`}if(this.trnMain.VoucherType===e.Km.CreditNote&&"NewBill"===this.trnMain.AdditionalObj.INVOICETYPE){let c="";null!=this.trnMain.VoucherPrefix&&(c=this.trnMain.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}if("add-membership-sales-invoice"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getMenuItemListForMembershipSales"),this.trnMain.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.GoodsReceived&&"GOODS_RECEIVED_NOTE_IMPORT"==this._trnMainService.TrnMainObj.AdditionalObj.tag){if(null==this.trnMain.BILLTO||void 0===this.trnMain.BILLTO||""==this.trnMain.BILLTO)return void this.alertService.info("Please Choose Supplier to Proceed...");if(!this.trnMain.EXRATE)return void this.alertService.info("Please choose exchange rate to proceed or exchange rate cannot be zero...")}return this._trnMainService.itemselectevent=!0,this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType==e.Km.StockIssueReturn||this.trnMain.VoucherType==e.Km.BranchTransferOut||this.trnMain.VoucherType==e.Km.TaxInvoice||this.trnMain.VoucherType==e.Km.SalesOrder||this.trnMain.VoucherType==e.Km.StockIssue||"FROMPO"==this.trnMain.AdditionalObj.INVOICETYPE||"FROMSO"==this.trnMain.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this.trnMain.AdditionalObj.INVOICETYPE?this.trnMain.REFORDBILL:this.trnMain.REFBILL),!1}this.displayProductDetailInViewMode(l)}}productListInGenericPopup(r,l,c,u){if(1==this.indexedProd(r).ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let y=this.indexedProd(r).ITEMDESC;y&&""!=y?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+r).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${u}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${u}`}displayProductDetailInViewMode(r){console.log("eventlog",r),"VIEW"==this.trnMain.Mode.toUpperCase()&&"F9"==r.code&&this.dialougeOpen()}onChangeExpDate(){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.warning("Production item is not selected!!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.warning("Quantity is not selected!!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE)return void this.alertService.warning("Manufacture Date is not selected!!")}}loadBarcodeWiseProductList(r=0){this.loadFromBarcode=!1;let c=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this.trnMain.VoucherPrefix}&barcode=${this.trnProd.BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(y=>{if("ok"===y.status)if(c=y.result.data,0===c.length)this.alertService.info("Product is out of Stock ");else if(1===c.length){this.loadFromBarcode=!0;var K=c[0];if(this._trnMainService.CheckIfSalesReturn()){K.STOCK=r;var ie=0;for(let Ae of this.trnMain.ProdList)Ae.BC==this.trnProd.BC&&(ie+=Ae.ALTERNATEQUANTIY);if(K.STOCK<ie)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(K),this.loadFromBarcode=!1,this.trnProd.VARIANTDESCA="",K.barcodeDetails){var Me=JSON.parse(K.barcodeDetails);for(var De in console.log("varDetail",Me),Me)this.trnProd.VARIANTDESCA+=`<b>${De}</b>:${Me[De]} &nbsp;`}}else this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(y.result.error)})}checkDuplicatProductWithBarcode(){let r=[];return r=this.trnMain.ProdList.filter(l=>l.BARCODE===this.trnProd.BARCODE),r.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}batchFocusOut(r,l){l.target.value&&this.productHelperService.checkBatch(this._trnMainService.TrnMainObj.ProdList[r].MCODE,l.target.value).subscribe(y=>{},y=>{this._trnMainService.TrnMainObj.ProdList[r].BATCH=null})}checkBatchWiseRate(){this.batchlist=[];let r=this.trnMain.VoucherPrefix;"self-billing"===this.activeurlpath&&(r="SF");let l="";l=this.trnMain.VoucherType==e.Km.Repack?this.trnProd.PMCODE:this.trnProd.MCODE;let c="";c=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse;let u="";("add-sales-invoice-wholesale"===this.activeurlpath||this.trnMain.VoucherType==e.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate)&&(u="wholesale"),this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${l}&voucherPrefix=${r}&warehouse=${encodeURIComponent(c)}&barcode=&tag=${u}&CUSTID=${this.trnMain.PARAC}&PRICEMODE=${this.trnMain.PRICEMODE}&UNIT=${this.trnProd.UNIT}`).subscribe(y=>{if(console.log("resp1",y,y.message),"ok"===y.status)this.batchlist=y.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this.trnProd.REQEXPDATE&&!this.trnProd.BARCODE&&(this.masterService.PlistTitle="Batch Selection"),!y.message&&this.trnMain.VoucherType===e.Km.ProductionEntry&&this.userSetting.EnableManualBatchinproduction&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===y.message&&this.trnMain.VoucherType===e.Km.Repack&&(this.batchWiseStockTax(y.result),this.changeBatchWiseRate(y.result[0].RATE)),"replacerate"===y.message&&(this.changeBatchWiseRate(y.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(y.result),this.trnProd.PRATE=y.result[0].costprice),"SHOWPRICEPOPUP"===y.message&&(this.masterService.PlistTitle="Batch Price Selection",this.trnProd.HasMulitplePrice=1,this.trnMain.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(y.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this.trnMain.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!");else{if("error"===y.status&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.OpeningStockBalance)return void this.alertService.info(y.result);"error"==y.status&&this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&(this.masterService.PlistTitle="Batch Selection")}})}checkBatchWiseRateSettingZero(){this.batchlist=[];let l="",c="";l=this.trnMain.VoucherType==e.Km.Repack?this.trnProd.PMCODE:this.trnProd.MCODE,c=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${l}&voucherPrefix=${this.trnMain.VoucherPrefix}&warehouse=${c}&barcode=`).subscribe(u=>{"ok"===u.status&&(this.batchlist=u.result,"SHOWPRICEPOPUP"===u.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(r){(this.trnMain.VoucherType==e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.Repack||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice||"consumption"===this.trnMain.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(r)>0&&(this.trnProd.RATE=r,this.trnProd.REPACKRATE=r,this.trnProd.PRATE=r,this.trnProd.ALTRATE=this.trnMain.VoucherType==e.Km.Repack?this.trnProd.RATE*this._trnMainService.nullToZeroConverter(this.trnProd.CONFACTOR):r,console.log("ratealt",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,r),this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(r){null!=this.trnProd.Product.AlternateUnits.filter(c=>1==c.ISDEFAULTPUNIT)[0]&&(this.trnProd.ALTRATE=this.trnProd.RATE*this.trnProd.ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(r){1===this.trnProd.REQEXPDATE&&this.trnProd.BC&&(this.trnProd.MFGDATE=null==r[0].MFGDATE?"":r[0].MFGDATE.toString().substring(0,7),this.trnProd.EXPDATE=null==r[0].EXPDATE?"":r[0].EXPDATE.toString().substring(0,7),this.trnProd.BATCH=r[0].BATCH)}batchWiseSalesRateBeforeTax(r){this.trnMain.VoucherType===e.Km.Repack&&(this.trnProd.SELLRATEBEFORETAX=r)}batchWiseStockTax(r){this.trnMain.VoucherType===e.Km.Repack&&(this.trnProd.STOCK=r.map(l=>l.STOCK).reduce((l,c)=>l+c,0))}BatchEnter(r,l){this.activerowIndex=r,l.preventDefault();let c=this.trnMain.VoucherType;if(this.trnProd.VRATE=l.LANDINGCOST,this.activeRowEmit.emit(this.trnProd),1!=this.userSetting.EnableBatch||"SI"!=this.trnMain.VoucherPrefix&&"TI"!=this.trnMain.VoucherPrefix&&"CN"!=this.trnMain.VoucherPrefix&&"PP"!=this.trnMain.VoucherPrefix){if(2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this.trnProd.EnableAutoBatch)&&c in e.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),2==this.userSetting.EnableBatch&&this.trnMain.VoucherType==e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this.checkBatchWiseRate(),this.trnMain.VoucherType===e.Km.ProductionEntry)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC?(this.checkBatchWiseRate(),void setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20)):void this.alertService.info("Please Select Production Item!");if(null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this.trnMain.VoucherType==e.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){this.batchList=[];let u=this.indexedProd(r).MCODE,y=this._trnMainService.TrnMainObj.MWAREHOUSE;u&&this.masterService.getItemWiseBatch(u,y).subscribe(K=>{"ok"==K.status&&(this.batchList=K.result.filter(ie=>ie.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20)}PstockEnter(r,l){l.preventDefault(),this.trnMain.VoucherType==e.Km.Stockadjustment&&document.getElementById("computerStock"+r).focus()}CstockEnter(r,l){l.preventDefault(),this.trnMain.VoucherType==e.Km.Stockadjustment&&this.focusAltQty(r)}AdjustBatchEnter(r){if(this.trnMain.VoucherType=e.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let l=this.indexedProd(r).MCODE,c=this._trnMainService.TrnMainObj.MWAREHOUSE;l&&this.masterService.getAdjustingBatch(l,c).subscribe(u=>{console.log("get batch list",u),"ok"==u.status&&(this.batchList=u.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(r){this.trnMain.VoucherType==e.Km.BatchAdjustment&&(this.trnProd.VRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this.trnProd.BATCHID=r.BATCHID),1==this.trnMain.ADJUSTEXPIRY&&(this.trnProd.EXPDATE=r.EXPDATE,this.trnProd.SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this.trnProd.MRP=r.MRP,this.trnProd.RATE=r.COSTPRICE,this.trnProd.BASERATE=r.COSTPRICE,this.trnProd.ALTRATE=r.COSTPRICE,this.trnProd.CRATE=r.COSTPRICE,this.trnProd.PRATE=r.COSTPRICE)),this.checkDuplicateSourceBarcode(r.BATCHCODE,r.MCODE)&&(this.trnProd.BATCH=r.BATCHCODE,this.trnProd.STOCK=r.STOCK,1==this.trnProd.HASVARIANT&&(this.trnProd.BC=r.BC),this.showBatchPopup=!1,this.focusAltQty())}checkDuplicateSourceBarcode(r,l){return!r||!this.trnMain.ProdList.find(c=>c.BATCH==r&&c.MCODE==l)||(this.alertService.info(`Batch ${r} is already selected as a source barcode for the item.`),!1)}DblClickPopupAdjust(r){r.BATCHCODE!=this.trnProd.BATCH?(this.trnProd.ADJUSTBATCH=r.BATCHCODE,this.trnProd.INVRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this.trnProd.MANUFACTURER=r.BATCHID),1==this.trnProd.HASVARIANT&&(this.trnProd.ADJUSTBC=r.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}selectProductDetails(r){let l=[];l=r,this.trnProd.ProductDetails.push(l),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this.trnProd.MCODE,vchrno:this.trnMain.REFBILL}).subscribe(l=>{l&&"ok"===l.status?(this.isProductDetailView=!0,this.selectedProductDetails=l.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},l=>{this.selectedProductDetails=[]})}discEnterClicked(r,l){if(this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this.trnMain.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DOFULLRETURN)0==this._trnMainService.nullToZeroConverter(this.trnProd.REQEXPDATE)?(console.log("reach1"),this.checkValidation(r)):document.getElementById("mfgdate"+r).focus();else if(this.trnMain.VoucherType===e.Km.DebitNote)this.checkValidation(r);else if(this.trnMain.VoucherType===e.Km.TaxInvoice)1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(r);else if(this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice){let c={isFocusAchieved:!1};this.focusService.autoFocus(r,document.getElementById("discountAmt"+r),c,"productinserttable"),c.isFocusAchieved||this.checkValidation(r)}else this.trnMain.VoucherType===e.Km.Quotation||this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===e.Km.SalesOrder?document.getElementById("remarks"+r).focus():this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag?this.checkValidation(r):document.getElementById("mfgdate"+r).focus();return!1}ECSEnterClicked(r,l){l.preventDefault();let c={isFocusAchieved:!1};this.focusService.autoFocus(r,document.getElementById("ECSAmount"+r),c,"productinserttable"),c.isFocusAchieved||this.checkValidation(r),this._trnMainService.ReCalculateBillWithNormal()}approvedQtyEnter(r){let c=this.indexedProd(r);if(this.validationService.checkStockforApprovalQty(c)&&!c.isConfirmed&&0==this.userSetting.LogBasedRequisitionApproval){console.log("reach");let u=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(u,"ReqApproval")}c.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(c,r)&&setTimeout(()=>{null!=document.getElementById("remarks"+r)&&document.getElementById("remarks"+r).focus()},50),this.validationService.validateStockinReqApproval(c,r,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(r){if(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales){let l=this.masterService.userProfile.roleRights.find(c=>"DISLIMIT"==c.right);console.log("disLimt on discount rate",l),l&&this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit of :"+l.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if(this.trnMain.VoucherType===e.Km.SalesOrder){let l=this.masterService.userProfile.userRights.find(c=>"DISLIMIT"==c.right);l&&this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit for sales order ("+l.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)?document.getElementById("discountAmt"+r).focus():document.getElementById("remarks"+r).focus()},0)}))}(this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.Quotation||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType===e.Km.PurchaseOrder||this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)>0?this.trnMain.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this.trnMain.VoucherType==e.Km.SalesOrder?document.getElementById("discountAmt"+r).focus():this.checkValidation(r):0==this._trnMainService.nullToZeroConverter(this.trnProd.INDDISCOUNTRATE)?(this.trnMain.VoucherType==e.Km.Purchase&&"purchase-import"==this.activeurlpath||null!=document.getElementById("discountAmti"+r))&&document.getElementById("discountAmti"+r).focus():this.trnMain.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+r).focus():document.getElementById("mfgdate"+r).focus())}indDiscEnterClicked(r,l){l.preventDefault();var c=this._trnMainService.TrnMainObj.ProdList[r];if(null!=c){if(null==c.MCODE)return void this.alertService.warning("Please select a Product");if(!c.ALTERNATEQUANTIY)return void this.alertService.warning(`Qty Is Not Specified For The Item ${c.ITEMDESC} (${c.MENUCODE}) Please Check Your Entry.`)}if(l.altKey&&"Enter"===l.key||l.key>="0"&&l.key<="9")this.discountPopup.show();else{if("Enter"!==l.key&&"Tab"!==l.key)return"Backspace"==l.key?(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=0,void this._trnMainService.ReCalculateBillWithNormal()):void 0;this.discEnterClicked(r,l)}}addRowInsert(){this.trnMain.VoucherType==e.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.fromRequistionToTransferOut&&1==this.trnMain.DOFULLRETURN||this.trnMain.VoucherType==e.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.requisitionFromNotification||"VIEW"!=this.trnMain.Mode&&this._trnMainService.addRow()}checkValidation(r){var l=this.indexedProd(r);if(null!=l){if(null==l.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this.trnMain.VoucherType==e.Km.TaxInvoice&&0==l.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${l.ITEMDESC} (${l.MENUCODE}) Please Check Your Entry.`),!1}if(this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType==e.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE){var c=this.masterService.groupBy(this.trnMain.ProdList.filter(y=>0==y.ISUNKNOWN&&0==y.REQEXPDATE),function(y){return[y.MCODE,y.RATE,y.BC,y.BATCH]});for(const y of c)if(y.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if((this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType===e.Km.ProductionEntry)&&null!=this.trnMain.ProdList.filter(K=>1==K.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(K.EXPDATE))[0]&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return document.getElementById("mfgdate"+r).focus(),!1;if(this.trnMain.VoucherType===e.Km.BatchAdjustment&&1==this.trnMain.ADJUSTEXPIRY){let y=this.trnMain.ProdList.filter(ie=>ie.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(ie.TransferExpiryDate))[0];if(null!=y&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Exp Date is required for item:${y.ITEMDESC}`),!1;let K=this.trnMain.ProdList.filter(ie=>ie.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(ie.TransferMfgDate))[0];if(null!=K&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Mfg Date is required for item:${K.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this.trnMain.AdditionalObj.tag&&null!=this.indexedProd(r).SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).Quantity)+this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)>this._trnMainService.nullToZeroConverter(this.indexedProd(r).SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+r).focus(),!1;if((this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.indexedProd(r).Quantity>this.indexedProd(r).STOCK&&"EDIT"!==this.indexedProd(r).rowMode?.toUpperCase()&&this.indexedProd(r).STOCK>0&&9!=this.indexedProd(r).PTYPE&&this.indexedProd(r).PTYPE<10)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this.trnMain.VoucherType==e.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():(this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()),!this.trnMain.ProdList.some(y=>null==y.MCODE)&&!1===this._trnMainService.addRow())return;let u=r+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.ProductionEntry||this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.OpeningStockBalance?setTimeout(()=>{const y=document.getElementById("barcode"+u);null!=document.getElementById("barcode"+u)&&1!=y.disabled?(console.log("rn1"),this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.CreditNote?(document.getElementById("itemDesc"+u).focus(),this.resetDescriptionEdit()):this.trnMain.VoucherType===e.Km.BranchTransferOut?document.getElementById("itemDesc"+u).focus():document.getElementById("barcode"+u).focus()):document.getElementById("itemDesc"+u).focus()},0):setTimeout(()=>{null!=document.getElementById("itemDesc"+u)&&(document.getElementById("itemDesc"+u).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+u)&&document.getElementById("itemDesc"+u).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}returnBatch(r){if(console.log("returnBatch hit"),"self-billing"==this.activeurlpath&&this.trnMain.ProdList.filter(u=>u.BATCH==r.BATCH&&u.MCODE==r.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance&&2==this.userSetting.EnableBatch&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].enableSalesPrice=!1),this._trnMainService.assignBatchToActiveProdRow(r,this.activerowIndex),this.masterService.PlistTitle="",this.trnProd.PriceSelected=!0,1===this.trnProd.HASVARIANT)for(var l in this.trnProd.VARIANTLIST=r.VARIANTDETAIL,this.trnProd.VARIANTDESCA="",this.trnProd.BC=r.BCODE,this.trnProd.VARIANTLIST)console.log("Var attribute",l,this.trnProd.VARIANTLIST[l]),this.trnProd.VARIANTDESCA+=`<b>${l}</b>:${this.trnProd.VARIANTLIST[l]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance)&&this.focusAltQty()}}dblClickPopupBatch(r){console.log("eta aaucha ????/"),this.returnBatch(r),document.getElementById("alternateQty"+this.activerowIndex).focus()}QuantityChangeEvent(r,l){let c=this.trnMain.VoucherType;if(2==this.userSetting.EnableBatch||this.validateItemQuantity(r,l)){if((this.trnMain.VoucherType===e.Km.TaxInvoice||"abbreviated-sales-invoice"==this.activeurlpath||"performa-invoice"==this.activeurlpath||this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType===e.Km.Quotation)&&1==this.userSetting.EnablePartyWiseTaxableBill&&"EDIT"===this.trnMain.Mode&&this._trnMainService.vatFreeBill(),this.checkBCForMatrxiItem(),this.trnMain.VoucherType==e.Km.BatchAdjustment&&this._trnMainService.calculateBatchAdjustmentVariance(),(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)&&this.getSchemeDiscountForItem(this._trnMainService.TrnMainObj.ProdList[r]),"EDIT"===this.trnMain.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let y=this.trnProd;if(c in e.SL&&(u=this.ValidateQuantityinEDITMode())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message);if(c in e.fr&&1!=this.indexedProd(r).NATURETYPE&&1==this.userSetting.EnableBatchWisePrice&&2!=this.userSetting.EnableBatch){if("EDIT"===this.trnProd.rowMode?.toUpperCase())if(!0!==this.trnProd.PriceSelected)this.checkBatchWiseRateinEditMode();else{var u;if((u=this.ValidateQtyEDITModeForOUt())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message)}else if((u=this.ValidateQtyEDITModeForOUt())&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message);let K=this.checkItemStockINEditModeForOutQty();if(K&&!K.status)return void this.alertService.info(K.message)}if(this.trnMain.VoucherType===e.Km.ProductionEntry&&(console.log("active",y),"EDIT"===y.RowMode?.toUpperCase()&&y&&!this.ValidateQtyINEditModeFroProduction(y)))return}if((this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this.trnProd.ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this.trnProd.ALTERNATEQUANTIY=0);if(this.trnMain.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this.indexedProd(r).ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this.indexedProd(r).ITEMDESC} cannot have quantity more than one for membership sales invoice`),this.indexedProd(r).ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{null!==document.getElementById("rate"+r)&&document.getElementById("rate"+r).focus()},100)})),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote(),this.trnMain.VoucherType!==e.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this.trnProd.PSTOCK,this.trnProd.Quantity,this.activerowIndex,this.trnProd.ITEMDESC)){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn){let y=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],K=0;if(this._trnMainService.TrnMainObj.ProdList.filter(ie=>ie.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).forEach(ie=>K+=ie.Quantity),!this._trnMainService.validateIssueQtyInStockIssueReturn(y.TotalReqQuantity,K,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(!(!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&this.trnProd.PTYPE<10&&(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.BatchAdjustment||this.trnMain.VoucherType===e.Km.StockIssueReturn||this.trnMain.VoucherType===e.Km.StockIssue&&"NEW"===this.trnMain?.Mode?.toUpperCase()||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this.trnMain.VoucherType===e.Km.BranchTransferOut&&7!=this.trnProd.NATURETYPE&&9!==this.trnProd.PTYPE))||(console.log("check entered product stock"),this.checkEnteredProductStock(l))){if(this.trnMain.VoucherType===e.Km.TaxInvoice&&this.trnProd.PTYPE<10&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this.trnMain.VoucherType===e.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&0!=this.userSetting.EnableStockCheckInSO&&this.trnProd.PTYPE<10&&7!=this.trnProd.NATURETYPE&&this.checkSaleableQuantityInSalesOrder(),this.trnMain.REFORDBILL&&this.trnMain.VoucherType===e.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&(this.trnMain.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)){if(this.trnMain.VoucherType==e.Km.GoodsReceived&&0==this.userSetting.AllowQtyExceedInPo&&7==this.indexedProd(r).NATURETYPE)return;let y=this.trnMain.ProdList.filter(K=>K.MENUCODE==this.indexedProd(r).MENUCODE).map(K=>K.ALTERNATEQUANTIY).reduce((K,ie)=>K+ie,0);if(y>this.indexedProd(r).POSTOCK&&!this._trnMainService.isPurchaseModule())return this.alertService.info("Quantity is more than SO Stock!!"),this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).POSTOCK,this.focusAltQty(r),void this._trnMainService.ReCalculateBillWithNormal();if(y>this.indexedProd(r).POSTOCK&&this._trnMainService.isPurchaseModule()){let K="Quantity is more than PO Stock!! Are you sure you want to proceed further";if((this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)&&(K="Quantity is more than SO Stock!! Are you sure you want to proceed further"),!confirm(K))return this.indexedProd(r).ALTERNATEQUANTIY=0,this.focusAltQty(r),void this._trnMainService.ReCalculateBillWithNormal()}}if(this.trnMain.VoucherType===e.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this.trnMain.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this.trnMain.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.StockIssueReturn)&&9!==this.trnProd.PTYPE&&this.trnProd.PTYPE<10&&this.checkBatchWiseStockOut(r),this.trnMain.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!==this.trnMain.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)&&null!=this.trnMain.REFORDBILL&&""!=this.trnMain.REFORDBILL||this.trnMain.VoucherType===e.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"===this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),c in e.po){let y=this.trnProd.MCODE,K=this.trnProd.RATE,ie=this.trnProd.HASVARIANT,Me=this.trnProd.BC,De=this.trnProd.ISUNKNOWN;const Ae=this.trnProd.BATCH,Ce=this.trnProd.REQEXPDATE;!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&this.trnMain.REFORDBILL&&this.trnMain.VoucherType===e.Km.SalesOrder&&this.trnProd.PTYPE<10&&this.checkItemTotalQtyWithStock(y,Me,ie,K,this.activerowIndex),"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE&&1!=this.indexedProd(r).NATURETYPE&&(Ae||this.valiadateDuplicateRateItem(ie,y,K,De,this.activerowIndex,Ce))}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(this.checkBatchWiseEnterStock(r)?document.getElementById("ALTRATE"+this.activerowIndex)?.focus():this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n        ${this.trnProd.UNIT}, Item : ${this.trnProd.ITEMDESC} \n        @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `)),"production-entry"==this.activeurlpath){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.info("Please Select Production Item!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT)return void this.alertService.info("Please Select Item UNIT!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.info("Please Enter Valid Quantity!");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.info("Please Select Consumption WareHouse!!");this.userSetting.LinkProductionwithconsumption&&(1==this.userSetting.EnableBomBaseConsumption?this.emitShowPopup.emit():this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]))}return this.trnMain.VoucherType!=e.Km.BranchTransferOut||1!=this._trnMainService.fromRequistionToTransferOut||this.validationService.validateRequestQtyDoingTransferOut(this.indexedProd(r),this.trnMain.ProdList)?(this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&(2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch)&&this.checkValidation(r),!0):void(this.indexedProd(r).ALTERNATEQUANTIY=0)}}}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this.trnProd.MCODE,QUANTITY:this.trnProd.Quantity,RATE:this.trnProd.RATE,AMOUNT:this.trnProd.AMOUNT,UNIT:this.trnProd.UNIT,CUSTID:this.trnMain.PARAC,PRICEMODE:this.trnMain.PRICEMODE})}ratechangeEvent(r){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(r){this._trnMainService.calculateNetRATE(r),this.indexedProd(r).INDDISCOUNT=0,this.indexedProd(r).INDDISCOUNTRATE<0?this.indexedProd(r).INDDISCOUNTRATE=0:this.indexedProd(r).INDDISCOUNTRATE>100&&(this.indexedProd(r).INDDISCOUNTRATE=100),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountRateChange(r,l){return console.log("change disocunt entered generic",r,l),r>100?(this.alertService.info("Discount rate cannot be greater than 100%"),void(this.indexedProd(l).INDDISCOUNTRATE=0)):r<0?(this.alertService.info("Discount rate cannot be less than 0%"),void(this.indexedProd(l).INDDISCOUNTRATE=0)):void 0}IndDiscountAmountChangeEvent(r,l){if(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales){let c=100*this.trnProd.INDDISCOUNT/this._trnMainService.nullToZeroConverter(this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE),u=this.masterService.userProfile.roleRights.find(y=>"DISLIMIT"==y.right);console.log("dis rate",c,"dislimit",u),u&&c>u?.value&&(this.alertService.warning("Discount limit of :"+u.value+"% exceeded, with given discount amount : "+this.indexedProd(r).INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if((this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&(this.indexedProd(r).UNIT==this.indexedProd(r).BASEUNIT?(this.indexedProd(r).NETRATE=this.indexedProd(r).RATE+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ECSAMOUNT)/this.indexedProd(r).Quantity-this._trnMainService.nullToZeroConverter(this.indexedProd(r).INDDISCOUNT),this.indexedProd(r).CRATE=this.indexedProd(r).NETRATE):(this.indexedProd(r).NETRATE=this.indexedProd(r).RATE+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ECSAMOUNT)/this.indexedProd(r).Quantity-this._trnMainService.nullToZeroConverter(this.indexedProd(r).INDDISCOUNT/this.indexedProd(r).Quantity),this.indexedProd(r).CRATE=this.indexedProd(r).NETRATE)),this.trnMain.VoucherType===e.Km.SalesOrder){let c=100*this.trnProd.INDDISCOUNT/this._trnMainService.nullToZeroConverter(this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE),u=this.masterService.userProfile.userRights.find(y=>"DISLIMIT"==y.right);console.log(" so dis rate",c,"dislimit",u),u&&c>u?.value&&(this.alertService.warning("Discount limit of :"+u.value+"% exceeded, with given discount amount : "+this.indexedProd(r).INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDDISCOUNT<0?this.indexedProd(r).INDDISCOUNT=0:this.indexedProd(r).INDDISCOUNT>this.indexedProd(r).AMOUNT&&(this.indexedProd(r).INDDISCOUNT=this.indexedProd(r).AMOUNT),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountAmountChangeOfRetailerVATINCEvent(r,l){this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(l.target.value),this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT<0?this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=0:this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT>this.indexedProd(r).AMOUNT&&(this.indexedProd(r).INDIVIDUALDISCOUNT_WITHVAT=this.indexedProd(r).AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}QuantityEventClick(r){return this._trnMainService.nullToZeroConverter(this.indexedProd(r).Quantity)<1||(this.activerowIndex=r,this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.PurchaseOrder||this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.StockSettlement||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.GoodsReceived?document.getElementById("alternateunit"+r).focus():(this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.CreditNote)&&document.getElementById("remarks"+r).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(r){return{status:"error",error:r}}}isTableRowSelected(r){return this.activerowIndex===r}deleteRow(r){if("stock-adjustment"!=this._trnMainService.activeurlpath&&"VIEW"!=this.trnMain?.Mode?.toUpperCase()){if("EDIT"==this.trnMain?.Mode?.toUpperCase()&&(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType==e.Km.OpeningStockBalance||this.trnMain.VoucherType==e.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this.trnMain.VoucherType))return;if((this.trnMain.VoucherType==e.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this.trnMain.VoucherType==e.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this.trnProd.rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this.trnProd.ITEMDESC}`),(this.trnMain.VoucherType==e.Km.OpeningStockBalance||this.trnMain.VoucherType==e.Km.Purchase)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).TOTALOUTWARDSTOCK)>0&&"EDIT"===this.trnProd.rowMode?.toUpperCase())return void this.alertService.info(`Transaction has been completed for this item::${this.trnProd.ITEMDESC}, cannot delete.`)}if(this.trnMain.VoucherType!=e.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")){if(this.activerowIndex=this.rowIndex=r,null==this.trnProd.MCODE&&1==this.trnMain.ProdList.length)this.trnMain.ProdList.splice(this.activerowIndex,0);else{let l=this.trnMain.ProdList[this.activerowIndex],c={activeRow:l,deleteIndex:this.activerowIndex};this.userSetting.LinkProductionwithconsumption&&this.trnMain.VoucherType==e.Km.ProductionEntry&&(this.trnMain.ConsumptionProdList=this.trnMain.ConsumptionProdList.filter(u=>u.MasterMCode!==l.MCODE),this.activeRowEmit.emit(c)),this.trnMain.ProdList.splice(this.activerowIndex,1)}0===this.trnMain.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck=""}}}editRow(r){this._trnMainService.TrnMainObj.BILLTO?this._trnMainService.TrnMainObj.ProdList[r].MCODE?this._trnMainService.TrnMainObj.BILLTOADD?1==this.userSetting.EnableBomBaseConsumption?this.emitShowPopup.emit():this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[r]):this.alertService.info("Please Select Consumption WareHouse!!"):this.alertService.info("Please Select Production Item!"):this.alertService.info("Please Select Production WareHouse!!")}restrictPercentageNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this.indexedProd(l).INDDISCOUNTRATE=0:(parseFloat(r)>100||isNaN(parseFloat(r)))&&(this.indexedProd(l).INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this.indexedProd(l).INDDISCOUNT=0:parseFloat(r)>this.indexedProd(l).AMOUNT&&(this.indexedProd(l).INDDISCOUNT=this.indexedProd(l).AMOUNT)}catch{}}SelectUnit(r,l,c){this.indexedProd(r).DiscountOnAltUnit=!1,this.indexedProd(r).ALTERNATEQUANTIY=0,this.indexedProd(r).CRATE=0;let u=this.indexedProd(r).Product.AlternateUnits.find(y=>y.ALTUNIT==this.indexedProd(r).ALTUNIT);this.indexedProd(r).StopDecimal=u.StopDecimal,1==this.userSetting.EnableAltUnitDiscOnRate&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)&&0==this.userSetting.EnableBatchWisePrice&&this.assignRate(u,r),this.indexedProd(r).ALTUNIT==this.indexedProd(r).BASEUNIT?(this.trnMain.VoucherType!==e.Km.SalesOrder||1!=this.trnMain.AdditionalObj.LoadWholeSaleRate&&1!=this.userSetting.ENABLE_WSRATE_INSORDER||(this.indexedProd(r).RATE=this.indexedProd(r).WRATE),this.indexedProd(r).ALTRATE=this.indexedProd(r).RATE,this.indexedProd(r).ALTCONFACTOR=1,this.indexedProd(r).UNITDISCOUNTRATE=0,this.trnMain.VoucherType!=e.Km.CreditNote&&(this.indexedProd(r).INDDISCOUNTRATE=0,this.indexedProd(r).INDDISCOUNT=0)):(this.indexedProd(r).ALTCONFACTOR=u.CONFACTOR,this.trnMain.VoucherType===e.Km.SalesOrder&&(1==this.trnMain.AdditionalObj.LoadWholeSaleRate||1==this.userSetting.ENABLE_WSRATE_INSORDER)&&(this.indexedProd(r).RATE=this.indexedProd(r).WRATE),this.indexedProd(r).ALTRATE=this.indexedProd(r).RATE*this.indexedProd(r).ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this.indexedProd(r).WSRATE_DISCOUNT>0&&(this.indexedProd(r).ALTRATE=this.indexedProd(r).ALTRATE-this.indexedProd(r).ALTRATE*(this.indexedProd(r).WSRATE_DISCOUNT/100),this.indexedProd(r).RATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR),this.trnMain.VoucherType===e.Km.SalesOrder&&this.applyDiscountOnUnitChange(u,r),(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.DeliveryChalan||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice||this.trnMain.VoucherType===e.Km.Quotation)&&this.applyDiscountOnUnitChangeOnSales(u,r),this._trnMainService.ReCalculateBillWithNormal()),this.trnMain.VoucherType===e.Km.RequisitionApproval&&(console.log("something here",this.indexedProd(r)),this.indexedProd(r).ALTUNIT!=this.indexedProd(r).BASEUNIT?this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).REQUESTTOTALQTY/this.indexedProd(r).ALTCONFACTOR:this.indexedProd(r).ALTERNATEQUANTIY=this.indexedProd(r).REQUESTTOTALQTY,this.approvedQtyEnter(r),this._trnMainService.CalculateApprovalBill())}assignRate(r,l){let c=this.indexedProd(l).BASERATE;this.indexedProd(l).RATE=c,this.indexedProd(l).ALTRATE=c*r.CONFACTOR}applyDiscountOnUnitChange(r,l){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)if(1==this.userSetting.EnableAltUnitDiscOnRate){console.log("unit1");let c="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT;this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100),this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE}else 1==this.userSetting.EnableDiscountInAltUnit&&(this.indexedProd(l).UNITDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT);else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let c=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?r.SRATE_DISCOUNT:r.WSRATE_DISCOUNT);this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100)}}applyDiscountOnUnitChangeOnSales(r,l){if(1==this.userSetting.EnableAltUnitDiscOnRate){console.log("unit2");let c="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT;this.indexedProd(l).ALTRATE=this.indexedProd(l).ALTRATE-this.indexedProd(l).ALTRATE*(c/100),this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE}else 1==this.userSetting.EnableDiscountInAltUnit&&(this.indexedProd(l).INDDISCOUNTRATE="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT)}returnMultiBatchScheme(r){for(let l of r)this._trnMainService.assignBatchToActiveProdRow(l,this.activerowIndex)}flatDisChange(r){this.flatDiscountValue=r,this.flatDiscountAssign()}flatDiscountUnitChange(r){this.radioFlatDiscount=r,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this.trnMain.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let r=this.trnMain.ProdList.reduce((l,c)=>l+(this._trnMainService.nullToZeroConverter(c.AMOUNT)-this._trnMainService.nullToZeroConverter(c.INDDISCOUNT)),0);this.trnMain.TOTALFLATDISCOUNT=this.flatDiscountValue*r/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(r,l){this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l)}RemarksEnterCommand(r,l){if(r.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l),this.trnMain.VoucherType==e.Km.RequisitionApproval){let c=l+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+c)&&document.getElementById("alternateunit"+c).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let l="";l=this.trnMain.MWAREHOUSE?this.trnMain.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this.trnProd.MCODE}&VCHRNO=${this.trnMain.VCHRNO}&warehouse=${l}`).subscribe(c=>{if("ok"===c.status&&(this.batchlist=c.result,1===this.trnProd.REQEXPDATE&&!this.trnProd.BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===c.message&&(this.changeBatchWiseRate(c.result[0].RATE),this.trnProd.STOCK=c.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(c.result),this.trnProd.PRATE=c.result[0].costprice),"SHOWPRICEPOPUP"===c.message&&(this.masterService.PlistTitle="Batch Price Selection",this.trnProd.HasMulitplePrice=1,this.trnMain.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(c.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this.trnMain.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this.trnMain.Mode?.toUpperCase()){var u=this.ValidateQtyEDITModeForOUt();if(u&&!u.status)return this.trnProd.ALTERNATEQUANTIY=u.userEnterQty,void this.alertService.info(u.message)}})}dblClickPricePopUP(r){let l=this._trnMainService.mulitplePriceItemList.filter(Ae=>this._trnMainService.nullToZeroConverter(Ae.qty)>0),c=this.trnProd.UNIT,u=this.trnProd.BASEUNIT,y=this.trnProd.MCODE,K=this.trnProd.MENUCODE,ie=this.trnProd.ITEMDESC,Me=this.trnProd.Product.AlternateUnits,De=this.trnProd.ALTCONFACTOR;if(this.trnMain.ProdList=this.trnMain.ProdList.filter(Ae=>0!=this._trnMainService.nullToZeroConverter(Ae.ALTERNATEQUANTIY)),null!=l)for(let Ae=0;Ae<l.length;Ae++){let Ce={Product:{}};Ce.MCODE=y,Ce.MENUCODE=K,Ce.INDDISCOUNT=l[Ae].dcamount,Ce.INDDISCOUNTRATE=l[Ae].dcrate,Ce.ITEMDESC=ie,Ce.UNIT=c,Ce.BASEUNIT=u,Ce.RATE=l[Ae].rate,Ce.ALTRATE=l[Ae].rate,Ce.ALTERNATEQUANTIY=l[Ae].qty,Ce.inputMode=!0,Ce.CRATE=l[Ae].netrate,Ce.ALTCONFACTOR=De,Ce.Product.AlternateUnits=Me,this.trnMain.ProdList.push(Ce)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(r){console.log("dblclickpar"),null!=r&&(this.trnMain.VoucherType===e.Km.OpeningStockBalance?(this.trnProd.TRNAC=r.ACID,this.trnProd.ACNAME=r.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this.trnMain.PARAC=r.ACID,this.trnMain.BILLTO=r.ACNAME,this.trnMain.BILLTOADD=r.ADDRESS,this.trnMain.BILLTOTEL=r.VATNO,this.trnMain.BILLTOMOB=r.MOBILE,null==this.trnMain.AdditionalObj&&(this.trnMain.AdditionalObj={}),this.trnMain.AdditionalObj.TRNTYPE=r.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this.trnMain.VoucherType===e.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}SupplierEnterClicked(r){return r.preventDefault(),document.getElementById("supplier"+this.activerowIndex).blur(),this.genericGridSupplierPopup.show(),!1}onKeydownPreventEdit(r){"Enter"===r.key||"Tab"===r.key||r.preventDefault()}batchKeyDownEvent(){return!1}newMFGDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("newexpiry"+this.activerowIndex).focus(),!1}newExpDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("remarks"+this.activerowIndex).focus(),!1}MFGDateEnterEvent(r){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(r){return this.trnMain.VoucherType==e.Km.ProductionEntry&&"EDIT"==this.trnMain.Mode||this.checkValidation(r)||this.masterService.focusAnyControl("remarks"+r),!1}AlternateUnitEnterEventClick(r,l){l.preventDefault(),this.activerowIndex=r,null!=this.indexedProd(r).ALTUNIT&&""!=this.indexedProd(r).ALTUNIT&&void 0!==this.indexedProd(r).ALTUNIT&&(this.focusAltQty(r),this.trnMain.VoucherType==e.Km.RequisitionApproval&&document.getElementById("approvedQty"+r).focus(),this.trnMain.VoucherType==e.Km.Stockadjustment&&document.getElementById("physicalStock"+r).focus()),this.trnMain.VoucherType==e.Km.TaxInvoice&&1==this.trnProd.NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this.indexedProd(r).BC&&""!=this.indexedProd(r).BC&&void 0!==this.indexedProd(r).BC&&document.getElementById("rate"+r).focus(),74==this.trnMain.VoucherType&&null!=this.indexedProd(r).ALTUNIT&&""!=this.indexedProd(r).ALTUNIT&&null!=this.indexedProd(r).ALTUNIT&&document.getElementById("alternaetqty"+r).focus(),this.trnMain.VoucherType==e.Km.TaxInvoice&&this.trnMain.REFORDBILL&&this.focusAltQty(r)}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discountAmt"+this.activerowIndex).focus(),!1}mrpEnterEvent(r,l){if(this.activerowIndex=l,this.validateProductionRate(r,l)||this.blockMoveToNextrow())return;let c=this.indexedProd(l).PTYPE;if(this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&1!=c&&this.trnMain.ProdList&&this.trnMain.ProdList.length&&0==this.indexedProd(l).ALTUNITObj.RATE_A&&0==this.indexedProd(l).MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(r,l),this.trnMain.VoucherType===e.Km.OpeningStockBalance)null!=document.getElementById("MRP"+l)?document.getElementById("MRP"+l).focus():0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus();else if(this.trnMain.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(l);else if(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales||57==this.trnMain.VoucherType)"Non-Discountable"!=this.trnProd.DISMODE&&(this.trnMain.VoucherType===e.Km.TaxInvoice&&0==this.trnProd.ECSRATE&&1==this.trnProd.HASECSCHARGE?document.getElementById("ECSAmount"+this.activerowIndex).focus():null!=document.getElementById("discountAmt"+this.activerowIndex)||this.trnMain.VoucherType===e.Km.TaxInvoice&&null!=document.getElementById("discountAmt"+this.activerowIndex)&&1!=this.userSetting.EnableBatchWisePrice?document.getElementById("discountAmt"+this.activerowIndex).focus():document.getElementById("mfgdate"+this.activerowIndex).focus());else if(this.trnMain.VoucherType===e.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this.trnMain.VoucherType===e.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(l)}else this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag||this.trnMain.VoucherType===e.Km.StockSettlement||this.trnMain.VoucherType===e.Km.BranchTransferIn||this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.Repack?this.checkValidation(l):this.trnMain.VoucherType===e.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(l)):null!=document.getElementById("discountAmt"+this.activerowIndex)?document.getElementById("discountAmt"+this.activerowIndex).focus():null!=document.getElementById("remarks"+this.activerowIndex)?document.getElementById("remarks"+this.activerowIndex).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+this.activerowIndex).focus());(this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.Repack||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType===e.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(l),1==this.userSetting.EnableBatch&&this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote();let u={isFocusAchieved:!1};return this.focusService.autoFocus(l,document.getElementById("rate"+l),u,"productinserttable"),u.isFocusAchieved||this.checkValidation(l),!1}blockMoveToNextrow(){return("EDIT"==this.trnMain.Mode||1==this.trnMain.DOFULLRETURN)&&"RQ"==this.trnMain.REFBILL?.substring(0,2)&&1==this.userSetting.EnableRequisitionPopup}setItemPopupUrl(){this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this.trnMain,this._trnMainService.activeurlpath),this.gridPopupSettingsForSupplier=this.productHelperService.getGridPopUpSettingForSupplier()}assignValueForReturnModeInProd(r){this.trnMain.VoucherType===e.Km.DebitNote?(this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.RATE):this.trnProd.PRATE=r.PRATE,this.trnProd.REALRATE=this.trnProd.ALTRATE=this.trnProd.RATE=r.RATE,this.trnProd.SPRICE=r.SPRICE,this.trnProd.BATCH=r.BATCH,this.trnProd.MFGDATE=null==r.MFGDATE?"":r.MFGDATE.toString().substring(0,7),this.trnProd.EXPDATE=null==r.EXPDATE?"":r.EXPDATE.toString().substring(0,7),this.trnProd.UNIT=r.UNIT,this.trnProd.STOCK=r.STOCK,this.trnProd.Quantity=r.STOCK,this.trnProd.WAREHOUSE=r.WAREHOUSE,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,this.trnProd.INDDISCOUNT=r.INDDISCOUNT,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,this.trnProd.PrimaryDiscount=r.PrimaryDiscount,this.trnProd.SecondaryDiscount=r.SecondaryDiscount,this.trnProd.LiquiditionDiscount=r.LiquiditionDiscount,this.trnProd.BASEUNIT=r.BASEUNIT,null==this.trnProd.Product&&(this.trnProd.Product={}),this.trnProd.Product.MCODE=r.MCODE,this.trnProd.CONFACTOR=1,this.trnProd.ALTUNIT=r.UNIT,this.trnProd.UNIT=r.UNIT,this.trnProd.BASEQUANTITY=r.Quantity,this.trnProd.ProductDetails=[],this.trnProd.ALTERNATEUNIT=this.trnProd.ALTUNIT,this.trnProd.ALTCONFACTOR=r.ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(r){this.activerowIndex=r,this.batchlist=[]}validateRate(r,l){if(this.trnMain.VoucherType===e.Km.ProductionEntry)return this.validateProductionRate(r,l);if(0==this._trnMainService.nullToZeroConverter(r.ALTRATE))return!confirm(" Zero  Rate Entry Detected For Item '"+r.ITEMDESC+"'. Do You Want To Proceed Anyway ? ");const c=this.getSellingRate();if(this.changeRateBelowCRateRight=this.masterService.userProfile.userRights.find(u=>"AllowSalesBelowCRate"==u.right)?.value,this._trnMainService.nullToZeroConverter(c)<this._trnMainService.nullToZeroConverter(r.PRATE)&&0==this.changeRateBelowCRateRight)return this.alertService.info("User "+this.userProfile.username+" doesn't have right to enter less rate for item '"+r.ITEMDESC+"'."),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=0,!1;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation){let u=this.getSellingRate();this.validateSellingPriceBelowLandingCost(u,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE,this.activerowIndex)}}validateProductionRate(r,l){return!(0!=this._trnMainService.nullToZeroConverter(r.ALTRATE)||!r.MCODE||(this.alertService.info("Cannot add 0 rate in production entry for item "+r.ITEMDESC),document.getElementById("rate"+l).focus(),0))}getSellingRate(){const r=0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR)?1:this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR);let l=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE)/r;return 1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation)&&(l=1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate),l}validateSellingPriceBelowLandingCost(r,l,c){if(r<l)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(u=>{setTimeout(()=>{null!==document.getElementById("discount"+c)?document.getElementById("discount"+c).focus():document.getElementById("remarks"+c).focus()},0)}),!1}MRPChangeEvent(r,l){let c=this.indexedProd(l).PTYPE;if("goods-received-note"==this.activeurlpath&&"NEW"==this.trnMain.Mode){let u=this.masterService.userProfile.roleRights.find(y=>"ALLOWRATECHANGEINPI"==y.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==u.value&&(this.indexedProd(l).TEMP_ALTRATE==this.indexedProd(l).ALTRATE||confirm("PRATE DIDN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this.indexedProd(l).ALTRATE=this.indexedProd(l).TEMP_ALTRATE))}this.validateRate(r,l),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&0==this.userSetting.EnableBatchWisePrice&&this.validateRateForSalesInvoiceOnEnter(),this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&1!=c&&(console.log("rnk1"),this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this.trnMain.VoucherType===e.Km.OpeningStockBalance&&this.validateCostPrice(),this.indexedProd(l).UNIT==this.indexedProd(l).BASEUNIT?this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE:0!=this._trnMainService.nullToZeroConverter(this.indexedProd(l).ALTRATE)&&(this.indexedProd(l).RATE=this.indexedProd(l).ALTRATE/this._trnMainService.nullToZeroConverter(this.indexedProd(l).ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this.trnMain.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this.trnProd.SELLRATEBEFORETAX=this.trnProd.RATE,this.trnProd.MRP=this.trnProd.RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this.trnMain.VoucherType===e.Km.SalesOrder&&this.trnMain.REFORDBILL&&this.checkRateisChangedinSoFromQT()}validateRateForSalesInvoiceOnEnter(){this.validateSellingPriceBelowLandingCost(this.trnProd.ALTRATE,this.trnProd.PRATE,this.activerowIndex)}checkRateisChangedinSoFromQT(){this.trnProd.ALTRATE!==this.trnProd.PORATE&&(confirm("Rate is change Do you want to proceed .")||(this.trnProd.ALTRATE=this.trnProd.PORATE))}AlternateQuantityEventClick(r,l){if(l.preventDefault(),this.QuantityChangeEvent(r,l)&&0!=this.trnProd.Quantity&&"QuantityExceed"!=this._trnMainService.quantityExceedCheck){if(this.trnMain.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this.trnMain.Mode&&setTimeout(()=>{document.getElementById("rate"+r).focus()},20),(this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.SalesReturn)&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DONONSALEABLERETURN){var c,u=this.indexedProd(r).MCODE;if(c=this._trnMainService.ReturnStockReconcile(u),this.indexedProd(r).STOCK<c)return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity")}if((this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.BranchTransferOut||this.trnMain.VoucherType===e.Km.BranchTransferIn)&&this.indexedProd(r).MINLEVEL>0&&this.indexedProd(r).MINLEVEL<this._trnMainService.ReturnStockReconcile(this.indexedProd(r).MCODE))return void this.alertService.warning("Quantity cannot exceed the minimum stock level");if(this.trnMain.VoucherType==e.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this.trnProd.PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show()),this.trnProd.BC||1===this.trnProd.HASVARIANT&&(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType==e.Km.OpeningStockBalance||this.trnMain.VoucherType==e.Km.ProductionEntry||this.trnMain.VoucherType==e.Km.RequisitionEntry||this.trnMain.VoucherType==e.Km.Quotation||this.trnMain.VoucherType==e.Km.PurchaseOrder||this.trnMain.VoucherType==e.Km.SalesOrder)&&(this.alertService.info("Please select variants first!"),this.trnProd.ALTERNATEQUANTIY=0,this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this.trnProd.Mcat}&mcode=${this.trnProd.MCODE}`).subscribe(y=>{"ok"==y.status&&y.result&&y.result.length&&this.alertService.emitShowHideSubject.subscribe(K=>{setTimeout(()=>{this.matrixItemAtrribute=y.result,this.matrixitemgrid.show()})})})),1===this.userSetting.EnableTelcomDevices&&1===this.trnProd.NATURETYPE&&(this.trnProd.visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this.trnMain.Mode?.toUpperCase()&&(this.trnProd.ProductDetails=[]),(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.TaxInvoice&&(0,Q.isNullOrUndefined)(this.trnProd.BARCODE)||this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.Quotation||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice||this.trnMain.VoucherType===e.Km.BranchTransferOut)&&(1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)?(null==this._trnMainService.TrnMainObj.ProdList[r].BC||""==this._trnMainService.TrnMainObj.ProdList[r].BC||null==this._trnMainService.TrnMainObj.ProdList[r].BC)&&this.dialougeOpen():this.dialougeOpen())),(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&this.checkMaxStockLevel(r),this.indexedProd(r).PTYPE<10&&(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType==e.Km.StockIssue||this.trnMain.VoucherType===e.Km.BranchTransferOut)&&this.checkReorderStocklevel(r),(this.trnMain.VoucherType==e.Km.TaxInvoice||this.trnMain.VoucherType==e.Km.Sales)&&this.getSchemeDiscountForItem(this.indexedProd(r)),this.trnMain.VoucherType===e.Km.BranchTransferOut&&9!=this.trnProd.PTYPE&&(console.log("abc",this._trnMainService.allowNegativeBilling(this.activerowIndex)),this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock(l)),this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&(0==this.userSetting.ENABLEMANUALSALESRETURN||0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)&&this.checkValidation(r),"self-billing"===this.activeurlpath&&this.checkValidation(r),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY>0&&this.focusToRate(r,l),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this.trnProd.HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this.trnMain.VoucherType==e.Km.BatchAdjustment&&1==this.trnMain.ADJUSTEXPIRY&&setTimeout(()=>{document.getElementById("newexpiry"+this.activerowIndex).focus()},20),this.trnMain.VoucherType==e.Km.BranchTransferOut&&1==this._trnMainService.fromRequistionToTransferOut&&!this.validationService.validateRequestQtyDoingTransferOut(this.indexedProd(r),this.trnMain.ProdList))return void(this.indexedProd(r).ALTERNATEQUANTIY=0);this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&(2==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch)&&this.checkValidation(r)}}focusAfterQuantityClick(){if(this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag)document.getElementById("fcrate"+this.activerowIndex).focus();else if(this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag){if(0==this.userSetting.IMPORTPOBILLMODE)return void document.getElementById("fcrate"+this.activerowIndex).focus();document.getElementById("discountAmt"+this.activerowIndex).focus()}if(this.trnMain.VoucherType===e.Km.TaxInvoice&&"export-sales-invoice"==this.activeurlpath)document.getElementById("fcrate"+this.activerowIndex).focus();else if((this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived&&7!=this.trnProd.NATURETYPE)&&this.trnMain.REFORDBILL)document.getElementById("discountAmt"+this.activerowIndex).focus();else if(this.trnMain.VoucherType==e.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath)this.trnMain.VoucherType==e.Km.BatchAdjustment&&(1==this.trnMain.ADJUSTEXPIRY?(console.log("suru ma ya chircha ki nai hernu paryo",this.activerowIndex),setTimeout(()=>{document.getElementById("newmanufacture"+this.activerowIndex).focus()},20)):document.getElementById("adjustbatch"+this.activerowIndex).focus());else if(this.trnMain.VoucherType==e.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL)document.getElementById("discountAmt"+this.activerowIndex).focus();else if(console.log("fc1"),this.focusService.isFocusable(document.getElementById("rate"+this.activerowIndex)))document.getElementById("rate"+this.activerowIndex).focus();else{let r={isFocusAchieved:!1};this.focusService.autoFocus(this.activerowIndex,document.getElementById("alternateQty"+this.activerowIndex),r,"productinserttable"),console.log("fc",r),r.isFocusAchieved||this.checkValidation(this.activerowIndex)}}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let r=0;if(this.trnMain.ProdList.filter(c=>c.PMCODE==this.trnProd.PMCODE&&c.BATCH==this.trnProd.BATCH).forEach(c=>{r+=c.ROUTQTY}),console.log("total Enter qty",r,"stokc",this.trnProd.STOCK),r>this.trnProd.STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n      ${this.trnProd.PUNIT},\n      (-${this.indexedProd(this.activerowIndex-1).ROUTQTY}   ${this.trnProd.PUNIT} ) \n      Item : ${this.trnProd.ITEMDESC} \n      @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let r=0;if(this.trnMain.ProdList.filter(c=>c.MCODE==this.trnProd.MCODE&&c.BATCH==this.trnProd.BATCH).forEach(c=>{r+=c.ROUTQTY}),r>this.trnProd.STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n    Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n    ${this.trnProd.PUNIT},\n    (-${this.indexedProd(this.activerowIndex-1).ROUTQTY}   ${this.trnProd.PUNIT} ) \n    Item : ${this.trnProd.ITEMDESC} \n    @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let r=0;if(this.trnMain.ProdList.filter(l=>l.MCODE==this.trnProd.MCODE&&l.BATCH==this.trnProd.BATCH&&l.BC==this.trnProd.BC).forEach(l=>{r+=l.Quantity}),r>this.trnProd.TOTSTOCK&&9!=this.trnProd.PTYPE)return this.alertService.info(`Inserted Item ${this.trnProd.ITEMDESC} Quantity :\n  ${this._trnMainService.nullToZeroConverter(this.trnProd.Quantity)}  \n  Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this.trnProd.TOTSTOCK)} \n  ${this.trnProd.BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(r,l){if(l.preventDefault(),"production-entry"==this.activeurlpath&&this.userSetting.LinkProductionwithconsumption){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)return void this.alertService.info("Please Select Production Item!");if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT)return void this.alertService.info("Please Select Item UNIT!");if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY)return void this.alertService.info("Please Enter Valid Quantity!");if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)return void this.alertService.info("Please Enter Expiry Date!!");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.info("Please Select Consumption WareHouse!!");this.userSetting.LinkProductionwithconsumption&&(1==this.userSetting.EnableBomBaseConsumption?this.emitShowPopup.emit():this.activeRowEmitForEdit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]))}if("production-entry"==this.activeurlpath&&0==this.userSetting.LinkProductionwithconsumption){if(!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)return void this.alertService.info("Please Enter Expiry Date!!");setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},10)}0==this.indexedProd(r).ECSRATE&&1==this.indexedProd(r).HASECSCHARGE&&document.getElementById("ECSAmount"+this.activerowIndex).focus(),this.trnMain.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this.trnMain.AdditionalObj.tag?document.getElementById("fcrate"+r).focus():this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect&&7!==this.indexedProd(r).NATURETYPE?document.getElementById("discountAmt"+r).focus():this.trnMain.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath?(console.log("dis"),document.getElementById("discountAmt"+r).focus()):this.salesRateDisabled.indexOf(this.trnMain.VoucherType)>=0?this.focusRateOrDiscount():document.getElementById("rate"+r).focus()}BaseQuantityEventClick(r,l){l.preventDefault(),this.activerowIndex=r,null!=document.getElementById("mrp"+r)?this.masterService.focusAnyControl("mrp"+r):this.masterService.focusAnyControl("remarks"+r),this.SelectUnit(r,"EACH",l.target.value)}checkBatchWiseStockOut(r){this.checkBatchWiseEnterStock(r)||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this.trnProd.STOCK)} \n      ${this.trnProd.BASEUNIT}, Item : ${this.trnProd.ITEMDESC} \n      @Qty = ${this.trnProd.Quantity} ${this.trnProd.ALTUNIT} `)}checkItemTotalQtyWithStock(r,l,c,u,y){let K=0;if(K=1==c?this.trnMain.ProdList.filter(ie=>ie.MCODE==r&&ie.BC==l&&ie.RATE==u).map(ie=>ie.Quantity).reduce((ie,Me)=>ie+Me,0):this.trnMain.ProdList.filter(ie=>ie.MCODE==r&&ie.RATE==u).map(ie=>ie.Quantity).reduce((ie,Me)=>ie+Me,0),K>0)return K>this.trnProd.TOTSTOCK&&9!=this.trnProd.PTYPE?(this.alertService.info(`Item ${this.trnProd.ITEMDESC} Entered  Quantity: ${K}  exceed the available stock ${this.trnProd.TOTSTOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this.trnProd.ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(r,l,c,u,y,K){if(0==r&&0==u){let ie=this.trnMain.ProdList.filter(Me=>Me.MCODE==l&&Me.RATE==c);if(ie&&ie?.length>1)return this.alertService.info(`${ie[0].ITEMDESC} Item with '${ie[0].RATE}' duplicate rate `),void(this.trnProd.ALTERNATEQUANTIY=0)}}checkBatchWiseStock(){let r=[];this.masterService.getStockBatchWise(this.trnProd.MCODE).subscribe(l=>{"ok"==l.status&&(r=l.result,null!=r&&this.trnProd.Quantity>r[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this.trnProd.MCODE,this.trnMain.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(r){console.log("petrol pump fxn ",r.MRP,r.ISAMOUNTWISEBILL),(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==r.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(r.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}wareHouseWiseStock(r){this.warehouseWiseStockPopup.show(r.MCODE,this.activerowIndex)}assignWSRate(r){this.trnProd.RATE=r.WRATE,this.trnProd.ALTRATE=r.WRATE,this.trnProd.BASERATE=r.WRATE}dblClickPopupItem(r){this.showtooltip=!0;let c,l=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={},(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.ExportSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&this.userSetting.CompulsoryHSCodeInput){if(r&&!r.HSNCode)return void this.alertService.warning("HS Code is not registered!");this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HS_Code=r.HSNCode,console.log("HSNCode",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HS_Code)}if(this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry?void 0!==this._trnMainService.TrnMainObj.ProdList.find(K=>K.MENUCODE==r.MENUCODE)&&(c=!1):c=this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,r),0==c)return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(K=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(r),"add-sales-invoice"==this.activeurlpath&&1==this._trnMainService.showWareHouseWiseStockPopup&&this.wareHouseWiseStock(r),0!=this.ValidateDuplicateItemEntry(r)){if("add-sales-invoice-wholesale"===this.activeurlpath||this.trnMain.VoucherType==e.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate||this.trnMain.VoucherType==e.Km.SalesOrder&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate?this.assignWSRate(r):(this.trnMain.VoucherType!=e.Km.BranchTransferOut&&(this.trnProd.RATE=r.RATE,this.trnProd.BASERATE=r.RATE,this.trnProd.ALTRATE=r.RATE),this.trnMain.VoucherType==e.Km.BranchTransferOut&&1==r.NATURETYPE&&(this.trnProd.RATE=r.RATE,this.trnProd.BASERATE=r.RATE,this.trnProd.ALTRATE=r.PRATE)),this._trnMainService.NeedToTakePriceFromMenuItem()){let K=r.RATE;l in e.qK&&(l==e.Km.PerformaSalesInvoice&&1==this.trnMain.AdditionalObj.LoadWholeSaleRate&&(K=r.WRATE),this._trnMainService.assignProductMasterRate(this.activerowIndex,K)),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.WRATE),l in e.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.PRATE,r.CONFACTOR)}if(this.trnProd.PTYPE=r.PTYPE,this.trnProd.ECSRATE=r.ECSRATE,this.trnProd.HASECSCHARGE=r.HASECSCHARGE,this.trnProd.HASECSRATE=r.HASECSRATE,this.trnProd.NATURETYPE=r.NATURETYPE,this.trnProd.ENABLEITEMWISEBATCH=r.ENABLEITEMWISEBATCH,this.trnProd.HASBATCH=r.HASBATCH,6==this.trnProd.NATURETYPE&&this.trnMain.VoucherType!=e.Km.PurchaseOrder&&(this.trnProd.isQuantityReadonly=!0),this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TotalReqQuantity=r.TotalReqQuantity),("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"IS"==this._trnMainService.TrnMainObj.VoucherPrefix||"TO"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this.trnProd&&(this.trnProd.BC=r.BARCODE),6==this.trnProd.NATURETYPE&&""!=this.trnProd.BC&&null!=this.trnProd.BC&&null!=this.trnProd.BC&&(this.trnProd.isBarcodeOfPtypeSix=!0)),this.trnMain.VoucherType===e.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this.trnProd.SPRICE=r.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this.trnProd.VSRATE=r.In_Rate_B,this.trnProd.VPRATE=r.RATE_B)),1===this.trnProd.NATURETYPE&&this.trnMain.VoucherType===e.Km.CreditNote&&1==this.userSetting.EnableTelcomDevices){if(!this.validationService.validateDuplicateBarcode(r,this.trnMain.ProdList))return;this.trnProd.ProductDetails=[],this.trnProd.ALTERNATEQUANTIY=1,this.trnProd.BC=r.BC,this._trnMainService.addRow(),setTimeout(()=>{const K=document.getElementById("itemDesc"+(this.activerowIndex+1));K&&K.focus()},50)}if(this.focusAfterItemSelect(),this.focusService.afterEnterFocousItem(r.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this.trnProd){this.batchlist=[];let K=this.trnProd;K.REQEXPDATE=r.REQEXPDATE,K.DISMODE=r.DISMODE,K.PWEIGHT=r.GWEIGHT,K.PROMOTION=0,K.BATCHSCHEME=null,K.ALLSCHEME=null,K.ISVAT=r.ISVAT,K.MENUCODE=r.MENUCODE,K.ITEMDESC=r.DESCA,K.MCODE=r.MCODE,K.WEIGHT=r.GWEIGHT,K.Mcat=r.MCAT,K.BASEUNIT=r.BASEUNIT,K.SHELFLIFE=r.SHELFLIFE,K.Weighable=r.Weighable,K.MRP=r.MRP,K.ALTCONFACTOR=r.CONFACTOR,K.BARCODE=r.BARCODE,K.TOTSTOCK=r.STOCK,K.PSTOCK=r.PSTOCK,this.trnMain.VoucherType===e.Km.Repack&&(K.ALTUNIT=r.BASEUNIT,K.PDESCA=r.ParentName,K.PMCODE=r.SUPITEMCODE,K.CONFACTOR=r.CONFACTOR,K.PUNIT=r.PUNIT,K.REPACKRATE=r.PRATE,K.ALTRATE=r.PRATE),K.UNIT=r.BASEUNIT,K.WARRANTY=r.WARRANTY,K.W_MRP=r.W_MRP,K.W_SELLRATEBEFORETAX=r.W_SELLRATEBEFORETAX,K.STOCK=r.STOCK,K.WSRATE_DISCOUNT=r.WSRATE_DISCOUNT,K.MINLEVEL=r.MINLEVEL,K.MAXLEVEL=r.MAXLEVEL,K.ROLEVEL=r.ROLEVEL,K.ROWARN=r.ROWARN,K.MINWARN=r.MINWARN,K.HASVARIANT=r.HASVARIANT,K.Mcat=r.MCAT,K.REMARKS=r.REMARKS,K.PRATE=r.PRATE,K.ISRECURRING=r.ISRECURRING,K.HASCOMMISSIONCHARGE=r.HASCOMMISSIONCHARGE,K.ISAMOUNTWISEBILL=r.ISAMOUNTWISEBILL,K.ISUNKNOWN=r.ISUNKNOWN,K.RSTOCK=r.RSTOCK,1==r.HASVARIANT&&(K.BC=r.BC),r.VARIANTDETAIL&&(K.VARIANTLIST=JSON.parse(r?.VARIANTDETAIL),K.VARIANTDESCA="",K.VARIANTDESCA=this._trnMainService.getVariantDescriptionFromList(K)),1==this.trnProd.NATURETYPE&&!(0,Q.isNullOrUndefined)(this.trnProd.BC)&&(this.trnProd.ALTERNATEQUANTIY=1),1==this.trnProd.NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this.trnProd.isItemDesReadonly=!0),this.trnMain.VoucherType===e.Km.OpeningStockBalance&&(this.trnProd.SUPCODE=r.SUPCODE,this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.CRATE),this.trnMain.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this.trnProd.CRATE=r.CRATE,this.trnProd.PRATE=r.CRATE),this.trnMain.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.trnMain.DOFULLRETURN&&this.trnMain.REFBILL&&(this.trnProd.LOYALTYRATE=this._trnMainService.nullToZeroConverter(r.LOYALTY/(r.STOCK*r.RATE)*100),r.RATEDISCOUNT>0&&(this.trnProd.UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE)),this.trnProd.PROMOTIONRATE=this._trnMainService.nullToZeroConverter(r.PROMOTION/(r.REALQTY*r.RATE)*100),this._trnMainService.vatFreeBill()),this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&(this.trnProd.INVRATE=r.INVRATE),this.trnMain.VoucherType===e.Km.SalesOrder&&(this.trnProd.RATE=r.RATE,this.trnProd.WRATE=r.WRATE,(1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate||1==this.userSetting.ENABLE_WSRATE_INSORDER)&&(this.trnProd.RATE=this.trnProd.WRATE,this.trnProd.ALTRATE=this.trnProd.UNIT===this.trnProd.BASEUNIT?this.trnProd.RATE:this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*this._trnMainService.nullToZeroConverter(this.trnProd.ALTCONFACTOR))),this.trnMain.VoucherType===e.Km.StockIssueReturn&&(this.trnProd.PSTOCK=r.ISSUEQTY,this.trnProd.EXPDATE=r.EXPDATE),this.trnMain.VoucherType in e.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this.trnMain.VoucherType===e.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this.trnMain.DOFULLRETURN)||this.trnMain.VoucherType==e.Km.BatchAdjustment)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this.trnMain.VoucherType==e.Km.BatchAdjustment&&this.FocusForBatchAdjustment(r.HASVARIANT),this.trnMain.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this.trnProd.ALTERNATEQUANTIY=1),1===this.userSetting.EnableWSRateGroup&&this.trnMain.VoucherType===e.Km.SalesOrder&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),1===this.userSetting.ENABLERATEGROUP&&!(this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO"))&&("abbreviated-sales-invoice"===this.activeurlpath||"add-sales-invoice"===this.activeurlpath||"add-sales-invoice-wholesale"===this.activeurlpath)&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),this._trnMainService.NeedToTakePriceFromMenuItem()||(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.StockSettlement||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)&&1===this.userSetting.EnableItemWiseBatch&&1===r.HASBATCH&&this.trnProd.PTYPE<10&&this.checkBatchWiseRate(),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.REFORDBILL?.startsWith("SO")||((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&1==this.userSetting.EnableExpiryTrackinginBilling)&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate(),this._trnMainService.NeedToTakePriceFromMenuItem()||(this.trnMain.VoucherType===e.Km.StockIssueReturn||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.BranchTransferIn||this.trnMain.VoucherType===e.Km.BranchTransferOut&&1!=r.NATURETYPE||"consumption"===this.trnMain.AdditionalObj.RETURNTYPE||this.trnMain.VoucherType===e.Km.Repack||this.trnMain.VoucherType===e.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===e.Km.StockSettlement||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&r.PTYPE<10&&9!==r.PTYPE&&(this.trnMain.VoucherType===e.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL||!1===this.itemFromBC(r.HASVARIANT)&&this.checkBatchWiseRate())),(this.trnMain.VoucherType===e.Km.SalesOrder||this.trnMain.VoucherType==e.Km.Sales||this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.BranchTransferOut)&&0===this.userSetting.EnableBatchWisePrice&&1===r.HASVARIANT&&this.checkBatchWiseRateSettingZero(),1!=this.trnProd.NATURETYPE&&this.trnMain.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE),this.trnMain.VoucherType===e.Km.Purchase||"production-entry"===this.activeurlpath||this.trnMain.VoucherType==e.Km.BranchTransferOut&&(7==r.NATURETYPE||r.PTYPE>=10)||this.trnMain.VoucherType===e.Km.StockIssue||this.trnMain.VoucherType===e.Km.OpeningStockBalance||this.trnMain.VoucherType===e.Km.RequisitionEntry||this.trnMain.VoucherType===e.Km.GoodsReceived||"self-billing"===this.activeurlpath||this.trnMain.VoucherType===e.Km.PurchaseOrder?(this.trnProd.RATE=r.PRATE,this.trnProd.SELLRATEBEFORETAX=r.RATE,this.trnProd.ALTRATE=r.PRATE,this.trnProd.RECRATE=r.RECRATE,this.trnProd.POSTOCK=r.POSTOCK,this.trnProd.PREV_PRATE=r.PREV_PRATE):(this.trnMain.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this.trnMain.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this.trnMain.VoucherType===e.Km.StockIssue&&(this.trnProd.BATCH=r.BATCH,this.trnProd.isApproved=0),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(r),0!==this.userSetting.ENABLE_SOINTI&&this.trnMain.REFORDBILL&&(this.trnMain.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(r),this.trnMain.VoucherType===e.Km.SalesOrder&&this.trnMain.REFORDBILL&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),this.emitReferenceQuantity(),1==this.userSetting.ENABLESINGLEBATCHMODE&&this.trnMain.VoucherType==e.Km.Repack&&this._trnMainService.getParentItemStock(this.activerowIndex),this.trnProd.BC||1===this.trnProd.HASVARIANT&&(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived||this.trnMain.VoucherType==e.Km.OpeningStockBalance||this.trnMain.VoucherType==e.Km.ProductionEntry||this.trnMain.VoucherType==e.Km.RequisitionEntry||this.trnMain.VoucherType==e.Km.Quotation||this.trnMain.VoucherType==e.Km.PurchaseOrder||this.trnMain.VoucherType==e.Km.SalesOrder)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this.trnProd.Mcat}&mcode=${this.trnProd.MCODE}`).subscribe(Me=>{"ok"==Me.status&&Me.result&&Me.result.length&&(this.matrixItemAtrribute=Me.result,this.matrixitemgrid.show())})}if(6===r.PTYPE&&this.trnMain.VoucherType===e.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex)),(this.trnMain.VoucherType==e.Km.TaxInvoice||this.trnMain.VoucherType==e.Km.Sales||this.trnMain.VoucherType==e.Km.PerformaSalesInvoice||this.trnMain.VoucherType==e.Km.SalesOrder||this.trnMain.VoucherType==e.Km.Quotation)&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1==this.userSetting.PRICEMODEINBILLING&&0==this.userSetting.EnableBatchWisePrice&&(this.trnMain.VoucherType===e.Km.PerformaSalesInvoice||this.trnMain.VoucherType===e.Km.Sales||this.trnMain.VoucherType===e.Km.TaxInvoice)&&this.assignWSRate(r),1==this.userSetting.LinkProductionwithconsumption&&"production-entry"==this.activeurlpath&&this.userSetting.Enableconsumtionbaseproductionrate&&(this.trnProd.ALTRATE=0,this.trnProd.PRATE=0,this.trnProd.RATE=0),this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=this._trnMainService.TrnMainObj.TRN_DATE,r.SHELFLIFE){let K=new Date(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE);K.setDate(K.getDate()+r.SHELFLIFE);let ie=(0,C.p6)(K,"yyyy-MM-dd","en-US");this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=ie}this.userSetting.EnableManualBatchinproduction?(setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},100),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])):(setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},100),this.activeRowEmit.emit(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]))}setTimeout(()=>{console.log("sett",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])},200)}else this.alertService.warning("Cannot enter duplicate item!")}FocusForBatchAdjustment(r){1==r?setTimeout(()=>{document.getElementById("sourcebc"+this.activerowIndex).focus()},200):0==r&&setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).focus()},200)}emitReferenceQuantity(){(this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this.trnMain.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this.trnMain.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this.trnMain.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice&&this.trnMain.REFORDBILL||this.trnMain.VoucherType===e.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this.trnProd.POSTOCK,RATE:this.trnProd.ALTRATE,BASEUNIT:this.trnProd.BASEUNIT})}dialougeOpen(){this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.dialog.open(Y.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this.trnMain.VoucherPrefix,mode:this.trnMain.Mode,warehouse:this.trnMain.MWAREHOUSE,message:this.trnProd,curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this.trnMain.ProdList,TrnMainObj:this.trnMain}}).afterClosed().subscribe(c=>{this.productLists=this.trnMain.VoucherType===e.Km.TaxInvoice||this.trnMain.VoucherType===e.Km.CreditNote||this.trnMain.VoucherType===e.Km.Quotation||this.trnMain.VoucherType===e.Km.DebitNote||this.trnMain.VoucherType===e.Km.PerformaSalesInvoice?c?.data:c&&c.data&&c.data.productColorList?c.data.productColorList:[],"VIEW"==this.trnMain.Mode.toUpperCase()?(this.trnProd.ProductDetails=this.productLists.productColorList,this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.trnProd.ALTERNATEQUANTIY=this.productLists.productColorList?this.productLists.productColorList.length:0):(this.trnProd.ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this.trnProd.ProductDetails,this.trnProd.ALTERNATEQUANTIY=this.productLists?this.productLists.length:0),this.trnMain.VoucherType===e.Km.BranchTransferOut&&this.calculateRateForTransferOut(c?.data),(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this.trnProd.ALTERNATEQUANTIY){if(this.trnMain.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this.trnProd.ITEMDESC} (${this.trnProd.MENUCODE}). Please Check Your Entry.`)}else console.log("hit here",this.trnMain.ProdList),this._trnMainService.ReCalculateBillWithNormal(),document.getElementById("rate"+this.activerowIndex).focus()},20)})}calculateRateForTransferOut(r){this.productLists=r,this.trnProd.ALTRATE=this.productLists[0].LANDINGCOST,this.trnProd.RATE=this.productLists[0].LANDINGCOST,this.trnProd.ALTERNATEQUANTIY=1,this.trnProd.BC=this.productLists[0].IEMI1,this.trnProd.AMOUNT=this.trnProd.ALTERNATEQUANTIY*this.trnProd.ALTRATE;for(let l=1;l<this.productLists?.length;l++){let c=(0,_.cloneDeep)(this.trnProd);c.ALTRATE=this.productLists[l].LANDINGCOST,c.RATE=this.productLists[l].LANDINGCOST,c.ALTERNATEQUANTIY=1,c.BC=this.productLists[l].IEMI1,c.AMOUNT=c.ALTERNATEQUANTIY*c.ALTRATE,this.trnMain.ProdList.push(c)}}checkMaxStockLevel(r){0!==this._trnMainService.nullToZeroConverter(this.indexedProd(r).MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)+this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this.indexedProd(r).MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this.indexedProd(r).MAXLEVEL+" exceeded !")}checkReorderStocklevel(r){var l=this._trnMainService.nullToZeroConverter(this.indexedProd(r).STOCK)-this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY);if(l<this._trnMainService.nullToZeroConverter(this.indexedProd(r).ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).MINLEVEL))return;if(l<this._trnMainService.nullToZeroConverter(this.indexedProd(r).MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this.indexedProd(r).MINLEVEL),1===this.indexedProd(r).MINWARN&&(this.indexedProd(r).ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).ROLEVEL))return;1===this.indexedProd(r).ROWARN&&this.alertService.warning("Re-Order level "+this.indexedProd(r).ROLEVEL+" has been reached !")}}}CancelCommand(){this.showBarCodeDetail=!1,this.trnProd.visible=!1}loadBarCodeRow(r){let c={IEMI1:"",IEMI2:""};c.MCODE=0===this.activerowIndex?"":this.trnProd.MCODE,c.Color="",0===this.activerowIndex?(this.indexedProd(0).ProductDetails=[],this.indexedProd(0).ProductDetails.push(c)):this.trnProd.ProductDetails.push(c),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(r){let l={IEMI1:"",IEMI2:""};l.MCODE=this.trnProd.MCODE,l.Color="",this.trnProd.ProductDetails.push(l),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(r){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this.indexedProd(this.barcodeWiseProductIndex).BASEQUANTITY=this.indexedProd(this.barcodeWiseProductIndex).ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}onApplyOldPriceClick(){let r={};if(1==this.userSetting.EnableBatchWisePrice&&(r=this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.CRATE_A))[0],console.log("INVALID UOM",r),r))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${r.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let r of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this.trnProd.Product.AltSellingPrices.find(l=>l.UNIT==r.UNIT).NRATE_A=r.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let r={};return r=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(l=>null==l.NRATE_A||0==l.NRATE_A)[0],!r||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${r.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(r,l){let c=0,u=0,y=0,K=this._trnMainService.priceChangeList[r];if(null!=K){if(K.UNIT==this.trnProd.BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this.trnProd.ISVAT){let ie=this._trnMainService.nullToZeroConverter(this.trnProd.RATE)+this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*this.userSetting.VATRate;K.NRATE_A<=ie&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)&&(y=this._trnMainService.nullToZeroConverter(this.trnProd.RATE)+this._trnMainService.nullToZeroConverter(this.trnProd.RATE)*(this.trnProd.RECRATE/100),K.NRATE_A<=y+y*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?(y=this.trnProd.RATE+this.trnProd.RATE*(this.trnProd.RECRATE/100),K.NRATE_A<=y&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):K.NRATE_A<this.trnProd.RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else c=this.trnProd.RATE,0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)&&(c=this.trnProd.RATE+this.trnProd.RATE*(this.trnProd.RECRATE/100)),K.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this.trnProd.ISVAT){let ie=this.trnProd.ALTRATE;if(u=ie+ie*this.userSetting.VATRate,K.NRATE_A<=u&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)){let Me=ie+ie*(this.trnProd.RECRATE/100);K.NRATE_A<=Me+Me*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?K.NRATE_A<=this.trnProd.ALTRATE+this.trnProd.ALTRATE*(this.trnProd.RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):K.NRATE_A<this.trnProd.ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else c=this.trnProd.ALTRATE/this.trnProd.ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this.trnProd.RECRATE)?K.NRATE_A<=c+c*(this.trnProd.RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):K.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(r),this.trnProd.SELLRATEBEFORETAX=1===this.trnProd.ISVAT?this._trnMainService.priceChangeList[r].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].NRATE_A,this.trnProd.W_SELLRATEBEFORETAX=1===this.trnProd.ISVAT?this._trnMainService.priceChangeList[r].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].WNRATE_A,this.trnProd.MRP=this._trnMainService.priceChangeList[r].NRATE_A,this.trnProd.W_MRP=this._trnMainService.priceChangeList[r].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this.trnMain.PODetailList[r].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].NRATE_A,this.trnMain.PODetailList[r].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].WNRATE_A)}changeSellingPrice(r){for(const l of this._trnMainService.priceChangeList)l.SNO>1&&(l.NRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].NRATE_A,l.WNRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].WNRATE_A)}checkDeuplicateCodeAndRate(){let r=[],l=this.trnMain.ProdList.filter(c=>c.MCODE==this.trnProd.MCODE);if(null!=l&&l.length>1){let c=0;for(let u of this.trnMain.ProdList)u.MCODE==this.trnProd.MCODE&&r.push(c),c++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableDiscount(){return this.trnMain.VoucherType!==e.Km.TaxInvoice&&this.trnMain.VoucherType!==e.Km.Sales&&57!=this.trnMain.VoucherType&&this.trnMain.VoucherType!=e.Km.CreditNote?(this.trnMain.VoucherType===e.Km.Purchase||this.trnMain.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this.trnMain.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this.trnMain.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this.trnMain?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkEnteredProductStock(r){let l=this.trnMain.ProdList.filter(c=>c.Quantity>c.STOCK&&7!=c.NATURETYPE&&c.PTYPE<10&&9!=c.PTYPE)[0];return null==l||(this.stopEnterPropagation(r),this.alertService.info(l.BASEUNIT!=l.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(l.STOCK)} ${l.BASEUNIT}, Item : ${l.ITEMDESC} @Qty = ${l.Quantity} ${l.BASEUNIT} (${l.ALTERNATEQUANTIY} x ${l.ALTCONFACTOR} = ${l.Quantity} ${l.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(l.STOCK)} ${l.BASEUNIT}, Item : ${l.ITEMDESC} @Qty = ${l.Quantity} ${l.BASEUNIT} `),this.trnProd.ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{this.focusAltQty()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1)}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(r){this.trnProd.BC=r.BARCODE,this.ItemBarCodeClick(this.activerowIndex,r)}validateCostPrice(){this.trnProd.ALTRATE>this.trnProd.SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling price")}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}ECSFocusOut(){this.applyPipeInECS=!0,this._trnMainService.ReCalculateBillWithNormal()}ECSValueChange(){this.trnProd.Quantity||(this.alertService.warning("Please Enter Product Quantity!!"),this.trnProd.ECSAMOUNT=0),this.trnProd.ECSAMOUNT>this.trnProd.GROSSAMNT&&(this.alertService.warning("ECS amount cannot be more than Gross Amount!!"),this.trnProd.ECSAMOUNT=0)}ECSFocusIn(){this.applyPipeInECS=!1}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(r,l){6!=this.indexedProd(r).PTYPE&&this.focusToRate(r,l)}ItemBarCodeFoucusOut(r,l){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(r,l){this.barcodeDisplay=!0}checkBatchWiseEnterStock(r){let l=0;return 1==this.userSetting.EnableVariantCategory&&1==this._trnMainService.TrnMainObj.ProdList[r].HASVARIANT?this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BC==this._trnMainService.TrnMainObj.ProdList[r].BC).forEach(c=>l+=c.Quantity):2==this._trnMainService.userSetting.EnableBatch?this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[r].BATCH&&c.PRATE==this._trnMainService.TrnMainObj.ProdList[r].PRATE).forEach(c=>l+=c.Quantity):this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[r].MCODE&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[r].BATCH).forEach(c=>l+=c.Quantity),l>this._trnMainService.TrnMainObj.ProdList[r].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.trnProd.ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(r){this.indexedProd(r).ALTRATE=this._trnMainService.nullToZeroConverter(this.indexedProd(r).INVRATE)*this._trnMainService.nullToZeroConverter(this.trnMain.EXRATE),this.indexedProd(r).REALRATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR,this.indexedProd(r).RATE=this.indexedProd(r).ALTRATE/this.indexedProd(r).ALTCONFACTOR,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(r){this.FCRATEChangeEvent(r),this.masterService.focusAnyControl("discountAmt"+r)}RecalculateMRP(){this.trnProd.SPRICE=1==this.trnProd.ISVAT?this.trnProd.MRP/1.13:this.trnProd.MRP}onTabMRP(r,l){r.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+l).focus()}RecalculateSPRICE(){this.trnProd.MRP=1==this.trnProd.ISVAT?1.13*this.trnProd.SPRICE:this.trnProd.SPRICE}onTabSPRICE(r,l){r.preventDefault(),null!=document.getElementById("VSRATE"+this.activerowIndex)?this.focusService.autoFocus(l,document.getElementById("SPRICE"+l),{}):0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}RecalculateVSRATE(){this.trnProd.VPRATE=(this.trnProd.ISVAT=1)?this.trnProd.VSRATE/1.13:this.trnProd.VSRATE}onTabVSRATE(r){r.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this.trnProd.VSRATE=1.13*this.trnProd.VPRATE}onTabVPRATE(r,l){r.preventDefault(),this.RecalculateSPRICE(),0==this.trnProd.REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,this._trnMainService.showCreditSalesAuth?this._trnMainService.showCreditSalesAuth=!1:1==this.userSetting.ENABLESINGLEBATCHMODE&&(this.trnProd.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal())}OrderComment(r){this.trnMain.VoucherType===e.Km.RequisitionEntry&&this.masterService.focusAnyControl("remarks"+r)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm(),1==this._trnMainService.showCreditSalesAuth&&this._trnMainService.CreditSalesAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this.trnMain.VoucherType===e.Km.BranchTransferIn||this.trnMain.VoucherType===e.Km.BranchTransferOut&&0==this.userSetting.AllowRateEditInTransferOut||this.trnMain.VoucherType===e.Km.StockIssue||1==this.masterService.disableQtyInStockIssueReturn||("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}focusAfterItemSelect(){2==this.userSetting.EnableBatch||this.trnMain.VoucherType==e.Km.BatchAdjustment?null!=document.getElementById("batch"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},20):(null!=document.getElementById("alternateunit"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),74===this.trnMain.VoucherType&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{this.focusAltQty()},20),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20))}itemFromBC(r){return 1==r&&1==this.loadFromBarcode}checkBatchSelectionInMultiplePrice(){return 1!=this.trnProd.HasMulitplePrice||1!=this.userSetting.EnableBatchWisePrice||!!this.trnProd.PriceSelected}checkQuantityInPOdeliveryMode(){7==this.trnProd.NATURETYPE&&1==this.userSetting.AllowQtyExceedInPo||null!=this.trnMain.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0]&&(this.alertService.info(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `:`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} )\n        exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `),this.trnProd.ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{this.focusAltQty()})}))}checkQuantityInSOLoadFromQT(){if(null!=this.trnMain.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0])return this.alertService.info(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT}\nexceed the item wise QT Quantity  ${this.trnProd.POSTOCK}\n${this.trnProd.BASEUNIT}\n`:`Item ${this.trnProd.ITEMDESC} Quantity ${this.trnProd.ALTERNATEQUANTIY}\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} )\n        exceed the item wise PO Quantity  ${this.trnProd.POSTOCK}\n        ${this.trnProd.BASEUNIT}\n        `),this.trnProd.ALTERNATEQUANTIY=this.trnProd.POSTOCK,void this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{this.focusAltQty()})})}checkQuantityInSOLoadFromQTin(){if(null!=this.trnMain.ProdList.filter(l=>l.Quantity<l.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this.trnProd.ALTERNATEQUANTIY=0,void this.focusAltQty()}checkSaleableQuantityInSalesOrder(){let r=this.trnProd,l=r.ALTUNIT==r.BASEUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTCONFACTOR;this.masterService.getSaleableQTY(r.MCODE,this.trnMain.DIVISION,this.trnMain.PhiscalID,this.trnMain.TRNDATE,this.trnMain.MWAREHOUSE,this.trnMain.VCHRNO).subscribe(c=>{if("ok"==c.status){let u=c.result[0].SALEABLE_SQTY;if(l>u)return 2==this.userSetting.EnableStockCheckInSO?(this._trnMainService.checkForUserMinusStockAuthorization()&&this.alertService.info("Entered qty is greater than its saleable qty:"+u),this._trnMainService.checkForUserMinusStockAuthorization()||(this._trnMainService.showNegativeBilling=!0,setTimeout(()=>{document.getElementById("AuthUserName").focus()},100))):(r.ALTERNATEQUANTIY=0,this.alertService.info("Entered qty is greater than its saleable qty:"+u),this.trnProd.ALTERNATEQUANTIY=0),this._trnMainService.ReCalculateBillWithNormal(),void this.alertService.emitShowHideSubject.subscribe(y=>{setTimeout(()=>{this.focusAltQty()},0)})}},c=>{this.alertService.info(c)})}checkQuantityInEditMode(){let r=this.trnMain.ProdList.filter(l=>l.Quantity<l.OUTQTY)[0];null!=r?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${r.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(r){this.trnProd.RATE=this.trnMain.VoucherType===e.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.ALTRATE=this.trnMain.VoucherType===e.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.RECRATE=r.RECRATE,this.trnProd.PORATE=this.trnMain.VoucherType===e.Km.SalesOrder?r.RATE:r.PRATE,this.trnProd.POSTOCK=0!==this.userSetting.ENABLE_SOINTI&&(this.trnMain.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this.trnMain.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this.trnMain.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this.trnMain.VoucherType===e.Km.PerformaSalesInvoice)?r.OPSTOCK:r.POSTOCK,this.trnMain.VoucherType===e.Km.SalesOrder&&(this._trnMainService.purchaseOrderQty=this.trnProd.POSTOCK)}assignOrderedDiscount(r){this.trnProd.INDDISCOUNT=r.INDDISCOUNT,this.trnProd.INDDISCOUNTRATE=r.INDDISCOUNTRATE,r.RATEDISCOUNT>0&&(this.trnProd.UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE))}clickOnNetAmount(r){this._trnMainService.nullToZeroConverter(this.trnProd.NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this.trnMain.VoucherType===e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(r)}changeONNetAmount(r,l){this.indexedProd(r).NETAMOUNT=this._trnMainService.nullToZeroConverter(l.target.value),this._trnMainService.nullToZeroConverter(this.trnProd.NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(r){if(r&&r?.length){let l=r.map(c=>c.ADJUSTQTY).reduce((c,u)=>c+u);this._trnMainService.nullToZeroConverter(l)>0&&(this.trnProd.ALTERNATEQUANTIY=l)}}checkRepackStock(){console.log("test item",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]);let r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&l.ROUTQTY>l.STOCK)[0];if(console.log("test prodStockObj",r),null!=r&&null!=r)return console.log("test prodStockObj",r),this.alertService.info(`Inserted Quantity of Repack Item: ${r.ITEMDESC} @Qty = (${r.Quantity} x ${this._trnMainService.nullToZeroConverter(r.CONFACTOR)} ${r.ALTUNIT}) = ${this._trnMainService.nullToZeroConverter(r.CONFACTOR)*r.Quantity} ${r.PUNIT} Is Greater Than Its Available Stock of Master Item: ${r.PDESCA} @Qty = ${this._trnMainService.nullToZeroConverter(r.TOTSTOCK)} ${r.PUNIT}`),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkItemQtyExceedBilledQty(){let r=0,l=this.trnProd.ALTERNATEQUANTIY;return r=this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?l:l*this.trnProd.ALTCONFACTOR,!(r<this.trnProd.BILLEDQTY)}checkItemStockINEditModeForOutQty(){let r={},l=0,c=this.trnProd.ALTERNATEQUANTIY;if(l=this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?c:c*this.trnProd.ALTCONFACTOR,"EDIT"!==this.trnProd.rowMode?.toUpperCase()&&l>this.trnProd.STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r;if("EDIT"===this.trnProd.rowMode?.toUpperCase()){let u=this.trnProd.BatchWiseEditList?.map(y=>y.INVOICEQTY).reduce((y,K)=>y+K,0);if(l-u>this.trnProd.STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(r=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},this.loader.hide(),"ok"==r.status?"ALLOW"==r.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,(this.trnMain.VoucherType==e.Km.Purchase||this.trnMain.VoucherType==e.Km.OpeningStockBalance)&&"EDIT"===this.trnProd.rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this.trnProd.ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this.trnProd.ITEMDESC} (${this.trnProd.MENUCODE}) ?`)&&(this.trnMain.ProdList.splice(this.activerowIndex,1),0===this.trnMain.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},r=>{this.loader.hide(),this.alertService.info(r)})}ValidateQuantityinEDITMode(){let r={},l=this._trnMainService.nullToZeroConverter(this.trnProd.EDITABLEQTY),c=this.trnProd.ALTERNATEQUANTIY,u=this.trnProd.BILLEDQTY,y=0;return this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?y=c:(y=c*this.trnProd.ALTCONFACTOR,u/=this.trnProd.ALTCONFACTOR),0==l&&this._trnMainService.nullToZeroConverter(this.trnProd.TOTALOUTWARDSTOCK)>0&&(console.log("stock",y,this.trnProd),y<this.trnProd.BILLEDQTY-this.trnProd.BSTOCK)?(r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n            ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT}) \n            ,Exceed the transaction qty (${this.trnProd.TOTALOUTWARDSTOCK}  ${this.trnProd.BASEUNIT}  ) ) `,r):l>0&&y<this.trnProd.TOTALOUTWARDSTOCK?(console.log("stock1",y,this.trnProd),r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n            ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT} \n            ,Exceed the transaction qty (${this.trnProd.TOTALOUTWARDSTOCK}  ${this.trnProd.BASEUNIT}   ) ) `,r):void 0}checkBCForMatrxiItem(){this.trnMain.VoucherType===e.Km.BatchAdjustment&&1==this.trnProd.HASVARIANT&&(this.trnProd.BC||this.alertService.warning(`Variant Details is not selected for Item :${this.trnProd.ITEMDESC} `))}ValidateQtyINEditModeFroProduction(r){let l=0;return l=r.BASEUNIT===r.ALTUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTERNATEQUANTIY,!(l<r.OUTQTY&&(this.alertService.info(`Item : ${r.ITEMDESC} entered Qty:${l} ${r.BASEUNIT} is less than transaction Qty:${r.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let r={},c=(this._trnMainService.nullToZeroConverter(this.trnProd.EDITABLEQTY),this.trnProd.ALTERNATEQUANTIY),u=this.trnProd.BILLEDQTY,y=0;if(this.trnProd.BASEUNIT==this.trnProd.ALTUNIT?y=c:(y=c*this.trnProd.ALTCONFACTOR,u/=this.trnProd.ALTCONFACTOR),y>this.trnProd.STOCK)return r.status=!1,r.userEnterQty=u,r.message=`Item(${this.trnProd.ITEMDESC}) entered qty (${this.trnProd.ALTERNATEQUANTIY})\n        ${this.trnProd.ALTUNIT} (${this.trnProd.ALTERNATEQUANTIY} x ${this.trnProd.ALTCONFACTOR} = ${this.trnProd.ALTCONFACTOR*this.trnProd.ALTERNATEQUANTIY} ${this.trnProd.BASEUNIT}) \n        ,Exceed the Stock qty (${this.trnProd.STOCK}  ${this.trnProd.BASEUNIT}  ) ) `,r}ValidateDuplicateItemEntry(r){let l=this.trnMain.VoucherType;if(l in e.NA){let c;return c=this.trnMain.ProdList.filter(u=>u.MENUCODE==r.MENUCODE),!(c.length>0&&80==l||c.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}if(l in e.$V||20==this._trnMainService.TrnMainObj.VoucherType||64==this._trnMainService.TrnMainObj.VoucherType){let c;return c=this._trnMainService.TrnMainObj.ProdList.filter(u=>u.MENUCODE==r.MENUCODE),!(1==this.userSetting.ENABLESINGLEBATCHMODE&&c.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(l=>"AllowQuantityApproval"==l.right)?.value}onUserRightReceived(r){this.alertService.success(r),this.authenticationPopup.hide(),this.trnMain.VoucherType==e.Km.RequisitionApproval&&(this.trnProd.isConfirmed=!0)}hoverDiscountt(r){this.hoverId=r,this.indexedProd(r).TotalDiscountDescription=this.productHelperService.hoverDiscount(r,this.indexedProd(r)),this.stringValue=this.productHelperService.hoverDiscount(r,this.indexedProd(r))}hoverLeaveDiscountt(r){this.hoverId=null}hoverIndDiscount(r){this.showHoverInd=!0,this.hoverIndId=r,this.rateValue=this.productHelperService.hoverIndDisRate(r,this.indexedProd(r))}hoverLeaveIndDiscount(){this.hoverIndId=null,this.showHoverInd=!1}ReadOnlyForDescription(r){return!(1==this.indexedProd(r).ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"production-entry"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"salesorder"==this.activeurlpath))}getSchemeDiscountForItem(r){this._trnMainService.getSchemeDiscount(r.MCODE,this.trnMain.DIVISION).subscribe(u=>{r.SchemeList="ok"==u.status?u.result:[]},u=>{})}hoverItemDesc(r){this.onHoverItemDesc=!0,this.hoverId=r,this.itemDescHoverValue=`<spam>Remarks: ${this.indexedProd(r).REMARKS}`}hoverLeaveItemDesc(r){this.hoverId=null,this.onHoverItemDesc=!1}hoverQty(r){this.qtyId=r,this.indexedProd(r),this.qtyValue=this.productHelperService.hoverQty(r,this.indexedProd(r)),this.trnMain.VoucherType==e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFBILL&&2==this.userSetting.EnablePIReferenceInTransferOut&&"EDIT"!=this._trnMainService.TrnMainObj.ProdList[r].rowMode?.toUpperCase()&&(this.qtyValue=this.productHelperService.hoverQtyForTO(r,this.indexedProd(r)),this.showtooltip=!0)}hoverLeaveQty(){this.qtyId=null,this.showtooltip=!1}hoverRate(r){!this.indexedProd(r).HASBATCH||(this.rateId=r,this.rateInnerHTML="<span>Rate changing option is disabled when Enable Batch Wise Price is turned on </span>")}hoverLeaveRate(r){!this.indexedProd(r).HASBATCH||(this.rateId=void 0,this.rateInnerHTML=void 0)}focusRateOrDiscount(){0==this.masterService.userProfile.userRights.find(l=>"AllowRateChangeInSO"==l.right)?.value||1==this.masterService.userSetting.EnableBatchWisePrice||1===this.trnProd.HASBATCH?document.getElementById("discountAmt"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus()}stopEnterPropagation(r){r instanceof KeyboardEvent&&"Enter"==r.key&&r.stopImmediatePropagation()}focusAltQty(r){console.log("focusAltQty hit",{index:r,activeRowIndex:this.activerowIndex}),r||(r=this.activerowIndex),document.getElementById("alternateQty"+r).focus()}validateItemQuantity(r,l){var c=!0;return 0==this.indexedProd(r).ALTERNATEQUANTIY?(this.stopEnterPropagation(l),this.alertService.warning(`Zero Quantity Detected for Item ${this.indexedProd(r).ITEMDESC} (${this.indexedProd(r).MENUCODE}). Please Check Your Entry.`),c=!1):0==this._trnMainService.nullToZeroConverter(this.indexedProd(r).ALTERNATEQUANTIY)&&(this.stopEnterPropagation(l),this.alertService.warning(`Qty Is Not Specified For The Item ${this.indexedProd(r).ITEMDESC} (${this.indexedProd(r).MENUCODE}). Please Check Your Entry.`),c=!1),c||this.alertService.emitShowHideSubject.subscribe(u=>{this.focusAltQty()}),c}emittedBatch(r){r&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r.batchName,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=r.mfgDate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=r.expDate,setTimeout(()=>{this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)},301))}toggleCreateBatch(){this.showCreateBatch=!this.showCreateBatch,setTimeout(()=>{this.masterService.focusAnyControl("BATCH"+this.activerowIndex)},300)}showCreateBatchFromPopup(){this.showCreateBatch=!0,this.model1Closed()}disableSalesPriceWOVAT(r){return!(2==this.userSetting.EnableBatch&&this._trnMainService.TrnMainObj.ProdList[r].enableSalesPrice||1==this.userSetting.EnableBatch&&0!=this.userSetting.VatExcludingRate)}readOnlyBatch(){return!(this.trnMain.VoucherType!==e.Km.ProductionEntry||!this.userSetting.EnableManualBatchinproduction)}disableSalesPriceWVAT(r){return 2==this.userSetting.EnableBatch||1!=this.userSetting.EnableBatch||1==this.userSetting.VatExcludingRate}showRateField(){return 90==this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.LogBasedRequisitionApproval||90!=this._trnMainService.TrnMainObj.VoucherType}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(U.P),t.Y36(z.p),t.Y36($.R),t.Y36(Z.uw),t.Y36(N.qu),t.Y36(f.gz),t.Y36(w.c),t.Y36(P.e),t.Y36(t.sBO),t.Y36(O.V),t.Y36(I.R),t.Y36(L.T),t.Y36(V.y),t.Y36(F.h),t.Y36(j.i),t.Y36(B.P))},m.\u0275cmp=t.Xpm({type:m,selectors:[["productentry"]],viewQuery:function(r,l){if(1&r&&(t.Gf(q.q,5),t.Gf(v.K,5),t.Gf(Ui,5),t.Gf(ft,5),t.Gf(Bi,5),t.Gf(Ot,5),t.Gf(Ki,5),t.Gf(Zi,5),t.Gf(Fi,5),t.Gf(Hi,5),t.Gf(bt,5),t.Gf(Ct,5),t.Gf(it,5),t.Gf(Je,5)),2&r){let c;t.iGM(c=t.CRH())&&(l.itemListChild=c.first),t.iGM(c=t.CRH())&&(l.batchlistChild=c.first),t.iGM(c=t.CRH())&&(l.genericGridSupplierPopup=c.first),t.iGM(c=t.CRH())&&(l.barCodeGridPopup=c.first),t.iGM(c=t.CRH())&&(l.discountPopup=c.first),t.iGM(c=t.CRH())&&(l.PetrolGrid=c.first),t.iGM(c=t.CRH())&&(l.genericGridMulitplePricePopup=c.first),t.iGM(c=t.CRH())&&(l.matrixitemgrid=c.first),t.iGM(c=t.CRH())&&(l.warehouseWiseStockPopup=c.first),t.iGM(c=t.CRH())&&(l.itemEditGrid=c.first),t.iGM(c=t.CRH())&&(l.authenticationPopup=c.first),t.iGM(c=t.CRH())&&(l.rateValidation=c.first),t.iGM(c=t.CRH())&&(l.genericGrid=c.first),t.iGM(c=t.CRH())&&(l.focusBatch=c.first)}},hostBindings:function(r,l){1&r&&t.NdJ("keydown",function(u){return l.updown(u)},!1,t.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit",activeRowEmit:"activeRowEmit",emitShowPopup:"emitShowPopup",activeRowEmitForEdit:"activeRowEmitForEdit"},decls:135,vars:130,consts:[[2,"margin-right","15px","position","relative",3,"ngClass"],[3,"ngClass"],[1,"wrapper","height-wrapper"],["id","productinserttable"],["id","prodlistTableheader",2,"background","silver","color","black","border-right","1px solid #b4b4b4","border-left","1px solid #b4b4b4"],[4,"ngIf"],["scope","col",2,"width","4%"],["style","width: 4%",4,"ngIf"],[3,"ngStyle"],["style","width: 190px",3,"ngStyle",4,"ngIf"],["style","width: 110px",4,"ngIf"],["style","width: 5%",4,"ngIf"],["style","width: 50px",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 100px",3,"ngStyle",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width: 100px",4,"ngIf"],["style","width: 120px",4,"ngIf"],["style","width: 60px",4,"ngIf"],["style","width: 95px",4,"ngIf"],["style","width: 10%",4,"ngIf"],["style","border: 1px",4,"ngFor","ngForOf"],["class","add",3,"disabled","click",4,"ngIf"],["class","PList","style","margin-top: 2%; height: 640px; width: 78%",4,"ngIf"],[3,"activeIndex","closeBatchPopupEvent","emitCreatedBatchEvent",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],[3,"rowIndex"],["discountPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["warehouseWiseStockPopup",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 370px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],["class","backdrop",4,"ngIf"],[2,"width","4%"],[2,"width","190px",3,"ngStyle"],[2,"width","110px"],[2,"width","5%"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","100px"],[2,"width","120px"],[2,"width","60px"],[2,"width","95px"],[2,"width","10%"],[2,"border","1px"],[2,"border","1px solid #b4b4b4","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #b4b4b4","width","20px",3,"id"],["style","width: 6%",4,"ngIf"],["style","width: 10%; border: 1px solid #b4b4b4",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","30%",3,"ngStyle","mouseover","mouseleave"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["style","height: 23px; border: 1px solid #b4b4b4; width: 5%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 6%",4,"ngIf"],["class","CellWithComment sourceBarCode",4,"ngIf"],["class","sourceBatchRate",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 4%",4,"ngIf"],["style","width: 100%; text-align: right","type","number",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 8%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",3,"id",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",3,"hidden",4,"ngIf"],["style","height:23px;border: 1px solid #b4b4b4; text-align: right;",3,"id",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",3,"change",4,"ngIf"],["id","amntId","style","\n            height: 23px;\n            border: 1px solid #b4b4b4;\n            background-color: #f9f9f9;\n            text-align: right;\n          ",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["id","vatvalue","style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 40px",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 100px",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 20%",4,"ngIf"],["id","mrpNoneditable","style","\n            height: 23px;\n            border: 1px solid #b4b4b4;\n            background-color: #f9f9f9;\n            text-align: right;\n          ",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center; width: 7%;",3,"id",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9; width: 7%;",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 12%",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center;",3,"id",4,"ngIf"],["style","width:2%;border: 1px solid #b4b4b4",4,"ngIf"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"disabled","click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"],[2,"width","6%"],[2,"width","10%","border","1px solid #b4b4b4"],["autocomplete","off","type","text",2,"width","100%",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"display","none",3,"ngClass","innerHTML"],[2,"height","23px","border","1px solid #b4b4b4","width","5%"],[2,"width","100%",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9"],["type","number",2,"width","100%","text-align","right",3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","6%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","readonly","ngModelChange","keydown.Tab","keydown","keydown.enter","focusout"],["focusBatch",""],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[1,"CellWithComment","sourceBarCode"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment","barCodeInput",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],["type","text",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","disabled","",2,"width","100%",3,"id","ngModel","ngModelChange"],[1,"sourceBatchRate"],["type","number",1,"batchRateInput",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.Enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["min","0","type","number","decimalPlacesRestriction","3",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","OnlyWholeNumber","ngModelChange","change","keydown.Tab","keydown.Enter","keypress","mouseover","mouseleave"],["type","number",2,"width","100%","text-align","right",3,"ngModel","disabled","ngModelChange"],["type","number","autocomplete","off",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange"],["type","text","autocomplete","off","placeholder","Please Enter to select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","8%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"id"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9",3,"hidden"],["min","0","type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout","mouseover","mouseleave"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right",3,"change"],["type","number","autocomplete","off",1,"CellWithComment",2,"height","23px","background-color","#f9f9f9","text-align","right",3,"id","ngModel","disabled","ngModelChange","focusout","focusin","keyup","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4"],["type","number","decimalPlacesRestriction","2",2,"width","100%","text-align","right",3,"id","ngModel","disabled","keydown","ngModelChange","focusout","mouseover","mouseleave"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id","mouseover","mouseleave"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","ngModelChange","keydown.tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.tab","keydown.enter"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","40px",3,"id"],["type","text",2,"width","3.5rem","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #b4b4b4","width","100px"],[3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","20%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange"],["type","number","autocomplete","off","readonly","",2,"width","80px","text-align","right",3,"id","ngModel","ngModelChange"],["id","mrpNoneditable",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center","width","7%",3,"id"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9","width","7%"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","12%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","keydown.Tab","keydown.enter","ngModelChange"],["selected",""],["type","text","autocomplete","off","disabled","true",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center",3,"id"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],[2,"width","2%","border","1px solid #b4b4b4"],[1,"add",3,"click"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81daac"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[3,"activeIndex","closeBatchPopupEvent","emitCreatedBatchEvent"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue","showCreateBatchEvent"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #b4b4b4","border-top","2px solid #b4b4b4","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #b4b4b4","max-height","25px"],[2,"border","1px solid #b4b4b4"],["style","border: 1px solid #b4b4b4",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #b4b4b4",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],[1,"backdrop"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem","bottom","85px"],["class","modal-title","style","padding-left: 5px",4,"ngIf"],["type","text","id","AuthUserName","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(r,l){1&r&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"table",3)(4,"tr",4),t.YNc(5,At,2,0,"th",5),t.TgZ(6,"th",6),t._uU(7,"S.No."),t.qZA(),t.YNc(8,Et,2,0,"th",5),t.ALo(9,"activeColumn"),t.YNc(10,It,2,0,"th",5),t.ALo(11,"activeColumn"),t.YNc(12,qe,2,0,"th",7),t.ALo(13,"activeColumn"),t.TgZ(14,"th",8),t._uU(15," Description "),t.qZA(),t.YNc(16,Pt,2,0,"th",5),t.YNc(17,yt,2,0,"th",5),t.YNc(18,xt,2,2,"th",9),t.ALo(19,"activeColumn"),t.TgZ(20,"th"),t._uU(21,"Unit"),t.qZA(),t.YNc(22,Rt,2,2,"th",9),t.YNc(23,Nt,2,0,"th",10),t.YNc(24,Lt,2,0,"th",10),t.YNc(25,wt,2,2,"th",9),t.YNc(26,nt,2,0,"th",11),t.YNc(27,Dt,2,0,"th",11),t.YNc(28,jt,2,0,"th",12),t.YNc(29,kt,2,0,"th",12),t.YNc(30,Vt,2,2,"th",9),t.YNc(31,Ut,2,2,"th",13),t.YNc(32,Bt,2,2,"th",13),t.YNc(33,Kt,2,2,"th",9),t.YNc(34,Zt,2,2,"th",9),t.YNc(35,Ft,2,3,"th",9),t.YNc(36,Ht,2,2,"th",9),t.YNc(37,Qt,2,3,"th",9),t.YNc(38,Gt,2,1,"th",10),t.ALo(39,"activeColumn"),t.YNc(40,qt,2,6,"th",14),t.ALo(41,"showColumn"),t.YNc(42,Wt,2,0,"th",10),t.YNc(43,$t,2,0,"th",15),t.YNc(44,zt,2,0,"th",10),t.ALo(45,"activeColumn"),t.YNc(46,Xt,2,0,"th",16),t.YNc(47,ei,2,0,"th",10),t.ALo(48,"activeColumn"),t.YNc(49,ti,2,4,"th",14),t.YNc(50,ii,2,0,"th",17),t.ALo(51,"activeColumn"),t.YNc(52,ni,2,0,"th",17),t.YNc(53,ri,2,0,"th",10),t.YNc(54,$e,2,0,"th",10),t.YNc(55,oi,2,0,"th",10),t.YNc(56,si,2,0,"th",10),t.YNc(57,ai,2,0,"th",18),t.ALo(58,"activeColumn"),t.YNc(59,ci,2,0,"th",17),t.ALo(60,"activeColumn"),t.YNc(61,li,2,0,"th",10),t.YNc(62,hi,2,0,"th",10),t.ALo(63,"showColumn"),t.YNc(64,di,2,0,"th",16),t.ALo(65,"showColumn"),t.YNc(66,ui,2,0,"th",5),t.YNc(67,pi,2,0,"th",5),t.YNc(68,_i,2,0,"th",5),t.YNc(69,Ti,2,0,"th",5),t.YNc(70,Mi,2,0,"th",5),t.YNc(71,mi,2,0,"th",5),t.YNc(72,Si,2,0,"th",5),t.YNc(73,vi,2,0,"th",19),t.YNc(74,gi,2,3,"th",13),t.ALo(75,"activeColumn"),t.YNc(76,fi,2,3,"th",13),t.ALo(77,"activeColumn"),t.YNc(78,Oi,2,0,"th",5),t.YNc(79,bi,2,0,"th",5),t.YNc(80,Ci,2,0,"th",5),t.YNc(81,Ai,2,0,"th",20),t.YNc(82,Ei,1,0,"th",5),t._UZ(83,"th"),t.qZA(),t.YNc(84,Vn,100,140,"tbody",21),t.qZA(),t.YNc(85,Un,3,2,"span",22),t.ALo(86,"hide"),t.qZA()()(),t.YNc(87,Kn,25,1,"div",5),t.YNc(88,Zn,2,1,"div",23),t.YNc(89,Fn,1,1,"create-manual-batch-popup",24),t.YNc(90,Hn,2,6,"div",25),t.YNc(91,Qn,2,1,"div",25),t.TgZ(92,"generic-popup-grid",26,27),t.NdJ("onItemDoubleClick",function(u){return l.dblClickPopupItem(u)}),t.qZA(),t.TgZ(94,"generic-popup-grid",26,28),t.NdJ("onItemDoubleClick",function(u){return l.dblClickPopupParty(u)}),t.qZA(),t._UZ(96,"app-discount-popup",29,30),t.TgZ(98,"barcode-popup-grid",26,31),t.NdJ("onItemDoubleClick",function(u){return l.dblClickbarcodePopUP(u)}),t.qZA(),t.TgZ(100,"multiple-price-popup-grid",26,32),t.NdJ("onItemDoubleClick",function(u){return l.dblClickPricePopUP(u)}),t.qZA(),t.TgZ(102,"matrix-item-grid",33,34),t.NdJ("onApplyClicked",function(u){return l.setVariantData(u)}),t.qZA(),t.TgZ(104,"batch-wise-item-edit",35,36),t.NdJ("onApplyClicked",function(u){return l.setBatchWiseEditData(u)}),t.qZA(),t.TgZ(106,"authentication-entry",37,38),t.NdJ("onUserRightReceived",function(u){return l.onUserRightReceived(u)}),t.qZA(),t._UZ(108,"popup-petrol",null,39)(110,"warehousewisestock",null,40),t.YNc(112,$n,39,5,"div",41),t.TgZ(113,"div")(114,"div",42,43)(116,"div",44)(117,"div",45)(118,"div",46)(119,"button",47),t.NdJ("click",function(){return l.onClickNo()}),t.TgZ(120,"span",48),t._uU(121,"\xd7"),t.qZA()()(),t.TgZ(122,"div",49)(123,"div",50)(124,"div",51),t._uU(125),t.qZA(),t.TgZ(126,"div",52)(127,"button",53),t.NdJ("click",function(){return l.onClickYes()}),t._uU(128," Yes "),t.qZA(),t.TgZ(129,"button",54),t.NdJ("click",function(){return l.onClickNo()}),t._uU(130," No "),t.qZA()()()()()()()(),t.YNc(131,zn,36,4,"div",5),t.YNc(132,Xn,2,2,"div",5),t.YNc(133,er,2,2,"div",5),t.YNc(134,nr,25,4,"div",55)),2&r&&(t.Q6J("ngClass",l.masterService.ShowMore?"":"classadded"),t.xp6(1),t.Q6J("ngClass",81==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType||74==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType?"inventorymngtclass2":""),t.xp6(4),t.Q6J("ngIf",l.approvalFlag),t.xp6(3),t.Q6J("ngIf",t.lcZ(9,85,"MENUCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(11,87,"BARCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(13,89,"HS_CODE")),t.xp6(2),t.Q6J("ngStyle",24==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType||5==l._trnMainService.TrnMainObj.VoucherType?t.DdM(124,rr):null)("ngStyle",8==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType?t.DdM(125,or):null)("ngStyle",89==l._trnMainService.TrnMainObj.VoucherType?t.DdM(126,sr):null)("ngStyle",80==l._trnMainService.TrnMainObj.VoucherType?t.DdM(127,ar):null),t.xp6(2),t.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",t.lcZ(19,91,"BATCH_HEADER")),t.xp6(4),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90!=l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableOtherUnitQtyInTI),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType&&0==l.userSetting.LogBasedRequisitionApproval),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",t.xi3(39,93,"FCRATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",t.lcZ(41,96,"showRateHeader")),t.xp6(2),t.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType||16==l._trnMainService.TrnMainObj.VoucherType||40==l._trnMainService.TrnMainObj.VoucherType||31==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==l._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.lcZ(45,98,"CONFACTOR")),t.xp6(2),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType||16===l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||73==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.lcZ(48,100,"ECSAmount")),t.xp6(2),t.Q6J("ngIf",(-1==t.DdM(128,Qi).indexOf(l._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=l.activeurlpath&&!l.userSetting.IsBBSM||90==l._trnMainService.TrnMainObj.VoucherType&&0===l.userSetting.LogBasedRequisitionApproval&&l.userSetting.IsBBSM)&&l._trnMainService.showFieldFromRight("Amt")),t.xp6(1),t.Q6J("ngIf",t.xi3(51,102,"DISCOUNT_AMT_HEADER",0)),t.xp6(2),t.Q6J("ngIf",(14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType||1==l._trnMainService.TrnMainObj.VoucherType||3==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||16==l._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=l.activeurlpath),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE||74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",t.xi3(58,105,"DISCOUNT_IMPORTPURCHASE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(60,108,"DISCOUNT_IMPORTPURCHASE",0)),t.xp6(2),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",t.lcZ(63,111,"showVATcolumn")),t.xp6(2),t.Q6J("ngIf",t.lcZ(65,113,"showNetAmtHeadercolumn")),t.xp6(2),t.Q6J("ngIf",(3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||31==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",l.approvalFlag),t.xp6(1),t.Q6J("ngIf","add-creditnote-itembase-approval"==l.activeurlpath||"add-stock-issue-approval"==l.activeurlpath||"transfer-out-approval"==l.activeurlpath||"stock-issue-approval"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",80==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",(19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||(5==l._trnMainService.TrnMainObj.VoucherType||81==l._trnMainService.TrnMainObj.VoucherType)&&1==l.userSetting.BATCHWISEPRICE||8==l._trnMainService.TrnMainObj.VoucherType)&&l._trnMainService.showFieldFromRight("MRP")),t.xp6(1),t.Q6J("ngIf",t.xi3(75,115,"MFGDATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(77,118,"EXPDATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",64==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||80==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",88==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.LinkProductionwithconsumption),t.xp6(2),t.Q6J("ngForOf",l._trnMainService.TrnMainObj.ProdList),t.xp6(1),t.Q6J("ngIf",t.xi3(86,121,"hideAddButton",l._trnMainService.callPipe)),t.xp6(2),t.Q6J("ngIf",l.isProductDetailView),t.xp6(1),t.Q6J("ngIf","itemList"==l.masterService.PlistTitle&&l.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf",l.showCreateBatch),t.xp6(1),t.Q6J("ngIf","Batch Price Selection"==l.masterService.PlistTitle||"Item Variant Selection"==l.masterService.PlistTitle||"Batch Selection"==l.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","partyPopUp"==l.masterService.PlistTitle),t.xp6(1),t.Q6J("popupsettings",l.gridPopupSettings),t.xp6(2),t.Q6J("popupsettings",l.gridPopupSettingsForSupplier),t.xp6(2),t.Q6J("rowIndex",l.activerowIndex),t.xp6(2),t.Q6J("popupsettings",l.barcodeGridSettings),t.xp6(2),t.Q6J("popupsettings",l.gridPopupSettingsForMultiplePrice),t.xp6(2),t.Q6J("activerowIndex",l.activerowIndex)("matrixItemAtrribute",l.matrixItemAtrribute),t.xp6(2),t.Q6J("BatchWiseEditList",l.BatchWiseEditList),t.xp6(8),t.Q6J("ngIf",l._trnMainService.showPriceChangeDetail&&1==l.userSetting.ShowPriceChangePopup),t.xp6(2),t.Q6J("config",t.DdM(129,cr)),t.xp6(11),t.hij(" ",l.rateValidationDisplayMessage," "),t.xp6(6),t.Q6J("ngIf",l.showDiscountAuth),t.xp6(1),t.Q6J("ngIf",l.showBatchPopup),t.xp6(1),t.Q6J("ngIf",l.showAdjustPopup),t.xp6(1),t.Q6J("ngIf",1==l._trnMainService.showNegativeBilling||1==l.userRightAuthService.showAuthPopup||l._trnMainService.showCreditSalesAuth))},dependencies:[k.oB,C.mk,C.sg,C.O5,C.PC,N.YN,N.Kr,N.Fj,N.wV,N.EJ,N.JJ,N.qQ,N.Fd,N.On,g.Zl,H.n,G.r,Ee,Ne.F,q.q,v.K,Re.H,we.j,S._v,Ke.ed,Ge.t,Ye.l,lt.m,ht.l,pt,_t.B,C.JJ,Tt.g,Mt,Vi.e,mt.w,St.R,vt.A,gt],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}",'table[_ngcontent-%COMP%] {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 13%;\n\n  }\n\n  .disabled-rate[_ngcontent-%COMP%]{\n    background: rgb(75, 78, 77);\n    line-height:19px !important;\n  }\n\n  th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n    padding: 8px;\n  }\n\n  th[_ngcontent-%COMP%] {\n    text-align: left;\n    background: #eee;\n    position: sticky;\n    top: 0px;\n  }\n\n .add[_ngcontent-%COMP%]{\n  color: #04AA6D;\n  border: 2px solid #04AA6D;\n  margin-top: 5px;\n}\n.add.disabled[_ngcontent-%COMP%] {\n  pointer-events: none;\n  color: gray; \n  cursor: not-allowed;\n}\nspan.add[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{\n  position: absolute;\n  left: 50%;\n  top:50%;\n  transform: translate(-50%, -50%);\n\n}\n  span.add[_ngcontent-%COMP%]{\n   display: inline-block;\n    width: 22px;\n    height: 22px;\n    text-align: center;\n    font-size: 20px;\n    font-family: "Roboto";\n    border-radius: 50%;\n    background: #FFF;\n    position: relative;\n    cursor: pointer;\n}\n.closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}\n\n .tooltiptext[_ngcontent-%COMP%] {\n    \n     visibility: hidden;\n    opacity:0;\n      text-align: center;\n    border-radius: 3px;\n    \n    right: 0;\n    font-size: 7px;\n    \n    align-items: center;\n    line-height: 2;\n    z-index: 99;\n    margin-top: -14px;\n    display: block;\n    width: 30px;\n    \n    position: relative;\n    color: #000;\n    white-space: nowrap;\n}\n\n.close-wrapper[_ngcontent-%COMP%]:hover   .tooltiptext[_ngcontent-%COMP%] {\n  visibility: visible;\n  opacity:1;\n}\n\n  \n    \n  \n   \n\n  .col1[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 10em;\n    left: 0em;\n    top: auto;\n  }\n\n  .col2[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 5em;\n    left: 10em;\n    top: auto;\n  }\n\n  .modal-footer[_ngcontent-%COMP%] {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n    cursor: pointer;\n    position: absolute;\n    top: 10px;\n    right: 10px;\n  }\n\n  .modal-backdrop[_ngcontent-%COMP%] {\n    display: none;\n  }',".modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 13px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n    padding: 3px;\n  }\n\n  thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 94%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    white-space: nowrap;\n  }\n\n  .close[_ngcontent-%COMP%] {\n    margin: -9px 0px -9px 0px;\n  }\n\n  .highlighted[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n  .bgforlessstockitem[_ngcontent-%COMP%] {\n    background-color: #ffc107d2;\n  }"]}),m})()},32635:(pe,ne,E)=>{E.d(ne,{j:()=>Ni});var t=E(66274),e=E(42326),g=E(28698),v=E(37051),q=E(82484),Y=E(27009),S=E(64752),Q=E(71732),C=E(92340),_=E(53074),B=E(87584),U=E(69389),z=E(53181),$=E(7587),Z=E(48083),N=E(67311),f=E(67297),w=E(14970),P=E(74263),O=E(60694),I=E(7782),L=E(33612),V=E(71800),F=E(92752),j=E(98692),k=E(64657);const H=["inputBox"];function G(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"tbody",10),t.NdJ("dblclick",function(){const M=t.CHM(a).$implicit,x=t.oxw();return t.KtG(x.dblClickItemList(M))}),t.TgZ(1,"tr",11)(2,"td",12),t._uU(3),t.qZA(),t.TgZ(4,"td",13),t._uU(5),t.qZA(),t.TgZ(6,"td",13),t._uU(7),t.qZA(),t.TgZ(8,"td",13),t._uU(9),t.qZA()()()}if(2&R){const a=J.$implicit,d=J.index,h=t.oxw();t.ekj("active",d==h.selectedRow),t.xp6(3),t.Oqu(a.schemeName),t.xp6(2),t.Oqu(a.schemeType),t.xp6(2),t.Oqu(2==a.discountRateType?"Buy "+a.minQty+"Get "+a.schemeDisRate+" free":a.schemeDisRate),t.xp6(2),t.Oqu(0==a.discountRateType?"%":1==a.discountRateType?"Amount":2==a.discountRateType?"Quantity":"Type Not Found")}}let ee=(()=>{class R{constructor(a,d){this.masterService=a,this._trnMainService=d,this.dbClickEvent=new t.vpe,this.schemeCloseClick=new t.vpe,this.schemeList=[],this.title="Available Active Schemes on Item"}ngAfterViewInit(){}ngOnInit(){}SearchList(a){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(a){this.dbClickEvent.emit(a)}schemeListClosed(){this.schemeCloseClick.emit()}}return R.\u0275fac=function(a){return new(a||R)(t.Y36(_.P),t.Y36(B.p))},R.\u0275cmp=t.Xpm({type:R,selectors:[["PSalesSchemeList"]],viewQuery:function(a,d){if(1&a&&t.Gf(H,5),2&a){let h;t.iGM(h=t.CRH())&&(d._el=h.first)}},inputs:{schemeList:"schemeList"},outputs:{dbClickEvent:"dbClickEvent",schemeCloseClick:"schemeCloseClick"},decls:20,vars:2,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"active","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(a,d){1&a&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),t.NdJ("click",function(){return d.schemeListClosed()}),t.TgZ(4,"span",3),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",4),t._uU(7),t.qZA()(),t.TgZ(8,"div",5)(9,"table",6)(10,"tr",7)(11,"th",8),t._uU(12,"Scheme Name"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Scheme Type"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Discount"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Dis. Type"),t.qZA()(),t.YNc(19,G,10,6,"tbody",9),t.qZA()()()()),2&a&&(t.xp6(7),t.Oqu(d.title),t.xp6(12),t.Q6J("ngForOf",d.schemeList))},dependencies:[F.sg],encapsulation:2}),R})();var de=E(59963),be=E(65171),Oe=E(32711),Ee=E(87454),Ne=E(86857),Re=E(94619),we=E(14173),Ke=E(89952);const Ge=["genericGridSupplierPopup"],Ye=["barCodeGridPopup"],lt=["PetrolGrid"],ht=["genericGridMulitplePricePopup"],dt=["matrixitemgrid"],ut=["itemEditGrid"],pt=["authenticationPopup"],_t=["rateValidatoin"],Tt=["genericGrid"],Mt=["focusBatch"];function Vi(R,J){1&R&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function mt(R,J){1&R&&(t.TgZ(0,"th"),t._uU(1,"Code"),t.qZA())}function St(R,J){1&R&&(t.TgZ(0,"th"),t._uU(1,"Barcode"),t.qZA())}const vt=function(){return{width:"10%"}};function gt(R,J){if(1&R&&(t.TgZ(0,"th",47),t._uU(1,"BatchNo"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",89==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,vt):null)}}function Ui(R,J){1&R&&(t.TgZ(0,"th",48),t._uU(1," Quantity"),t.qZA())}const ft=function(){return{width:"15%"}},Bi=function(){return{width:"20%"}},Ot=function(){return{width:"8%"}};function Ki(R,J){if(1&R&&(t.TgZ(0,"th",49),t._uU(1," Rate"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",19==a._trnMainService.TrnMainObj.VoucherType||8==a._trnMainService.TrnMainObj.VoucherType?t.DdM(3,ft):null)("ngStyle",7==a._trnMainService.TrnMainObj.VoucherType?t.DdM(4,Bi):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?t.DdM(5,Ot):null)}}function Zi(R,J){1&R&&(t.TgZ(0,"th",50),t._uU(1,"MRP"),t.qZA())}function Fi(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"FC P.Rate"),t.qZA())}function Hi(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"P.Rate"),t.qZA())}function bt(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"Amount"),t.qZA())}function Ct(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"Con.Factor"),t.qZA())}function it(R,J){1&R&&(t.TgZ(0,"th",52),t._uU(1," Amt"),t.qZA())}function Je(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"ECS"),t.qZA())}function At(R,J){1&R&&(t.TgZ(0,"th",53),t._uU(1," Dis%"),t.qZA())}function Et(R,J){1&R&&(t.TgZ(0,"th",54),t._uU(1,"Dis Amt"),t.qZA())}function It(R,J){1&R&&(t.TgZ(0,"th",55),t._uU(1,"Total Disc"),t.qZA())}const qe=function(){return{width:"6.5%"}};function Pt(R,J){if(1&R&&(t.TgZ(0,"th",49),t._uU(1," Amt"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",8==a._trnMainService.TrnMainObj.VoucherType||15==a._trnMainService.TrnMainObj.VoucherType||1==a._trnMainService.TrnMainObj.VoucherType||7==a._trnMainService.TrnMainObj.VoucherType?t.DdM(2,qe):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Ot):null)}}function yt(R,J){1&R&&(t.TgZ(0,"th",53),t._uU(1," Dis%"),t.qZA())}function ke(R,J){1&R&&(t.TgZ(0,"th",54),t._uU(1,"Dis Amt "),t.qZA())}function xt(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"S.Charge"),t.qZA())}function Rt(R,J){1&R&&(t.TgZ(0,"th",51),t._uU(1,"VAT"),t.qZA())}function Nt(R,J){1&R&&(t.TgZ(0,"th",52),t._uU(1," Net Amt"),t.qZA())}function Lt(R,J){1&R&&(t.TgZ(0,"th"),t._uU(1," Net Rate"),t.qZA())}function wt(R,J){1&R&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}const nt=function(){return{width:"130px"}};function Dt(R,J){if(1&R&&(t.TgZ(0,"th",5),t._uU(1,"Mfg Date "),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,qe):t.DdM(2,nt))}}function jt(R,J){if(1&R&&(t.TgZ(0,"th",5),t._uU(1,"Exp Date "),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,qe):t.DdM(2,nt))}}function kt(R,J){1&R&&(t.TgZ(0,"th",56),t._uU(1,"Remarks"),t.qZA())}function Be(R,J){if(1&R&&(t.TgZ(0,"td",88),t._uU(1),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",a.MENUCODE," ")}}function Vt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",89)(1,"input",90),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.BC=h)})("keydown.Tab",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.ItemBarCodeClick(M,h))})("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.ItemBarCodeClick(M,h))})("keydown.enter",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.ItemBarCodeClick(M,h))})("focusout",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.ItemBarCodeFoucusOut(M,h))})("focus",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.ItemBarCodeClickFocusIn(M,h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","barcode",d,""),t.Q6J("ngModel",h.BC)("readonly","VIEW"==h.rowMode)("disabled",M.disableBarcodeField(d))}}function Ut(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",91)(1,"input",92,93),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.BATCH=h)})("keydown.Tab",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.BatchTabClick(M,h))})("keydown",function(h){t.CHM(a);const M=t.oxw(2);return t.KtG(M.onKeydownOnBatch(h))})("keydown.enter",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.BatchEnter(M,h))}),t.qZA(),t.TgZ(3,"span",64),t._uU(4,"press ENTER or TAB to Select Batch"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","batch",d,""),t.Q6J("ngModel",h.BATCH)("disabled",M.disableBatch(h))}}function Bt(R,J){if(1&R&&(t.ynx(0),t.TgZ(1,"option",97),t._uU(2),t.qZA(),t.BQk()),2&R){const a=J.$implicit;t.xp6(1),t.s9C("value",a.ALTUNIT),t.xp6(1),t.Oqu(a.ALTUNIT)}}function Kt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",94)(1,"select",95),t.NdJ("change",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.SelectUnit(h))})("keydown.Tab",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.AlternateUnitEnterEventClick(M,h))})("keydown.enter",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.AlternateUnitEnterEventClick(M,h))})("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.ALTUNIT=h)}),t.YNc(2,Bt,3,2,"ng-container",96),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","alternateunit",d,""),t.Q6J("ngModel",h.ALTUNIT)("disabled",M.disableAltUnit(d)),t.xp6(1),t.Q6J("ngForOf",null==h.Product?null:h.Product.AlternateUnits)}}function Ze(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",98)(1,"input",99),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.ALTERNATEQUANTIY=h)})("ngModelChange",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.QuantityChangeEvent(h))})("keydown.Tab",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.focusToRate(M,h))})("focusout",function(h){t.CHM(a);const M=t.oxw(2);return t.KtG(M.quantityFocusOut(h))})("keydown.Enter",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.AlternateQuantityEventClick(M,h))})("keyup",function(h){t.CHM(a);const M=t.oxw(2);return t.KtG(M.quantityChange(h))})("keypress",function(h){t.CHM(a);const M=t.oxw(),x=M.$implicit,X=M.index,re=t.oxw();return t.KtG(6==x.PTYPE&&1!=x.isPurchaseOrder?re.AlternateQuantityEventClick(X,h):re.return)}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","alternateqty",d,""),t.Q6J("ngModel",h.ALTERNATEQUANTIY)("readonly",h.isQuantityReadonly)("disabled",M.disableAltQty(d)||M.disableRequestQTY(d))}}function Zt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",100)(1,"input",101),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.INVRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.FCRATEChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.fcrateEnterEvent(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.fcrateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","fcrate",d,""),t.Q6J("ngModel",h.INVRATE)("disabled",M._trnMainService.disableRateOnPOselect)}}function Ft(R,J){if(1&R&&(t.TgZ(0,"td",102),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","grossamnt",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,M._trnMainService.nullToZeroConverter(h.GROSSAMNT))," ")}}function Ht(R,J){if(1&R&&(t.TgZ(0,"td",103),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","amount",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,M._trnMainService.nullToZeroConverter(h.AMOUNT)),"")}}function Qt(R,J){if(1&R&&(t.TgZ(0,"td",103),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","confactor",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,M._trnMainService.nullToZeroConverter(h.ALTCONFACTOR)),"")}}function Gt(R,J){if(1&R&&(t.TgZ(0,"td",104),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.ECSAMOUNT)," ")}}function Yt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",106,107),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.INDDISCOUNTRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.IndDiscountRateChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discRateEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discRateEnterClicked(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","discount",d,""),t.Q6J("ngModel",h.INDDISCOUNTRATE)("readonly",M.disableDiscount())("disabled","VIEW"==h.rowMode||M.disableRAteDisandAmt()||1==M._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||null!=M._trnMainService.TrnMainObj.DCRATE&&0!=M._trnMainService.TrnMainObj.DCRATE&&16!==M._trnMainService.TrnMainObj.VoucherType||null!=M._trnMainService.TrnMainObj.FLATDCAMNT&&0!=M._trnMainService.TrnMainObj.FLATDCAMNT&&16!==M._trnMainService.TrnMainObj.VoucherType||M._trnMainService.disableOnPerFormaSelect||15==M._trnMainService.TrnMainObj.VoucherType&&0==M._trnMainService.TrnMainObj.DOFULLRETURN&&0==M._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&M._trnMainService.TrnMainObj.REFBILL&&0==M._trnMainService.userSetting.ENABLEMANUALSALESRETURN)}}function Jt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",108),t.NdJ("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.IndDiscountAmountChangeEvent(M,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))})("click",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.DisAmtclick())}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","discountAmt",d,""),t.Q6J("readonly",M.disableDiscount())("ngModel",t.lcZ(2,4,M._trnMainService.nullToZeroConverter(h.INDDISCOUNT)))("disabled","VIEW"==h.rowMode||M.disableRAteDisandAmt()||1==M._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||M._trnMainService.disableOnGRNload||null!=M._trnMainService.TrnMainObj.DCRATE&&0!=M._trnMainService.TrnMainObj.DCRATE&&16!==M._trnMainService.TrnMainObj.VoucherType||null!=M._trnMainService.TrnMainObj.FLATDCAMNT&&0!=M._trnMainService.TrnMainObj.FLATDCAMNT&&16!==M._trnMainService.TrnMainObj.VoucherType||M._trnMainService.disableOnPerFormaSelect||15==M._trnMainService.TrnMainObj.VoucherType&&0==M._trnMainService.TrnMainObj.DOFULLRETURN&&0==M._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&M._trnMainService.TrnMainObj.REFBILL&&0==M._trnMainService.userSetting.ENABLEMANUALSALESRETURN)}}const qt=function(R){return{tooltipChild:R}};function Wt(R,J){if(1&R&&(t.ynx(0),t.TgZ(1,"span",110)(2,"b"),t._uU(3,"Indv Discount "),t.qZA(),t._uU(4),t.ALo(5,"twoDigitNumber"),t._UZ(6,"br"),t.TgZ(7,"b"),t._uU(8,"Flat Dsicount"),t.qZA(),t._uU(9),t.ALo(10,"twoDigitNumber"),t.qZA(),t.BQk()),2&R){const a=t.oxw(2),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(7,qt,M.hoverId==d)),t.xp6(3),t.hij(" : ",t.lcZ(5,3,h.INDDISCOUNT)," "),t.xp6(5),t.hij(" : ",t.lcZ(10,5,h.FLATDISCOUNT)," ")}}function $t(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",109),t.NdJ("mouseover",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.hoverDiscount(h))})("mouseleave",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.hoverLeaveDiscount(h))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.YNc(3,Wt,11,9,"ng-container",3),t.qZA()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","totalDisc",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,3,M._trnMainService.nullToZeroConverter(h.DISCOUNT))," "),t.xp6(2),t.Q6J("ngIf",h.DISCOUNT>0)}}function zt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",111),t.NdJ("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.IndDiscountAmountChangeOfRetailerVATINCEvent(M,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))}),t.ALo(2,"number"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","discountAmtVATInclusiveForretailer",d,""),t.Q6J("ngModel",t.xi3(2,3,M._trnMainService.nullToZeroConverter(h.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==h.rowMode||h.isPurchaseOrderItem)}}function Xt(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",112),t.NdJ("change",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.MRPChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.mrpEnterEvent(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.mrpEnterEvent(h))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()}if(2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function ei(R,J){if(1&R&&(t.TgZ(0,"td",113),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function We(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",106,107),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.INDDISCOUNTRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.IndDiscountRateChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discRateEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discRateEnterClicked(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","discount",d,""),t.Q6J("ngModel",h.INDDISCOUNTRATE)("readonly",M._trnMainService.disableProd||M.disableDiscount())("disabled","VIEW"==h.rowMode||M.disableRAteDisandAmt()||1==M._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem)}}function ti(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",108),t.NdJ("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.IndDiscountAmountChangeEvent(M,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.discEnterClicked(h))})("click",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.DisAmtclick())}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","discountAmti",d,""),t.Q6J("readonly",M.disableDiscount())("ngModel",t.lcZ(2,4,M._trnMainService.nullToZeroConverter(h.INDDISCOUNT)))("disabled","VIEW"==h.rowMode||M.disableRAteDisandAmt()||1==M._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem)}}function ii(R,J){if(1&R&&(t.TgZ(0,"td",114),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.SERVICETAX)),"")}}function ni(R,J){if(1&R&&(t.TgZ(0,"td",115),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.VAT)),"")}}function ri(R,J){if(1&R&&(t.TgZ(0,"td",102),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","netamount",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,M._trnMainService.nullToZeroConverter(h.NETAMOUNT)),"")}}function $e(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",102)(1,"input",116),t.NdJ("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw();return t.KtG(x.changeONNetAmount(M,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.clickOnNetAmount(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.clickOnNetAmount(h))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","netamount",d,""),t.xp6(1),t.MGl("id","netamounteditable",d,""),t.Q6J("ngModel",t.lcZ(2,4,M._trnMainService.nullToZeroConverter(h.NETAMOUNT)))("disabled","VIEW"==h.rowMode)}}function oi(R,J){if(1&R&&(t.TgZ(0,"td",117),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.MGl("id","mrp",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,M._trnMainService.nullToZeroConverter(h.CRATE))," ")}}function si(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",118)(1,"select",119),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.IsApproveStockSettlement=h)}),t.TgZ(2,"option",97),t._uU(3,"Approved "),t.qZA(),t.TgZ(4,"option",97),t._uU(5,"Not Approved"),t.qZA()()()}if(2&R){const a=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",a.IsApproveStockSettlement),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function ai(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",120)(1,"input",121),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.MFGDATE=h)})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.MFGDateEnterEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.MFGDateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","mfgdate",d,""),t.s9C("type",M.mfgExpDateType),t.Q6J("ngModel",h.MFGDATE)("disabled","VIEW"==h.rowMode||h.isDisabled||h.isPurchaseOrderItem||"stock-issue-approval"==M.activeurlpath||M._trnMainService.disableOnGRNload||null!=h.BATCH&&1==h.REQEXPDATE&&5==M._trnMainService.TrnMainObj.VoucherType||7==M._trnMainService.TrnMainObj.VoucherType)}}function ci(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",120)(1,"input",122),t.NdJ("change",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.onChangeExpDate())})("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.EXPDATE=h)})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.expDateEnterEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,M=t.oxw();return t.KtG(M.expDateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw();t.xp6(1),t.MGl("id","expdate",d,""),t.s9C("type",M.mfgExpDateType),t.Q6J("ngModel",h.EXPDATE)("disabled","VIEW"==h.rowMode||h.isDisabled||h.isPurchaseOrderItem||"stock-issue-approval"==M.activeurlpath||M._trnMainService.disableOnGRNload||null!=h.BATCH&&1==h.REQEXPDATE&&5==M._trnMainService.TrnMainObj.VoucherType||7==M._trnMainService.TrnMainObj.VoucherType)}}function li(R,J){if(1&R&&(t.TgZ(0,"td",123),t._uU(1),t.ALo(2,"date"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij("",t.xi3(2,1,a.MFGDATE,"dd-MM-yyyy")," ")}}function hi(R,J){if(1&R&&(t.TgZ(0,"td",124),t._uU(1),t.ALo(2,"date"),t.qZA()),2&R){const a=t.oxw(),h=a.$implicit;t.MGl("id","expdate",a.index,""),t.xp6(1),t.hij("",t.xi3(2,2,h.EXPDATE,"dd-MM-yyyy")," ")}}const di=function(){return{width:"22%"}};function ui(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"tbody",57)(1,"tr",58),t.NdJ("click",function(){const M=t.CHM(a).index,x=t.oxw();return t.KtG(x.RowClick(M))})("keydown.Shift.delete",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.deleteRow())}),t.TgZ(2,"td",59),t._uU(3),t.qZA(),t.YNc(4,Be,2,1,"td",60),t.YNc(5,Vt,2,4,"td",61),t.TgZ(6,"td",62)(7,"input",63),t.NdJ("ngModelChange",function(h){const x=t.CHM(a).$implicit;return t.KtG(x.ITEMDESC=h)})("keydown.enter",function(h){const x=t.CHM(a).index,X=t.oxw();return X.ItemkeyEvent(x,h),t.KtG(X.displayProductDetailInViewMode(X.event))})("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onClicked())}),t.qZA(),t.TgZ(8,"span",64),t._uU(9,"Press ENTER to Select Item"),t.qZA(),t.ynx(10),t._UZ(11,"br")(12,"span",65),t.BQk(),t.qZA(),t.YNc(13,Ut,5,3,"td",66),t.YNc(14,Kt,3,4,"td",67),t.YNc(15,Ze,2,4,"td",68),t.YNc(16,Zt,2,3,"td",69),t.TgZ(17,"td",70)(18,"input",71),t.NdJ("ngModelChange",function(h){const x=t.CHM(a).$implicit;return t.KtG(x.ALTRATE=h)})("change",function(){const h=t.CHM(a),M=h.$implicit,x=h.index,X=t.oxw();return t.KtG(X.MRPChangeEvent(M,x))})("keydown.Tab",function(){const h=t.CHM(a),M=h.$implicit,x=h.index,X=t.oxw();return t.KtG(X.mrpEnterEvent(M,x))})("keydown.enter",function(){const h=t.CHM(a),M=h.$implicit,x=h.index,X=t.oxw();return t.KtG(X.mrpEnterEvent(M,x))})("keyup",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.rateChange(h))})("focusout",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.rateFocusOut(h))}),t.ALo(19,"twoDigitNumber"),t.qZA()(),t.YNc(20,Ft,3,4,"td",72),t.YNc(21,Ht,3,4,"td",73),t.YNc(22,Qt,3,4,"td",73),t.YNc(23,Gt,3,3,"td",74),t.YNc(24,Yt,3,4,"td",75),t.YNc(25,Jt,3,6,"td",75),t.YNc(26,$t,4,5,"td",76),t.YNc(27,zt,3,6,"td",77),t.YNc(28,Xt,3,3,"td",78),t.YNc(29,ei,3,3,"td",79),t.YNc(30,We,3,4,"td",75),t.YNc(31,ti,3,6,"td",75),t.YNc(32,ii,3,3,"td",80),t.YNc(33,ni,3,3,"td",81),t.YNc(34,ri,3,4,"td",82),t.YNc(35,$e,3,6,"td",82),t.YNc(36,oi,3,4,"td",83),t.YNc(37,si,6,3,"td",84),t.YNc(38,ai,2,4,"td",85),t.YNc(39,ci,2,4,"td",85),t.YNc(40,li,3,4,"td",86),t.YNc(41,hi,3,5,"td",87),t.qZA()()}if(2&R){const a=J.$implicit,d=J.index,h=t.oxw();t.xp6(1),t.ekj("selected",h.isTableRowSelected(d))("highlighted",d+1==h.highlightBarCodeWiseRow())("bgforlessstockitem",h.highlightLessStockItem(d)),t.xp6(1),t.MGl("id","sno",d,""),t.xp6(1),t.Oqu(d+1),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("BARCODE_HEADER",d)),t.xp6(1),t.Q6J("ngStyle",3==h._trnMainService.TrnMainObj.VoucherType||89==h._trnMainService.TrnMainObj.VoucherType||74==h._trnMainService.TrnMainObj.VoucherType||31==h._trnMainService.TrnMainObj.VoucherType?t.DdM(49,di):null),t.xp6(1),t.MGl("id","itemDesc",d,""),t.Q6J("readonly",h.ReadOnlyForDescription(d))("ngModel",a.ITEMDESC)("disabled",h.disableItemDesc(d)||h.disableGridForReqApproval(d)),t.xp6(5),t.Q6J("innerHtml",a.VARIANTDESCA,t.oJD),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("BATCH_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("UNIT_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("QUANTITY_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("FCRATE_EDITABLE",0)),t.xp6(1),t.Q6J("hidden",89==h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.MGl("id","rate",d,""),t.Q6J("ngModel",h.applyPipeInRate?t.lcZ(19,47,a.ALTRATE):a.ALTRATE)("disabled",h.disableRateandDiscount(d))("readonly",h.disableRate()),t.xp6(2),t.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16==h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType||57==h._trnMainService.TrnMainObj.VoucherType||64==h._trnMainService.TrnMainObj.VoucherType||73==h._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("CONFACTOR",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("ECS_AMOUNT",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_PER_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16===h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE_VATINCLU",d)),t.xp6(1),t.Q6J("ngIf",14!==h._trnMainService.TrnMainObj.VoucherType&&16!==h._trnMainService.TrnMainObj.VoucherType&&57!=h._trnMainService.TrnMainObj.VoucherType&&64!=h._trnMainService.TrnMainObj.VoucherType&&74!=h._trnMainService.TrnMainObj.VoucherType&&89!=h._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=h.activeurlpath&&3!=h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",6===h.pType),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",d)),t.xp6(1),t.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType&&1==h.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("GST_AMT_NONEDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.showNetAmtNonEditable()),t.xp6(1),t.Q6J("ngIf",h.showNetAmtEditable()),t.xp6(1),t.Q6J("ngIf",(3==h._trnMainService.TrnMainObj.VoucherType||37==h._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=h._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",h.approvalFlag),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MFGDATE_EDITABLE",d)&&"consumption-entry"!==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("EXPDATE_EDITABLE",d)&&"consumption-entry"!==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MFGDATE_NONEDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("EXPDATE_NONEDITABLE",d))}}function pi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"tr",133),t.NdJ("click",function(){const M=t.CHM(a).$implicit,x=t.oxw(2);return t.KtG(x.selectProductDetails(M))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&R){const a=J.$implicit;t.xp6(2),t.Oqu(a.color),t.xp6(2),t.Oqu(a.size),t.xp6(2),t.Oqu(a.imeI1),t.xp6(2),t.Oqu(a.imeI2)}}function _i(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",125)(2,"div",126)(3,"div")(4,"div")(5,"div",127)(6,"h4",128),t._uU(7,"Product Details"),t.qZA(),t.TgZ(8,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeProductDetails())}),t.TgZ(9,"span",40),t._uU(10,"\xd7"),t.qZA()()(),t.TgZ(11,"div",129)(12,"table",130)(13,"thead")(14,"tr",131)(15,"th"),t._uU(16,"Color Group"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Size Group"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"IMEI 1"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"IMEI 2"),t.qZA()()(),t.TgZ(23,"tbody"),t.YNc(24,pi,9,4,"tr",132),t.qZA()()()()()()()()}if(2&R){const a=t.oxw();t.xp6(24),t.Q6J("ngForOf",a.selectedProductDetails)}}function Ti(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div",134)(1,"PItemList",135),t.NdJ("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.dblClickPopupItem(h))})("itemCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.model1Closed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("title",a.masterService.PlistTitle)}}function Mi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"PBatchList",137),t.NdJ("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.dblClickPopupBatch(h))})("BatchClosedClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.model1Closed())})("returnBatchValue",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.returnBatch(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("AlternateUnits",a.AlternateUnits)("activerowIndex",a.activerowIndex)("title",a.masterService.PlistTitle)("BList",a.batchlist)("voucherType",a._trnMainService.TrnMainObj.VoucherType)("activeurlpath",a.activeurlpath)}}function mi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"PSalesSchemeList",138),t.NdJ("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.dblClickPopupScheme(h))})("schemeCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.schemepopupClosed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("schemeList",a.schemeList)}}function Si(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"popPartyChoose",139),t.NdJ("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.dblClickPopupParty(h))})("partyCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.partypopunpClosed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("partyList",a._trnMainService.partyList)}}function vi(R,J){1&R&&(t.TgZ(0,"th",159),t._uU(1,"CURRENT WS-PRICE"),t.qZA())}function rt(R,J){1&R&&(t.TgZ(0,"th",160),t._uU(1,"NEW WS-PRICE"),t.qZA())}function gi(R,J){if(1&R&&(t.TgZ(0,"td",162),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.WSRATE_A)," ")}}function fi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"td",162)(1,"input",164),t.NdJ("change",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw(2);return t.KtG(x.onChangePurchasePrice(M,h))})("ngModelChange",function(h){t.CHM(a);const M=t.oxw().$implicit;return t.KtG(M.WNRATE_A=h)})("keydown.enter",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw(2);return t.KtG(x.onChangePurchasePrice(M,h))})("keydown.Tab",function(h){t.CHM(a);const M=t.oxw().index,x=t.oxw(2);return t.KtG(x.onChangePurchasePrice(M,h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,M=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",d,""),t.Q6J("ngModel",h.WNRATE_A)("disabled","VIEW"==h.rowMode||h.isPurchaseOrderItem||M._trnMainService.TrnMainObj.ProdList[M.activerowIndex].BASEUNIT!=h.UNIT)}}function Oi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"tbody")(1,"tr",161)(2,"td",162),t._uU(3),t.qZA(),t.TgZ(4,"td",162),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA(),t.YNc(7,gi,3,3,"td",163),t.TgZ(8,"td",162)(9,"input",164),t.NdJ("change",function(h){const x=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(x,h))})("ngModelChange",function(h){const x=t.CHM(a).$implicit;return t.KtG(x.NRATE_A=h)})("keydown.enter",function(h){const x=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(x,h))})("keydown.Tab",function(h){const x=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(x,h))}),t.qZA()(),t.YNc(10,fi,2,3,"td",163),t.qZA()()}if(2&R){const a=J.$implicit,d=J.index,h=t.oxw(2);t.xp6(3),t.hij(" ",a.UNIT," "),t.xp6(2),t.hij(" ",t.lcZ(6,7,a.CRATE_A)," "),t.xp6(2),t.Q6J("ngIf",1==h.userSetting.ENABLEWSALESRATEBILLING),t.xp6(2),t.MGl("id","newSellingPrice",d,""),t.Q6J("ngModel",a.NRATE_A)("disabled","VIEW"==a.rowMode||a.isPurchaseOrderItem||h._trnMainService.TrnMainObj.ProdList[h.activerowIndex].BASEUNIT!=a.UNIT),t.xp6(1),t.Q6J("ngIf",1==h.userSetting.ENABLEWSALESRATEBILLING)}}function bi(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div",140)(1,"div",141)(2,"div",142)(3,"h4",143),t._uU(4,"Selling Price Setting "),t.qZA()(),t.TgZ(5,"div",144)(6,"div")(7,"h5",143),t._uU(8,"Cost Price has been changed.Please reset you new Selling Price"),t.qZA(),t._UZ(9,"hr",145),t.qZA(),t.TgZ(10,"div",42)(11,"label"),t._uU(12,"Label MRP:"),t.qZA(),t.TgZ(13,"input",146),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M._trnMainService.TrnMainObj.ProdList[M.activerowIndex].LABELMRP=h)}),t.qZA()(),t.TgZ(14,"fieldset")(15,"legend",147),t._uU(16,"New Selling Price Setting"),t.qZA(),t.TgZ(17,"table",130)(18,"thead")(19,"tr",148)(20,"th",149),t._uU(21,"UOM"),t.qZA(),t.TgZ(22,"th",150),t._uU(23,"CURRENT S-PRICE "),t.qZA(),t.YNc(24,vi,2,0,"th",151),t.TgZ(25,"th",152),t._uU(26,"NEW S-PRICE"),t.qZA(),t.YNc(27,rt,2,0,"th",153),t.qZA()(),t.YNc(28,Oi,11,9,"tbody",96),t.qZA(),t.TgZ(29,"div",42)(30,"div",154)(31,"h6"),t._uU(32),t.qZA()(),t.TgZ(33,"div",155),t._UZ(34,"div",156),t.qZA()()(),t.TgZ(35,"button",157),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyClickNewPrice())})("keydown.enter",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyClickNewPrice())}),t._uU(36," APPLY "),t.qZA(),t.TgZ(37,"button",158),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyOldPriceClick())})("keydown.enter",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyOldPriceClick())}),t._uU(38," APPLY OLD S-PRICE "),t.qZA()()()()}if(2&R){const a=t.oxw();t.xp6(13),t.Q6J("ngModel",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].LABELMRP),t.xp6(11),t.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),t.xp6(3),t.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngForOf",a._trnMainService.priceChangeList),t.xp6(4),t.hij(" Recommended Margin: ",a._trnMainService.selectedProdcutRecMargin,"%")}}function Ci(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h5",128),t._uU(5,"Discount authorization"),t.qZA(),t.TgZ(6,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t.TgZ(7,"span",40),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",41)(10,"div",167)(11,"label",168),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",169)(14,"input",170),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.disAuthObj.username=h)}),t.qZA()()(),t.TgZ(15,"div",167)(16,"label",168),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",169)(19,"input",171),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.disAuthObj.password=h)}),t.qZA()()(),t.TgZ(20,"div",167)(21,"label",168),t._uU(22,"Discount:"),t.qZA(),t.TgZ(23,"div",172)(24,"input",173),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.disAuthObj.discount=h)}),t.qZA()(),t.TgZ(25,"div",174)(26,"a"),t._uU(27,"% \xa0"),t.qZA()()(),t.TgZ(28,"div",175)(29,"fieldset",176)(30,"legend",177),t._uU(31,"Discount authorization remarks:"),t.qZA(),t.TgZ(32,"textarea",178),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.disAuthObj.remarks=h)}),t.qZA()()()(),t.TgZ(33,"div",179)(34,"button",180),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.discountAuthConfirm())}),t._uU(35,"Confirm"),t.qZA()()()()()}if(2&R){const a=t.oxw();t.xp6(14),t.Q6J("ngModel",a.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",a.disAuthObj.password),t.xp6(5),t.Q6J("ngModel",a.disAuthObj.discount),t.xp6(8),t.Q6J("ngModel",a.disAuthObj.remarks)}}function Ai(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",181),t.NdJ("BatchClosedEmit",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.BatchPopupClosed())})("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.dblClickPopupBatchs(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ei(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",181),t.NdJ("BatchClosedEmit",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.AdjustPopupClosed())})("dbClickEvent",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M.DblClickPopupAdjust(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ii(R,J){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h6",128),t._uU(5,"Authorization for Negative Stock Entry"),t.qZA(),t.TgZ(6,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t.TgZ(7,"span",40),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",41)(10,"div",167)(11,"label",168),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",169)(14,"input",170),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M._trnMainService.disAuthObj.username=h)}),t.qZA()()(),t.TgZ(15,"div",167)(16,"label",168),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",169)(19,"input",171),t.NdJ("ngModelChange",function(h){t.CHM(a);const M=t.oxw();return t.KtG(M._trnMainService.disAuthObj.password=h)}),t.qZA()()()(),t.TgZ(20,"div",179)(21,"button",180),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.confirmAuthorization())}),t._uU(22,"Confirm"),t.qZA(),t.TgZ(23,"button",182),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t._uU(24,"Cancel"),t.qZA()()()()()}if(2&R){const a=t.oxw();t.xp6(14),t.Q6J("ngModel",a._trnMainService.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",a._trnMainService.disAuthObj.password)}}const Pi=function(){return{width:"28%"}},yi=function(){return{width:"25%"}},Fe=function(){return{width:"24%"}},xi=function(){return{width:"40%"}},Ri=function(){return{backdrop:"static"}};let Ni=(()=>{class R{constructor(a,d,h,M,x,X,re,me,Ie,ve,ge,Ve,He,ze){this.masterService=a,this._trnMainService=d,this.setting=h,this.dialog=M,this.fb=x,this.arouter=X,this.alertService=re,this.authservice=me,this.changeDetection=Ie,this.loader=ve,this.validationService=ge,this.responseMsgService=Ve,this.userRightAuthService=He,this.focusService=ze,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.TotalBill=new t.vpe,this.gridPopupSettingsForSupplier=new g.im,this.barcodeGridSettings=new g.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new t.vpe,this.onChangeProductionItem=new t.vpe,this.indexEmit=new t.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new g.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInQuantity=!0,this.applyPipeInSprice=!0,this.mfgExpDateType="month",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=Xe=>{let _e=Object.assign({},this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),ot=[],st=0;for(var Te of(console.log("vardata",Xe),Xe))if(_e.VaraintDetailS=[],this.masterService.nullToZeroConverter(Te.QTY)>0){let tt="";_e.VARIANTDESCA="";var at={};for(var Ue in Te)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Ue)&&(tt+=Te[Ue].VARIANTBARCODE,_e.VARIANTDESCA=_e.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Ue)}</b>:${Te[Ue].NAME} &nbsp;`,at[Te[Ue].VARIANTNAME]=Te[Ue].NAME);_e.VaraintDetailS.push(at),_e.VARIANTLIST=Te,_e.BC=Te.BARCODE?Te.BARCODE:_e.MCODE+tt,_e.Quantity=Te.QTY,_e.MRP=Te.MRP,_e.ALTMRP=Te.MRP,_e.REALQTY_IN=Te.QTY,_e.ALTERNATEQUANTIY=Te.QTY,_e.AltQty=Te.QTY,_e.PRATE=Te.PRATE,_e.RATE=Te.PRATE,_e.REALRATE=Te.PRATE,_e.ALTRATE=Te.PRATE,_e.SPRICE=Te.SRATE,_e.SellingPrice=Te.SRATE,_e.ALTRATE2=Te.SRATE,this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&(_e.SELLRATEBEFORETAX=Te.SRATE),_e.BATCH=`-${st}`,ot.push(Object.assign({},_e)),st++}let et=this._trnMainService.TrnMainObj.ProdList.slice(0,this.activerowIndex),Li=this._trnMainService.TrnMainObj.ProdList.slice(this.activerowIndex+1);for(var wi of(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex),ot))et.push(wi);for(var Di of Li)et.push(Di);this._trnMainService.TrnMainObj.ProdList=et,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)},this.hoverId=null,this.stringValue="",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),this.AppMode=C.N.appMode,1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this._trnMainService.TrnMainObj.VoucherType&&(this.AppSettings=h.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(this.showDiscount=!1),a.ShowMore=!0}catch{}this.activeurlpath=X.snapshot.url[0].path,this.form=this.fb.group({demoArray:this.fb.array([])}),this._trnMainService.TrnMainObj.CHALANNO=""}ngAfterContentChecked(){this.changeDetection.detectChanges()}updown(a){"ArrowRight"===a.code&&a.preventDefault(),"ArrowLeft"===a.code&&a.preventDefault(),("ArrowDown"==a.code||"ArrowUp"==a.code)&&a.preventDefault(),"F2"===a.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F5"===a.code&&(a.preventDefault(),this.petrolPopup(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])),"F7"==a.code&&(a.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===a.code&&(a.preventDefault(),this._trnMainService.inputCode&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.length>0&&this.dialougeOpen()),"F11"==a.code&&a.ctrlKey&&(a.preventDefault(),this._trnMainService.barCodes.BC||null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&this.checkBatchWiseRate()),"Escape"==a.code&&(a.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}ngAfterViewInit(){console.log("type",this._trnMainService.TrnMainObj.VoucherType)}model1Closed(){this.masterService.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;this.arrayItems=[],console.log("ptype",this.pType)}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(a=>{this.colorLists=a&&a.result?a.result:[]})}get demoArray(){return this.form.get("demoArray")}addItem(a){this.arrayItems.push(a),this.demoArray.push(this.fb.control(!1))}removeItem(){this.arrayItems.pop(),this.demoArray.removeAt(this.demoArray.length-1)}RowClick(a){this.activerowIndex=this.rowIndex=a,this.masterService.ShowMore=!1,console.log("row click",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(a)}descriptionEditOnRowClick(a){this._trnMainService.allowDescriptionEdit=1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let a=0;if(a=this._trnMainService.TrnMainObj.ProdList.length-1,this._trnMainService.TrnMainObj.ProdList&&null!=this._trnMainService.TrnMainObj.ProdList[0].MENUCODE)return this._trnMainService.TrnMainObj.ProdList.findIndex(h=>h.BC==this._trnMainService.barCodes.BC&&0==h.FulfillBatchQty)+1}highlightLessStockItem(a){return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.ProdList[a].MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this._trnMainService.TrnMainObj.ProdList[a].APPROVEDALTQTY}showPOQtyRate(a){this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this._trnMainService.TrnMainObj.ProdList[a].POSTOCK,this._trnMainService.purchaseOrderRate=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE,this._trnMainService.produstWiseOrderUnit=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT)}openDialog(a){this.selectedIndex=a}ItemBarCodeClick(a,d){if(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry||this._trnMainService.TrnMainObj.BILLTO){if(!this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&"NEW"!==this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&"PI"===this._trnMainService.TrnMainObj.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this._trnMainService.TrnMainObj.Mode||"EDIT"===this._trnMainService.TrnMainObj.Mode)&&6===this._trnMainService.TrnMainObj.ProdList[a].Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC)1==this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix&&(this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this._trnMainService.TrnMainObj.ProdList[a]={}},0)),null!=document.getElementById("itemDesc"+a)&&setTimeout(()=>{document.getElementById("itemDesc"+a).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesReturn){let h=this._trnMainService.TrnMainObj.ProdList.filter(x=>x.BC==this._trnMainService.TrnMainObj.ProdList[a].BC);if(null!=h&&h?.length>1)return this.alertService.info(`Duplicate barcode:${this._trnMainService.TrnMainObj.ProdList[a].BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(x=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)});this._trnMainService.TrnMainObj.ProdList.filter(x=>6==x.PTYPE).forEach(x=>x.ProductDetails?.forEach(X=>{if(X.IEMI1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)return this.alertService.info(`Duplicte IMEI1 :${X.IEMI1} is found on Bulk Entry Grid`),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=null,!1}))}this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.REFBILL).subscribe(h=>{"ok"==h.status?(this._trnMainService.ReturnStockObj=h.result,this.loadBarcodeWiseProductList(h.result.TotalStock)):(this.alertService.info(h.result),this.alertService.emitShowHideSubject.subscribe(M=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)}))},h=>{this.alertService.info(h.result)}):this._trnMainService.checkBarcode(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(h=>{"ok"==h.status?this.loadBarcodeWiseProductList():this.alertService.info(h.result)},h=>{this.alertService.info(h.result)}))}}else this.alertService.info("Please select Production warehouse")}heightChange(){let a;return this.masterService.ShowMore?this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval?(a=64,(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=66)):this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry?a=67:this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder?a=61:this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment?a=72:this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?(a=48,this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=51)):a=this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn?70:this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||1!==this.masterService.userSetting.GblBarcodeWiseBilling?55:49:a=(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling?75:(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)&&1==this.masterService.userSetting.GblBarcodeWiseBilling?72:81,a}onChangeBarCode(a){}ItemkeyEvent(a,d){if(d.preventDefault(),this.activerowIndex=a,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this._trnMainService.TrnMainObj.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(h=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(h=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});console.log("Check Tna",this._trnMainService.TrnMainObj.TRNACName,this._trnMainService.TrnMainObj.REMARKS),this.showStockedQuantityOnly=0}else this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE??""):this.showStockedQuantityOnly=0;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&1!==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI){if(!this._trnMainService.TrnMainObj.REFORDBILL){let h=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(h),!1}}else if(null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else{let M,h="";"self-billing"===this.activeurlpath?h="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(h=this._trnMainService.TrnMainObj.VoucherPrefix);let x="";x=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,((0,Q.isNullOrUndefined)(M)||0==this.userSetting.GblBarcodeWiseBilling||null==M||void 0===M||""==M)&&(M="A"),this.productListInGenericPopup(a,M,h,x)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE){let h="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(h=this._trnMainService.TrnMainObj.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}return this._trnMainService.itemselectevent=!0,console.log("credinote",this._trnMainService.TrnMainObj.DOMANUALSALESRETURN),this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote?this._trnMainService.TrnMainObj.REFBILL:""),!1}this.displayProductDetailInViewMode(d)}}productListInGenericPopup(a,d,h,M){if(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let x=this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC;x&&""!=x?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+a).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${d}/all/${h}/${M}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${d}/all/${h}/${M}`}displayProductDetailInViewMode(a){console.log("eventlog",a),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==a.code&&this.dialougeOpen()}onChangeExpDate(){}loadBarcodeWiseProductList(a=0){this.loadFromBarcode=!1;let h=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(x=>{if("ok"===x.status)if(h=x.result.data,0===h.length)this.alertService.info("Product is out of Stock ");else if(1===h.length){this.loadFromBarcode=!0;var X=h[0];if(this._trnMainService.CheckIfSalesReturn()){X.STOCK=a;var re=0;for(let ve of this._trnMainService.TrnMainObj.ProdList)ve.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(re+=ve.ALTERNATEQUANTIY);if(X.STOCK<re)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(X),this.loadFromBarcode=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",X.barcodeDetails){var me=JSON.parse(X.barcodeDetails);for(var Ie in console.log("varDetail",me),me)this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${Ie}</b>:${me[Ie]} &nbsp;`}}else console.log("response data > 1",this.gridPopupSettings),this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(x.result.error)})}checkDuplicatProductWithBarcode(){let a=[];return a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.BARCODE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE),a.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}checkBatchWiseRate(){this.batchlist=[];let a=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this.activeurlpath&&(a="SF");let d="";d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE;let h="";h=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${d}&voucherPrefix=${a}&warehouse=${h}&barcode=`).subscribe(M=>{"ok"===M.status&&(this.batchlist=M.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===M.message&&(this.changeBatchWiseRate(M.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(M.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=M.result[0].costprice),"SHOWPRICEPOPUP"===M.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!"))})}checkBatchWiseRateSettingZero(){console.log("check batch wise rate for setting"),this.batchlist=[];let d="",h="";d=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,h=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${d}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${h}&barcode=`).subscribe(M=>{"ok"===M.status&&(this.batchlist=M.result,"SHOWPRICEPOPUP"===M.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(a){(this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(a)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):a,this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(a){null!=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.filter(h=>1==h.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(a){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a[0].MFGDATE?"":a[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a[0].EXPDATE?"":a[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a[0].BATCH)}batchWiseSalesRateBeforeTax(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a)}batchWiseStockTax(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.map(d=>d.STOCK).reduce((d,h)=>d+h,0))}BatchTabClick(a,d){if(console.log("BATCH TAB CLICK called"),d?.preventDefault(),this.activerowIndex=a,(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH||null==this._trnMainService.TrnMainObj.ProdList[a]||null==this._trnMainService.TrnMainObj.ProdList[a].MCODE||""===this._trnMainService.TrnMainObj.ProdList[a].MCODE)return!1;let h=this._trnMainService.userProfile.userWarehouse;return this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(h=this._trnMainService.TrnMainObj.BILLTO),this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||0!=this._trnMainService.prodListForUnfinedBill||"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote||this.masterService.masterPostmethod("/getBatchListOfItem",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE,onlynonexpireditem:this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice?1:0,voucherprefix:this._trnMainService.TrnMainObj.VoucherPrefix,warehouse:h}).subscribe(M=>{"ok"==M.status?(console.log("Reus",M),this.batchlist=JSON.parse(M.result),1==this.batchlist.length?this.masterService.PlistTitle="Batch Price Selection":0==this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?alert("Rate not Detected!"):0==this.batchlist.length&&"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||(this.masterService.PlistTitle="Batch Price Selection")):console.log("error on getting BatchListOfItem "+M.result)},M=>{console.log("error on getting BatchListOfItem ",M)}),!1}onKeydownOnBatch(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||"Enter"===a.key||"Tab"===a.key||a.preventDefault()}assignedSchemeToBatch(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME;if(null!=a)if(null==a.batches||""===a.batches)this.batchlist.forEach(d=>{d.SCHEME=a,d.SCHEMERATE=a.schemeDisRate,d.SCHEMENAME=a.schemeName,d.SchemeRateType=a.discountRateType});else{let d=a.batches.toString().split(",");this.batchlist.forEach(h=>{null!=d.find(M=>M===h.BATCH)&&(h.SCHEME=a,h.SCHEMERATE=a.schemeDisRate,h.SCHEMENAME=a.schemeName,h.SchemeRateType=a.discountRateType)})}}ReturnedSchemeValue(){}BatchEnter(a,d){d.preventDefault();let h=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=d.LANDINGCOST,2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&h in e.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(console.log("rn"),this.checkBatchWiseRate()),null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){console.log("entewews"),this.batchList=[];let M=this._trnMainService.TrnMainObj.ProdList[a].MCODE,x=this.masterService.userProfile.userWarehouse;M&&this.masterService.getItemWiseBatch(M,x).subscribe(X=>{console.log("get batch list",X),"ok"==X.status&&(this.batchList=X.result.filter(re=>re.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}PstockEnter(a,d){d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("computerStock"+a).focus()}CstockEnter(a,d){d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("alternateqty"+a).focus()}AdjustBatchEnter(a){if(this._trnMainService.TrnMainObj.VoucherType=e.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let d=this._trnMainService.TrnMainObj.ProdList[a].MCODE,h=this.masterService.userProfile.userWarehouse;d&&this.masterService.getAdjustingBatch(d,h).subscribe(M=>{console.log("get batch list",M),"ok"==M.status&&(this.batchList=M.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(a){this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCHID=a.BATCHID)),this.checkDuplicateSourceBarcode(a.BATCHCODE)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BC),this.showBatchPopup=!1,this.masterService.focusAnyControl("alternateQty"+this.activerowIndex))}checkDuplicateSourceBarcode(a){return!a||!this._trnMainService.TrnMainObj.ProdList.find(d=>d.BATCH==a)||(this.alertService.info(`Batch ${a} is already selected as a source barcode.`),!1)}DblClickPopupAdjust(a){a.BATCHCODE!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INVRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MANUFACTURER=a.BATCHID),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBC=a.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}prepareProductDetails(){let d={color:""};d.quantity=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,d.IEMI1=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE,d.IEMI2="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(d)}selectProductDetails(a){let d=[];d=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(d),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,vchrno:this._trnMainService.TrnMainObj.REFBILL}).subscribe(d=>{d&&"ok"===d.status?(this.isProductDetailView=!0,this.selectedProductDetails=d.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},d=>{this.selectedProductDetails=[]})}dblClickPopupScheme(a){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME=a,this.assignedSchemeToBatch(),null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}discEnterClicked(a,d){return this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOFULLRETURN?0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(a)):document.getElementById("mfgdate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?document.getElementById("remarks"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?this.checkValidation(a):document.getElementById("mfgdate"+a).focus(),!1}approvedQtyEnter(a){console.log("hit while change");let h=this._trnMainService.TrnMainObj.ProdList[a];if(this.validationService.checkStockforApprovalQty(h)&&!h.isConfirmed){console.log("reach");let M=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(M,"ReqApproval")}h.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(h,a)&&setTimeout(()=>{null!=document.getElementById("remarks"+a)&&document.getElementById("remarks"+a).focus()},50),this.validationService.validateStockinReqApproval(h,a,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let d=this.masterService.userProfile.roleRights.find(h=>"DISLIMIT"==h.right);console.log("disLimt on discount rate",d),d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>d?.value&&(this.alertService.warning("Discount limit of :"+d.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let d=this.masterService.userProfile.userRights.find(h=>"SODiscountLimit"==h.right);d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>d?.value&&(this.alertService.warning("Discount limit for sales order ("+d.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():document.getElementById("remarks"+a).focus()},0)}))}return(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(console.log("DISCOUNT",this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder?document.getElementById("discountAmt"+a).focus():(console.log("reach12"),this.checkValidation(a)):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"purchase-import"==this.activeurlpath?document.getElementById("discountAmti"+a).focus():null!=document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():null!=document.getElementById("discountAmti"+a)&&document.getElementById("discountAmti"+a).focus():(console.log("quoatioin enter"),this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+a).focus():document.getElementById("mfgdate"+a).focus())),!1}checkValidation(a){console.log("reached cehck validation");var d=this._trnMainService.TrnMainObj.ProdList[a];if(null!=d){if(null==d.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==d.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${d.ITEMDESC} (${d.MENUCODE}) Please Check Your Entry.`),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!=this.activeurlpath){var h=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(x=>0==x.ISUNKNOWN),function(x){return[x.MCODE,x.RATE,x.BC]});for(const x of h)if(x.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){let x=this._trnMainService.TrnMainObj.ProdList.filter(X=>1==X.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(X.EXPDATE))[0];if(null!=x&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${x.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+a).focus(),!1;if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[a].Quantity>this._trnMainService.TrnMainObj.ProdList[a].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[a].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this._trnMainService.TrnMainObj.ProdList[a].PTYPE<10)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():this._trnMainService.ReCalculateBillWithNormal(),!this._trnMainService.TrnMainObj.ProdList.some(x=>null==x.MCODE)&&!1===this._trnMainService.addRow())return;let M=a+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("barcode"+M)?(console.log("rn1"),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote?(document.getElementById("itemDesc"+M).focus(),this.resetDescriptionEdit()):document.getElementById("barcode"+M).focus()):document.getElementById("itemDesc"+M).focus()},50):setTimeout(()=>{null!=document.getElementById("itemDesc"+M)&&(document.getElementById("itemDesc"+M).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+M)&&document.getElementById("itemDesc"+M).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}onChangeColor(){}returnBatch(a){if("self-billing"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.filter(M=>M.BATCH==a.BATCH&&M.MCODE==a.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.assignBatchToActiveProdRow(a,this.activerowIndex),this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected=!0,console.log("priceselected",this._trnMainService.TrnMainObj.ProdList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT)for(var d in this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST=a.VARIANTDETAIL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST)console.log("Var attribute",d,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[d]),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${d}</b>:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[d]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack)&&this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)}}dblClickPopupBatch(a){console.log("value ma k aaucha",a),this.returnBatch(a)}QuantityChangeEvent(a){let d=this._trnMainService.TrnMainObj.VoucherType;if(this.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(d in e.SL&&(h=this.ValidateQuantityinEDITMode())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message);if(d in e.fr){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase())if(!0!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected)this.checkBatchWiseRateinEditMode();else{var h;if((h=this.ValidateQtyEDITModeForOUt())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message)}else if((h=this.ValidateQtyEDITModeForOUt())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message);let x=this.checkItemStockINEditModeForOutQty();if(x&&!x.status)return void this.alertService.info(x.message)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&(console.log("active",M),"EDIT"===M.RowMode.toUpperCase()&&M&&!this.ValidateQtyINEditModeFroProduction(M)))return}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC} cannot have quantity more than one for membership sales invoice`),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(M=>{setTimeout(()=>{null!==document.getElementById("rate"+a)&&document.getElementById("rate"+a).focus()},100)})),this._trnMainService.calculateNetRATE(a),this._trnMainService.ReCalculateBillWithNormal(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&this.onChangeProductionItem.emit(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"lite"==this._trnMainService.AppMode&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL){console.log("STOCK CHECK IN CN",this._trnMainService.TrnMainObj.ProdList[a]);let M=this._trnMainService.TrnMainObj.ProdList[a];if(M.ALTERNATEQUANTIY>M.STOCK)return this.alertService.warning(`Entered quantity: ${M.ALTERNATEQUANTIY} is greater than issued quantity: ${M.STOCK}`),void(M.ALTERNATEQUANTIY=0)}if(this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,this.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)){if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&this.checkEnteredProductStock(),this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn){let M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(!this._trnMainService.validateIssueQtyInStockIssueReturn(M.PSTOCK,M.ALTERNATEQUANTIY,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(console.log("activerowinsert",this.activerowIndex),this._trnMainService.allowNegativeBilling(this.activerowIndex)?console.log("check user irghrs here"):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&(console.log("check entered product stock"),this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(console.log("selabel soprodlist",this._trnMainService.TrnMainObj.ProdList),this.checkSaleableQuantityInSalesOrder()),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.TrnMainObj.ProdList[a].Quantity<this._trnMainService.TrnMainObj.ProdList[a].POSTOCK){let M="Quantity is less than PO Stock!! Are you sure you want to proceed further";if((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(M="Quantity is less than SO Stock!! Are you sure you want to proceed further"),!confirm(M))return this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,document.getElementById("alternateqty"+a).focus(),void this._trnMainService.ReCalculateBillWithNormal()}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn)&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseStockOut(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE}),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"===this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),d in e.po){let M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,x=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,X=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT,re=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,me=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISUNKNOWN;console.log("activeulr",this.activeurlpath),!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkItemTotalQtyWithStock(M,re,X,x,this.activerowIndex),"self-billing"!=this.activeurlpath&&this.valiadateDuplicateRateItem(X,M,x,me,this.activerowIndex)}this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(console.log("JJJJJ"),this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n          Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n          @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `))}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}ratechangeEvent(a){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(a){this._trnMainService.calculateNetRATE(a),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=100),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeEvent(a,d){if(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.nullToZeroConverter(d.target.value),console.log("inddiscount",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let h=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),M=this.masterService.userProfile.roleRights.find(x=>"DISLIMIT"==x.right);console.log("dis rate",h,"dislimit",M),M&&h>M?.value&&(this.alertService.warning("Discount limit of :"+M.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(x=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[a].UNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE):(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[a].Quantity),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),M=this.masterService.userProfile.userRights.find(x=>"SODiscountLimit"==x.right);console.log(" so dis rate",h,"dislimit",M),M&&h>M?.value&&(this.alertService.warning("Discount limit of :"+M.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(x=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeOfRetailerVATINCEvent(a,d){this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(d.target.value),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT<0?this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=0:this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}discountRateToAmnt(){}QuantityEventClick(a){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)<1||(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived?document.getElementById("alternateunit"+a).focus():(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&document.getElementById("remarks"+a).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(a){return{status:"error",error:a}}}isTableRowSelected(a){return this.activerowIndex===a}deleteRow(){if("EDIT"==this._trnMainService.TrnMainObj?.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this._trnMainService.TrnMainObj.VoucherType))return;(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}`)}this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")}restrictPercentageNumeric(a,d){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=0:(parseFloat(a)>100||isNaN(parseFloat(a)))&&(this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(a,d){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNT=0:parseFloat(a)>this._trnMainService.TrnMainObj.ProdList[d].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[d].AMOUNT)}catch{}}SelectUnit(a,d,h){this._trnMainService.TrnMainObj.ProdList[a].DiscountOnAltUnit=!1,this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[a].CRATE=0;let M=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.find(x=>x.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?this._trnMainService.TrnMainObj.ProdList[a].BASERATE:this._trnMainService.TrnMainObj.ProdList[a].RATE,this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0):(this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=M.CONFACTOR,0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].BASERATE),this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE-this._trnMainService.TrnMainObj.ProdList[a].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT/100),this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR),console.log("prodlist1",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this.applyDiscountOnUnitChange(M,a),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&this.applyDiscountOnUnitChangeOnSales(M,a),this._trnMainService.ReCalculateBillWithNormal()),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&(console.log("something here",this._trnMainService.TrnMainObj.ProdList[a]),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT!=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR:this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY,this.approvedQtyEnter(a),this._trnMainService.CalculateApprovalBill())}applyDiscountOnUnitChange(a,d){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?a.WSRATE_DISCOUNT:a.SRATE_DISCOUNT;else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let h=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?a.SRATE_DISCOUNT:a.WSRATE_DISCOUNT);console.log("discount",h),this._trnMainService.TrnMainObj.ProdList[d].ALTRATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE-this._trnMainService.TrnMainObj.ProdList[d].ALTRATE*(h/100)}}applyDiscountOnUnitChangeOnSales(a,d){this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=a.SRATE_DISCOUNT}schemepopupClosed(){this.schemeList=[],document.getElementById("showScheme").style.display="none",null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}returnMultiBatchScheme(a){for(let d of a)this._trnMainService.assignBatchToActiveProdRow(d,this.activerowIndex)}flatDisChange(a){this.flatDiscountValue=a,this.flatDiscountAssign()}flatDiscountUnitChange(a){this.radioFlatDiscount=a,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let a=this._trnMainService.TrnMainObj.ProdList.reduce((d,h)=>d+(this._trnMainService.nullToZeroConverter(h.AMOUNT)-this._trnMainService.nullToZeroConverter(h.INDDISCOUNT)),0);this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue*a/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(a,d){this.showBatchWiseDetail=!1,this.checkValidation(d)||this.masterService.focusAnyControl("remarks"+d)}RemarksEnterCommand(a,d){if(a.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(d)||this.masterService.focusAnyControl("remarks"+d),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval){let h=d+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+h)&&document.getElementById("alternateunit"+h).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let d="";d=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}&VCHRNO=${this._trnMainService.TrnMainObj.VCHRNO}&warehouse=${d}`).subscribe(h=>{if("ok"===h.status&&(this.batchlist=h.result,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===h.message&&(this.changeBatchWiseRate(h.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=h.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(h.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=h.result[0].costprice),"SHOWPRICEPOPUP"===h.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(h.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){var M=this.ValidateQtyEDITModeForOUt();if(M&&!M.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=M.userEnterQty,void this.alertService.info(M.message)}})}dblClickPricePopUP(a){let d=this._trnMainService.mulitplePriceItemList.filter(ve=>this._trnMainService.nullToZeroConverter(ve.qty)>0),h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT,x=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,X=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE,re=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC,me=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AlternateUnits,Ie=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR;if(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(ve=>0!=this._trnMainService.nullToZeroConverter(ve.ALTERNATEQUANTIY)),null!=d)for(let ve=0;ve<d.length;ve++){let ge={Product:{}};ge.MCODE=x,ge.MENUCODE=X,ge.INDDISCOUNT=d[ve].dcamount,ge.INDDISCOUNTRATE=d[ve].dcrate,ge.ITEMDESC=re,ge.UNIT=h,ge.BASEUNIT=M,ge.RATE=d[ve].rate,ge.ALTRATE=d[ve].rate,ge.ALTERNATEQUANTIY=d[ve].qty,ge.inputMode=!0,ge.CRATE=d[ve].netrate,ge.ALTCONFACTOR=Ie,ge.Product.AlternateUnits=me,this._trnMainService.TrnMainObj.ProdList.push(ge)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(a){console.log("dblclickpar"),null!=a&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TRNAC=a.ACID,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ACNAME=a.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this._trnMainService.TrnMainObj.PARAC=a.ACID,this._trnMainService.TrnMainObj.BILLTO=a.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=a.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=a.VATNO,this._trnMainService.TrnMainObj.BILLTOMOB=a.MOBILE,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=a.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}onKeydownPreventEdit(a){"Enter"===a.key||"Tab"===a.key||a.preventDefault()}batchKeyDownEvent(){return!1}popUpBatchList(){}MFGDateEnterEvent(a){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(a){return this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction||this.checkValidation(a)||this.masterService.focusAnyControl("remarks"+a),!1}AlternateUnitEnterEventClick(a,d){d.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&(document.getElementById("alternateqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&document.getElementById("approvedQty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("physicalStock"+a).focus()),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this._trnMainService.TrnMainObj.ProdList[a].BC&&""!=this._trnMainService.TrnMainObj.ProdList[a].BC&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].BC&&document.getElementById("rate"+a).focus(),74==this._trnMainService.TrnMainObj.VoucherType&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&document.getElementById("alternaetqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&document.getElementById("alternateqty"+a).focus()}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discount"+this.activerowIndex).focus(),!1}mrpEnterEvent(a,d){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length&&0==this._trnMainService.TrnMainObj.ProdList[d].ALTUNITObj.RATE_A&&0==this._trnMainService.TrnMainObj.ProdList[d].MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(a,d),console.log("clicktab"),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance)null!=document.getElementById("MRP"+d)?document.getElementById("MRP"+d).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(d);else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)"Non-Discountable"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].DISMODE?this.checkValidation(d):null!=document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():document.getElementById("mfgdate"+d).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(d)}else this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack?this.checkValidation(d):this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(d)):null!=document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():null!=document.getElementById("remarks"+d)?document.getElementById("remarks"+d).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+d).focus());return(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(d),this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),!1}setItemPopupUrl(){console.log("set item popup url",this.userSetting.DefaultFilterIndex);let a=!0,d=!0,h=!0,M=!0,x="STOCK",X=!0,re=!0,me=!0,Ie=!1,ve=!0,ge=!0,Ve=!0,He=!1;this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&(d=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(a=!1,h=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&(M=!1,x="Remaining QTY",ve=!1,1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(ve=!0,He=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(X=!1,Ie=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE&&(X=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(re=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(Ve=!0,me=!1,Ie=!0):(Ve=!1,me=!0,Ie=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(ge=!1),this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:Ie,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:a,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:d,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:h,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:M,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:Ve,noSearch:!0},{key:"STOCK",title:x,hidden:He,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:ge,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:ve,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:X,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:re,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:me,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:X,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:me,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:Ve,noSearch:!0,alignment:"right",pipe:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}ShowProductInsertTableColumns(a,d){let h=this._trnMainService.TrnMainObj.VoucherType,M={};null!=this._trnMainService.TrnMainObj.ProdList&&(M=this._trnMainService.TrnMainObj.ProdList[d]);let x=!1;switch(a){case"BATCH_HEADER":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.Purchase||h===e.Km.OpeningStockBalance||h===e.Km.PurchaseReturn||h===e.Km.SalesReturn||h===e.Km.DebitNote)&&(x=!0);break;case"MENUCODE_HEADER":if(1==this.userSetting.GblBarcodeWiseBilling&&(h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote||h===e.Km.Sales))return!1;(h===e.Km.Purchase||h===e.Km.ReversePurchase||h===e.Km.DebitNote||h===e.Km.OpeningStockBalance)&&(x=!0);break;case"BARCODE_HEADER":if("self-billing"==this.activeurlpath||0==this.userSetting.GblBarcodeWiseBilling)return!1;(h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.Sales||h==e.Km.DebitNote)&&(x=!0);break;case"BATCH_EDITABLE":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.Sales||h===e.Km.Purchase||h===e.Km.OpeningStockBalance||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(x=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(x=!0);break;case"BATCH_NONEDITABLE":((h===e.Km.OpeningStockBalance||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.Quotation||h===e.Km.GoodsReceived)&&!1===M.inputMode||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"MFGDATE_HEADER":case"EXPDATE_HEADER":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"MFGDATE_EDITABLE":case"EXPDATE_EDITABLE":if(0==this.userSetting.EnableBatch)return!1;h===e.Km.ReversePurchase&&(x=!0);break;case"MFGDATE_NONEDITABLE":case"EXPDATE_NONEDITABLE":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"QUANTITY_EDITABLE":(h===e.Km.OpeningStockBalance||h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.Purchase||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"QUANTITY_NONEDITABLE":(h===e.Km.OpeningStockBalance||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote||h===e.Km.DebitNote||this._trnMainService.showPerformaApproveReject)&&!1===M.inputMode&&(x=!0);break;case"MRP_NONEDITABLE":case"UNIT_EDITABLE":default:x=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"CONFACTOR":break;case"GST_AMT_NONEDITABLE":(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoice||h===e.Km.TaxInvoiceCancel||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"COSTPRICE_HEADER":h===e.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||h===e.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||h===e.Km.CreditNote||h===e.Km.OpeningStockBalance||h===e.Km.StockSettlement||h===e.Km.StockIssue||h===e.Km.ReverseCreditNote||(x=!0);break;case"COSTPRICE2_NONEDITABLE":(h===e.Km.Sales||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.SalesReturn)&&(x=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(h===e.Km.PurchaseOrder||h===e.Km.PurchaseOrderCancel||h===e.Km.SalesOrder||h===e.Km.PerformaSalesInvoice||h===e.Km.Quotation||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.DebitNote||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.GoodsReceived||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(x=!0);break;case"SELLINGPRICE2_NONEDITABLE":(h===e.Km.PurchaseOrder||h===e.Km.Purchase||h==e.Km.GoodsReceived)&&(x=!0);break;case"SELLING_HEADER":(h===e.Km.PerformaSalesInvoice||h===e.Km.Quotation||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.GoodsReceived||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.PurchaseOrder||h===e.Km.SalesOrder)&&(x=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this.activeurlpath)return void(x=!1);(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this.activeurlpath)return void(x=!1);(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this.activeurlpath)return void(x=!1);(h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this.activeurlpath)return void(x=!1);(h===e.Km.PurchaseReturn||h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.Sales||h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.TaxInvoice||h===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.ReverseCreditNote)&&(x=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":x=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":h===e.Km.OpeningStockBalance&&(x=!0);break;case"OTHER_DIS_HEADER":(h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.TaxInvoiceCancel&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(x=!0);break;case"UNIT_NONEDITABLE":(h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(x=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(x=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(x=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":case"DISCOUNT_IMPORTPURCHASE":(h==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||h==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(x=!0);break;case"ECS_AMOUNT":1==this.userSetting.ENABLE_ECS?(h==e.Km.Purchase||h==e.Km.GoodsReceived)&&(x=!0):2==this.userSetting.ENABLE_ECS?(h==e.Km.TaxInvoice||h==e.Km.CreditNote)&&(x=!0):3==this.userSetting.ENABLE_ECS&&(h==e.Km.TaxInvoice||h==e.Km.Purchase||h==e.Km.GoodsReceived)&&(x=!0)}return x}assignValueForReturnModeInProd(a){console.log("ineditmode",a),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.RATE,console.log("prodRAte",a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a.MFGDATE?"":a.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a.EXPDATE?"":a.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=a.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=a.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=a.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=a.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=a.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),0==a.INDDISCOUNTRATE&&a.INDDISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=100*a.INDDISCOUNT/(a.REALQTY*a.RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=a.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=a.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=a.ALTCONFACTOR,console.log("RATE",this._trnMainService.TrnMainObj.ProdList,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE),this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(a){this.activerowIndex=a,this.batchlist=[]}validateRate(a,d){if(0==this._trnMainService.nullToZeroConverter(a.ALTRATE))return confirm(" Zero  Rate Entry Detected For Item '"+a.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")?(console.log("reachq"),!1):(document.getElementById("rate"+d).focus(),console.log("reachq"),!0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=0;if(h=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,h<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(M=>{setTimeout(()=>{null!==document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():document.getElementById("remarks"+d).focus()},0)}),!1}}MRPChangeEvent(a,d){if("goods-received-note"==this.activeurlpath&&"NEW"==this._trnMainService.TrnMainObj.Mode){let h=this.masterService.userProfile.roleRights.find(M=>"ALLOWRATECHANGEINPI"==M.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==h.value&&(this._trnMainService.TrnMainObj.ProdList[d].TEMP_ALTRATE==this._trnMainService.TrnMainObj.ProdList[d].ALTRATE||confirm("PRATE DOEN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this._trnMainService.TrnMainObj.ProdList[d].ALTRATE=this._trnMainService.TrnMainObj.ProdList[d].TEMP_ALTRATE))}this.validateRate(a,d),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&(this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&this.validateCostPrice(),this._trnMainService.TrnMainObj.ProdList[d].UNIT==this._trnMainService.TrnMainObj.ProdList[d].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[d].RATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[d].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[d].RATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[d].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkRateisChangedinSoFromQT()}checkRateisChangedinSoFromQT(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE&&(confirm("Rate is change Do you want to proceed .")||(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE))}BarcodeKeyDownEvent(a,d){}AlternateKeyUp(a,d){}AlternateQuantityEventClick(a,d){var h;if((d.preventDefault(),this.QuantityChangeEvent(a),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&setTimeout(()=>{document.getElementById("rate"+a).focus()},20),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn)&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DONONSALEABLERETURN)&&(h=this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE),this._trnMainService.TrnMainObj.ProdList[a].STOCK<h))return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity");(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL>0&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL<this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE)?this.alertService.warning("Quantity cannot exceed the minimum stock level"):(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()),console.log("ITEM CHECK eneabletelecomdevices",this.userSetting.EnableTelcomDevices,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[]),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(0,Q.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(1!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE||this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC)&&this.dialougeOpen()),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.checkMaxStockLevel(a),this._trnMainService.TrnMainObj.ProdList[a].PTYPE<10&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&this.checkReorderStocklevel(a),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN?this.checkValidation(a):this.focusToRate(a,d)),console.log(this.activeurlpath),"self-billing"===this.activeurlpath&&this.checkValidation(a),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,d),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this.focusToRate(a,d))}focusAfterQuantityClick(){this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag?0!=this.userSetting.IMPORTPOBILLMODE?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType!==e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.GoodsReceived||!this._trnMainService.TrnMainObj.REFORDBILL?"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL?document.getElementById("discount"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath?document.getElementById("adjustbatch"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder&&0==this.masterService.userProfile.userRights.find(d=>"AllowRateChangeInSO"==d.right)?.value?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus():document.getElementById("discount"+this.activerowIndex).focus()}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.PMCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(h=>{a+=h.ROUTQTY}),console.log("total Enter qty",a,"stokc",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n        (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n        Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(h=>{a+=h.ROUTQTY}),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n      (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n      Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&h.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC).forEach(h=>{a+=h.Quantity}),console.log("totalEnterQuantitty",a),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)return this.alertService.info(`Inserted Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity :\n    ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity)}  \n    Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(a,d){console.log("FOCUS TO RATE",a,d),d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath?document.getElementById("discount"+a).focus():document.getElementById("rate"+a).focus()}newNulltoconverter(){}BaseQuantityEventClick(a,d){d.preventDefault(),this.activerowIndex=a,null!=document.getElementById("mrp"+a)?this.masterService.focusAnyControl("mrp"+a):this.masterService.focusAnyControl("remarks"+a),this.SelectUnit(a,"EACH",d.target.value)}stockCheck(a,d){this.realQty=0,this.realQtyin=0,this.finalRes=0,this.masterService.getStockForCheck(a).subscribe(h=>{if("ok"===h.status){if(this.stockList=h.result,this.stockList.forEach(M=>{this.realQty+=M.RealQty,this.realQtyin+=M.REALQTY_IN}),this.finalRes=this.realQty-this.realQtyin,this._trnMainService.TrnMainObj.TOTALQTY>this.finalRes)return this.alertService.info("Quantity exceed the transaction stock"),void(this._trnMainService.QuantityMsg="GreaterQuantity");this._trnMainService.QuantityMsg=""}else this.alertService.info(h.result)})}checkBatchWiseStockOut(){this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `)}checkItemTotalQtyWithStock(a,d,h,M,x){let X=0;if(X=1==h?this._trnMainService.TrnMainObj.ProdList.filter(re=>re.MCODE==a&&re.BC==d&&re.RATE==M).map(re=>re.Quantity).reduce((re,me)=>re+me,0):this._trnMainService.TrnMainObj.ProdList.filter(re=>re.MCODE==a&&re.RATE==M).map(re=>re.Quantity).reduce((re,me)=>re+me,0),X>0)return X>this._trnMainService.TrnMainObj.ProdList[x].STOCK&&9!=this._trnMainService.TrnMainObj.ProdList[x].PTYPE?(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[x].ITEMDESC} Entered  Quantity: ${X}  exceed the available stock ${this._trnMainService.TrnMainObj.ProdList[x].STOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[x].ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(a,d,h,M,x){if(console.log("validate duplicate rate item"),0==a&&0==M){let X=this._trnMainService.TrnMainObj.ProdList.filter(re=>re.MCODE==d&&re.RATE==h);if(X&&X?.length>1)return this.alertService.info(`Item:${X[0].ITEMDESC} duplicate rate:${X[0].RATE} is detected.`),void(this._trnMainService.TrnMainObj.ProdList[x].ALTERNATEQUANTIY=0)}}checkBatchWiseStock(){let a=[];this.masterService.getStockBatchWise(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(d=>{"ok"==d.status&&(a=d.result,null!=a&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity>a[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}getBatchWiseDateForNoBill(a){if(this.activerowIndex=a,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH)return!1;this.masterService.masterGetmethod("/batch/getmfgdate?batchCode="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH+"&&selfLife="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SHELFLIFE).subscribe(d=>{"ok"===d.status?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=d.result.mfgdate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=d.result.expdate,this.masterService.focusAnyControl("alternateqty"+a)):this.alertService.info("Invalid BatchCode.Error Details: "+d.message)},d=>{this.alertService.info("Invalid BatchCode.Error Details: "+d)})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(a){console.log("petrol pump fxn ",a.MRP,a.ISAMOUNTWISEBILL),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==a.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(a.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}dblClickPopupItem(a){console.log("value",a.ISAMOUNTWISEBILL,a);let d=this._trnMainService.TrnMainObj.VoucherType;this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={};var h=this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,a);if(console.log("duplication",h),0==h)return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(x=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(a),0!=this.ValidateDuplicateItemEntry(a)){if("add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.WRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.WRATE),this._trnMainService.NeedToTakePriceFromMenuItem()&&(d in e.qK&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.WRATE),d in e.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.PRATE,a.CONFACTOR)),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE=a.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE=a.ECSRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE=a.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE=a.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ENABLEITEMWISEBATCH=a.ENABLEITEMWISEBATCH,6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isQuantityReadonly=!0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isPurchaseOrder=!1,("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isBarcodeOfPtypeSix=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=a.In_Rate_B,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=a.RATE_B)),this.focusService.afterEnterFocousItem(a.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]){this.batchlist=[];let x=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];x.REQEXPDATE=a.REQEXPDATE,x.DISMODE=a.DISMODE,x.PWEIGHT=a.GWEIGHT,x.PROMOTION=0,x.BATCHSCHEME=null,x.ALLSCHEME=null,x.ISVAT=a.ISVAT,x.MENUCODE=a.MENUCODE,x.ITEMDESC=a.DESCA,x.MCODE=a.MCODE,x.WEIGHT=a.GWEIGHT,x.Mcat=a.MCAT,x.BASEUNIT=a.BASEUNIT,x.SHELFLIFE=a.SHELFLIFE,x.Weighable=a.Weighable,x.MRP=a.MRP,x.ALTCONFACTOR=a.CONFACTOR,x.BARCODE=a.BARCODE,x.TOTSTOCK=a.STOCK,x.PSTOCK=a.PSTOCK,x.UNIT=a.BASEUNIT,x.WARRANTY=a.WARRANTY,x.W_MRP=a.W_MRP,x.W_SELLRATEBEFORETAX=a.W_SELLRATEBEFORETAX,x.STOCK=a.STOCK,x.WSRATE_DISCOUNT=a.WSRATE_DISCOUNT,x.MINLEVEL=a.MINLEVEL,x.MAXLEVEL=a.MAXLEVEL,x.ROLEVEL=a.ROLEVEL,x.ROWARN=a.ROWARN,x.MINWARN=a.MINWARN,x.HASVARIANT=a.HASVARIANT,x.Mcat=a.MCAT,x.REMARKS=a.REMARKS,x.PRATE=a.PRATE,x.ISRECURRING=a.ISRECURRING,x.HASCOMMISSIONCHARGE=a.HASCOMMISSIONCHARGE,x.ISAMOUNTWISEBILL=a.ISAMOUNTWISEBILL,x.ISUNKNOWN=a.ISUNKNOWN,1==a.HASVARIANT&&(x.BC=a.BC),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&!(0,Q.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SUPCODE=a.SUPCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType in e.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DOFULLRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),this._trnMainService.NeedToTakePriceFromMenuItem()||((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&1===this.userSetting.EnableItemWiseBatch&&1===a.HASBATCH&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE<10&&this.checkBatchWiseRate()),this._trnMainService.NeedToTakePriceFromMenuItem()||(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&a.PTYPE<10&&9!==a.PTYPE&&((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&this._trnMainService.TrnMainObj.REFORDBILL||!1===this.itemFromBC(a.HASVARIANT)&&this.checkBatchWiseRate())),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0===this.userSetting.EnableBatchWisePrice&&1===a.HASVARIANT&&this.checkBatchWiseRateSettingZero(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||"self-billing"===this.activeurlpath?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=a.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PREV_PRATE=a.PREV_PRATE):(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.ENABLEMANUALSALESRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(a),0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this.assignRateandQtyLoadFromSO(a),this.assignOrderedDiscount(a)),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(a),this.emitReferenceQuantity(),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}`).subscribe(re=>{"ok"==re.status&&re.result&&re.result.length&&(this.matrixItemAtrribute=re.result,this.matrixitemgrid.show())})}6===a.PTYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex))}else this.alertService.warning("Cannot enter duplicate item!")}emitReferenceQuantity(){(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,BASEUNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT})}dialougeOpen(){console.log("dialouge open ProductDetails",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails),this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open(Y.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(h=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?h?.data:h&&h.data&&h.data.productColorList?h.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else document.getElementById("rate"+this.activerowIndex).focus()},20)})}checkMaxStockLevel(a){0!==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL+" exceeded !")}checkReorderStocklevel(a){var d=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY);if(d<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))return;if(d<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL),1===this._trnMainService.TrnMainObj.ProdList[a].MINWARN&&(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL))return;1===this._trnMainService.TrnMainObj.ProdList[a].ROWARN&&this.alertService.warning("Re-Order level "+this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL+" has been reached !")}}}deleteRowBarCodeDetailRow(){confirm("Are you sure you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails[this.barcodeDetailActiverowIndex].splice(this.barcodeDetailActiverowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this.addNewBarCodeDetailRow(this.barcodeDetailActiverowIndex))}ItemIEMI1Click(a,d){}ItemIMEI2Click(a,d){this.addNewBarCodeDetailRow(a)}CancelCommand(){this.showBarCodeDetail=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!1}loadBarCodeRow(a){let h={IEMI1:"",IEMI2:""};h.MCODE=0===this.activerowIndex?"":this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,h.Color="",0===this.activerowIndex?(this._trnMainService.TrnMainObj.ProdList[0].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[0].ProductDetails.push(h)):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(h),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(a){let M={IEMI1:"",IEMI2:""};M.MCODE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,M.Color="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(M),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(a){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].BASEQUANTITY=this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}getProductPriceBatchWise(a){this.masterService.masterPostmethod("/getBatchwisePurchaseRate",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE}).subscribe(h=>{"ok"==h.status&&(this.batchWisePricList=JSON.parse(h.result),this.batchWisePricList.length>0&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this.batchWisePricList[0].RATE,this._trnMainService.TrnMainObj.ProdList[a].CRATE=this.batchWisePricList[0].NETRATE,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this.batchWisePricList[0].DCAMOUNT,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=this.batchWisePricList[0].DCRATE))})}onApplyOldPriceClick(){let a={};if(1==this.userSetting.EnableBatchWisePrice&&(a=this._trnMainService.priceChangeList.filter(d=>0==this._trnMainService.nullToZeroConverter(d.CRATE_A))[0],console.log("INVALID UOM",a),a))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${a.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}checkCarriedOnOpeninbgStock(){let h=[];this.masterService.masterGetmethod(`/getBatchWiseOPPreviousItemInfo/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH}`).subscribe(M=>{"ok"==M.status&&(h=M.result,h.length>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=h[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=h[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h[0].PREVIOUSINQTY,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isCarriedOnStock=1,this._trnMainService.ReCalculateBillWithNormal(),this.checkValidation(this.activerowIndex)))})}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let a of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AltSellingPrices.find(d=>d.UNIT==a.UNIT).NRATE_A=a.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1,console.log("prodlist",this._trnMainService.TrnMainObj.ProdList)}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let a={};return a=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(d=>0==this._trnMainService.nullToZeroConverter(d.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(d=>null==d.NRATE_A||0==d.NRATE_A)[0],!a||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${a.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(a,d){let h=0,M=0,x=0,X=this._trnMainService.priceChangeList[a];if(null!=X){if(X.UNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let re=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*this.userSetting.VATRate;X.NRATE_A<=re&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(x=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),X.NRATE_A<=x+x*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?(x=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),X.NRATE_A<=x&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):X.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)),X.NRATE_A<=h&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let re=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE;if(M=re+re*this.userSetting.VATRate,X.NRATE_A<=M&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)){let me=re+re*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100);X.NRATE_A<=me+me*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?X.NRATE_A<=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):X.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?X.NRATE_A<=h+h*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):X.NRATE_A<=h&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(a),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].WNRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_MRP=this._trnMainService.priceChangeList[a].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.PODetailList[a].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[a].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].WNRATE_A)}changeSellingPrice(a){for(const d of this._trnMainService.priceChangeList)d.SNO>1&&(d.NRATE_A=d.CONFACTOR*this._trnMainService.priceChangeList[a].NRATE_A,d.WNRATE_A=d.CONFACTOR*this._trnMainService.priceChangeList[a].WNRATE_A)}checkDeuplicateCodeAndRate(){let a=[],d=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE);if(null!=d){if(d.length>1){let M=0;for(let x of this._trnMainService.TrnMainObj.ProdList)x.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&a.push(M),M++}let h=1;for(let M of a)(this._trnMainService.TrnMainObj.ProdList[M].RATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE||this._trnMainService.TrnMainObj.ProdList[M].EXPDATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)&&(this._trnMainService.TrnMainObj.ProdList[M].BATCH=`-${h}`),h++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableRateandDiscount(a){let d=this._trnMainService.TrnMainObj.ProdList[a];if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=this.masterService.userProfile.userRights.find(M=>"AllowRateChangeInSO"==M.right);if(h&&0==h?.value)return!0}if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&0==this._trnMainService.userSetting.ENABLEMANUALSALESRETURN)return!0;if(("add-purchase-invoice"==this.activeurlpath||"goods-received-note"==this.activeurlpath)&&"NEW"==this._trnMainService.TrnMainObj.Mode){let h=this.masterService.userProfile.roleRights.find(M=>"ALLOWRATECHANGEINPI"==M.right);if(h&&0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==h?.value)return!1}return!!(this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"VIEW"==d.rowMode||d.isDisabled||this.disableRAteDisandAmt()||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||"purchase-import-order"==this.activeurlpath||this._trnMainService.disableRateOnPOselect||"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||this._trnMainService.disableRateOnGRNload||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||"self-billing"==this.activeurlpath)}disableRAteDisandAmt(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINDNOTE}disableDiscount(){return this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.Sales?(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this._trnMainService.TrnMainObj?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkRepackStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&d.ROUTQTY>d.STOCK)[0];if(null!=a&&null!=a)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.PUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.ALTUNIT} `),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkEnteredProductStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.STOCK&&7!=d.NATURETYPE&&d.PTYPE<10)[0];if(console.log("prod stock obj",a),null!=a)return console.log("STOCK EXCEEDED"),this.alertService.info(a.BASEUNIT!=a.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} (${a.ALTERNATEQUANTIY} x ${a.ALTCONFACTOR} = ${a.Quantity} ${a.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE,this.ItemBarCodeClick(this.activerowIndex,a)}validateCostPrice(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling pirce")}rateChange(){this.applyPipeInRate=!1}quantityChange(){this.applyPipeInQuantity=!1}rateFocusOut(){this.applyPipeInRate=!0}quantityFocusOut(){this.applyPipeInQuantity=!0}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(a,d){6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,d)}ItemBarCodeFoucusOut(a,d){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(a,d){this.barcodeDisplay=!0}DisAmtclick(){}checkBatchWiseEnterStock(){let a=0;return this._trnMainService.TrnMainObj.ProdList.filter(d=>d.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&d.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(d=>a+=d.Quantity),console.log("total batch wise qty",a,"stock",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(a){this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INVRATE)*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EXRATE),this._trnMainService.TrnMainObj.ProdList[a].REALRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(a){this.FCRATEChangeEvent(a),this.masterService.focusAnyControl("discount"+a)}RecalculateMRP(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP}onTabMRP(a,d){a.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+d).focus()}RecalculateSPRICE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE,console.log("hit sprice")}onTabSPRICE(a,d){a.preventDefault(),this.RecalculateSPRICE(),null!=document.getElementById("VSRATE"+this.activerowIndex)?document.getElementById("VSRATE"+this.activerowIndex).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus()}RecalculateVSRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT=1)?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE}onTabVSRATE(a){a.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE}onTabVPRATE(a,d){a.preventDefault(),this.RecalculateSPRICE(),0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,1==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0),this.userRightAuthService.showAuthPopup=!1}OrderComment(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&this.checkValidation(a)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}disableBatch(a){return(2!=this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType!=e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry)&&(0===a.REQEXPDATE||null===a.REQEXPDATE||void 0===a.REQEXPDATE&&89!=this._trnMainService.TrnMainObj.VoucherType||void 0)}itemFromBC(a){return 1==a&&1==this.loadFromBarcode}disableItemDesc(a){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase())return!0;let d=this._trnMainService.TrnMainObj.ProdList[a];return!!(d.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||!0===this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)||(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?(console.log("disableitemdesc2"),!0):this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN)}disableAltUnit(a){let d=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"===d.rowMode||d.isDisabled||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"===this.activeurlpath||"stock-issue-approval"===this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN}disableRequestQTY(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval)return!0}disableGridForReqApproval(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.REFORDBILL)return!0}disableAltQty(a){let d=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"==d.rowMode||d.isDisabled||d.isBarcodeOfPtypeSix||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||0===this.userSetting.ENABLEMANUALSALESRETURN&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN}disableAprroveQty(a){if("VIEW"==this._trnMainService.TrnMainObj.ProdList[a].rowMode)return!0}disableBarcodeField(a){return!!(1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.ProdList[a].isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||"lite"==this.AppMode)}showVATcolumn(){return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)}showNetAmtHeadercolumn(){return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance}showNetAmtNonEditable(){return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Stockadjustment&&!(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT)}showNetAmtEditable(){return this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT}checkBatchSelectionInMultiplePrice(){return 1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice||!!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected}checkQuantityInPOdeliveryMode(){console.log("reachdownpodelivery"),null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQT(){null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT}\n  exceed the item wise QT Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n  `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQTin(){if(null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity<d.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void document.getElementById("alternateqty"+this.activerowIndex).focus()}checkSaleableQuantityInSalesOrder(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],d=a.ALTUNIT==a.BASEUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTCONFACTOR;this.masterService.getSaleableQTY(a.MCODE,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNDATE,this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.TrnMainObj.VCHRNO).subscribe(h=>{if("ok"==h.status){let M=h.result[0].SALEABLE_SQTY;d>M&&(a.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),this.alertService.info("Entered qty is greater than its saleable qty:"+M),this.alertService.emitShowHideSubject.subscribe(x=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}))}},h=>{this.alertService.info(h)})}checkQuantityInEditMode(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity<d.OUTQTY)[0];null!=a?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${a.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE/this.userSetting.VatConRate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE/this.userSetting.VatConRate),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=0!==this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.ENABLE_SOINABB&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||0!==this.userSetting.ENABLE_SOINDCHALAN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)?a.OPSTOCK:a.POSTOCK}assignOrderedDiscount(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=a.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE}clickOnNetAmount(a){this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(a)}changeONNetAmount(a,d){this._trnMainService.TrnMainObj.ProdList[a].NETAMOUNT=this._trnMainService.nullToZeroConverter(d.target.value),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(a){if(a&&a?.length){let d=a.map(h=>h.ADJUSTQTY).reduce((h,M)=>h+M);this._trnMainService.nullToZeroConverter(d)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d)}}checkItemQtyExceedBilledQty(){let a=0,d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;return a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?d:d*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,!(a<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY)}checkItemStockINEditModeForOutQty(){let a={},d=0,h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;if(d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?h:h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,"EDIT"!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&d>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a;if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()){let M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BatchWiseEditList?.map(x=>x.INVOICEQTY).reduce((x,X)=>x+X,0);if(d-M>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(a=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},console.log("Negative stock responee",a),this.loader.hide(),"ok"==a.status?"ALLOW"==a.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,console.log("ALLOW TO DELETE HERE",this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}) ?`)&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},a=>{this.loader.hide(),this.alertService.info(a)})}ValidateQuantityinEDITMode(){console.log("prdList",this._trnMainService.TrnMainObj.ProdList);let a={},d=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY,M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,x=0;return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?x=h:(x=h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,M/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),0==d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&x<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY-this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BSTOCK?(a.status=!1,a.userEnterQty=M,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a):d>0&&x<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK?(a.status=!1,a.userEnterQty=M,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}   ) ) `,a):void 0}checkBCForMatrxiItem(){this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||this.alertService.warning(`Variant Details is not selected for Item :${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} `))}ValidateQtyINEditModeFroProduction(a){let d=0;return d=a.BASEUNIT===a.ALTUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTERNATEQUANTIY,!(d<a.OUTQTY&&(this.alertService.info(`Item : ${a.ITEMDESC} entered Qty:${d} ${a.BASEUNIT} is less than transaction Qty:${a.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let a={},h=(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY),M=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,x=0;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?x=h:(x=h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,M/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),console.log("stock",x,this._trnMainService.TrnMainObj.ProdList),x>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.userEnterQty=M,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n          ,Exceed the Stock qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a}ValidateDuplicateItemEntry(a){if(this._trnMainService.TrnMainObj.VoucherType in e.NA){let h;return h=this._trnMainService.TrnMainObj.ProdList.filter(M=>M.MENUCODE==a.MENUCODE),!(h.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(d=>"AllowQuantityApproval"==d.right)?.value}AllowNegativeAuthConfirm(){console.log("AUTH ASEKD")}onUserRightReceived(a){console.log("ebent ma k aaucha",a,this._trnMainService.afterAutoloadCheck),this.alertService.success(a),this.authenticationPopup.hide(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isConfirmed=!0)}hoverDiscount(a){let d=this._trnMainService.TrnMainObj.ProdList[a];this.stringValue="",this.hoverId=a,console.log("prod discount",d.DISCOUNT),0!==d.DISCOUNT&&(this.stringValue=`<b>Indv Discount </b> : ${d.INDDISCOUNT} <br> <b>Flat Dsicount</b> : ${d.FLATDISCOUNT}`)}hoverLeaveDiscount(a){this.hoverId=null}ReadOnlyForDescription(a){return!(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath))}}return R.\u0275fac=function(a){return new(a||R)(t.Y36(_.P),t.Y36(B.p),t.Y36(U.R),t.Y36(z.uw),t.Y36($.qu),t.Y36(Z.gz),t.Y36(N.c),t.Y36(f.e),t.Y36(t.sBO),t.Y36(w.V),t.Y36(P.R),t.Y36(O.T),t.Y36(I.y),t.Y36(L.i))},R.\u0275cmp=t.Xpm({type:R,selectors:[["productentryLite"]],viewQuery:function(a,d){if(1&a&&(t.Gf(q.q,5),t.Gf(v.K,5),t.Gf(Ge,5),t.Gf(Ye,5),t.Gf(lt,5),t.Gf(ht,5),t.Gf(dt,5),t.Gf(ut,5),t.Gf(pt,5),t.Gf(_t,5),t.Gf(Tt,5),t.Gf(Mt,5)),2&a){let h;t.iGM(h=t.CRH())&&(d.itemListChild=h.first),t.iGM(h=t.CRH())&&(d.batchlistChild=h.first),t.iGM(h=t.CRH())&&(d.genericGridSupplierPopup=h.first),t.iGM(h=t.CRH())&&(d.barCodeGridPopup=h.first),t.iGM(h=t.CRH())&&(d.PetrolGrid=h.first),t.iGM(h=t.CRH())&&(d.genericGridMulitplePricePopup=h.first),t.iGM(h=t.CRH())&&(d.matrixitemgrid=h.first),t.iGM(h=t.CRH())&&(d.itemEditGrid=h.first),t.iGM(h=t.CRH())&&(d.authenticationPopup=h.first),t.iGM(h=t.CRH())&&(d.rateValidation=h.first),t.iGM(h=t.CRH())&&(d.genericGrid=h.first),t.iGM(h=t.CRH())&&(d.focusBatch=h.first)}},hostBindings:function(a,d){1&a&&t.NdJ("keydown",function(M){return d.updown(M)},!1,t.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit"},decls:82,vars:58,consts:[[2,"margin-right","15px"],[1,"wrapper"],["id","prodlistTableheader",2,"background","silver","color","black"],[4,"ngIf"],["scope","col",2,"width","4%"],[3,"ngStyle"],["style","width: 190px;",3,"ngStyle",4,"ngIf"],["style","width: 50px;",4,"ngIf"],["style","width:100px",3,"ngStyle",4,"ngIf"],["style","width: 95px;",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width:100px",4,"ngIf"],["style","width: 60px;",4,"ngIf"],["style","width: 120px;",4,"ngIf"],["style","width: 90px;",4,"ngIf"],["style","width: 100px;",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 15%;",4,"ngIf"],["style","border: 1px;",4,"ngFor","ngForOf"],["class","PList","style","    margin-top: 2%;\nheight: 640px;\nwidth: 78%; ",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;height: 370px;\nposition: absolute;right: 20%;top: 5px;width: 50%;z-index: 9999999",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],[2,"width","190px",3,"ngStyle"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","95px"],[2,"width","110px"],[2,"width","100px"],[2,"width","60px"],[2,"width","120px"],[2,"width","90px"],[2,"width","15%"],[2,"border","1px"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #e6e6e6","width","20px",3,"id"],["style","width: 6%;",4,"ngIf"],["style","width: 10%;",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","30%",3,"ngStyle"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["class","CellWithComment","style","height:23px;border: 1px solid #e6e6e6;width:7%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:4%",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9",3,"hidden"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; width: 7rem; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;",4,"ngIf"],["id","amntId","style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px; text-align: right;",4,"ngIf"],["id","vatvalue","style","height:23px;border: 1px solid #e6e6e6;width:100px;text-align: right;",4,"ngIf"],["style","height:23px; border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width: 5vw; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px",4,"ngIf"],["style","border: 1px solid #e6e6e6;background-color: #f9f9f9;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",3,"id",4,"ngIf"],[2,"width","6%"],[2,"width","10%"],["autocomplete","off","type","text",2,"width","100%","border","1px solid",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","7%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],["focusBatch",""],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","focusout","keydown.Enter","keyup","keypress"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","width","7rem","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter","click"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id","mouseover","mouseleave"],[2,"display","none",3,"ngClass"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","width","5vw","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","width","100px"],[3,"ngModel","ngModelChange"],[2,"border","1px solid #e6e6e6","background-color","#f9f9f9"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","ngModelChange","keydown.enter","keydown.Tab"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%",3,"id"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81DAAC"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue"],[3,"schemeList","dbClickEvent","schemeCloseClick"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #E6E6E6","border-top","2px solid #E6E6E6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%;",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%;",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["style","border: 1px solid #e6e6e6;",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(a,d){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"table")(3,"tr",2),t.YNc(4,Vi,2,0,"th",3),t.TgZ(5,"th",4),t._uU(6,"S.No."),t.qZA(),t.YNc(7,mt,2,0,"th",3),t.YNc(8,St,2,0,"th",3),t.TgZ(9,"th",5),t._uU(10," Description"),t.qZA(),t.YNc(11,gt,2,2,"th",6),t.TgZ(12,"th"),t._uU(13," Unit"),t.qZA(),t.YNc(14,Ui,2,0,"th",7),t.YNc(15,Ki,2,6,"th",8),t.YNc(16,Zi,2,0,"th",9),t.YNc(17,Fi,2,0,"th",10),t.YNc(18,Hi,2,0,"th",10),t.YNc(19,bt,2,0,"th",10),t.YNc(20,Ct,2,0,"th",10),t.YNc(21,it,2,0,"th",11),t.YNc(22,Je,2,0,"th",10),t.YNc(23,At,2,0,"th",12),t.YNc(24,Et,2,0,"th",13),t.YNc(25,It,2,0,"th",14),t.YNc(26,Pt,2,4,"th",8),t.YNc(27,yt,2,0,"th",12),t.YNc(28,ke,2,0,"th",13),t.YNc(29,xt,2,0,"th",10),t.YNc(30,Rt,2,0,"th",10),t.YNc(31,Nt,2,0,"th",15),t.YNc(32,Lt,2,0,"th",3),t.YNc(33,wt,2,0,"th",3),t.YNc(34,Dt,2,3,"th",16),t.YNc(35,jt,2,3,"th",16),t.YNc(36,kt,2,0,"th",17),t.qZA(),t.YNc(37,ui,42,50,"tbody",18),t.qZA()()(),t.YNc(38,_i,25,1,"div",3),t.YNc(39,Ti,2,1,"div",19),t.YNc(40,Mi,2,6,"div",20),t.YNc(41,mi,2,1,"div",20),t.YNc(42,Si,2,1,"div",20),t.TgZ(43,"generic-popup-grid",21,22),t.NdJ("onItemDoubleClick",function(M){return d.dblClickPopupItem(M)}),t.qZA(),t.TgZ(45,"generic-popup-grid",21,23),t.NdJ("onItemDoubleClick",function(M){return d.dblClickPopupParty(M)}),t.qZA(),t.TgZ(47,"barcode-popup-grid",21,24),t.NdJ("onItemDoubleClick",function(M){return d.dblClickbarcodePopUP(M)}),t.qZA(),t.TgZ(49,"multiple-price-popup-grid",21,25),t.NdJ("onItemDoubleClick",function(M){return d.dblClickPricePopUP(M)}),t.qZA(),t.TgZ(51,"matrix-item-grid",26,27),t.NdJ("onApplyClicked",function(M){return d.setVariantData(M)}),t.qZA(),t.TgZ(53,"batch-wise-item-edit",28,29),t.NdJ("onApplyClicked",function(M){return d.setBatchWiseEditData(M)}),t.qZA(),t.TgZ(55,"authentication-entry",30,31),t.NdJ("onUserRightReceived",function(M){return d.onUserRightReceived(M)}),t.qZA(),t._UZ(57,"popup-petrol",null,32),t.YNc(59,bi,39,5,"div",33),t.TgZ(60,"div")(61,"div",34,35)(63,"div",36)(64,"div",37)(65,"div",38)(66,"button",39),t.NdJ("click",function(){return d.onClickNo()}),t.TgZ(67,"span",40),t._uU(68,"\xd7"),t.qZA()()(),t.TgZ(69,"div",41)(70,"div",42)(71,"div",43),t._uU(72),t.qZA(),t.TgZ(73,"div",44)(74,"button",45),t.NdJ("click",function(){return d.onClickYes()}),t._uU(75,"Yes"),t.qZA(),t.TgZ(76,"button",46),t.NdJ("click",function(){return d.onClickNo()}),t._uU(77,"No"),t.qZA()()()()()()()(),t.YNc(78,Ci,36,4,"div",3),t.YNc(79,Ai,2,2,"div",3),t.YNc(80,Ei,2,2,"div",3),t.YNc(81,Ii,25,2,"div",3)),2&a&&(t.xp6(1),t.Udp("height",d.heightChange()+"vh"),t.xp6(3),t.Q6J("ngIf",d.approvalFlag),t.xp6(3),t.Q6J("ngIf",d.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("BARCODE_HEADER",0)),t.xp6(1),t.Q6J("ngStyle",24==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType||5==d._trnMainService.TrnMainObj.VoucherType?t.DdM(53,Pi):null)("ngStyle",8==d._trnMainService.TrnMainObj.VoucherType||7==d._trnMainService.TrnMainObj.VoucherType?t.DdM(54,yi):null)("ngStyle",89==d._trnMainService.TrnMainObj.VoucherType?t.DdM(55,Fe):null)("ngStyle",80==d._trnMainService.TrnMainObj.VoucherType?t.DdM(56,xi):null),t.xp6(2),t.Q6J("ngIf",d.ShowProductInsertTableColumns("BATCH_HEADER",0)),t.xp6(3),t.Q6J("ngIf",90!=d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==d._trnMainService.TrnMainObj.VoucherType||14==d._trnMainService.TrnMainObj.VoucherType||15==d._trnMainService.TrnMainObj.VoucherType||41==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||1==d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||(5==d._trnMainService.TrnMainObj.VoucherType||81==d._trnMainService.TrnMainObj.VoucherType)&&1==d.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("FCRATE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||37==d._trnMainService.TrnMainObj.VoucherType||16==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==d._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16===d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("CONFACTOR",0)),t.xp6(1),t.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("ECS_AMOUNT",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_PER_HEADER",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_AMT_HEADER",0)),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16===d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14!=d._trnMainService.TrnMainObj.VoucherType&&16!=d._trnMainService.TrnMainObj.VoucherType&&57!=d._trnMainService.TrnMainObj.VoucherType&&64!=d._trnMainService.TrnMainObj.VoucherType&&74!=d._trnMainService.TrnMainObj.VoucherType&&89!=d._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=d.activeurlpath&&3!=d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),t.xp6(1),t.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType&&1==d.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",d.showVATcolumn()),t.xp6(1),t.Q6J("ngIf",d.showNetAmtHeadercolumn()),t.xp6(1),t.Q6J("ngIf",(3==d._trnMainService.TrnMainObj.VoucherType||37==d._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||31==d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.approvalFlag),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("MFGDATE_HEADER",0)&&"consumption-entry"!==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("EXPDATE_HEADER",0)&&"consumption-entry"!==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",64==d._trnMainService.TrnMainObj.VoucherType||20==d._trnMainService.TrnMainObj.VoucherType||89==d._trnMainService.TrnMainObj.VoucherType||90==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngForOf",d._trnMainService.TrnMainObj.ProdList),t.xp6(1),t.Q6J("ngIf",d.isProductDetailView),t.xp6(1),t.Q6J("ngIf","itemList"==d.masterService.PlistTitle&&d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","Batch Price Selection"==d.masterService.PlistTitle||"Item Variant Selection"==d.masterService.PlistTitle||"Batch Selection"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","schemelist"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","partyPopUp"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("popupsettings",d.gridPopupSettings),t.xp6(2),t.Q6J("popupsettings",d.gridPopupSettingsForSupplier),t.xp6(2),t.Q6J("popupsettings",d.barcodeGridSettings),t.xp6(2),t.Q6J("popupsettings",d.gridPopupSettingsForMultiplePrice),t.xp6(2),t.Q6J("activerowIndex",d.activerowIndex)("matrixItemAtrribute",d.matrixItemAtrribute),t.xp6(2),t.Q6J("BatchWiseEditList",d.BatchWiseEditList),t.xp6(6),t.Q6J("ngIf",d._trnMainService.showPriceChangeDetail&&1==d.userSetting.ShowPriceChangePopup),t.xp6(2),t.Q6J("config",t.DdM(57,Ri)),t.xp6(11),t.hij(" ",d.rateValidationDisplayMessage," "),t.xp6(6),t.Q6J("ngIf",d.showDiscountAuth),t.xp6(1),t.Q6J("ngIf",d.showBatchPopup),t.xp6(1),t.Q6J("ngIf",d.showAdjustPopup),t.xp6(1),t.Q6J("ngIf",1==d._trnMainService.showNegativeBilling||1==d.userRightAuthService.showAuthPopup))},dependencies:[V.oB,F.mk,F.sg,F.O5,F.PC,$.YN,$.Kr,$.Fj,$.wV,$.EJ,$.JJ,$.qQ,$.Fd,$.On,g.Zl,j.n,k.F,q.q,v.K,ee,de.H,be.j,S._v,Oe.ed,Ee.t,Ne.l,Re.m,we.l,F.JJ,F.uU,Ke.g],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}","table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n}\n\nth[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n  padding: 8px;\n}\n\nth[_ngcontent-%COMP%] {\n  text-align: left;\n  background: #eee;\n  position: sticky;\n  top: 0px;\n}\n\n.wrapper[_ngcontent-%COMP%] {\n  border: 1px solid #ddd;\n  width: 100%;\n  overflow-x: hidden;\n  overflow-y:auto ;\n}\n    .col1[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 10em;\n        left: 0em;\n        top: auto;\n    }\n\n    .col2[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 5em;\n        left: 10em;\n        top: auto;\n    }\n\n    .modal-footer[_ngcontent-%COMP%] {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n        cursor: pointer;\n        position: absolute;\n        top: 10px;\n        right: 10px;\n    }\n\n    .modal-backdrop[_ngcontent-%COMP%] {\n        display: none;\n    }",".modal-content[_ngcontent-%COMP%] {\n        padding: 1px;\n        margin: 0px;\n        float: right;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n        background-color: #f3f5f4;\n        cursor: pointer;\n    }\n\n    tr[_ngcontent-%COMP%] {\n        font-size: 13px;\n    }\n\n    .selected-row[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n        line-height: 30px !important;\n        padding: 3px;\n    }\n\nthead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n        line-height: 5px !important;\n    }\n\n   tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n        text-align: left !important;\n        padding: 0px 0px 0px 11px !important;\n    }\n\n    .modal-content[_ngcontent-%COMP%] {\n        box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n\n    .modal-content-main-area[_ngcontent-%COMP%] {\n        max-height: 100%;\n        height: 94%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .modal-content-summary-area[_ngcontent-%COMP%] {\n        max-height: 20%;\n        height: 20%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .ellipsis[_ngcontent-%COMP%] {\n        white-space: nowrap;\n    }\n\n    .close[_ngcontent-%COMP%] {\n        margin: -9px 0px -9px 0px;\n    }\n\n    .highlighted[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n    .bgforlessstockitem[_ngcontent-%COMP%]{\n        background-color: #ffc107d2;\n    }\n    .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 15%;\n\n  }"]}),R})()},32404:(pe,ne,E)=>{E.d(ne,{i:()=>C});var t=E(92340),e=E(66274),g=E(67297),v=E(69389),q=E(48083),Y=E(87584),S=E(53074),Q=E(67311);let C=(()=>{class _{constructor(U,z,$,Z,N,f){this.authservice=U,this.setting=z,this.arouter=$,this._trnMainService=Z,this.masterService=N,this.alertService=f,this.AppSettings=z.appSetting,this.userprofile=U.getUserProfile(),this.userSetting=U.getSetting(),this.AppMode=t.N.appMode}saveClickValidationForUnknownItem(U){let z=U.filter($=>1==$.ISUNKNOWN).find($=>null==$.ITEMDESC||""==$.ITEMDESC||null==$.ITEMDESC||""==$.ITEMDESC?.trim());return!(null==z||!z||(this.alertService.warning("Empty description for item detected, Please enter item description to proceed!!!"),0))}getDuplicatesForConsumptionList(U){let z=new Set,$=[];for(let Z of U){let N=Z.ITEMDESC;z.has(N)?$.push(Z):z.add(N)}return $}}return _.\u0275fac=function(U){return new(U||_)(e.LFG(g.e),e.LFG(v.R),e.LFG(q.gz),e.LFG(Y.p),e.LFG(S.P),e.LFG(Q.c))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac}),_})()},58349:(pe,ne,E)=>{E.d(ne,{i:()=>so});var t=E(8239),e=E(66274),g=E(7587),v=E(10826),q=E(86363),Y=E(41439),S=E(42326),Q=E(28698),C=E(25370),_=E(91605),B=E(32265),U=E(92340),z=E(19102),$=E(67311),Z=E(14970),N=E(87584),f=E(53074),w=E(92752);const P=["genericGridProduct"];function O(T,A){if(1&T&&(e.TgZ(0,"option",24),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.s9C("value",i.NAME),e.xp6(1),e.hij(" ",i.NAME," ")}}function I(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div")(1,"div")(2,"div",5)(3,"h4",6),e._uU(4),e.qZA(),e.TgZ(5,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e.TgZ(6,"span",8),e._uU(7,"\xd7"),e.qZA()()(),e.TgZ(8,"fieldset")(9,"div",9)(10,"div",10)(11,"div",11)(12,"label",12),e._uU(13,"Barcode:"),e.qZA(),e.TgZ(14,"input",13),e.NdJ("keydown.Enter",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onBarcodeEnter(s))}),e.qZA()()(),e.TgZ(15,"div",10)(16,"label",12),e._uU(17,"Item :"),e.qZA(),e.TgZ(18,"input",14),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.showItemPopUp())})("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.DESCA=s)}),e.qZA()(),e.TgZ(19,"div",10)(20,"label",12),e._uU(21,"Warehouse :"),e.qZA(),e.TgZ(22,"select",15),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.MWAREHOUSE=s)}),e.YNc(23,O,2,2,"option",16),e.qZA()()()(),e.TgZ(24,"fieldset")(25,"legend",17),e._uU(26,"Details:"),e.qZA(),e.TgZ(27,"div",9)(28,"div",18)(29,"label",12),e._uU(30,"Item Name:"),e.qZA(),e.TgZ(31,"label",19),e._uU(32),e.qZA()(),e.TgZ(33,"div",20)(34,"label",12),e._uU(35,"Shelf :"),e.qZA(),e.TgZ(36,"label",21),e._uU(37),e.qZA()()(),e.TgZ(38,"div",9)(39,"div",18)(40,"label",12),e._uU(41,"Item Price:"),e.qZA(),e.TgZ(42,"label",21),e._uU(43),e.qZA()(),e.TgZ(44,"div",20)(45,"label",12),e._uU(46,"Row :"),e.qZA(),e.TgZ(47,"label",21),e._uU(48),e.qZA()()(),e.TgZ(49,"div",9)(50,"div",18)(51,"label",12),e._uU(52,"MRP :"),e.qZA(),e.TgZ(53,"label",21),e._uU(54),e.qZA()(),e.TgZ(55,"div",20)(56,"label",22),e._uU(57,"Stock:"),e.qZA(),e.TgZ(58,"label",21),e._uU(59),e.qZA()()(),e.TgZ(60,"div",9)(61,"div",23)(62,"label",12),e._uU(63,"Cost-Price:"),e.qZA(),e.TgZ(64,"label",21),e._uU(65),e.qZA()()()()()()}if(2&T){const i=e.oxw();e.xp6(4),e.hij(" ",i.itemInfopopupsettings.title," "),e.xp6(10),e.s9C("value",i.itemWiseInfoObj.BARCODE),e.xp6(4),e.s9C("value",i.itemWiseInfoObj.DESCA),e.Q6J("ngModel",i._trnMainService.TrnMainObj.DESCA),e.xp6(4),e.Q6J("ngModel",i._trnMainService.TrnMainObj.MWAREHOUSE),e.xp6(1),e.Q6J("ngForOf",i.warehouseList),e.xp6(9),e.Oqu(i.itemWiseInfoObj.DESCA),e.xp6(5),e.Oqu(i.itemWiseInfoObj.shelf),e.xp6(6),e.Oqu(i.itemWiseInfoObj.In_Rate_A),e.xp6(5),e.Oqu(i.itemWiseInfoObj.RACK),e.xp6(6),e.Oqu(i.itemWiseInfoObj.MRP),e.xp6(5),e.Oqu(i.itemWiseInfoObj.STOCK),e.xp6(6),e.Oqu(i.itemWiseInfoObj.IN_PRATE_A)}}let L=(()=>{class T{constructor(i,n,s,p,b,W){this.alertService=i,this.loadingService=n,this._trnMainService=s,this.masterService=p,this.renderer=b,this.elem=W,this.warehouseList=[],this.showStockedQuantityOnly=0,this.itemWiseInfoObj={},this.isActive=!1,this.gridPopupSettingsForproduct=new z.sG,this.doShowInfoPopup=!0,this.masterService.getWarehouseList().subscribe(te=>{this.warehouseList=te})}show(i=!0){this.isActive=!0,this.itemWiseInfoObj={},this.doShowInfoPopup=i}hide(){this.isActive=!1}ngOnInit(){this.gridPopupSettingsForproduct={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/A/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"MENUCODE",title:"PRODUCT CODE",hidden:!1,noSearch:!1},{key:"BASEUNIT",title:"UNIT",hidden:!1,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0},{key:"MRP",title:"MRP",hidden:!1,noSearch:!0,alignment:"right",pipe:!0}]}}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),console.log("info popup close"),this.hide())}showItemPopUp(){this.genericGridProduct.show()}onBarcodeEnter(i){console.log("on barcode enter",i),this.loadingService.show("Getting the item info..."),this.loadingService.hide(),this.masterService.loadItemInfo("",i.target.value,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}onProductSelected(i){console.log("on prodcut select",i.MCODE,i.MENUCODE),this.itemWiseInfoObj.MENUCODE=i.DESCA,this.itemWiseInfoObj.MCODE=i.MCODE,this.itemWiseInfoObj.BASEUNIT=i.BASEUNIT,this.itemWiseInfoObj.STOCK=i.STOCK,this.itemWiseInfoObj.MRP=i.MRP,this.itemWiseInfoObj.BARCODE=i.BARCODE,this.loadingService.show("Getting the item info..."),this.masterService.loadItemInfo(this.itemWiseInfoObj.MCODE,"",this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.BARCODE=n.result[0].BARCODE,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}}return T.\u0275fac=function(i){return new(i||T)(e.Y36($.c),e.Y36(Z.V),e.Y36(N.p),e.Y36(f.P),e.Y36(e.Qsj),e.Y36(e.SBq))},T.\u0275cmp=e.Xpm({type:T,selectors:[["iteminfo-popup"]],viewQuery:function(i,n){if(1&i&&e.Gf(P,5),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridProduct=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,e.evT)},inputs:{itemInfopopupsettings:"itemInfopopupsettings"},decls:5,vars:4,consts:[[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-135px","width","768px"],[1,"modal-content","modal-content-main-area"],[4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridProduct",""],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"padding-left","5px","font-size","1.2rem"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row"],[1,"col-md-6",2,"margin","5px 0px","display","flex","padding","0px"],["for","type",1,"bold"],["type","text","required","",3,"value","keydown.Enter"],["placeholder","Press Enter to select Item","autocomplete","off","readonly","",1,"col-md-8",3,"ngModel","value","keydown.Enter","ngModelChange"],["id","wh","name","selectedWarehouse",1,"form-control",2,"width","67%","height","23px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[2,"font-size","0.8rem","font-weight","600","width","auto"],[1,"col-7"],["for","type",2,"width","65%","height","auto"],[1,"col-5"],["for","type"],["for","type",1,"bold-stock"],[1,"col-6"],[3,"value"]],template:function(i,n){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,I,66,13,"div",2),e.qZA()(),e.TgZ(3,"generic-popup-grid",3,4),e.NdJ("onItemDoubleClick",function(p){return n.onProductSelected(p)}),e.qZA()),2&i&&(e.ekj("modal-sticky-hide",!n.isActive),e.xp6(2),e.Q6J("ngIf",n.itemInfopopupsettings),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForproduct))},dependencies:[w.sg,w.O5,g.YN,g.Kr,g.Fj,g.EJ,g.JJ,g.On,Q.Zl],styles:[".modal-content[_ngcontent-%COMP%] {\n      padding: 1px;\n      margin-right: 65%;\n      float: right;\n      width: 85% !important;\n    }\n\n    .bold[_ngcontent-%COMP%]{\n      font-weight: 600;\n    }\n    .bold-stock[_ngcontent-%COMP%]{\n      font-weight: 600;\n      color:#249e24\n    }\n  \n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n      background-color: #f3f5f4;\n      cursor: pointer;\n    }\n  \n    tr[_ngcontent-%COMP%] {\n      font-size: 11px;\n    }\n  \n    .selected-row[_ngcontent-%COMP%] {\n      background-color: #ced6d3 !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n      line-height: 24px !important;\n      padding: 5px 10px;\n      vertical-align: middle;\n    }\n  \n    .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n      line-height: 5px !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n      text-align: left !important;\n      padding: 0px 0px 0px 11px !important;\n    }\n  \n    .modal-content[_ngcontent-%COMP%] {\n      box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n  \n    .modal-content-main-area[_ngcontent-%COMP%] {\n      max-height: 100%;\n      height: 65%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .modal-content-summary-area[_ngcontent-%COMP%] {\n      max-height: 20%;\n      height: 20%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .ellipsis[_ngcontent-%COMP%] {\n      \n      white-space: nowrap;\n    }\n\n    fieldset[_ngcontent-%COMP%] {\n    margin-top: 0.2rem;\n    margin-left: 0.3rem;\n    margin-right: 0.3rem;\n    border: 1px solid black;\n    color: black;\n    \n    background: #f3f5f4;\n    }"]}),T})();class V{}var F=E(16738),j=E.n(F),k=E(49457),H=E(23815),G=E(38011),ee=E(5304),de=E(94612),be=E(43190),Oe=E(25917),Ee=E(69389),Ne=E(53181),Re=E(48083),we=E(67297),Ke=E(28475);const Ge={alert:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>\n        </svg>\n    ',error:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0V0z" fill="none"/>\n            <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>\n        </svg>\n    ',info:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>\n        </svg>\n    ',success:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>\n        </svg>\n    ',warn:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="64" viewBox="0 0 64 64" height="64">\n          <circle cx="32.086" cy="50.142" r="2.256"/>\n          <path d="M30.08 25.012V42.32c0 1.107.897 2.005 2.006 2.005s2.006-.897 2.006-2.005V25.012c0-1.107-.897-2.006-2.006-2.006s-2.006.898-2.006 2.006z"/>\n          <path d="M63.766 59.234L33.856 3.082c-.697-1.308-2.844-1.308-3.54 0L.407 59.234c-.331.622-.312 1.372.051 1.975.362.605 1.015.975 1.72.975h59.816c.705 0 1.357-.369 1.721-.975.361-.603.381-1.353.051-1.975zM5.519 58.172L32.086 8.291l26.568 49.881H5.519z"/>\n        </svg>\n    '};var Ye=E(79765);let lt=(()=>{class T{constructor(){this.emitter=new Ye.xQ,this.icons=Ge}set(i,n){return i.id=i.override&&i.override.id?i.override.id:Math.random().toString(36).substring(3),i.click=new e.vpe,i.timeoutEnd=new e.vpe,this.emitter.next({command:"set",notification:i,add:n}),i}success(i="",n="",s){return this.set({title:i,content:n||"",type:"success",icon:this.icons.success,override:s},!0)}error(i="",n="",s){return this.set({title:i,content:n||"",type:"error",icon:this.icons.error,override:s},!0)}alert(i="",n="",s){return this.set({title:i,content:n||"",type:"alert",icon:this.icons.alert,override:s},!0)}info(i="",n="",s){return this.set({title:i,content:n||"",type:"info",icon:this.icons.info,override:s},!0)}warn(i="",n="",s){return this.set({title:i,content:n||"",type:"warn",icon:this.icons.warn,override:s},!0)}bare(i="",n="",s){return this.set({title:i,content:n||"",type:"bare",icon:"bare",override:s},!0)}create(i="",n="",s="success",p){return this.set({title:i,content:n,type:s,icon:this.icons[s],override:p},!0)}html(i,n="success",s,p="bare"){return this.set({html:i,type:n,icon:this.icons[p],override:s},!0)}remove(i){this.emitter.next(i?{command:"clean",id:i}:{command:"cleanAll"})}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275prov=e.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var bt=E(74263),Ct=E(32404),it=E(48063),Je=E(76165);let At=(()=>{class T{constructor(i,n){this.http=i,this.authService=n,this.apiUrl=U.N.apiUrl}printVoucher(i,n,s,p,b,W){let te;return this.getBillFormat(i).pipe((0,de.b)(oe=>(te=oe.result[0].BILLFORMATS,this.getPrintTitleAsCopy(i,n,s,p))),(0,de.b)(oe=>(b.title=oe.result,this.getPrintFileName(W,b.COMPANYID,te))),(0,de.b)(oe=>(b.filename=oe.result[0].FileName,b.rownumber=oe.result?oe.result[0].RowsNumber:0,this.getNumberToWords(i,n,s,b.COMPANYID))),(0,de.b)(oe=>(b.numtowords=oe.result?oe.result[0].NUMTOWORDS:"",this.getAllInvoiceData(b)))).subscribe(oe=>{this.print(oe)})}getBillFormat(i){return this.http.post(this.apiUrl+"/getBillFormat",{voucherno:i})}getPrintTitleAsCopy(i,n,s,p){return this.http.get(this.apiUrl+`/getPrintInvoiceTitleAsCopy?VCHRNO=${i}&DIVISION=${n}&PHISCALID=${s}&TRNUSER=${p}`)}getAllInvoiceData(i){return this.http.post(`${this.apiUrl}/Pdf`,{filename:i.filename,Parameter:{voucherno:i.VCHRNO,rowsnumber:i.rownumber,companyname:i.NAME,companyaddress:i.ADDRESS,division:i.INITIAL,phiscalid:i.PhiscalID,companyid:i.COMPANYID,numtowords:i.numtowords,p1:i.panno1,p2:i.panno2,p3:i.panno3,p4:i.panno4,p5:i.panno5,p6:i.panno6,p7:i.panno7,p8:i.panno8,p9:i.panno9,title:i.title,caption:i.caption,phone1:i.phone1,phone2:i.phone2,email:i.EMAIL,vchrno:i.VCHRNO,PRINTBY:i.PRINTBY,companyemail:i.EMAIL,companyvat:i.COMPANYVAT}},this.getRequestOptionForPdfFile())}getRequestOptionForPdfFile(){return{responseType:"blob",headers:new Je.WM({Authorization:this.authService.getAuth().token})}}getPrintFileName(i,n,s){const p={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getPrintFileName",{voucherprefix:i,companyid:n,billformats:s},p)}getNumberToWords(i,n,s,p){const b={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getNumberToWords",{vchrno:i,division:n,phiscalid:s,companyid:p},b)}print(i){const n=new Blob([i],{type:"application/pdf"}),s=URL.createObjectURL(n),p=document.createElement("iframe");p.style.display="none",p.src=s,document.body.appendChild(p),p.contentWindow.print()}}return T.\u0275fac=function(i){return new(i||T)(e.LFG(Je.eN),e.LFG(we.e))},T.\u0275prov=e.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var Et=E(71800),It=E(71259);function qe(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw(2);return e.KtG(p.selectAll=s)})("change",function(s){e.CHM(i);const p=e.oxw(2);return e.KtG(p.onSelectAllChange(s))}),e.qZA()}if(2&T){const i=e.oxw(2);e.Q6J("ngModel",i.selectAll)}}function Pt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortChalanData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function yt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortChalanData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function ke(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function xt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Rt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Nt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Lt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.ISSELECTED=s)})("change",function(s){e.CHM(i);const p=e.oxw().$implicit,b=e.oxw(2);return e.KtG(b.onSelectChange(s,p))}),e.qZA()}if(2&T){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ISSELECTED)}}function wt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td"),e.YNc(2,Lt,1,1,"input",18),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td")(15,"input",31),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.QTY=s)})("change",function(){const p=e.CHM(i).$implicit,b=e.oxw(2);return e.KtG(b.onChangeQty(p))}),e.qZA()()()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(2);e.xp6(2),e.Q6J("ngIf",0!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.REF_VOUCHER),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Oqu(i.DELIVEREDQTY),e.xp6(2),e.Q6J("ngModel",i.QTY)("disabled",2!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan||1==s.masterService.userSetting.EnablePetrolPumpFeatures)}}function nt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),e._uU(8,"Customer Name:"),e.qZA(),e.TgZ(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.BILLTO=s)}),e.qZA()(),e.TgZ(10,"div",10)(11,"label"),e._uU(12,"As on Date:"),e.qZA(),e.TgZ(13,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.toDate=s)})("change",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onDateChange())}),e.qZA()(),e.TgZ(14,"div",7)(15,"label"),e._uU(16,"Voucher No:"),e.qZA(),e.TgZ(17,"ng-multiselect-dropdown",12),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.DELIVERYREF=s)})("onSelect",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onSelect(s))})("onDeSelect",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onDeSelect(s))})("onSelectAll",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onSelectAll(s))})("onDeSelectAll",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onDeSelectAll(s))}),e.qZA()(),e.TgZ(18,"div",13)(19,"button",14),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(20," \xd7 "),e.qZA()()()()(),e._UZ(21,"hr"),e.qZA(),e.TgZ(22,"div",15)(23,"table")(24,"thead")(25,"tr",16)(26,"th",17),e.YNc(27,qe,1,1,"input",18),e._uU(28," S.No. "),e.qZA(),e.TgZ(29,"th",19),e._uU(30," Chalan No "),e.YNc(31,Pt,2,0,"span",20),e.YNc(32,yt,2,0,"span",21),e.qZA(),e.TgZ(33,"th",19),e._uU(34," Item Code "),e.YNc(35,ke,2,0,"span",20),e.YNc(36,xt,2,0,"span",21),e.qZA(),e.TgZ(37,"th",22),e._uU(38," Item Name "),e.YNc(39,Rt,2,0,"span",20),e.YNc(40,Nt,2,0,"span",21),e.qZA(),e.TgZ(41,"th",23),e._uU(42,"Unit"),e.qZA(),e.TgZ(43,"th",23),e._uU(44,"Delivered Qty"),e.qZA(),e.TgZ(45,"th",23),e._uU(46,"Billed Qty"),e.qZA()(),e.YNc(47,wt,16,9,"tr",24),e.qZA(),e._UZ(48,"tbody",25),e.qZA()(),e.TgZ(49,"div",26)(50,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApply())}),e._uU(51,"Apply"),e.qZA(),e.TgZ(52,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReset())}),e._uU(53,"Reset"),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(9),e.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),e.xp6(4),e.Q6J("ngModel",i.toDate),e.xp6(4),e.Q6J("placeholder","Select Voucher")("ngModel",i._trnMainService.TrnMainObj.DELIVERYREF)("settings",i.dropdownSettings)("data",i.vchrDetail),e.xp6(10),e.Q6J("ngIf",0!=i.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),e.xp6(4),e.Q6J("ngIf","asc"==i.chalanSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.chalanSortOrder||!i.chalanSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemNameSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),e.xp6(7),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.SalesDeliveryList)}}let Dt=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=p,this.isActive=!1,this.fromDate=new Date,this.vchrDetail=[],this.chalanSortOrder="asc",this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){this.dropdownSettings={singleSelection:!1,selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:2,allowSearchFilter:!0,maxHeight:170};const i=new Date;this.currDate=(0,w.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.vchrDetail=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO)),this.isActive=!0})}sortChalanData(i){this.chalanSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.REF_VOUCHER.localeCompare(s.REF_VOUCHER):(n,s)=>s.REF_VOUCHER.localeCompare(n.REF_VOUCHER))}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onSelect(i){this.spinnerService.show("Loading Data..."),this.masterService.getDeliveryChalanProdDetails(i,"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&n.result.forEach(s=>{this.assignInList(s)})),this.checkIsSelected()})}onDeSelect(i){this._trnMainService.TrnMainObj.SalesDeliveryList=this._trnMainService.TrnMainObj.SalesDeliveryList.filter(n=>n.REF_VOUCHER!==i),this.checkIsSelected()}onSelectAll(i){this.spinnerService.show("Loading data..."),this.masterService.getDeliveryChalanProdDetails(i.join(),"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&(this._trnMainService.TrnMainObj.SalesDeliveryList=[],n.result.forEach(s=>{this.assignInList(s)}))),this.checkIsSelected()})}onDeSelectAll(i){this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.selectAll=!1}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.SalesDeliveryList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.SalesDeliveryList?.length}assignInList(i){this._trnMainService.TrnMainObj.SalesDeliveryList||(this._trnMainService.TrnMainObj.SalesDeliveryList=[]);let n={};n.REF_VOUCHER=i.VCHRNO,n.MENUCODE=i.MENUCODE,n.BATCH=i.BATCH,n.DELIVEREDQTY=i.ALTERNATEQUANTIY,n.QTY=i.ALTERNATEQUANTIY,n.MCODE=i.MCODE,n.ITEMDESC=i.ITEMDESC,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.ISSELECTED=!0,n.ALTRATE=i.ALTRATE,n.BASEUNIT=i.BASEUNIT,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,n.DISMODE=i.DISMODE,this._trnMainService.TrnMainObj.SalesDeliveryList.push(n)}onSelectChange(i,n){n.QTY=i.target.checked?n.DELIVEREDQTY:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.QTY=n.DELIVEREDQTY):(n.ISSELECTED=!1,n.QTY=0)})}hide(){if(this._trnMainService.TrnMainObj.ProdList?.some(i=>i.ITEMDESC)){if(!confirm("Applied items in the list will be removed. Do you want to proceed?"))return;this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.addRow(),this.isActive=!1}else this.isActive=!1}onDateChange(){this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{this.vchrDetail=[],i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO))})}onChangeQty(i){i.QTY!==i.DELIVEREDQTY&&(i.ISSELECTED=!1,this.selectAll=!1),i.QTY>i.DELIVEREDQTY&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.DELIVEREDQTY}`),i.QTY=0)}onReset(){this.toDate=this.currDate,this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[]}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(i=>{let n={};n.ITEMDESC=i.ITEMDESC,n.BATCH=i.BATCH,n.ALTERNATEQUANTIY=i.QTY,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.BASEUNIT=i.BASEUNIT,n.ALTRATE=i.ALTRATE,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.REFDELIVERYBILL=i.REF_VOUCHER,n.RATE=n.ALTRATE/i.ALTCONFACTOR,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,i.QTY>0&&this._trnMainService.TrnMainObj.ProdList.push(n)}),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.MWAREHOUSE="Chalan Warehouse",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.isActive=!1,this._trnMainService.disableCustomerInputField=!0}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36($.c),e.Y36(Z.V),e.Y36(N.p))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-delivery-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"custom-asset-dropdown","w-100",3,"placeholder","ngModel","settings","data","ngModelChange","onSelect","onDeSelect","onSelectAll","onDeSelectAll"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change",4,"ngIf"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","30%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","disabled","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,nt,54,14,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.Fj,g.wV,g.Wl,g.JJ,g.On,It.O],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),T})();function jt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function kt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",28),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Be(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Vt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"span",28),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Ut(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"input",17),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ISSELECTED=s)})("change",function(s){const b=e.CHM(i).$implicit,W=e.oxw(2);return e.KtG(W.onSelectChange(s,b))}),e.qZA(),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td")(13,"input",29),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ALTERNATEQUANTIY=s)})("change",function(){const p=e.CHM(i).$implicit,b=e.oxw(2);return e.KtG(b.onChangeQty(p))}),e.qZA()()()}if(2&T){const i=A.$implicit,n=A.index;e.xp6(2),e.Q6J("ngModel",i.ISSELECTED),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Oqu(i.ALTQTY_IN),e.xp6(2),e.Q6J("ngModel",i.ALTERNATEQUANTIY)}}function Bt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),e._uU(8,"Supplier Name:"),e.qZA(),e.TgZ(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.BILLTO=s)}),e.qZA()(),e.TgZ(10,"div",10)(11,"label"),e._uU(12,"As on Date:"),e.qZA(),e.TgZ(13,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.toDate=s)})("change",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onDateChange())}),e.qZA()(),e.TgZ(14,"div",12)(15,"button",13),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(16," \xd7 "),e.qZA()()()()(),e._UZ(17,"hr"),e.qZA(),e.TgZ(18,"div",14)(19,"table")(20,"thead")(21,"tr",15)(22,"th",16)(23,"input",17),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.selectAll=s)})("change",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onSelectAllChange(s))}),e.qZA(),e._uU(24," S.No. "),e.qZA(),e.TgZ(25,"th",18),e._uU(26," Item Code "),e.YNc(27,jt,2,0,"span",19),e.YNc(28,kt,2,0,"span",20),e.qZA(),e.TgZ(29,"th",21),e._uU(30," Item Name "),e.YNc(31,Be,2,0,"span",19),e.YNc(32,Vt,2,0,"span",20),e.qZA(),e.TgZ(33,"th",22),e._uU(34,"Unit"),e.qZA(),e.TgZ(35,"th",22),e._uU(36,"Approved Qty"),e.qZA(),e.TgZ(37,"th",22),e._uU(38,"Order Qty"),e.qZA()(),e.YNc(39,Ut,14,7,"tr",23),e.qZA(),e._UZ(40,"tbody",24),e.qZA()(),e.TgZ(41,"div",25)(42,"button",26),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApply())}),e._uU(43,"Apply"),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(9),e.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),e.xp6(4),e.Q6J("ngModel",i.toDate),e.xp6(10),e.Q6J("ngModel",i.selectAll),e.xp6(4),e.Q6J("ngIf","asc"==i.itemSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemNameSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),e.xp6(7),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.AdditionProdList)}}let Kt=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=p,this.isActive=!1,this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){const i=new Date;this.currDate=(0,w.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.isActive=!0,this.spinnerService.show("Loading data...."),this._trnMainService.TrnMainObj.AdditionProdList=[],this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}pushToList(i){null==this._trnMainService.TrnMainObj.AdditionProdList&&(this._trnMainService.TrnMainObj.AdditionProdList=[]);let n={};n.ALTCONFACTOR=i.ALTCONFACTOR,n.ALTERNATEQUANTIY=i.ALTERNATEQUANTIY,n.ALTUNIT=i.ALTUNIT,n.CRATE=i.CRATE,n.ALTRATE=i.CRATE,n.RATE=n.ALTRATE/n.ALTCONFACTOR,n.ITEMDESC=i.ITEMDESC,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.UNIT=i.BASEUNIT,n.BASEUNIT=i.BASEUNIT,n.WAREHOUSE=i.WAREHOUSE,n.ISSELECTED=!0,n.Product=i.Product,n.ALTQTY_IN=i.ALTERNATEQUANTIY,n.ISVAT=i.VAT,n.MRP=i.MRP,this._trnMainService.TrnMainObj.AdditionProdList.push(n)}onDateChange(){this.spinnerService.show("Loading data...."),this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),this._trnMainService.TrnMainObj.AdditionProdList=[],i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}hide(){this.isActive=!1}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onChangeQty(i){i.ALTERNATEQUANTIY!==i.ALTQTY_IN&&(i.ISSELECTED=!1,this.selectAll=!1),i.ALTERNATEQUANTIY>i.ALTQTY_IN&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.ALTQTY_IN}`),i.ALTERNATEQUANTIY=0)}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.AdditionProdList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.AdditionProdList?.length}onSelectChange(i,n){n.ALTERNATEQUANTIY=i.target.checked?n.ALTQTY_IN:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.ALTERNATEQUANTIY=n.ALTQTY_IN):(n.ISSELECTED=!1,n.ALTERNATEQUANTIY=0)})}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.ProdList=(0,H.cloneDeep)(this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.callPipe=!this._trnMainService.callPipe,this.hide()}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36($.c),e.Y36(Z.V),e.Y36(N.p))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-requisition-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","45%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,Bt,44,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.Fj,g.wV,g.Wl,g.JJ,g.On],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),T})();var Ze=E(71180);let Zt=(()=>{class T{constructor(i,n){this.http=i,this.state=n;const s=this.state.getGlobalSetting("apiUrl");s&&s.length>0&&(this.apiUrl=s)}loadAdditionalCostDetailsInImportPI(i){return this.http.get(this.apiUrl+`/loadAdditionalCostDetailsInImportPI?vchrno=${i}`)}}return T.\u0275fac=function(i){return new(i||T)(e.LFG(Je.eN),e.LFG(Ze.q))},T.\u0275prov=e.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const Ft=["genericGridCreditAccount"];function Ht(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",45),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.ok())})("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.ok())}),e._uU(1,"OK"),e.qZA()}if(2&T){const i=e.oxw(2);e.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode||"EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Qt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.saveImportDetails())}),e._uU(1,"SAVE"),e.qZA()}if(2&T){const i=e.oxw(2);e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Gt(T,A){1&T&&e._UZ(0,"option",57),2&T&&e.Q6J("value",A.$implicit.ITEMDESC)}function Yt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr",47),e.NdJ("click",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.rowClick(p))})("keydown.Shift.delete",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.deleteRow(p))}),e.TgZ(1,"td",48),e._uU(2),e.qZA(),e.TgZ(3,"td",49)(4,"input",50),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ITEMNAME=s)})("keydown.Enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.masterservice.focusAnyControl("importQty"+p))})("focus",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.rowClick(p))}),e.qZA(),e.TgZ(5,"datalist",51),e.YNc(6,Gt,1,1,"option",52),e.qZA()(),e.TgZ(7,"td",53)(8,"input",54),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.QUANTITY=s)})("keydown.Enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.masterservice.focusAnyControl("importTaxable"+p))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onQuantityChange())}),e.qZA()(),e.TgZ(9,"td",53)(10,"input",55),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.TAXABLE=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.masterservice.focusAnyControl("importNonTaxable"+p))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onTaxableChange())}),e.qZA()(),e.TgZ(11,"td",53)(12,"input",55),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.NONTAXABLE=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.masterservice.focusAnyControl("importVAT"+p))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onNonTaxableChange())}),e.qZA()(),e.TgZ(13,"td",53)(14,"input",55),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.VAT=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.masterservice.focusAnyControl("importNetmant"+p))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onVatChange())}),e.qZA()(),e.TgZ(15,"td",53)(16,"input",56),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.NETAMOUNT=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.nextRow(p))})("keydown.tab",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.nextRow(p))}),e.qZA()()()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.MGl("id","importItemname",n,""),e.Q6J("ngModel",i.ITEMNAME)("disabled","EDIT"==s.tranMode),e.xp6(2),e.Q6J("ngForOf",s.productList),e.xp6(2),e.MGl("id","importQty",n,""),e.Q6J("ngModel",i.QUANTITY)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importTaxable",n,""),e.Q6J("ngModel",i.TAXABLE)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importNonTaxable",n,""),e.Q6J("ngModel",i.NONTAXABLE)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importVAT",n,""),e.Q6J("ngModel",i.VAT)("disabled",!0),e.xp6(2),e.MGl("id","importNetmant",n,""),e.Q6J("ngModel",i.NETAMOUNT)("disabled","EDIT"==s.tranMode)}}function Jt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),e._uU(4,"IMPORT DOCUMENT DETAILS"),e.qZA(),e.TgZ(5,"div",7),e.YNc(6,Ht,2,1,"button",8),e.TgZ(7,"button",9),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onclear())})("keydown.F3",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onclear())}),e._uU(8,"RESET"),e.qZA(),e.YNc(9,Qt,2,2,"button",10),e.TgZ(10,"button",11),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(11,"CANCEL"),e.qZA()()(),e.TgZ(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16)(17,"span",17),e._uU(18,"Import Document No:"),e.qZA(),e.TgZ(19,"div",18)(20,"input",19,20),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO=s)}),e.qZA()()(),e.TgZ(22,"div",16),e._uU(23),e.TgZ(24,"fieldset",21)(25,"legend",22)(26,"input",23),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s)})("change",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s.target.checked?1:0)}),e.qZA(),e._uU(27,"Do Accounting of VAT Amount"),e.qZA(),e.TgZ(28,"div",14)(29,"span",24),e._uU(30,"VAT Credit A/C:"),e.qZA(),e.TgZ(31,"div",25)(32,"input",26),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=s)})("keydown.Enter",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.AccountEnterCommand(s))}),e.qZA()()()()()(),e.TgZ(33,"div",27)(34,"div",16)(35,"span",28),e._uU(36,"L/C No.:"),e.qZA(),e.TgZ(37,"div",18)(38,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM=s)}),e.qZA()(),e.TgZ(39,"div",30)(40,"button",31),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadImportDetails())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadImportDetails())}),e._uU(41,"LOAD INVOICE DETAIL"),e.qZA()()(),e.TgZ(42,"div",16)(43,"span",28),e._uU(44,"Declare VAT:"),e.qZA(),e.TgZ(45,"div",18)(46,"input",32),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT=s)})("keydown.enter",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onDeclareVat(s.target.value))})("input",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onDeclareVat(s.target.value))}),e.qZA()(),e.TgZ(47,"div",30)(48,"button",31),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadAdditionalCost())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadAdditionalCost())}),e._uU(49,"LOAD FROM ADDITIONAL COST"),e.qZA()()()()(),e.TgZ(50,"div",14)(51,"label",33),e._uU(52,"Import Details "),e.qZA()(),e.TgZ(53,"div",14)(54,"div",34)(55,"table",35)(56,"thead")(57,"tr",36)(58,"th",37),e._uU(59,"Sn."),e.qZA(),e.TgZ(60,"th",38),e._uU(61,"Item Name"),e.qZA(),e.TgZ(62,"th",39),e._uU(63,"Qty"),e.qZA(),e.TgZ(64,"th",39),e._uU(65,"Taxable"),e.qZA(),e.TgZ(66,"th",39),e._uU(67,"Non-Taxable"),e.qZA(),e.TgZ(68,"th",39),e._uU(69,"VAT"),e.qZA(),e.TgZ(70,"th",39),e._uU(71,"Net amount"),e.qZA()()(),e.TgZ(72,"tbody",40),e.YNc(73,Yt,17,20,"tr",41),e.qZA()()()(),e.TgZ(74,"div",14)(75,"table",35)(76,"tr",42)(77,"th",43),e._uU(78,"TOTAL"),e.qZA(),e.TgZ(79,"th",44),e._uU(80),e.qZA(),e.TgZ(81,"th",44),e._uU(82),e.qZA(),e.TgZ(83,"th",44),e._uU(84),e.qZA(),e.TgZ(85,"th",44),e._uU(86),e.qZA(),e.TgZ(87,"th",44),e._uU(88),e.qZA()()()()()()()()}if(2&T){const i=e.oxw();e.xp6(6),e.Q6J("ngIf","NEW"==i._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngIf","VIEW"==i._trnMainService.TrnMainObj.Mode),e.xp6(11),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)("disabled","EDIT"==i.tranMode),e.xp6(3),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport," "),e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)("disabled","EDIT"==i.tranMode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME)("disabled","EDIT"==i.tranMode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)("disabled","EDIT"==i.tranMode),e.xp6(2),e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)("disabled","EDIT"==i.tranMode),e.xp6(2),e.Q6J("disabled",null==i._trnMainService.TrnMainObj.ProdList[0].MENUCODE)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(25),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),e.xp6(7),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALQTY," "),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE," "),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE,""),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,""),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.NETAMOUNT,"")}}let qt=(()=>{class T{constructor(i,n,s,p,b,W){this.masterservice=i,this._trnMainService=n,this.spinnerService=s,this.alertservice=p,this.authservice=b,this.importPurchaseService=W,this.productList=[],this.importrowindex=0,this.DoVatAmtAccountForImport=!0,this.loadFromAdditionalCost=!1,this.genericGridCreditAccountSetting=new Q.im,this.userSetting=this.authservice.getSetting(),null==n.TrnMainObj.IMPORTDETAILS&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={})}onclear(){this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.masterservice.allowAddNextRow=!0,this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1,this.addRow()}closeDialog(){"NEW"==this._trnMainService.TrnMainObj.Mode?this._trnMainService.TrnMainObj?.IMPORTDETAILS?.prodList?.filter(i=>i.ITEMNAME)?.length>0?confirm("Applied Import Details will be removed. Click OK to confirm!")&&(this.onclear(),this.isActive=!1):(this.onclear(),this.isActive=!1):this.isActive=!1}show(){this.isActive=!0,setTimeout(()=>{document.getElementById("documentno").focus()},500),(!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList||!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length||null==this._trnMainService.TrnMainObj.IMPORTDETAILS)&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.addRow()),this.productList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.MENUCODE),console.log("product list",this.productList)}hide(){this.isActive=!1}ok(){if(console.log("IMPORTDETAILS",this._trnMainService.TrnMainObj.IMPORTDETAILS),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=this.DoVatAmtAccountForImport?1:0,("NEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode)&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C")}this.isActive=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}addRow(){try{console.log("add row"),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push({})}catch(n){console.log(n),alert(n)}}rowClick(i){this.importrowindex=i}focusToQty(){let i=this.importrowindex;setTimeout(()=>{document.getElementById("importQty"+i).focus()},200);var n=this.masterservice.groupBy(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList,function(s){return[s.ITEMNAME]});for(const s of n)if(s.length>1)return void this.alertservice.warning("Cannot enter same item")}nextRow(i){if(""==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME)return void this.alertservice.info("Item Description is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].QUANTITY))return void this.alertservice.info("Quantity is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NONTAXABLE)){if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].TAXABLE))return void this.alertservice.info("Taxable amount is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].VAT))return void this.alertservice.info("Vat amount is missing")}if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NETAMOUNT))return void this.alertservice.info("Net Amount is missing");this.RecalculateImportDetails();let n=this.importrowindex+1;1==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),this.addRow(),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200)),0==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200))}enterName(i){setTimeout(()=>{document.getElementById("importQty"+i).focus()},200)}RecalculateImportDetails(){try{this._trnMainService.TrnMainObj.IMPORTDETAILS&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this._trnMainService.calculateImportProdTotalValue()}catch(i){this.alertservice.info("Error in import details calculation: "+i)}}initializeTotalCalcProperty(){}onNonTaxableChange(){this.RecalculateImportDetails()}onTaxableChange(){this.RecalculateImportDetails()}onVatChange(){this.RecalculateImportDetails()}onQuantityChange(){this.RecalculateImportDetails()}deleteRow(i){confirm("Are you sure you want to delete this row ?")&&(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.splice(i,1),0===this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this.addRow())}loadImportDetails(){this.loadFromAdditionalCost=!1,this.masterservice.allowAddNextRow=!1,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.initializeTotalCalcProperty();for(const i of this._trnMainService.TrnMainObj.ProdList){let n={};n.ITEMNAME=i.ITEMDESC,n.QUANTITY=i.Quantity,n.VAT=1==i.ISVAT?(i.AMOUNT-i.DISCOUNT)*this.userSetting.VATRate:0,n.TAXABLE=0,n.NONTAXABLE=0,n.ISVAT=i.ISVAT,1==i.ISVAT&&(n.TAXABLE=i.AMOUNT-i.DISCOUNT),0==i.ISVAT&&(n.NONTAXABLE=i.AMOUNT-i.DISCOUNT),n.NETAMOUNT=n.TAXABLE+n.NONTAXABLE+n.VAT,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(n),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),this._trnMainService.calculateImportProdTotalValue()}this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}onDeclareVat(i){this.loadFromAdditionalCost?this.calculationForLoadFromAdditionalCost(this.loadFromAdditionalCostResponse):this.loadImportDetails(),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.filter(n=>1==n.ISVAT).forEach(n=>{n.VAT=this._trnMainService.nullToZeroConverter(Number((this._trnMainService.nullToZeroConverter(n.TAXABLE)/this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE*i).toFixed(2))),n.TAXABLE=this._trnMainService.nullToZeroConverter(n.VAT)/this.masterservice.userSetting.VATRate,n.NETAMOUNT=this._trnMainService.nullToZeroConverter(n.TAXABLE)+n.VAT}),this.adjustDifferenceInDeclareVatAndActualVat(),this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.AdditionalObj.VATAMNT=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,this._trnMainService.TrnMainObj.AdditionalObj.TAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE,this._trnMainService.TrnMainObj.AdditionalObj.NONTAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE}adjustDifferenceInDeclareVatAndActualVat(){const i=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.map(b=>b.VAT).reduce((b,W)=>b+W,0),n=Number((i-this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT).toFixed(2));let s=0,p=0;for(let b of this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)1==b.VAT&&(p=s),s++;if(Math.abs(n)>0){const W=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[p];W.VAT=Number(n<0?(W.VAT+Math.abs(n)).toFixed(2):(W.VAT-n).toFixed(2))}}removeInvalidRowFromImportDetils(i){return i.filter(n=>null!=n.ITEMNAME&&null!=n.ITEMNAME)}saveImportDetails(){if("VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C");if(this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT!=this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)return void this.alertservice.info("Declare vat and Total Vat amount is  not equall")}this.spinnerService.show("Saving import details....."),this._trnMainService.TrnMainObj.IMPORTDETAILS.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,this.masterservice.saveImportDetail(this._trnMainService.TrnMainObj.IMPORTDETAILS).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.alertservice.success("Import details saved Successfully !"),setTimeout(()=>{this.hide()},1200)):(this.spinnerService.hide(),this.alertservice.error(i.result))},i=>{this.spinnerService.hide(),this.alertservice.error(i)})}AccountEnterCommand(i){this.genericGridCreditAccountSetting={title:"Accounts",apiEndpoints:"/getAccountPagedListByMapId/Master/default",defaultFilterIndex:1,columns:[{key:"ACCODE",title:"AC CODE",hidden:!1,noSearch:!1},{key:"ACNAME",title:"A/C NAME",hidden:!1,noSearch:!1}]},this.genericGridCreditAccount.show()}onAccountSelect(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC=i.ACID,this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=i.ACNAME}calculationForLoadFromAdditionalCost(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.spinnerService.hide();for(const n of i){let s={};s.ITEMNAME=n.ITEMDESC,s.QUANTITY=n.Quantity,s.NETAMOUNT=n.NETAMOUNT,s.VAT=n.VAT,s.ISVAT=n.ISVAT,s.NONTAXABLE=0,1==n.ISVAT&&(s.TAXABLE=n.TAXABLE),0==n.ISVAT&&(s.NONTAXABLE=n.AMOUNT-n.DISCOUNT),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(s),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)}this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}loadAdditionalCost(){this.spinnerService.show("Loading Data, Please Wait...."),this.importPurchaseService.loadAdditionalCostDetailsInImportPI(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{i&&(this.loadFromAdditionalCost=!0,this.loadFromAdditionalCostResponse=i,this.calculationForLoadFromAdditionalCost(i))},i=>{this.spinnerService.hide(),this.alertservice.error(i.error)})}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36(N.p),e.Y36(Z.V),e.Y36($.c),e.Y36(we.e),e.Y36(Zt))},T.\u0275cmp=e.Xpm({type:T,selectors:[["import-purchase-details"]],viewQuery:function(i,n){if(1&i&&e.Gf(Ft,5),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridCreditAccount=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,e.evT)},inputs:{tranMode:"tranMode"},decls:3,vars:2,consts:[["class","importdetail_container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridCreditAccount",""],[1,"importdetail_container"],[1,"card"],[1,"card-header",2,"background","#cbcbcb"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"disabled","keydown.F6","click",4,"ngIf"],["type","button","title","reset",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click","keydown.F3"],["title","SaveImportDetails","type","button","class","btn btn-info","style","margin-right:2px",3,"disabled","click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-horizontal",2,"margin-top","15px"],[1,"row"],[1,"col-md-6","pd0"],[1,"form-group","row",2,"align-items","center"],[1,"col-sm-4","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7"],["id","documentno","type","text","placeholder","Import Document No","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],["DocumentNo",""],[2,"width","89%","border-radius","3px"],[1,"legend-class",2,"font-size","14px","width","45%"],["type","checkbox","id","vatAmountAccounting",2,"margin-right","3%",3,"ngModel","disabled","ngModelChange","change"],[1,"col-sm-3","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7",2,"margin-left","50px"],["type","text","autocomplete","off","placeholder","Press Enter to Select Account",1,"form-control",2,"width","113%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[1,"col-md-6"],[1,"col-sm-2","form-control-label","font",2,"margin-left","-12px"],["type","text","placeholder","L/C No.","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],[1,"col-sm-3"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.Enter","click"],["type","number","placeholder","Enter VAT amount","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange","keydown.enter","input"],[1,"form-control-label",2,"font-weight","bold","border-bottom","1px solid #e2e2e2","width","130px !important"],[1,"col-md-12","pd0",2,"height","40vh","margin-bottom","1rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","5%"],[2,"background-color","aliceblue"],["style","height: 28px;",3,"click","keydown.Shift.delete",4,"ngFor","ngForOf"],[2,"line-height","1.2rem"],["width","11%",2,"background","rgb(172 172 172)","border","2px white solid"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["title","SaveImportDetails","type","button",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click"],[2,"height","28px",3,"click","keydown.Shift.delete"],[2,"width","1%"],[2,"width","10%"],["type","text","list","product","autocomplete","off",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","focus"],["id","product"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","keydown.tab"],[3,"value"]],template:function(i,n){1&i&&(e.YNc(0,Jt,89,23,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(p){return n.onAccountSelect(p)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.genericGridCreditAccountSetting))},dependencies:[w.sg,w.O5,g.YN,g.Kr,g.Fj,g.wV,g.Wl,g.JJ,g.On,Q.Zl],styles:[".importdetail_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:80%;top:20.5%;left:14%}.font[_ngcontent-%COMP%]{font-size:12px;line-height:12px}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem;padding:0 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 4px 5px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}"]}),T})();function Wt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"Reverse Entry Confirmation"),e.qZA(),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(7,"SAVE"),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(9,"CANCEL"),e.qZA()()(),e.TgZ(10,"div",8)(11,"div",9)(12,"label",10),e._uU(13,"Invoice No :"),e.qZA(),e.TgZ(14,"div",11)(15,"input",12),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.AdditionalObj.CREFBILL=s)}),e.qZA()()(),e.TgZ(16,"div",13)(17,"label",14),e._uU(18,"Remarks of Reverse Entry:"),e.qZA(),e.TgZ(19,"div",11)(20,"textarea",15),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p._trnMainService.TrnMainObj.AdditionalObj.CREMARKS=s)}),e.qZA()()()()()()}if(2&T){const i=e.oxw();e.xp6(15),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREFBILL),e.xp6(5),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREMARKS)}}let $t=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.isActive=!1,this.onClickReverse=new e.vpe}ngOnInit(){}submit(){null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL?null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL.toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL==this._trnMainService.TrnMainObj.VCHRNO?(this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL,this.onClickReverse.emit()):this.alertService.warning(`Character case of ${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed  should also \n      match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning(`${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed should match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning("Enter reverse entry confirmation remarks"):this.alertService.warning("Enter Voucher no.")}closeDialog(){this.isActive=!1}show(i){console.log("SHOWNN",i),this.vchrno=i,this.isActive=!0}hide(){this.isActive=!1}onclear(){}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["reverse-entry-dialog"]],outputs:{onClickReverse:"onClickReverse"},decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label"],[1,"col-md-7"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&e.YNc(0,Wt,21,2,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.O5,g.Fj,g.JJ,g.On],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:57%;top:29.5%;left:26%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}"]}),T})();var zt=E(27389);function Xt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"button",3),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(3,"span",4),e._uU(4,"\xd7"),e.qZA()(),e._UZ(5,"qrcode",5)(6,"label",6)(7,"label",7),e.TgZ(8,"label",8)(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.traceIdStatus=s)})("change",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onChangeInput(s))}),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(5),e.Q6J("qrdata",i.qrString)("errorCorrectionLevel","M"),e.xp6(4),e.Q6J("ngModel",i.traceIdStatus)}}let ei=(()=>{class T{constructor(i,n,s,p,b){this._trnMainService=i,this.fb=n,this.masterService=s,this.spinnerService=p,this.alertService=b,this.onRefreshClick=new e.vpe,this.onDialogClosed=new e.vpe,this.onPaymentSuccess=new e.vpe,this.isPaymentSuccess=!1}ngOnInit(){}openSocket(i){i.onopen=function(n){console.log("[open] Connection established"),console.log("Sending to server...")},i.onmessage=function(n){console.log("[message] Data received from server",n.data),this.socketResponseData=JSON.parse(n.data),this.transactionStatus=JSON.parse(this.socketResponseData.transactionStatus),this.transactionStatus.qrVerified?(console.log("enter at tran message"),document.getElementById("qr_response_message").innerHTML="QR Code Verified"):this.transactionStatus.paymentSuccess&&(document.getElementById("qr_response_message").innerHTML="Payment Confirmed",console.log("PAYMENT SUCCESS TRACE ID",this.transactionStatus.traceId),document.getElementById("qr_traceId").innerHTML=this.transactionStatus.traceId)},i.onclose=function(n){console.log("SOCKET CLOSED",n),n.wasClean?console.log(`[close] Connection closed cleanly, code=${n.code} reason=${n.reason}`):console.log("[close] Connection died")},i.onerror=function(n){console.log(`[error] ${n}`)}}messageReceive(i){}show(i,n){let s=new WebSocket(n);this.openSocket(s),this.isActive=!0,this.qrString=i,this.SktURL=n,console.log("response bata k k catch huncha",this.qrString,this.SktURL)}cancelPopup(){this.isActive=!1}closeDialog(){this.isActive=!1,console.log("socket reposnce data",document.getElementById("qr_traceId").innerHTML);let i=document.getElementById("qr_traceId").innerHTML;this.onDialogClosed.emit(i)}refreshClick(){this.masterService.refreshForQRCode=!0,this.onRefreshClick.emit(this.masterService.refreshForQRCode)}onChangeInput(i){"Success"==i.target.defaultValue?(this.isActive=!1,this.isPaymentSuccess=!0,this.closeDialog(),this.onPaymentSuccess.emit(this.isPaymentSuccess)):(this.isActive=!0,this.isPaymentSuccess=!1)}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(N.p),e.Y36(g.qu),e.Y36(f.P),e.Y36(Z.V),e.Y36($.c))},T.\u0275cmp=e.Xpm({type:T,selectors:[["fonepay-QR-popup"]],outputs:{onRefreshClick:"onRefreshClick",onDialogClosed:"onDialogClosed",onPaymentSuccess:"onPaymentSuccess"},decls:1,vars:1,consts:[["class","fonepatQR_container","role","document","style","max-width: 23%; max-height: 500px; margin-left: 31%;",4,"ngIf"],["role","document",1,"fonepatQR_container",2,"max-width","23%","max-height","500px","margin-left","31%"],[1,"card",2,"height","80vh"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px",3,"click"],["aria-hidden","true"],[2,"text-align","center","margin-top","14%","position","inherit",3,"qrdata","errorCorrectionLevel"],["id","qr_response_message"],["id","qr_traceId",2,"color","white"],["id","qr_success",2,"color","white"],["type","text","id","inputTraceSuccess","name","inputTraceSuccess","hidden","",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,Xt,10,3,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.O5,g.Fj,g.JJ,g.On,zt.V],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:2px;height:30px;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:14px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 1rem;\n    }\n  \n    .fonepatQR_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      top: 17%;\n      left: 16%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n    }\n\n    .card[_ngcontent-%COMP%]{\n        background-image: url('assets/fonepay-bg.jpg');\n        background-size: cover;\n        width: 100%;\n        height: 100%;\n    }\n\n    label[_ngcontent-%COMP%]{\n      \n      font-size: 14px;\n      margin-left: 5rem;\n      margin-top: 10px;\n    }\n\n    #qr_response_message[_ngcontent-%COMP%]{\n      margin-top: 40%; \n      margin-left: 0;\n      color: seagreen;\n      width: 100%;\n      text-align: center;\n      font-weight: 500;\n      font-size: large;\n    }"]}),T})();function We(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",15)(1,"button",16),e.NdJ("click",function(){const p=e.CHM(i).$implicit,b=e.oxw(2);return e.KtG(b.showQR(p))}),e.qZA()()}if(2&T){const i=A.$implicit,n=e.oxw(2);e.xp6(1),e.Udp("background-image","url(assets/Images/"+i+".png)"),e.Q6J("disabled",n.isButtonDisabled)("value",i)}}function ti(T,A){if(1&T&&e._UZ(0,"img",21),2&T){const i=e.oxw(3);e.Q6J("src",i.qrString,e.LSH)}}function ii(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",17)(1,"button",18),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.closeDialogQR())}),e.TgZ(2,"span",19),e._uU(3,"\xd7"),e.qZA()(),e.YNc(4,ti,1,1,"img",20),e.qZA()}if(2&T){const i=e.oxw(2);e.xp6(4),e.Q6J("ngIf",i.qrString)}}function ni(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(4,"span",8),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",9)(7,"h3",10),e._uU(8,"Please Select The Payment Method:"),e.qZA()(),e.YNc(9,We,2,4,"div",11),e.TgZ(10,"div",12),e._UZ(11,"label",13),e.qZA()(),e.YNc(12,ii,5,1,"div",14),e.qZA()}if(2&T){const i=e.oxw();e.xp6(9),e.Q6J("ngForOf",i.mocoChannels),e.xp6(3),e.Q6J("ngIf",i.isActiveQR)}}let ri=(()=>{class T{constructor(i){this.masterService=i,this.onDialogClosed=new e.vpe,this.isButtonDisabled=!1}ngOnInit(){}showdata(i,n,s,p){this.isActiveShowChannel=!0,this.mocoChannels=i,this.selectedValue=this.mocoChannels[0],this.TenderAmt=n,this.CompanyId=s,this.trnmode=p}closeDialog(){this.isActiveShowChannel=!1,this.isActiveQR=!1}showQR(i){this.guid=_(),this.selectedValue=i,this.isButtonDisabled=!0,document.getElementById("qr_response_message").innerHTML="FetchingQR<br>Please wait...",this.masterService.getPaymentGateWayForMoco(this.TenderAmt,this.guid,this.CompanyId,this.trnmode,this.selectedValue).subscribe(n=>{if(this.isButtonDisabled=!1,"ok"==n.status&&n.result){document.getElementById("qr_response_message").innerHTML="pending",this.qrString=n.result,this.isActiveQR=!0;const s=this.qrString.split("/");this.token=s[s.length-2],this.rrn=n.result2,this.check()}else document.getElementById("qr_response_message").innerHTML="Please try again"},n=>{this.isButtonDisabled=!1,document.getElementById("qr_response_message").innerHTML="Please try again"})}check(){1==this.isActiveQR&&this.masterService.mococheck(this.token,this.selectedValue,this.rrn).subscribe(i=>{if("ok"==i.status)if(this.result=i.result,"Pending"==this.result)setTimeout(()=>{console.log("pending"),this.check()},5e3);else if("Approved"==this.result)console.log(i.result),this.onDialogClosed.emit(this.rrn),document.getElementById("qr_response_message").innerHTML=" Payment<br>Confirmed",setTimeout(()=>{this.isActiveQR=!1},1e3);else{if("Rejected"!=this.result)return void console.log(i.result);console.log(i.result)}})}closeDialogQR(){this.isActiveShowChannel=!0,this.isActiveQR=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-moco"]],hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,e.evT)},outputs:{onDialogClosed:"onDialogClosed"},decls:8,vars:1,consts:[["lang","en"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["class","mocoBody",4,"ngIf"],[1,"mocoBody"],[1,"MocoChannel_container"],[1,"close"],["aria-label","Close",2,"background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","20px"],[1,"div1"],[1,"heading"],["class","div2",4,"ngFor","ngForOf"],[1,"div3"],["id","qr_response_message"],["class","MOCOQR_container","role","document",4,"ngIf"],[1,"div2"],["type","button",1,"icon",3,"disabled","value","click"],["role","document",1,"MOCOQR_container"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px","background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","30px"],["alt","QR Code",3,"src",4,"ngIf"],["alt","QR Code",3,"src"]],template:function(i,n){1&i&&(e.TgZ(0,"html",0)(1,"head"),e._UZ(2,"meta",1)(3,"meta",2),e.TgZ(4,"title"),e._uU(5,"Fonepay QR Container"),e.qZA()(),e.TgZ(6,"body"),e.YNc(7,ni,13,2,"div",3),e.qZA()()),2&i&&(e.xp6(7),e.Q6J("ngIf",n.isActiveShowChannel))},dependencies:[w.sg,w.O5],styles:["body[_ngcontent-%COMP%] {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 0;\n    }\n\n    .mocoBody[_ngcontent-%COMP%] {\n      position: fixed;\n      z-index: 999999;\n      width: 100%;\n      height: 100%;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-between;\n      max-width: 400px;\n      max-height: 90vh;\n      background: #fffdfd;\n      border: 3px solid lightgray;\n      border-radius: 20px;\n      z-index: 99999;\n      padding-top: 20px;\n      padding-bottom: 20px\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      padding: 0;\n      font-size: 20px;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n      width: 200px;\n      margin-left: 5rem;\n      margin-top: 47px;\n      font-size: 14px;\n      padding: 5px;\n      height: auto;\n      padding-left: 68px;\n    }\n\n    .heading[_ngcontent-%COMP%] {\n      font-size: 20px;\n      font-weight: bold;\n      margin-bottom: 10px;\n      display: inline;\n\n    }\n\n\n    #qr_response_message[_ngcontent-%COMP%] {\n      margin-top: 11%;\n      color: seagreen;\n      text-align: center;\n      font-weight: 600;\n      font-size: large;\n      display: inline;\n    }\n\n    \n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div1[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-left: 37px;\n      width: 318px;\n      height: 23px;\n      left: 0px;\n      top: 45px;\n      position: absolute;\n      color: #1B62A3;\n      font-size: 16px;\n      font-family: Plus Jakarta Sans;\n      font-weight: 500;\n      word-wrap: break-word\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n\n      margin-left: 37px;\n      margin-top: -116px;\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div2[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      display: contents;\n      padding-bottom: 50px;\n\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div3[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-top: -46px;\n      align-self: center;\n      top: 346px;\n      position: absolute;\n      color: #0a0a0a;\n      font-size: 20px;\n      font-family: Plus Jakarta Sans;\n      font-weight: bold;\n      word-wrap: break-word\n    }\n\n\n\n\n    button[_ngcontent-%COMP%] {\n      margin-top: 117px;\n      padding: 6px 14px;\n      background-color: #007bff;\n      color: #ffffff;\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      font-size: 10px;\n      margin-left: 344px;\n      height: 26;\n    }\n\n    button.close[_ngcontent-%COMP%] {\n      color: #000;\n      background-color: transparent;\n\n    }\n\n    button[_ngcontent-%COMP%]:hover {\n      background-color: #0056b3;\n    }\n\n    .icon[_ngcontent-%COMP%] {\n      height: 60px;\n      width: 120px;\n      margin-left: 36px;\n      margin-right: 35px;\n      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\n\n      transition: border-color 0.2s;\n      margin-top: 65px;\n      margin-bottom: 0px;\n    }\n\n    .icon[_ngcontent-%COMP%]:hover {\n\n      background-color: #da3434;\n      transform: scale(1.1);\n      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);\n    }\n\n    .MOCOQR_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      max-height: 0;\n      top: -1%;\n      left: 22%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n      max-width: 23%;\n      margin-left: 31%;\n    }"]}),T})();var $e=E(89952);const oi=["genericGridAccount"],si=["fonePay"],ai=["moco"],ci=["genericGridSalesReturnVoucher"];function li(T,A){1&T&&e._UZ(0,"div",9)}function hi(T,A){if(1&T&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&T){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.PAYMENTMODENAME)}}function di(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",82)(1,"div",48)(2,"button",83),e.NdJ("click",function(){const p=e.CHM(i).$implicit,b=e.oxw(2);return e.KtG(b.onClickTrnMode(p))}),e.TgZ(3,"span"),e._UZ(4,"img"),e.qZA(),e.YNc(5,hi,2,1,"span",33),e.qZA()()()}if(2&T){const i=A.$implicit,n=e.oxw(2);e.xp6(2),e.Udp("background-image",n.logoURL(i.PAYMENTMODENAME)),e.ekj("clickedbutton",n.trnmode===i.PAYMENTMODENAME),e.Q6J("ngClass",i.noHoverEffect?"nohovereffect":"payment-button"),e.xp6(3),e.Q6J("ngIf",i.showAltText)}}function ui(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div")(1,"div",84)(2,"div",36)(3,"label",85),e._uU(4,"Account:"),e.qZA()(),e.TgZ(5,"div",37)(6,"input",86),e.NdJ("keydown.enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.showAccountList())}),e.qZA()()()()}}function pi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",84)(1,"div",36)(2,"label",85),e._uU(3,"CN No:"),e.qZA()(),e.TgZ(4,"div",37)(5,"input",87),e.NdJ("keydown.enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.showCreditNoteList())}),e.qZA()()()}}function _i(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td",88),e._uU(2),e.qZA(),e.TgZ(3,"td",89),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",90),e._uU(7),e.qZA(),e.TgZ(8,"td",91)(9,"button",92),e.NdJ("click",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.deletePayDetails(p))}),e._uU(10,"Remove"),e.qZA()()()}if(2&T){const i=A.$implicit;e.xp6(2),e.Oqu(i.TRNMODE),e.xp6(2),e.Oqu(e.xi3(5,3,i.ACTUALAMOUNT,"1.2-2")),e.xp6(3),e.Oqu(i.REMARKS)}}const Ti=function(T){return{tooltipChild:T}};function Mi(T,A){if(1&T){const i=e.EpF();e.ynx(0),e.TgZ(1,"span",93),e.NdJ("mouseleave",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.hoverLeaveDiscount())}),e.qZA(),e.BQk()}if(2&T){const i=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(2,Ti,1==i.hover))("innerHTML",i.hoverText,e.oJD)}}function mi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"h5"),e._uU(5,"BILL TENDER"),e.qZA(),e.TgZ(6,"h6",14),e._uU(7),e.qZA(),e.TgZ(8,"div",15)(9,"button",16),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit(s.form.value))})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(10,"SAVE [End]"),e.qZA(),e.TgZ(11,"button",17),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(12,"CANCEL [Esc]"),e.qZA()()()(),e.TgZ(13,"div")(14,"form",18)(15,"div",19)(16,"div",20)(17,"div",21)(18,"ul",22)(19,"li",23)(20,"a",24),e._uU(21,"Payment Info"),e.qZA()()(),e.TgZ(22,"div",25)(23,"div",26)(24,"div",27)(25,"div",28)(26,"div",29)(27,"div"),e.YNc(28,di,6,6,"div",30),e.qZA()()(),e.TgZ(29,"div",31)(30,"div",32),e.YNc(31,ui,7,0,"div",33),e.YNc(32,pi,6,0,"div",34),e.TgZ(33,"div",35)(34,"div",36)(35,"label"),e._uU(36,"Amount:"),e.qZA()(),e.TgZ(37,"div",37)(38,"input",38),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.changeAmount(s))})("keydown.enter",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.AmountOnEnter(s))})("keyup",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.rateChange(s))})("focusout",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.rateFocusOut(s))}),e.ALo(39,"twoDigitNumber"),e.qZA()()(),e.TgZ(40,"div",39)(41,"div",40)(42,"button",41),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.BalanceAmount())}),e._uU(43,"Balance Amount"),e.qZA()(),e.TgZ(44,"div",42)(45,"button",43),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.AddPayment())}),e._uU(46,"Add"),e.qZA()()(),e.TgZ(47,"div",44)(48,"div",45)(49,"div")(50,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("1"))}),e._uU(51,"1"),e.qZA()(),e.TgZ(52,"div")(53,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("2"))}),e._uU(54,"2"),e.qZA()(),e.TgZ(55,"div")(56,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("3"))}),e._uU(57,"3"),e.qZA()()(),e.TgZ(58,"div",45)(59,"div")(60,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("4"))}),e._uU(61,"4"),e.qZA()(),e.TgZ(62,"div")(63,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("5"))}),e._uU(64,"5"),e.qZA()(),e.TgZ(65,"div")(66,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("6"))}),e._uU(67,"6"),e.qZA()()(),e.TgZ(68,"div",45)(69,"div")(70,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("7"))}),e._uU(71,"7"),e.qZA()(),e.TgZ(72,"div")(73,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("8"))}),e._uU(74,"8"),e.qZA()(),e.TgZ(75,"div")(76,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("9"))}),e._uU(77,"9"),e.qZA()()(),e.TgZ(78,"div",45)(79,"div")(80,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("."))}),e._uU(81,"."),e.qZA()(),e.TgZ(82,"div")(83,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("0"))}),e._uU(84,"0"),e.qZA()(),e.TgZ(85,"div")(86,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(87,"Back"),e.qZA()()(),e.TgZ(88,"div",47)(89,"div",48)(90,"button",49),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.clearEntries())}),e._uU(91,"Clear"),e.qZA()()(),e.TgZ(92,"div",47)(93,"div",48)(94,"button",49),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.AddPayment())}),e._uU(95,"Enter"),e.qZA()()()()()(),e.TgZ(96,"div",50)(97,"fieldset",51)(98,"div")(99,"table",52)(100,"thead",53)(101,"tr",54)(102,"th",55),e._uU(103,"Mode"),e.qZA(),e.TgZ(104,"th",56),e._uU(105,"Amount"),e.qZA(),e.TgZ(106,"th",57),e._uU(107,"Account"),e.qZA(),e._UZ(108,"th",58),e.qZA()(),e.TgZ(109,"tbody",59),e.YNc(110,_i,11,6,"tr",60),e.qZA()()(),e.TgZ(111,"table",61)(112,"tbody",62)(113,"tr")(114,"td"),e._uU(115,"Tender Amount :"),e.qZA(),e.TgZ(116,"td",63),e._uU(117),e.ALo(118,"number"),e.qZA()(),e.TgZ(119,"tr")(120,"td"),e._uU(121,"Bill Amount :"),e.qZA(),e.TgZ(122,"td",63),e._uU(123),e.ALo(124,"number"),e.qZA()(),e.TgZ(125,"tr")(126,"td"),e._uU(127,"Due Amount :"),e.qZA(),e.TgZ(128,"td",63),e._uU(129),e.ALo(130,"number"),e.qZA()(),e.TgZ(131,"tr")(132,"td"),e._uU(133,"Change Amount :"),e.qZA(),e.TgZ(134,"td",63),e._uU(135),e.ALo(136,"number"),e.qZA()()()()()()()()()()(),e.TgZ(137,"div",64)(138,"fieldset",65)(139,"div",66)(140,"div",67)(141,"label",68),e._uU(142,"Gross:"),e.qZA()(),e.TgZ(143,"div",69)(144,"label",70),e._uU(145),e.ALo(146,"number"),e.qZA()()(),e.TgZ(147,"div",66)(148,"div",67)(149,"label",68),e._uU(150,"Discount:"),e.qZA()(),e.TgZ(151,"div",69)(152,"label",71),e.NdJ("mouseover",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hoverDiscount())}),e._uU(153),e.ALo(154,"number"),e.qZA(),e.YNc(155,Mi,2,4,"ng-container",33),e.qZA()(),e.TgZ(156,"div",66)(157,"div",67)(158,"label",72),e._uU(159,"Taxable Amount:"),e.qZA()(),e.TgZ(160,"div",69)(161,"label",70),e._uU(162),e.ALo(163,"number"),e.qZA()()(),e.TgZ(164,"div",66)(165,"div",67)(166,"label",73),e._uU(167,"Non-Taxable Amount:"),e.qZA()(),e.TgZ(168,"div",69)(169,"label",70),e._uU(170),e.ALo(171,"number"),e.qZA()()(),e.TgZ(172,"div",66)(173,"div",67)(174,"label",68),e._uU(175,"VAT:"),e.qZA()(),e.TgZ(176,"div",69)(177,"label",70),e._uU(178),e.ALo(179,"number"),e.qZA()()(),e.TgZ(180,"div",66)(181,"div",67)(182,"label",68),e._uU(183,"Net Amount:"),e.qZA()(),e.TgZ(184,"div",69)(185,"label",70),e._uU(186),e.ALo(187,"number"),e.qZA()()(),e.TgZ(188,"div",74)(189,"div",75)(190,"label",76),e._uU(191,"Due Amount:"),e.qZA()(),e.TgZ(192,"div",77)(193,"label",78),e._uU(194),e.ALo(195,"number"),e.qZA()()(),e.TgZ(196,"div",79)(197,"div",80)(198,"label",76),e._uU(199,"Change Amount:"),e.qZA()(),e.TgZ(200,"div",81)(201,"label",78),e._uU(202),e.ALo(203,"number"),e.qZA()()()()()()()()()()}if(2&T){const i=e.oxw();e.xp6(7),e.hij(" : ",i.trnmode," "),e.xp6(2),e.Q6J("disabled",i.form.invalid),e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(14),e.Q6J("ngForOf",i.paymentmodelist),e.xp6(3),e.Q6J("ngIf","CREDIT"==i.TenderMode||"CREDITCARD"==i.TenderMode||"OTHER"==i.TenderMode),e.xp6(1),e.Q6J("ngIf","salesreturnvoucher"==i.modevalue),e.xp6(6),e.Q6J("value",i.applyPipeInRate?e.lcZ(39,23,i.form.get("INPUTAMOUNT").value):i.form.get("INPUTAMOUNT").value)("readonly","Sales Return Voucher"==i.trnmode),e.xp6(4),e.Q6J("disabled","Sales Return Voucher"==i.trnmode),e.xp6(68),e.Q6J("ngForOf",i.paymentinfoList),e.xp6(7),e.Oqu(e.xi3(118,25,i.TENDERAMOUNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(124,28,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(130,31,i.DUEAMOUNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(136,34,i.CHANGEAMOUNT,"1.2-2")),e.xp6(10),e.Oqu(e.xi3(146,37,i._trnMainService.TrnMainObj.GROSSAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(154,40,i._trnMainService.TrnMainObj.TOTALDISCOUNT,"1.2-2")),e.xp6(2),e.Q6J("ngIf",i._trnMainService.TrnMainObj.TOTALDISCOUNT>0),e.xp6(7),e.Oqu(e.xi3(163,43,i._trnMainService.TrnMainObj.TAXABLE,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(171,46,i._trnMainService.TrnMainObj.NONTAXABLE,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(179,49,i._trnMainService.TrnMainObj.VATAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(187,52,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(195,55,i.DUEAMOUNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(203,58,i.CHANGEAMOUNT,"1.2-2"))}}let Si=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.okClicked=new e.vpe,this.isSubmitting=!1,this.isSubmitted=!1,this.onSave=new e.vpe,this.isActive=!1,this.mode="add",this.paymentinfoList=[],this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.gridPopupSettingsForAccount=new Q.im,this.gridPopupSettingsForSalesReturn=new Q.im,this.applyPipeInRate=!0,this.modeType="",this.TenderMode="",this.modevalue="",this.mainText="",this.hover=!1,this.hoverText="",this.totalFlatDiscount=0,this.forminit(),this.AppMode=U.N.appMode}get isTenderFormDisabled(){return this.moco.isActiveShowChannel||this.fonePay.isActive}ngOnInit(){}forminit(){this.initilizeForm(),this.masterService.masterGetmethod("/gettransactionmodes").subscribe(i=>{"ok"==i.status&&(this.paymentmodelist=i.result,this.paymentmodelist.forEach(n=>{n.character=n.ShortCutKey}),this.checkImage(this.paymentmodelist))},i=>{})}initilizeForm(){this.form=this.fb.group({INPUTAMOUNT:[""],TRNMODE:[""],BANKNAME:[""],ACID:[""]})}logoURL(i){return`url(assets/Images/${i.toUpperCase().replace(/\s/g,"")}.png`}submit(){if(!("salesreturnvoucher"==this._trnMainService.TrnMainObj.TRNMODE&&this.TENDERAMOUNT-this._trnMainService.TrnMainObj.NETAMNT>1e-5)||confirm("Bill Amount is Less Than Sales Return Voucher Amount. Do You Want To Proceed Anyway ?")){if(this.DUEAMOUNT>0)return void this.alertService.warning("Bill amount is due ! Cannot save..");this.paymentinfoList.filter(i=>"FONEPAY"==i.TRNMODE?.toUpperCase()&&"EPAYMENT"==i.MODE?.toUpperCase())[0]&&!this.validateFonepayTransaction()||this.paymentinfoList.filter(i=>"MOCO"==i.TRNMODE?.toUpperCase())[0]&&!this.validateMocoTransaction()||(this.isSubmitting=!0,console.log("list",this.paymentinfoList),this.okClicked.emit(this.paymentinfoList),this._trnMainService.onFlatDiscountClear(),this._trnMainService.discountSelectionEdit=!1)}}validateFonepayTransaction(){let i=this.paymentinfoList.filter(n=>"FONEPAY"==n.TRNMODE?.toUpperCase())[0];if(i)return null!=i.TRANSACTIONID&&null!=i.TRANSACTIONID&&""!=i.TRANSACTIONID||(this.alertService.warning("Transaction ID for FonePay not received yet. Cannot Save"),!1)}validateMocoTransaction(){let i=this.paymentinfoList.filter(n=>"MOCO"==n.TRNMODE?.toUpperCase())[0];if(i)return!!i.TRANSACTIONID||(console.log(i.TRANSACTIONID),this.alertService.warning("Payment is Not Completed"),!1)}onclear(){this.form.reset(),this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentinfoList=[],this.payDetails={}}closeDialog(){this.onclear(),this.isActive=!1}refreshClickHit(i){this.refreshHitValue=i,this.refreshHitValue&&this.AddPayment()}keyPress(i){const s=String.fromCharCode(i.charCode);/[0-9]/.test(s)||i.preventDefault()}show(){this.isActive=!0;let i=this.paymentmodelist.filter(n=>"Cash"===n.PAYMENTMODENAME)[0];this.onClickTrnMode(i),this.form.get("INPUTAMOUNT").enable(),this.payDetails.ACID=this.paymentmodelist.filter(n=>"CASH"===n.PAYMENTMODENAME?.toUpperCase())[0]?.ACID,setTimeout(()=>{document.getElementById("amountField").focus()},1e3)}hide(){this.onclear(),this.isActive=!1}AmountOnEnter(i){i.preventDefault();let n=i.target.value;0==n||null==n||null==n||""==n?this.BalanceAmount():this.AddPayment()}AddPayment(){if(this.payDetails.TRNMODE=this.form.get("TRNMODE").value,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),0==this._trnMainService.nullToZeroConverter(this.payDetails.TENDERAMT))return;let i=this.form.get("BANKNAME").value?.toUpperCase(),n=this.payDetails.TRNMODE;this.assignACIDValue(n,i),"FONEPAY"==n.toUpperCase()&&this.implementPhonePayLogic(),"MOCO"==this.payDetails.TRNMODE.toUpperCase()&&this.implementMOCOLogic();let s=this.paymentmodelist.filter(p=>p.PAYMENTMODENAME==this.payDetails.TRNMODE)[0]?.ACNAME;this.prepareRemarks(s),this.PaymentValidation(),this.initializeForm()}initializeForm(){this.form.patchValue({INPUTAMOUNT:null,BANKNAME:null})}assignACIDValue(i,n){this.payDetails.ACID="Sales Return Voucher"==i?this.form.get("ACID").value:"CREDIT"==this.TenderMode?.toUpperCase()||"CREDITCARD"==this.TenderMode?.toUpperCase()||"OTHER"==this.TenderMode?.toUpperCase()?this.paymentAccountList.filter(s=>s.ACNAME?.toUpperCase()===n)[0].ACID:this.paymentmodelist.find(s=>s.PAYMENTMODENAME==this.trnmode).ACID}prepareRemarks(i){console.log("tendermode",i,this.TenderMode),this.payDetails.REMARKS="FonePay"==this.payDetails.TRNMODE?"FonePay":"Sales Return Voucher"==this.payDetails.TRNMODE?this.form.get("BANKNAME").value:"MOCO"==this.payDetails.TRNMODE?"MOCO":"CREDIT"==this.TenderMode||"CREDITCARD"==this.TenderMode||"OTHER"==this.TenderMode?this.form.get("BANKNAME").value:i}implementPhonePayLogic(){this.payDetails.ACID=this.paymentmodelist.filter(i=>"FONEPAY"===i.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),this.payDetails.REMARKS="FonePay","EPAYMENT"==this.TenderMode?.toUpperCase()&&(this.guid=_(),this.masterService.getPaymentGateWayInfo(this.payDetails.TENDERAMT,this.guid,this.masterService.userProfile.CompanyInfo.COMPANYID,this.payDetails.TRNMODE).subscribe(i=>{"ok"==i.status&&(this.fonePayQRCode=i.result,this.scoketURL=i.result2,this.fonePay.show(this.fonePayQRCode,this.scoketURL))}))}implementMOCOLogic(){if(this.payDetails.ACID=this.paymentmodelist.filter(p=>"MOCO"===p.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),0==this.payDetails.TENDERAMT)return void this.alertService.info("Please Enter Tender Amount!");let i,n=this.payDetails.TENDERAMT,s=this.payDetails.TRNMODE;this.masterService.getMocoChannel().subscribe(p=>{"ok"==p.status&&(i=p.result,this.moco.showdata(i,n,this.masterService.userProfile.CompanyInfo.COMPANYID,s))})}BalanceAmount(){this.form.patchValue({INPUTAMOUNT:this.DUEAMOUNT}),this.masterService.focusAnyControl("amountField")}deletePayDetails(i){this.paymentinfoList.splice(i,1),this.totalCalculations(),this.genericFocus("Credit Card"==this.form.controls.TRNMODE.value||"Credit"==this.form.controls.TRNMODE.value?"accountfield":"salesreturnvoucher"==this.form.controls.TRNMODE.value?"cnnofield":"amountField")}onClickTrnMode(i){if(console.log("mvalue",i),i){let n=i.PAYMENTMODENAME;if(this.modeType=i.MODETYPE,this.TenderMode=i.MODE,this.modevalue=i.MODEVALUE,"EPAYMENT"==this.TenderMode?.toUpperCase()&&!i.GatewayInfo)return void this.alertService.info("Selected EPayment service is not activated yet!");this.form.patchValue({TRNMODE:n,INPUTAMOUNT:null,BANKNAME:null}),this.trnmode=n,this.TenderMode=this.TenderMode?.toUpperCase(),"CREDIT"==this.TenderMode||"CREDITCARD"==this.TenderMode||"OTHER"==this.TenderMode&&"Sales Return Voucher"!=n?(this.onpaymentmodechange(n),this.genericFocus("accountfield")):"Cash"==n?(this.form.get("INPUTAMOUNT").enable(),this.genericFocus("amountField")):"Sales Return Voucher"==n?(this.onpaymentmodechange(n),this.genericFocus("cnnofield")):(this.onpaymentmodechange(n),this.genericFocus("amountField"))}}totalCalculations(){this.TENDERAMOUNT=0,this.paymentinfoList?.length&&this.paymentinfoList.forEach(i=>this.TENDERAMOUNT+=i.AMOUNT),this.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT<1e-5?0:this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT,this.CHANGEAMOUNT=this.TENDERAMOUNT>this._trnMainService.TrnMainObj.NETAMNT?this.TENDERAMOUNT-this._trnMainService.TrnMainObj.NETAMNT:0}changeAmount(i){(null==i||null==i||0==i)&&(this.mainText="")}applyamount(i){}clearEntries(){this.mainText="",this.form.patchValue({INPUTAMOUNT:null})}pressKey(i){this.mainText+=i,this.form.patchValue({INPUTAMOUNT:this.mainText})}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}onpaymentmodechange(i){this.paymentAccountList=[];var n=this.paymentmodelist.filter(s=>(s.PAYMENTMODENAME??"").toUpperCase()==i.toUpperCase())[0];!this.validateBeforePaymentmodeChange(n)||(i&&(this._trnMainService.TrnMainObj.TRNMODE=n.MODEVALUE),this._trnMainService.TrnMainObj.TRNAC=null!=n.ACID&&""!=n.ACID?n.ACID:"",("CREDIT"==this.TenderMode?.toUpperCase()||"CREDITCARD"==this.TenderMode?.toUpperCase()||"OTHER"==this.TenderMode?.toUpperCase())&&this.masterService.masterGetmethod("/getpaymentmodelist?paymentmodename="+encodeURIComponent(i)).subscribe(s=>{"ok"==s.status?this.paymentAccountList=JSON.parse(s.result):alert(s.result)},s=>{alert(s)}))}validateBeforePaymentmodeChange(i){return!(null==this.paymentmodelist||0==this.paymentmodelist.length||null==i)}AddTender(i,n,s){let p={};p.TRNMODE=i.TRNMODE,p.VCHRNO=this.TrnmainObj.VCHRNO,p.DIVISION=this.TrnmainObj.DIVISION,p.REMARKS=i.REMARKS,p.AMOUNT=n,p.ACTUALAMOUNT=n,p.ACCOUNT=i.ACID,p.CARDNO=i.CARDNO,p.APPROVALCODE=i.APPROVALCODE,p.CARDHOLDERNAME=i.CARDHOLDERNAME,p.CHANGE=0,p.MODE=s,p.ADDRESS=i.ADDRESS,p.VATNO=i.VATNO,p.modevalue=this.modevalue,this.handleCashModeSecanarioWhileAddingTender(p,n,i),this.paymentinfoList.push(p),this.totalCalculations()}handleCashModeSecanarioWhileAddingTender(i,n,s){let p=0;"CASH"===s.TRNMODE.toUpperCase()&&(this._trnMainService.userProfile.CASH_AC&&this._trnMainService.userProfile.CASH_AC_NAME&&(i.ACCOUNT=this._trnMainService.userProfile.CASH_AC,i.REMARKS=this._trnMainService.userProfile.CASH_AC_NAME),p=n<this.getAmountWOCash()?n:this.getAmountWOCash(),i.ACTUALAMOUNT=p,i.CHANGE=n-i.ACTUALAMOUNT)}getAmountWOCash(){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.filter(i=>"CASH"!==i.TRNMODE.toUpperCase()).map(i=>i.AMOUNT).reduce((i,n)=>i+n,0)}getAmountWCash(){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.map(i=>i.AMOUNT).reduce((i,n)=>i+n,0)}PaymentValidation(){let i=this.payDetails.TRNMODE.toUpperCase();if("CASH"==i){var n=this.paymentinfoList.filter(s=>"Cash"==s.TRNMODE)[0];if(n)return void this.calculateCashAmount(n)}else if("CREDIT"==i||"CREDIT CARD"==i){if(!this.validatePaymentInCreditAndCard(i))return;if(this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return void this.validateDiscountAmount(0,this.DUEAMOUNT);if(this.payDetails.TENDERAMT>this._trnMainService.TrnMainObj.NETAMNT)return void this.alertService.info("Tender Amount is Greater Than Net Amount")}else if("Sales Return Voucher"==i&&this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return void this.validateDiscountAmount(1,this.DUEAMOUNT);console.log("detail",this.payDetails,this.TenderMode),this.AddTender(this.payDetails,this.payDetails.TENDERAMT,this.TenderMode)}validateDiscountAmount(i,n){if(0==this._trnMainService.nullToZeroConverter(n))return;let s="";0==i&&(s="Tender amount should not be greater than Due B/L Amount."),1==i&&(s='Total amount of the Voucher: "+ this.payDetails.REMARKS +" ,should not be greater than Due B/L Amount.'),this.alertService.emitShowHideSubject.subscribe(p=>{setTimeout(()=>{this.masterService.focusAnyControl("amountField")},0)})}calculateCashAmount(i){let n=0,s=this.getAmountWCash();n=this.payDetails.TENDERAMT<s?this.payDetails.TENDERAMT:this.getAmountWCash(),i.AMOUNT+=this.payDetails.TENDERAMT,i.ACTUALAMOUNT+=n,this.totalCalculations()}validatePaymentInCreditAndCard(i){let n=this.paymentinfoList.filter(s=>"CREDIT"==s.TRNMODE.toUpperCase()||"CREDIT CARD"==s.TRNMODE.toUpperCase());if(this.paymentinfoList.length&&n.length>0&&this.paymentinfoList.filter(s=>s.REMARKS==this.payDetails.REMARKS).length>0){let s="";return"CREDIT CARD"==i?s="Cannot add amount from same bank":"CREDIT"==i&&(s="Cannot add amount from party account"),this.alertService.info(s),!1}return!0}checkBankName(i){let n=this.form.get("BANKNAME"),s=this.form.get("INPUTAMOUNT");""==n.value||null==n.value||null==n.value?s.disable():s.enable()}handleKeyDownboardEvent(i){if(!0===this.isActive){"Escape"==i.code?this.isTenderFormDisabled||(i.preventDefault(),this.closeDialog()):"End"==i.code&&(i.preventDefault(),1==this.isActive&&0!=this._trnMainService.nullToZeroConverter(this.TENDERAMOUNT)&&(console.log("save payment"),this.paymentinfoList?.length>0&&this.submit()));let s=this.paymentmodelist.filter(p=>p.ShortCutKey==i.code)[0];if(null!=s)i.preventDefault(),1==this.isActive&&this.onClickTrnMode(s);else if("PageUp"==i.code){if(1==this.isActive){let p=this.getIndex();console.log("index",p),this.onClickTrnMode(0==p?this.paymentmodelist[0]:this.paymentmodelist[p-1])}}else if("PageDown"==i.code&&1==this.isActive){let p=this.getIndex();this.onClickTrnMode(p==this.paymentmodelist.length-1?this.paymentmodelist[this.paymentmodelist.length-1]:this.paymentmodelist[p+1])}}}getIndex(){return this.paymentmodelist.lastIndexOf(this.paymentmodelist.filter(i=>i.PAYMENTMODENAME==this.form.get("TRNMODE").value)[0])}showAccountList(){this.gridPopupSettingsForAccount={title:"Account List",apiEndpoints:"/getpaymentmodepagedlist",defaultFilterIndex:1,columns:[{key:"ACID",title:"Account ID",hidden:!1,noSearch:!1},{key:"ACNAME",title:"Account Name",hidden:!1,noSearch:!1},{key:"VATNO",title:"VatNo",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"Address",hidden:!1,noSearch:!1},{key:"MOBILE",title:"Mobile",hidden:!1,noSearch:!1}]},this.genericGridAccount.show()}showCreditNoteList(){this.gridPopupSettingsForSalesReturn={title:"Credit Note List",apiEndpoints:"/getpaymentmodepagedlist",defaultFilterIndex:1,columns:[{key:"VCHRNO",title:"Voucher no.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Net amount",hidden:!1,noSearch:!1,pipe:!0,alignment:"right"}]},this.genericGridSalesReturnVoucher.show()}onAccountSelected(i){this._trnMainService.TrnMainObj.CREDITLIMIT=i.CRLIMIT,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this.TenderMode&&"CREDIT"==this.TenderMode.toUpperCase()&&this.replacePreviousCustomerWithTenderModeCustomer(this._trnMainService.TrnMainObj,i),this.masterService.getCustomerwiseCreditLimit(i.ACID,this._trnMainService.TrnMainObj.TRNDATE).subscribe(n=>{this._trnMainService.TrnMainObj.BLAMOUNT=n.BL}),this.form.patchValue({BANKNAME:i.ACNAME}),this.genericFocus("amountField")}replacePreviousCustomerWithTenderModeCustomer(i,n){i.PARAC=n.ACID,i.BILLTO=n.ACNAME,i.BILLTOADD=n.ADDRESS,i.BILLTOTEL=n.VATNO,i.RECEIVEBY=n.CUSTID}onQrDialogClosed(i){this.paymentinfoList.find(s=>"FonePay"==s.TRNMODE).TRANSACTIONID=i}onDialogClosedMoco(i){this.paymentinfoList.find(s=>"MOCO"==s.TRNMODE).TRANSACTIONID=i}onSalesReturnVoucherSelect(i){this.form.patchValue({BANKNAME:i.VCHRNO,INPUTAMOUNT:i.NETAMNT,ACID:i.TRNAC})}checkImage(i){if(console.log("item",this.paymentmodelist),i.length>0)for(const n of i){const s=new Image;s.src=`assets/Images/${n.PAYMENTMODENAME.toUpperCase().replace(/\s/g,"")}.png`,s.onload=()=>{n.showAltText=!1,n.noHoverEffect=!0},s.onerror=p=>{n.showAltText=!0,n.noHoverEffect=!1}}}genericFocus(i){setTimeout(()=>{document.getElementById(i).focus()},500)}hoverDiscount(){this.hover=!0,this.totalFlatDiscount=this._trnMainService.TrnMainObj.ProdList.reduce((i,n)=>i+(n.FLATDISCOUNT??0),0),0!==this._trnMainService.TrnMainObj.TOTALDISCOUNT&&(this.hoverText=`<span>Indv Discount </span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT).toFixed(2)} <br>\n                  <span>Flat Discount</span> : ${this._trnMainService.nullToZeroConverter(this.totalFlatDiscount).toFixed(2)} <br> \n                  <span>Loyalty Discount</span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLOYALTY).toFixed(2)} <br>\n                  <span>Promotional Discount </span> : ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPROMOTION).toFixed(2)}\n    `)}hoverLeaveDiscount(i){this.hover=!1}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["payment-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(e.Gf(oi,5),e.Gf(si,5),e.Gf(ai,5),e.Gf(ci,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridAccount=s.first),e.iGM(s=e.CRH())&&(n.fonePay=s.first),e.iGM(s=e.CRH())&&(n.moco=s.first),e.iGM(s=e.CRH())&&(n.genericGridSalesReturnVoucher=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,e.evT)},outputs:{okClicked:"okClicked",onSave:"onSave"},decls:10,vars:4,consts:[["class","backdrop",4,"ngIf"],["class","payment-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridAccount",""],["genericGridSalesReturnVoucher",""],[3,"onRefreshClick","onDialogClosed"],["fonePay",""],[3,"onDialogClosed"],["moco",""],[1,"backdrop"],[1,"payment-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[2,"position","relative","top","3px"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"form-horizontal",2,"margin-top","15px",3,"formGroup"],[1,"row","col-sm-12"],[1,"col-sm-10",2,"margin-top","-15px","margin-left","-15px"],[1,"tabbable",2,"margin-left","-15px"],[1,"nav","nav-tabs",2,"background-color","#138496"],[1,"nav-item"],["href","#payment-info","data-toggle","tab",1,"nav-link","active"],[1,"tab-content"],["id","payment-info",1,"tab-pane","active"],[1,"row","col-sm-12",2,"margin-top","5px"],[1,"col-sm-1",2,"position","relative","top","6px","left","-25px"],[1,"payment-mode-container"],["class","form-group row","style","margin-bottom: 10px !important;",4,"ngFor","ngForOf"],[1,"col-sm-5",2,"padding-left","0px","padding-right","15px","left","80px","max-width","37%"],[1,"col-sm-12",2,"background-color","#f7f7f7","margin-left","0px","border","solid 2px #999999","height","25rem","padding","5px 0px 0px"],[4,"ngIf"],["class","form-group row","style","margin-bottom: 0px !important;",4,"ngIf"],[1,"form-group","row","col-md-12","pd0",2,"margin-bottom","0px !important"],[1,"col-md-3"],[1,"col-sm-9"],["id","amountField","type","number","formControlName","INPUTAMOUNT",1,"form-control",2,"font-size","13px !important","font-weight","500","text-align","center",3,"value","readonly","ngModelChange","keydown.enter","keyup","focusout"],[1,"form-group","row",2,"margin-bottom","5px !important","justify-content","space-around","width","95%","padding-left","15px"],[1,"col-sm-6","pl-0"],["type","button",1,"btn","btn-info",2,"width","100%",3,"disabled","click"],[1,"col-sm-6",2,"padding-left","50px","padding-right","0px"],["type","button",1,"btn","btn-info",2,"width","100%","margin-right","0px",3,"click"],[2,"position","relative","top","1rem","padding-right","12px"],[1,"form-group","row","keypad-row"],["type","button",1,"btn","number-button",3,"click"],[1,"form-group","row",2,"margin-bottom","5px !important"],[1,"col"],["type","button",1,"btn","large-button",3,"click"],[1,"col-sm-6",2,"position","relative","left","60px","padding","0px 8px","max-width","49%"],[2,"height","25rem","border","2px solid #999999"],[1,"table-striped"],[2,"background-color","#63bbb2"],[2,"position","sticky","top","0","line-height","1.5rem"],["scope","col",2,"width","7%","padding-left","6px"],["scope","col",2,"width","10%","text-align","right","padding-right","1rem"],["scope","col",2,"width","14%"],["scope","col",2,"width","4%"],[1,"bodytable"],[4,"ngFor","ngForOf"],[1,"table-striped",2,"width","100%","position","relative","top","1rem","border","1.5px solid #c3c3c3"],[1,"total"],[2,"text-align","right"],[1,"col-sm-2"],[1,"fieldset-class"],[1,"col-sm-12","row","amount-section"],[1,"col-sm-6","pd0"],[1,"totalLabel"],[1,"col-sm-6","p-0"],[1,"totalValue","pull-right"],[1,"totalValue","pull-right",3,"mouseover"],[1,"totalLabel",2,"width","6rem"],[1,"totalLabel",2,"width","7rem","font-size","11px"],[1,"col-md-12","row","p-0",2,"position","relative","top","5rem","margin-right","0px"],[1,"col-md-6","pd0"],[1,"amountLabel"],[1,"col-md-6","pd0",2,"text-align","left"],[1,"amountValue","pull-right"],[1,"col-md-12","row","p-0",2,"position","relative","top","6rem","margin-right","0px"],[1,"col-md-7","pd0"],[1,"col-md-5","pd0",2,"text-align","left"],[1,"form-group","row",2,"margin-bottom","10px !important"],["type","button",1,"btn",3,"ngClass","click"],[1,"form-group","row",2,"margin-bottom","0px !important"],[2,"padding-top","5px"],["id","accountfield","formControlName","BANKNAME","placeholder","Press Enter to Select Account","autocomplete","off","readonly","",1,"form-control",2,"width","93%","padding","0px 5px",3,"keydown.enter"],["id","cnnofield","type","text","formControlName","BANKNAME","placeholder","Press Enter to Select Credit note voucher","autocomplete","off","readonly","",1,"form-control",2,"font-size","12px !important",3,"keydown.enter"],[2,"width","7%","padding-left","6px"],[2,"width","10%","text-align","right","padding-right","1rem"],[2,"width","14%","font-size","11px"],[2,"width","4%"],["type","button",1,"btn","btn-danger",2,"font-size","10px","padding","1px","line-height","15px",3,"click"],[2,"display","none",3,"ngClass","innerHTML","mouseleave"]],template:function(i,n){1&i&&(e.YNc(0,li,1,0,"div",0),e.YNc(1,mi,204,61,"div",1),e.TgZ(2,"generic-popup-grid",2,3),e.NdJ("onItemDoubleClick",function(p){return n.onAccountSelected(p)}),e.qZA(),e.TgZ(4,"generic-popup-grid",2,4),e.NdJ("onItemDoubleClick",function(p){return n.onSalesReturnVoucherSelect(p)}),e.qZA(),e.TgZ(6,"fonepay-QR-popup",5,6),e.NdJ("onRefreshClick",function(p){return n.refreshClickHit(p)})("onDialogClosed",function(p){return n.onQrDialogClosed(p)}),e.qZA(),e.TgZ(8,"app-moco",7,8),e.NdJ("onDialogClosed",function(p){return n.onDialogClosedMoco(p)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForAccount),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForSalesReturn))},dependencies:[w.mk,w.sg,w.O5,g._Y,g.Fj,g.wV,g.JJ,g.JL,g.sg,g.u,Q.Zl,ei,ri,w.JJ,$e.g],styles:[".payment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:32rem;border:2px solid lightslategrey}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:13px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover{background-color:#138496;border-color:#117a8b;color:#fff;transform:scale(1.04)}.clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.btn[_ngcontent-%COMP%]{background-size:contain;background-repeat:no-repeat;background-position:center}.nohovereffect[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:14px;color:#138496;transition-duration:.3s}.nohovereffect[_ngcontent-%COMP%]:hover{border-color:#117a8b;transform:scale(1.04)}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:14px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}.keypad-row[_ngcontent-%COMP%]{margin-bottom:5px!important;width:100%;justify-content:space-between;padding-left:15px}.amount-section[_ngcontent-%COMP%]{margin-left:0;padding-left:0;padding-right:0;margin-right:0}.payment-mode-container[_ngcontent-%COMP%]{max-height:400px;width:-moz-fit-content;width:fit-content;overflow-y:scroll;overflow-x:hidden;padding:2px}.tooltipChild[_ngcontent-%COMP%]{display:block!important;position:absolute;border-radius:15px;text-align:left;color:#f9f6f6;width:max-content;padding:2px;background-color:#1f7748;z-index:9999;opacity:1;box-shadow:0 4px 8px #0003}"]}),T})();const vi=["genericGridSupplier"],rt=["genericGridRecurringItem"];function gi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.saveRecurringLog())}),e._uU(1,"SAVE [End]"),e.qZA()}}function fi(T,A){1&T&&(e.TgZ(0,"th",24),e._uU(1,"Discontinue"),e.qZA())}function Oi(T,A){if(1&T&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.Q6J("value",i.category),e.xp6(1),e.Oqu(i.category)}}function bi(T,A){if(1&T&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.Q6J("value",i.MONTH),e.xp6(1),e.Oqu(i.NAME)}}function Ci(T,A){1&T&&e._UZ(0,"option",36),2&T&&e.Q6J("value",A.$implicit.COST_CENTER)}function Ai(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",38)(1,"input",47),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.STATUS=s)}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit;e.xp6(1),e.MGl("id","recurStatus",n,""),e.Q6J("ngModel",s.STATUS)}}function Ei(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr",30),e.NdJ("click",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.recurringRowClick(p))}),e.TgZ(1,"td",31),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e.TgZ(5,"td",32)(6,"input",33),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.PARENT_NAME=s)})("keydown.enter",function(s){e.CHM(i);const p=e.oxw(3);return e.KtG(p.recurringItemEnter(s))})("focus",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.recurringRowClick(p))}),e.qZA()(),e.TgZ(7,"td",34)(8,"select",35),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.CATEGORY=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("recurAmount"+p))}),e._UZ(9,"option",36),e.YNc(10,Oi,2,2,"option",37),e.qZA()(),e.TgZ(11,"td",38)(12,"input",39),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.AMOUNT=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("recurMonth"+p))}),e.qZA()(),e.TgZ(13,"td",34),e._uU(14),e.ALo(15,"date"),e.qZA(),e.TgZ(16,"td",34)(17,"select",40),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.RECURRING_MONTH=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("recurDate"+p))})("change",function(){const s=e.CHM(i),p=s.$implicit,b=s.index,W=e.oxw(3);return e.KtG(W.addRecurringMonth(p,b))}),e._UZ(18,"option",36),e.YNc(19,bi,2,2,"option",37),e.qZA()(),e.TgZ(20,"td",41)(21,"input",42),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.RECURRING_DATE=s)})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("recurVendor"+p))}),e.qZA()(),e.TgZ(22,"td",34)(23,"input",43),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.COST_CENTER=s)}),e.qZA(),e.TgZ(24,"datalist",44),e.YNc(25,Ci,1,1,"option",37),e.qZA()(),e.TgZ(26,"td",34)(27,"input",45),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.REMARKS=s)})("keydown.enter",function(s){e.CHM(i);const p=e.oxw(3);return e.KtG(p.remarksEnter(s))}),e.qZA()(),e.YNc(28,Ai,2,2,"td",46),e.qZA()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.NAME),e.xp6(2),e.MGl("id","recurItemName",n,""),e.Q6J("disabled","view"==s.mode)("ngModel",i.PARENT_NAME),e.xp6(2),e.MGl("id","recurCategory",n,""),e.Q6J("ngModel",i.CATEGORY)("disabled","view"==s.mode),e.xp6(2),e.Q6J("ngForOf",s.recurringItemCategory),e.xp6(2),e.MGl("id","recurAmount",n,""),e.Q6J("ngModel",i.AMOUNT)("disabled","view"==s.mode),e.xp6(2),e.hij(" ",e.xi3(15,29,i.LAST_RECUR_DATE,"mm-DD-yyy")," "),e.xp6(3),e.MGl("id","recurMonth",n,""),e.Q6J("ngModel",i.RECURRING_MONTH)("disabled","view"==s.mode),e.xp6(1),e.Q6J("value",0),e.xp6(1),e.Q6J("ngForOf",s.recurringmodelist),e.xp6(2),e.MGl("id","recurDate",n,""),e.Q6J("ngModel",i.RECURRING_DATE)("disabled","view"==s.mode),e.xp6(2),e.MGl("id","recurVendor",n,""),e.Q6J("ngModel",i.COST_CENTER)("disabled","view"==s.mode),e.xp6(2),e.Q6J("ngForOf",s.costcenterlist),e.xp6(2),e.MGl("id","recurRemarks",n,""),e.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),e.xp6(1),e.Q6J("ngIf","edit"==s.mode)}}function Ii(T,A){if(1&T&&(e.TgZ(0,"div",17)(1,"div",7)(2,"h6"),e._uU(3,"Recurring Item Info: "),e.qZA()(),e.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",21),e._uU(9,"Sn."),e.qZA(),e.TgZ(10,"th",22),e._uU(11,"Item Name"),e.qZA(),e.TgZ(12,"th",22),e._uU(13,"Recurring Item Name"),e.qZA(),e.TgZ(14,"th",23),e._uU(15,"Category"),e.qZA(),e.TgZ(16,"th",24),e._uU(17,"Amount"),e.qZA(),e.TgZ(18,"th",23),e._uU(19,"Last Recurr Date "),e.qZA(),e.TgZ(20,"th",25),e._uU(21,"Recurring Mode"),e.qZA(),e.TgZ(22,"th",26),e._uU(23,"Recurring Date"),e.qZA(),e.TgZ(24,"th",23),e._uU(25,"Cost Center"),e.qZA(),e.TgZ(26,"th",23),e._uU(27,"Remarks"),e.qZA(),e.YNc(28,fi,2,0,"th",27),e.qZA()(),e.TgZ(29,"tbody",28),e.YNc(30,Ei,29,32,"tr",29),e.qZA()()()()),2&T){const i=e.oxw(2);e.xp6(28),e.Q6J("ngIf","edit"==i.mode),e.xp6(2),e.Q6J("ngForOf",i.recurringItemList)}}function Pi(T,A){1&T&&(e.TgZ(0,"th",24),e._uU(1,"Discontinue"),e.qZA())}function yi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",38)(1,"input",47),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.STATUS=s)}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit;e.xp6(1),e.MGl("id","recurStatus",n,""),e.Q6J("ngModel",s.STATUS)}}function Fe(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr",30),e.NdJ("click",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.commissionRowClick(p))}),e.TgZ(1,"td",50),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",51),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"td",52)(11,"input",45),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.COMMISSION_PERCENTAGE=s)})("ngModelChange",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.commssionrateEnter(p))})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("commissionamount"+p))}),e.qZA()(),e.TgZ(12,"td",52)(13,"input",45),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).index,W=e.oxw(3);return e.KtG(W.commissionamountChange(s,b))})("keydown.enter",function(){const p=e.CHM(i).index,b=e.oxw(3);return e.KtG(b.masterService.focusAnyControl("commissionRemarks"+p))}),e.ALo(14,"number"),e.qZA()(),e.TgZ(15,"td",34)(16,"input",45),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.REMARKS=s)})("keydown.enter",function(s){e.CHM(i);const p=e.oxw(3);return e.KtG(p.remarksEnterPress(s))}),e.qZA()(),e.YNc(17,yi,2,2,"td",46),e.qZA()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.NAME),e.xp6(2),e.hij(" ",i.SALESMANNAME,""),e.xp6(2),e.hij(" ",e.xi3(9,14,i.DEAL_AMOUNT,"1.2-2")," "),e.xp6(3),e.MGl("id","commissionrate",n,""),e.Q6J("ngModel",i.COMMISSION_PERCENTAGE)("disabled","view"==s.mode),e.xp6(2),e.MGl("id","commissionamount",n,""),e.Q6J("ngModel",e.xi3(14,17,i.COMMISSION_AMOUNT,"1.2-2"))("disabled","view"==s.mode),e.xp6(3),e.MGl("id","commissionRemarks",n,""),e.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),e.xp6(1),e.Q6J("ngIf","edit"==s.mode)}}function xi(T,A){if(1&T&&(e.TgZ(0,"div",17)(1,"div",7)(2,"h6"),e._uU(3,"Commission Chargeable Item Info: "),e.qZA()(),e.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",48),e._uU(9,"Sn."),e.qZA(),e.TgZ(10,"th",22),e._uU(11,"Item Name"),e.qZA(),e.TgZ(12,"th",22),e._uU(13,"Salesman"),e.qZA(),e.TgZ(14,"th",23),e._uU(15,"Deal Amount"),e.qZA(),e.TgZ(16,"th",24),e._uU(17,"Comission %"),e.qZA(),e.TgZ(18,"th",49),e._uU(19,"Comission Amount"),e.qZA(),e.TgZ(20,"th",23),e._uU(21,"Remarks"),e.qZA(),e.YNc(22,Pi,2,0,"th",27),e.qZA()(),e.TgZ(23,"tbody",28),e.YNc(24,Fe,18,20,"tr",29),e.qZA()()()()),2&T){const i=e.oxw(2);e.xp6(22),e.Q6J("ngIf","edit"==i.mode),e.xp6(2),e.Q6J("ngForOf",i.comissionItemList)}}function Ri(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h5"),e._uU(5,"Recurring Item Details Info:"),e.qZA(),e.TgZ(6,"div",8),e.YNc(7,gi,2,0,"button",9),e.TgZ(8,"button",10),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(9,"CANCEL [Esc]"),e.qZA()()(),e.TgZ(10,"div",7)(11,"h6"),e._uU(12,"Recurring Log No. :"),e.qZA(),e.TgZ(13,"label",11),e._uU(14),e.qZA(),e.TgZ(15,"h6"),e._uU(16," Customer Name: "),e.qZA(),e.TgZ(17,"label",12),e._uU(18),e.qZA()()(),e.TgZ(19,"div",13)(20,"div",14),e.YNc(21,Ii,31,2,"div",15),e.YNc(22,xi,25,2,"div",15),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(7),e.Q6J("ngIf","view"!=i.mode),e.xp6(7),e.Oqu(i.recurringLogID),e.xp6(4),e.Oqu(i.customerName),e.xp6(3),e.Q6J("ngIf",i.recurringItemList.length>0),e.xp6(1),e.Q6J("ngIf",i.comissionItemList.length>0)}}let Ni=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this._trnMainService=n,this.alertService=s,this.spinnerService=p,this.recurringlogsaved=new e.vpe,this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],this.gridPopupSettingsForSupplier=new z.sG,this.gridPopupSettingsForRecurringItems=new Q.im,this.recurringrowIndex=0,this.commissionrowIndex=0}ngOnInit(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&(this.masterService.getRecurringCategoryList().subscribe(i=>{this.recurringItemCategory=i&&i||[]},i=>{this.recurringItemCategory=[]}),this.getRecurringModeList())}ngOnChanges(i){(i.RecurringItems||i.CommissionItems)&&this.LoadItemsIntoLog(),(i.RecurringItemsForEdit||i.CommissionItemsForEdit)&&this.LoadItemsForEdit()}LoadItemsIntoLog(){this.RecurringItems.length>0?(this.spinnerService.show("Loading items, please wait.."),this.RecurringItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,this.spinnerService.hide(),this.recurringItemList.push(n)}),console.log("items loadded",this.recurringItemList,"mian recur id",this.mainRecurringID,"ref id",this.proformaRefBill),""!==this.mainRecurringID&&""!==this.proformaRefBill&&this.loadDetailsFromProforma()):this.recurringItemList=[],this.CommissionItems.length>0?this.CommissionItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,n.DEAL_AMOUNT=i.NETAMOUNT-i.VAT,n.SALESMANNAME=this._trnMainService.TrnMainObj.SALESMAN,n.SALESMAN=this._trnMainService.TrnMainObj.SALESMANID,this.comissionItemList.push(n)}):this.comissionItemList=[]}loadDetailsFromProforma(){console.log("HHHHHHHH");let i={};i.MCODE=this.recurringItemList[0].MCODE,i.ENTRYNO=this.proformaRefBill,this.masterService.getRecurringItemDetails(i).subscribe(n=>{if(console.log("YOOOO",n),"ok"==n.status){this.recurringItemList[0].PARENT_MCODE=n.result.PARENT_MCODE,this.recurringItemList[0].PARENT_NAME=n.result.PARENT_NAME,this.recurringItemList[0].CATEGORY=n.result.CATEGORY,this.recurringItemList[0].AMOUNT=n.result.AMOUNT,this.recurringItemList[0].LAST_RECUR_DATE=n.result.LAST_RECUR_DATE?n.result.LAST_RECUR_DATE.toString().substring(0,10):"",this.recurringItemList[0].COST_CENTER=n.result.COST_CENTER,this.recurringItemList[0].REMARKS=n.result.REMARKS,this.recurringItemList[0].RECURRING_MONTH=n.result.RECURRING_MONTH,this.recurringItemList[0].MAIN_RECURRING_ID=this.mainRecurringID;let s=new Date(this.recurringItemList[0].LAST_RECUR_DATE);s.setMonth(s.getMonth()+Number(this.recurringItemList[0].RECURRING_MONTH)),this.recurringItemList[0].RECURRING_DATE=(0,w.p6)(s,"yyyy-MM-dd","en-US")}})}LoadItemsForEdit(){this.RecurringItemsForEdit.forEach(i=>{i.LAST_RECUR_DATE=i.LAST_RECUR_DATE?i.LAST_RECUR_DATE.toString().substring(0,10):"",i.RECURRING_DATE=i.RECURRING_DATE?i.RECURRING_DATE.toString().substring(0,10):""}),this.recurringItemList=this.RecurringItemsForEdit,this.comissionItemList=this.CommissionItemsForEdit,this.recurringLogID=this.RecurringItemsForEdit[0]?.ENTRYNO,this.customerName=this.RecurringItemsForEdit[0]?.VENDOR_NAME}recurringRowClick(i){this.recurringrowIndex=i}commissionRowClick(i){this.commissionrowIndex=i}closeDialog(){this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],"view"!=this.mode&&"edit"!=this.mode&&(this.RecurringItemsForEdit=[],this.CommissionItemsForEdit=[]),this.recurringLogID="",this.customerName="",this.mainRecurringID="",this.proformaRefBill=""}saveRecurringLog(){if(this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter recurring item for item: ${this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter category for item: ${this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return void this.alertService.warning(`Please make sure Recurring date is set for item: ${this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`);let i=this.recurringItemList.length;if(this.recurringItemList.filter(s=>null==s.AMOUNT||null==s.AMOUNT||0==s.AMOUNT).length>=i)this.alertService.info("Please enter amount for atleast 1 recurring item in Recurring item info !");else{if(this.recurringItemList.filter(s=>null==s.AMOUNT||0==s.AMOUNT||null==s.AMOUNT).length>0&&"ADD"==this.mode.toUpperCase()){if(!confirm("Amount for some recurring items are missing. Are you sure you want to save items with amount only ?"))return;this.recurringItemList=this.recurringItemList.filter(s=>null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)}console.log("recurring list",this.recurringItemList,"commsion list",this.comissionItemList),this.recurringlogsaved.emit({recurringItemList:this.recurringItemList,commissionItemList:this.comissionItemList})}}show(i="add",n="",s=""){console.log("mode",this.mode),console.log("local mode",i,"main recur id",n,"proforma ref bil",s),this.isActive=!0,setTimeout(()=>{document.getElementById("recurItemName0").focus()},500),this.getCostCenterList(),"ADD"==i.toUpperCase()&&(this.customerName=this._trnMainService.TrnMainObj.BILLTO,this.masterService.getVoucherNo({VoucherPrefix:"RL",DIVISION:this.masterService.userProfile.userDivision,PhiscalID:this.masterService.userProfile.PhiscalYearInfo.PhiscalID}).subscribe(p=>{console.log("voucer num recieved",p),"ok"==p.status?this.recurringLogID=p.result.VCHRNO:alert("Failed to retrieve voucherno")})),console.log("load entry details",n,s),this.mainRecurringID=n,this.proformaRefBill=s}getRecurringModeList(){this.masterService.getRecurringModeList().subscribe(i=>{"ok"==i.status?(this.recurringmodelist=i.result?i.result:[],console.log("recurring mode list",this.recurringmodelist)):this.recurringmodelist=[]},i=>{this.recurringmodelist=[]})}getCostCenterList(){this.masterService.getRecurringCostcenterList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{this.costcenterlist=i&&i||[]},i=>{this.costcenterlist=[]})}supplierEnterCommand(i){this.getSupplierList(),this.genericGridSupplier.show()}getSupplierList(){this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V/0",defaultFilterIndex:0,useDefinefilterValue:null,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ACCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"VATNO",title:"VATNO",hidden:!1,noSearch:!1}]}}onSupplierSelected(i){console.log("sppulier select",i),this.recurringItemList[this.recurringrowIndex].VENDOR=i.ACID,this.recurringItemList[this.recurringrowIndex].VENDOR_NAME=i.ACNAME,setTimeout(()=>{document.getElementById("recurRemarks"+this.recurringrowIndex).focus()},500)}recurringItemEnter(i){this.gridPopupSettingsForRecurringItems={title:"Recurring Items",apiEndpoints:"/getRecurringItemPagesList",defaultFilterIndex:0,columns:[{key:"MENUCODE",title:"MENUCODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"ITEM NAME",hidden:!1,noSearch:!1}]},this.genericGridRecurringItem.show()}onRecurringItemSelected(i){console.log("item selecteted",i),this.recurringItemList[this.recurringrowIndex].PARENT_MCODE=i.MCODE,this.recurringItemList[this.recurringrowIndex].PARENT_NAME=i.DESCA,setTimeout(()=>{document.getElementById("recurCategory"+this.recurringrowIndex).focus()},500)}addRecurringMonth(i,n){let s;s=""==i.LAST_RECUR_DATE||null==i.LAST_RECUR_DATE?new Date(this._trnMainService.TrnMainObj.TRNDATE):new Date(i.LAST_RECUR_DATE),s.setMonth(s.getMonth()+Number(i.RECURRING_MONTH));let p=(0,w.p6)(s,"yyyy-MM-dd","en-US");this.recurringItemList[n].RECURRING_DATE=p}commssionrateEnter(i){let n=this.comissionItemList[i];if(console.log("commsission rate enter",n.COMMISSION_PERCENTAGE),n.COMMISSION_PERCENTAGE>100)return this.alertService.warning("Commission % should be limited to 100%"),this.comissionItemList[i].COMMISSION_PERCENTAGE=0,void(this.comissionItemList[i].COMMISSION_AMOUNT=0);n.COMMISSION_AMOUNT=n.DEAL_AMOUNT*(n.COMMISSION_PERCENTAGE/100)}remarksEnter(i){i.preventDefault();let n=this.recurringrowIndex+1;null!=document.getElementById("recurItemName"+n)&&setTimeout(()=>{document.getElementById("recurItemName"+n).focus()},500)}commissionamountChange(i,n){let s=this.comissionItemList[n];s.COMMISSION_AMOUNT=i,s.COMMISSION_PERCENTAGE=s.COMMISSION_AMOUNT/s.DEAL_AMOUNT*100}remarksEnterPress(i){i.preventDefault();let n=this.commissionrowIndex+1;null!=document.getElementById("commissionrate"+n)&&setTimeout(()=>{document.getElementById("commissionrate"+n).focus()},500)}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["recurringlog-popup"]],viewQuery:function(i,n){if(1&i&&(e.Gf(vi,5),e.Gf(rt,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridSupplier=s.first),e.iGM(s=e.CRH())&&(n.genericGridRecurringItem=s.first)}},inputs:{RecurringItems:"RecurringItems",CommissionItems:"CommissionItems",RecurringItemsForEdit:"RecurringItemsForEdit",CommissionItemsForEdit:"CommissionItemsForEdit",mode:"mode"},outputs:{recurringlogsaved:"recurringlogsaved"},features:[e.TTD],decls:5,vars:3,consts:[["class","recurring-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridSupplier",""],["genericGridRecurringItem",""],[1,"recurring-container"],[1,"card"],[1,"card-header"],[1,"row"],[2,"margin-left","60rem"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"width","8rem"],[2,"width","14rem"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],["style","width: 100%;",4,"ngIf"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],[2,"width","100%"],[1,"col-md-12",2,"height","20vh","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","6%"],["scope","col",2,"width","5%"],["scopr","col",2,"width","6%"],["scope","col",2,"width","0%"],["scope","col","style","width: 5%;",4,"ngIf"],[2,"background-color","aliceblue"],["style"," height:28px;",3,"click",4,"ngFor","ngForOf"],[2,"height","28px",3,"click"],[2,"width","1%"],[2,"width","10%"],["type","text","placeholder","Press Enter to select Item","autocomplete","off",3,"disabled","id","ngModel","ngModelChange","keydown.enter","focus"],[2,"width","6%"],[3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",2,"text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],[2,"width","0%"],["type","date",2,"width","130px",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","text","list","costcenter","autocomplete","off",3,"id","ngModel","disabled","ngModelChange"],["id","costcenter"],["type","text",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["style","width: 5%;",4,"ngIf"],["type","checkbox",2,"height","20px",3,"id","ngModel","change","ngModelChange"],["scope","col",2,"width","2%"],["scope","col",2,"width","8%"],[2,"width","2%"],[2,"width","5%","text-align","right"],[2,"width","8%"]],template:function(i,n){1&i&&(e.YNc(0,Ri,23,5,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(p){return n.onSupplierSelected(p)}),e.qZA(),e.TgZ(3,"generic-popup-grid",1,3),e.NdJ("onItemDoubleClick",function(p){return n.onRecurringItemSelected(p)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForSupplier),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForRecurringItems))},dependencies:[w.sg,w.O5,g.YN,g.Kr,g.Fj,g.wV,g.Wl,g.EJ,g.JJ,g.On,Q.Zl,w.JJ,w.uU],styles:[".recurring-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:23%;left:5%}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 3px 2px 4px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}.card-header[_ngcontent-%COMP%]{background-color:silver}label[_ngcontent-%COMP%]{font-size:14px}"]}),T})();var R=E(94619),J=E(6603);const a=["genericGridSupplier"],d=["genericGridRecurringItem"];function h(T,A){if(1&T&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.s9C("value",i.NAME),e.xp6(1),e.Oqu(i.NAME)}}function M(T,A){if(1&T&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.s9C("value",i.BATCH),e.xp6(1),e.Oqu(i.BATCH)}}function x(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),e._uU(5,"Stock Variance Adjustment"),e.qZA()()(),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"fieldset")(10,"legend",8),e._uU(11,"Warehouse Selection:"),e.qZA(),e.TgZ(12,"select",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.warehouse=s)}),e.YNc(13,h,2,2,"option",10),e.qZA()(),e.TgZ(14,"fieldset")(15,"legend",8),e._uU(16,"Batch Selection:"),e.qZA(),e.TgZ(17,"select",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.Batch=s)})("change",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.batchSelctionForDate(s.target.value))}),e._UZ(18,"option",12),e.YNc(19,M,2,2,"option",10),e.qZA()(),e.TgZ(20,"fieldset")(21,"legend",8),e._uU(22,"Batch Date:"),e.qZA(),e.TgZ(23,"input",13),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.Date=s)}),e.qZA()()(),e.TgZ(24,"div",7)(25,"fieldset")(26,"legend",8),e._uU(27,"Stock Variance Mode Selection:"),e.qZA(),e.TgZ(28,"div",14)(29,"div",15)(30,"div",16)(31,"input",17),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(32,"div",18)(33,"label",19),e._uU(34,"Excess Stock Adjustment"),e.qZA()()(),e.TgZ(35,"div",15)(36,"div",16)(37,"input",20),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(38,"div",18)(39,"label",21),e._uU(40,"Shortage Stock Adjustment"),e.qZA()()(),e.TgZ(41,"div",15)(42,"div",16)(43,"input",22),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(44,"div",18)(45,"label",21),e._uU(46,"Item than not comes in counting adjustment"),e.qZA()()(),e.TgZ(47,"div",15)(48,"div",16)(49,"input",23),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(50,"div",18)(51,"label",21),e._uU(52,"Item counted but not in C-stock Adjustment"),e.qZA()()()()()()()(),e.TgZ(53,"div",24)(54,"div",25)(55,"button",26),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.run())}),e._uU(56,"Run"),e.qZA(),e.TgZ(57,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(58,"Close"),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(12),e.Q6J("ngModel",i.stockAdjustObj.warehouse),e.xp6(1),e.Q6J("ngForOf",i.warehouseList),e.xp6(4),e.Q6J("ngModel",i.stockAdjustObj.Batch),e.xp6(2),e.Q6J("ngForOf",i.BatchSelectionList),e.xp6(4),e.Q6J("ngModel",i.stockAdjustObj.Date),e.xp6(8),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode)}}let X=(()=>{class T{constructor(i,n,s,p,b,W){this.masterService=i,this._trnMainService=n,this.alertService=s,this.adjustmentService=p,this.loadingService=b,this.router=W,this.isActive=!1,this.warehouseList=[],this.BatchSelectionList=[],this.stockAdjustmentLoaded=new e.vpe,this.gridPopupSettingsForSupplier=new z.sG,this.gridPopupSettingsForRecurringItems=new Q.im,this.stockAdjustObj={}}ngOnInit(){this.getWarehouseList()}getWarehouseList(){this.adjustmentService.getWarehouses().subscribe(i=>{this.warehouseList=i})}getBatchList(){this.adjustmentService.getBatchSelectionList().subscribe(i=>{this.BatchSelectionList=i,console.log(this.BatchSelectionList)})}batchSelctionForDate(i){let n;n=this.BatchSelectionList.find(s=>s.BATCH==i),this.stockAdjustObj.Date=n.TRNDATE.substring(0,10),console.log(n)}show(){this.isActive=!0,this.getBatchList()}closeDialog(){this.isActive=!1,this.stockAdjustObj={}}run(){this.stockAdjustmentLoaded.emit(this.stockAdjustObj);let i={BATCH:this.stockAdjustObj.Batch,DATE:this.stockAdjustObj.Date,WARE:this.stockAdjustObj.warehouse,DIVISION:"%",VARIANCEMODE:this.stockAdjustObj.reportmode};this.loadingService.show("Loading data, please wait.."),this.adjustmentService.runBatches(i).subscribe(n=>{console.log("result on save",n),"ok"==n.status?(this.loadingService.hide(),this._trnMainService.TrnMainObj.ProdList=n.result,this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1):(this.loadingService.hide(),this.alertService.info(n.result.error))},n=>{this.loadingService.hide(),this.alertService.info(n)})}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(J.z),e.Y36(Z.V),e.Y36(Re.F0))},T.\u0275cmp=e.Xpm({type:T,selectors:[["stockadjustment-popup"]],viewQuery:function(i,n){if(1&i&&(e.Gf(a,5),e.Gf(d,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridSupplier=s.first),e.iGM(s=e.CRH())&&(n.genericGridRecurringItem=s.first)}},outputs:{stockAdjustmentLoaded:"stockAdjustmentLoaded"},decls:1,vars:1,consts:[["class","stockadjustment-container",4,"ngIf"],[1,"stockadjustment-container"],[1,"card"],[1,"card-header"],[1,"row"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],[1,"col-md-6"],[1,"legend-class"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange","change"],["value",""],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[2,"margin-top","4px"],[1,"row",2,"margin-bottom","-3%"],[1,"col-md-1","pd0"],["type","radio","name","reportOption","value","2",1,"radio",3,"ngModel","ngModelChange"],["calss","col"],[1,"variance-font",2,"width","100%"],["type","radio","name","reportOption","value","3",1,"radio",3,"ngModel","ngModelChange"],[2,"width","100%"],["type","radio","name","reportOption","value","5",1,"radio",3,"ngModel","ngModelChange"],["type","radio","name","reportOption","value","4",1,"radio",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"row","pull-right"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[3,"value"]],template:function(i,n){1&i&&e.YNc(0,x,59,9,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.YN,g.Kr,g.Fj,g.EJ,g._,g.JJ,g.On],styles:[".stockadjustment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:23%;left:50%}.card-header[_ngcontent-%COMP%]{background:#bcbebe}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px;height:25px;font-size:12px}fieldset[_ngcontent-%COMP%]{border:1.6px solid #bcbebe}legend[_ngcontent-%COMP%]{font-weight:700;font-size:13px;width:auto;margin-bottom:2px}.radio[_ngcontent-%COMP%]{margin-top:-1px;height:14px}.card-footer[_ngcontent-%COMP%]{padding:5px}"]}),T})(),re=(()=>{class T{transform(i,n){if(i)return""!=n&&null!=n?i.filter(s=>{const p=n.replace(/[^A-Z0-9]/gi,"").toLowerCase();if(-1!==(s.DESCA?s.DESCA.replace(/[^A-Z0-9]/gi,"").toLowerCase():"").indexOf(p))return s}):i}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275pipe=e.Yjl({name:"searchData",type:T,pure:!1}),T})();function me(T,A){1&T&&(e.TgZ(0,"th",21),e._uU(1,"BatchId"),e.qZA())}function Ie(T,A){if(1&T&&(e.TgZ(0,"td",34),e._uU(1),e.qZA()),2&T){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.BATCHID)}}function ve(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td",26)(2,"input",27),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.CHECKED=s)}),e.qZA()(),e.TgZ(3,"td",28),e._uU(4),e.qZA(),e.TgZ(5,"td",29),e._uU(6),e.qZA(),e.TgZ(7,"td",30),e._uU(8),e.qZA(),e.YNc(9,Ie,2,1,"td",31),e.TgZ(10,"td",32),e._uU(11),e.qZA(),e.TgZ(12,"td",33),e._uU(13),e.qZA()()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(2);e.xp6(2),e.Q6J("ngModel",i.CHECKED),e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.DESCA),e.xp6(1),e.Q6J("ngIf",1==s._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(2),e.Oqu(i.BATCH),e.xp6(2),e.Oqu(i.totalNegativeQty)}}function ge(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"Negative Stock Item List "),e.qZA(),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(7,"span",7),e._uU(8,"\xd7"),e.qZA()()()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.filter=s)}),e.qZA()()()(),e.TgZ(13,"div",12)(14,"table",13)(15,"thead")(16,"tr",14)(17,"th",15)(18,"input",16),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.selectAll(s.target.checked))}),e.qZA()(),e.TgZ(19,"th",17),e._uU(20,"Sn."),e.qZA(),e.TgZ(21,"th",18),e._uU(22,"Item Code"),e.qZA(),e.TgZ(23,"th",19),e._uU(24,"Item Name"),e.qZA(),e.YNc(25,me,2,0,"th",20),e.TgZ(26,"th",21),e._uU(27,"Batch"),e.qZA(),e.TgZ(28,"th",22),e._uU(29,"Negative Stock"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,ve,14,7,"tr",23),e.ALo(32,"searchData"),e.qZA()()(),e.TgZ(33,"div",24)(34,"button",25),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.applyClicked())}),e._uU(35,"Apply"),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(12),e.Q6J("ngModel",i.filter),e.xp6(13),e.Q6J("ngIf",1==i._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(6),e.Q6J("ngForOf",e.xi3(32,3,i.negativeItemStockList,i.filter))}}let Ve=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.isActive=!1,this.filter=""}ngOnInit(){}selectAll(i){this.negativeItemStockList.forEach(n=>n.CHECKED=i)}showDialog(i){console.log("negative item.",i),this.negativeItemStockList=i,this.isActive=!0}closeDialog(){this.isActive=!1}applyClicked(){let i;i=this.negativeItemStockList.filter(s=>1==s.CHECKED).map(s=>s.MCODE);let n=[...new Set(i)];this._trnMainService.AutoLoadNegativeStock(n).subscribe(s=>{console.log("auto load neg stock",s),"ok"==s.status?(this._trnMainService.TrnMainObj.ProdList=s.result,this._trnMainService.TrnMainObj.ProdList.forEach(p=>p.isDisabled=!0),this._trnMainService.calculateBatchAdjustmentVariance()):this.alertService.error("Failed to save..."),this.isActive=!1})}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["autoadjustment-popup"]],decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row",2,"margin-top","3px","margin-bottom","-2px"],[1,"col-md-6",2,"margin","2px 0px","display","flex","padding-left","0px","margin-left","-8px"],["type","search","name","filter","autocomplete","off","placeholder","Enter item name to search",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"card-body"],[1,"table","table-striped"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","4%"],["type","checkbox",2,"width","16px",3,"change"],["scope","col",2,"width","3%"],["scope","col",2,"width","6%"],["scope","col",2,"width","20%"],["scope","col","style","width: 10%;",4,"ngIf"],["scope","col",2,"width","10%"],["scope","col",2,"width","8%"],[4,"ngFor","ngForOf"],[1,"card-footer"],["type","button",1,"btn","btn-info",3,"click"],["scope","col",2,"width","5%"],["type","checkbox",2,"position","relative","height","20px","width","16px","margin-left","4px",3,"ngModel","ngModelChange"],[2,"width","3%"],[2,"width","6%"],[2,"width","20%"],["style","width: 13%;",4,"ngIf"],[2,"width","10%"],[2,"width","8%","text-align","center"],[2,"width","13%"]],template:function(i,n){1&i&&e.YNc(0,ge,36,6,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.Fj,g.Wl,g.JJ,g.On,re],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:25%;left:52%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:3.7vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.8rem;padding:5px}.card-header[_ngcontent-%COMP%]{padding:5px 3px;background:silver}.card-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:43vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px 2px;vertical-align:middle}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:13px}"]}),T})();var He=E(19773),ze=E(88146);let Xe=(()=>{class T{transform(i,n){if(i)return n?i.filter(s=>{const p=n.replace(/[^A-Z0-9]/gi,"").toLowerCase(),b=s.MENUCODE?s.MENUCODE.replace(/[^A-Z0-9]/gi,"").toLowerCase():"",W=s.ITEMDESC?s.ITEMDESC.replace(/[^A-Z0-9]/gi,"").toLowerCase():"";if(-1!==b.indexOf(p)||-1!==W.indexOf(p))return s}):i}}return T.\u0275fac=function(i){return new(i||T)},T.\u0275pipe=e.Yjl({name:"searchId",type:T,pure:!0}),T})();function _e(T,A){1&T&&(e.TgZ(0,"th",15),e._uU(1,"Edit Checkbox"),e.qZA())}function ot(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td")(1,"input",28),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().$implicit,b=e.oxw(2);return e.KtG(b.checkBoxEvent(s,p))}),e.qZA()()}if(2&T){const i=e.oxw().$implicit;e.xp6(1),e.Q6J("checked",i.checked)}}function st(T,A){1&T&&e.GkF(0)}const Te=function(){return{updateOn:"blur"}};function at(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit,b=e.oxw(2);return e.KtG(b.amountChange(s,p))}),e.qZA()}if(2&T){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ALTERNATEQUANTIY)("disabled",!(null!=i&&i.checked))("ngModelOptions",e.DdM(3,Te))}}function Ue(T,A){if(1&T&&e._uU(0),2&T){const i=e.oxw().$implicit;e.hij(" ",i.ALTERNATEQUANTIY," ")}}function et(T,A){1&T&&e.GkF(0)}function Li(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit,b=e.oxw(2);return e.KtG(b.rateChange(s,p))}),e.qZA()}if(2&T){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ALTRATE)("disabled",!(null!=i&&i.checked))("ngModelOptions",e.DdM(3,Te))}}function wi(T,A){if(1&T&&e._uU(0),2&T){const i=e.oxw().$implicit;e.hij(" ",i.ALTRATE," ")}}function Di(T,A){if(1&T&&(e.TgZ(0,"tr",19),e.YNc(1,ot,2,1,"td",20),e.TgZ(2,"td",19),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td",19),e._uU(7),e.qZA(),e.TgZ(8,"td",19),e._uU(9),e.qZA(),e.TgZ(10,"td",21),e.YNc(11,st,1,0,"ng-container",22),e.YNc(12,at,1,4,"ng-template",null,23,e.W1O),e.YNc(14,Ue,1,1,"ng-template",null,24,e.W1O),e.qZA(),e.TgZ(16,"td",25),e.YNc(17,et,1,0,"ng-container",22),e.YNc(18,Li,1,4,"ng-template",null,26,e.W1O),e.YNc(20,wi,1,1,"ng-template",null,27,e.W1O),e.qZA(),e.TgZ(22,"td",19),e._uU(23),e.ALo(24,"number"),e.qZA(),e.TgZ(25,"td",19),e._uU(26),e.ALo(27,"number"),e.qZA(),e.TgZ(28,"td",19),e._uU(29),e.ALo(30,"number"),e.qZA(),e.TgZ(31,"td",19),e._uU(32),e.ALo(33,"number"),e.qZA(),e.TgZ(34,"td",19),e._uU(35),e.ALo(36,"number"),e.qZA(),e.TgZ(37,"td",19),e._uU(38),e.qZA(),e.TgZ(39,"td",19),e._uU(40),e.qZA()()),2&T){const i=A.$implicit,n=A.index,s=e.MAs(13),p=e.MAs(15),b=e.MAs(19),W=e.MAs(21),te=e.oxw(2);e.xp6(1),e.Q6J("ngIf",te.editLargeEntry),e.xp6(2),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Q6J("ngIf",te.editLargeEntry)("ngIfThen",s)("ngIfElse",p),e.xp6(6),e.Q6J("ngIf",te.editLargeEntry)("ngIfThen",b)("ngIfElse",W),e.xp6(6),e.hij(" ",e.xi3(24,18,i.AMOUNT,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(27,21,i.SELLRATEBEFORETAX,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(30,24,i.MRP,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(33,27,i.W_SELLRATEBEFORETAX,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(36,30,i.W_MRP,"1.2-2")," "),e.xp6(3),e.Oqu(i.MFGDATE),e.xp6(2),e.Oqu(i.EXPDATE)}}function tt(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h5",8),e._uU(8,"Previous Fiscal Year"),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",9)(12,"input",10),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.searchbyid=s)}),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(14," \xd7 "),e.qZA()()()()(),e._UZ(15,"hr"),e.qZA(),e.TgZ(16,"cdk-virtual-scroll-viewport",12)(17,"table")(18,"thead")(19,"tr",13),e.YNc(20,_e,2,0,"th",14),e.TgZ(21,"th",15),e._uU(22,"S.No."),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Code"),e.qZA(),e.TgZ(25,"th",16),e._uU(26,"Description"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"Unit"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"Quantity"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"Rate"),e.qZA(),e.TgZ(33,"th"),e._uU(34,"Amt"),e.qZA(),e.TgZ(35,"th"),e._uU(36,"Sales Price"),e.qZA(),e.TgZ(37,"th"),e._uU(38,"Sales Price(W/V)"),e.qZA(),e.TgZ(39,"th"),e._uU(40,"WSP"),e.qZA(),e.TgZ(41,"th"),e._uU(42,"WSP(W/V)"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Mfg Date"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"Exp Date"),e.qZA()()(),e.TgZ(47,"tbody",17),e.YNc(48,Di,41,33,"tr",18),e.ALo(49,"searchId"),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(10),e.hij("[",i.OpeningList[0].VCHRNO,"]"),e.xp6(2),e.Q6J("ngModel",i.searchbyid),e.xp6(4),e.Q6J("itemSize",20),e.xp6(4),e.Q6J("ngIf",i.editLargeEntry),e.xp6(28),e.Q6J("cdkVirtualForOf",e.xi3(49,5,i.OpeningList,i.searchbyid))}}let $i=(()=>{class T{constructor(i,n,s,p){this._transactionService=i,this.productHelper=n,this.alert=s,this.spinnerService=p,this.isActive=!1,this.OpeningList=[],this.editLargeEntry=!1,this.dataToBeSent=[],this.total=0}ngOnInit(){this._transactionService.TrnMainObj.largeDataEntryEdit=!1,this.subscription=this.productHelper.saveButtonClickedSubject$.pipe((0,He.zg)(i=>(this.total=0,0===this.dataToBeSent.length?(this.alert.warning("No product is selected, First select a product and then only you can proceed"),(0,Oe.of)("end")):(this.OpeningList.forEach(s=>{this.total+=s.AMOUNT}),this.productHelper.saveEditDataOfUpdateOpeningFromCarryFarward({data:{ProdList:this.dataToBeSent,VCHRNO:this._transactionService.TrnMainObj.VCHRNO,DIVISION:this._transactionService.TrnMainObj.DIVISION,PhiscalID:this._transactionService.TrnMainObj.PhiscalID,guid:this.largeEntryGuid,MWAREHOUSE:this._transactionService.TrnMainObj.MWAREHOUSE,REMARKS:this._transactionService.TrnMainObj.REMARKS,TOTAMNT:this.total,NETAMNT:this.total}}).pipe((0,ee.K)(s=>(this.alert.error(s.error),(0,Oe.of)("Error")))))))).subscribe({next:i=>{"end"!==i&&"Error"!==i&&(this.spinnerService.hide(),this.dataToBeSent=[],this.hide(),this.alert.success(i.result))}})}show(i,n,s){"largeDataEntryEdit"===n?(this.editLargeEntry=!0,this.largeEntryGuid=s):"noLargeDataEntryEdit"===n&&(this.editLargeEntry=!1),this.isActive=!0,this.OpeningList=i;let p=0,b=0;this.OpeningList?.length>0&&(this.OpeningList.forEach(W=>{W.checked=void 0,p+=W.ALTERNATEQUANTIY,b+=W.AMOUNT}),this._transactionService.TrnMainObj.TOTALQTY=p,this._transactionService.TrnMainObj.GROSSAMNT=b),this._transactionService.TrnMainObj.largeDataEntryEdit="largeDataEntryEdit"===n}hide(){this.dataToBeSent=[],this.isActive=!1,this._transactionService.TrnMainObj.largeDataEntryEdit=!1}checkBoxEvent(i,n){i.target.checked?(this.dataToBeSent.push(n),n.checked=!0):(n.checked=void 0,this.dataToBeSent=this.dataToBeSent.filter(s=>s?.MCODE!==n.MCODE))}amountChange(i,n){let s;if(s=i<0||null===i?0:i,console.log("data",n),s<n.TOTALOUTWARDSTOCK){this.alert.warning(`Entered quantity ${i} ${n.ALTUNIT} is less than out quantity ${n.TOTALOUTWARDSTOCK} ${n.ALTUNIT} for item: ${n.ITEMDESC}`);let p=0==this._transactionService.nullToZeroConverter(n.ALTERNATEQUANTIY)?n.Quantity:n.ALTERNATEQUANTIY;n.ALTERNATEQUANTIY=new Number(p)}else n.ALTERNATEQUANTIY=new Number(s),n.ALTQTY_IN=s,n.REALQTY_IN=s,n.QUANTITY=s,n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}rateChange(i,n){let s;s=i<0||null===i?0:i,n.ALTRATE=new Number(s),n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this._transactionService.TrnMainObj.largeDataEntryEdit=!1}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(N.p),e.Y36(it.h),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-opening-from-previous-year"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-6",2,"display","flex","align-items","baseline"],[1,"modal-title"],[1,"col-md-6"],["type","text","placeholder","Search by Menu code or Description","name","searchbyid",1,"container-input","ms-2",3,"ngModel","ngModelChange"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"mb-4",3,"itemSize"],[2,"background","#eeeeee","color","black"],["scope","col",4,"ngIf"],["scope","col"],[2,"width","20%"],[2,"border","1px"],["style","border: 1px solid #e6e6e6",4,"cdkVirtualFor","cdkVirtualForOf"],[2,"border","1px solid #e6e6e6"],[4,"ngIf"],[2,"border","1px solid #e6e6e6","width","10px"],[4,"ngIf","ngIfThen","ngIfElse"],["inputQuantity",""],["quantity",""],[2,"border","1px solid #e6e6e6","width","10%"],["inputAltRate",""],["altRate",""],["type","checkbox",3,"checked","change"],["type","number",3,"ngModel","disabled","ngModelOptions","ngModelChange"]],template:function(i,n){1&i&&e.YNc(0,tt,50,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.O5,ze.xd,ze.x0,ze.N7,g.Fj,g.wV,g.JJ,g.On,w.JJ,Xe],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:98.4%;top:30%;left:4%;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{height:24rem;border:1px solid #D1D6D8;width:87%;margin-left:auto;margin-right:auto}tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}"]}),T})();const zi=["Division"];function Xi(T,A){if(1&T&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.Q6J("value",i.INITIAL),e.xp6(1),e.hij(" ",i.NAME," ")}}function en(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),e._uU(5,"Opening From Previous Fiscal Year"),e.qZA()(),e.TgZ(6,"div",6)(7,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelPopup())}),e._uU(8,"Cancel"),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.savePopup())}),e._uU(10," Save "),e.qZA()()(),e.TgZ(11,"div",9)(12,"div",10)(13,"div")(14,"div",11)(15,"div",12)(16,"label",13),e._uU(17,"DIVISION:"),e.qZA()(),e.TgZ(18,"div",14)(19,"select",15,16),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.DIV=s)}),e._UZ(21,"option",17),e.YNc(22,Xi,2,2,"option",18),e.qZA()()()()()()()()}if(2&T){const i=e.oxw();e.xp6(19),e.Q6J("ngModel",i.DIV),e.xp6(3),e.Q6J("ngForOf",i.divisionLists)}}let tn=(()=>{class T{constructor(i,n,s,p){this.masterService=i,this.alertService=n,this._trnMainService=s,this.spinnerService=p,this.DIV="",this.onSaveParty=new e.vpe,this.loggedinUserDetail={},this.divisionLists=[],this.masterService.getAllDivisions().subscribe(b=>{this.divisionLists=b})}ngOnInit(){}resetPopup(){}savePopup(){this.spinnerService.show("Data Procesing Please Wait... "),this.DIV&&this.masterService.saveFiscalYear(2,0,this.DIV).subscribe(i=>{"ok"==i.status?this.alertService.success(i.result):this.alertService.info(i.result.error),this.isActive=!1,this.spinnerService.hide()})}cancelPopup(){this.isActive=!1,this.resetPopup()}show(){this.isActive=!0,setTimeout(()=>{this.Division.nativeElement.focus()},10)}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(f.P),e.Y36($.c),e.Y36(N.p),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["previous-year-opening"]],viewQuery:function(i,n){if(1&i&&e.Gf(zi,5),2&i){let s;e.iGM(s=e.CRH())&&(n.Division=s.first)}},outputs:{onSaveParty:"onSaveParty"},decls:1,vars:1,consts:[["class","party_container","role","document",4,"ngIf"],["role","document",1,"party_container"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","42vw","height","24vh"],[1,"modal-header","row"],[1,"col-md-7"],[1,"modal-title","pull-right",2,"font-weight","600"],[1,"col-md-5"],["type","button",1,"btn","btn-info","pull-right",2,"width","80px",3,"click"],["type","button","title","onSave",1,"btn","btn-info","pull-right",2,"margin-right","10px","width","80px","margin-top","15px",3,"click"],[1,"row"],[1,"col-md-8"],[1,"form-group","row",2,"margin-left","4px"],[1,"col-md-4"],[1,"pull-right",2,"font-weight","bold","text-align","right","margin-top","24px"],[1,"col-md-8",2,"width","65%","margin-top","20px"],["id","partygroup",1,"form-control",2,"padding","0px 8px",3,"ngModel","ngModelChange"],["Division",""],["value","%"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,n){1&i&&e.YNc(0,en,23,2,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.YN,g.Kr,g.EJ,g.JJ,g.On],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:23px;color:#000}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 0rem;\n    }\n  \n    .party_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      top: 30%;\n      left: 29%;\n    }"]}),T})();const nn=["genericGrid"],rn=["genericGridTerms"];function on(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td",25),e._uU(2),e.qZA(),e.TgZ(3,"td",26),e._uU(4),e.qZA(),e.TgZ(5,"td",27),e._UZ(6,"div",28),e.qZA(),e.TgZ(7,"td",29)(8,"div",30)(9,"button",31),e.NdJ("click",function(){const p=e.CHM(i).index,b=e.oxw(2);return e.KtG(b.deleteRow(p))}),e._UZ(10,"img",32),e.qZA()()()()}if(2&T){const i=A.$implicit,n=A.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.label),e.xp6(2),e.Q6J("innerHTML",i.termConditions,e.oJD)}}function sn(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"h5"),e._uU(5,"Apply Terms and Conditions"),e.qZA(),e.TgZ(6,"div",7)(7,"button",8),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(8,"APPLY"),e.qZA(),e.TgZ(9,"button",9),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(10,"CANCEL"),e.qZA()()()(),e.TgZ(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",6)(15,"div",13)(16,"label",14),e._uU(17,"Terms and Conditions Label: "),e.qZA(),e.TgZ(18,"input",15),e.NdJ("keydown.enter",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.customerEnterCommand(s))})("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.selectedTermsObject.label=s)}),e.qZA(),e.TgZ(19,"button",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onAddTerms())}),e._uU(20,"ADD"),e.qZA()()()(),e.TgZ(21,"table",17)(22,"thead",18)(23,"tr",19)(24,"th",20),e._uU(25,"S.N"),e.qZA(),e.TgZ(26,"th",21),e._uU(27,"Label"),e.qZA(),e.TgZ(28,"th",22),e._uU(29,"TermsAndConditions"),e.qZA()()(),e.TgZ(30,"tbody",23),e.YNc(31,on,11,3,"tr",24),e.qZA()()()()()()}if(2&T){const i=e.oxw();e.xp6(18),e.Q6J("ngModel",i.selectedTermsObject.label),e.xp6(13),e.Q6J("ngForOf",i.valuesList)}}let an=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.okClicked=new e.vpe,this.gridPopupSettings=new Q.im,this.gridPopupSettingsForTerms=new z.sG,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.termConditionList=[],this.termsandconditionArray=[],this.termsCondSearched=new g.NI,this.selectTermsJSON="",this.tempTermsConditions=[],this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}ngOnInit(){this.getTermsandConditionsList()}valueChange(i){this._trnMainService.searchedTermsandCondition=i.TermsAndConditions,this.termsSearchedId=i.ID,this.selectTermsJSON=JSON.stringify(i)}getTermsandConditionsList(){this.masterService.getPOTermsAndConditions().subscribe(i=>{"ok"==i.status&&(this.termConditionList=i.result,this.termConditionList?.length>0&&this.termConditionList.forEach(n=>n.TermsAndConditions=this.formatTermsAndConditions(n.TermsAndConditions)))})}show(i,n){this.isActive=!0,this.mode=n,i&&0!==i.length?(this.valuesList=[...i],this.tempTermsConditions=[...this.valuesList],this.valuesList.forEach(s=>s.termConditions=this.formatTermsAndConditions(s.termConditions))):(this.valuesList=[],this.tempTermsConditions=[])}submit(){if(0==this.valuesList.length)return void this.alertService.warning("Please select terms and conditions!!!");this.isSubmitting=!0,this.spinnerService.show("Applying Terms and Conditions! wait....");let i=this.valuesList.map(n=>n.id).toString();this.okClicked.emit(i),this.spinnerService.hide(),this.isActive=!1,this.tempTermsConditions=[...this.valuesList]}closeDialog(){this.valuesList=[...this.tempTermsConditions];let i=this.valuesList.map(n=>n.id).toString();this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID=i,this.okClicked.emit(i),this.isActive=!1}hide(){this.isActive=!1}customerEnterCommand(i){this.getTermList(),this.genericGridTerms.show()}getTermList(){this.gridPopupSettingsForTerms={title:"Terms and Condition",apiEndpoints:"/getPOTermsAndConditionsPagedList",defaultFilterIndex:1,useDefinefilterValue:this._trnMainService.TrnMainObj.BILLTO,columns:[{key:"ID",title:"ID",hidden:!1,noSearch:!1},{key:"Label",title:"NAME",hidden:!1,noSearch:!1}]}}onCustomerSelected(i){i.TermsAndConditions=this.formatTermsAndConditions(i.TermsAndConditions),this.selectedTermsObject.id=i.ID,this.selectedTermsObject.label=i.Label,this.selectedTermsObject.termConditions=i.TermsAndConditions}onAddTerms(){if(""!=this.selectedTermsObject.id){if(this.valuesList&&this.valuesList.length>0&&this.valuesList?.find(n=>n.id==this.selectedTermsObject.id))return void this.alertService.info("Can not add duplicate terms and condition");this.valuesList.push(Object.assign({},this.selectedTermsObject)),this.selectedTermsObject={id:"",label:"",termConditions:""}}}formatTermsAndConditions(i){return(i=(i=i.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/  +/g,n=>"&nbsp;".repeat(n.length))).replace(/\n/g,"<br>")}clearTermsAndCondition(){this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}deleteRow(i){this.valuesList.splice(i,1)}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["termsncondition-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(e.Gf(nn,5),e.Gf(rn,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGrid=s.first),e.iGM(s=e.CRH())&&(n.genericGridTerms=s.first)}},outputs:{okClicked:"okClicked"},decls:3,vars:2,consts:[["class","terms-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridTerms",""],[1,"terms-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body",2,"overflow","auto"],[1,"col-md-12",2,"margin-top","1rem"],[1,"col-md-8"],[1,"d-flex","align-items-center","custom-gap"],[2,"width","50%"],["type","text","id","customerselectid","placeholder","Press ENTER to Select","readonly","",3,"ngModel","keydown.enter","ngModelChange"],["type","button","title","Cancel",1,"btn","btn-info","ml-5",3,"click"],["id","BlueHeaderResizableTable",1,"table","table-striped","mt-3"],[1,"stickHead"],[2,"line-height","2rem"],[1,"fontsize",2,"width","5%","font-weight","bold"],[1,"fontsize",2,"width","15%","font-weight","bold"],[1,"fontsize",2,"width","20%","font-weight","bold"],[2,"scrollbar-3dlight-color","#FFFFFF","scrollbar-arrow-color","#000000","scrollbar-base-color","#FF9999","scrollbar-darkshadow-color","#000000","scrollbar-face-color","#000000","scrollbar-highlight-color","#000000","scrollbar-shadow-color","#0033CC"],[4,"ngFor","ngForOf"],[2,"width","5%"],[2,"width","15%"],[2,"width","20%"],[3,"innerHTML"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"]],template:function(i,n){1&i&&(e.YNc(0,sn,32,2,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(p){return n.onCustomerSelected(p)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForTerms))},dependencies:[w.sg,w.O5,g.Fj,g.JJ,g.On,Q.Zl],styles:[".terms-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:30rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}.custom-gap[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:25px}",".closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}"]}),T})();function cn(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h6",5),e._uU(5,"Confirmation Popup"),e.qZA()()(),e.TgZ(6,"div",6)(7,"div",7)(8,"p",8),e._uU(9," Member has redeemable points remaining. Do you want to redeem points as discount? "),e.qZA(),e._UZ(10,"hr",9),e.TgZ(11,"p",8),e._uU(12," Total Points to be Redeemed: "),e.TgZ(13,"span",10),e._uU(14),e.ALo(15,"number"),e.qZA()(),e.TgZ(16,"p",8),e._uU(17," Discount to be applied on Points Redeemed: "),e.TgZ(18,"span",10),e._uU(19),e.ALo(20,"number"),e.qZA()()()()(),e.TgZ(21,"div",11)(22,"div",12)(23,"button",13),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(24,"OK"),e.qZA(),e.TgZ(25,"button",14),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(26,"CANCEL"),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(14),e.Oqu(e.xi3(15,2,i.redeemPoint,"1.2-2")),e.xp6(5),e.hij("Rs. ",e.xi3(20,5,i.discountOnRedeem,"1.2-2"),"")}}let ln=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.okClicked=new e.vpe,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.TrnMainObj={}}ngOnInit(){}submit(){this.isActive=!1,this.okClicked.emit(!0)}closeDialog(){this.isActive=!1,this.okClicked.emit(!1)}show(){this.isActive=!0,this._trnMainService.pointRedeem().subscribe(i=>{this.redeemPoint=i,this.discountOnRedeem=this._trnMainService.TrnMainObj.MEMBERSHIPDISCOUNT}),console.log("redeem ko log",this.redeemPoint)}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["member-point-confirm-popup"]],outputs:{okClicked:"okClicked"},decls:1,vars:1,consts:[["class","confirmation-container",4,"ngIf"],[1,"confirmation-container"],[1,"card"],[1,"card-header",2,"background-color","lightsteelblue","padding","0.5rem 1.25rem"],[1,"row"],[2,"font-size","1.1rem"],[1,"row",2,"margin-top","1rem"],[1,"mx-4"],[2,"font-size","15px","font-weight","500"],[2,"margin-top","4px","margin-bottom","2px"],[2,"color","green"],[1,"col-md-12",2,"display","flex","align-items","flex-end","justify-content","center"],[1,"button-group","my-2"],["type","button",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"]],template:function(i,n){1&i&&e.YNc(0,cn,27,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.O5,w.JJ],styles:[".confirmation-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:33%;top:33%;left:37%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute}.card[_ngcontent-%COMP%]{height:15rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),T})();function hn(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr",24)(1,"td",25),e._uU(2),e.qZA(),e.TgZ(3,"td",26)(4,"input",27),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ITEMDESC=s)}),e.qZA()(),e.TgZ(5,"td",28)(6,"input",27),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.MANUFACTURER=s)}),e.qZA()(),e.TgZ(7,"td",29)(8,"input",30),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ALTUNIT=s)}),e.qZA()(),e.TgZ(9,"td",31)(10,"input",32),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ALTERNATEQUANTIY=s)}),e.qZA()(),e.TgZ(11,"td",33),e._UZ(12,"input",34),e.ALo(13,"twoDigitNumber"),e.qZA(),e.TgZ(14,"td",29)(15,"input",35),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.INDDISCOUNTRATE=s)}),e.qZA()(),e.TgZ(16,"td",33),e._UZ(17,"input",36),e.ALo(18,"twoDigitNumber"),e.qZA(),e.TgZ(19,"td",37),e._UZ(20,"input",38),e.qZA(),e.TgZ(21,"td",39),e._uU(22),e.ALo(23,"twoDigitNumber"),e.qZA(),e.TgZ(24,"td",39),e._uU(25),e.ALo(26,"twoDigitNumber"),e.qZA(),e.TgZ(27,"td",39),e._uU(28),e.ALo(29,"twoDigitNumber"),e.qZA()()}if(2&T){const i=A.$implicit,n=A.index,s=e.oxw(2);e.xp6(1),e.MGl("id","sno",n,""),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.MGl("id","mixeddesc",n,""),e.Q6J("ngModel",i.ITEMDESC),e.xp6(2),e.MGl("id","account",n,""),e.Q6J("ngModel",i.MANUFACTURER),e.xp6(2),e.MGl("id","mixedunit",n,""),e.Q6J("ngModel",i.ALTUNIT),e.xp6(2),e.MGl("id","mixedquantity",n,""),e.Q6J("ngModel",i.ALTERNATEQUANTIY),e.xp6(2),e.MGl("id","mixedrate",n,""),e.Q6J("ngModel",s.applyPipeInRate?e.lcZ(13,26,i.ALTRATE):i.ALTRATE),e.xp6(3),e.MGl("id","mixeddiscount",n,""),e.Q6J("ngModel",i.INDDISCOUNTRATE),e.xp6(2),e.MGl("id","mixeddiscountAmt",n,""),e.Q6J("ngModel",e.lcZ(18,28,s._trnMainService.nullToZeroConverter(i.INDDISCOUNT))),e.xp6(2),e.MGl("id","mixedmrp",n,""),e.xp6(1),e.Q6J("ngModel",i.CRATE)("disabled",1==s._trnMainService.disableAllFieldinPurchase)("readonly",!0),e.xp6(1),e.MGl("id","mixedamntId",n,""),e.xp6(1),e.hij(" ",e.lcZ(23,30,s._trnMainService.nullToZeroConverter(i.AMOUNT))," "),e.xp6(2),e.MGl("id","mixedvatvalue",n,""),e.xp6(1),e.hij(" ",e.lcZ(26,32,s._trnMainService.nullToZeroConverter(i.VAT))," "),e.xp6(2),e.MGl("id","mixednetamount",n,""),e.xp6(1),e.hij(" ",e.lcZ(29,34,s._trnMainService.nullToZeroConverter(i.NETAMOUNT))," ")}}function dn(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),e._uU(5,"Preview Bill"),e.qZA(),e.TgZ(6,"div",5)(7,"button",6),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(8,"Close"),e.qZA()()()(),e.TgZ(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"table",11)(14,"thead")(15,"tr",12)(16,"th",13),e._uU(17,"Sn."),e.qZA(),e.TgZ(18,"th",14),e._uU(19,"Description"),e.qZA(),e.TgZ(20,"th",15),e._uU(21,"Account"),e.qZA(),e.TgZ(22,"th",16),e._uU(23,"Unit"),e.qZA(),e.TgZ(24,"th",17),e._uU(25,"Quantity"),e.qZA(),e.TgZ(26,"th",18),e._uU(27,"P.Rate"),e.qZA(),e.TgZ(28,"th",16),e._uU(29,"Dis%"),e.qZA(),e.TgZ(30,"th",18),e._uU(31,"Dis Amt"),e.qZA(),e.TgZ(32,"th",18),e._uU(33,"Net Rate"),e.qZA(),e.TgZ(34,"th",18),e._uU(35,"Amt"),e.qZA(),e.TgZ(36,"th",18),e._uU(37,"VAT"),e.qZA(),e.TgZ(38,"th",18),e._uU(39,"Net Amt"),e.qZA()()(),e.TgZ(40,"tbody",19),e.YNc(41,hn,30,36,"tr",20),e.qZA()()()()()(),e.TgZ(42,"div",21)(43,"table",11)(44,"tr",22)(45,"th",23),e._uU(46),e.qZA(),e.TgZ(47,"th",23),e._uU(48),e.qZA(),e.TgZ(49,"th",23),e._uU(50),e.qZA(),e.TgZ(51,"th",23),e._uU(52),e.qZA(),e.TgZ(53,"th",23),e._uU(54),e.qZA(),e.TgZ(55,"th",23),e._uU(56),e.qZA()()()()()()}if(2&T){const i=e.oxw();e.xp6(41),e.Q6J("ngForOf",i.mergedProductList),e.xp6(5),e.hij("TOTAL QTY: ",i._trnMainService.TrnMainObj.TOTALQTY," "),e.xp6(2),e.hij("GROSS: ",i._trnMainService.TrnMainObj.GROSSAMNT," "),e.xp6(2),e.hij("TAXABLE: ",i._trnMainService.TrnMainObj.TAXABLE," "),e.xp6(2),e.hij("NON TAXABLE: ",i._trnMainService.TrnMainObj.NONTAXABLE,""),e.xp6(2),e.hij("VAT: ",i._trnMainService.TrnMainObj.VATAMNT,""),e.xp6(2),e.hij("NET AMNT: ",i._trnMainService.TrnMainObj.NETAMNT,"")}}let un=(()=>{class T{constructor(i,n,s,p,b){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=p,this.spinnerService=b,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.mergedProductList=[]}ngOnInit(){}closeDialog(){this.isActive=!1}show(i){this.mergedProductList=i,this.isActive=!0}hide(){this.isActive=!1}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(g.qu),e.Y36(f.P),e.Y36(N.p),e.Y36($.c),e.Y36(Z.V))},T.\u0275cmp=e.Xpm({type:T,selectors:[["preview-bill-popup-dialog"]],decls:1,vars:1,consts:[["class","previewbill-container",4,"ngIf"],[1,"previewbill-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"overflow-y","scroll","overflow-x","hidden"],[2,"width","104%","margin-left","-25px"],[1,"row","col-md-12"],[1,"col-md-12"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4","width","100%"],["scope","col",2,"width","2%"],["scope","col",2,"width","9%","text-align","center"],["scope","col",2,"width","10%","text-align","center"],["scope","col",2,"width","3%","text-align","center"],["scope","col",2,"width","4%","text-align","center"],["scope","col",2,"width","5%","text-align","center"],[2,"background-color","aliceblue"],["style","height: 28px;",4,"ngFor","ngForOf"],[1,"row",2,"margin-top","auto","width","100%","margin-bottom","-15px"],[2,"line-height","1.2rem"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],[2,"height","28px"],[2,"border","1px solid #e6e6e6","width","2%",3,"id"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","9%"],["type","text","autocomplete","off","readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","10%"],[2,"height","23px","border","1px solid #e6e6e6","width","3%"],["readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel"],["type","number","decimalPlacesRestriction","2","min","0","max","100","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],["type","number","decimalPlacesRestriction","2","step","0.01","readonly","",2,"width","98%","text-align","right",3,"id","ngModel"],[2,"height","23px","border","1px solid #e6e6e6","width","5%",3,"id"],["type","text","readonly","",2,"width","98%","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #e6e6e6","width","5%","text-align","right",3,"id"]],template:function(i,n){1&i&&e.YNc(0,dn,57,7,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[w.sg,w.O5,g.Fj,g.wV,g.JJ,g.qQ,g.Fd,g.On,$e.g],styles:[".previewbill-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:20%;left:5%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:83vh;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),T})();var pn=E(11728),_n=E(7838),Tn=E(8630),Mn=E(23707);const mn=["digitalSignUpload"],Sn=["genericGrid"],vn=["genericimageupload"],gn=["genericTender"],fn=["genericGridHoldBill"],On=["Transport"],bn=["genericGridIntend"],Cn=["printSetupModal"],An=["genericGridReverseView"],En=["genericGridPerformaView"],In=["genericGridForRecurring"],Pn=["genericGridforPreviousOpening"],yn=["deliverySelectPopup"],xn=["requisitionSelectPopup"],Rn=["genericGridExpList"],Nn=["genericGridForTaxCancel"],Ln=["ImportPurchaseDetail"],wn=["reverseEntryConfirm"],Dn=["authenticationPopup"],jn=["itemInfo"],Qi=["itemSearchPopup"],kn=["genericGridForLargeDataEntry"],Vn=["genericGridTransferOut"],Un=["rateValidatoin"],Bn=["PaymentPopup"],Kn=["RecurringLog"],Zn=["StockAdjustment"],Fn=["CreateCustomerPopup"],Hn=["AutoAdjustment"],Qn=["OpeningFromPreviousYear"],Gn=["TermConditionPopup"],Yn=["PrevYearOpening"],Jn=["MemberPointConfirmationPopup"],qn=["BillPreviewPopup"],Wn=["multiselectGenericGrid"];function $n(T,A){1&T&&(e.TgZ(0,"span",79),e._uU(1,"Post By :"),e.qZA())}function zn(T,A){if(1&T&&(e.TgZ(0,"span",80),e._uU(1),e.qZA()),2&T){const i=e.oxw();e.xp6(1),e.hij("",i._trnMainService.TrnMainObj.TRNUSER,"\n")}}function Xn(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",2),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.OpenBOMListPopup())}),e._uU(1," List BOM\n"),e.qZA()}}function er(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",81),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportPurchaseInvoice())}),e._uU(1," IMPORT PO F2\n"),e.qZA()}}function tr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",81),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportPurchaseInvoice())}),e._uU(1," IMPORT PI F2\n"),e.qZA()}}function ir(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",82),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseClick())}),e._uU(1," FORCE CLOSE\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode&&(1==i._trnMainService.TrnMainObj.STATUS||10==i._trnMainService.TrnMainObj.STATUS&&20!=i._trnMainService.TrnMainObj.VoucherType))}}function nr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",81),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseClick())}),e._uU(1," APPROVAL REJECTION\n"),e.qZA()}}function rr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",81),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.showBillTender())}),e._uU(1," Tender List\n"),e.qZA()}}function or(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPrintClicked())}),e._uU(1," PRINT F8\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function sr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",84),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPrintVoucher())}),e._uU(1,"\nPRINT VOUCHER\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function ar(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",85),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.stockSettlementApprovalLoad())}),e._uU(1," UNAPPROVED LIST\n"),e.qZA()}}function cr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Proforma Cancel\n"),e.qZA()}}function lr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Reverse Chalan\n"),e.qZA()}}function m(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",87),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPerformaViewRequest())}),e._uU(1," View Canceled Proforma\n"),e.qZA()}}function D(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",87),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPerformaViewRequest())}),e._uU(1," View Reverse Delivery Chalan\n"),e.qZA()}}function r(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.rejectPerformInvoice())}),e._uU(1," Reject\n"),e.qZA()}}function l(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.approvePerformInvoice())}),e._uU(1," Approve\n"),e.qZA()}}function c(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",88),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadSalesCancel())}),e._uU(1," Cancel SC\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function u(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",89),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onShowImportSO())}),e._uU(1," IMPORT SO\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function y(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",90),e.NdJ("click",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.onShowExpiredSO(s))}),e._uU(1," Expired Order List\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function K(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",91),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Reverse Entry\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",i._trnMainService.disableReverseEntryForLatePost)}}function ie(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewCarrryForwardClicked())}),e._uU(1," View Carry Forward Voucher\n"),e.qZA()}}function Me(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onEditLargeEntryClicked())}),e._uU(1,"\nEdit Large Entry\n"),e.qZA()}}function De(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.carryForwardPreviousFiscalYearVoucher())}),e._uU(1," Opening From Previous Fiscal Year\n"),e.qZA()}}function Ae(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forRequisition())}),e._uU(1," From Requisition\n"),e.qZA()}}function Ce(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forStockAdjustment())}),e._uU(1," Stock Adjusment\n"),e.qZA()}}function hr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewClicked())}),e._uU(1," VIEW F4\n"),e.qZA()}}function dr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewSignatureClicked())}),e._uU(1," VIEW SIGNATURE\n"),e.qZA()}}function ur(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewReverseClick())}),e._uU(1," View Reverse\n"),e.qZA()}}function pr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",91),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onEditClicked())}),e._uU(1," EDIT F7\n"),e.qZA()}if(2&T){const i=e.oxw();e.Q6J("disabled",14==i._trnMainService.TrnMainObj.VoucherType&&"self-billing"==i.activeurlpath)}}function _r(T,A){1&T&&(e.ynx(0),e._uU(1," POST [End]\n"),e.BQk())}function Tr(T,A){1&T&&e._uU(0," SAVE [End]\n")}function Gi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",91),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onSaveClicked())}),e.YNc(1,_r,2,0,"ng-container",92),e.YNc(2,Tr,1,0,"ng-template",null,93,e.W1O),e.qZA()}if(2&T){const i=e.MAs(3),n=e.oxw(),s=e.MAs(116);e.Q6J("disabled",1==n._trnMainService.disableAllFieldinSales||19===n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode||n.disableSaveBtnINCaseOfSingleBatch()||"VIEW"==n._trnMainService.TrnMainObj.Mode||n.validateBeforeSave()||"StockSettlementEntry"==n.activeurlpath&&"VIEW"==n._trnMainService.buttonMode||s.isActive),e.xp6(1),e.Q6J("ngIf",71==n._trnMainService.TrnMainObj.VoucherType)("ngIfElse",i)}}function Se(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyTC())}),e._uU(1),e.qZA()}if(2&T){const i=e.oxw();e.xp6(1),e.hij(" ",i.TermsButtonTag,"\n")}}function Yi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onNewClick())}),e._uU(1," RESET F3\n"),e.qZA()}}function Ji(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",94),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImageClick())}),e.TgZ(1,"span",95),e._UZ(2,"i",96),e.qZA(),e._uU(3,"Image Upload\n"),e.qZA()}}function fe(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onRefershRateClicked())}),e._uU(1," REFRESH RATE\n"),e.qZA()}}function qi(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",97),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onRecurringClick())}),e._uU(1," From Recurring Log\n"),e.qZA()}}function Qe(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onSyncClicked())}),e._uU(1," SYNC\n"),e.qZA()}}function ji(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadFromPerformaInvoice())}),e._uU(1," FROM PROFORMA\n"),e.qZA()}}function Mr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadFromDeliveryChalan())}),e._uU(1," FROM DELIVERY CHALAN\n"),e.qZA()}}function mr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.viewRecurringDetails())}),e._uU(1," View Recurring Info\n"),e.qZA()}}function Sr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.newSalesman())}),e._uU(1," SALESMAN F2\n"),e.qZA()}}function ki(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onCancelClick())}),e._uU(1," VOID\n"),e.qZA()}}function fr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",98),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportDetailsClick())}),e._uU(1," IMPORT DETAILS\n"),e.qZA()}}function Or(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",98),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onExportClick())}),e._uU(1," EXPORT NEGATIVE STOCK\n"),e.qZA()}}function br(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"button",98),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.OnBatchAdjustmentClick())}),e._uU(1," AUTO ADJUSTMENT\n"),e.qZA()}}function Cr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"generic-popup-Tender",35,99),e.NdJ("okClicked",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.okClicked(s))}),e.qZA()}}function Ar(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"Transport-Popup",35,100),e.NdJ("okClicked",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.TenderOkClick(s))}),e.qZA()}}function Er(T,A){if(1&T&&(e.ynx(0),e._UZ(1,"input",107),e._uU(2,"3mm POS Printer"),e._UZ(3,"br"),e.BQk()),2&T){const i=e.oxw(2);e.xp6(1),e.Q6J("formControl",i.printControl)}}function Ir(T,A){if(1&T&&(e.ynx(0),e._UZ(1,"input",108,109),e._uU(3,"A4 Printer"),e._UZ(4,"br"),e.BQk()),2&T){const i=e.oxw(2);e.xp6(1),e.Q6J("formControl",i.printControl)}}function Pr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",101)(1,"div",102)(2,"div",56)(3,"h4",103),e._uU(4,"Printing Device"),e.qZA()(),e.TgZ(5,"div",59)(6,"form"),e.YNc(7,Er,4,1,"ng-container",49),e.YNc(8,Ir,5,1,"ng-container",49),e.qZA()(),e.TgZ(9,"div",104)(10,"button",105),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelprint())}),e._uU(11," Cancel "),e.qZA(),e.TgZ(12,"button",106),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.setPrinterAndprint())}),e._uU(13," Print "),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(7),e.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||1==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType||3==i._trnMainService.TrnMainObj.VoucherType||16==i._trnMainService.TrnMainObj.VoucherType)}}function yr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"tr")(1,"td",118)(2,"input",119),e.NdJ("ngModelChange",function(s){const b=e.CHM(i).$implicit;return e.KtG(b.ischecked=s)}),e.qZA()(),e.TgZ(3,"td",118),e._uU(4),e.qZA(),e.TgZ(5,"td",118),e._uU(6),e.qZA(),e.TgZ(7,"td",118),e._uU(8),e.qZA(),e.TgZ(9,"td",118),e._uU(10),e.qZA(),e.TgZ(11,"td",118),e._uU(12),e.qZA(),e.TgZ(13,"td",118),e._uU(14),e.qZA(),e.TgZ(15,"td",118),e._uU(16),e.qZA(),e.TgZ(17,"td",118),e._uU(18),e.qZA(),e.TgZ(19,"td",118),e._uU(20),e.qZA(),e.TgZ(21,"td",118),e._uU(22),e.qZA(),e.TgZ(23,"td",118),e._uU(24),e.qZA()()}if(2&T){const i=A.$implicit;e.xp6(2),e.Q6J("ngModel",i.ischecked),e.xp6(2),e.Oqu(i.schemeno),e.xp6(2),e.Oqu(i.schemetype),e.xp6(2),e.Oqu(i.budget),e.xp6(2),e.Oqu(i.prorata),e.xp6(2),e.Oqu(i.qps),e.xp6(2),e.Oqu(i.areabudget),e.xp6(2),e.Oqu(i.aboveqty),e.xp6(2),e.Oqu(i.unit),e.xp6(2),e.Oqu(i.value),e.xp6(2),e.Oqu(i.valuetype),e.xp6(2),e.Oqu(i.discountamount)}}function xr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",110)(1,"div",102)(2,"div",56)(3,"h4",103),e._uU(4,"Available Schemes"),e.qZA()(),e.TgZ(5,"div",59)(6,"div",111)(7,"table",112)(8,"thead")(9,"tr",113)(10,"th")(11,"span",114),e._uU(12,"SCHEME APPLY"),e.qZA()(),e.TgZ(13,"th")(14,"span",114),e._uU(15,"SCHEME NO"),e.qZA()(),e.TgZ(16,"th")(17,"span",114),e._uU(18,"SCHEMETYPE"),e.qZA()(),e.TgZ(19,"th")(20,"span",114),e._uU(21,"BUDGET"),e.qZA()(),e.TgZ(22,"th")(23,"span",114),e._uU(24,"PRORATA"),e.qZA()(),e.TgZ(25,"th")(26,"span",114),e._uU(27,"QPS"),e.qZA()(),e.TgZ(28,"th")(29,"span",114),e._uU(30,"AREABUDGET"),e.qZA()(),e.TgZ(31,"th")(32,"span",114),e._uU(33,"ABOVEQTY"),e.qZA()(),e.TgZ(34,"th")(35,"span",114),e._uU(36,"UNIT"),e.qZA()(),e.TgZ(37,"th")(38,"span",114),e._uU(39,"VALUE"),e.qZA()(),e.TgZ(40,"th")(41,"span",114),e._uU(42,"VALUETYPE"),e.qZA()(),e.TgZ(43,"th")(44,"span",114),e._uU(45,"DISCOUNTAMOUNT"),e.qZA()()()(),e.TgZ(46,"tbody",115),e.YNc(47,yr,25,12,"tr",116),e.qZA()()()(),e.TgZ(48,"div",104)(49,"button",117),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.OkSchemeCommand())}),e._uU(50," Apply "),e.qZA(),e.TgZ(51,"button",117),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.CancelSchemeCommand())}),e._uU(52," Cancel "),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(47),e.Q6J("ngForOf",i.schemeFilterList)}}function Rr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",120)(1,"div",121)(2,"div",56)(3,"h4",103),e._uU(4,"Print Preview"),e.qZA()(),e.TgZ(5,"div",122)(6,"pre"),e._uU(7),e.qZA()(),e.TgZ(8,"div",104)(9,"button",105),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelprint())}),e._uU(10," Close "),e.qZA(),e.TgZ(11,"button",106),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.printPosBill())}),e._uU(12," Print "),e.qZA()()()()}if(2&T){const i=e.oxw();e.xp6(7),e.hij("        ",i.TrnMainObj.printStringForPos,"\n      ")}}function Nr(T,A){1&T&&(e.TgZ(0,"label",132),e._uU(1,"Requisition From :"),e.qZA())}function Lr(T,A){if(1&T&&(e.TgZ(0,"option",133),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.Q6J("ngValue",i.INITIAL),e.xp6(1),e.hij(" ",i.NAME," ")}}function wr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",60),e.YNc(1,Nr,2,0,"label",129),e.TgZ(2,"select",130),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw(2);return e.KtG(p._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),e.YNc(3,Lr,2,2,"option",131),e.qZA()()}if(2&T){const i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),e.xp6(1),e.Q6J("ngForOf",i.divisionList)}}function Dr(T,A){if(1&T&&(e.TgZ(0,"option",133),e._uU(1),e.qZA()),2&T){const i=A.$implicit;e.Q6J("ngValue",i.NAME),e.xp6(1),e.hij(" ",i.NAME," ")}}function jr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",60)(1,"label",132),e._uU(2,"From Warehouse:"),e.qZA(),e.TgZ(3,"select",130),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw(2);return e.KtG(p._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),e.YNc(4,Dr,2,2,"option",131),e.qZA()()}if(2&T){const i=e.oxw(2);e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),e.xp6(1),e.Q6J("ngForOf",i.warehouseList)}}function kr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",60)(1,"label",132),e._uU(2,"Requisition No :"),e.qZA(),e.TgZ(3,"input",134),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw(2);return e.KtG(p._trnMainService.TrnMainObj.REFORDBILL=s)})("keydown.Enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.fromTransferOut())}),e.qZA()()}if(2&T){const i=e.oxw(2);e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.REFORDBILL)}}function Vr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div")(1,"div",123)(2,"div",124)(3,"div",125)(4,"h5",126),e._uU(5,"From Requisition"),e.qZA(),e.TgZ(6,"button",57),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeReqModal())}),e.TgZ(7,"span",58),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",59),e.YNc(10,wr,4,3,"div",127),e.YNc(11,jr,5,2,"div",127),e.YNc(12,kr,4,1,"div",127),e.qZA(),e.TgZ(13,"div",104)(14,"button",128),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.saveRequisition())}),e._uU(15," Save "),e.qZA(),e.TgZ(16,"button",128),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.resetRequisition())}),e._uU(17," Reset "),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(10),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",5==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||5==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType)}}function Ur(T,A){1&T&&(e.TgZ(0,"th",157),e._uU(1," CURRENT WS-PRICE "),e.qZA())}function Br(T,A){1&T&&(e.TgZ(0,"th",158),e._uU(1,"NEW S-PRICE INCLUDING VAT"),e.qZA())}function Kr(T,A){1&T&&(e.TgZ(0,"th",158),e._uU(1,"NEW S-PRICE EXCLUDING VAT"),e.qZA())}function Zr(T,A){1&T&&(e.TgZ(0,"th",158),e._uU(1," NEW WS-PRICE EXCLUDING VAT "),e.qZA())}function Fr(T,A){1&T&&(e.TgZ(0,"th",158),e._uU(1," NEW WS-PRICE INCLUDING VAT "),e.qZA())}function Hr(T,A){if(1&T&&(e.TgZ(0,"td",160),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&T){const i=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,i.WSRATE_A)," ")}}function Qr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",160)(1,"input",162),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.NRATE_A=s)})("keyup",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.actualMarginCalculation(p,s))})("keydown.enter",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit,p=e.oxw(2);e.xp6(1),e.MGl("id","newSellingPrice",n,""),e.Q6J("ngModel",s.NRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Gr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",160)(1,"input",162),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.EX_NRATE_A=s)})("keyup",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.actualMarginCalculation(p,s))})("keydown.enter",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit,p=e.oxw(2);e.xp6(1),e.MGl("id","newSellingPrice",n,""),e.Q6J("ngModel",s.EX_NRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Yr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",160)(1,"input",162),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.WNRATE_A=s)})("keyup",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.actualMarginCalculation(p,s))})("keydown.enter",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit,p=e.oxw(2);e.xp6(1),e.MGl("id","newWholeSellingPrice",n,""),e.Q6J("ngModel",s.WNRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function Jr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"td",160)(1,"input",162),e.NdJ("change",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("ngModelChange",function(s){e.CHM(i);const p=e.oxw().$implicit;return e.KtG(p.EX_WNRATE_A=s)})("keyup",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.actualMarginCalculation(p,s))})("keydown.enter",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))})("keydown.Tab",function(s){e.CHM(i);const p=e.oxw().index,b=e.oxw(2);return e.KtG(b.onChangePurchasePrice(p,s))}),e.qZA()()}if(2&T){const i=e.oxw(),n=i.index,s=i.$implicit,p=e.oxw(2);e.xp6(1),e.MGl("id","newWholeSellingPrice",n,""),e.Q6J("ngModel",s.EX_WNRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activeindex].BASEUNIT!=s.UNIT)}}function qr(T,A){if(1&T&&(e.TgZ(0,"tbody")(1,"tr",159)(2,"td",160),e._uU(3),e.qZA(),e.TgZ(4,"td",160),e._uU(5),e.ALo(6,"twoDigitNumber"),e.qZA(),e.YNc(7,Hr,3,3,"td",161),e.YNc(8,Qr,2,3,"td",161),e.YNc(9,Gr,2,3,"td",161),e.YNc(10,Yr,2,3,"td",161),e.YNc(11,Jr,2,3,"td",161),e.qZA()()),2&T){const i=A.$implicit,n=e.oxw(2);e.xp6(3),e.hij(" ",i.UNIT," "),e.xp6(2),e.hij(" ",e.lcZ(6,7,i.CRATE_A)," "),e.xp6(2),e.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",0===(null==n.userSetting?null:n.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1===(null==n.userSetting?null:n.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING&&0==(null==n.userSetting?null:n.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1==n.userSetting.ENABLEWSALESRATEBILLING&&1==(null==n.userSetting?null:n.userSetting.VatExcludingRate))}}function Wr(T,A){if(1&T&&(e.TgZ(0,"h6",163),e._uU(1),e.ALo(2,"twoDigitNumber"),e.qZA()),2&T){const i=e.oxw(2);e.xp6(1),e.hij(" Actual Margin (RETAIL): ",e.lcZ(2,1,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginRetial),"% ")}}function $r(T,A){if(1&T&&(e.TgZ(0,"div",164)(1,"h6",165),e._uU(2),e.ALo(3,"twoDigitNumber"),e.qZA(),e.TgZ(4,"h6",165),e._uU(5),e.ALo(6,"twoDigitNumber"),e.qZA()()),2&T){const i=e.oxw(2);e.xp6(2),e.hij("Actual Margin (RETAIL): ",e.lcZ(3,2,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginRetial),"%"),e.xp6(3),e.hij("Actual Margin (Wholesale): ",e.lcZ(6,4,i._trnMainService.TrnMainObj.ProdList[i.activeindex].ActualmarginWholeSale),"%")}}function zr(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",135)(1,"div",136)(2,"div",137)(3,"h4",138),e._uU(4," Selling Price Setting "),e.qZA()(),e.TgZ(5,"div",139)(6,"div")(7,"h5",138),e._uU(8," Cost Price has been changed.Please reset your new Selling Price "),e.qZA(),e._UZ(9,"hr",140),e.qZA(),e.TgZ(10,"fieldset")(11,"legend",141),e._uU(12," New Selling Price Setting "),e.qZA(),e.TgZ(13,"div",142)(14,"table",143)(15,"thead")(16,"tr",144)(17,"th",145),e._uU(18,"UOM"),e.qZA(),e.TgZ(19,"th",146),e._uU(20,"CURRENT S-PRICE"),e.qZA(),e.YNc(21,Ur,2,0,"th",147),e.YNc(22,Br,2,0,"th",148),e.YNc(23,Kr,2,0,"th",148),e.YNc(24,Zr,2,0,"th",149),e.YNc(25,Fr,2,0,"th",149),e.qZA()(),e.YNc(26,qr,12,9,"tbody",116),e.qZA()(),e.TgZ(27,"div",60)(28,"div",150)(29,"div",151)(30,"h6"),e._uU(31),e.qZA()(),e.TgZ(32,"div",152),e.YNc(33,Wr,3,3,"h6",153),e.YNc(34,$r,7,6,"div",154),e.qZA()()()(),e.TgZ(35,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyClickNewPrice())}),e._uU(36," APPLY "),e.qZA(),e.TgZ(37,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyOldPriceClick())}),e._uU(38," APPLY OLD S-PRICE "),e.qZA(),e.TgZ(39,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onCloseClick())}),e._uU(40," CLOSE "),e.qZA(),e.TgZ(41,"div",60)(42,"label",155),e._uU(43,"ITEM:"),e.qZA(),e.TgZ(44,"label",156),e._uU(45),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(21),e.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",0==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING&&1==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING&&0==(null==i.userSetting?null:i.userSetting.VatExcludingRate)),e.xp6(1),e.Q6J("ngForOf",i._trnMainService.priceChangeList),e.xp6(5),e.hij(" Recommended Margin: ",i._trnMainService.selectedProdcutRecMargin,"% "),e.xp6(2),e.Q6J("ngIf",!i.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING),e.xp6(11),e.hij(" ",i._trnMainService.TrnMainObj.ProdList[i.activeindex].ITEMDESC,"")}}function Xr(T,A){1&T&&(e.TgZ(0,"h5",181),e._uU(1," Force Close Confirmation "),e.qZA())}function eo(T,A){1&T&&(e.TgZ(0,"h5",181),e._uU(1," Approval Rejection Confirmation "),e.qZA())}function to(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div",166)(1,"div",167)(2,"div",168),e.YNc(3,Xr,2,0,"h5",169),e.YNc(4,eo,2,0,"h5",169),e.TgZ(5,"div",170)(6,"button",171),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseSubmit())}),e._uU(7," SUBMIT "),e.qZA(),e.TgZ(8,"button",172),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeForceClose())}),e._uU(9," CANCEL "),e.qZA()()(),e.TgZ(10,"div",173)(11,"div",174)(12,"label",175),e._uU(13,"Invoice No :"),e.qZA(),e.TgZ(14,"div",176)(15,"input",177),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.forceCloseObj.VCHRNO=s)}),e.qZA()()(),e.TgZ(16,"div",178)(17,"label",179),e._uU(18),e.qZA(),e.TgZ(19,"div",176)(20,"textarea",180),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.forceCloseObj.REMARKS=s)}),e.qZA()()()()()()}if(2&T){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",90!=i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==i._trnMainService.TrnMainObj.VoucherType),e.xp6(11),e.Q6J("ngModel",i.forceCloseObj.VCHRNO),e.xp6(3),e.hij("Remarks for ",i.displayNameForceClose,":"),e.xp6(2),e.Q6J("ngModel",i.forceCloseObj.REMARKS)}}function io(T,A){if(1&T&&(e.TgZ(0,"tr")(1,"td",192),e._uU(2),e.qZA(),e.TgZ(3,"td",193),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",194),e._uU(7),e.qZA()()),2&T){const i=A.$implicit;e.xp6(2),e.Oqu(i.TRNMODE),e.xp6(2),e.hij(" ",e.xi3(5,3,i.AMOUNT,"1.2-2")," "),e.xp6(3),e.Oqu(i.REMARKS)}}function no(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div")(1,"div",182)(2,"div",183)(3,"div",125)(4,"h6",126),e._uU(5,"Bill tender list"),e.qZA(),e.TgZ(6,"button",57),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeTenderList())}),e.TgZ(7,"span",58),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",59)(10,"table",184)(11,"thead")(12,"tr",185)(13,"th",186),e._uU(14,"Tender Mode"),e.qZA(),e.TgZ(15,"th",187),e._uU(16,"Amount"),e.qZA(),e.TgZ(17,"th",188),e._uU(18,"Account"),e.qZA()()(),e.TgZ(19,"tbody",189),e.YNc(20,io,8,6,"tr",116),e.qZA()()(),e.TgZ(21,"div",190)(22,"button",191),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeTenderList())}),e._uU(23," Close "),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(20),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.TenderList)}}function ro(T,A){if(1&T){const i=e.EpF();e.TgZ(0,"div")(1,"div",195)(2,"div",124)(3,"div",125)(4,"h5",126),e._uU(5," Reverse Entry authorization "),e.qZA(),e.TgZ(6,"button",57),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeReverseEntryAuthPopup())}),e.TgZ(7,"span",58),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",59)(10,"div",196)(11,"label",197),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",198)(14,"input",199),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.reverseEntryAuthObj.username=s)}),e.qZA()()(),e.TgZ(15,"div",196)(16,"label",197),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",198)(19,"input",200),e.NdJ("ngModelChange",function(s){e.CHM(i);const p=e.oxw();return e.KtG(p.reverseEntryAuthObj.password=s)}),e.qZA()()()(),e.TgZ(20,"div",104)(21,"button",128),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.reverseEntryAuthConfirm())}),e._uU(22," Confirm "),e.qZA()()()()()}if(2&T){const i=e.oxw();e.xp6(14),e.Q6J("ngModel",i.reverseEntryAuthObj.username),e.xp6(5),e.Q6J("ngModel",i.reverseEntryAuthObj.password)}}const oo=function(){return{backdrop:"static"}};let so=(()=>{class T{constructor(i,n,s,p,b,W,te,oe,ae,se,Le,Pe,ye,xe,ce,le,ue){this._trnMainService=i,this.setting=n,this.dialog=s,this.router=p,this.arouter=b,this.alertService=W,this.spinnerService=te,this.authService=oe,this.loadingService=ae,this.invoicePrint=se,this.notificationService=Le,this.notificationsService=Pe,this.validationService=ye,this.masterService=xe,this.onSaveClickValidationService=ce,this.productHelperSerivce=le,this.PrintHelperService=ue,this.buttonShow=!0,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.forceCloseObj={},this.additionalcostEmit=new e.vpe,this.deliveryChalanEmit=new e.vpe,this.onViewClickEmit=new e.vpe,this.onLoadFromSOClickEmit=new e.vpe,this.onLoadFromPOClickEmit=new e.vpe,this.onLoadFromHOPerformaInvoiceClickEmit=new e.vpe,this.onLoadFromPerformaInvoiceClickEmit=new e.vpe,this.onLoadFromReverseEntryEmit=new e.vpe,this.onLoadFromHoTaxInvoiceClickEmit=new e.vpe,this.onLoadFromSAPFTPClickEmit=new e.vpe,this.onShowFileUploadPopupEmit=new e.vpe,this.onLoadFromStockSettlementApproval=new e.vpe,this.onSettlementStockApprove=new e.vpe,this.onApproveStockSettlementList=new e.vpe,this.onFileUploadPopupEmit=new e.vpe,this.onSaveINVAllocation=new e.vpe,this.onSaveSelfBilling=new e.vpe,this.onclickOnResetPopupEmit=new e.vpe,this.onLoadCancelSalesEmit=new e.vpe,this.gridPopupSettingForPreviousOpening=new Q.im,this.gridPopupSettingsForExpList=new z.sG,this.onAddNewCustomerClickEmit=new e.vpe,this.onClickCustomer=new e.vpe,this.onClickSalesMan=new e.vpe,this.gridPopupSettingsForTaxCancel=new Q.im,this.itemInfoPopupSettings=new V,this.gridPopupSettingForLargeEntry=new Q.im,this.checkstatus=!0,this.viewSubscription=new v.w,this.gridPopupSettings=new Q.im,this.gridPopupSettingsForReverse=new Q.im,this.gridPopupSettingsForViewPerforma=new Q.im,this.gridPopupSettingsForRecurring=new Q.im,this.gridPopupSettingsForHoldBill=new Q.im,this.trialUrl=!1,this.showUnApprove=!1,this.gridPopupSettingsForIntend=new Q.im,this.showschemePopup=!1,this.editClicked=!1,this.viewClicked=!1,this.RouteList=[],this.CustomerList=[],this.hideButton=!1,this.addForRequisition=!1,this.divisionList=[],this.warehouseList=[],this.showReverseEntryAuth=!1,this.reverseEntryAuthObj={username:"",password:""},this.multiselectPopupSettings=new G.oe,this.genericGridTransferOutSetting=new Q.im,this.showEdit=!1,this.showPriceChangeDetail=!1,this.showPriceChangeDetailINDisc=!1,this.recurringItems=[],this.commissionChargeable=[],this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this.showForceClose=!1,this.showTenderList=!1,this.recurringLogMode="add",this.displayNameForceClose="Force Close",this.TermsButtonTag="APPLY T&C",this.NegativeBillAuthObj={username:"",password:"",remarks:""},this.termnConditionMode="",this.promptPrintDevice=!1,this.printControl=new g.NI(0),this.ConsumptionArray=[],this.reportData=[],this.menudata=[],this.reportHeaders=["ProductCode","ProductName","BatchNumber","MfgDate","ExpDate","Case","Each","Rate","Vat","NetAmount"],this.reportBody=["MCODE","ITEMDESC","BATCH","MFGDATE","EXPDATE","AltQty","BASEQUANTITY","ALTRATE","VAT","NETAMOUNT"],this.schemeFilterList=[],this._trnMainService.TrnMainObj.IsWholesale=!1,this.appType=this.masterService.appType,this.TrnMainObj=i.TrnMainObj,this.masterService.ShowMore=!1,this.AppSettings=this.setting.appSetting,this.userProfile=oe.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.showSecondaryButtons=!1,"VIEW"==this._trnMainService.TrnMainObj.Mode&&(this.showSecondaryButtons=!0),this.masterService.refreshTransactionList(),this.orgtype=this._trnMainService.userProfile.CompanyInfo.ORG_TYPE,this.userSetting=oe.getSetting(),(this.TrnMainObj.VoucherType==S.Km.CreditNote||this.TrnMainObj.VoucherType==S.Km.SalesReturn)&&(this.transactionType="creditnote"),this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&1==this.userSetting.PODELIVERYMODE&&(this.TermsButtonTag="VIEW T&C"),this.gridPopupSettings="add-creditnote-itembase-approval"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSALESRETURN"):"add-stock-issue-approval"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSTOCKTRANSFER"):"export-sales-invoice"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"EXPORT_SALES"):"purchase-import"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE"):"goods-received-note-import"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,this._trnMainService.TrnMainObj.AdditionalObj.tag):"add-membership-sales-invoice"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"MembershipSalesInvoice"):"transfer-out-approval"==b.snapshot.url[0]?.path||"stock-issue-approval"==b.snapshot.url[0]?.path?this.getPopUpSettingForApproval():"purchase-import-order"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE_ORDER"):"asset-purchase-invoice"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"ASSET_PURCHASE"):"assets-openingstockentry"==b.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("OP_ASSET","ASSET_OPENING"):this.masterService.getGenericGridPopUpSettings("shortage-adjustment"==b.snapshot.url[0]?.path?"CENTRAL_SHORTAGE_ADJUSTMENT":"excess-adjustment"==b.snapshot.url[0]?.path?"EXCESS_ADJUSTMENT":this.TrnMainObj.VoucherPrefix),"DL"==this.TrnMainObj.VoucherPrefix&&this.addCustomerfilterforDeliveryViewPopup(),this.gridPopupSettingsForHoldBill=this.masterService.getGenericGridPopUpSettings("HOLDBILLLIST"),this.gridPopupSettingsForIntend=this.masterService.getGenericGridPopUpSettings("INTENDLIST"),this.activeurlpath=b.snapshot.url[0].path,this.itemInfoPopupSettings={title:"Item Info"}}addCustomerfilterforDeliveryViewPopup(){this.gridPopupSettings.columns.splice(1,0,{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1})}ngOnInit(){console.log("voucher master action",this.arouter.snapshot),this.arouter.queryParams.subscribe(i=>{if("DRILL"==i.mode&&i.returnUrl)this.returnUrl="/pages/reports/"+i.returnUrl;else{if(this.returnUrl="/pages/dashboard/dashboard",this._trnMainService.TrnMainObj.Mode="NEW",this.viewClicked=!1,this.editClicked=!1,this.hideButton=!0,this.masterService.headerMode="(NEW)",this.arouter.snapshot.params.returnUrl&&(this.returnUrl=this.arouter.snapshot.params.returnUrl),"StockSettlementEntryApproval"==this.activeurlpath)return this.trialUrl=!0;if("StockSettlementEntry"==this.activeurlpath)return this.showUnApprove=!0}}),90===this._trnMainService.TrnMainObj.VoucherType&&(this.displayNameForceClose="Rejection"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue)&&1==this.userSetting.EnableRequisitionApproval&&(this.requisitionApprovalValue=1)}filterloginDivision(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||"add-branch-out"==this._trnMainService.activeurlpath)&&(this.divisionList=this.divisionList.filter(i=>i.INITIAL!=this.userProfile.userDivision))}ngAfterViewInit(){(8===this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType)&&(this.masterService.getNotLoginDivisionList().subscribe(i=>{this.divisionList=i,8===this._trnMainService.TrnMainObj.VoucherType&&this.filterloginDivision()}),this.masterService.getWarehouseList().subscribe(i=>{this.warehouseList=i}))}ngOnDestroy(){try{this.subscriptions.forEach(i=>{i.unsubscribe()})}catch{}}editButtonCheck(){return 1!==this._trnMainService.TrnMainObj.VoucherType&&14!==this._trnMainService.TrnMainObj.VoucherType&&(3===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType||64===this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType||31===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryReturn||24===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry||82===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&0==this.userSetting.INVBASEPROFORMA)}checkUserRights(i){const n=this.userProfile.menuRights.find(s=>s.menu==this.activeurlpath);if(n){let p,s=n.right,b=!0;switch(i){case"add":p=s.find(W=>"add"==W),null==p&&(b=!1);break;case"edit":p=s.find(W=>"edit"==W),null==p&&(b=!1);break;case"delete":p=s.find(W=>"delete"==W),null==p&&(b=!1);break;case"print":p=s.find(W=>"print"==W),null==p&&(b=!1),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"add-creditnote-itembase"==this.activeurlpath)&&(b=!0);break;case"view":p=s.find(W=>"view"==W),null==p&&(b=!1)}return console.log("allowedd?",b),!!b||(this.alertService.warning("Current user has no rights to "+i),!1)}return this.alertService.warning("Cannot find any user rights."),!1}stockSettlementApprovalLoad(){this.onLoadFromStockSettlementApproval.emit(!0)}stockSettlementOnApproveList(){this.onApproveStockSettlementList.emit(!0)}productionConsumptionList(){let i="";"production-entry"==this.activeurlpath||"newproduction-entry"==this.activeurlpath?i="production":"consumption-entry"==this.activeurlpath&&(i="consumption"),this.gridPopupSettings={title:"Vouchers",apiEndpoints:`/getProductionConsumptionPagedList/${i}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"VCHRNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}stockSettlement(){var i=this._trnMainService.TrnMainObj.Mode="NEW";this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.IsApproveStockSettlement),(null==this._trnMainService.TrnMainObj.ProdList||null==this.TrnMainObj.ProdList)&&this.alertService.info("Product List is empty"),this.masterService.saveTransaction(i,this._trnMainService.TrnMainObj).subscribe(n=>{"ok"==n.status&&this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)})}onLoadFromSalesOrder(){this.onLoadFromSOClickEmit.emit(!0)}onLoadSalesCancel(){this.onLoadCancelSalesEmit.emit(!0)}onLoadFromPurchaseOrder(){this.onLoadFromPOClickEmit.emit(!0)}onLoadFromHOPerformaInvoiceClick(){this.onLoadFromHOPerformaInvoiceClickEmit.emit(!0)}onLoadFromHoTaxInvoiceClick(){this.onLoadFromHoTaxInvoiceClickEmit.emit(!0)}onLoadFromSAPFTPClick(){this.onLoadFromSAPFTPClickEmit.emit(!0)}onCloseClicked(){this.router.navigate(["/pages/dashboard"])}onEditClicked(){this.checkUserRights("edit")&&(this.onViewClicked("EDIT"),this.editClicked=!0,this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)",this._trnMainService.disableCustomerInputField=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.isRatePartial=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.disableNepaliDate=24===this._trnMainService.TrnMainObj.VoucherType)}onSyncClicked(){if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.alertService.warning("Please load voucher to sycn"),!1;this.loadingService.show("Syncing data, please wait"),this.masterService.syncBranchTransferOut(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.alertService.success(i.result),this.onReset()):"error"==i.status&&(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}onViewClicked(i=""){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.billFormatsForPrint=null,this.viewClicked=!0,"canceladdsientry"==this.activeurlpath?(this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this.onViewTaxCancel(),this.genericGrid.show()):"StockSettlementEntry"==this.activeurlpath?(this.stockSettlementOnApproveList(),this.viewClicked=!0,this._trnMainService.viewModeForStockSettle=!0):"PD"==this.TrnMainObj.VoucherPrefix?(this._trnMainService.TrnMainObj.Mode=i,this.productionConsumptionList(),this.genericGrid.show()):"PP"==this.TrnMainObj.VoucherPrefix?(this.gridPopupSettings.apiEndpoints="EDIT"==i?"/getTrnMainPagedList/PP/EDIT":"/getTrnMainPagedList/PP/tag",this.genericGrid.show()):"ER"==this.TrnMainObj.VoucherPrefix?("excess-goods-acknowledgement"==this.activeurlpath?this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreceive":"excess-goods-return"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreturn"),this.genericGrid.show()):("add-sales-invoice-wholesale"===this?.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/TI/wholeSale"),"self-billing"===this?.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/TI/selfBilling"),this.genericGrid.show()),this.clearQtyRate(),"VIEW T&C"==this.TermsButtonTag&&(this.TermsButtonTag="APPLY T&C")}gridPopupDataforPreviousOpening(){this.gridPopupSettingForPreviousOpening={title:"Vouchers",apiEndpoints:"/getCarryForwardOpeningVouchers",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}gridPopupDataforLargeDataEntry(){this.gridPopupSettingForLargeEntry={title:"Vouchers",apiEndpoints:"/getTrnMainPagedList/OP/tag",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onViewCarrryForwardClicked(){this.gridPopupDataforPreviousOpening(),this.genericGridforPreviousOpening.show()}onEditLargeEntryClicked(){this.gridPopupDataforLargeDataEntry(),this.genericGridForLargeDataEntry.show()}onRecurringClick(){this.gridPopupSettingsForRecurring={title:"Recurring Log List",apiEndpoints:"/getRecurringItemList",defaultFilterIndex:3,columns:[{key:"ACNAME",title:"Customer Name",hidden:!1,noSearch:!1},{key:"RECURRING_DATE",title:"Recurring Date",hidden:!1,noSearch:!1,format:!0},{key:"DESCA",title:"Recurring Item",hidden:!1,noSearch:!1},{key:"AMOUNT",title:"Amount",hidden:!1,noSearch:!1},{key:"ENTRYNO",title:"Entry No",hidden:!1,noSearch:!1}]},this.genericGridForRecurring.show()}promptPrinterDevice(){this.promptPrintDevice=!0,setTimeout(()=>{console.log("nativelem",this.printSetupModal),null!=this.printSetupModal&&this.printSetupModal.nativeElement.focus()},500)}printPosBill(){var i;this.showPosPrinterPreview=!1,(i=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function s(p){},!1),i.addEventListener("open",function n(p){i.onopen=()=>i.send(p)}(this.TrnMainObj.printStringForPos),!1),this._trnMainService.TrnMainObj.VoucherType=61==this._trnMainService.TrnMainObj.VoucherType?14:this._trnMainService.TrnMainObj.VoucherType}setPrinterAndprint(){if(this.promptPrintDevice=!1,this.userProfile.PrintMode=this.printControl.value,this._trnMainService.printModeForInvoice=this.userProfile.PrintMode,this.modeis=this._trnMainService.TrnMainObj.Mode,0==this.masterService.userSetting.DISPLAY&&(this.userProfile.PrintMode=99),"add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales&&(this.userProfile.PrintMode=0),"export-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableExportTaxInvoice&&(this.userProfile.PrintMode=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&(this.userProfile.PrintMode=0==this.userSetting.showLaserPintInSi||2==this.userSetting.showLaserPintInTi&&1==this.printControl.value?1:0),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(1==this.userSetting.showLaserPintInTi||2==this.userSetting.showLaserPintInTi&&0==this.printControl.value?this.userProfile.PrintMode=0:0==this.userSetting.showLaserPintInTi&&(this.userProfile.PrintMode=1)),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&(this.userProfile.PrintMode=1==this.userSetting.showLaserPintInSi&&1==this.userSetting.showLaserPintInTi&&1==this.userSetting.ENABLEMANUALSALESRETURN||1!=this.userSetting.ENABLEMANUALSALESRETURN&&(1==this.userSetting.showLaserPintInTi&&this._trnMainService.TrnMainObj.REFBILL.startsWith("TI")||1==this.userSetting.showLaserPintInSi&&this._trnMainService.TrnMainObj.REFBILL.startsWith("SI"))||1==this.userSetting.ENABLEMANUALSALESRETURN&&0==this.printControl.value?0:1),console.log("voucher type in print mode",this._trnMainService.TrnMainObj.VoucherType),(this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseTaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote)&&(this.userProfile.PrintMode=1),0!=this.userProfile.PrintMode){this.loadingService.show("please wait. Getting invoice data ready for printing.");try{if(this.parac=this._trnMainService.TrnMainObj.PARAC,"VIEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode){this.billFormatsForPrint=null,1!=this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),1==this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS});try{this.voucher=this._trnMainService.TrnMainObj.VCHRNO,this.masterService.savePrintLog(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote?this.masterService.getPrintTitleAsCopy(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}1==this.userSetting.EnableBillFormatInBilling&&this.masterService.getBillUnits(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{"ok"==i.status&&(this._trnMainService.qtyCheckForPrint="CASE"==i.result)})}else if("NEW"==this.modeis)try{this.masterService.savePrintLog(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this.phiscalid,this.trnuser).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"add-membership-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleNEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote?this.masterService.getPrintTitleAsCopy(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(console.log("PRINT-TITLE-as copy",n.result),this.titleNEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}}catch(i){this.alertService.info(i)}setTimeout(()=>{this._trnMainService.TrnMainObj.VoucherType=this._trnMainService.ReturnVoucherType(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)},100)}else try{"NEW"==this.modeis?this.masterService.getReprintData(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)}):this.masterService.getReprintData(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)})}catch(i){return void this.alertService.info(i)}}onPrintClicked(){this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation&&(this.TermsButtonTag="APPLY T&C"),this.modeForPrint=(0,H.cloneDeep)(this._trnMainService.TrnMainObj.Mode),this.checkUserRights("print")&&(1==this.masterService.userSetting.DISPLAY||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&2==this.userSetting.showLaserPintInSi||"add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales||(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&2==this.userSetting.showLaserPintInTi||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMANUALSALESRETURN&&(1!=this.userSetting.showLaserPintInTi||1!=this.userSetting.showLaserPintInSi)?this.promptPrinterDevice():this.setPrinterAndprint())}print(i){var n;(n=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function p(){},!1),n.addEventListener("open",function s(b){n.onopen=()=>n.send(b)}(i),!1)}onApplyTC(){const i=this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID;"VIEW T&C"==this.TermsButtonTag&&(this.termnConditionMode="VIEW"),i?this.getTermsAndConditionForViewMode(i).subscribe(n=>{this.showTermConditionPopUp(n)}):("add-purchase-order"==this.activeurlpath&&this._trnMainService.TrnMainObj.BILLTO&&(this.TermnCondId=null),this.termnConditionMode="",this.showTermConditionPopUp())}showTermConditionPopUp(i=[]){this.TermConditionPopup.show(i,this.termnConditionMode)}getTermsAndConditionForViewMode(i){if(i)return this.masterService.getMultipleTermsAndCondition(i)}onSaveClicked(){if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance||5!=this._trnMainService.TrnMainObj.CNDN_MODE||this.validationService.validateEmptyACName(this._trnMainService.TrnMainObj.AssetsProdList)&&this.validationService.validateEmptySubLedger(this._trnMainService.TrnMainObj.AssetsProdList)){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&this._trnMainService.TrnMainObj.REFBILL?.trim().toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.info("Refno and Bill No cannot be same");if(this.validationService.validateVariantProduct(this._trnMainService.TrnMainObj)){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder){if(!this.validationService.validateSalesOrderAdvancePayment(this._trnMainService.TrnMainObj))return;1==this.userSetting.ENABLE_WSRATE_INSORDER&&(this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate=1)}if("export-sales-invoice"!=this.activeurlpath||!this.validationService.validateExportsales(this._trnMainService.TrnMainObj)){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return void this.productHelperSerivce.saveButtonClicked();if(this._trnMainService.TrnMainObj.VoucherType in S.lK&&1==this._trnMainService.showFlatDiscOption)return void this.alertService.info("Please apply the inserted Flat discount before saving");if("add-branch-in"==this._trnMainService.activeurlpath&&null==this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please Select the Warehouse.");if(88==this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.LinkProductionwithconsumption){for(const n of this._trnMainService.TrnMainObj.ProdList)if(!n.EXPDATE&&n.REQEXPDATE)return void this.alertService.info("Please select expiry date for item: "+n.ITEMDESC);let i=this.onSaveClickValidationService.getDuplicatesForConsumptionList(this._trnMainService.TrnMainObj.ConsumptionProdList);if(i=i.filter(n=>!n.BATCH),i.length>0)return void this.alertService.info("Items: "+[...i.map(n=>n.ITEMDESC)]+" have empty batch. Please Review your Entry!!")}if(this.checkUserRights("add")){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&"export-sales-invoice"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&1==this.userSetting.GblEnableMixedTenderMode&&"B2C"==this.userSetting.CompanyType)return 1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTMEMPOINTS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)?void this.MemberPointConfirmationPopup.show():(this.NETAMNTWITHROUNDOFF=this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.calculateAvailableScheme(),this._trnMainService.assignNetAmntWithRoundOff(this.NETAMNTWITHROUNDOFF),void this.paymentClick());if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SchemeList?.length>0).length>0&&confirm("Do you want to apply scheme before saving ?")&&this._trnMainService.calculateAvailableScheme(),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&1===this.userSetting.EnableDigitalSignature)return this.clearSignature(),void this.digitalSignUpload.show();if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)this.masterService.getAssetDepreciationDoneMonths().subscribe(i=>{const n=this._trnMainService.TrnMainObj.BSDATE.split("/")[1];for(const s of i.result)if(s.MONTHNO===n)return void this.alertService.info(`Depreciation cancellation is required to proceed for this month(${s.MONTHNAME.toLowerCase()})`);this.onSaveTransactionClicked(),this.clearQtyRate()});else{if("delivery-chalan"===this.activeurlpath||"delivery-chalan-return"===this.activeurlpath){const i=this._trnMainService.TrnMainObj?.ProdList?.find(n=>0===n.RATE);if(i)return void this.alertService.info(`Please enter rate for ${i.ITEMDESC}!`)}this.onSaveTransactionClicked(),this.clearQtyRate()}}}}}}doAutoRoundingInSales(){1==this.userSetting.EnableRoundoff&&!this._trnMainService.isPurchaseModule()&&this._trnMainService.rounding()}clearSignature(){return(0,t.Z)(function*(){const{SigCapture:i}=yield Promise.resolve().then(E.bind(E,46241)),{SessionControl:n}=yield Promise.resolve().then(E.bind(E,5881));null!=i.HTMLTagIds?.imageBox?.firstChild&&(i.HTMLTagIds.imageBox.removeChild(i.HTMLTagIds.imageBox.firstChild),n.actionWhenRestarted())})()}validationInImportDocumentDetails(){if("purchase-import"===this.activeurlpath){if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return this.alertService.info("Please enter Import Document No!"),!0;if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)return this.alertService.info("Please enter L/C No!"),!0;if(1==this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport&&(!this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME))return this.alertService.info("Please select VAT Credit A/C!"),!0}return!1}confirmationOkClicked(i){i?(this._trnMainService.calculatePointRedemptionDiscount(),this.paymentClick()):(this._trnMainService.TrnMainObj.ProdList.forEach(n=>n.LOYALTY=0),this._trnMainService.TrnMainObj.MEMREDEEMPOINT=0,this._trnMainService.ReCalculateBillWithNormal(),this.paymentClick())}checkRedeemablePoint(){1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)&&confirm("Member has redeemable points remaining. Do you want to redeem points as discount?")&&(this._trnMainService.TrnMainObj.TOTALLOYALTY=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)*this._trnMainService.nullToZeroConverter(this.userSetting.PointConversionRate),console.log("TOTALLOYALTY value",this._trnMainService.TrnMainObj.TOTALLOYALTY,this._trnMainService.TrnMainObj.NETAMNT))}showNotificationCount(){this.connection=(new B.su).withUrl(`${U.N.apiUrl}/notificationConnection`,{transport:B.n4.WebSockets}).withAutomaticReconnect().build();var i=this;this.connection.start().then(()=>{console.log("start"),this.connection.invoke("GetConnectionId").then(function(n){console.log(n),i.socketId=n,i.connection.on("ReceiveMessage",s=>{console.log("connected"),this.notificationsService.info("Report Status",s.message),console.log(s.message)})})}).catch(n=>{})}onNewProductionEntrySave(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ConsumptionList.forEach(n=>{n.MasterMCode=i.MCODE,this.ConsumptionArray.push(n)})}),this._trnMainService.TrnMainObj.ConsumptionProdList=this.ConsumptionArray,this.ConsumptionArray=[]}onSaveTransactionClicked(){if("performa-invoice"==this.activeurlpath&&null==this._trnMainService.TrnMainObj.BILLTO)return this.alertService.warning("Please select customer first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("customerselectid").focus()},100)});if(2==this.userSetting.enablesalesman&&!this._trnMainService.TrnMainObj.SALESMAN&&(this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation))return this.alertService.warning("Please select salesman first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("salesmanselect").focus()},100)});if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation&&1==this.userSetting.ApplyTermsAndCondition){if(!this._trnMainService.TrnMainObj.AdditionalObj.PAYMENTTERMS)return void this.alertService.warning("Please select payment term!!!");if(!this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID)return void this.alertService.warning("Please select terms and conditions!!!")}if("RQ"!=this._trnMainService.TrnMainObj.VoucherPrefix||"EDIT"!=this._trnMainService.TrnMainObj.Mode||10!=this._trnMainService.TrnMainObj.STATUS)if(this.TrnMainObj.VoucherType==S.Km.RequisitionEntry&&this.showNotificationCount(),"newproduction-entry"===this.activeurlpath&&this.onNewProductionEntrySave(),this.TrnMainObj.VoucherType==S.Km.OpeningStockBalance||1!=this.userSetting.EnableRefno||""!=this._trnMainService.TrnMainObj.CHALANNO&&""!=this._trnMainService.TrnMainObj.CHALANNOPREFIX)if(this._trnMainService.saveButton=!0,this._trnMainService.TrnMainObj.VoucherType!=S.Km.Repack||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"QuantityExceed"!=this._trnMainService.quantityExceedCheck||"edit"!=this._trnMainService.TrnMainObj.Mode?.toLocaleLowerCase())if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssueReturn||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.AdditionalObj&&(this.billformat=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS),"GreaterQuantity"!=this._trnMainService.QuantityMsg)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoiceCancel||null!=this._trnMainService.TrnMainObj.REMARKS&&""!=this._trnMainService.TrnMainObj.REMARKS&&null!=this._trnMainService.TrnMainObj.REMARKS){if((this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Sales||"credit"!=this._trnMainService.TrnMainObj.TRNMODE||this.checkCreditLimitForTransaction())&&(this._trnMainService.TrnMainObj.VoucherType!=S.Km.SalesOrder||1!=this.userSetting.EnableCreditLimitInSO||this.checkCreditLimitForTransaction())){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder){let n="";if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder?(this._trnMainService.TrnMainObj.PARAC||(this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC),n="Supplier"):this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(n="Customer"),null==this._trnMainService.TrnMainObj.BILLTO||""==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please Choose "+n+" to proceed...")}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this._trnMainService.salesmanID=this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.salesmanName=this._trnMainService.TrnMainObj.SALESMAN,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,"add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.IsWholesale=!0,this._trnMainService.TrnMainObj.INVOICETYPE="wholeSale")),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase-approval"==this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.isApproved)),this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote){if(1==this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry){if(this._trnMainService.TrnMainObj.TRNDATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Entry date cannot be set before of Sales Invoice date!!!");if(this._trnMainService.TrnMainObj.TRN_DATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Invoice date cannot be set before of Sales Invoice date!!!")}if("DN"==this._trnMainService.TrnMainObj.REFORDBILL?.substring(0,2)&&!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REMARKS)return void this.alertService.info("Remarks cannot be empty");if(!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if("salesreturn"==this._trnMainService.TrnMainObj.TRNMODE&&"error"==this._trnMainService.TrnMainObj.TRNACName&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.warning("Default Sales return voucher AC' on database not set. Cannot save !")}if(!(this._trnMainService.TrnMainObj.VoucherType!==S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.PurchaseOrder&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.TaxInvoice||"purchase-import"!=this.activeurlpath&&"purchase-import-order"!=this.activeurlpath&&"export-sales-invoice"!=this.activeurlpath&&"goods-received-note-import"!=this.activeurlpath)){this.removeInvalidRowsFromprod();let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.INVRATE||null==s.INVRATE)[0];if(null!=n)return void this.alertService.info(`Rate cannot be 0 for item ${n.ITEMDESC} !!!`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice){if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Payment Terms cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account  not be empty");if("export-sales-invoice"===this.activeurlpath&&!this._trnMainService.TrnMainObj.COUNTRY)return void this.alertService.info("Country cannot be empty");if(!this._trnMainService.TrnMainObj.BILLTO)return this.alertService.info("Customer cannot be empty"),void("add-membership-sales-invoice"==this.activeurlpath&&this.alertService.info("Member cannot be empty"));if("add-membership-sales-invoice"==this.activeurlpath){let n=j()(new Date(this.masterService.userSetting.MEMBERITEMSPERIODS)).format("YYYY-MM-DD");if(this._trnMainService.TrnMainObj.TRNDATE>n)return void this.alertService.info("Transaction cannot be done...Exceeds item period")}}if(!(this._trnMainService.TrnMainObj.VoucherType!==S.Km.Sales||"cash"!=this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()||"B2B"!=this.userSetting.CompanyType||this._trnMainService.TrnMainObj.BILLTO&&this._trnMainService.TrnMainObj.PARAC))return void this.alertService.info("Customer cannot be empty. Select Customer Party to proceed");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Return Mode cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder&&!this._trnMainService.TrnMainObj.COSTCENTER&&1==this.userSetting.enabledistributedpurchase)return void this.alertService.info("Cost Center cannot be empty");if((this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&"goods-received-note"==this._trnMainService.activeurlpath)&&!this._trnMainService.TrnMainObj.COSTCENTER&&0!=this.userSetting.enableCostCenter&&1==this.userSetting.EnableCompulsoryCostCenter)return void this.alertService.info("Cost Center cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Please Enter the Invoice Number");if(!this._trnMainService.TrnMainObj.TRNAC&&"GOODS_RECEIVED_NOTE_IMPORT"!=this._trnMainService.TrnMainObj.AdditionalObj.tag)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE&&"goods-received-note-import"!=this.activeurlpath)return void this.alertService.info("Payment Terms cannot be empty");if("purchase-import"!=this.activeurlpath&&!this._trnMainService.TrnMainObj.BILLTOTEL&&0==this._trnMainService.TrnMainObj.VATBILL)return void this.alertService.info("Supplier VATNO cannot be empty");if("cheque"==this._trnMainService.TrnMainObj.TRNMODE){if(!this._trnMainService.TrnMainObj.CHEQUENO)return void this.alertService.info("Cheque No cannot be null");if(!this._trnMainService.TrnMainObj.CHEQUEDATE)return void this.alertService.info("Cheque Date cannot be null")}}if("add-purchase-invoice"==this.activeurlpath||"add-debitnote-itembase"==this.activeurlpath){if(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT)>0&&!this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME)return void this.alertService.info("Please press F10 and select the TDS Account to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT))return void this.alertService.info("Please press F10 and enter the TDS Amount to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.SubLedgerValidation)return void this.alertService.info("Please press F10 and select the TDS Sub Ledger Account to proceed!!!")}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Production warehouse cannot be empty");if(!this._trnMainService.TrnMainObj.BILLTOADD&&1==this.userSetting.EnableCompulsaryConsumption)return void this.alertService.warning("Consumption warehouse cannot be empty");this.assignWarehouseInProduction()}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry)&&!this.checkExpiry())return!1;if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferIn){if(0===this.userSetting.centralizeddbmode&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userDivision),!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.warning("Ref No. cannot be empty.");if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Transfer from field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){let n=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>new Date(s.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=s.MCODE&&1==s.REQEXPDATE)[0];if(console.log("expdta",n),null!=n&&this._trnMainService.TrnMainObj.ConsumptionProdList.some(s=>6!==s.PTYPE))return void this.alertService.info("Expired Item Detected : "+n.ITEMDESC+"..Please Review the list...")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("To Warehouse field cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry){if("TransferOut"==this._trnMainService.TrnMainObj.INVOICETYPE&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision),""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Requisition To field cannot be empty");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut){if(1===this.userSetting.REMARKSCOMPULSORYINBTRANSFEROUT&&!this._trnMainService.TrnMainObj.REMARKS?.trim())return void this.alertService.warning("Remarks is Mandatory");if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected");var i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(n){return[n.MCODE,n.BATCH,n.ALTUNIT,n.ALTRATE,n.BC]});for(const n of i)if(n.length>1)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){i=2==this.userSetting.EnableBatch?this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC,s.CRATE]}):this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.ISUNKNOWN),function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const n of i)if(n.length>1&&1!=this._trnMainService.TrnMainObj.isDeliveryOrder)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction){i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>0==s.ISUNKNOWN),function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const s of i)if(s.length>1)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&2==this.userSetting.EnableOnetoOneProduction){this.removeInvalidRowsFromprod();let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==this._trnMainService.nullToZeroConverter(s.AMOUNT))[0];if(n)return void this.alertService.info(`Amount can not be empty for item ${n.ITEMDESC}`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&!this._trnMainService.TrnMainObj.RECEIVEBY)return void this.alertService.warning("Please select customer to save !");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&"VIEW"!=this._trnMainService.buttonMode&&1===this.userSetting.ShowPriceChangePopup){let n=this._trnMainService.TrnMainObj.ProdList.lastIndexOf(this._trnMainService.TrnMainObj.ProdList.filter(s=>s.PREV_PRATE!==s.ALTRATE&&!s.HasSellingPriceChange)[0]);if(this.activeindex=n,n>=0)return this._trnMainService.getAllSelingPriceOfItem(n),void(this.showPriceChangeDetail=!0)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation&&(this.recurringItems=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.ISRECURRING),this.commissionChargeable=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.HASCOMMISSIONCHARGE),this.recurringItems?.length>0||this.commissionChargeable?.length>0))return this.commissionChargeable.length>0&&(null==this._trnMainService.TrnMainObj.SALESMANID||""==this._trnMainService.TrnMainObj.SALESMANID)?(this.alertService.warning("Please select salesman for entering commission chargeable item details !"),this.commissionChargeable=[],void(this.recurringItems=[])):(this.recurringLogMode="add",void this.RecurringLog.show("add",this._trnMainService.TrnMainObj.MAIN_RECURRING_ID,this._trnMainService.TrnMainObj.RECURREFBILL));if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation){let n=this._trnMainService.TrnMainObj.ProdList,s=this._trnMainService.TrnMainObj.RecurringItemList,b=this._trnMainService.TrnMainObj.CommissionItemList?.filter(W=>n.find(te=>te.MCODE==W.MCODE));if(this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],s?.length>0&&(this.recurringItemsForEdit=s),b?.length>0&&(this.commissionItemsForEdit=b),this.recurringItemsForEdit?.length>0||this.commissionItemsForEdit?.length>0)return this.recurringLogMode="edit",void this.RecurringLog.show("edit")}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice)&&0===this.userSetting.DisableCostPriceValidationInSO){let n=this.checkForUserRigths("AllowSalesBelowCRate");if(n&&0==n?.value&&!this.checkSalesRateBeforeCrate())return}if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.BranchTransferOut||this.checkExpItem()){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&"asset-purchase-invoice"!=this.activeurlpath&&"NONTRADING"==this._trnMainService.TrnMainObj.INVOICETYPE&&1==this.userSetting.EnableSubLedger){let n=this._trnMainService.TrnMainObj.AdditionProdList.filter(s=>1==s.HASSUBLEDGER).find(s=>null==s.SL_ACNAME);if(n)return void this.alertService.warning(`Subledger field cannot be left empty for the item: ${n.ITEMDESC}!!!`)}!this.transactionValidator()||(this.onSubmit(),this._trnMainService.onFlatDiscountClear(),this._trnMainService.isRatePartial=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE)}}}else this.alertService.info("Remarks is required...");else this.alertService.info("Quantity exceed the transaction stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Refno or Prefix cannot be empty");else this.alertService.info(`Cannot save ${this._trnMainService.TrnMainObj.VCHRNO} voucher no as it is already forced closed.`)}onBarCodeClicked(){this._trnMainService.showBarCodePopUPinViewMode=!0,this._trnMainService.showBarCodePopUPSubject.next()}assignWarehouseInProduction(){for(const i of this._trnMainService.TrnMainObj.ProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTO;for(const i of this._trnMainService.TrnMainObj.ConsumptionProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTOADD}onPerformaViewRequest(){this._trnMainService.buttonMode="VIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice?i="PQ":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&(i="CD"),this.gridPopupSettingsForViewPerforma=this.masterService.getGenericGridPopUpSettings(i),this.genericGridPerformaView.show()}checkCreditLimitForTransaction(){return!(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.CREDITLIMIT)>0&&this.validationService.validateCreditLimit(this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.TrnMainObj.BLAMOUNT,this._trnMainService.TrnMainObj.CREDITLIMIT)&&!this.checkCreditLimitRights())}onViewReverseClick(){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this.billFormatsForPrint=null,this._trnMainService.reverseViewTag="REVERSEVIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&(i="PX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&(i="RR"),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(i="DX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(i="RE"),this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry?i="PE":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn&&(i="RX"),this.gridPopupSettingsForReverse=this.masterService.getGenericGridPopUpSettings(i,this._trnMainService.TrnMainObj.AdditionalObj.tag),console.log("modevalue",this._trnMainService.TrnMainObj),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&5==this._trnMainService.TrnMainObj.CNDN_MODE&&this.prepareApiUrlforAssetPurchaseReverseView(this.gridPopupSettingsForReverse),this.genericGridReverseView.show()}prepareApiUrlforAssetPurchaseReverseView(i){i.apiEndpoints="/getTrnMainPagedList/PX/assetPurchaseReverse"}checkItemIsSelectedINProduction(){return!!this._trnMainService.TrnMainObj.ProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)>0)||(this.alertService.warning("Please enter Production Quantity."),!1)}checkItemIsSelectedINConsumption(){return!(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(n=>null==n.MCODE||""==n.MCODE)?.length>0&&(this.alertService.info("Items are not selected for consumption"),1))}checkInvalidQtyINConsumption(){let i=this._trnMainService.TrnMainObj.ConsumptionProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)<=0);return!i||(this.alertService.info(`Invalid Quantity is found in item: ${i.ITEMDESC}`),!1)}checkInvalidityInAdditionalPurchase(){if(!this._trnMainService.TrnMainObj.AdditionProdList.length)return!0;for(const i of this._trnMainService.TrnMainObj.AdditionProdList){if(this._trnMainService.nullToZeroConverter(i.ALTERNATEQUANTIY)<=0)return this.alertService.info(`Invalid Quantity is found in Account: ${i.MANUFACTURER}`),!1;if(!i.ITEMDESC)return this.alertService.info(`Description cannot be empty: ${i.ITEMDESC}`),!1;if(this._trnMainService.nullToZeroConverter(i.NETAMOUNT)<=0)return this.alertService.info(`NetAmount is Invalid: ${i.NETAMOUNT}`),!1}return!0}transactionValidator(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&(this._trnMainService.TrnMainObj?.ConsumptionProdList?.length>1&&this.removeInvalidRowsFromConsumptionprod(),!(this.checkItemIsSelectedINProduction()&&(0==this.userSetting.EnableCompulsaryConsumption&&this.removeInvalidRowsFromConsumptionprod(),1!=this.userSetting.EnableCompulsaryConsumption||this.checkItemIsSelectedINConsumption()&&this.checkInvalidQtyINConsumption())))||(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&this._trnMainService.TrnMainObj.AdditionProdList?.length>0&&(this._trnMainService.removeInvalidRowsFromAdditionalprod(),!this.checkInvalidityInAdditionalPurchase()))return!1;if(this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length>1&&this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&this.removeRejectedQtyFromprod(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue)&&0==this.userSetting.ENABLESINGLEBATCHMODE){let n=this.findDuplicates(this._trnMainService.TrnMainObj.ProdList.map(s=>s.MCODE));if(n&&n.length>0){let s="";for(const p of n){const b=this._trnMainService.TrnMainObj.ProdList.filter(W=>W.MCODE==p)?.find(W=>!W.BATCH);b&&(s=s+" "+b.ITEMDESC)}if(""!=s)return this.alertService.info(` following items ${s} have empty batch. Please check the entered items list`),!1}}if(!this._trnMainService.checkTransactionValidation())return null!=this.genericTender&&this.genericTender.hide(),!1;if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&!this._trnMainService.checkBatchWisePriceSelectedorNot())return!1;let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>1===n.HASVARIANT);if(i&&i?.length>0)for(const n of i)if(null==n.BC||""==n.BC)return this.alertService.info(`Variant Details is not selected for Item:${n.ITEMDESC}`),!1;return!!this._trnMainService.setDefaultValueInTransaction()}findDuplicates(i){const n=new Map,s=[];return i.forEach(p=>{n.has(p)?n.set(p,n.get(p)+1):n.set(p,1)}),n.forEach((p,b)=>{p>1&&s.push(b)}),s}disableSaveBtnINCaseOfSingleBatch(){if(1==this.userSetting.ENABLESINGLEBATCHMODE&&((this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&2==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&2==this.userSetting.ALLOWMINUSTOCK_STOCKISSUE||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&2==this.userSetting.ALLOWMINUSTOCK_SALES||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry&&2==this.userSetting.ALLOWMINUSTOCK_CONSUMPTION||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&2==this.userSetting.ALLOWMINUSTOCK_DEBITNOTE)&&(this._trnMainService.showNegativeBilling||this._trnMainService.showNegativeBillingAuthForMain)||this._trnMainService.TrnMainObj.VoucherType==S.Km.Repack&&2==this.userSetting.ALLOWMINUSTOCK_REPACK&&this._trnMainService.showNegativeBillingInConsumption))return!0}checkZeroRate(i){return i.filter(n=>!n.ALTRATE).length>0}onSubmit(){if(this.doAutoRoundingInSales(),("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.AssetsProdList=this._trnMainService.TrnMainObj.AssetsProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales){let i=this._trnMainService.TrnMainObj.PARAC;if(0==this.userSetting.EnablePanBill&&this._trnMainService.TrnMainObj.NETAMNT>this.userSetting.ABBlimit)return this.masterService.TempTrnMainObj=this._trnMainService.TrnMainObj,void(confirm(`Net amount is greater than ${this.userSetting.ABBlimit}, Bill cannot proceed. Do want to change to tax invoice ?`)&&(console.log("pac",i),this.router.navigate(["/pages/transaction/sales/add-sales-invoice"],{queryParams:{mode:"FROMSI",ID:i}})))}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase"==this.activeurlpath)this.saveSalesReturnDamageValueToTMP();else if("transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath)this.saveTransactionApproval();else if("add-stock-issue-approval"==this.activeurlpath)this.saveApproveStockTransfer();else if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Stockadjustment)this.saveStockSettlement();else{if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(null!=this._trnMainService.TrnMainObj.TransporterEway&&(this._trnMainService.TrnMainObj.TransporterEway.TOTALWEIGHT=this._trnMainService.TrnMainObj.TOTALWEIGHT),this.memberID=this._trnMainService.TrnMainObj.MEMBERNO,this.memberName=this._trnMainService.TrnMainObj.MEMBERNAME,this.schemeID=this._trnMainService.TrnMainObj.SCHEMENAME),"VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoiceCancel&&(this._trnMainService.TrnMainObj.Mode="NEW"),this.modeis=this._trnMainService.TrnMainObj.Mode,"NEW"==this.modeis?this._trnMainService.TrnMainObj.AdditionalObj&&(this.billFormatsForPrint=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this.billFormatsForPrint=null,this._trnMainService.TrnMainObj.PCL="pc002",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(14==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType)&&this.masterService.updateBillFormats(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS="FULL"),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&(this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.TrnMainObj.BILLTO),"requisition-entry"==this.activeurlpath&&1==this.userSetting.EnableRQLogInRQEntry){let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.checkInRQentry);if(0==i?.length)return void this.alertService.info("Please recheck the list and tick at least one of items to be requisite before saving.");this._trnMainService.TrnMainObj.ProdList=i,this._trnMainService.TrnMainObj.ProdList.forEach(n=>{n.UNIT==n.ALTUNIT&&(n.SPRICE=n.ALTRATE,n.ALTRATE=0,n.RATE=0),n.ALTQTY_IN=n.ALTERNATEQUANTIY,n.REALQTY_IN=n.ALTERNATEQUANTIY*n.ALTCONFACTOR})}if(80==this._trnMainService.TrnMainObj.VoucherType&&1==this.userSetting.EnableRQLogInRQEntry&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BASEQUANTITY=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.Quantity=i.BASEQUANTITY}),95==this._trnMainService.TrnMainObj.VoucherType||"shortage-adjustment"==this.activeurlpath){let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.checkInExcessAdj);if(0==i?.length)return void this.alertService.info("Please recheck the list and tick atleast one of the items to be adjusted before saving.");this._trnMainService.TrnMainObj.ProdList=i}if(82==this._trnMainService.TrnMainObj.VoucherType){if(this.assignRateAndQtyForAllocation(),this.mergeBranchList(),0==this._trnMainService.TrnMainObj.ProdList.filter(n=>n.TotalDispatch>0)?.length)return void this.alertService.info("No Product to Dispatch!");this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.TotalDispatch>0)}if(71==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.DIVISION=this._trnMainService.TrnMainObj.AdditionalObj.DIVISION),this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&"supplier"==this._trnMainService.TrnMainObj.filterByInReqApproval&&(this._trnMainService.TrnMainObj.INVOICETYPE="supplier",this.assignQtyInReqApp(),this.mergeBranchList()),this.ExcessAndShortageAdjustment(),"add-purchase-order"===this.activeurlpath&&(this._trnMainService.TrnMainObj.AdditionProdList=[]),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"FROMNOTIFICATION"==this._trnMainService.TrnMainObj.CHALANNOPREFIX&&(this._trnMainService.TrnMainObj.CHALANNOPREFIX=""),this._trnMainService.TrnMainObj.ProdList?.some(i=>i.MCODE)||this._trnMainService.TrnMainObj.AssetsProdList?.some(i=>i.MCODE)){let i="asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath?this._trnMainService.TrnMainObj.AssetsProdList.find(n=>!n.ALTUNIT):this._trnMainService.TrnMainObj.ProdList.find(n=>!n.ALTUNIT);if(this.validationService.checkEmptyUnit(i))return}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&this.checkZeroRate(this._trnMainService.TrnMainObj.ProdList)&&!confirm("Zero rate item detected. Continue?"))return;if("asset-purchase-invoice"===this.activeurlpath&&!this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please enter Location!");if("assets-openingstockentry"===this.activeurlpath)for(const i of this._trnMainService.TrnMainObj.AssetsProdList){if(!i.ACNAME)return void this.alertService.warning("Account cannot be empty");if(!i.PurchaseDate)return void this.alertService.warning("Please enter purchase date!");if(!i.LocID)return void this.alertService.warning("Please enter Location!");if(!i.BOOKVALUE||i.BOOKVALUE<0)return void this.alertService.warning("Please enter valid Bookvalue! Cannot be negative and empty");if(1===i.HASSUBLEDGER&&!i.SL_ACNAME)return void this.alertService.warning("Please enter Subledger")}if((this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales)&&this.userSetting?.EnableUserWiseCreditSalesRights&&!this._trnMainService.checkUserRightsForCreditSales()){const i=this.PaymentPopup?.paymentinfoList.some(s=>"CREDIT"===s.TRNMODE.trim().toUpperCase()),n="CREDIT"==this._trnMainService.TrnMainObj.TRNMODE.toUpperCase();if((this.userSetting.GblEnableMixedTenderMode&&i||n)&&!this._trnMainService.authGrantedForCreditSales)return void(this._trnMainService.showCreditSalesAuth=!0)}if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return this._trnMainService.TrnMainObj.CNDN_MODE=5,this.spinnerService.show("Saving data..."),void this.masterService.saveAssetsTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),this.alertService.success(i.result),this._trnMainService.TrnMainObj.AssetsProdList=[],this.onReset(),this._trnMainService.TrnMainObj.CNDN_MODE=5)},i=>{this.spinnerService.hide()});this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{if("ok"==i.status){this._trnMainService.prodCheckSubject.next(!0);let n=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=n.CompanyInfo.PhiscalID,this.voucherno=i.savedvchrno?i.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj?.AdditionalObj?.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableCalculateButton=!0,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.disableOnCreditSelect=!1,this._trnMainService.callPipe=!this._trnMainService.callPipe,this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.requisitionFromNotification=!1,this._trnMainService.authGrantedForCreditSales=!1,this._trnMainService.buttonMode="",this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID="",0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.productHelperSerivce.clearBarcodeGrid(),this.onReset(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),null==this._trnMainService.TrnMainObj.ProdList)return void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn||"quotation"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&confirm("Do you want to print bill ?")&&this.onPrintClicked(),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=i.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=i.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(s=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=s.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=s.BILLUNITS}),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==i.status&&this.alertService.info(i.result.error)},i=>{this.alertService.info(i)})}}mergeProdAndAdditionProdList(){console.log("AdditionalProdList",this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.ITEMDESC==n.ITEMDESC&&(i.RealQty+=n.RealQty,n.BranchWiseDistributionList.forEach(s=>{i.BranchWiseDistributionList.push(s)}))})})}assignRateAndQtyForAllocation(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.TotalDispatch,i.Quantity=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.AMOUNT=0,i.NETAMOUNT=0})}ExcessAndShortageAdjustment(){"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReceive",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.WAREHOUSE=this.userProfile.userWarehouse,i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"excess-goods-return"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReturn"),"shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="central",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"close-requisition-approval"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.Quantity=i.REALQTY_IN=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.ALTQTY_IN=i.ALTERNATEQUANTIY}),"branch-shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="branch",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.RealQty=i.REALQTY_IN,i.AltQty=i.ALTQTY_IN,i.REALQTY_IN=0,i.ALTQTY_IN=0}))}assignQtyInReqApp(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.AltQty=i.Quantity=i.RealQty,i.AMOUNT=0,i.NETAMOUNT=0})}mergeBranchList(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BranchWiseDistributionList=[],i.BranchWiseDistributionList=i.BranchWiseDistributionList.concat(i.BranchWiseDistributionList1,i.BranchWiseDistributionList2)})}saveStockSettlement(){this.spinnerService.show("Saving data Please wait a moment..."),this.masterService.saveStockSettlement(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{if("ok"==i.status){this.spinnerService.hide();let n=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=n.CompanyInfo.PhiscalID,this.voucherno=i.savedvchrno?i.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableAllFieldinSales=!1,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.loadFromRequisitionLog=0,0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.onReset(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),null==this._trnMainService.TrnMainObj.ProdList)return console.log("message error!!!"),void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),"inventory-allocation"===this.activeurlpath&&this.onSaveINVAllocation.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||"quotation"==this.activeurlpath)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,console.log("showprint"),this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&(console.log("after purchase save"),confirm("Do you want to print bill ?")&&this.onPrintClicked()),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=i.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=i.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(s=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=s.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=s.BILLUNITS}),57==this._trnMainService.TrnMainObj.VoucherType&&(this.menudata=this.TrnMainObj.ProdList),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==i.status&&(this.spinnerService.hide(),this.alertService.info(i.result.error))},i=>{this.spinnerService.hide(),this.alertService.info(i)})}excelDownloadFromHtml_manualTable(){try{this.reportData=this.menudata;let W='<table style="border: thin solid black;">  <thead>   <tr>';for(let te of this.reportHeaders)W+='<th style="border: thin solid black;">'+te+"</th>";W+="</tr> </thead>",W+="<tbody>";for(let te of this.reportData){W+="<tr>";for(let oe of this.reportBody){var i=te[oe];null==i&&(i=""),W+='<td style="border: thin solid black;">'+i+"</td>"}}W+="</tbody></table>";var s=new Blob([W],{type:"application/vnd.ms-excel"}),p=URL.createObjectURL(s),b=document.createElement("a");b.href=p,b.download=this.excelReportNameProvide()+".xls",document.body.appendChild(b),b.click(),document.body.removeChild(b)}catch(W){alert(W)}}excelReportNameProvide(){return"Proforma - "+this.TrnMainObj.BILLTO}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeRejectedQtyFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>this._trnMainService.nullToZeroConverter(i.APPROVEDALTQTY)>0)}removeInvalidRowsFromConsumptionprod(){this._trnMainService.TrnMainObj.ConsumptionProdList=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeInvaldRowsFromAdditionProd(){this._trnMainService.TrnMainObj.AdditionProdList=this._trnMainService.TrnMainObj.AdditionProdList.filter(i=>{})}nullToZeroConverter(i){return null==i||null==i||""==i?0:parseFloat(i)}viewVoucerForAssets(i){if("EDIT"===this._trnMainService.buttonMode){const n=this.masterService.checkAssetDepreciation(i.VCHRNO).pipe((0,ee.K)(s=>(0,Oe.of)("blocked-becauseOfAssetDepreciation")),(0,de.b)(s=>"blocked-becauseOfAssetDepreciation"===s?(0,Oe.of)("blocked-becauseOfAssetDepreciation"):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).pipe((0,de.b)(p=>(0,q.s)(()=>"ok"===p.status,(0,Oe.of)("ok"),(0,Oe.of)("blocked-becauseOfReverseEntry")))))).subscribe(s=>{"blocked-becauseOfAssetDepreciation"!==s?"blocked-becauseOfReverseEntry"!==s?this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID):this.alertService.info("Cannot edit because reverse entry of this voucher is already done"):this.alertService.info("Depreciation cancellation is required for edit command.")});this.subscriptions.push(n)}else this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID)}onItemDoubleClick(i){if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return void this.viewVoucerForAssets(i);let n=this.masterService.userProfile.userRights.find(s=>"L_EDIT"==s.right);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&1==i.POST&&"VIEW"==this._trnMainService.buttonMode&&0==n?.value&&(this._trnMainService.disableReverseEntryForLatePost=!0),this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"EDIT"!=this._trnMainService.buttonMode||0==i.POST||0!=n?.value){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&("GR"==i.REFORDBILL?.substring(0,2)||"PO"==i.REFORDBILL?.substring(0,2))||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived&&"PO"==i.REFORDBILL?.substring(0,2)&&1==this.userSetting.ENABLE_GRN_IN_PI&&"EDIT"==this._trnMainService.buttonMode?(this._trnMainService.disableAccountInputField=!0,this._trnMainService.disablePaymentTerms=!0):(this._trnMainService.disableAccountInputField=!1,this._trnMainService.disablePaymentTerms=!1),"StockSettlementEntry"!=this.activeurlpath&&null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length>0){let s=this._trnMainService.TrnMainObj.ProdList[0];if(null!=s&&null!=s.MCODE)return confirm("You are about to load the bill.Do you want to continue?")?void this.loadVoucher(i):void 0}this.loadVoucher(i)}else this.alertService.info(`Voucher Approval for ${i.VCHRNO} is already done!. You are not authorized to edit this voucher.`)}onPerformaDoubleClick(i){this.loadVoucher(i)}onRecurringDoubleClick(i){this.onReset(),this.loadingService.show("Getting Details, Please Wait..."),this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=i.VATNO,this._trnMainService.TrnMainObj.REFBILL=i.ENTRYNO,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNACName=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this.getProdListData(i),this._trnMainService.getAllUnitsOfItem(0),this.focusAfterSelectItem(),this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}getProdListData(i){let n=this._trnMainService.TrnMainObj.ProdList[0];n.PTYPE=i.PTYPE,n.ECSRATE=i.ECSRATE,n.HASECSCHARGE=i.HASECSCHARGE,n.HASECSRATE=i?.HASECSRATE,n.NATURETYPE=i.NATURETYPE,n.ENABLEITEMWISEBATCH=i.ENABLEITEMWISEBATCH,n.ITEMDESC=i.DESCA,n.ALTRATE=i.RATE,n.RATE=i.RATE,n.BASERATE=i.RATE,n.MENUCODE=i.MENUCODE,n.MCODE=i.PARENT_MCODE,n.PRATE=i.PRATE,n.HASVARIANT=i.HASVARIANT,n.ISRECURRING=i.ISRECURRING,n.ISVAT=i.ISVAT,n.MRP=i.MRP,n.ALTCONFACTOR=i.CONFACTOR,n.WARRANTY=i.WARRANTY,n.Mcat=i.MCAT,n.UNIT=i.BASEUNIT,n.HASCOMMISSIONCHARGE=i.HASCOMMISSIONCHARGE,n.DISMODE=i.DISMODE,n.WSRATE_DISCOUNT=i.WSRATE_DISCOUNT,n.ROWARN=i.ROWARN,n.MINWARN=i.MINWARN,n.PWEIGHT=i.GWEIGHT,n.ALTERNATEQUANTIY=1,n.Quantity=1}focusAfterSelectItem(){2==this.userSetting.EnableBatch?null!=document.getElementById("batch0")&&setTimeout(()=>{document.getElementById("batch0").focus()},20):null!=document.getElementById("alternateunit0")&&setTimeout(()=>{document.getElementById("alternateunit0").focus()},20)}onLoadFromPerformaInvoice(){this.onLoadFromPerformaInvoiceClickEmit.emit(!0)}onLoadFromDeliveryChalan(){this._trnMainService.TrnMainObj.TRNAC?this.deliverySelectPopup.show():this.alertService.info("Please select account first!")}onMultiItemSelected(i){let n=[];i.forEach(s=>{n.push(s.VCHRNO)}),i.every(s=>s.TRNAC===i[0].TRNAC)&&(this._trnMainService.TrnMainObj.TRNAC=i[0].TRNAC,this._trnMainService.TrnMainObj.BILLTO=i[0].BILLTO,this._trnMainService.TrnMainObj.BILLTOADD=i[0].BILLTOADD,this._trnMainService.TrnMainObj.BILLTOTEL=i[0].VATNO),this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.DELIVERYREF=n.join(","),this.multiselectGenericGrid.hide(),1==this.userSetting.EnablePartialDCInTI?this.deliveryChalanEmit.emit(n):this._trnMainService.getDeliveryChalanProdDetails(n)}getChalanList(){this.multiselectPopupSettings=this.masterService.getGenericGridPopUpSettings("DeliveryInTI",this._trnMainService.TrnMainObj.TRNAC)}onShowImport(){this.onShowFileUploadPopupEmit.emit(!0)}onImportPurchaseInvoice(){this.onFileUploadPopupEmit.emit(!0)}onShowImportSO(){this.onFileUploadPopupEmit.emit(!0)}getExpList(){this.gridPopupSettingsForExpList={title:"Expired Order List",apiEndpoints:"/getExpiredOrderVouchersList",defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"VCHRNO",title:"SONO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]}}onShowExpiredSO(i){this.getExpList(),this.genericGridExpList.show()}onListSelected(i){i&&(this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this.masterService.getExpiredOrderVouchersProdList(i.VCHRNO).subscribe(n=>{n&&(this._trnMainService.TrnMainObj.ProdList=n)}))}loadVoucher(i){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DeliveryChalan||10!=i.STATUS||"EDIT"!==this._trnMainService.buttonMode){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI){if(1==i.STATUS&&"EDIT"===this._trnMainService.buttonMode)return void this.alertService.info("Cannot edit this voucher!");(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI||"goods-received-note-import"==this.activeurlpath)&&"EDIT"===this._trnMainService.buttonMode?(this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.enableRefreshRateInSO=!0),this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result&&"PARTIAL-EXISTED"!=n.result?this._trnMainService.TrnMainObj.VoucherType!==S.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.PurchaseOrder&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.RequisitionEntry||10!=i.STATUS?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i.VCHRNO}).subscribe(s=>{"FORCECLOSED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("This Voucher is force closed, cannot edit")}):this.alertService.info("Transaction already exist under selected voucher no")})):(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.enableRefreshRateInSO=!1)}else this._trnMainService.TrnMainObj.VoucherType!==S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DeliveryChalan||"EDIT"!==this._trnMainService.buttonMode?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).subscribe(n=>{"ok"==n.status?(0,q.s)(()=>this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote,(0,Y.P)(()=>this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO})),(0,Oe.of)("dummy")).subscribe(s=>{"EXISTED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("Transfer out has been done with reference to this voucher. Cannot edit.")}):this.alertService.info(n.result.error)},n=>{this.alertService.info(n)});"VIEW"==this._trnMainService.buttonMode&&(this.TermsButtonTag="VIEW T&C")}else this.alertService.info(this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan?`Voucher No. ${i.VCHRNO} is Already Reversed/Billed. Cannot Edit!`:"Cannot edit this voucher!")}onNewClick(){confirm("Are you sure to Reset the transaction? ")&&(this._trnMainService.prodCheckSubject.next(!0),this._trnMainService.buttonMode="",this.masterService.disableQtyInStockIssueReturn=!1,this._trnMainService.saveButton=!1,this._trnMainService.disableConsumption=!1,this._trnMainService.itemselectevent=!1,this._trnMainService.currentIndexProductDetails=[],this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.barCodes={},this._trnMainService.barCodes.Quantity=1,this._trnMainService.disableNepaliDate=!0,this._trnMainService.enableRefreshRateInSO=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.viewModeForStockSettle=!1,this._trnMainService.disableCalculateButton=!0,this._trnMainService.disableOnCreditSelect=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.disableAccountInputField=!1,this._trnMainService.requisitionFromNotification=!1,this._trnMainService.disableCustomerInputField=!1,this._trnMainService.discountSelectionEdit=!1,this._trnMainService.isRatePartial=!1,this._trnMainService.deliveryWarehouse=this._trnMainService.TrnMainObj.MWAREHOUSE,this._trnMainService.disableNepaliDate=(24===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&("add-sales-invoice"!=this.activeurlpath&&"add-sales-invoice-wholesale"!=this.activeurlpath&&"abbreviated-sales-invoice"!=this.activeurlpath&&"add-creditnote-itembase"!=this.activeurlpath||1!=this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry),"canceladdsientry"==this.activeurlpath&&(this.viewClicked=!1),this._trnMainService.urlpath=this.arouter.snapshot.url[0].path,this._trnMainService.TrnMainObj.VoucherType===S.Km.ReversePurchase&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.Purchase),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseCreditNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.CreditNote),this._trnMainService.TrnMainObj.VoucherType===S.Km.CancelProforma&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.PerformaSalesInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryChalan&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryChalan),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseTaxInvoice&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseProductionEntry&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.ProductionEntry),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryReturn&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryReturn),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDebitNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DebitNote),this._trnMainService.onFlatDiscountClear(),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableOnGRNload=!1,this._trnMainService.disableCostCenterForCargo=!1,this._trnMainService.disablePaymentTerms=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),this.userSetting.enableCostCenter>0&&1==this.userSetting.EnableCostCenterWiseAccounting&&("add-creditnote-itembase"==this.activeurlpath||"add-sales-invoice"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.COSTCENTER=this._trnMainService.accountWiseCostCenter),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation=""),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_QUOTATTION_INSO)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),"self-billing"==this.activeurlpath&&this.onclickOnResetPopupEmit.emit(),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),this._trnMainService.hideProductDescriptionPopUp=!1,this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),14==this._trnMainService.TrnMainObj.VoucherType&&"export-sales-invoice"!=this.activeurlpath&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.TRNMODE=1==this.userSetting.GblEnableMixedTenderMode?"cash":"credit","B2C"==this.userSetting.CompanyType.toUpperCase()&&1==this.userSetting.GblEnableMixedTenderMode&&"cash"==this._trnMainService.TrnMainObj.TRNMODE.toLowerCase()&&this.setCashProperty(),this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput")),(this.TrnMainObj.VoucherType===S.Km.TaxInvoice||this.TrnMainObj.VoucherType===S.Km.Sales||this.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1),(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesReturn)&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),90===this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.IsBBSM&&(this._trnMainService.TrnMainObj.filterByInReqApproval="requisition",this._trnMainService.TrnMainObj.MWAREHOUSE=""),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1==this.userSetting.REFBILLCOMPULSORINDNOTE?1:0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this.masterService.ShowMore=!0,(0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("invoiceNO")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this.masterService.ShowMore=!0,0!=this.userSetting.ENABLE_QUOTATTION_INSO&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("stockissueFromWH")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,0!=this.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&(this.masterService.ShowMore=!0,setTimeout(()=>{1==this.userSetting.GblEnableMixedTenderMode?document.getElementById("itemDesc0").focus():document.getElementById("paymentTerms").focus()},200)),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath,"self-billing"==this.activeurlpath&&(this._trnMainService.TrnMainObj.TRNMODE="credit"),this.clearQtyRate(),this.TermConditionPopup.clearTermsAndCondition(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME&&"cash"==this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()&&(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&1==this.userSetting.enabledistributedpurchase&&(this._trnMainService.TrnMainObj.COSTCENTER=this.userProfile.costCenter))}onReset(){this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.enableRefreshRateInSO=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.showModesForCC=!0,this._trnMainService.showCertainModes=!0,this._trnMainService.disableAccountInputField=!1,this._trnMainService.fromRequistionToTransferOut=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this.masterService.ShowMore=!0,this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput"),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"IMPOR_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_GRN_IN_PI)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),"goods-received-note"===this.activeurlpath&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),("goods-received-note-import"===this.activeurlpath||"purchase-import"===this.activeurlpath)&&0!=this.userSetting.IMPORTPOBILLMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),90===this._trnMainService.TrnMainObj.VoucherType&&0==this.userSetting.IsBBSM&&(this._trnMainService.TrnMainObj.filterByInReqApproval="requisition"),(this.TrnMainObj.VoucherType===S.Km.TaxInvoice||this.TrnMainObj.VoucherType===S.Km.Sales||this.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1)}onRefershRateClicked(){let i;i=this._trnMainService.TrnMainObj.ProdList.filter(n=>null!=n.MCODE).map(n=>n.MCODE),this.loadingService.show("Refreshing.Please Wait..."),this.masterService.getMultipleItemPriceInSO(i).subscribe(n=>{if("ok"==n.status){for(let s=0;s<n.result.length;s++)console.log("index here",s),this._trnMainService.TrnMainObj.ProdList[s].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[s].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A):(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A*this._trnMainService.TrnMainObj.ProdList[s].ALTCONFACTOR);this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}})}okClicked(i){this._trnMainService.TrnMainObj.TenderList=i;let n=this._trnMainService.TrnMainObj.TenderList[0];null!=n?(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this.transactionValidator()&&(this.onSubmit(),this.genericTender.hide())):this.alertService.info("Tender Amount not detected")}approvePerformInvoice(){this.masterService.approvePerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully approved")},n=>{this.alertService.info(n)})}rejectPerformInvoice(){this.masterService.rejectPerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully rejected")},n=>{this.alertService.info(n)})}okAddNewClicked(i){let n=i;n.PRICELEVEL=i.GEO,n.TYPE="A",n.PARENT="PA",n.PType="C",n.COMPANYID=this._trnMainService.userProfile.CompanyInfo.COMPANYID}onRecallClick(){this.genericGridHoldBill.show()}onHoldClick(){null!=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.BATCH)[0]?this.masterService.masterPostmethod("/saveholdbill",this.HoldBillPreparationForSave()).subscribe(i=>{"ok"==i.status&&this._trnMainService.initialFormLoad(S.Km.TaxInvoice)},i=>{alert(i)}):this.alertService.info("No Valid Products entries Detect...")}HoldBillPreparationForSave(){let i={},n=[];for(let s of this._trnMainService.TrnMainObj.ProdList)null!=s.MCODE&&null!=s.BATCH&&n.push({MCODE:s.MCODE,UNIT:s.ALTUNIT,Quantity:s.Quantity,BATCH:s.BATCH,BC:s.BC,REMARKS:s.REMARKS,INVDISRATE:s.INDDISCOUNTRATE,INVDISAMOUNT:s.INDDISCOUNT,CONFACTOR:s.CONFACTOR});return i={PARAC:this._trnMainService.TrnMainObj.PARAC,REMARKS:this._trnMainService.TrnMainObj.REMARKS,DATE:this._trnMainService.TrnMainObj.TRNDATE,NETAMNT:this._trnMainService.TrnMainObj.NETAMNT,FLATDISRATE:this._trnMainService.TrnMainObj.DCRATE,FLATDISAMOUNT:this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT,INVOICETYPE:"retailinvoice",PAYMENTSTATUS:"Hold",holdBillProdList:n,SNO:this._trnMainService.TrnMainObj.HOLDBILLID},i}onHoldBillDoubleClick(i){this.loadingService.show("Recalling Bill.Please Wait..."),this.masterService.masterPostmethod("/recallholdbill",i).subscribe(n=>{"ok"==n.status?(this._trnMainService.initialFormLoad(S.Km.TaxInvoice),this.convertingRecallBillToMainBill(JSON.parse(n.result)),this._trnMainService.TrnMainObj.HOLDBILLID=i.SNO,this.loadingService.hide()):(this.loadingService.hide(),this.alertService.info(n.result._body))},n=>{alert(n)})}convertingRecallBillToMainBill(i){this._trnMainService.TrnMainObj.TRNAC=this._trnMainService.TrnMainObj.PARAC=i.PARAC,null!=i.customer&&(this._trnMainService.TrnMainObj.BILLTO=i.customer.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.customer.ADDRESS,this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=i.customer.PSTYPE,this._trnMainService.TrnMainObj.TRNMODE=i.customer.PMODE,this._trnMainService.TrnMainObj.PARTY_ORG_TYPE=i.customer.ORG_TYPE),this._trnMainService.TrnMainObj.REMARKS=i.REMARKS,this._trnMainService.TrnMainObj.INVOICETYPE=i.INVOICETYPE,this._trnMainService.TrnMainObj.DiscRate=this._trnMainService.nullToZeroConverter(i.FLATDISRATE),this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this._trnMainService.nullToZeroConverter(i.FLATDISAMOUNT),this._trnMainService.TrnMainObj.ProdList=[];let n=0;for(let p of i.holdBillProdList)if(null!=p.MCODE&&null!=p.BATCH){var s={};s.MCODE=p.MCODE,s.SELECTEDITEM=p.SELECTEDITEM,s.BC=p.BC,s.ISVAT=p.SELECTEDITEM.ISVAT,s.MENUCODE=p.SELECTEDITEM.MENUCODE,s.ITEMDESC=p.SELECTEDITEM.DESCA,s.MCODE=p.SELECTEDITEM.MCODE,s.GSTRATE_ONLYFORSHOWING=p.SELECTEDITEM.GST,s.GSTRATE=p.SELECTEDITEM.GST,s.WEIGHT=p.SELECTEDITEM.GWEIGHT,s.Mcat=p.SELECTEDITEM.MCAT,s.MRP=p.SELECTEDBATCH.MRP,s.BATCH=p.BATCH,s.MFGDATE=null==p.SELECTEDBATCH.MFGDATE?"":p.SELECTEDBATCH.MFGDATE.toString().substring(0,10),s.EXPDATE=null==p.SELECTEDBATCH.EXPIRY?"":p.SELECTEDBATCH.EXPIRY.toString().substring(0,10),s.UNIT=p.SELECTEDBATCH.UNIT,s.STOCK=p.SELECTEDBATCH.STOCK,s.WAREHOUSE=p.SELECTEDBATCH.WAREHOUSE,s.BATCHSCHEME=p.SELECTEDBATCH.SCHEMENAME,s.Quantity=this._trnMainService.nullToZeroConverter(p.Quantity),s.INDDISCOUNTRATE=this._trnMainService.nullToZeroConverter(p.INVDISRATE),s.INDDISCOUNT=this._trnMainService.nullToZeroConverter(p.INVDISAMOUNT),s.inputMode=!1,s.Product={},s.Product.MCODE=p.MCODE,s.Product.AlternateUnits=p.ALTUNITLIST,s.ALTUNITObj=s.Product.AlternateUnits.filter(b=>b.ALTUNIT==p.UNIT)[0],this._trnMainService.TrnMainObj.ProdList.push(s),this._trnMainService.AssignSellingPriceAndDiscounts(p.PClist,n),this._trnMainService.RealQuantitySet(n,p.CONFACTOR),n++}this._trnMainService.ReCalculateBillWithNormal()}onTransportClick(){this.Transport.show()}handleKeyDownboardEvent(i){if(0==this.PaymentPopup.isActive)if("ControlLeft"==i.code||"ControlRight"==i.code)i.preventDefault(),this.showSecondaryButtons=!this.showSecondaryButtons;else if("F3"==i.code)i.preventDefault(),this.onNewClick();else if("F12"==i.code)i.preventDefault(),this.showItemSearchPopup();else if("End"==i.code)i.preventDefault(),"VIEW"!=this._trnMainService.TrnMainObj.Mode&&!this.masterService.customerpopup&&!this._trnMainService.showPerformaApproveReject&&!this._trnMainService.showDiscountAuth&&this.onSaveClicked();else if("F4"==i.code)i.preventDefault(),!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&this.onViewClicked();else if("F7"==i.code){i.preventDefault();let n=this._trnMainService.TrnMainObj.VoucherType;!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&!(n in S.$V)&&7!=n&&5!=n&&10!==this._trnMainService.TrnMainObj.VoucherType&&(this.onViewClicked(),this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)")}else"F8"==i.code?(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||57==this._trnMainService.TrnMainObj.VoucherType||83==this._trnMainService.TrnMainObj.VoucherType||21==this._trnMainService.TrnMainObj.VoucherType||3==this._trnMainService.TrnMainObj.VoucherType||16==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType||61==this._trnMainService.TrnMainObj.VoucherType||5==this._trnMainService.TrnMainObj.VoucherType)&&this.onPrintClicked()):"F2"==i.code?(i.preventDefault(),(3==this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType&&"NEW"==this._trnMainService.TrnMainObj.Mode||19==this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||89===this._trnMainService.TrnMainObj.VoucherType||88===this._trnMainService.TrnMainObj.VoucherType&&0===this.userSetting.LinkProductionwithconsumption||15===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&this.onImportPurchaseInvoice()):"F11"==i.code&&(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==this._trnMainService.TrnMainObj.Mode&&1==this.userSetting.GblEnableMixedTenderMode&&this.showBillTender())}showItemSearchPopup(){this.itemSearchPopup.show()}cancelprint(){this.promptPrintDevice=!1,this.showPosPrinterPreview=!1}onSchemeClick(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(s=>null!=s.MCODE&&""!=s.MCODE);let i=[];if(this._trnMainService.TrnMainObj.ProdList.length>0){for(var n of this._trnMainService.TrnMainObj.ProdList)i.push({mcode:n.MCODE,qty:n.Quantity,retailer:this._trnMainService.TrnMainObj.PARAC,rate:n.RATE});this.masterService.masterPostmethod("/dmsScheme/searchscheme",{data:i}).subscribe(s=>{if("ok"==s.status)if(null==s.result)this.alertService.info("No Scheme Found ...");else{for(let p of s.result)p.ischecked=!0;this._trnMainService.availableSchemes=s.result,(null!=this._trnMainService.availableSchemes||this._trnMainService.availableSchemes?.length>0)&&(this.schemeFilterList=this._trnMainService.availableSchemes.filter((p,b,W)=>W.findIndex(te=>te.schemeno===p.schemeno)===b)),this.showschemePopup=!0}else this.alertService.info("Error on getting scheme.Error Details:"+s.result)})}else this.alertService.warning("No Valid product entered for scheme"),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)}OkSchemeCommand(){if(null==this._trnMainService.availableSchemes||this._trnMainService.availableSchemes)return;this.showschemePopup=!1;let i=[];for(var n in this.schemeFilterList.filter(p=>p.ischecked)){this._trnMainService.availableSchemes[n].SchemeAmount=this._trnMainService.availableSchemes[n].discountamount;for(let p in this._trnMainService.TrnMainObj.ProdList)if(this._trnMainService.TrnMainObj.ProdList[p].MCODE==this._trnMainService.availableSchemes[n].mcode){var s=this._trnMainService.availableSchemes.filter(b=>b.schemeno==this._trnMainService.availableSchemes[n].schemeno).length;if(s<1)return;this._trnMainService.TrnMainObj.ProdList[p].BaseSecondaryDiscount=this._trnMainService.availableSchemes[n].discountamount/s,i.push(this._trnMainService.availableSchemes[n])}}this._trnMainService.TrnMainObj.DmsSchemesApplied=i,this._trnMainService.ReCalculateBillWithNormal()}CancelSchemeCommand(){this.showschemePopup=!1}markAsReadNotifications(){this.notificationService.markAsReadAfterSave().subscribe(i=>{"ok"==i.status&&(this._trnMainService.fromNotification=!1)})}newSalesman(){confirm("Are you sure to choose new salesman?")&&this.onClickSalesMan.emit()}onCustomerSelected(i){this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""==i.PMODE?"credit":i.PMODE,this.masterService.focusAnyControl("unit")}createCustomer(){this.router.navigate(["./pages/masters/PartyLedger/CustomerList"])}onCancelClick(){if(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoiceCancel,this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.VoucherAbbName="SC",this._trnMainService.TrnMainObj.guid=_(),this.viewClicked)this.alertService.info("cannot save in View Mode.");else{if(this._trnMainService.TrnMainObj.ProdList.filter(n=>{}).length>0)return void this.alertService.info("Product list is empty");this.onSaveClicked()}}onLoadClick(){this._trnMainService.TrnMainObj.Mode="NEW",this.genericGridForTaxCancel.show(),this.viewClicked=!1}onViewTaxCancel(){this.TrnMainObj.VoucherPrefix="SC",this.gridPopupSettings=this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix)}onClickReverseSave(){this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE="REVERSE",this.onSaveTransactionClicked()}saveSalesReturnDamageValueToTMP(){this.spinnerService.show("Data is Saving..."),this.masterService.saveDamageSalesReturnToTMP(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))})}saveTransactionApproval(){this.spinnerService.show("Data is Saving..."),this.masterService.saveApprovalTmptoActual(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}saveApproveStockTransfer(){this.spinnerService.show("Data is Saving..."),this.masterService.SaveApprovedStockTransfer(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this._trnMainService.pageHeading="Stock Transfer Approval",this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}onDeleteClick(){confirm("Permanently delete this Voucher. Do you want to continue?")&&(this.editClicked=!1,this.viewClicked=!1,this.onclickDeleteYes())}onclickDeleteYes(){this._trnMainService.TrnMainObj.Mode="New",this._trnMainService.TrnMainObj.VoucherType=73,this._trnMainService.TrnMainObj.VoucherPrefix="CP",this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.VCHRNO;const i=E(67816);this._trnMainService.TrnMainObj.guid=i(),this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(s=>{"ok"==s.status&&(this.alertService.success("Deleted Succesfully"),this._trnMainService.initialFormLoad(this.TrnMainObj.VoucherType),this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP")},s=>{})}onDeleteTransactionClick(){this.checkUserRights("delete")&&1==this.userSetting.EnableAmdinSB&&this.deleteTransaction()}deleteTransaction(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(i=>{if("EXISTED"!=i.result){this.spinnerService.show("Please Wait..");let n={};n.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,n.DIVISION=this._trnMainService.TrnMainObj.DIVISION,n.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:n,mode:this._trnMainService.buttonMode}).subscribe(p=>{"ok"==p.status?(this.spinnerService.hide(),this.alertService.info(p.result),this.onReset()):(this.alertService.info(p.result),this.spinnerService.hide())},p=>{this.spinnerService.hide()})}else this.alertService.info("Transaction exist under selected voucher no")});else{this.spinnerService.show("Please Wait..");let i={};i.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,i.DIVISION=this._trnMainService.TrnMainObj.DIVISION,i.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:i,mode:this._trnMainService.buttonMode}).subscribe(s=>{"ok"==s.status?(this.spinnerService.hide(),this.alertService.info(s.result),this.onReset()):(this.alertService.info(s.result),this.spinnerService.hide())},s=>{this.spinnerService.hide()})}}onProformaEditClick(){this.masterService.headerMode="(EDIT)",this._trnMainService.TrnMainObj.Mode="EDIT",this.editClicked=!0,this.viewClicked=!1,this.genericGrid.show()}assigngMode(){this.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice&&("(VIEW)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="VIEW"),"(EDIT)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="EDIT"))}pdfDesingerPrintFormat(i,n,s,p,b){(null==b||null==b)&&(b="FULL");let W=i.substring(0,2);"purchase-import"==this.activeurlpath&&(W="IMPORTPURCHASE"),"export-sales-invoice"==this.activeurlpath&&(W="EXPORTSI"),"asset-purchase-invoice"==this.activeurlpath&&(W="ASSETPURCHASE"),"assets-openingstockentry"==this.activeurlpath&&(W="ASSETOPENING");let te=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,oe=te?.split("");this.masterService.getPrintFileName(W,this.userProfile.CompanyInfo.COMPANYID,b).subscribe(ae=>{if("ok"==ae.status){this.filename=ae.result?ae.result[0].FileName:"",this.rownumber=ae.result?ae.result[0].RowsNumber:0;let se=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL;this.masterService.getNumberToWords(i,se,n,this.userProfile.CompanyInfo.COMPANYID).subscribe(Le=>{if("ok"==Le.status){this.numtowords=Le.result?Le.result[0].NUMTOWORDS:"";let Pe=this.userProfile.CompanyInfo.ADDRESS,ye=this.userProfile.CompanyInfo.NAME,xe=this.userProfile.CompanyInfo.TELA,ce=this.userProfile.CompanyInfo.TELB,le=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(se).subscribe(ue=>{if("ok"==ue.status){ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].COMADD&&(Pe=ue.result[0].COMADD),(null==Pe||""===Pe)&&(Pe=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].COMNAME&&(ye=ue.result[0].COMNAME),(null==ye||""===ye)&&(ye=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].TELA&&(xe=ue.result[0].TELA),(null==xe||""===xe)&&(xe=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].TELB&&(ce=ue.result[0].TELB),(null==ce||""===ce)&&(ce=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].EMAIL&&(le=ue.result[0].EMAIL),(null==le||""===le)&&(le=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let ct,he={};he.filename=this.filename,he.rownumber=this.rownumber,he.VCHRNO=i,he.NAME=ye||this.userProfile.CompanyInfo.NAME,he.ADDRESS=Pe||" ",he.INITIAL=se||this.userProfile.CompanyInfo.INITIAL,he.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,he.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,he.phone1=xe||" ",he.phone2=ce||" ",he.EMAIL=le||" ",he.numtowords=this.numtowords?this.numtowords:" ",he.panno1=oe[0]?oe[0]:" ",he.panno2=oe[1]?oe[1]:" ",he.panno3=oe[2]?oe[2]:" ",he.panno4=oe[3]?oe[3]:" ",he.panno5=oe[4]?oe[4]:" ",he.panno6=oe[5]?oe[5]:" ",he.panno7=oe[6]?oe[6]:" ",he.panno8=oe[7]?oe[7]:" ",he.panno9=oe[8]?oe[8]:" ",he.title=s||" ",he.caption=p||" ",he.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,he.PRINTBY=this.userProfile.username?this.userProfile.username:" ",he.COMPANYVAT=te||this.userProfile.CompanyInfo.VAT,this.masterService.getAllInvoiceData(he).subscribe(je=>{ct=new Blob([je],{type:"application/pdf"});const vr=URL.createObjectURL(ct),Wi=document.createElement("iframe");Wi.style.display="none",Wi.src=vr,document.body.appendChild(Wi),Wi.contentWindow.print()},je=>{console.log("error",je,JSON.parse(this.blobToString(je.error)));let vr=JSON.parse(this.blobToString(je.error));this.alertService.error(vr.result)}),2==this.userSetting.SendInvoiceEmail&&(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales)&&"NEW"==this.modeForPrint&&(he.title="Invoice",he.caption="Copy of Original (1)",this.masterService.TaxinvoiceEmail(he,this._trnMainService.CUSEMAIL).subscribe(je=>{console.log("result after print",je)}))}})}})}})}blobToString(i){const n=URL.createObjectURL(i);let s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(),URL.revokeObjectURL(n),s.responseText}cancel(){try{this.router.navigate([this.returnUrl])}catch(i){console.log(i),this.alertService.info(i)}}onImportDetailsClick(){this.ImportPurchaseDetail.show(),this.masterService.allowAddNextRow=!0}onExportClick(){this.spinnerService.show("Downloading file, Please wait..."),this.masterService.getExcelFileForBA().subscribe(s=>{this.spinnerService.hide();let p=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});k.saveAs(p,"Negative Stock Report.xlsx")},s=>{this.spinnerService.hide()})}clearQtyRate(){this._trnMainService.purchaseOrderQty=null,this._trnMainService.purchaseOrderRate=null,this._trnMainService.produstWiseOrderUnit=null}pdfDesingerPrintFormatForTransferIn(i,n,s,p,b){(null==b||null==b)&&(b="FULL");let te=(1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT).split("");this.masterService.getPrintFileName(this._trnMainService.TrnMainObj.VoucherPrefix,this.userProfile.CompanyInfo.COMPANYID,b).subscribe(oe=>{if("ok"==oe.status){this.filename=oe.result?oe.result[0].FileName:"",this.rownumber=oe.result?oe.result[0].RowsNumber:0,this.numtowords="";let ae=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,se=this.userProfile.CompanyInfo.ADDRESS,Le=this.userProfile.CompanyInfo.NAME,Pe=this.userProfile.CompanyInfo.TELA,ye=this.userProfile.CompanyInfo.TELB,xe=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(ae).subscribe(ce=>{if("ok"==ce.status){ce.result&&ce.result.length>0&&ce.result[0]&&ce.result[0].COMADD&&(se=ce.result[0].COMADD),(null==se||""===se)&&(se=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),ce.result&&ce.result.length>0&&ce.result[0]&&ce.result[0].COMNAME&&(Le=ce.result[0].COMNAME),(null==Le||""===Le)&&(Le=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),ce.result&&ce.result.length>0&&ce.result[0]&&ce.result[0].TELA&&(Pe=ce.result[0].TELA),(null==Pe||""===Pe)&&(Pe=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),ce.result&&ce.result.length>0&&ce.result[0]&&ce.result[0].TELB&&(ye=ce.result[0].TELB),(null==ye||""===ye)&&(ye=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),ce.result&&ce.result.length>0&&ce.result[0]&&ce.result[0].EMAIL&&(xe=ce.result[0].EMAIL),(null==xe||""===xe)&&(xe=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let ue,le={};le.filename=this.filename,le.rownumber=this.rownumber,le.VCHRNO=i,le.NAME=Le||this.userProfile.CompanyInfo.NAME,le.ADDRESS=se||" ",le.INITIAL=ae||this.userProfile.CompanyInfo.INITIAL,le.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,le.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,le.phone1=Pe||" ",le.phone2=ye||" ",le.EMAIL=xe||" ",le.numtowords=this.numtowords?this.numtowords:" ",le.panno1=te[0]?te[0]:" ",le.panno2=te[1]?te[1]:" ",le.panno3=te[2]?te[2]:" ",le.panno4=te[3]?te[3]:" ",le.panno5=te[4]?te[4]:" ",le.panno6=te[5]?te[5]:" ",le.panno7=te[6]?te[6]:" ",le.panno8=te[7]?te[7]:" ",le.panno9=te[8]?te[8]:" ",le.title=s||" ",le.caption=p||" ",le.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,le.PRINTBY=this.userProfile.username?this.userProfile.username:" ",this.masterService.getAllInvoiceData(le).subscribe(he=>{ue=new Blob([he],{type:"application/pdf"});const ct=URL.createObjectURL(ue),je=document.createElement("iframe");je.style.display="none",je.src=ct,document.body.appendChild(je),je.contentWindow.print()},he=>{let ct=JSON.parse(this.blobToString(he.error));this.alertService.error(ct.result)})}})}})}onReverseEntry(){let i=this.masterService.userProfile.userRights.find(n=>"AllowReverseEntry"==n.right);0!=i?.value?1==i?.value&&(this._trnMainService.reverseEntry(this.TrnMainObj.VoucherType),(0,q.s)(()=>"asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath,this.masterService.checkAssetDepreciation(this._trnMainService.TrnMainObj.VCHRNO),(0,Oe.of)("notAssets")).pipe((0,ee.K)(()=>{throw"checkAssetDepreciation"}),(0,be.w)(n=>this.masterService.checkDuplicateReverseEntry(this._trnMainService.TrnMainObj.VCHRNO).pipe((0,ee.K)(s=>(0,Oe.of)(s))))).subscribe(n=>{"ok"==n.status?this.showReverseEntryAuth=!0:this.alertService.info(n.result.error)},n=>{this.alertService.info("checkAssetDepreciation"===n?"Depreciation cancellation is required for reverse entry command.":n)})):this.alertService.info("No rights for Reverse Entry!!!")}openReverseEntry(){this.reverseEntryConfirm.show(this._trnMainService.TrnMainObj.VCHRNO)}closeReverseEntryAuthPopup(){this.showReverseEntryAuth=!1}reverseEntryAuthConfirm(){this.spinnerService.show("Authorizing Please wait..."),this.masterService.reverseEntryAutorisation(this.reverseEntryAuthObj).subscribe(i=>{this.spinnerService.hide(),"ok"==i.status&&(this.alertService.success("Authorization Sucessfull"),this.closeReverseEntryAuthPopup(),this.openReverseEntry())}),this.spinnerService.hide()}forRequisition(){this.addForRequisition=!0,this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this._trnMainService.TrnMainObj.DOFULLRETURN=1}forStockAdjustment(){this.StockAdjustment.show()}carreiedOnPreviousFiscalYearOpening(i){this.spinnerService.show("Opening stock is saving please wait.."),this.masterService.saveFiscalYear(i,0).subscribe(n=>{"ok"==n.status?(console.log("RESULT",n),this.alertService.success("Year Data Saved Successfully"),this.authService.showfiscalPopup=!1,this.spinnerService.hide()):(this.spinnerService.hide(),console.log("data",n),this.alertService.info("Error in Saving Data:"+n.result.error))},n=>{this.alertService.info(n)})}closeReqModal(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}fromTransferOut(){let i="";i=this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder?this._trnMainService.TrnMainObj.AdditionalObj.REFORDID:this._trnMainService.TrnMainObj.BILLTO;let n=`/getTransferOutPagedList/${i}/${this._trnMainService.TrnMainObj.VoucherPrefix}`;this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(n=`/getRequisitionListForStockIssue/${i}`),this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&(n=`/getTransferOutForRequisionPagedList/${i}`),this.genericGridTransferOutSetting={title:"Requisition List",apiEndpoints:n,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Requisition From",hidden:5==this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1},{key:"BILLTO",title:"From Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"BILLTOADD",title:"To Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1}]},this.genericGridTransferOut.show(),this._trnMainService.fromRequistionToTransferOut=!1}dblClickLoadTransferOutData(i){this._trnMainService.fromRequistionToTransferOut=!0,(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,1===this._trnMainService.TrnMainObj.DOFULLRETURN?(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&this.loadFullRequesitoninTo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder&&this.loadFullRequesitoninPo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadFullRequisitioninIS(i),this.closeReqModal()):(this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadPartialRequisitioninIS(i),this.closeReqModal())),this.loadPartialRequisitionVoucher(i)}loadPartialRequisitionVoucher(i){0===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&(this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.addRow(),this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.BILLTOADD=i.BILLTO)}loadFullRequesitoninTo(i){this._trnMainService.loadFullRequesitoninTo(i,!1)}loadFullRequesitoninPo(i){let n=this._trnMainService.TrnMainObj.MWAREHOUSE;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForPurchaseOrder(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMTO").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=E(67816);this._trnMainService.TrnMainObj=s.result,this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=19,this._trnMainService.TrnMainObj.VoucherPrefix="PO",this._trnMainService.TrnMainObj.VoucherAbbName="PO",this._trnMainService.TrnMainObj.COMPANYID=this.masterService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.DIVISION=this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.masterService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const b of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(b.ALTCONFACTOR)&&(b.ALTCONFACTOR=1),b.BASEUNIT===b.ALTUNIT&&(b.RATE=b.ALTRATE);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD="",this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=n}},s=>{this.loadingService.hide(),this.alertService.info(s._body)})}loadFullRequisitioninIS(i){let n=i.BILLTOADD;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMIS").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=E(67816);this._trnMainService.TrnMainObj=s.result;let b=this._trnMainService.TrnMainObj.BILLTOADD,W=this._trnMainService.TrnMainObj.BILLTO;this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.PhiscalYearInfo.PhiscalID,this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.userProfile.userWarehouse,this._trnMainService.callPipe=!this._trnMainService.callPipe,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const te of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(te.ALTCONFACTOR)&&(te.ALTCONFACTOR=1),te.BASEUNIT===te.ALTUNIT&&(te.RATE=te.ALTRATE),te.MFGDATE=null==te.MFGDATE?"":te.MFGDATE.toString().substring(0,10),te.EXPDATE=null==te.EXPDATE?"":te.EXPDATE.toString().substring(0,10);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD=W,this._trnMainService.TrnMainObj.BILLTO=b,this._trnMainService.TrnMainObj.MWAREHOUSE=n;for(const te of this._trnMainService.TrnMainObj.ProdList)te.rowMode="VIEW"}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}loadPartialRequisitioninIS(i){let n=i.BILLTOADD;this.loadingService.show("Loading requisition details. Please wait!"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMIS").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const p=E(67816);let b=s.result.BILLTOADD,W=s.result.BILLTO;this._trnMainService.TrnMainObj.guid=p(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.BILLTOADD=W,this._trnMainService.TrnMainObj.BILLTO=b,this._trnMainService.TrnMainObj.MWAREHOUSE=n,this._trnMainService.callPipe=!this._trnMainService.callPipe}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}saveRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this.addForRequisition=!1}resetRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}getPopUpSettingForApproval(){return{title:"Vouchers",apiEndpoints:`/getApprovedPagedListForView/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onChangePurchasePrice(i,n){const s=this._trnMainService.TrnMainObj.ProdList[this.activeindex],p=this._trnMainService.priceChangeList[i],b=0===this.userSetting.VatExcludingRate?p.NRATE_A:p.EX_NRATE_A,W=0===this.userSetting.VatExcludingRate?p.WNRATE_A:p.EX_NRATE_A;if(!p)return;const te=s.NETRATE?s.NETRATE:s.RATE,ae=this.calculateRecommendedMarginRate(s,te);console.log("margin2",b,p,ae,te),b<=ae&&(console.log("margin1",p,ae),this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),this.userSetting.ENABLEWSALESRATEBILLING&&void 0!==W&&""!==W&&W<=ae&&(console.log("margin1",p,ae),this.rateValidationDisplayMessage="NEW WHOLESALE SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),this.focusOnNextInput(),this.updateSellingPrices(i),this.actualMarginCalculation(i),this.updateProdListWithUserInput(i,s,p),this.masterService.is_PurchaseOrder&&this.updatePODetailList(i)}calculateRecommendedMarginRate(i,n){let s=n*(i.RECRATE/100);return 0==this.userSetting.VatExcludingRate?s=(s+n)*this.userSetting.VatConRate:s+=n,i.RECRATE?s:n}applyVAT(i,n){return 0===this.userSetting.VatExcludingRate&&1===n.ISVAT?i*(1+this.userSetting.VATRate):i}focusOnNextInput(){setTimeout(()=>{(document.getElementById("newWholeSellingPrice0")||document.getElementById("apply"))?.focus()},0)}updateSellingPrices(i){this.changeSellingPrice(i),this.actualMarginCalculation(i)}updateProdListWithUserInput(i,n,s){const p=this.getUserInputRate(s),b=this.getUserInputRate(s,!0),W=this.userSetting.VatConRate||1;n.SELLRATEBEFORETAX=1==n.ISVAT&&0==this.userSetting.VatExcludingRate?p/W:p,n.W_SELLRATEBEFORETAX=1==n.ISVAT&&0==this.userSetting.VatExcludingRate?b/W:b,n.MRP=0===this.userSetting.VatExcludingRate?p:p*W,n.W_MRP=0===this.userSetting.VatExcludingRate?b:b*W}getUserInputRate(i,n=!1){return this.userSetting.VatExcludingRate?n?i.EX_WNRATE_A:i.EX_NRATE_A:n?i.WNRATE_A:i.NRATE_A}updatePODetailList(i){this._trnMainService.TrnMainObj.PODetailList[i].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[i].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].WNRATE_A}changeSellingPrice(i){const n=1===this.userSetting.VatExcludingRate?"EX_NRATE_A":"NRATE_A",s=1===this.userSetting.VatExcludingRate?"EX_WNRATE_A":"WNRATE_A";for(const p of this._trnMainService.priceChangeList)p.SNO>1&&(p[n]=p.CONFACTOR*this._trnMainService.priceChangeList[i][n],p[s]=p.CONFACTOR*this._trnMainService.priceChangeList[i][s])}onApplyOldPriceClick(){!this.validateUpdatedSellingRate(!0)||(this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginRetial=0,this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginWholeSale=0,this.showPriceChangeDetail=!1)}actualMarginCalculation(i){const n=this._trnMainService.TrnMainObj.ProdList[this.activeindex],b=(0,this._trnMainService.nullToZeroConverter)(n.NETRATE)||n.RATE,W=this._trnMainService.priceChangeList[0],te=this.getUserRate(W,"NRATE_A"),oe=this.getUserRate(W,"WNRATE_A"),ae=this.userSetting.VatConRate||1;n.ActualmarginRetial=this.calculateMargin(te,b,ae,n.ISVAT),this.userSetting.ENABLEWSALESRATEBILLING&&(n.ActualmarginWholeSale=this.calculateMargin(oe,b,ae,n.ISVAT)),n.ActualmarginRetial=this.isInvalidMargin(n.ActualmarginRetial,te)?0:n.ActualmarginRetial,n.ActualmarginWholeSale=this.isInvalidMargin(n.ActualmarginWholeSale,oe)?0:n.ActualmarginWholeSale}getUserRate(i,n){return this._trnMainService.nullToZeroConverter(i[this.userSetting.VatExcludingRate?`EX_${n}`:n])}calculateMargin(i,n,s,p){return 100*((this.userSetting.VatExcludingRate||0===p?i:i/s)-n)/n}isInvalidMargin(i,n){return-100===i||0===n}validateUpdatedSellingRate(i){for(let n of this._trnMainService.priceChangeList)if(!this.masterService.is_PurchaseOrder){const s=this._trnMainService.TrnMainObj.ProdList[this.activeindex],p=this.getProductRate(s.NETRATE,s.RATE),b=this.calculatePurchaseRate(p,s.ISVAT);return i?this.validateOldPrice(b):this.validateNewPrice(b)}}getProductRate(i,n){const s=this._trnMainService.nullToZeroConverter(i);return 0===s?n:s}calculatePurchaseRate(i,n){return 0===this.userSetting.VatExcludingRate&&1===n?i+i*this.userSetting.VATRate:i}validateOldPrice(i){const n=this._trnMainService.priceChangeList[0];if(1===this.userSetting.EnableBatchWisePrice){const s=this._trnMainService.priceChangeList.find(p=>0===this._trnMainService.nullToZeroConverter(p.CRATE_A));if(s)return this.alertService.warning(`Selling price for this item with UOM: ${s.UNIT} cannot be 0, Please enter valid selling rate`),!1}return!this.checkPriceAboveCost(i,n)&&(this.updatePriceConversionRates(n),this.markSellingPriceChangedIfNeeded(),!0)}checkPriceAboveCost(i,n){return i>n.CRATE_A?(this.alertService.warning("Cost price for this item cannot be more than Sales price"),!0):1===this.userSetting.ENABLEWSALESRATEBILLING&&i>n.WSRATE_A&&(this.alertService.warning("New Cost price for this item cannot be more than Old Wholesale Sales price"),!0)}updatePriceConversionRates(i){i.CRATE_A&&(i.NRATE_A=i.CRATE_A,i.EX_NRATE_A=this.convertToExclusiveRate(i.CRATE_A)),i.WSRATE_A&&(i.WNRATE_A=i.WSRATE_A,i.EX_WNRATE_A=this.convertToExclusiveRate(i.WSRATE_A)),this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}convertToExclusiveRate(i){return this._trnMainService.nullToZeroConverter(i/(this.userSetting.VatConRate||1))}validateNewPrice(i){const n=this._trnMainService.priceChangeList[0],s=this.getExclusiveOrRegularRate(n.NRATE_A,n.EX_NRATE_A),p=this.getExclusiveOrRegularRate(n.WNRATE_A,n.EX_WNRATE_A);if(this.checkNewSaleRateBelowCost(s,i,"NEW SELLING PRICE")||this.userSetting.ENABLEWSALESRATEBILLING&&null!=p&&this.checkNewSaleRateBelowCost(p,i,"NEW WHOLESALE PRICE")||!this.validateSellingRates(n))return!1;for(let b of this._trnMainService.priceChangeList)if(!this.masterService.is_PurchaseOrder){const W=this._trnMainService.TrnMainObj.ProdList[this.activeindex].Product.AltSellingPrices.find(te=>te.UNIT===b.UNIT);W&&(W.NRATE_A=b.NRATE_A)}return this.markSellingPriceChangedIfNeeded(),!0}getExclusiveOrRegularRate(i,n){return this._trnMainService.nullToZeroConverter(this.userSetting.VatExcludingRate?n:i)}checkNewSaleRateBelowCost(i,n,s){return i<=n&&(this.alertService.error(`${s} ${i} IS BELOW OR EQUAL TO NEW PURCHASE PRICE ${n}`),!0)}validateSellingRates(i){if(this.userSetting.VatExcludingRate){if(!i.EX_NRATE_A)return this.alertService.warning("Invalid selling rate"),!1;if(this.userSetting.ENABLEWSALESRATEBILLING&&!i.EX_WNRATE_A)return this.alertService.warning("Invalid Wholesale selling rate"),!1;this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}else{const n=this.findInvalidUOM();if(n)return this.alertService.warning(`Invalid new selling price for this item with UOM: ${n.UNIT}, Please enter valid selling rate`),!1}return!0}findInvalidUOM(){return this._trnMainService.priceChangeList.find(1===this.userSetting.EnableBatchWisePrice?i=>0===this._trnMainService.nullToZeroConverter(i.NRATE_A):i=>!i.NRATE_A)}markSellingPriceChangedIfNeeded(){this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0}checkExpiry(){let i=this._trnMainService.TrnMainObj.ProdList.filter(p=>new Date(p.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=p.MCODE&&1==p.REQEXPDATE)[0],n=this.TrnMainObj.ProdList.filter(p=>1==p.REQEXPDATE&&0==this.nullToZeroConverter(p.EXPDATE))[0];return null!=n?(this.alertService.info(`EXP date missing on item with compulsory Expiry:${n.ITEMDESC}`),!1):null==i||null==i||!this._trnMainService.TrnMainObj.ProdList.some(p=>6!==p.PTYPE)||(this.alertService.info("Expired Item Detected : "+i.ITEMDESC+"..Please Review the list..."),!1)}onApplyClickNewPrice(){!this.validateUpdatedSellingRate(!1)||(this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginRetial=0,this._trnMainService.TrnMainObj.ProdList[this.activeindex].ActualmarginWholeSale=0,this.showPriceChangeDetail=!1)}onCloseClick(){this.showPriceChangeDetail=!1}onClickYes(){this.rateValidation.hide()}onClickNo(){this.rateValidation.hide()}onLoadFromReverseEntry(){this.onLoadFromReverseEntryEmit.emit(!0)}viewRecurringDetails(){this.recurringLogMode="view",this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this._trnMainService.TrnMainObj.RecurringItemList.length>0&&(this.recurringItemsForEdit=this._trnMainService.TrnMainObj.RecurringItemList),this._trnMainService.TrnMainObj.CommissionItemList.length>0&&(this.commissionItemsForEdit=this._trnMainService.TrnMainObj.CommissionItemList),(this.recurringItemsForEdit.length>0||this.commissionItemsForEdit.length>0)&&this.RecurringLog.show("view")}carryForwardPreviousFiscalYearVoucher(){confirm("Previous Fiscal Year Opening Stock is already carried on, Do you want Re-Carried on Opening Stock?")&&(console.log("popup ya lyaune"),this.PrevYearOpening.show())}paymentClick(){this.doAutoRoundingInSales(),this.PaymentPopup.show(),this.PaymentPopup.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT?this._trnMainService.TrnMainObj.NETAMNT:0}onSavePayment(i){if(i?.length){let n=i.filter(s=>"CREDIT"==s.TRNMODE?.toUpperCase())[0];if(n&&(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=n.REMARKS,this._trnMainService.TrnMainObj.PARAC=n.ACCOUNT,this._trnMainService.TrnMainObj.BILLTO=n.REMARKS,this.masterService.getCustomerIDFromCProfile(i[0].ACCOUNT).subscribe(s=>{s.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=s[0].CUSTID)})),i?.length>1){this._trnMainService.TrnMainObj.TRNMODE="mixed";let s=i.filter(b=>"Cash"==b.TRNMODE)[0],p=i.filter(b=>"Credit Card"==b.TRNMODE)[0];s?(this._trnMainService.TrnMainObj.TRNAC=s.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=s.REMARKS):p&&(this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS)}else 1==i.length&&(this._trnMainService.TrnMainObj.TRNMODE=i[0].modevalue,this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS,"Cash"==i[0].TRNMODE?14!=this._trnMainService.TrnMainObj.VoucherType&&1!=this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC?this.masterService.userSetting.CASHINHAND_AC:null,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C"):this._trnMainService.TrnMainObj.TRNMODE=i[0].modevalue);this._trnMainService.TrnMainObj.TenderList=i,this.onSaveTransactionClicked()}}onSaveTermsnConditions(i){this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID=i}onSaveRecurringLog(i){this._trnMainService.TrnMainObj.RecurringItemList=i.recurringItemList,this._trnMainService.TrnMainObj.CommissionItemList=i.commissionItemList,this.transactionValidator()&&this.onSubmit()}forceCloseClick(){let i;i=this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.VCHRNO,this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result?this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i}).subscribe(s=>{"FORCECLOSED"!=s.result?this.showForceClose=!0:this.alertService.info("This Voucher is already closed")}):this.alertService.info(`Transaction already exist under selected voucher: ${this._trnMainService.TrnMainObj.VCHRNO} . Cannot Force Close !`)})}forceCloseSubmit(){if(""!==this.forceCloseObj.REMARKS&&null!=this.forceCloseObj.REMARKS){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.RequisitionApproval){if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.warning("Invoice no. for force close confirmation should match with loaded voucher no.")}else if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.REFORDBILL)return void this.alertService.warning("Invoice no. for rejection confirmation should match with loaded requistion no.");this.loadingService.show(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Rejecting the Requisition No."+this.forceCloseObj.VCHRNO:"Force Closing Purchase Order No."+this.forceCloseObj.VCHRNO),this.masterService.masterPostmethod("/saveForceClosedVoucher",this.forceCloseObj).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.showForceClose=!1,this.forceCloseObj={},this.onReset(),this.alertService.success(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Requisition rejected sucessfully.":i.result)):(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}else this.alertService.warning("Please enter remarks !")}closeForceClose(){this.showForceClose=!1}showBillTender(){this.showTenderList=!0}showInfoPopup(){"VIEW"!=this._trnMainService.TrnMainObj.Mode&&this.itemInfo.show()}OpenBOMListPopup(){this.productHelperSerivce.showBOMListPopupFn(!0)}closeTenderList(){this.showTenderList=!1}checkSalesRateBeforeCrate(){return this.filterList=[],this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(1==i.ISVAT?(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE<i.PRATE||0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE/this.userSetting.VatConRate<i.PRATE)&&this.filterList.push(i):i.ALTRATE<i.PRATE&&this.filterList.push(i)),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&i.RATE<i.PRATE&&this.filterList.push(i)}),!(this.filterList?.length>0&&(confirm("The sales rate for items are less than its cost rate. Ask for authorization?")&&this.authenticationPopup.show(this.filterList,"prateCheck"),1))}checkSODiscountLimit(){let i=this.masterService.userProfile.userRights.find(s=>"SODiscountLimit"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm("The discount applied to items exceed the discount limit. Ask for authorization?")&&this.authenticationPopup.show(n,"discountCheck"),1))}checkGblDiscountLimit(){let i=this.masterService.userProfile.roleRights.find(s=>"DISLIMIT"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm(`The discount applied to items exceed the discount limit: ${i?.value}%. Ask for authorization?`)&&this.authenticationPopup.show(n,"GblDiscountCheck"),1))}checkExpItem(){let i=[];return i=this._trnMainService.TrnMainObj.ProdList.filter(n=>new Date(n.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=n.MCODE&&1==n.REQEXPDATE),!(i&&i.length>0&&(confirm("Expiry Items detected. Do you want continue with transaction ?")&&this.authenticationPopup.show(i,"showExpItemList"),1))}onUserRightReceived(i){if("ALLOW"==i){if(!this.checkSODiscountLimit()||!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to do sales below Cost rate of respective items");this.authenticationPopup.closeDialog()}onCreditLimitReceived(i){if("ALLOW"==i){if(this._trnMainService.TrnMainObj.isAuthorized=!0,!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to save Bill exceeding the credit limit of the selected Credit Account");this.authenticationPopup.closeDialog()}allowExpiredItemforSave(i){if(console.log("save garda ya aaucha ta",i),"ALLOWSAVE"==i){if(!this.transactionValidator())return;this.onSubmit()}this.authenticationPopup.closeDialog()}onDiscountLimitReceived(i){if(this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)}),this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+i+"%)");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}onRoleRightsReceived(i){let s=JSON.parse(i).find(b=>"DISLIMIT"==b.right);if(this._trnMainService.TrnMainObj.ProdList.filter(b=>b.INDDISCOUNTRATE>s.value).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+s.value+")");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}stockAdjustmentLoaded(i){this._trnMainService.TrnMainObj.TRNDATE=i.Date;var n=E(10484),s=i.Date.replace("-","/").replace("-","/"),p=n.ad2bs(s);this._trnMainService.TrnMainObj.BSDATE=("1"==p.en.day||"2"==p.en.day||"3"==p.en.day||"4"==p.en.day||"5"==p.en.day||"6"==p.en.day||"7"==p.en.day||"8"==p.en.day||"9"==p.en.day?"0"+p.en.day:p.en.day)+"/"+("1"==p.en.month||"2"==p.en.month||"3"==p.en.month||"4"==p.en.month||"5"==p.en.month||"6"==p.en.month||"7"==p.en.month||"8"==p.en.month||"9"==p.en.month?"0"+p.en.month:p.en.month)+"/"+p.en.year}OnBatchAdjustmentClick(){this._trnMainService.BatchAdjustment().subscribe(i=>{"ok"==i.status?this.AutoAdjustment.showDialog(i.result):this.alertService.warning("Negatice Stock list not found")})}checkForUserRigths(i){if(i)return this.masterService.userProfile.userRights.find(n=>n.right==i)}checkCreditLimitRights(){let i=this.checkForUserRigths("AuthorizeCreditLimit");return i&&1==i?.value?!!confirm(`Credit Limit has Exceeded for the selected customer.. Credit Limit : ${this._trnMainService.TrnMainObj.CREDITLIMIT}, Credit Amount : ${this._trnMainService.TrnMainObj.BLAMOUNT} and bill amount : ${this._trnMainService.TrnMainObj.NETAMNT}. Save anyway ? `):(confirm("Credit limit is Exceed. Ask For Authorization?")&&this.authenticationPopup.show(this.filterList,"AuthorizeCreditLimitCheck"),!1)}onItemDoubleClickForOpening(i){this.spinnerService.show("Getting data, please wait..."),this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","VIEW").subscribe(n=>{n&&(this.spinnerService.hide(),this.OpeningFromPreviousYear.show(n.result.ProdList,"noLargeDataEntryEdit"))})}onItemDoubleClickForLargeDataEntry(i){this.spinnerService.show("Getting data, please wait...");const n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.TRNDATE;this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","EDIT").subscribe({next:p=>{if(console.log(p),"ok"===p.status){this.spinnerService.hide();const{guid:b}=p.result;this.OpeningFromPreviousYear.show(p.result.ProdList,"largeDataEntryEdit",b)}else this._trnMainService.TrnMainObj.VCHRNO=n,this._trnMainService.TrnMainObj.TRNDATE=s,this.spinnerService.hide(),this.alertService.info(p.result.error)}})}validateBeforeSave(){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return!1;if("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)return!(this._trnMainService.TrnMainObj?.AssetsProdList[0]?.MCODE&&this._trnMainService.TrnMainObj.NETAMNT);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.BatchAdjustment)return!1;if(this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(null==this._trnMainService.TrnMainObj.ProdList[0]?.MCODE&&null==this._trnMainService.TrnMainObj.AdditionProdList[0]?.TRNAC||null==this._trnMainService.TrnMainObj.NETAMNT))return!0;if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.DebitNote||"NONTRADING"!=this._trnMainService.TrnMainObj.INVOICETYPE){if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.DebitNote&&null==this._trnMainService.TrnMainObj.ProdList[0]?.MCODE||null==this._trnMainService.TrnMainObj.NETAMNT)return!0}else if(this._trnMainService.TrnMainObj?.AdditionProdList&&null==this._trnMainService.TrnMainObj?.AdditionProdList[0].TRNAC)return!0;return!1}onSaveImageCaptured(i){i?(this._trnMainService.TrnMainObj.UserSignature=i,this.onSaveTransactionClicked()):this.alertService.error("Error on Digital Signature!")}setCashProperty(){this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME?(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME,this._trnMainService.disableAccountInputField=!0):this.masterService.userSetting.CASHINHAND_AC?(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C"):(alert("'Default Cash' on database not found. Please Contact to Administrator for this!"),this._trnMainService.TrnMainObj.TRNACName="error...")}onViewSignatureClicked(){this.digitalSignUpload.show(this._trnMainService.TrnMainObj.UserSignature,this._trnMainService.TrnMainObj.Mode)}onPrintVoucher(){let n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.DIVISION,p=this._trnMainService.TrnMainObj.PhiscalID,b=this._trnMainService.TrnMainObj.TRNUSER,W=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,te=this._trnMainService.TrnMainObj.PhiscalID,oe=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,ae=oe.split(""),se={filename:"",rownumber:""};se.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,se.NAME=this.userProfile.CompanyInfo.NAME,se.ADDRESS=this.userProfile.CompanyInfo.ADDRESS,se.INITIAL=W||this.userProfile.CompanyInfo.INITIAL,se.PhiscalID=te||this.userProfile.CompanyInfo.PhiscalID,se.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,se.phone1=this.userProfile.CompanyInfo.TELA,se.phone2=this.userProfile.CompanyInfo.TELB,se.EMAIL=this.userProfile.CompanyInfo.EMAIL,se.numtowords="",se.panno1=ae[0]?ae[0]:" ",se.panno2=ae[1]?ae[1]:" ",se.panno3=ae[2]?ae[2]:" ",se.panno4=ae[3]?ae[3]:" ",se.panno5=ae[4]?ae[4]:" ",se.panno6=ae[5]?ae[5]:" ",se.panno7=ae[6]?ae[6]:" ",se.panno8=ae[7]?ae[7]:" ",se.panno9=ae[8]?ae[8]:" ",se.title=" ",se.caption=this.caption?this.caption:" ",se.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,se.PRINTBY=this.userProfile.username?this.userProfile.username:" ",se.COMPANYVAT=oe||this.userProfile.CompanyInfo.VAT,this.PrintHelperService.printVoucher(n,s,p,b,se,"PIVOUCHER")}onImageClick(){this.genericimageupload.show("TaxInvoice",this._trnMainService.TrnMainObj.VCHRNO)}}return T.\u0275fac=function(i){return new(i||T)(e.Y36(N.p),e.Y36(Ee.R),e.Y36(Ne.uw),e.Y36(Re.F0),e.Y36(Re.gz),e.Y36($.c),e.Y36(Z.V),e.Y36(we.e),e.Y36(Z.V),e.Y36(C.C),e.Y36(Ke.g),e.Y36(lt),e.Y36(bt.R),e.Y36(f.P),e.Y36(Ct.i),e.Y36(it.h),e.Y36(At))},T.\u0275cmp=e.Xpm({type:T,selectors:[["voucher-master-action"]],viewQuery:function(i,n){if(1&i&&(e.Gf(mn,5),e.Gf(Sn,5),e.Gf(vn,5),e.Gf(gn,5),e.Gf(fn,5),e.Gf(On,5),e.Gf(bn,5),e.Gf(Cn,5),e.Gf(An,5),e.Gf(En,5),e.Gf(In,5),e.Gf(Pn,5),e.Gf(yn,5),e.Gf(xn,5),e.Gf(Rn,5),e.Gf(Nn,5),e.Gf(Ln,5),e.Gf(wn,5),e.Gf(Dn,5),e.Gf(jn,5),e.Gf(Qi,5),e.Gf(kn,5),e.Gf(Vn,5),e.Gf(Un,5),e.Gf(Bn,5),e.Gf(Kn,5),e.Gf(Zn,5),e.Gf(Fn,5),e.Gf(Hn,5),e.Gf(Qn,5),e.Gf(Gn,5),e.Gf(Yn,5),e.Gf(Jn,5),e.Gf(qn,5),e.Gf(Wn,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.digitalSignUpload=s.first),e.iGM(s=e.CRH())&&(n.genericGrid=s.first),e.iGM(s=e.CRH())&&(n.genericimageupload=s.first),e.iGM(s=e.CRH())&&(n.genericTender=s.first),e.iGM(s=e.CRH())&&(n.genericGridHoldBill=s.first),e.iGM(s=e.CRH())&&(n.Transport=s.first),e.iGM(s=e.CRH())&&(n.genericGridIntend=s.first),e.iGM(s=e.CRH())&&(n.printSetupModal=s.first),e.iGM(s=e.CRH())&&(n.genericGridReverseView=s.first),e.iGM(s=e.CRH())&&(n.genericGridPerformaView=s.first),e.iGM(s=e.CRH())&&(n.genericGridForRecurring=s.first),e.iGM(s=e.CRH())&&(n.genericGridforPreviousOpening=s.first),e.iGM(s=e.CRH())&&(n.deliverySelectPopup=s.first),e.iGM(s=e.CRH())&&(n.requisitionSelectPopup=s.first),e.iGM(s=e.CRH())&&(n.genericGridExpList=s.first),e.iGM(s=e.CRH())&&(n.genericGridForTaxCancel=s.first),e.iGM(s=e.CRH())&&(n.ImportPurchaseDetail=s.first),e.iGM(s=e.CRH())&&(n.reverseEntryConfirm=s.first),e.iGM(s=e.CRH())&&(n.authenticationPopup=s.first),e.iGM(s=e.CRH())&&(n.itemInfo=s.first),e.iGM(s=e.CRH())&&(n.itemSearchPopup=s.first),e.iGM(s=e.CRH())&&(n.genericGridForLargeDataEntry=s.first),e.iGM(s=e.CRH())&&(n.genericGridTransferOut=s.first),e.iGM(s=e.CRH())&&(n.rateValidation=s.first),e.iGM(s=e.CRH())&&(n.PaymentPopup=s.first),e.iGM(s=e.CRH())&&(n.RecurringLog=s.first),e.iGM(s=e.CRH())&&(n.StockAdjustment=s.first),e.iGM(s=e.CRH())&&(n.CreateCustomerPopup=s.first),e.iGM(s=e.CRH())&&(n.AutoAdjustment=s.first),e.iGM(s=e.CRH())&&(n.OpeningFromPreviousYear=s.first),e.iGM(s=e.CRH())&&(n.TermConditionPopup=s.first),e.iGM(s=e.CRH())&&(n.PrevYearOpening=s.first),e.iGM(s=e.CRH())&&(n.MemberPointConfirmationPopup=s.first),e.iGM(s=e.CRH())&&(n.BillPreviewPopup=s.first),e.iGM(s=e.CRH())&&(n.multiselectGenericGrid=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(p){return n.handleKeyDownboardEvent(p)},!1,e.evT)},inputs:{isSales:"isSales",buttonShow:"buttonShow",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit",deliveryChalanEmit:"deliveryChalanEmit",onViewClickEmit:"onViewClickEmit",onLoadFromSOClickEmit:"onLoadFromSOClickEmit",onLoadFromPOClickEmit:"onLoadFromPOClickEmit",onLoadFromHOPerformaInvoiceClickEmit:"onLoadFromHOPerformaInvoiceClickEmit",onLoadFromPerformaInvoiceClickEmit:"onLoadFromPerformaInvoiceClickEmit",onLoadFromReverseEntryEmit:"onLoadFromReverseEntryEmit",onLoadFromHoTaxInvoiceClickEmit:"onLoadFromHoTaxInvoiceClickEmit",onLoadFromSAPFTPClickEmit:"onLoadFromSAPFTPClickEmit",onShowFileUploadPopupEmit:"onShowFileUploadPopupEmit",onLoadFromStockSettlementApproval:"onLoadFromStockSettlementApproval",onSettlementStockApprove:"onSettlementStockApprove",onApproveStockSettlementList:"onApproveStockSettlementList",onFileUploadPopupEmit:"onFileUploadPopupEmit",onSaveINVAllocation:"onSaveINVAllocation",onSaveSelfBilling:"onSaveSelfBilling",onclickOnResetPopupEmit:"onclickOnResetPopupEmit",onLoadCancelSalesEmit:"onLoadCancelSalesEmit",onAddNewCustomerClickEmit:"onAddNewCustomerClickEmit",onClickCustomer:"onClickCustomer",onClickSalesMan:"onClickSalesMan"},features:[e._Bn([C.C])],decls:133,vars:76,consts:[["class","wp-hdr-login",4,"ngIf"],["class","wp-hdr-login-txt",4,"ngIf"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px","data-toggle","modal",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","voucher","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","data-toggle","modal","style","margin: 0pcx 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal","data-target","#InvoiceNewPrint",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","expiredSO","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-info pull-right",3,"click",4,"ngIf"],["data-toggle","modal","style","margin: 0pcx 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right",3,"click",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["itemSearchPopup",""],["genericGridforPreviousOpening",""],["genericGridForLargeDataEntry",""],["genericGridForRecurring",""],["genericGridReverseView",""],["genericGridPerformaView",""],["genericGridHoldBill",""],[3,"okClicked",4,"ngIf"],[3,"popupsettings"],["genericGridIntend",""],[3,"tranMode"],["ImportPurchaseDetail",""],[3,"onClickReverse"],["reverseEntryConfirm",""],[3,"okClicked"],["PaymentPopup",""],[3,"onUserRightReceived","onDiscountLimitReceived","onRoleRightsReceived","onCreditLimitReceived","allowExpiredItemforSave"],["authenticationPopup",""],[3,"RecurringItems","CommissionItems","RecurringItemsForEdit","CommissionItemsForEdit","mode","recurringlogsaved"],["RecurringLog",""],[3,"itemInfopopupsettings"],["itemInfo",""],[3,"stockAdjustmentLoaded"],["StockAdjustment",""],["AutoAdjustment",""],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 65%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 500px;\n    position: absolute;\n    right: 15%;\n    top: 5px;\n    width: 1100px;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 30vw;\n    width: 30vw;\n    z-index: 9999999;\n  ",4,"ngIf"],[4,"ngIf"],["genericGridTransferOut",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 330px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 140%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],["class","forceClose_container",4,"ngIf"],["OpeningFromPreviousYear",""],["PrevYearOpening",""],["TermConditionPopup",""],["genericGridExpList",""],["MemberPointConfirmationPopup",""],["BillPreviewPopup",""],[3,"onSaveImageCaptured"],["digitalSignUpload",""],[3,"popupsettings","onItemsSelected"],["multiselectGenericGrid",""],["deliverySelectPopup",""],["requisitionSelectPopup",""],["genericimageupload",""],[1,"wp-hdr-login"],[1,"wp-hdr-login-txt"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","voucher","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0pcx 4px",3,"click"],["id","C","data-toggle","modal","data-target","#InvoiceNewPrint",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","C","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","expiredSO","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[4,"ngIf","ngIfElse"],["save",""],["type","button",1,"btn","btn-info","pull-right",3,"click"],[1,"btn-label"],[1,"glyphicon","glyphicon-upload"],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",3,"click"],["genericTender",""],["Transport",""],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","65%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area"],["id","myModalLabel",1,"modal-title"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","printOption","value","0",3,"formControl"],["type","radio","name","printOption","value","1","checked","",3,"formControl"],["printSetupModal",""],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","500px","position","absolute","right","15%","top","5px","width","1100px","z-index","9999999"],[1,"col-md-12",2,"height","350px","overflow-y","auto"],[1,"table",2,"margin-bottom","5px","font-size","12.5px"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","#2dacd1","color","black"],[1,"texttitle",2,"color","black"],[2,"border","1px"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary",2,"margin-top","20px",3,"click"],[2,"width","55px"],["type","checkbox",2,"width","100%",3,"ngModel","ngModelChange"],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","30vw","width","30vw","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-body",2,"height","420px","overflow-y","scroll"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px","margin-right","8rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["class","row",4,"ngIf"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],["style","width: 25%",4,"ngIf"],[2,"width","63%",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"width","25%"],[3,"ngValue"],["type","text","placeholder","Press Enter For Transferred List","autocomplete","off",2,"width","63%",3,"ngModel","ngModelChange","keydown.Enter"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","330px","position","absolute","right","20%","top","5px","width","140%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","3px"],[2,"margin-top","4px","margin-bottom","2px"],[2,"font-size","13px","width","30%"],[2,"height","8rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","17%"],["scope","col","style","width: 18%",4,"ngIf"],["scope","col","style","width: 25%",4,"ngIf"],["scope","col","style","width: 25%;",4,"ngIf"],[1,"col-md-12","row",2,"padding","0px"],[1,"col-md-4"],[1,"col-md-8","row","justify-content-end",2,"text-align","right"],["style","margin-right: 0;\n              font-size: 0.9rem;",4,"ngIf"],["class","d-flex justify-content-end",4,"ngIf"],[1,"form-control-label",2,"font-weight","bold","font-size","14px","width","auto"],[1,"form-control-label",2,"font-size","14px","width","auto"],["scope","col",2,"width","18%"],["scope","col",2,"width","25%"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["style","border: 1px solid #e6e6e6",4,"ngIf"],["appSalesRateDisableFromUserProfile","","type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keyup","keydown.enter","keydown.Tab"],[2,"margin-right","0","font-size","0.9rem"],[1,"d-flex","justify-content-end"],[2,"font-size","0.9rem"],[1,"forceClose_container"],[1,"card"],[1,"card-header"],["style","text-align: center",4,"ngIf"],[2,"position","absolute","right","2%","top","5%"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label",2,"font-weight","bold"],[1,"col-md-7"],["type","text",1,"form-control",2,"height","4vh","font-size","12px",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label",2,"font-weight","bold"],[1,"form-control",2,"width","100%","font-size","12px",3,"ngModel","ngModelChange"],[2,"text-align","center"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","60%","width","51%"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"table","table-striped"],[2,"position","sticky","top","0","line-height","1.5rem","font-size","12px"],["scope","col",2,"width","10%","line-height","14px","white-space","nowrap"],["scope","col",2,"width","10%","text-align","right","line-height","14px","white-space","nowrap"],["scope","col",2,"width","30%","line-height","14px","white-space","nowrap"],[1,"tenderList"],[1,"modal-footer",2,"padding","2px"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","11px","height","25ox",3,"click"],[2,"width","10%"],[2,"width","10%","text-align","right"],[2,"width","30%"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&(e.YNc(0,$n,2,0,"span",0),e.YNc(1,zn,2,1,"span",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return n.cancel()}),e._uU(3," BACK\n"),e.qZA(),e.YNc(4,Xn,2,0,"button",3),e.YNc(5,er,2,0,"button",4),e.YNc(6,tr,2,0,"button",4),e.YNc(7,ir,2,1,"button",5),e.YNc(8,nr,2,0,"button",4),e.YNc(9,rr,2,0,"button",4),e.YNc(10,or,2,1,"button",6),e.YNc(11,sr,2,1,"button",7),e.YNc(12,ar,2,0,"button",8),e.YNc(13,cr,2,0,"button",9),e.YNc(14,lr,2,0,"button",9),e.YNc(15,m,2,0,"button",10),e.YNc(16,D,2,0,"button",10),e.YNc(17,r,2,0,"button",9),e.YNc(18,l,2,0,"button",11),e.YNc(19,c,2,1,"button",12),e.YNc(20,u,2,1,"button",13),e.YNc(21,y,2,1,"button",14),e.YNc(22,K,2,1,"button",15),e.YNc(23,ie,2,0,"button",9),e.YNc(24,Me,2,0,"button",9),e.YNc(25,De,2,0,"button",9),e.YNc(26,Ae,2,0,"button",9),e.YNc(27,Ce,2,0,"button",9),e.YNc(28,hr,2,0,"button",9),e.YNc(29,dr,2,0,"button",9),e.YNc(30,ur,2,0,"button",9),e.YNc(31,pr,2,1,"button",15),e.YNc(32,Gi,4,3,"button",15),e.YNc(33,Se,2,1,"button",9),e.YNc(34,Yi,2,0,"button",9),e.YNc(35,Ji,4,0,"button",16),e.YNc(36,fe,2,0,"button",9),e.YNc(37,qi,2,0,"button",17),e.YNc(38,Qe,2,0,"button",9),e.YNc(39,ji,2,0,"button",9),e.YNc(40,Mr,2,0,"button",9),e.YNc(41,mr,2,0,"button",9),e.YNc(42,Sr,2,0,"button",9),e.YNc(43,ki,2,0,"button",9),e.YNc(44,fr,2,0,"button",18),e.YNc(45,Or,2,0,"button",18),e.YNc(46,br,2,0,"button",18),e.TgZ(47,"generic-popup-grid",19,20),e.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClick(p)}),e.qZA(),e._UZ(49,"app-item-search-popup",null,21),e.TgZ(51,"generic-popup-grid",19,22),e.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClickForOpening(p)}),e.qZA(),e.TgZ(53,"generic-popup-grid",19,23),e.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClickForLargeDataEntry(p)}),e.qZA(),e.TgZ(55,"generic-popup-grid",19,24),e.NdJ("onItemDoubleClick",function(p){return n.onRecurringDoubleClick(p)}),e.qZA(),e.TgZ(57,"generic-popup-grid",19,25),e.NdJ("onItemDoubleClick",function(p){return n.onItemDoubleClick(p)}),e.qZA(),e.TgZ(59,"generic-popup-grid",19,26),e.NdJ("onItemDoubleClick",function(p){return n.onPerformaDoubleClick(p)}),e.qZA(),e.TgZ(61,"generic-popup-grid",19,27),e.NdJ("onItemDoubleClick",function(p){return n.onHoldBillDoubleClick(p)}),e.qZA(),e.YNc(63,Cr,2,0,"generic-popup-Tender",28),e.YNc(64,Ar,2,0,"Transport-Popup",28),e._UZ(65,"generic-popup-grid",29,30)(67,"import-purchase-details",31,32),e.TgZ(69,"reverse-entry-dialog",33,34),e.NdJ("onClickReverse",function(){return n.onClickReverseSave()}),e.qZA(),e.TgZ(71,"payment-popup-dialog",35,36),e.NdJ("okClicked",function(p){return n.onSavePayment(p)}),e.qZA(),e.TgZ(73,"authentication-entry",37,38),e.NdJ("onUserRightReceived",function(p){return n.onUserRightReceived(p)})("onDiscountLimitReceived",function(p){return n.onDiscountLimitReceived(p)})("onRoleRightsReceived",function(p){return n.onRoleRightsReceived(p)})("onCreditLimitReceived",function(p){return n.onCreditLimitReceived(p)})("allowExpiredItemforSave",function(p){return n.allowExpiredItemforSave(p)}),e.qZA(),e.TgZ(75,"recurringlog-popup",39,40),e.NdJ("recurringlogsaved",function(p){return n.onSaveRecurringLog(p)}),e.qZA(),e._UZ(77,"iteminfo-popup",41,42),e.TgZ(79,"stockadjustment-popup",43,44),e.NdJ("stockAdjustmentLoaded",function(p){return n.stockAdjustmentLoaded(p)}),e.qZA(),e._UZ(81,"autoadjustment-popup",null,45),e.YNc(83,Pr,14,2,"div",46),e.YNc(84,xr,53,1,"div",47),e.YNc(85,Rr,13,1,"div",48),e.YNc(86,Vr,18,3,"div",49),e.TgZ(87,"generic-popup-grid",19,50),e.NdJ("onItemDoubleClick",function(p){return n.dblClickLoadTransferOutData(p)}),e.qZA(),e.YNc(89,zr,46,10,"div",51),e.TgZ(90,"div")(91,"div",52,53)(93,"div",54)(94,"div",55)(95,"div",56)(96,"button",57),e.NdJ("click",function(){return n.onClickNo()}),e.TgZ(97,"span",58),e._uU(98,"\xd7"),e.qZA()()(),e.TgZ(99,"div",59)(100,"div",60)(101,"div",61),e._uU(102),e.qZA(),e.TgZ(103,"div",62)(104,"button",63),e.NdJ("click",function(){return n.onClickYes()}),e._uU(105," Yes "),e.qZA(),e.TgZ(106,"button",64),e.NdJ("click",function(){return n.onClickNo()}),e._uU(107," No "),e.qZA()()()()()()()(),e.YNc(108,to,21,5,"div",65),e.YNc(109,no,24,1,"div",49),e.YNc(110,ro,23,2,"div",49),e._UZ(111,"app-opening-from-previous-year",null,66)(113,"previous-year-opening",null,67),e.TgZ(115,"termsncondition-popup-dialog",35,68),e.NdJ("okClicked",function(p){return n.onSaveTermsnConditions(p)}),e.qZA(),e.TgZ(117,"generic-popup-grid",19,69),e.NdJ("onItemDoubleClick",function(p){return n.onListSelected(p)}),e.qZA(),e.TgZ(119,"member-point-confirm-popup",35,70),e.NdJ("okClicked",function(p){return n.confirmationOkClicked(p)}),e.qZA(),e._UZ(121,"preview-bill-popup-dialog",null,71),e.TgZ(123,"digital-signature-popup",72,73),e.NdJ("onSaveImageCaptured",function(p){return n.onSaveImageCaptured(p)}),e.qZA(),e.TgZ(125,"multiselect-generic-grid",74,75),e.NdJ("onItemsSelected",function(p){return n.onMultiItemSelected(p)}),e.qZA(),e._UZ(127,"app-delivery-select-popup",null,76)(129,"app-requisition-select-popup",null,77)(131,"generic-img-upload",null,78)),2&i&&(e.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),e.xp6(3),e.Q6J("ngIf",80==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",19==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf","add-purchase-invoice"==n.activeurlpath&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(19==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",90==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&(null!=n._trnMainService.TrnMainObj.REFORDBILL||null!=n._trnMainService.TrnMainObj.REFORDBILL)),e.xp6(1),e.Q6J("ngIf",(14==n._trnMainService.TrnMainObj.VoucherType||1==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.GblEnableMixedTenderMode&&n.showSecondaryButtons&&"lite"!=n.AppMode),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&(1==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||57==n._trnMainService.TrnMainObj.VoucherType||83==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType||64==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||7==n._trnMainService.TrnMainObj.VoucherType||8==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType||71==n._trnMainService.TrnMainObj.VoucherType||81==n._trnMainService.TrnMainObj.VoucherType||41==n._trnMainService.TrnMainObj.VoucherType||43==n._trnMainService.TrnMainObj.VoucherType||37==n._trnMainService.TrnMainObj.VoucherType||40==n._trnMainService.TrnMainObj.VoucherType)&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&3==n._trnMainService.TrnMainObj.VoucherType&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton),e.xp6(1),e.Q6J("ngIf","StockSettlementEntryApproval"==n.activeurlpath),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(!n._trnMainService.showPerformaApproveReject&&57==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&"retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE),e.xp6(1),e.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&1==n.userSetting.EnableAutoSOExpiry),e.xp6(1),e.Q6J("ngIf",(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.hideButton&&n.showSecondaryButtons&&n.buttonShow),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&"assets-openingstockentry"!=n.activeurlpath&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType&&n.userSetting.IsBBSM)&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",8==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&1==n._trnMainService.userSetting.ENABLESINGLEBATCHMODE),e.xp6(1),e.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf","VIEW"===n._trnMainService.TrnMainObj.Mode&&1===n.userSetting.EnableDigitalSignature&&5===n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&n.hideButton&&"add-membership-sales-invoice"!=n.activeurlpath&&n.buttonShow),e.xp6(1),e.Q6J("ngIf",n.userSetting.IsBBSM?n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton&&80!=n._trnMainService.TrnMainObj.VoucherType&&0==n.userSetting.EnableRQLogInRQEntry:n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf","canceladdsientry"!=n.activeurlpath&&("VIEW"!=n._trnMainService.TrnMainObj.Mode||!n._trnMainService.showPerformaApproveReject)&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&(19===n._trnMainService.TrnMainObj.VoucherType||64===n._trnMainService.TrnMainObj.VoucherType||3===n._trnMainService.TrnMainObj.VoucherType&&1==n.userSetting.PODELIVERYMODE)&&1==n.userSetting.ApplyTermsAndCondition),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton&&14===n._trnMainService.TrnMainObj.VoucherType&&"add-sales-invoice"==n._trnMainService.activeurlpath),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton&&20===n._trnMainService.TrnMainObj.VoucherType&&1==n._trnMainService.enableRefreshRateInSO&&"EDIT"==n._trnMainService.buttonMode),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton&&1==n.userSetting.RECURRING_TRANSACTION),e.xp6(1),e.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&0==n.userSetting.centralizeddbmode&&!n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath&&("export-sales-invoice"!=n.activeurlpath||1==n.userSetting.EnableGRNInPIForCargo)),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&"add-sales-invoice"==n.activeurlpath&&1==n.userSetting.EnableDeliveryChalan),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.EnableRecurringItem&&1==n.userSetting.EnableCommissionCalculation),e.xp6(1),e.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&1===n.userSetting.ENABLE_SALESMAN_ROUTE&&"self-billing"!=n.activeurlpath),e.xp6(1),e.Q6J("ngIf","canceladdsientry"==n.activeurlpath),e.xp6(1),e.Q6J("ngIf",3==n._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE"==(null==n._trnMainService.TrnMainObj||null==n._trnMainService.TrnMainObj.AdditionalObj?null:n._trnMainService.TrnMainObj.AdditionalObj.tag)),e.xp6(1),e.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettings),e.xp6(4),e.Q6J("popupsettings",n.gridPopupSettingForPreviousOpening),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingForLargeEntry),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForRecurring),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForReverse),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForViewPerforma),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForHoldBill),e.xp6(2),e.Q6J("ngIf","retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&14==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&("superdistributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"distributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE)),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForIntend),e.xp6(2),e.Q6J("tranMode",n._trnMainService.TrnMainObj.Mode),e.xp6(8),e.Q6J("RecurringItems",n.recurringItems)("CommissionItems",n.commissionChargeable)("RecurringItemsForEdit",n.recurringItemsForEdit)("CommissionItemsForEdit",n.commissionItemsForEdit)("mode",n.recurringLogMode),e.xp6(2),e.Q6J("itemInfopopupsettings",n.itemInfoPopupSettings),e.xp6(6),e.Q6J("ngIf",n.promptPrintDevice),e.xp6(1),e.Q6J("ngIf",n.showschemePopup),e.xp6(1),e.Q6J("ngIf",n.showPosPrinterPreview),e.xp6(1),e.Q6J("ngIf",n.addForRequisition),e.xp6(1),e.Q6J("popupsettings",n.genericGridTransferOutSetting),e.xp6(2),e.Q6J("ngIf",n.showPriceChangeDetail&&1==n.userSetting.ShowPriceChangePopup),e.xp6(2),e.Q6J("config",e.DdM(75,oo)),e.xp6(11),e.hij(" ",n.rateValidationDisplayMessage," "),e.xp6(6),e.Q6J("ngIf",n.showForceClose),e.xp6(1),e.Q6J("ngIf",n.showTenderList),e.xp6(1),e.Q6J("ngIf",n.showReverseEntryAuth),e.xp6(7),e.Q6J("popupsettings",n.gridPopupSettingsForExpList),e.xp6(8),e.Q6J("popupsettings",n.multiselectPopupSettings))},dependencies:[Et.oB,w.sg,w.O5,g._Y,g.YN,g.Kr,g.Fj,g.wV,g.Wl,g.EJ,g._,g.JJ,g.JL,g.On,g.F,g.oH,Q.Zl,Dt,Kt,qt,$t,Si,Ni,R.m,L,X,Ve,$i,tn,an,ln,un,pn.q,G.ky,_n.b,Tn.n,Mn.O,w.JJ,$e.g],styles:["span[_ngcontent-%COMP%] {\n    font-weight: bold;\n  }\n  .modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 11px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #ced6d3 !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 100%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    \n    white-space: nowrap;\n  }\n\n  .forceClose_container[_ngcontent-%COMP%] {\n    position: fixed !important;\n    transform: translate(-50px, -50px);\n    \n    background: #ffffff;\n    z-index: 99999;\n    width: 57%;\n    top: 29.5%;\n    left: 26%;\n  }\n\n  \n\n  .tenderList[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n    padding: 0rem 0.75rem;\n    font-size: 12px;\n  }"]}),T})()},68527:(pe,ne,E)=>{E.d(ne,{q:()=>$});var t=E(93105),g=E(42326),v=E(66274),q=E(53074),Y=E(87584),S=E(69389),Q=E(67297),C=E(53181),_=E(48083),B=E(92752);function U(Z,N){1&Z&&(v.TgZ(0,"span"),v._uU(1,"Show Detail [F1]"),v.qZA())}function z(Z,N){1&Z&&(v.TgZ(0,"span"),v._uU(1,"Hide Detail [F1]"),v.qZA())}let $=(()=>{class Z{constructor(f,w,P,O,I,L){this.masterService=f,this._trnMainService=w,this.setting=P,this.dialog=I,this.arouter=L,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new t.EventEmitter,this.TrnMainObj=w.TrnMainObj,this.AppSettings=this.setting.appSetting,this.userProfile=O.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.activeurlpath=L.snapshot.url[0].path,this.masterService.refreshTransactionList(),(this.TrnMainObj.VoucherType==g.Km.CreditNote||this.TrnMainObj.VoucherType==g.Km.SalesReturn)&&(this.transactionType="creditnote")}ngOnInit(){this.masterService.ShowMore=!0}ngOnDestroy(){try{this.subscriptions.forEach(f=>{f.unsubscribe()})}catch{}}ShowMore(){this.masterService.ShowMore=!this.masterService.ShowMore,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0)}nullToZeroConverter(f){return null==f||null==f||""==f?0:parseFloat(f)}handleKeyDownboardEvent(f){"F1"==f.code&&(f.preventDefault(),this.ShowMore())}}return Z.\u0275fac=function(f){return new(f||Z)(v.Y36(q.P),v.Y36(Y.p),v.Y36(S.R),v.Y36(Q.e),v.Y36(C.uw),v.Y36(_.gz))},Z.\u0275cmp=v.Xpm({type:Z,selectors:[["voucher-master-toggler"]],hostBindings:function(f,w){1&f&&v.NdJ("keydown",function(O){return w.handleKeyDownboardEvent(O)},!1,v.evT)},inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:3,vars:2,consts:[[1,"btn","btn-info",3,"click"],[4,"ngIf"]],template:function(f,w){1&f&&(v.TgZ(0,"button",0),v.NdJ("click",function(){return w.ShowMore()}),v.YNc(1,U,2,0,"span",1),v.YNc(2,z,2,0,"span",1),v.qZA()),2&f&&(v.xp6(1),v.Q6J("ngIf",!w.masterService.ShowMore),v.xp6(1),v.Q6J("ngIf",w.masterService.ShowMore))},dependencies:[B.O5],encapsulation:2}),Z})()},78159:(pe,ne,E)=>{E.d(ne,{u:()=>V});var t=E(93105),g=E(42326),v=E(66274),q=E(53074),Y=E(87584),S=E(67297),Q=E(92752),C=E(89952),_=E(79700),B=E(63688);function U(F,j){if(1&F&&(v.TgZ(0,"div",5)(1,"h6"),v._uU(2),v.ALo(3,"twoDigitNumber"),v.qZA()()),2&F){const k=v.oxw(2);v.xp6(2),v.hij("ECS: ",v.lcZ(3,1,k._trnMainService.TrnMainObj.TOTALECS),"")}}function z(F,j){if(1&F&&(v.TgZ(0,"div",5)(1,"h6"),v._uU(2),v.ALo(3,"twoDigitNumber"),v.qZA()()),2&F){const k=v.oxw(2);v.xp6(2),v.hij("VAT: ",v.lcZ(3,1,k._trnMainService.TrnMainObj.VATAMNT),"")}}function $(F,j){if(1&F&&(v.TgZ(0,"div",8)(1,"h6"),v._uU(2),v.ALo(3,"twoDigitNumber"),v.qZA()()),2&F){const k=v.oxw(2);v.xp6(2),v.AsE("",k._trnMainService.TrnMainObj.FCurrency," TOTAL: ",v.lcZ(3,2,k._trnMainService.TrnMainObj.fcTotal),"")}}function Z(F,j){if(1&F&&(v.TgZ(0,"div",4)(1,"div",5)(2,"h6"),v._uU(3),v.ALo(4,"threeDigitNumber"),v.qZA()(),v.TgZ(5,"div",5)(6,"h6"),v._uU(7),v.ALo(8,"twoDigitNumber"),v.qZA()(),v.YNc(9,U,4,3,"div",6),v.ALo(10,"activeColumn"),v.TgZ(11,"div",5)(12,"h6"),v._uU(13),v.ALo(14,"twoDigitNumber"),v.qZA()(),v.TgZ(15,"div",5)(16,"h6"),v._uU(17),v.ALo(18,"twoDigitNumber"),v.qZA()(),v.TgZ(19,"div",5)(20,"h6"),v._uU(21),v.ALo(22,"twoDigitNumber"),v.qZA()(),v.YNc(23,z,4,3,"div",6),v.TgZ(24,"div",5)(25,"h6"),v._uU(26),v.ALo(27,"twoDigitNumber"),v.qZA()(),v.YNc(28,$,4,4,"div",7),v.qZA()),2&F){const k=v.oxw();v.xp6(3),v.hij("TOTAL QTY: ",v.lcZ(4,9,k._trnMainService.TrnMainObj.TOTALSQTY),""),v.xp6(4),v.hij("GROSS: ",v.lcZ(8,11,k._trnMainService.TrnMainObj.GROSSAMNT),""),v.xp6(2),v.Q6J("ngIf",v.lcZ(10,13,"ECSAmount")),v.xp6(4),v.hij("DISCOUNT: ",v.lcZ(14,15,k._trnMainService.TrnMainObj.TOTALDISCOUNT),""),v.xp6(4),v.hij("TAXABLE: ",v.lcZ(18,17,k._trnMainService.TrnMainObj.TAXABLE),"\xa0"),v.xp6(4),v.hij("NON TAXABLE: ",v.lcZ(22,19,k._trnMainService.TrnMainObj.NONTAXABLE),"\xa0"),v.xp6(2),v.Q6J("ngIf",k.showVatTotal()),v.xp6(3),v.hij("NET AMNT: ",v.lcZ(27,21,k._trnMainService.TrnMainObj.NETAMNT),""),v.xp6(2),v.Q6J("ngIf",10==k._trnMainService.TrnMainObj.CNDN_MODE&&(3==k._trnMainService.TrnMainObj.VoucherType||37==k._trnMainService.TrnMainObj.VoucherType||14==k._trnMainService.TrnMainObj.VoucherType)&&k._trnMainService.TrnMainObj.FCurrency)}}function N(F,j){if(1&F&&(v.TgZ(0,"div",12)(1,"h6",11),v._uU(2),v.ALo(3,"twoDigitNumber"),v.qZA()()),2&F){const k=v.oxw(2);v.xp6(2),v.hij("",v.lcZ(3,1,k._trnMainService.TrnMainObj.GROSSAMNT)," ")}}function f(F,j){if(1&F&&(v.TgZ(0,"div",9)(1,"div",10)(2,"h6",11),v._uU(3,"TOTAL:"),v.qZA()(),v.TgZ(4,"div",12)(5,"h6",11),v._uU(6),v.ALo(7,"threeDigitNumber"),v.qZA()(),v.YNc(8,N,4,3,"div",13),v.qZA()),2&F){const k=v.oxw();v.xp6(6),v.hij("",v.lcZ(7,2,k._trnMainService.TrnMainObj.TOTALQTY)," "),v.xp6(2),v.Q6J("ngIf",k._trnMainService.showFieldFromRight("Amnt")&&k._trnMainService.showFieldFromRight("Amt"))}}function w(F,j){if(1&F&&(v.TgZ(0,"div",10)(1,"h6"),v._uU(2),v.ALo(3,"twoDigitNumber"),v.qZA()()),2&F){const k=v.oxw(2);v.xp6(2),v.hij("TOTAL AMNT: ",v.lcZ(3,1,k._trnMainService.TrnMainObj.NETAMNT),"")}}function P(F,j){if(1&F&&(v.TgZ(0,"div",9),v._UZ(1,"div",14),v.TgZ(2,"div",15)(3,"div",10)(4,"h6"),v._uU(5),v.ALo(6,"threeDigitNumber"),v.qZA()(),v.YNc(7,w,4,3,"div",16),v.qZA()()),2&F){const k=v.oxw();v.xp6(5),v.hij("TOTAL QTY: ",v.lcZ(6,2,k._trnMainService.TrnMainObj.TOTALSQTY)," "),v.xp6(2),v.Q6J("ngIf",k._trnMainService.showFieldFromRight("Amnt")&&k._trnMainService.showFieldFromRight("Amt"))}}function O(F,j){if(1&F&&(v.TgZ(0,"div",9),v._UZ(1,"div",14),v.TgZ(2,"div",15)(3,"div",10)(4,"h6"),v._uU(5),v.ALo(6,"threeDigitNumber"),v.qZA()(),v.TgZ(7,"div",10)(8,"h6"),v._uU(9),v.ALo(10,"twoDigitNumber"),v.qZA()()()()),2&F){const k=v.oxw();v.xp6(5),v.hij("TOTAL QTY: ",v.lcZ(6,2,k._trnMainService.TrnMainObj.TOTALSQTY)," "),v.xp6(4),v.hij("TOTAL AMNT: ",v.lcZ(10,4,k._trnMainService.TrnMainObj.GROSSAMNT),"")}}function I(F,j){if(1&F&&(v.TgZ(0,"div",9)(1,"div",17),v._UZ(2,"div",18),v.TgZ(3,"label",19),v._uU(4),v.qZA(),v._UZ(5,"div",20),v.TgZ(6,"label",19),v._uU(7),v.qZA(),v._UZ(8,"div",21),v.TgZ(9,"label",19),v._uU(10),v.qZA(),v._UZ(11,"div",22),v.TgZ(12,"label",19),v._uU(13),v.qZA()()()),2&F){const k=v.oxw();v.xp6(4),v.hij("Request is equal to ",k.qtyLabel,""),v.xp6(3),v.hij("Request is more than ",k.qtyLabel,""),v.xp6(3),v.hij("",k.qtyLabel," is more than Request"),v.xp6(3),v.hij("",k.qtyLabel," quantity is Zero")}}function L(F,j){if(1&F&&(v.TgZ(0,"div",9),v._UZ(1,"div",23),v.TgZ(2,"div",24)(3,"h6"),v._uU(4),v.ALo(5,"threeDigitNumber"),v.qZA()()()),2&F){const k=v.oxw();v.xp6(4),v.hij("TOTAL QTY: ",v.lcZ(5,1,k._trnMainService.TrnMainObj.TOTALQTY)," ")}}let V=(()=>{class F{constructor(k,H,G){this.masterService=k,this._trnMainService=H,this._authservice=G,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new t.EventEmitter,82==this._trnMainService.TrnMainObj.VoucherType?this.qtyLabel="Dispatch":90==this._trnMainService.TrnMainObj.VoucherType&&(this.qtyLabel="Approved"),this.userSetting=G.getSetting()}ngOnInit(){}ngOnDestroy(){try{this.subscriptions.forEach(k=>{k.unsubscribe()})}catch{}}onKeydownPreventEdit(k){k.preventDefault()}showTotalDetails(){return!(this._trnMainService.TrnMainObj.VoucherType==g.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==g.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==g.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==g.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==g.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==g.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==g.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==g.Km.ReverseProductionEntry||this._trnMainService.TrnMainObj.VoucherType==g.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==g.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==g.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==g.Km.InventoryAllocation||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==g.Km.ApprovalClose)}showTotalQtyAmnt(){return(this._trnMainService.TrnMainObj.VoucherType==g.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==g.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.RequisitionApproval&&"requisition"==this._trnMainService.TrnMainObj.filterByInReqApproval)&&"requisition-log"!=this._trnMainService.activeurlpath}showTotalQty(){return this._trnMainService.TrnMainObj.VoucherType==g.Km.RequisitionEntry||"requisition-log"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==g.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==g.Km.ApprovalClose}showColorLabel(){return!(!(82==this._trnMainService.TrnMainObj.VoucherType||90==this._trnMainService.TrnMainObj.VoucherType&&this.userSetting.IsBBSM)||"VIEW"==this._trnMainService.TrnMainObj.Mode)}showVatTotal(){return"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj?.tag&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj?.tag&&!((this._trnMainService.TrnMainObj.VoucherType==g.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==g.Km.Quotation)&&0==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)}}return F.\u0275fac=function(k){return new(k||F)(v.Y36(q.P),v.Y36(Y.p),v.Y36(S.e))},F.\u0275cmp=v.Xpm({type:F,selectors:[["voucher-total-area"]],inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:8,vars:6,consts:[[1,"row","clearfix","footer"],[1,"col-md-12",2,"vertical-align","center","padding-right","0px"],["class","row total-details",4,"ngIf"],["class","row",4,"ngIf"],[1,"row","total-details"],[1,"detail-item"],["class","detail-item",4,"ngIf"],["class","detail-item foreign-currency",4,"ngIf"],[1,"detail-item","foreign-currency"],[1,"row"],[1,"col-md-6"],[1,"pull-right"],[1,"col-md-2"],["class","col-md-2",4,"ngIf"],[1,"col-md-7"],[1,"col-md-5","row"],["class","col-md-6",4,"ngIf"],[1,"col-md-12",2,"display","flex","align-items","center"],[1,"green"],[1,"label-color"],[1,"yellow"],[1,"red"],[1,"brown"],[1,"col-md-9"],[1,"col-md-3","row"]],template:function(k,H){1&k&&(v.TgZ(0,"div",0)(1,"div",1),v.YNc(2,Z,29,23,"div",2),v.YNc(3,f,9,4,"div",3),v.YNc(4,P,8,4,"div",3),v.YNc(5,O,11,6,"div",3),v.YNc(6,I,14,4,"div",3),v.YNc(7,L,6,3,"div",3),v.qZA()()),2&k&&(v.xp6(2),v.Q6J("ngIf",H.showTotalDetails()),v.xp6(1),v.Q6J("ngIf",24==H._trnMainService.TrnMainObj.VoucherType||5==H._trnMainService.TrnMainObj.VoucherType||88==H._trnMainService.TrnMainObj.VoucherType||75==H._trnMainService.TrnMainObj.VoucherType||89==H._trnMainService.TrnMainObj.VoucherType),v.xp6(1),v.Q6J("ngIf",7==H._trnMainService.TrnMainObj.VoucherType||8==H._trnMainService.TrnMainObj.VoucherType||9==H._trnMainService.TrnMainObj.VoucherType||74==H._trnMainService.TrnMainObj.VoucherType),v.xp6(1),v.Q6J("ngIf",H.showTotalQtyAmnt()),v.xp6(1),v.Q6J("ngIf",H.showColorLabel()),v.xp6(1),v.Q6J("ngIf",H.showTotalQty()))},dependencies:[Q.O5,C.g,_.w,B.v],styles:[".footer[_ngcontent-%COMP%] {\n    \n    \n    margin-right: 1px;\n    margin-bottom: 2.8%;\n    clear: both;\n    padding-top: 20px;\n    border-top: 1px solid #eaeaea;\n    border-left: 1px solid #eaeaea;\n    border-right: 1px solid #eaeaea;\n    background-color: #fff;\n  }\n\n  .green[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #26ef01;\n    border-radius: 50%;\n  }\n\n  .red[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #ff4141;\n    border-radius: 50%;\n  }\n\n  .yellow[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: yellow;\n    border-radius: 50%;\n  }\n\n  .brown[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #9602c7;\n    border-radius: 50%;\n  }\n\n  .label-color[_ngcontent-%COMP%]{\n    font-size: 14px;\n    width: 18%;\n    margin-left: 1%;\n  }\n\n\n  .foreign-currency[_ngcontent-%COMP%]{\n    width: 14.25%; \n    font-style: italic; \n    color:#021691;\n  }\n\n  .total-details[_ngcontent-%COMP%] {\n   padding-right: 0px;\n  display: flex;\n  flex-wrap: nowrap;\n  overflow-x: auto;\n  padding: 0 1rem; \n  justify-content:space-between;\n\n}\n\n.detail-item[_ngcontent-%COMP%] {\n  flex: 0 0 auto;\n  margin: 0.5rem;\n  min-width: 100px; \n\n}\n\n.detail-item[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%] {\n  margin: 0;\n}\n\n\n@media (max-width: 768px) {\n  .detail-item[_ngcontent-%COMP%] {\n    min-width: 120px; \n  }\n}"]}),F})()},29242:(pe,ne,E)=>{E.d(ne,{$x:()=>S,LD:()=>U,LX:()=>B,_f:()=>_,_n:()=>Y,gQ:()=>C,jT:()=>$,q7:()=>Q,qU:()=>q,rb:()=>z});var t=E(26215);const q=16777215,Y="bmp",S=0,Q=.7,C=4,_=4,B=1500,U=8e3,z="eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImV4cCI6MjE0NzQ4MzY0NywiaWF0IjoxNTYwOTUwMjcyLCJyaWdodHMiOlsiU0lHX1NES19DT1JFIiwiU0lHQ0FQVFhfQUNDRVNTIl0sImRldmljZXMiOlsiV0FDT01fQU5ZIl0sInR5cGUiOiJwcm9kIiwibGljX25hbWUiOiJTaWduYXR1cmUgU0RLIiwid2Fjb21faWQiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImxpY191aWQiOiJiODUyM2ViYi0xOGI3LTQ3OGEtYTlkZS04NDlmZTIyNmIwMDIiLCJhcHBzX3dpbmRvd3MiOltdLCJhcHBzX2lvcyI6W10sImFwcHNfYW5kcm9pZCI6W10sIm1hY2hpbmVfaWRzIjpbXX0.ONy3iYQ7lC6rQhou7rz4iJT_OJ20087gWz7GtCgYX3uNtKjmnEaNuP3QkjgxOK_vgOrTdwzD-nm-ysiTDs2GcPlOdUPErSp_bcX8kFBZVmGLyJtmeInAW6HuSp2-57ngoGFivTH_l1kkQ1KMvzDKHJbRglsPpd4nVHhx9WkvqczXyogldygvl0LRidyPOsS5H2GYmaPiyIp9In6meqeNQ1n9zkxSHo7B11mp_WXJXl0k1pek7py8XYCedCNW5qnLi4UCNlfTd6Mk9qz31arsiWsesPeR9PN121LBJtiPi023yQU8mgb9piw_a-ccciviJuNsEuRDN3sGnqONG3dMSA";class ${constructor(){this.fullName="",this.reason="document Approval",this.date="",this.eventSubject=new t.X(""),this.imageString$=this.eventSubject.asObservable(),this.setHTMLTags()}emitValue(N){this.eventSubject.next(N)}getImageString$(){return this.eventSubject.pipe(N=>N)}setHTMLTags(){this.btnRestore=document.getElementById("restore"),this.checkBoxUseB64=document.getElementById("chkUseB64Image"),this.checkShowSigtext=document.getElementById("chkShowSigText"),this.firstName=document.getElementById("fname"),this.imageBox=document.getElementById("imageBox"),this.lastName=document.getElementById("lname"),this.textSig=document.getElementById("txtSignature"),this.txtDisplay=document.getElementById("txtDisplay"),console.log({imageid:[this.imageBox,this.btnRestore,this.checkBoxUseB64,this.firstName,this.lastName]})}}},5881:(pe,ne,E)=>{E.r(ne),E.d(ne,{SessionControl:()=>q});var t=E(29242),e=E(46241);const g={map:{},counter:0,getJSON:function(Y,S,Q){var C=Y+(Y.indexOf("?")+1?"&":"?"),_=document.getElementsByTagName("head")[0],B=document.createElement("script"),U=[],z="",$="json-"+this.counter;for(z in this.counter++,S.script_name=$,S._rand=Math.random(),this.map[$]=Q,S.callback="JSONreq.success",S)U.push(z+"="+encodeURIComponent(S[z]));C+=U.join("&"),B.type="text/javascript",B.src=C,B.id=$,_.appendChild(B)},success:function(Y){var S=Y.script_name;delete Y.script_name,this.map[S](Y);var Q=document.getElementsByTagName("head")[0],C=document.getElementById(S);Q.removeChild(C),delete this.map.script_name}};class v{constructor(S,Q){gr(this,"_onDetectRunning"),gr(this,"service_port"),this._onDetectRunning=S,this.service_port=Q,this.running=!1,this.session=null,this.service_detected=!1;let C=this;window.sdkPtr=C;var _="https://localhost:";function B(N){0==N.status?(C.session=N.session,C.running=!0,S(),setTimeout(C.keepAlive,2e3)):console.log("Signature SDK local server error: "+N.status)}function U(N){0==N.status?(C.service_detected=!0,g.getJSON((_+=N.port+"/")+"wacom.js",{CreateSession:1},B)):console.log("Signature SDK Service error: "+N.status)}function Z(N){return typeof N>"u"||null==N?"":N}this.RBFlags={RenderOutputPicture:2097152,RenderOutputBase64:8192,RenderBackgroundTransparent:65536,RenderColor1BPP:131072,RenderColor24BPP:262144,RenderColor32BPP:524288,RenderColorAntiAlias:1048576,RenderEncodeData:4194304,RenderWatermark:8388608,RenderClipped:16777216,RenderRelative:33554432},this.IntegrityStatus={IntegrityOK:0,IntegrityFail:1,IntegrityMissing:2,IntegrityWrongType:3,IntegrityInsufficientData:4,IntegrityUncertain:5,IntegrityUnsupported:6},this.HashType={HashNone:0,HashMD5:1,HashSHA1:2,HashSHA224:3,HashSHA256:4,HashSHA384:5,HashSHA512:6},this.KeyType={KeyNone:0,KeyMD5:1,KeyMD5MAC:2,KeySHA1:3,KeySHA224:4,KeySHA256:5,KeySHA384:6,KeySHA512:7,KeyCAPICOM:8},this.SignedData={DataGood:0,DataNoHash:1,DataBadType:2,DataBadHash:3,DataError:4,DataUncertain:5,DataSigMoved:6},this.CaptData={CaptDigitizer:26,CaptDigitizerDriver:27,CaptMachineOS:28,CaptNetworkCard:29},this.DynamicCaptureResult={DynCaptOK:0,DynCaptCancel:1,DynCaptPadError:100,DynCaptError:101,DynCaptNotLicensed:103,DynCaptAbort:200,DynCaptIntegrityKeyInvalid:102},this.TimeZone={TimeLocal:0,TimeGMT:1,TimeUTC:1},this.DisplayMode={DspForceFit:0,DspUseZoom:1,DspBestFit:2},this.ShowText={TxtDontShow:0,TxtShowLeft:1,TxtShowCenter:2,TxtShowRight:4},this.ObjectType={ObjectText:0,ObjectButton:1,ObjectCheckbox:2,ObjectSignature:3,ObjectInput:4,ObjectInputEcho:5,ObjectHash:6,ObjectImage:7,ObjectDisplayAtShutdown:8,ObjectInking:9,ObjectRadioButton:10},this.TextOptions={TextAlignLeft:0,TextAlignRight:1,TextAlignCentre:2,TextAlignJustify:3},this.ButtonOptions={BtnAlignCentre:0,BtnAlignMiddle:0,BtnAlignLeft:1,BtnAlignRight:2,BtnAlignTop:4,BtnAlignBottom:8},this.CheckBoxOptions={CheckboxUnchecked:0,CheckboxChecked:1,CheckboxDisplayTick:2,CheckboxDisplayCross:4},this.ObjectOptionType={OBJECTOPTION_STRING:0,OBJECTOPTION_INT:1,OBJECTOPTION_BOOL:2},this.VariantType={VARIANT_EMPTY:0,VARIANT_TEXT:1,VARIANT_NUM:2,VARIANT_OBJECTOPTIONS:3,VARIANT_SIGOBJ:4,VARIANT_SIGCTL:5,VARIANT_INPUTOBJ:6,VARIANT_HASH:7,VARIANT_IMGURL:8,VARIANT_BASE64:9,VARIANT_DYNCAP:10,VARIANT_WIZCTL:11,VARIANT_FONT:12,VARIANT_KEY:13},this.PrimitiveType={PrimitiveLine:0,PrimitiveRectangle:1,PrimitiveEllipse:2},this.PrimitiveOptions={PrimitiveLineSolid:1,PrimitiveLineDashed:2,PrimitiveOutline:4,PrimitiveFill:8,PrimitiveFillXOR:16},this.EventType={EvTextClicked:0,EvButtonClicked:1,EvCheckboxChecked:2,EvCheckboxUnchecked:3,EvInputMinReached:4,EvInputMaxReached:5,EvInputExceeded:6},this.EncryptAlg={EncryptNone:0,EncryptTripleDES:1},this.ResponseStatus={OK:0,FAILED:1,INVALID_SESSION:3},this.FontWeight={FW_DONTCARE:0,FW_THIN:100,FW_EXTRALIGHT:200,FW_LIGHT:300,FW_NORMAL:400,FW_MEDIUM:500,FW_SEMIBOLD:600,FW_BOLD:700,FW_EXTRABOLD:800,FW_HEAVY:900,FW_ULTRALIGHT:200,FW_REGULAR:400,FW_DEMIBOLD:600,FW_ULTRABOLD:800,FW_BLACK:900},this.FontCharset={ANSI_CHARSET:0,DEFAULT_CHARSET:1,SYMBOL_CHARSET:2,SHIFTJIS_CHARSET:128,HANGEUL_CHARSET:129,HANGUL_CHARSET:129,GB2312_CHARSET:134,CHINESEBIG5_CHARSET:136,OEM_CHARSET:255,JOHAB_CHARSET:130,HEBREW_CHARSET:177,ARABIC_CHARSET:178,GREEK_CHARSET:161,TURKISH_CHARSET:162,VIETNAMESE_CHARSET:163,THAI_CHARSET:222,EASTEUROPE_CHARSET:238,RUSSIAN_CHARSET:204,MAC_CHARSET:77,BALTIC_CHARSET:186,FS_LATIN1:1,FS_LATIN2:2,FS_CYRILLIC:4,FS_GREEK:8,FS_TURKISH:16,FS_HEBREW:32,FS_ARABIC:64,FS_BALTIC:128,FS_VIETNAMESE:256,FS_THAI:65536,FS_JISJAPAN:131072,FS_CHINESESIMP:262144,FS_WANSUNG:524288,FS_CHINESETRAD:1048576,FS_JOHAB:2097152,FS_SYMBOL:2147483648},this.Font=function(N,f,w,P,O,I,L){this.type=C.VariantType.VARIANT_FONT,this.fontName=typeof N>"u"?"Arial":N,this.fontSize=typeof f>"u"?8:f,this.sWeight=typeof w>"u"?C.FontWeight.FW_NORMAL:w,this.sCharset=typeof P>"u"?C.FontCharset.ANSI_CHARSET:P,this.fItalic=typeof fItalic>"u"?0:fItalic,this.fUnderline=typeof I>"u"?0:fUnderline,this.fStrikethrough=typeof L>"u"?0:L},this.keepAlive=function(){g.getJSON(_+"wacom.js",{session:C.session,KeepAlive:1},function(){}),setTimeout(C.keepAlive,2e3)},window.addEventListener("unload",function(N){!function z(){if(0!=C.session){var N=_+"wacom.js?DestroySession=1&session="+C.session;if(C.session=0,null!=self.Navigator.sendBeacon)self.Navigator.sendBeacon(N);else{var f=new XMLHttpRequest;f.open("GET",N,!1),f.send(null)}}}()}),function $(){g.getJSON(_+Q+"/wacom.js",{GetPort:1},U)}(),this.getVersion=function(N){g.getJSON(_+"wacom.js",{GetVersion:1,session:C.session},function w(P){N(P.version,parseInt(P.status))})},this.Hash=function(N){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_HASH,g.getJSON(_+"wacom.js",{Hash:"Constructor",session:C.session},function P(O){f.handle=O.handle,N(f,parseInt(O.status))}),this.Add=function(O,I){var L={Hash:"Add",session:C.session,handle:f.handle};O.Stringify(L,"hData"),g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.Clear=function(O){g.getJSON(_+"wacom.js",{Hash:"Clear",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.status))})},this.GetType=function(O){g.getJSON(_+"wacom.js",{Hash:"GetType",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.hashType),parseInt(V.status))})},this.PutType=function(O,I){var L={Hash:"PutType",session:C.session,handle:f.handle,type:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})}},this.Key=function(N){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_KEY,g.getJSON(_+"wacom.js",{Key:"Constructor",session:C.session},function P(O){f.handle=O.handle,N(f,parseInt(O.status))}),this.GetType=function(O){g.getJSON(_+"wacom.js",{Key:"GetType",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.type),parseInt(V.status))})},this.Set=function(O,I,L){var V={Key:"Set",session:C.session,handle:f.handle,type:Z(O)};I.Stringify(V,"value"),g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})}},this.Bitmap=function(){this.handle=null,this.isBase64=!1,this.mime_type=null,this.image=new Image},this.SigObj=function(){var N=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGOBJ,this.CheckIntegrity=function(f,w){var P={SigObj:"CheckIntegrity",session:C.session,handle:N.handle},O=new C.Variant;O.Set(f),O.Stringify(P,"key"),g.getJSON(_+"wacom.js",P,function I(L){w(N,parseInt(L.status))})},this.CheckSignedData=function(f,w){var P={SigObj:"CheckSignedData",session:C.session,handle:N.handle,HashHandle:Z(f.handle)};g.getJSON(_+"wacom.js",P,function O(I){w(N,parseInt(I.status))})},this.Clear=function(f){g.getJSON(_+"wacom.js",{SigObj:"Clear",session:C.session,handle:N.handle},function P(O){f(N,parseInt(O.status))})},this.GetAdditionalData=function(f,w){var P={SigObj:"GetAdditionalData",session:C.session,handle:N.handle,captData:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){w(N,I.additionalData,parseInt(I.status))})},this.GetCrossedOut=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetCrossedOut",session:C.session,handle:N.handle},function P(O){f(N,Boolean(1==parseInt(O.crossedOut)),parseInt(O.status))})},this.GetExtraData=function(f,w){var P={SigObj:"GetExtraData",session:C.session,handle:N.handle,key:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){w(N,I.extraData,parseInt(I.status))})},this.GetHeight=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetHeight",session:C.session,handle:N.handle},function P(O){f(N,parseInt(O.height),parseInt(O.status))})},this.GetInk=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetInk",session:C.session,handle:N.handle},function P(O){f(N,O.ink,parseInt(O.status))})},this.GetIsCaptured=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetIsCaptured",session:C.session,handle:N.handle},function P(O){f(N,Boolean(1==parseInt(O.isCaptured)),parseInt(O.status))})},this.GetProperty=function(f,w){var P={SigObj:"GetProperty",session:C.session,handle:N.handle,key:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){var L=new C.Variant;L.Parse(I,"property"),w(N,L,parseInt(I.status))})},this.GetSigData=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetSigData",session:C.session,handle:N.handle},function P(O){var I=new C.Variant;I.Parse(O,"sigData"),f(N,I,parseInt(O.status))})},this.GetSigText=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetSigText",session:C.session,handle:N.handle},function P(O){f(N,O.sigText,parseInt(O.status))})},this.GetWhen=function(f,w){var P={SigObj:"GetWhen",session:C.session,handle:N.handle,timeZone:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){var L=new Date(parseFloat(I.year),parseFloat(I.month)-1,parseFloat(I.day),parseFloat(I.hour),parseFloat(I.minute),parseFloat(I.second));L.dayOfWeek=parseFloat(I.dayOfWeek),w(N,L,parseInt(I.status))})},this.GetWho=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetWho",session:C.session,handle:N.handle},function P(O){f(N,O.who,parseInt(O.status))})},this.GetWhy=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetWhy",session:C.session,handle:N.handle},function P(O){f(N,O.why,parseInt(O.status))})},this.GetWidth=function(f){g.getJSON(_+"wacom.js",{SigObj:"GetWidth",session:C.session,handle:N.handle},function P(O){f(N,parseInt(O.width),parseInt(O.status))})},this.PutExtraData=function(f,w,P){var O={SigObj:"PutExtraData",session:C.session,handle:N.handle,key:Z(f),value:Z(w)};g.getJSON(_+"wacom.js",O,function I(L){P(N,parseInt(L.status))})},this.PutInk=function(f,w){var P={SigObj:"PutInk",session:C.session,handle:N.handle,ink:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){w(N,parseInt(I.status))})},this.PutSigData=function(f,w){var P={SigObj:"PutSigData",session:C.session,handle:N.handle};f.Stringify(P,"sigData"),g.getJSON(_+"wacom.js",P,function O(I){w(N,parseInt(I.status))})},this.PutSigText=function(f,w){var P={SigObj:"PutSigText",session:C.session,handle:N.handle,sigText:Z(f)};g.getJSON(_+"wacom.js",P,function O(I){w(N,parseInt(I.status))})},this.ReadEncodedBitmap=function(f,w){var P={SigObj:"ReadEncodedBitmap",session:C.session,handle:N.handle},O=new C.Variant;O.type=C.VariantType.VARIANT_IMGURL,O.url=f,O.Stringify(P,"bitmapURL"),g.getJSON(_+"wacom.js",P,function I(L){w(N,parseInt(L.status))})},this.RenderBitmap=function(f,w,P,O,I,L,V,F,j,k){var H={SigObj:"RenderBitmap",session:C.session,handle:N.handle,mimetype:Z(f),width:Z(w),height:Z(P),ink_width:Z(O),ink_color:Z(I),bg_color:Z(L),flags:Z(V),paddingX:Z(F),paddingY:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){var de=parseInt(ee.status);if(0==de)if(V&C.RBFlags.RenderOutputPicture){var be=new C.Bitmap;be.handle=ee.bitmapHandle,be.isBase64=1==ee.isBase64,be.image.onload=function(){k(N,be,de)},be.image.src=be.isBase64?"data:image/"+f+";base64,"+ee.base64:_+ee.bitmapHandle+"?session="+C.session}else 1==ee.isBase64&&k(N,ee.base64,de);else k(N,null,de)})},this.SetProperty=function(f,w,P){var O={SigObj:"SetProperty",session:C.session,handle:N.handle,key:Z(f)};w.Stringify(O,"value"),g.getJSON(_+"wacom.js",O,function I(L){P(N,parseInt(L.status))})}},this.DynamicCapture=function(N){var f=this;this.handle=null,g.getJSON(_+"wacom.js",{DynamicCapture:"Constructor",session:C.session},function P(O){f.handle=O.handle,N(f,parseInt(O.status))}),this.Capture=function(O,I,L,V,F,j){var k=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,H=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,G=window.screenLeft?window.screenLeft:window.screenX,ee=window.screenTop?window.screenTop:window.screenY,de={DynamicCapture:"Capture",session:C.session,who:Z(I),why:Z(L),width:Z(k),height:Z(H),left:Z(G),top:Z(ee),SigCtlHandle:Z(O.handle),handle:f.handle},be=new C.Variant;be.Set(V),be.Stringify(de,"what");var Oe=new C.Variant;Oe.Set(F),Oe.Stringify(de,"key"),g.getJSON(_+"wacom.js",de,function Ee(Ne){var Re=new C.SigObj;Re.handle=Ne.handle,j(f,Re,parseInt(Ne.status))})},this.GetLicence=function(O){g.getJSON(_+"wacom.js",{DynamicCapture:"GetLicence",session:C.session,handle:f.handle},function L(V){O(f,V.licence,parseInt(V.status))})},this.GetProperty=function(O,I){var L={DynamicCapture:"GetProperty",session:C.session,handle:f.handle,key:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){var j=new C.Variant;j.Parse(F,"property"),I(f,j,parseInt(F.status))})},this.PutLicence=function(O,I){var L={DynamicCapture:"PutLicence",session:C.session,handle:f.handle,licence:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.SetProperty=function(O,I,L){var V={DynamicCapture:"SetProperty",session:C.session,handle:f.handle,key:Z(O)};I.Stringify(V,"value"),g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})}},this.SigCtl=function(N){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGCTL,g.getJSON(_+"wacom.js",{SigCtl:"Constructor",session:C.session},function P(O){f.handle=O.handle,N(f,parseInt(O.status))}),this.AboutBox=function(O){var I=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,L=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,V=window.screenLeft?window.screenLeft:window.screenX,F=window.screenTop?window.screenTop:window.screenY,j={SigCtl:"AboutBox",session:C.session,width:Z(I),height:Z(L),left:Z(V),top:Z(F),handle:f.handle};g.getJSON(_+"wacom.js",j,function k(H){O(f,parseInt(H.status))})},this.GetAppData=function(O,I){var L={SigCtl:"GetAppData",session:C.session,handle:f.handle,key:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){var j=new C.Variant;j.Parse(F,"appData"),I(f,j,parseInt(F.status))})},this.GetInputData=function(O){g.getJSON(_+"wacom.js",{SigCtl:"GetInputData",session:C.session,handle:f.handle},function L(V){O(f,V.inputData,parseInt(V.status))})},this.GetLicence=function(O){g.getJSON(_+"wacom.js",{SigCtl:"GetLicence",session:C.session,handle:f.handle},function L(V){O(f,V.licence,parseInt(V.status))})},this.GetProperty=function(O,I){var L={SigCtl:"GetProperty",session:C.session,handle:f.handle,key:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){var j=new C.Variant;j.Parse(F,"property"),I(f,j,parseInt(F.status))})},this.GetSignature=function(O){g.getJSON(_+"wacom.js",{SigCtl:"GetSignature",session:C.session,handle:f.handle},function L(V){var F=new C.SigObj;F.handle=V.signatureHandle,O(f,F,parseInt(V.status))})},this.PutAppData=function(O,I,L){var V={SigCtl:"PutAppData",session:C.session,handle:f.handle,key:Z(O)};I.Stringify(V,"val"),g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})},this.PutInputData=function(O,I){var L={SigCtl:"PutInputData",session:C.session,handle:f.handle,inputData:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.PutLicence=function(O,I){var L={SigCtl:"PutLicence",session:C.session,handle:f.handle,licence:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.PutProperties=function(O,I){var L={SigCtl:"PutProperties",session:C.session,handle:f.handle,properties:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.PutSignature=function(O,I){var L={SigCtl:"PutSignature",session:C.session,handle:f.handle,signatureHandle:Z(O.handle)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.SetProperty=function(O,I,L){var V={SigCtl:"SetProperty",session:C.session,handle:f.handle,key:Z(O)};I.Stringify(V,"value"),g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})}},this.InputObj=function(N){var f=this;this.handle=null,this.type=C.VariantType.VARIANT_INPUTOBJ,g.getJSON(_+"wacom.js",{InputObj:"Constructor",session:C.session},function P(O){f.handle=O.handle,N(f,parseInt(O.status))}),this.Clear=function(O){g.getJSON(_+"wacom.js",{InputObj:"Clear",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.status))})},this.GetData=function(O){g.getJSON(_+"wacom.js",{InputObj:"GetData",session:C.session,handle:f.handle},function L(V){O(f,V.data,parseInt(V.status))})},this.GetEncryptionType=function(O){g.getJSON(_+"wacom.js",{InputObj:"GetEncryptionType",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.encryptionType),parseInt(V.status))})},this.GetMaxLength=function(O){g.getJSON(_+"wacom.js",{InputObj:"GetMaxLength",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.maxLength),parseInt(V.status))})},this.GetMinLength=function(O){g.getJSON(_+"wacom.js",{InputObj:"GetMinLength",session:C.session,handle:f.handle},function L(V){O(f,parseInt(V.minLength),parseInt(V.status))})},this.GetProperty=function(O,I){var L={InputObj:"GetProperty",session:C.session,handle:f.handle,name:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){(new C.Variant).Parse(F,"property"),I(f,F.property,parseInt(F.status))})},this.GetText=function(O){g.getJSON(_+"wacom.js",{InputObj:"GetText",session:C.session,handle:f.handle},function L(V){O(f,V.text,parseInt(V.status))})},this.PutMaxLength=function(O,I){var L={InputObj:"PutMaxLength",session:C.session,handle:f.handle,maxLength:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.PutMinLength=function(O,I){var L={InputObj:"PutMinLength",session:C.session,handle:f.handle,minLength:Z(O)};g.getJSON(_+"wacom.js",L,function V(F){I(f,parseInt(F.status))})},this.SetEncryption=function(O,I,L){var V={InputObj:"SetEncryption",session:C.session,handle:f.handle,type:Z(O)};I.Stringify(V,"key"),g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})},this.SetProperty=function(O,I,L){var V={InputObj:"SetProperty",session:C.session,handle:f.handle,name:Z(O),value:Z(I)};g.getJSON(_+"wacom.js",V,function F(j){L(f,parseInt(j.status))})}},this.ObjectOptions=function(){var N=this;this.type=C.VariantType.VARIANT_OBJECTOPTIONS,this.AddOption=function(f,w){N[f]=w}},this.Variant=function(){var N=this;this.type=C.VariantType.VARIANT_EMPTY,this.Parse=function(f,w){var P=parseInt(f[w+".type"]);switch(P){case C.VariantType.VARIANT_TEXT:N.type=P,N.text=f[w+".text"];break;case C.VariantType.VARIANT_NUM:N.type=P,N.num=parseFloat(f[w+".num"]);break;case C.VariantType.VARIANT_OBJECTOPTIONS:N.type=P;break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:N.type=P,N.handle=f[w+".handle"];break;case C.VariantType.VARIANT_BASE64:N.type=P,N.base64=f[w+".base64"];break;case C.VariantType.VARIANT_IMGURL:N.type=P,N.url=f[w+".url"];break;case C.VariantType.VARIANT_FONT:N.type=P,N.fontName=f[w+".fontName"],N.fontSize=f[w+".fontSize"],N.sWeight=f[w+".sWeight"],N.sCharset=f[w+".sCharset"],N.fItalic=f[w+".fItalic"],N.fUnderline=f[w+".fUnderline"],N.fStrikethrough=f[w+".fStrikethrough"];break;default:N.type=C.VariantType.VARIANT_EMPTY}},this.Set=function(f){if("string"==typeof f)N.type=C.VariantType.VARIANT_TEXT,N.text=f;else if("number"==typeof f)N.type=C.VariantType.VARIANT_NUM,N.num=f;else if(null!=f&&"object"==typeof f&&typeof f.type<"u"&&null!=f.type)switch(f.type){case C.VariantType.VARIANT_OBJECTOPTIONS:for(o in N.type=C.VariantType.VARIANT_OBJECTOPTIONS,f)"type"!=o&&("string"==typeof f[o]?(N[o]=f[o],N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_STRING):"number"==typeof f[o]?(N[o]=f[o]>0?Math.floor(f[o]):Math.ceil(f[o]),N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_INT):"boolean"==typeof f[o]&&(N[o]=1==f[o]?1:0,N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_BOOL));break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:N.type=f.type,N.handle=f.handle;break;case C.VariantType.VARIANT_IMGURL:N.type=C.VariantType.VARIANT_IMGURL,N.url=f.url;break;case C.VariantType.VARIANT_BASE64:N.type=C.VariantType.VARIANT_BASE64,N.base64=f.base64;break;case C.VariantType.VARIANT_FONT:N.type=C.VariantType.VARIANT_FONT,N.fontName=f.fontName,N.fontSize=f.fontSize,N.sWeight=f.sWeight,N.sCharset=f.sCharset,N.fItalic=f.fItalic,N.fUnderline=f.fUnderline,N.fStrikethrough=f.fStrikethrough;break;case C.VariantType.VARIANT_TEXT:N.type=f.type,N.text=f.text;break;case C.VariantType.VARIANT_NUM:N.type=f.type,N.num=f.num;break;default:N.type=C.VariantType.VARIANT_EMPTY}},this.Stringify=function(f,w){for(var P in N)"string"==typeof P&&"function"!=typeof N[P]&&"symbol"!=typeof N[P]&&("object"==typeof N[P]||"string"==typeof N[P]||"number"==typeof N[P])&&(f[w+"."+P]=N[P.toString()])}},this.WizCtl=function(N){var f=this;this.handle=null;var F,w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,P=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,O=window.screenLeft?window.screenLeft:window.screenX,I=window.screenTop?window.screenTop:window.screenY;g.getJSON(_+"wacom.js",{WizCtl:"Constructor",session:C.session,width:w,height:P,left:O,top:I},function V(j){f.handle=j.handle,N(f,parseInt(j.status))}),this.AddObject=function(j,k,H,G,ee,de,be){var Oe={WizCtl:"AddObject",session:C.session,handle:f.handle,objType:Z(j),id:Z(k)},Ee=new C.Variant,Ne=new C.Variant;Ee.Set(H),Ne.Set(G),Ee.Stringify(Oe,"X"),Ne.Stringify(Oe,"Y"),ee.Stringify(Oe,"objData"),de.Stringify(Oe,"options"),g.getJSON(_+"wacom.js",Oe,function Re(we){be(f,parseInt(we.status))})},this.AddPrimitive=function(j,k,H,G,ee,de,be,Oe){var Ee={WizCtl:"AddPrimitive",session:C.session,handle:f.handle,primType:Z(j)},Ne=new C.Variant,Re=new C.Variant,we=new C.Variant,Ke=new C.Variant;Ne.Set(k),Re.Set(H),we.Set(G),Ke.Set(ee),Ne.Stringify(Ee,"X1"),Re.Stringify(Ee,"Y1"),we.Stringify(Ee,"X2"),Ke.Stringify(Ee,"Y2"),de.Stringify(Ee,"primData"),be.Stringify(Ee,"options"),g.getJSON(_+"wacom.js",Ee,function Ge(Ye){Oe(f,parseInt(Ye.status))})},this.Close=function(j){g.getJSON(_+"wacom.js",{WizCtl:"Close",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.status))})},this.Display=function(j){g.getJSON(_+"wacom.js",{WizCtl:"Display",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.status))})},this.FireClick=function(j,k){g.getJSON(_+"wacom.js",{WizCtl:"FireClick",session:C.session,handle:f.handle,fireClickId:j},function G(ee){k(f,parseInt(ee.status))})},this.GetBackColor=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetBackColor",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.backColor),parseInt(G.status))})},this.GetBorderColor=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetBorderColor",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.borderColor),parseInt(G.status))})},this.GetBorderStyle=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetBorderStyle",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.borderStyle),parseInt(G.status))})},this.GetBorderVisible=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetBorderVisible",session:C.session,handle:f.handle},function H(G){j(f,Boolean(1==parseInt(G.borderVisible)),parseInt(G.status))})},this.GetBorderWidth=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetBorderWidth",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.borderWidth),parseInt(G.status))})},this.GetEnableWizardDisplay=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetEnableWizardDisplay",session:C.session,handle:f.handle},function H(G){j(f,Boolean(1==parseInt(G.enableWD)),parseInt(G.status))})},this.GetFont=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetFont",session:C.session,handle:f.handle},function H(G){var ee=new C.Variant;ee.Parse(G,"font"),j(f,ee,parseInt(G.status))})},this.GetInkingPad=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetInkingPad",session:C.session,handle:f.handle},function H(G){j(f,Boolean(1==parseInt(G.inkingPad)),parseInt(G.status))})},this.GetLicence=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetLicence",session:C.session,handle:f.handle},function H(G){j(f,G.licence,parseInt(G.status))})},this.GetObjectState=function(j,k){var H={WizCtl:"GetObjectState",session:C.session,handle:f.handle,objectId:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){var de=new C.Variant;de.Parse(ee,"objState"),k(f,de,parseInt(ee.status))})},this.GetPadHeight=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetPadHeight",session:C.session,handle:f.handle},function H(G){j(f,parseFloat(G.height),parseInt(G.status))})},this.GetPadWidth=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetPadWidth",session:C.session,handle:f.handle},function H(G){j(f,parseFloat(G.width),parseInt(G.status))})},this.GetProperty=function(j,k){var H={WizCtl:"GetProperty",session:C.session,handle:f.handle,key:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){var de=new C.Variant;de.Parse(ee,"property"),k(f,de,parseInt(ee.status))})},this.GetVisibleWindow=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetVisibleWindow",session:C.session,handle:f.handle},function H(G){j(f,Boolean(1==parseInt(G.visible)),parseInt(G.status))})},this.GetZoom=function(j){g.getJSON(_+"wacom.js",{WizCtl:"GetZoom",session:C.session,handle:f.handle},function H(G){j(f,parseFloat(G.zoom),parseInt(G.status))})},this.PadConnect=function(j){g.getJSON(_+"wacom.js",{WizCtl:"PadConnect",session:C.session,handle:f.handle},function H(G){j(f,Boolean(1==parseInt(G.padConnect)),parseInt(G.status))})},this.PadDisconnect=function(j){g.getJSON(_+"wacom.js",{WizCtl:"PadDisconnect",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.status))})},this.PutBackColor=function(j,k){var H={WizCtl:"PutBackColor",session:C.session,handle:f.handle,backColor:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutBorderColor=function(j,k){var H={WizCtl:"PutBorderColor",session:C.session,handle:f.handle,borderColor:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutBorderStyle=function(j,k){var H={WizCtl:"PutBorderStyle",session:C.session,handle:f.handle,borderStyle:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutBorderVisible=function(j,k){var H={WizCtl:"PutBorderVisible",session:C.session,handle:f.handle,borderVisible:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutBorderWidth=function(j,k){var H={WizCtl:"PutBorderWidth",session:C.session,handle:f.handle,borderWidth:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutEnableWizardDisplay=function(j,k){var H={WizCtl:"PutEnableWizardDisplay",session:C.session,handle:f.handle,enableWD:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutFont=function(j,k){var H={WizCtl:"PutFont",session:C.session,handle:f.handle};j.Stringify(H,"font"),g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutLicence=function(j,k){var H={WizCtl:"PutLicence",session:C.session,handle:f.handle,licence:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutPadHeight=function(j,k){var H={WizCtl:"PutPadHeight",session:C.session,handle:f.handle,height:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutPadWidth=function(j,k){var H={WizCtl:"PutPadWidth",session:C.session,handle:f.handle,width:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutProperties=function(j,k){var H={WizCtl:"PutProperties",session:C.session,handle:f.handle,properties:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutRefFont=function(j,k){var H={WizCtl:"PutRefFont",session:C.session,handle:f.handle};j.Stringify(H,"font"),g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutVisibleWindow=function(j,k){var H={WizCtl:"PutVisibleWindow",session:C.session,handle:f.handle,visible:Number(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.PutZoom=function(j,k){var H={WizCtl:"PutZoom",session:C.session,handle:f.handle,zoom:Z(j)};g.getJSON(_+"wacom.js",H,function G(ee){k(f,parseInt(ee.status))})},this.Reset=function(j){g.getJSON(_+"wacom.js",{WizCtl:"Reset",session:C.session,handle:f.handle},function H(G){j(f,parseInt(G.status))})},this.SetProperty=function(j,k,H){var G={WizCtl:"SetProperty",session:C.session,handle:f.handle,key:j};k.Stringify(G,"value"),g.getJSON(_+"wacom.js",G,function ee(de){H(f,parseInt(de.status))})},this.SetEventHandler=function(j){F=j,g.getJSON(_+"wacom.js",{WizCtl:"SetEventHandler",session:C.session,handle:f.handle},function H(G){var ee={WizCtl:"UpdateEventHandler",session:C.session,handle:f.handle};if(0==parseInt(G.status))g.getJSON(_+"wacom.js",ee,H);else if(typeof G.status>"u")return;setTimeout(function(){F(f.handle,G["event-id"],parseInt(G["event-type"]),parseInt(G.status))},0)})}}}}class q{static actionWhenRestarted(){e.SigCapture.sigCtl=null,e.SigCapture.dynCapt=null,null!=e.SigCapture.HTMLTagIds.imageBox.firstChild&&e.SigCapture.HTMLTagIds.imageBox.removeChild(e.SigCapture.HTMLTagIds.imageBox.firstChild),this.timeout=setTimeout(q.timedDetect,t.LX),console.log({msg:"Starting up WacomGSS_SignatureSDK",timeout:this.timeout}),window.JSONreq=g;let S=new v(q.onDetectRunning,t.LD);window.sdkPtr=S,console.log({window})}static timedDetect(){window.sdkPtr.running?(e.SigCapture.print("Signature SDK Service detected."),q.start()):e.SigCapture.print("Signature SDK Service not detected.")}static onDetectRunning(){window.sdkPtr.running?(e.SigCapture.print("Signature SDK Service detected."),console.log({msg:"signature sdk service detected"}),e.SigCapture.print("Starting..."),q.start()):e.SigCapture.print("Signature SDK Service not detected.")}static start(){window.sdkPtr.running&&(e.SigCapture.print("Checking components ..."),e.SigCapture.sigCtl=new window.sdkPtr.SigCtl(q.onSigCtlConstructor))}static onSigCtlConstructor(S,Q){e.SigCapture.callbackStatusOK("SigCtl Constructor",Q)&&S.PutLicence(t.rb,q.onSigCtlPutLicence)}static onDynCaptConstructor(S,Q){e.SigCapture.callbackStatusOK("DynCapt Constructor",Q)&&e.SigCapture.sigCtl.GetSignature(q.onGetSignature)}static onSigCtlPutLicence(S,Q){e.SigCapture.callbackStatusOK("SigCtl PutLicence",Q)&&(e.SigCapture.dynCapt=new window.sdkPtr.DynamicCapture(q.onDynCaptConstructor))}static onGetSignature(S,Q,C){e.SigCapture.callbackStatusOK("SigCapt GetSignature",C)&&S.GetProperty("Component_FileVersion",q.onSigCtlGetFileVersion)}static onGetSigCaptXVersion(S,Q){e.SigCapture.callbackStatusOK("SigCaptX GetVersion",Q)&&(e.SigCapture.print("SigCaptX  v"+S),e.SigCapture.sigCtl.GetProperty("Component_FileVersion",q.onSigCtlGetFileVersion))}static onSigCtlGetFileVersion(S,Q,C){e.SigCapture.callbackStatusOK("SigCtl GetProperty",C)&&(e.SigCapture.print("DLL: flSigCOM.dll  v"+Q.text),e.SigCapture.dynCapt.GetProperty("Component_FileVersion",q.onDynCaptGetFileVersion))}static onDynCaptGetFileVersion(S,Q,C){e.SigCapture.callbackStatusOK("DynCapt GetProperty",C)&&(e.SigCapture.print("DLL: flSigCapt.dll v"+Q.text),e.SigCapture.print("Test application ready."),e.SigCapture.print("Press 'Capture' to capture a signature."))}}},46241:(pe,ne,E)=>{E.r(ne),E.d(ne,{SigCapture:()=>v});var t=E(29242),e=E(5881),g=E(66274);class v{constructor(){this.reason=""}ngAfterViewInit(){v.HTMLTagIds=new t.jT}capturesig(){this.reason.length>0&&(v.HTMLTagIds.reason=this.reason),null!=v.HTMLTagIds?.imageBox?.firstChild&&v.HTMLTagIds.imageBox.removeChild(v.HTMLTagIds.imageBox.firstChild),window.sdkPtr.running?v.Capture():e.SessionControl.actionWhenRestarted()}static print(Y){}static callbackStatusOK(Y,S){return window.sdkPtr.ResponseStatus.OK===S||(v.print(Y+" error: "+S),!1)}static Capture(){v.hash=new window.sdkPtr.Hash(v.onHashConstructor)}static onHashConstructor(Y,S){window.sdkPtr.ResponseStatus.OK==S?v.GetHash(Y,v.onGetInitialHash):(v.print("Hash Constructor error: "+S),window.sdkPtr.ResponseStatus.INVALID_SESSION==S&&(v.print("Error: invalid session. Restarting the session."),e.SessionControl.actionWhenRestarted()))}}v.HTMLTagIds=new t.jT,v.onGetInitialHash=()=>{v.HTMLTagIds.fullName=v.HTMLTagIds.firstName.value;var Y=v.HTMLTagIds.fullName,S=v.HTMLTagIds.reason;console.log({fullName:Y,reason:S}),v.dynCapt.Capture(v.sigCtl,Y,S,v.hash,null,v.onDynCaptCapture)},v.onDynCaptCapture=(q,Y,S)=>{if(window.sdkPtr.ResponseStatus.INVALID_SESSION==S)v.print("Error: invalid session. Restarting the session."),e.SessionControl.actionWhenRestarted();else switch(S){case window.sdkPtr.DynamicCaptureResult.DynCaptOK:v.sigObj=Y,v.print("Signature captured successfully");var Q=window.sdkPtr.RBFlags.RenderOutputBase64|window.sdkPtr.RBFlags.RenderColor32BPP;Y.RenderBitmap(t._n,v.HTMLTagIds.imageBox.clientWidth,v.HTMLTagIds.imageBox.clientHeight,t.q7,t.$x,t.qU,Q,t.gQ,t._f,v.onRenderBitmap);break;case window.sdkPtr.DynamicCaptureResult.DynCaptCancel:v.print("Signature capture cancelled");break;case window.sdkPtr.DynamicCaptureResult.DynCaptPadError:v.print("No capture service available");break;case window.sdkPtr.DynamicCaptureResult.DynCaptError:v.print("Tablet Error");break;case window.sdkPtr.DynamicCaptureResult.DynCaptNotLicensed:v.print("No valid Signature Capture licence found");break;default:v.print("Capture Error "+S)}},v.onRenderBitmap=(q,Y,S)=>{if(v.callbackStatusOK("Signature Render Bitmap",S)){v.print("base64_image:>"+Y+"<"),v.HTMLTagIds.imageData="data:image/png;base64,"+Y;let Q=new Image;Q.src="data:image/png;base64,"+Y,console.log({imgValue:"data:image/png;base64,"+Y}),v.HTMLTagIds.emitValue("data:image/png;base64,"+Y),null==v.HTMLTagIds.imageBox.firstChild?v.HTMLTagIds.imageBox.appendChild(Q):v.HTMLTagIds.imageBox.replaceChild(Q,v.HTMLTagIds.imageBox.firstChild)}},v.onGetSigText=(q,Y,S)=>{v.callbackStatusOK("Signature Render Bitmap",S)&&(v.HTMLTagIds.textSig.value=Y,v.HTMLTagIds.imageText=Y)},v.GetHash=(q,Y)=>{v.callbackFunc=Y,v.print("Creating hash:"),q.Clear(v.onClear)},v.onClear=(q,Y)=>{v.callbackStatusOK("Hash Clear",Y)&&q.PutType(window.sdkPtr.HashType.HashMD5,v.onPutType)},v.onPutType=(q,Y)=>{if(v.callbackStatusOK("Hash PutType",Y)){var S=new window.sdkPtr.Variant;S.Set(v.HTMLTagIds.firstName.value),console.log({onPUtVname:S}),q.Add(S,v.onAddFname)}},v.onAddFname=(q,Y)=>{v.callbackStatusOK("Hash Add",Y)&&v.callbackFunc()},v.onAddLname=(q,Y)=>{v.callbackStatusOK("Hash Add",Y)&&v.callbackFunc()},v.\u0275fac=function(Y){return new(Y||v)},v.\u0275cmp=g.Xpm({type:v,selectors:[["btn-capture"]],inputs:{reason:"reason"},decls:1,vars:0,consts:[["type","button","value","Capture","title","Starts signature capture",2,"height","10mm","width","35mm",3,"click"]],template:function(Y,S){1&Y&&(g.TgZ(0,"input",0),g.NdJ("click",function(){return S.capturesig()}),g.qZA())},encapsulation:2})},98692:(pe,ne,E)=>{E.d(ne,{n:()=>e});var t=E(66274);let e=(()=>{class g{constructor(q){this.el=q}onKeyDown(q){let Y=q;if(this.OnlyNumber){if(-1!==[46,8,9,27,13,110].indexOf(Y.keyCode)||190==Y.keyCode&&!1===Y.shiftKey||65==Y.keyCode&&!0===Y.ctrlKey||67==Y.keyCode&&!0===Y.ctrlKey||88==Y.keyCode&&!0===Y.ctrlKey||Y.keyCode>=35&&Y.keyCode<=39)return;(Y.shiftKey||Y.keyCode<48||Y.keyCode>57)&&(Y.keyCode<96||Y.keyCode>105)&&Y.preventDefault()}}}return g.\u0275fac=function(q){return new(q||g)(t.Y36(t.SBq))},g.\u0275dir=t.lG2({type:g,selectors:[["","OnlyNumber",""]],hostBindings:function(q,Y){1&q&&t.NdJ("keydown",function(Q){return Y.onKeyDown(Q)})},inputs:{OnlyNumber:"OnlyNumber"}}),g})()},79700:(pe,ne,E)=>{E.d(ne,{w:()=>q});var t=E(42326),e=E(66274),g=E(87584),v=E(48083);let q=(()=>{class Y{constructor(Q,C){this._trnMainService=Q,this.router=C}transform(Q,C){return this.ShowProductInsertTableColumns(Q,C)}ShowProductInsertTableColumns(Q,C){var _=this._trnMainService.TrnMainObj.VoucherType;let B={};null!=this._trnMainService.TrnMainObj.ProdList&&(B=this._trnMainService.TrnMainObj.ProdList[C]);let U=!1;switch(Q){case"BATCH_HEADER":if(_===t.Km.ProductionEntry||(_===t.Km.StockIssue||_===t.Km.OpeningStockBalance||_===t.Km.StockIssueReturn||_===t.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableBatch)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking&&0===this._trnMainService.userSetting.EnableBatchWisePrice||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;((_===t.Km.BranchTransferOut||_===t.Km.OpeningStockBalance||_===t.Km.StockIssueReturn)&&2==this._trnMainService.userSetting.EnableBatch||(_===t.Km.PerformaSalesInvoice||_==t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===t.Km.Purchase||_===t.Km.OpeningStockBalance||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.TaxInvoice||_===t.Km.TaxInvoiceCancel||_===t.Km.CreditNote||_===t.Km.DebitNote)&&(U=!0);break;case"MENUCODE_HEADER":if(1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(_===t.Km.TaxInvoice||_===t.Km.CreditNote||_===t.Km.ReverseCreditNote||_===t.Km.Sales||_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation))return!1;(_===t.Km.Purchase||_===t.Km.ReversePurchase||_===t.Km.DebitNote||_===t.Km.OpeningStockBalance||_===t.Km.PurchaseOrder||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.SalesOrder||_==t.Km.BranchTransferIn||_==t.Km.BranchTransferOut||_==t.Km.GoodsReceived||_==t.Km.ProductionEntry||_==t.Km.Stockadjustment||_==t.Km.RequisitionApproval||_===t.Km.ReverseProductionEntry||_==t.Km.RequisitionEntry)&&(U=!0);break;case"BARCODE_HEADER":if(0==this._trnMainService.userSetting.GblBarcodeWiseBilling)return!1;(_===t.Km.TaxInvoice||_===t.Km.CreditNote||_===t.Km.ReverseCreditNote||_===t.Km.ReverseTaxInvoice||_===t.Km.Sales||_===t.Km.PerformaSalesInvoice||_==t.Km.CancelProforma||_==t.Km.StockIssue||_===t.Km.StockIssueReturn||_==t.Km.BranchTransferOut||_==t.Km.BranchTransferIn||_==t.Km.ProductionEntry||_==t.Km.DebitNote||_===t.Km.StockSettlement||_===t.Km.ReverseProductionEntry||_===t.Km.Quotation||_===t.Km.SalesOrder||_===t.Km.OpeningStockBalance||_===t.Km.RequisitionEntry)&&(U=!0);break;case"HS_CODE":if("self-billing"==this._trnMainService.activeurlpath)return!0;(_===t.Km.TaxInvoice||_===t.Km.CreditNote||_===t.Km.Sales||_===t.Km.ExportSalesInvoice)&&(U=!!this._trnMainService.userSetting.CompulsoryHSCodeInput);break;case"BATCH_EDITABLE":if(_===t.Km.ProductionEntry||(_===t.Km.StockIssue||_===t.Km.OpeningStockBalance||_===t.Km.StockIssueReturn||_===t.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableBatch)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking&&0===this._trnMainService.userSetting.EnableBatchWisePrice||"add-membership-sales-invoice"==this._trnMainService.activeurlpath||"StockSettlementEntry"==this._trnMainService.activeurlpath)return!1;if(((_===t.Km.StockIssue||_===t.Km.OpeningStockBalance||_===t.Km.StockIssueReturn||_===t.Km.BranchTransferOut)&&2==this._trnMainService.userSetting.EnableBatch||(_===t.Km.PerformaSalesInvoice||_==t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===t.Km.Sales||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.Purchase||_===t.Km.OpeningStockBalance||_===t.Km.DebitNote||_===t.Km.CreditNote||_===t.Km.ReverseCreditNote||_===t.Km.ReverseProductionEntry)&&(U=!0),(_===t.Km.StockIssue||_===t.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableProperExpTracking)return!0;((_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||_===t.Km.Sales||_===t.Km.StockSettlement||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.DebitNote||_===t.Km.CreditNote)&&(U=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(U=!0);break;case"BATCH_NONEDITABLE":((_===t.Km.OpeningStockBalance||_===t.Km.PerformaSalesInvoice||_===t.Km.Purchase||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.Quotation||_===t.Km.GoodsReceived)&&!1===B.inputMode||_===t.Km.CreditNote||_===t.Km.DebitNote||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"MFGDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===t.Km.OpeningStockBalance||_===t.Km.Purchase||_===t.Km.DebitNote||_===t.Km.PurchaseReturn||_===t.Km.ReversePurchase||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.GoodsReceived||_===t.Km.ProductionEntry||_===t.Km.BranchTransferIn||_===t.Km.Repack||_===t.Km.BranchTransferOut||_===t.Km.ReverseCreditNote||_===t.Km.ReverseProductionEntry)&&(U=!0);break;case"MFGDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(_===t.Km.Purchase||_===t.Km.OpeningStockBalance||_===t.Km.ReversePurchase||_===t.Km.StockIssueReturn||_===t.Km.GoodsReceived||_===t.Km.ProductionEntry||_===t.Km.BranchTransferIn||_===t.Km.Repack||_===t.Km.ReverseProductionEntry)&&(U=!0);break;case"MFGDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===t.Km.SalesReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseReturn||_===t.Km.DebitNote||_===t.Km.BranchTransferOut||_===t.Km.StockIssue)&&(U=!0);break;case"EXPDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.DebitNote||_===t.Km.TaxInvoice||_===t.Km.ReversePurchase||_===t.Km.SalesReturn||_===t.Km.StockIssueReturn||_===t.Km.StockIssue||_===t.Km.TaxInvoiceCancel||_===t.Km.CreditNote||_===t.Km.Purchase||_===t.Km.OpeningStockBalance||_===t.Km.GoodsReceived||_===t.Km.ProductionEntry||_===t.Km.BranchTransferIn||_===t.Km.Repack||_===t.Km.BranchTransferOut||_===t.Km.ReverseCreditNote||_===t.Km.ReverseProductionEntry)&&(U=!0);break;case"EXPDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(_===t.Km.Purchase||_===t.Km.OpeningStockBalance||_===t.Km.StockIssueReturn||_===t.Km.ReversePurchase||_===t.Km.GoodsReceived||_===t.Km.ProductionEntry||_===t.Km.BranchTransferIn||_===t.Km.Repack||_===t.Km.ReverseProductionEntry)&&(U=!0);break;case"EXPDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.DebitNote||_===t.Km.StockIssue||_===t.Km.BranchTransferOut||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseReturn||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.CreditNote||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"QUANTITY_EDITABLE":(_===t.Km.OpeningStockBalance||_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.PurchaseReturn||_===t.Km.ReversePurchase||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.StockSettlement||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.PurchaseOrder||_===t.Km.SalesOrder||_===t.Km.CreditNote||_===t.Km.DebitNote||_===t.Km.Purchase||_===t.Km.BranchTransferIn||_===t.Km.BranchTransferOut||_===t.Km.Quotation||_===t.Km.Repack||_===t.Km.RequisitionEntry||_===t.Km.GoodsReceived||_==t.Km.ProductionEntry||_==t.Km.BatchAdjustment||_===t.Km.ReverseCreditNote||_==t.Km.Stockadjustment||_===t.Km.RequisitionApproval||_===t.Km.ReverseProductionEntry)&&(U=!0);break;case"QUANTITY_NONEDITABLE":(_===t.Km.OpeningStockBalance||_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Purchase||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.StockIssueReturn||_===t.Km.StockSettlement||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.PurchaseOrder||_===t.Km.SalesOrder||_===t.Km.PurchaseOrderCancel||_===t.Km.CreditNote||_===t.Km.ReverseCreditNote||_===t.Km.DebitNote||_===t.Km.Quotation||_===t.Km.GoodsReceived||this._trnMainService.showPerformaApproveReject)&&!1===B.inputMode&&(U=!0);break;case"MRP_NONEDITABLE":default:U=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"GST_PER_NONEDITABLE_EXCLUSIVE_FOR_RETAILER":break;case"COSTPRICE_HEADER":_===t.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||_===t.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||_===t.Km.CreditNote||_===t.Km.OpeningStockBalance||_===t.Km.StockSettlement||_===t.Km.StockIssue||_===t.Km.ReverseCreditNote||_===t.Km.ReverseTaxInvoice||(U=!0);break;case"COSTPRICE2_NONEDITABLE":(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation||_===t.Km.Sales||_===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||_===t.Km.SalesReturn||_===t.Km.PurchaseOrderCancel||_===t.Km.SalesOrder)&&(U=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(_===t.Km.PurchaseOrder||_===t.Km.PurchaseOrderCancel||_===t.Km.SalesOrder||_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation||_===t.Km.Purchase||_===t.Km.PurchaseReturn||_===t.Km.DebitNote||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.GoodsReceived||_===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(U=!0);break;case"SELLINGPRICE2_NONEDITABLE":(_===t.Km.PurchaseOrder||_===t.Km.Purchase||_==t.Km.GoodsReceived)&&(U=!0);break;case"SELLING_HEADER":(_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation||_===t.Km.Purchase||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.GoodsReceived||_===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||_===t.Km.PurchaseOrder||_===t.Km.SalesOrder)&&(U=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(U=!1);(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.PurchaseReturn||_===t.Km.ReversePurchase||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.DebitNote||_===t.Km.CreditNote||_===t.Km.GoodsReceived||_===t.Km.SalesOrder||_===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(U=!1);(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.ReversePurchase||_===t.Km.SalesReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.DebitNote||_===t.Km.CreditNote||_===t.Km.GoodsReceived||_===t.Km.SalesOrder||_===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(U=!1);(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation||_===t.Km.PurchaseReturn||_===t.Km.ReversePurchase||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.TaxInvoiceCancel||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.DebitNote||_===t.Km.CreditNote||_===t.Km.GoodsReceived||_===t.Km.SalesOrder||_===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(U=!1);(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation||_===t.Km.PurchaseReturn||_===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_==t.Km.GoodsReceived||_===t.Km.Sales||_===t.Km.ReversePurchase||_===t.Km.SalesReturn||_===t.Km.DebitNote||_===t.Km.CreditNote||_===t.Km.SalesOrder||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":U=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":_===t.Km.OpeningStockBalance&&(U=!0);break;case"GST_PER_HEADER":(_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation||_===t.Km.Purchase||_===t.Km.GoodsReceived||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.TaxInvoice||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseOrder||_===t.Km.PurchaseOrderCancel||_===t.Km.SalesOrder)&&(U=!0);break;case"GST_PER_NONEDITABLE":(_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation||_===t.Km.Purchase||_===t.Km.GoodsReceived||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.TaxInvoice||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseOrder||_===t.Km.SalesOrder)&&(U=!0);break;case"GST_AMT_HEADER":(_===t.Km.PerformaSalesInvoice||_===t.Km.Quotation||_===t.Km.Purchase||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.SalesReturn||_===t.Km.StockIssue||_===t.Km.TaxInvoice||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseOrder||_===t.Km.PurchaseOrderCancel||_===t.Km.SalesOrder||_===t.Km.GoodsReceived)&&(U=!0);break;case"GST_AMT_NONEDITABLE":(_===t.Km.PerformaSalesInvoice||_===t.Km.CancelProforma||_===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.PurchaseReturn||_===t.Km.Sales||_===t.Km.ReversePurchase||_===t.Km.SalesReturn||_===t.Km.TaxInvoice||_===t.Km.ReverseTaxInvoice||_===t.Km.TaxInvoiceCancel||_===t.Km.PurchaseOrderCancel||_===t.Km.SalesOrder&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||_===t.Km.CreditNote||_===t.Km.DebitNote||_===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||_===t.Km.GoodsReceived||_===t.Km.ReverseCreditNote)&&(U=!0);break;case"UNIT_EDITABLE":U=_===t.Km.TaxInvoice||_===t.Km.Purchase||_===t.Km.GoodsReceived||_===t.Km.DebitNote||_===t.Km.Stockadjustment||_!=t.Km.Repack;break;case"UNIT_NONEDITABLE":(_===t.Km.CreditNote||_===t.Km.DebitNote||_===t.Km.ReverseCreditNote)&&(U=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(U=!0);break;case"CONFACTOR":this._trnMainService.userSetting.showConFactorInGrid&&(_===t.Km.BranchTransferOut||_===t.Km.BranchTransferIn||_===t.Km.RequisitionApproval&&0==this._trnMainService.userSetting.LogBasedRequisitionApproval)&&(U=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(U=!0);break;case"DISCOUNT_IMPORTPURCHASE":(_==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(U=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":(_==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||_==t.Km.TaxInvoice&&"export-sales-invoice"==this._trnMainService.activeurlpath)&&(U=!0);break;case"ECSAmount":"purchase-import"===this._trnMainService.activeurlpath||"goods-received-note-import"===this._trnMainService.activeurlpath||"export-sales-invoice"===this._trnMainService.activeurlpath?U=!1:1==this._trnMainService.userSetting.ENABLE_ECS?(_===t.Km.Purchase||_===t.Km.GoodsReceived||_==t.Km.DebitNote)&&(U=!0):2==this._trnMainService.userSetting.ENABLE_ECS?(_==t.Km.TaxInvoice||_==t.Km.CreditNote)&&(U=!0):3==this._trnMainService.userSetting.ENABLE_ECS&&(_===t.Km.Purchase||_===t.Km.GoodsReceived||_===t.Km.TaxInvoice||_==t.Km.CreditNote||_==t.Km.DebitNote)&&(U=!0)}return U}}return Y.\u0275fac=function(Q){return new(Q||Y)(e.Y36(g.p,16),e.Y36(v.F0,16))},Y.\u0275pipe=e.Yjl({name:"activeColumn",type:Y,pure:!0}),Y})()},63213:(pe,ne,E)=>{E.d(ne,{u:()=>q});var t=E(42326),e=E(66274),g=E(87584),v=E(48083);let q=(()=>{class Y{constructor(Q,C){this._trnMainService=Q,this.arouter=C,this.activeurlpath=C._routerState.snapshot.url.split("/").pop()}transform(Q){return console.log("field name",Q),this.disableFieldInTransaction(Q)}disableFieldInTransaction(Q){switch(Q){case"disableWareHouse":return(this._trnMainService.TrnMainObj.VoucherType==t.Km.TaxInvoice||"abbreviated-sales-invoice"==this._trnMainService.activeurlpath||"self-billing"==this._trnMainService.activeurlpath||"add-membership-sales-invoice"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==t.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType==t.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==t.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==t.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==t.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==t.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==t.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==t.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==t.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==t.Km.BatchAdjustment||"stockageing-report"==this.activeurlpath||"stock-issue-report"==this.activeurlpath||"stock-variance-report"==this.activeurlpath||"reorder-levelstock-report"==this.activeurlpath||"max-stocklevel-report"==this.activeurlpath||"minimum-stocklevel-report"==this.activeurlpath||"item-expiry-report"==this.activeurlpath||"stock-ledger-report"==this.activeurlpath||"stock-summary-report"==this.activeurlpath||"requisition-report"==this.activeurlpath||"openingstock-report"==this.activeurlpath)&&1==this._trnMainService.userSetting.UserWiseWarehouse;case"disableGridInMixedPurchase":return!!("VIEW"==this._trnMainService.TrnMainObj.Mode||1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.VoucherType==t.Km.DebitNote&&this._trnMainService.userSetting.REFBILLCOMPULSORINDNOTE)}}}return Y.\u0275fac=function(Q){return new(Q||Y)(e.Y36(g.p,16),e.Y36(v.gz,16))},Y.\u0275pipe=e.Yjl({name:"disableField",type:Y,pure:!0}),Y})()},62490:(pe,ne,E)=>{E.d(ne,{VO:()=>v,gB:()=>e});var t=E(66274);let e=(()=>{class q{transform(S,Q,C){return null==Q||null==Q||""==Q||null==C||null==C||""==C?S:C?S.filter(_=>null!=_[Q]&&null!=_[Q]&&-1!==_[Q].toLowerCase().indexOf(C.toLowerCase())):S}}return q.\u0275fac=function(S){return new(S||q)},q.\u0275pipe=t.Yjl({name:"filter",type:q,pure:!1}),q})(),v=(()=>{class q{transform(S,Q){let C=[];for(let _ in S)C.push(_);return C}}return q.\u0275fac=function(S){return new(S||q)},q.\u0275pipe=t.Yjl({name:"keys",type:q,pure:!0}),q})()},65171:(pe,ne,E)=>{E.d(ne,{j:()=>N});var t=E(66274),e=E(53074),g=E(87584),v=E(92752),q=E(7587),Y=E(28096);function S(f,w){1&f&&(t.TgZ(0,"th"),t._uU(1,"BATCHID"),t.qZA())}function Q(f,w){1&f&&(t.TgZ(0,"th"),t._uU(1,"Barcode"),t.qZA())}function C(f,w){1&f&&(t.TgZ(0,"th",11),t._uU(1,"S-Price(Exc VAT)"),t.qZA())}function _(f,w){1&f&&(t.TgZ(0,"th",11),t._uU(1,"S-Price(Inc VAT)"),t.qZA())}function B(f,w){if(1&f&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&f){const P=t.oxw().$implicit;t.xp6(1),t.Oqu(P.BATCHID)}}function U(f,w){if(1&f&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&f){const P=t.oxw().$implicit;t.xp6(1),t.Oqu(P.BC)}}function z(f,w){if(1&f&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&f){const P=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,P.SELLRATEBEFORETAX,"1.2-2"))}}function $(f,w){if(1&f&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&f){const P=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,P.MRP,"1.2-2"))}}function Z(f,w){if(1&f){const P=t.EpF();t.TgZ(0,"tr",14),t.NdJ("click",function(){const L=t.CHM(P).index,V=t.oxw();return t.KtG(V.RowClickEvent(L))})("dblclick",function(){const L=t.CHM(P).$implicit,V=t.oxw();return t.KtG(V.dblClickBatchObj(L))}),t.TgZ(1,"td",15),t._uU(2),t.qZA(),t.YNc(3,B,2,1,"td",16),t.TgZ(4,"td",17),t._uU(5),t.qZA(),t.YNc(6,U,2,1,"td",16),t.TgZ(7,"td",17),t._uU(8),t.qZA(),t.TgZ(9,"td",18),t._uU(10),t.ALo(11,"number"),t.qZA(),t.YNc(12,z,3,4,"td",19),t.YNc(13,$,3,4,"td",19),t.qZA()}if(2&f){const P=w.$implicit,O=w.index,I=t.oxw();t.ekj("selected-row",O===I.selectedRowIndex),t.xp6(2),t.Oqu(O+1),t.xp6(1),t.Q6J("ngIf",1==I._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(2),t.Oqu(P.BATCHCODE),t.xp6(1),t.Q6J("ngIf",1==I.HASVARIANT),t.xp6(2),t.Oqu(P.STOCK),t.xp6(2),t.Oqu(t.xi3(11,10,P.LANDINGCOST,"1.2-2")),t.xp6(2),t.Q6J("ngIf",89!=I._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89!=I._trnMainService.TrnMainObj.VoucherType)}}let N=(()=>{class f{constructor(P,O){this.masterRepo=P,this._trnMainService=O,this.Blist=[],this.BatchClosedEmit=new t.vpe,this.dbClickEvent=new t.vpe,this.showPopup=!1}ngOnInit(){console.log("batch popup shown",this.Blist)}RowClickEvent(P){this.selectedRowIndex=P}dblClickBatchObj(P){this.dbClickEvent.emit(P)}itemBatchClosed(){this.BatchClosedEmit.emit()}updown(P){null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===P.code?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>this.Blist.length-1&&(this.selectedRowIndex=this.Blist.length-1)):"ArrowUp"===P.code&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===P.code||"NumpadEnter"==P.code?null!=this.selectedRowIndex&&null!=this.Blist[this.selectedRowIndex]&&this.dblClickBatchObj(this.Blist[this.selectedRowIndex]):"Escape"===P.code&&this.itemBatchClosed()}}return f.\u0275fac=function(P){return new(P||f)(t.Y36(e.P),t.Y36(g.p))},f.\u0275cmp=t.Xpm({type:f,selectors:[["itemwisebatch"]],hostBindings:function(P,O){1&P&&t.NdJ("keydown",function(L){return O.updown(L)},!1,t.evT)},inputs:{Blist:"Blist",HASVARIANT:"HASVARIANT"},outputs:{BatchClosedEmit:"BatchClosedEmit",dbClickEvent:"dbClickEvent"},decls:27,vars:9,consts:[[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[2,"float","right"],["type","search","autocomplete","off","placeholder","Search..","name","filter","id","filter",2,"height","1.5rem","font-size","13px","width","755px",3,"ngModel","ngModelChange"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],[4,"ngIf"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["aria-disabled","true","class","highlight",3,"selected-row","click","dblclick",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight",3,"click","dblclick"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],["style","border-bottom: 1px solid #ddd;height: 23px;width:20%",4,"ngIf"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"],[2,"border-bottom","1px solid #ddd","height","23px","width","15%","text-align","right"],["style","border-bottom: 1px solid #ddd;height: 23px;width:15%;text-align: right;",4,"ngIf"]],template:function(P,O){1&P&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),t._uU(4,"Item Wise Batch List"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return O.itemBatchClosed()}),t.TgZ(6,"span",5),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"div",6)(9,"input",7),t.NdJ("ngModelChange",function(L){return O.filter=L}),t.qZA()(),t.TgZ(10,"table",8)(11,"tr",9)(12,"th"),t._uU(13,"Sn."),t.qZA(),t.YNc(14,S,2,0,"th",10),t.TgZ(15,"th"),t._uU(16,"BATCH"),t.qZA(),t.YNc(17,Q,2,0,"th",10),t.TgZ(18,"th"),t._uU(19,"STOCK"),t.qZA(),t.TgZ(20,"th",11),t._uU(21,"P-Rate"),t.qZA(),t.YNc(22,C,2,0,"th",12),t.YNc(23,_,2,0,"th",12),t.qZA(),t.TgZ(24,"tbody"),t.YNc(25,Z,14,13,"tr",13),t.ALo(26,"searchData"),t.qZA()()()()),2&P&&(t.xp6(9),t.Q6J("ngModel",O.filter),t.xp6(5),t.Q6J("ngIf",1==O._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(3),t.Q6J("ngIf",1==O.HASVARIANT),t.xp6(5),t.Q6J("ngIf",89!=O._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89!=O._trnMainService.TrnMainObj.VoucherType),t.xp6(2),t.Q6J("ngForOf",t.xi3(26,6,O.Blist,O.filter)))},dependencies:[v.sg,v.O5,q.Fj,q.JJ,q.On,v.JJ,Y.C],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }\n \n   .unitLabel[_ngcontent-%COMP%]{\n     width: auto;\n     font-size: 14px;\n     margin-left: 5px;\n   }"]}),f})()},82484:(pe,ne,E)=>{E.d(ne,{q:()=>Q});var t=E(66274),e=E(53074),g=E(87584),v=E(92752);function q(C,_){if(1&C){const B=t.EpF();t.TgZ(0,"tr",12),t.NdJ("dblclick",function(){const $=t.CHM(B).$implicit,Z=t.oxw(2);return t.KtG(Z.doubleClick($))})("click",function(){const $=t.CHM(B).index,Z=t.oxw(2);return t.KtG(Z.singleClick($))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&C){const B=_.$implicit,U=_.index,z=t.oxw(2);t.ekj("selected-row",z.selectedRowIndex==U),t.xp6(2),t.hij("",B.DESCA," "),t.xp6(2),t.hij("",B.MENUCODE," "),t.xp6(2),t.hij("",B.STOCK," "),t.xp6(2),t.hij("",B.MRP," ")}}function Y(C,_){if(1&C&&(t.TgZ(0,"tbody"),t.YNc(1,q,9,6,"tr",11),t.qZA()),2&C){const B=t.oxw();t.xp6(1),t.Q6J("ngForOf",B._trnMainService.ItemsListForMultiItemBarcode)}}function S(C,_){if(1&C&&t._UZ(0,"div",13),2&C){const B=t.oxw();t.Q6J("innerHTML",B.summary,t.oJD)}}let Q=(()=>{class C{constructor(B,U){this.masterService=B,this._trnMainService=U,this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){}hide(){this.masterService.PlistTitle=""}doubleClick(B){this.masterService.masterPostmethod("/getbatchWithAlternateUnitList",B).subscribe(U=>{if("ok"==U.status){let z=JSON.parse(U.result),$=this._trnMainService.TrnMainObj.ProdList.findIndex(Z=>Z.MCODE==z.MCODE);if($<0)this._trnMainService.addRow(),this._trnMainService.assignValueToProdFromBarcode(z,this._trnMainService.TrnMainObj.ProdList.findIndex(Z=>null==Z.MCODE));else{let Z=this._trnMainService.TrnMainObj.ProdList[$];this._trnMainService.TrnMainObj.ProdList[$].Quantity+=1,this._trnMainService.RealQuantitySet($,Z.CONFACTOR),this._trnMainService.ReCalculateBillWithNormal()}this.masterService.PlistTitle="",document.getElementById("itembarcode").focus()}else alert(U.result)},()=>{})}singleClick(B){this.selectedRowIndex=B,this.summary=this._trnMainService.ItemsListForMultiItemBarcode[B].itemSummary}updown(B){"ArrowDown"==B.code&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length-1?(B.preventDefault(),this.selectedRowIndex++,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"ArrowUp"==B.code&&this.selectedRowIndex-1>-1?(B.preventDefault(),this.selectedRowIndex--,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"Enter"==B.code&&this.selectedRowIndex>=0&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length?(B.preventDefault(),this.doubleClick(this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]),this.hide()):"Escape"==B.code&&(B.preventDefault(),this.hide())}}return C.\u0275fac=function(B){return new(B||C)(t.Y36(e.P),t.Y36(g.p))},C.\u0275cmp=t.Xpm({type:C,selectors:[["PItemList"]],hostBindings:function(B,U){1&B&&t.NdJ("keydown",function($){return U.updown($)},!1,t.evT)},decls:24,vars:2,consts:[[1,"modal-sticky",2,"display","block","padding","0px","height","400px","margin-bottom","60px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#7ed0ff"],[4,"ngIf"],["style","margin-left: 25px ",3,"innerHTML",4,"ngIf"],["class","highlight","title","double click for detail view",3,"selected-row","dblclick","click",4,"ngFor","ngForOf"],["title","double click for detail view",1,"highlight",3,"dblclick","click"],[2,"margin-left","25px",3,"innerHTML"]],template:function(B,U){1&B&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div")(4,"div",2)(5,"button",3),t.NdJ("click",function(){return U.hide()}),t.TgZ(6,"span",4),t._uU(7,"\xd7"),t.qZA()(),t.TgZ(8,"h4",5),t._uU(9," ITEMS "),t.qZA()(),t.TgZ(10,"div",6)(11,"table",7)(12,"thead")(13,"tr",8)(14,"th"),t._uU(15," DESCRIPTION"),t.qZA(),t.TgZ(16,"th"),t._uU(17," CODE"),t.qZA(),t.TgZ(18,"th"),t._uU(19," STOCK"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"MRP"),t.qZA()()(),t.YNc(22,Y,2,1,"tbody",9),t.qZA()()(),t.YNc(23,S,1,1,"div",10),t.qZA()()()),2&B&&(t.xp6(22),t.Q6J("ngIf",U._trnMainService.ItemsListForMultiItemBarcode.length),t.xp6(1),t.Q6J("ngIf",U.summary))},dependencies:[v.sg,v.O5],styles:[".modal-content[_ngcontent-%COMP%] {\n          padding: 1px;\n          margin: 0px;\n          float: right;\n        }\n        .table-scroll[_ngcontent-%COMP%] {\n          overflow-y: scroll;\n          overflow-x: hidden;\n        }\n      \n        tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n          background-color: #f3f5f4;\n          cursor: pointer;\n        }\n        tr[_ngcontent-%COMP%] {\n          font-size: 11px;\n        }\n        .selected-row[_ngcontent-%COMP%] {\n          background-color: #ced6d3 !important;\n        }\n      \n        .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n          text-align: left !important;\n          padding: 0px 0px 0px 11px !important;\n        } \n      \n        .modal-content[_ngcontent-%COMP%]{\n          box-shadow: -10px 0px 10px 1px #aaaaaa;\n        }\n      \n        .modal-content-main-area[_ngcontent-%COMP%] { \n          max-height: 100%;\n          height: 100%;\n          overflow: auto;\n          overflow-x: hidden;\n        } \n      \n        .modal-content-summary-area[_ngcontent-%COMP%] {\n          max-height: 20%;\n          height: 20%;\n          overflow: auto;\n          overflow-x: hidden;\n        }"]}),C})()},59963:(pe,ne,E)=>{E.d(ne,{H:()=>Q});var t=E(66274),e=E(53074),g=E(92752),v=E(7587),q=E(62490);const Y=["inputBox"];function S(C,_){if(1&C){const B=t.EpF();t.TgZ(0,"tbody",12),t.NdJ("dblclick",function(){const z=t.CHM(B),$=z.$implicit,Z=z.index,N=t.oxw();return t.KtG(N.dblClickItemList($,Z))}),t.TgZ(1,"tr",13)(2,"td",14),t._uU(3),t.qZA(),t.TgZ(4,"td",15),t._uU(5),t.qZA(),t.TgZ(6,"td",15),t._uU(7),t.qZA(),t.TgZ(8,"td",15),t._uU(9),t.qZA()()()}if(2&C){const B=_.$implicit,U=_.index,z=t.oxw();t.ekj("highlighted",U===z.selectedRowIndex),t.xp6(3),t.Oqu(B.ACNAME),t.xp6(2),t.Oqu(B.ACCODE),t.xp6(2),t.Oqu(B.ADDRESS),t.xp6(2),t.Oqu(B.EMAIL)}}let Q=(()=>{class C{constructor(B){this.masterService=B,this.dbClickEvent=new t.vpe,this.partyCloseClick=new t.vpe,this.partyList=[],this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){setTimeout(()=>{this.setFocus()},50)}SearchList(B){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(B,U){this.selectedRowIndex=U,this.dbClickEvent.emit(B)}partyPopClosed(){this.partyCloseClick.emit()}onKeydown(B){return this.setFocus(),null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===B.key?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>9&&(this.selectedRowIndex=9)):"ArrowUp"===B.key&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===B.key?(null!=this.selectedRowIndex&&null!=this.partyList[this.selectedRowIndex]&&this.dblClickItemList(this.partyList[this.selectedRowIndex],this.selectedRowIndex),!1):"Delete"===B.key?(this.partyPopClosed(),!1):void 0}}return C.\u0275fac=function(B){return new(B||C)(t.Y36(e.P))},C.\u0275cmp=t.Xpm({type:C,selectors:[["popPartyChoose"]],viewQuery:function(B,U){if(1&B&&t.Gf(Y,5),2&B){let z;t.iGM(z=t.CRH())&&(U._el=z.first)}},inputs:{partyList:"partyList"},outputs:{dbClickEvent:"dbClickEvent",partyCloseClick:"partyCloseClick"},decls:24,vars:6,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],["type","text","id","partysearchpopup","autofocus","",2,"width","100%","/* padding","1px","*/padding-left","0px","margin-left","-13px",3,"ngModel","ngModelChange","keydown"],["inputBox",""],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"highlighted","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(B,U){1&B&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),t.NdJ("click",function(){return U.partyPopClosed()}),t.TgZ(4,"span",3),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",4),t._uU(7),t.qZA()(),t.TgZ(8,"div",5)(9,"input",6,7),t.NdJ("ngModelChange",function($){return U.filter=$})("keydown",function($){return U.onKeydown($)}),t.qZA()(),t.TgZ(11,"div",5)(12,"table",8)(13,"tr",9)(14,"th",10),t._uU(15,"Name"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Code"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Address"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Email"),t.qZA()(),t.YNc(22,S,10,6,"tbody",11),t.ALo(23,"filter"),t.qZA()()()()),2&B&&(t.xp6(7),t.Oqu(U.masterService.partyPopUpHeaderText),t.xp6(2),t.Q6J("ngModel",U.filter),t.xp6(13),t.Q6J("ngForOf",t.xi3(23,3,U.partyList,U.filter)))},dependencies:[g.sg,v.Fj,v.JJ,v.On,q.gB],encapsulation:2}),C})()},86857:(pe,ne,E)=>{E.d(ne,{l:()=>Q});var t=E(66274),e=E(67311),g=E(92752),v=E(7587);function q(C,_){if(1&C){const B=t.EpF();t.TgZ(0,"tr",18),t.NdJ("click",function(){const $=t.CHM(B).index,Z=t.oxw(3);return t.KtG(Z.SELECTEDINDEX=$)}),t.TgZ(1,"th",15)(2,"input",19),t.NdJ("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.BATCH=z)}),t.qZA()(),t.TgZ(3,"th",15)(4,"input",20),t.NdJ("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.ALTUNIT=z)}),t.qZA()(),t.TgZ(5,"th",15)(6,"input",21),t.NdJ("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.INVOICEQTYA=z)}),t.qZA()(),t.TgZ(7,"th",15)(8,"input",21),t.NdJ("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.TOTALOUTWARDSTOCKA=z)}),t.qZA()(),t.TgZ(9,"th",15)(10,"input",21),t.NdJ("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.EDITABLEQTYA=z)}),t.qZA()(),t.TgZ(11,"th",15)(12,"input",22),t.NdJ("change",function(){const $=t.CHM(B).index,Z=t.oxw(3);return t.KtG(Z.onChangeAdjustQty($))})("ngModelChange",function(z){const Z=t.CHM(B).$implicit;return t.KtG(Z.ADJUSTQTY=z)}),t.qZA()()()}if(2&C){const B=_.$implicit,U=_.index;t.xp6(2),t.MGl("id","batch",U,""),t.Q6J("disabled",!0)("ngModel",B.BATCH),t.xp6(2),t.MGl("id","altunit",U,""),t.Q6J("disabled",!0)("ngModel",B.ALTUNIT),t.xp6(2),t.MGl("id","invoiceqty",U,""),t.Q6J("disabled",!0)("ngModel",B.INVOICEQTYA),t.xp6(2),t.MGl("id","invoiceqty",U,""),t.Q6J("disabled",!0)("ngModel",B.TOTALOUTWARDSTOCKA),t.xp6(2),t.MGl("id","invoiceqty",U,""),t.Q6J("disabled",!0)("ngModel",B.EDITABLEQTYA),t.xp6(2),t.MGl("id","adjustQty",U,""),t.Q6J("disabled",B.isDisabled)("ngModel",B.ADJUSTQTY)}}function Y(C,_){if(1&C&&(t.TgZ(0,"div",11)(1,"table",12,13)(3,"thead")(4,"tr",14)(5,"th",15),t._uU(6,"Batch"),t.qZA(),t.TgZ(7,"th",15),t._uU(8,"Unit"),t.qZA(),t.TgZ(9,"th",15),t._uU(10,"Issue Qty"),t.qZA(),t.TgZ(11,"th",15),t._uU(12,"Transaction Qty"),t.qZA(),t.TgZ(13,"th",15),t._uU(14,"Editable Qty"),t.qZA(),t.TgZ(15,"th",15),t._uU(16,"Edit Qty"),t.qZA()()(),t.TgZ(17,"tbody",16),t.YNc(18,q,13,18,"tr",17),t.qZA()()()),2&C){const B=t.oxw(2);t.xp6(18),t.Q6J("ngForOf",B.BatchWiseEditList)}}function S(C,_){if(1&C){const B=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),t.NdJ("click",function(){t.CHM(B);const z=t.oxw();return t.KtG(z.hide())}),t.TgZ(4,"span",5),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",6),t._uU(7),t.qZA()(),t.YNc(8,Y,19,1,"div",7),t.TgZ(9,"div",8)(10,"button",9),t.NdJ("click",function(){t.CHM(B);const z=t.oxw();return t.KtG(z.okClicked())}),t._uU(11,"Apply"),t.qZA(),t.TgZ(12,"button",10),t.NdJ("click",function(){t.CHM(B);const z=t.oxw();return t.KtG(z.hide())}),t._uU(13,"cancel"),t.qZA()()()()}if(2&C){const B=t.oxw();t.ekj("modal-sticky-hide",!B.isActive),t.xp6(7),t.hij(" ",B.itemname," "),t.xp6(1),t.Q6J("ngIf",B.BatchWiseEditList&&B.BatchWiseEditList.length)}}let Q=(()=>{class C{constructor(B){this.alertService=B,this.itemname="",this.isActive=!1,this.keys=[],this.headerKeys=[],this.matrixItemRows=[],this.SELECTEDINDEX=0,this.onApplyClicked=new t.vpe,this.addRows=U=>{},this.onAttributeChange=(U,z)=>{let $=this.keys.findIndex(f=>f==U),Z=[];for(var N in Z=$>-1?this.keys.slice($+1):this.keys,Z)if(document.getElementById(Z[N]+z))return void setTimeout(()=>document.getElementById(Z[N]+z).focus())},this.okClicked=()=>{this.validateEditedQty()&&(this.onApplyClicked.emit(this.BatchWiseEditList),this.hide())},this.show=()=>{this.isActive=!0,setTimeout(()=>{this.onAttributeChange("NONE",0)},0)},this.hide=()=>{this.isActive=!1,this.keys=[],this.matrixItemRows=[]},this.calculateUnitWiseQty()}ngOnInit(){}calculateUnitWiseQty(){console.log("new",this.BatchWiseEditList)}ngOnChanges(B){this.BatchWiseEditList=B.BatchWiseEditList.currentValue,this.BatchWiseEditList&&this.BatchWiseEditList.length&&(this.BatchWiseEditList=this.BatchWiseEditList.filter(U=>U.INVOICEQTY>0),this.BatchWiseEditList.forEach(U=>{U.INVOICEQTY-U.TOTALOUTWARDSTOCK==0&&(U.ADJUSTQTY=U.INVOICEQTY,U.isDisabled=!0)}))}onChangeAdjustQty(B){this.BatchWiseEditList[B].ADJUSTQTY<this.BatchWiseEditList[B].TOTALOUTWARDSTOCK&&this.alertService.info("Quantity Exceed the transaction stock")}validateEditedQty(){return!0}}return C.\u0275fac=function(B){return new(B||C)(t.Y36(e.c))},C.\u0275cmp=t.Xpm({type:C,selectors:[["batch-wise-item-edit"]],inputs:{itemname:"itemname",BatchWiseEditList:"BatchWiseEditList"},outputs:{onApplyClicked:"onApplyClicked"},features:[t.TTD],decls:1,vars:1,consts:[["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;",3,"modal-sticky-hide",4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#ecad79"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],["class","modal-body","style","max-height: 63vh;overflow-y: auto;",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-info","pull-right",3,"click"],[1,"btn","btn-info","pull-right",2,"margin-right","5px",3,"click"],[1,"modal-body",2,"max-height","63vh","overflow-y","auto"],["id","BlueHeaderResizableTable",1,"matrix-table",2,"font-size","12px","width","98%","overflow-x","auto"],["reportHtmlTable",""],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["width","100px"],[2,"width","fit-content"],["style","border: 1px solid #e6e6e6; max-height: 25px",3,"click",4,"ngFor","ngForOf"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click"],["type","text","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","text","name","altunit",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","change","ngModelChange"]],template:function(B,U){1&B&&t.YNc(0,S,14,4,"div",0),2&B&&t.Q6J("ngIf",U.isActive)},dependencies:[g.sg,g.O5,v.Fj,v.wV,v.JJ,v.On],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content-main-area[_ngcontent-%COMP%]{height:75vh!important}.modal-sticky[_ngcontent-%COMP%]{width:70vw im!important}tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{background-color:#f3f5f4;cursor:pointer}tr[_ngcontent-%COMP%]{font-size:11px}.selected-row[_ngcontent-%COMP%]{background-color:#ced6d3!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{line-height:30px!important}.table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{line-height:5px!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important;padding:0 0 0 11px!important}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.modal-content-main-area[_ngcontent-%COMP%]{max-height:100%;height:100%;width:100%!important}.modal-content-summary-area[_ngcontent-%COMP%]{max-height:20%;height:20%;overflow:auto;overflow-x:hidden}.ellipsis[_ngcontent-%COMP%]{white-space:nowrap}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#CED6D3;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{height:30px;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   .borderdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15)}.matrix-table[_ngcontent-%COMP%]   .rowdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15);text-align:center}.matrix-table[_ngcontent-%COMP%]   .smalllabeldiv[_ngcontent-%COMP%]{height:16px}.matrix-table[_ngcontent-%COMP%]   .smallHeader[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0}.matrix-table[_ngcontent-%COMP%]   .scrolldiv[_ngcontent-%COMP%]{max-height:75px;padding-right:30px;overflow:auto;scrollbar-3dlight-color:#FFFFFF;scrollbar-arrow-color:#000000;scrollbar-base-color:#FF9999;scrollbar-darkshadow-color:#000000;scrollbar-face-color:#000000;scrollbar-highlight-color:#000000;scrollbar-shadow-color:#0033CC}.matrix-table[_ngcontent-%COMP%]   .multiboxspan[_ngcontent-%COMP%]{font-size:11px;font-weight:700;position:relative;float:left;display:block;margin:2px;border:1px solid silver;border-radius:5px;background-color:#fff0f5}.matrix-table[_ngcontent-%COMP%]   .smallBoldLabel[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0;float:left;color:#222}.matrix-table[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:77vh}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:95%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{flex:0 0 auto;width:calc(100% - .9em)}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{flex:1 1 auto;display:block;overflow-y:scroll}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{width:99.6%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;table-layout:fixed}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#deb887!important;color:#fff}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f2f2f2}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#fff}.matrix-table[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#222;width:auto}.matrix-table[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]{margin-bottom:1%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]{margin-top:10%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:600;font-size:15px;padding:0 5px}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{height:25px!important;padding:0 5px!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{overflow:hidden}"]}),C})()},11728:(pe,ne,E)=>{E.d(ne,{q:()=>f});var t=E(66274),e=E(5881),g=E(92886),v=E(67311),q=E(14970),Y=E(87584),S=E(53074),Q=E(46241),C=E(7587);let _=(()=>{class w{clearSignature(){w.clearSignature()}static onClearSig(O,I){window.sdkPtr.ResponseStatus.OK!=I&&(Q.SigCapture.print("ClearSignature() error: "+I),window.sdkPtr.ResponseStatus.INVALID_SESSION==I&&(Q.SigCapture.print("Session error. Restarting the session."),e.SessionControl.actionWhenRestarted()))}}return w.clearSignature=()=>{null!=Q.SigCapture.HTMLTagIds.imageBox.firstChild&&Q.SigCapture.HTMLTagIds.imageBox.removeChild(Q.SigCapture.HTMLTagIds.imageBox.firstChild),null!=Q.SigCapture.sigObj?Q.SigCapture.sigObj.Clear(w.onClearSig):e.SessionControl.actionWhenRestarted()},w.\u0275fac=function(O){return new(O||w)},w.\u0275cmp=t.Xpm({type:w,selectors:[["btn-clear"]],decls:1,vars:0,consts:[["type","button","value","Clear","title","Clears the signature",2,"height","10mm","width","35mm",3,"click"]],template:function(O,I){1&O&&(t.TgZ(0,"input",0),t.NdJ("click",function(){return I.clearSignature()}),t.qZA())},encapsulation:2}),w})();var B=E(92752);function U(w,P){1&w&&(t.TgZ(0,"td",10),t._UZ(1,"btn-capture"),t.qZA())}function z(w,P){1&w&&(t.TgZ(0,"td",10),t._UZ(1,"btn-clear"),t.qZA())}function $(w,P){if(1&w){const O=t.EpF();t.TgZ(0,"td",10)(1,"input",11),t.NdJ("click",function(){t.CHM(O);const L=t.oxw();return t.KtG(L.onSaveClick())}),t.qZA()()}}let Z=(()=>{class w{constructor(O){this._trnMainService=O,this.firstName="",this.lastName="",this.reason="Inventory Assign Approval",this.onImageCaptured=new t.vpe}ngOnChanges(){}ngAfterViewInit(){e.SessionControl.actionWhenRestarted()}onSaveClick(){e.SessionControl.actionWhenRestarted(),Q.SigCapture.HTMLTagIds.getImageString$().subscribe(O=>{this.onImageCaptured.emit(O)})}}return w.\u0275fac=function(O){return new(O||w)(t.Y36(Y.p))},w.\u0275cmp=t.Xpm({type:w,selectors:[["signature-pad"]],inputs:{firstName:"firstName",lastName:"lastName",reason:"reason"},outputs:{onImageCaptured:"onImageCaptured"},features:[t.TTD],decls:16,vars:5,consts:[[2,"width","100%"],[1,"col-md-12","row","pd0","mb-3","mt-3"],[1,"col-md-10","pd0"],[2,"width","25%"],["id","fname","type","text","autocomplete","off","placeholder","Enter First Name","readonly","",2,"width","50%",3,"ngModel","value","ngModelChange"],[1,"mb-4"],["rowspan","3"],["id","imageBox","ondblclick","displaySignatureDetails(sigObj)","title","Double-click a signature to display its details",1,"boxed",2,"height","45mm","width","70mm","border","1px solid #d3d3d3"],["style","padding: 10px 20px;",4,"ngIf"],["style","padding: 10px 20px",4,"ngIf"],[2,"padding","10px 20px"],["type","button","value","Save",2,"height","10mm","width","35mm",3,"click"]],template:function(O,I){1&O&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),t._uU(4,"From Warehouse :"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(V){return I.firstName=V}),t.qZA()()(),t.TgZ(6,"table",5)(7,"tr")(8,"td",6),t._UZ(9,"div",7),t.qZA(),t.YNc(10,U,2,0,"td",8),t.qZA(),t.TgZ(11,"tr"),t.YNc(12,z,2,0,"td",8),t.qZA(),t.TgZ(13,"tr"),t.YNc(14,$,2,0,"td",9),t.qZA(),t._UZ(15,"tr"),t.qZA()()),2&O&&(t.xp6(5),t.Q6J("ngModel",I.firstName)("value",I.firstName),t.xp6(5),t.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode),t.xp6(2),t.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode),t.xp6(2),t.Q6J("ngIf","VIEW"!=I._trnMainService.TrnMainObj.Mode))},dependencies:[C.Fj,C.JJ,C.On,_,Q.SigCapture,B.O5],encapsulation:2}),w})();const N=["fileSelect"];let f=(()=>{class w{constructor(O,I,L,V,F){this.digitalSignatureService=O,this.alertService=I,this.loadingService=L,this._trnMainService=V,this.masterService=F,this.selectedFileNames=[],this.isActive=!1,this.dragging=!1,this.doUploadFile=!0,this.onPopUpClose=new t.vpe,this.onSaveImageCaptured=new t.vpe}onDragOver(O){this.dragging=!0,O.preventDefault()}show(O,I){this.isActive=!0;let L=document.getElementById("imageBox");e.SessionControl.actionWhenRestarted();let V=new Image;"VIEW"==I&&O&&(V.src=O,L.appendChild(V))}hide(){this.isActive=!1}popupClose(){this.onPopUpClose.emit(),this.hide()}ngOnChanges(O){}onImageCaptured(O){O&&(this.onSaveImageCaptured.emit(O),this.hide())}}return w.\u0275fac=function(O){return new(O||w)(t.Y36(g.M),t.Y36(v.c),t.Y36(q.V),t.Y36(Y.p),t.Y36(S.P))},w.\u0275cmp=t.Xpm({type:w,selectors:[["digital-signature-popup"]],viewQuery:function(O,I){if(1&O&&t.Gf(N,5),2&O){let L;t.iGM(L=t.CRH())&&(I.fileSelect=L.first)}},outputs:{onPopUpClose:"onPopUpClose",onSaveImageCaptured:"onSaveImageCaptured"},features:[t.TTD],decls:11,vars:3,consts:[[1,"modal-sticky",2,"display","block","padding","0px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"text-align","center"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"upload-area","container"],["lastName","","reason","document app",3,"firstName","onImageCaptured"]],template:function(O,I){1&O&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"h5",3),t._uU(5," Digital Signature "),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return I.popupClose()}),t.TgZ(7,"span",5),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",6)(10,"signature-pad",7),t.NdJ("onImageCaptured",function(V){return I.onImageCaptured(V)}),t.qZA()()()()()),2&O&&(t.ekj("modal-sticky-hide",!I.isActive),t.xp6(10),t.Q6J("firstName",I._trnMainService.TrnMainObj.BILLTO))},dependencies:[Z],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.form-control[_ngcontent-%COMP%]{height:35px}.modal-sticky[_ngcontent-%COMP%]{position:fixed;top:330px;right:20px;width:40%;z-index:9999999}"]}),w})()},14173:(pe,ne,E)=>{E.d(ne,{l:()=>S});var t=E(66274),e=E(53074),g=E(87584),v=E(67311),q=E(7587),Y=E(92752);let S=(()=>{class Q{constructor(_,B,U){this.masterService=_,this._trnMainService=B,this.alertService=U,this.isActive=!1,this.petval={}}ngOnInit(){}show(_,B){console.log("SHOW",_,B),this.isActive=!0,this.petval.rate=_,this.indexRow=B}cancel(){this.isActive=!1,setTimeout(()=>{this.masterService.focusAnyControl("alternateQty"+this.indexRow)},50)}hide(){this.isActive=!1,console.log("INDEX",this.indexRow+1),setTimeout(()=>{this.masterService.focusAnyControl("itemDesc"+(this.indexRow+1))},50)}quant(_,B){this._trnMainService.PetrolQuant=_/B}OnSubmit(){this._trnMainService.TrnMainObj.ProdList[this.indexRow].ALTERNATEQUANTIY=this._trnMainService.PetrolQuant,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.addRow(),this.petval.amount=null,this._trnMainService.PetrolQuant=null,this.hide()}handleKeyDown(_){_.preventDefault(),this.cancel()}}return Q.\u0275fac=function(_){return new(_||Q)(t.Y36(e.P),t.Y36(g.p),t.Y36(v.c))},Q.\u0275cmp=t.Xpm({type:Q,selectors:[["popup-petrol"]],hostBindings:function(_,B){1&_&&t.NdJ("keydown.esc",function(z){return B.handleKeyDown(z)},!1,t.Jf7)},decls:31,vars:8,consts:[[1,"modal-sticky"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body",2,"margin","10px"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-md-3","form-control-label"],[1,"col-md-8"],["id","modalquant","type","number",2,"width","100%",3,"ngModel","ngModelChange","keydown.enter"],["type","text",2,"width","100%",3,"ngModel"],["type","text","readonly","",2,"width","100%",3,"ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-info","TopMargin",2,"width","80px",3,"click"],["type","button",1,"btn","btn-info","TopMargin",2,"margin-right","10px",3,"click"]],template:function(_,B){1&_&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),t._uU(4,"Calculation"),t.qZA(),t.TgZ(5,"div",4)(6,"button",5),t.NdJ("click",function(){return B.hide()}),t.TgZ(7,"span",6),t._uU(8,"\xd7"),t.qZA()()()(),t.TgZ(9,"div",7)(10,"div",8)(11,"label",9),t._uU(12,"Amount:"),t.qZA(),t.TgZ(13,"div",10)(14,"input",11),t.NdJ("ngModelChange",function(z){return B.petval.amount=z})("ngModelChange",function(){return B.quant(B.petval.amount,B.petval.rate)})("keydown.enter",function(){return B.OnSubmit()}),t.qZA()()(),t.TgZ(15,"div",8)(16,"label",9),t._uU(17,"Rate:"),t.qZA(),t.TgZ(18,"div",10),t._UZ(19,"input",12),t.qZA()(),t.TgZ(20,"div",8)(21,"label",9),t._uU(22,"Quantity:"),t.qZA(),t.TgZ(23,"div",10),t._UZ(24,"input",13),t.ALo(25,"number"),t.qZA()(),t.TgZ(26,"div",14)(27,"button",15),t.NdJ("click",function(){return B.OnSubmit()}),t._uU(28,"Submit"),t.qZA(),t.TgZ(29,"button",16),t.NdJ("click",function(){return B.hide()}),t._uU(30,"Cancel"),t.qZA()()()()()),2&_&&(t.ekj("modal-sticky-hide",!B.isActive),t.xp6(14),t.Q6J("ngModel",B.petval.amount),t.xp6(5),t.Q6J("ngModel",B.petval.rate),t.xp6(5),t.Q6J("ngModel",t.xi3(25,5,B._trnMainService.PetrolQuant,"1.0-3")))},dependencies:[q.Fj,q.wV,q.JJ,q.On,Y.JJ],styles:[".modal-sticky[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:20%;top:25%;left:60%;height:40%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000;margin-left:-8%}.model-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.modal-body[_ngcontent-%COMP%]{line-height:.4rem;padding:5px}.modal-header[_ngcontent-%COMP%]{padding:5px 3px;background:#7ed0ff}.modal-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:11vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}th[_ngcontent-%COMP%]{font-size:14px}td[_ngcontent-%COMP%]{font-size:13px}"]}),Q})()}}]);