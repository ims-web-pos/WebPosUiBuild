"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[2310],{18488:(G,f,a)=>{a.d(f,{G:()=>A});var u=a(17545),y=a(8929),v=a(26320),k=a(70477),x=a(67297),I=a(71180);let A=(()=>{class S{constructor(l,g,M,d){this.http=l,this.activatedRoute=g,this.authService=M,this.state=d;const p=this.state.getGlobalSetting("apiUrl");p&&p.length>0&&(this.apiUrl=p)}getRequestOption(){return new u.WM({"Content-type":"application/csv",Authorization:this.authService.getAuth().token,"X-Requested-With":"XMLHttpRequest"})}RequestOptionForCSV(){return{headers:new u.WM({Authorization:this.authService.getAuth().token})}}downloadSampleFile(l,g="download"){return this.http.get(this.apiUrl+`${l}`,{headers:this.getRequestOption(),responseType:"blob"})}downloadSampleExcelforPIImport(l){return this.http.post(this.apiUrl+"/downloadSampleExcelforPIImport",l,{responseType:"blob"})}importSelectedFiles(l,g){let M={status:"error",result:"error"},d=new y.xQ;return this.http.post(this.apiUrl+`${l}`,g).subscribe(p=>{d.next(p),d.unsubscribe()},p=>{M.status="error",M.result=p,d.next(M),d.unsubscribe()}),d}}return S.\u0275fac=function(l){return new(l||S)(v.LFG(u.eN),v.LFG(k.gz),v.LFG(x.e),v.LFG(I.q))},S.\u0275prov=v.Yz7({token:S,factory:S.\u0275fac}),S})()},35514:(G,f,a)=>{a.r(f),a.d(f,{ManualStockEntryModule:()=>bt});var u=a(1298),y=a(70489),v=a(82738),k=a(46543),x=a(68567),I=a(44841),A=a(59629),S=a(88465),N=a(55618),l=a(70477),g=a(28698),M=a(60716),d=a(68328),p=a(42326),t=a(26320),J=a(53074),h=a(81152),P=a(17545),O=a(8929),Z=a(67297),Q=a(71180);let E=(()=>{class r{constructor(e,i,n,o){this.http=e,this.activatedRoute=i,this.authService=n,this.state=o,this.userProfile={};const s=this.state.getGlobalSetting("apiUrl");s&&s.length>0&&(this.apiUrl=s),this.userProfile=n.getUserProfile()}deleteManualStockEntry(e,i){return this.http.post(this.apiUrl+`/deleteManualStockEntry?TNO=${e}&division=${i}`,"")}getEntryNumber(){return this.http.get(this.apiUrl+"/getManualStockID")}getBatchNumber(e,i){return this.http.get("close"==i?this.apiUrl+`/getManualStockBatchList?mode=${i}&division=${e}`:this.apiUrl+`/getManualStockBatchList?division=${e}`)}getRequestOption(){return new P.WM({"Content-type":"application/json",Authorization:this.authService.getAuth().token,"X-Requested-With":"XMLHttpRequest"})}saveManualStock(e){let i={status:"error",result:""},n=new O.xQ;return this.getRequestOption(),this.http.post(this.apiUrl+"/saveManualStockEntry",e).subscribe(s=>{n.next(s),n.unsubscribe()},s=>{i.status="error",i.result=s,n.next(i),n.unsubscribe()}),n}getManualStockListView(e,i){return this.http.get(`${this.apiUrl}/getManualStockListFroView?TNO=${e}&DIVISION=${i}`)}getWarehouseByDivision(e){let i={status:"error",result:""},n=new O.xQ;return this.http.get(`${this.apiUrl}/getWarehouseByDivision?DIVISION=${e}`).subscribe(o=>{n.next(o),n.unsubscribe()},o=>{i.status="error",i.result=o,n.next(i),n.unsubscribe()}),n}postBatchUnit(e){return this.http.post(this.apiUrl+"/saveManualStockBatch",e)}closeManualStockBatch(e){let i={status:"error",result:""},n=new O.xQ;return this.getRequestOption(),this.http.post(this.apiUrl+"/closeManualStockBatch",{BATCH:e}).subscribe(m=>{n.next(m),n.unsubscribe()},m=>{i.status="error",i.result=m,n.next(i),n.unsubscribe()}),n}loadManualBatchList(e,i){return this.http.get(this.apiUrl+"/loadManualBatchList?countDate="+e+"&division="+i)}mergeBatches(e){return this.http.post(this.apiUrl+"/saveMergedBatch",e)}viewMergedBatch(e,i){return this.http.get(this.apiUrl+"/viewMergedBatch?batch="+e+"&division="+i)}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(P.eN),t.LFG(l.gz),t.LFG(Z.e),t.LFG(Q.q))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();var U=a(67311),H=a(14970),V=a(87584),j=a(94534),q=a(11192),R=a(91772);const F=["genericGridview"],K=["genericGridedit"],w=function(){return{opacity:"50%"}};function W(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"input",17),t.NdJ("ngModelChange",function(n){const s=t.CHM(e).$implicit;return t.KtG(s.checked=n)}),t.qZA()(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"date"),t.qZA()()}if(2&r){const e=c.$implicit,i=t.oxw();t.xp6(2),t.Q6J("ngModel",e.checked)("ngStyle","view"==i.mode?t.DdM(7,w):null)("checked",1==e.checked),t.xp6(2),t.Oqu(e.BATCH),t.xp6(2),t.Oqu(t.lcZ(7,5,e.DATE))}}let Y=(()=>{class r{constructor(e,i,n,o){this.manualStockEntryService=e,this.alertService=i,this.loadingService=n,this.datePipe=o,this.closeEvent=new t.vpe,this.batchList=[],this.mode="new",this.disableMerge=!1,this.disableDate=!1,this.gridItemviewSettings=new g.im,this.gridItemeditSettings=new g.im}ngOnInit(){}onClose(){this.closeEvent.emit()}onLoadClick(){this.countDate?this.manualStockEntryService.loadManualBatchList(this.countDate,this.division).subscribe(e=>{if(this.addIsCheckedProperty(e.result),this.disableDate=!0,this.batchList&&this.batchList.length>0){const i=e.result.filter(n=>!this.batchList.some(o=>n.BATCH==o.BATCH&&n.DATE==o.DATE));this.batchList=[...this.batchList,...i]}else this.batchList=e.result}):this.alertService.warning("Count Date is required!!")}addIsCheckedProperty(e,i=!1){e.forEach(n=>{n.checked=i})}onMergeClick(){if(!this.countDate)return void this.alertService.warning("Count Date is required!!");if(!this.mbName)return void this.alertService.warning("Merged Batch Name is required!!");let e=this.batchList.filter(n=>1==n.checked);if(e.length<2)return void this.alertService.warning("Two or more Batches must be selected!!");let i={Mode:this.mode,Data:{BATCH:this.mbName,DIVISION:this.division,Date:this.countDate,REF_BATCH:e}};this.loadingService.show("Please wait.... Saving your data."),this.manualStockEntryService.mergeBatches(i).subscribe(n=>{this.loadingService.hide(),this.closeEvent.emit(),this.alertService.info("Batches Merged Successfully.")},n=>{this.loadingService.hide()})}dblClickedit(e,i){this.disableDate=!0,this.mode="edit",e.BATCH&&this.viewMergedBatch(e.BATCH,this.division)}dblClickview(e,i){this.mode="view",e.BATCH&&this.viewMergedBatch(e.BATCH,this.division)}viewMergedBatch(e,i){this.manualStockEntryService.viewMergedBatch(e,i).subscribe(n=>{n&&n.result&&n.result.REF_BATCH&&(this.addIsCheckedProperty(n.result.REF_BATCH,!0),this.batchList=n.result.REF_BATCH,n.result.BATCH&&(this.mbName=n.result.BATCH),n.result.DATE&&(this.countDate=this.datePipe.transform(n.result.DATE,"yyyy-MM-dd"))),"Adjusted"==n.result2?(this.disableMerge=!0,this.alertService.warning("Selected batch has already been adjusted!!")):this.disableMerge=!1})}onViewClick(){this.gridItemviewSettings={title:"View merged Batches",apiEndpoints:`/getMergedBatchPagedList/${this.division}`,defaultFilterIndex:0,columns:[{key:"BATCH",title:"Batch Name",hidden:!1,noSearch:!1},{key:"DATE",title:"Date",hidden:!1,noSearch:!1}]},console.log("show",this.genericGridview),this.genericGridview.show()}onEditClick(){this.gridItemeditSettings={title:"Edit Merged Batches",apiEndpoints:`/getMergedBatchPagedList/${this.division}`,defaultFilterIndex:0,columns:[{key:"BATCH",title:"Batch Name",hidden:!1,noSearch:!1},{key:"DATE",title:"Date",hidden:!1,noSearch:!1}]},this.genericGridedit.show()}onReset(){this.batchList=[],this.mbName="",this.countDate="",this.mode="new",this.disableDate=!1}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(E),t.Y36(U.c),t.Y36(H.V),t.Y36(u.uU))},r.\u0275cmp=t.Xpm({type:r,selectors:[["merge-batch-popup"]],viewQuery:function(e,i){if(1&e&&(t.Gf(F,5),t.Gf(K,5)),2&e){let n;t.iGM(n=t.CRH())&&(i.genericGridview=n.first),t.iGM(n=t.CRH())&&(i.genericGridedit=n.first)}},inputs:{division:"division",divisionName:"divisionName"},outputs:{closeEvent:"closeEvent"},features:[t._Bn([E,u.uU])],decls:41,vars:14,consts:[[1,"container"],[1,"top-section"],[1,"table-title"],[1,"cross-button",3,"click"],[1,"content-section"],[1,"input-section"],["type","text","name","mb_name","autocomplete","off",3,"ngModel","ngModelChange"],["type","date","name","date",3,"ngModel","disabled","ngModelChange"],["type","text","name","division",3,"ngModel","disabled","ngModelChange"],[3,"click"],[3,"disabled","ngStyle","click"],[1,"table-section"],[4,"ngFor","ngForOf"],[1,"merge-button",3,"disabled","ngStyle","click"],[3,"popupsettings","onItemDoubleClick"],["genericGridview",""],["genericGridedit",""],["type","checkbox",3,"ngModel","ngStyle","checked","ngModelChange"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Merge Batch"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return i.onClose()}),t._uU(5,"X"),t.qZA()(),t.TgZ(6,"div",4)(7,"div",5)(8,"div"),t._uU(9," M.B. Name: "),t.TgZ(10,"input",6),t.NdJ("ngModelChange",function(o){return i.mbName=o}),t.qZA(),t._uU(11," Date: "),t.TgZ(12,"input",7),t.NdJ("ngModelChange",function(o){return i.countDate=o}),t.qZA(),t._uU(13," Division: "),t.TgZ(14,"input",8),t.NdJ("ngModelChange",function(o){return i.divisionName=o}),t.qZA()(),t.TgZ(15,"div")(16,"button",9),t.NdJ("click",function(){return i.onReset()}),t._uU(17,"Reset"),t.qZA(),t.TgZ(18,"button",9),t.NdJ("click",function(){return i.onViewClick()}),t._uU(19,"View"),t.qZA(),t.TgZ(20,"button",9),t.NdJ("click",function(){return i.onEditClick()}),t._uU(21,"Edit"),t.qZA(),t.TgZ(22,"button",10),t.NdJ("click",function(){return i.onLoadClick()}),t._uU(23,"Load"),t.qZA()()(),t.TgZ(24,"div",11)(25,"table")(26,"thead")(27,"tr"),t._UZ(28,"th"),t.TgZ(29,"th"),t._uU(30,"Batch Name"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Counted Date"),t.qZA()()(),t.TgZ(33,"tbody"),t.YNc(34,W,8,8,"tr",12),t.qZA()()(),t.TgZ(35,"button",13),t.NdJ("click",function(){return i.onMergeClick()}),t._uU(36,"Merge"),t.qZA()()(),t.TgZ(37,"generic-popup-grid",14,15),t.NdJ("onItemDoubleClick",function(o){return i.dblClickview(o,i.mode)}),t.qZA(),t.TgZ(39,"generic-popup-grid",14,16),t.NdJ("onItemDoubleClick",function(o){return i.dblClickedit(o,i.mode)}),t.qZA()),2&e&&(t.xp6(10),t.Q6J("ngModel",i.mbName),t.xp6(2),t.Q6J("ngModel",i.countDate)("disabled",i.disableDate),t.xp6(2),t.Q6J("ngModel",i.divisionName)("disabled",!0),t.xp6(8),t.Q6J("disabled","view"==i.mode)("ngStyle","view"==i.mode?t.DdM(12,w):null),t.xp6(12),t.Q6J("ngForOf",i.batchList),t.xp6(1),t.Q6J("disabled","view"==i.mode||"edit"==i.mode&&i.disableMerge)("ngStyle","view"==i.mode||"edit"==i.mode&&i.disableMerge?t.DdM(13,w):null),t.xp6(2),t.Q6J("popupsettings",i.gridItemviewSettings),t.xp6(2),t.Q6J("popupsettings",i.gridItemeditSettings))},dependencies:[u.sg,u.PC,h.Fj,h.Wl,h.JJ,h.On,g.Zl,u.uU],styles:[".container[_ngcontent-%COMP%]{position:fixed;top:50%;right:50%;transform:translate(50%,-50%);background-color:#fff;width:70%;border:1px solid #ccc;box-shadow:0 0 10px #0000001a;z-index:9999;padding:0 0 10px}.top-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:#007bff;padding:10px}.table-title[_ngcontent-%COMP%]{font-weight:700}.cross-button[_ngcontent-%COMP%]{background-color:#ede7e7;color:#0c0101;border:none;padding:5px 10px;border-radius:5px;cursor:pointer}.content-section[_ngcontent-%COMP%]{padding:10px;margin-bottom:20px}.input-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;justify-content:space-between}.input-section[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .input-section[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{margin-right:10px;padding:5px}.input-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;cursor:pointer;margin-right:5px}.table-section[_ngcontent-%COMP%]{margin-bottom:20px;max-height:calc(50vh - 100px);overflow-y:scroll}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ccc;padding:8px;text-align:left}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f2f2f2}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{transform:scale(1.5);align-self:center}.merge-button[_ngcontent-%COMP%]{float:right;background-color:#007bff;color:#fff;border:none;cursor:pointer}"]}),r})();var z=a(41544),$=a(54471);const X=["focusWarehouse"],tt=["genericGridItem"],et=["genericGridview"],nt=["genericGridedit"];function it(r,c){if(1&r&&(t.TgZ(0,"option",16),t._uU(1),t.qZA()),2&r){const e=c.$implicit;t.Q6J("ngValue",e.BATCH),t.xp6(1),t.hij(" ",e.BATCH," ")}}function ot(r,c){if(1&r&&(t.ynx(0),t.TgZ(1,"option",16),t._uU(2),t.qZA(),t.BQk()),2&r){const e=c.$implicit;t.xp6(1),t.Q6J("ngValue",e.NAME),t.xp6(1),t.Oqu(e.NAME)}}function rt(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"div",41)(2,"div",42)(3,"div",43)(4,"h5",44),t._uU(5,"New Counting Batch"),t.qZA(),t.TgZ(6,"button",45),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.closeBatchModal())}),t.TgZ(7,"span",46),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",47)(10,"div",48)(11,"label",49),t._uU(12,"Division:"),t.qZA(),t.TgZ(13,"div",50)(14,"input",51),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.selectedDivisionName=n)}),t.qZA()()(),t.TgZ(15,"div",48)(16,"label",49),t._uU(17,"Batch Name:"),t.qZA(),t.TgZ(18,"div",50)(19,"input",52),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.batchUnitObj.BATCH=n)}),t.qZA()()(),t.TgZ(20,"div",12)(21,"label",49),t._uU(22,"Date:"),t.qZA(),t.TgZ(23,"div",50)(24,"input",53),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.batchUnitObj.DATE=n)}),t.qZA()()()(),t.TgZ(25,"div",54)(26,"button",55),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onBatchSubmit())}),t._uU(27,"Save"),t.qZA()()()()()}if(2&r){const e=t.oxw(2);t.xp6(14),t.Q6J("ngModel",e.selectedDivisionName)("disabled",!0),t.xp6(5),t.Q6J("ngModel",e.batchUnitObj.BATCH),t.xp6(5),t.Q6J("ngModel",e.batchUnitObj.DATE)}}function at(r,c){if(1&r&&(t.TgZ(0,"option",59),t._uU(1),t.qZA()),2&r){const e=c.$implicit;t.Q6J("value",e.BATCH),t.xp6(1),t.hij(" ",e.BATCH," ")}}function ct(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"div",41)(2,"div",42)(3,"div",43)(4,"h5",44),t._uU(5,"Close Counting Batch"),t.qZA(),t.TgZ(6,"button",45),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.closebatchclosemodal())}),t.TgZ(7,"span",46),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",47)(10,"div",48)(11,"label",49),t._uU(12,"Batch Name:"),t.qZA(),t.TgZ(13,"div",50)(14,"select",56),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.closeBatchName=n)}),t._UZ(15,"option",57),t.YNc(16,at,2,2,"option",58),t.qZA()()()(),t.TgZ(17,"div",54)(18,"button",55),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onBatchClose())}),t._uU(19,"Close Batch"),t.qZA()()()()()}if(2&r){const e=t.oxw(2);t.xp6(14),t.Q6J("ngModel",e.closeBatchName),t.xp6(2),t.Q6J("ngForOf",e.allBatchList)}}function st(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"merge-batch-popup",60),t.NdJ("closeEvent",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.mergeBatch())}),t.qZA()}if(2&r){const e=t.oxw(2);t.Q6J("division",e._trnMainService.TrnMainObj.DIVISION)("divisionName",e.selectedDivisionName)}}function lt(r,c){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h5"),t._uU(6),t.qZA()(),t.TgZ(7,"div",6)(8,"button",7),t._uU(9,"Back"),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.mergeBatch())}),t._uU(11,"Merge Batch"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.closeCountingBatch())}),t._uU(13,"Close Batch"),t.qZA(),t.TgZ(14,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.createBatch())}),t._uU(15,"Create Batch"),t.qZA(),t.TgZ(16,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onReset())}),t._uU(17,"Reset"),t.qZA(),t.TgZ(18,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSave())}),t._uU(19,"Save"),t.qZA(),t.TgZ(20,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onDelete(n.manualStockEntry.TNO))}),t._uU(21,"Delete"),t.qZA(),t.TgZ(22,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onView(n.manualStockEntry.TNO,n.manualStockEntry.DIVISION))}),t._uU(23,"View"),t.qZA(),t.TgZ(24,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onEdit(n.manualStockEntry.TNO,n.manualStockEntry.DIVISION))}),t._uU(25,"Edit"),t.qZA()()()(),t.TgZ(26,"div",10)(27,"div",11)(28,"div",12)(29,"label"),t._uU(30,"Entry No :"),t.qZA(),t.TgZ(31,"div",13)(32,"input",14),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.manualStockEntry.TNO=n)}),t.qZA()()(),t.TgZ(33,"div",12)(34,"label"),t._uU(35,"Counting Batch No :"),t.qZA(),t.TgZ(36,"div",13)(37,"select",15),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.manualStockChange(n))})("keydown.Tab",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.TabClickUnit())})("focus",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.newUnitCreateTrigger())}),t._UZ(38,"option",16),t.YNc(39,it,2,2,"option",17),t.qZA()()()(),t.TgZ(40,"div",18)(41,"div",12)(42,"label"),t._uU(43,"Division :"),t.qZA(),t.TgZ(44,"div",13)(45,"div",13)(46,"input",19),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedDivisionName=n)}),t.qZA()()()(),t.TgZ(47,"div",12)(48,"label",20),t._uU(49,"Counting Batch Date :"),t.qZA(),t.TgZ(50,"div",13)(51,"label",21),t._uU(52),t.ALo(53,"date"),t.qZA()()()(),t.TgZ(54,"div",18)(55,"div",12)(56,"label"),t._uU(57,"Warehouse :"),t.qZA(),t.TgZ(58,"div",13)(59,"div",13)(60,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o._trnMainService.TrnMainObj.MWAREHOUSE=n)})("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onWarehouseChange())}),t._UZ(61,"option"),t.YNc(62,ot,3,2,"ng-container",23),t.qZA()()()()()(),t.TgZ(63,"div",24)(64,"div",25),t._UZ(65,"discounts-insert"),t.qZA()(),t.TgZ(66,"div",26)(67,"div",24)(68,"div",27)(69,"div",28)(70,"generic-product-entry",29),t.NdJ("ShowGenericGridEvent",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.showGenericGrid(n))}),t.qZA()()()()(),t.TgZ(71,"div",30)(72,"div",31)(73,"div",32)(74,"div",33)(75,"div",34)(76,"h6"),t._uU(77),t.qZA()()()()()(),t.YNc(78,rt,28,4,"div",35),t.qZA(),t.YNc(79,ct,20,2,"div",35),t.YNc(80,st,1,2,"merge-batch-popup",36),t.TgZ(81,"generic-popup-grid",37,38),t.NdJ("onItemDoubleClick",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.dblClickPopupItem(n))}),t.qZA(),t.TgZ(83,"generic-popup-grid",37,39),t.NdJ("onItemDoubleClick",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.dblClickview(n,o.mode))}),t.qZA(),t.TgZ(85,"generic-popup-grid",37,40),t.NdJ("onItemDoubleClick",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.dblClickedit(n,o.mode))}),t.qZA(),t.BQk()}if(2&r){const e=t.oxw();t.xp6(6),t.hij("Physical Stock Entry [",e.mode,"]"),t.xp6(12),t.Q6J("disabled","VIEW"==e.mode),t.xp6(14),t.Q6J("ngModel",e.manualStockEntry.TNO)("disabled","VIEW"==e.mode),t.xp6(5),t.Q6J("ngModel",e.manualStockEntry.BATCH)("disabled","VIEW"==e.mode),t.xp6(1),t.Q6J("ngValue","%"),t.xp6(1),t.Q6J("ngForOf",e.batchlist),t.xp6(7),t.Q6J("ngModel",e.selectedDivisionName)("disabled",!0),t.xp6(6),t.Oqu(t.xi3(53,22,e.manualStockEntry.TRNDATE,"MM-dd-yyyy")),t.xp6(8),t.Q6J("ngModel",e._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","VIEW"==e.mode),t.xp6(2),t.Q6J("ngForOf",e.warehouseList),t.xp6(8),t.Q6J("GenericProductEntrySetting",e.genericProductEntrySetting),t.xp6(7),t.hij("TOTAL QTY: ",e.manualStockEntry.TotalQty," "),t.xp6(1),t.Q6J("ngIf",e.addNewBatch),t.xp6(1),t.Q6J("ngIf",e.showbatchclose),t.xp6(1),t.Q6J("ngIf",e.showMergePopup),t.xp6(1),t.Q6J("popupsettings",e.gridItemPopupSettings),t.xp6(2),t.Q6J("popupsettings",e.gridItemviewSettings),t.xp6(2),t.Q6J("popupsettings",e.gridItemeditSettings)}}function dt(r,c){if(1&r&&(t.ynx(0),t.TgZ(1,"option",16),t._uU(2),t.qZA(),t.BQk()),2&r){const e=c.$implicit;t.xp6(1),t.Q6J("ngValue",e.NAME),t.xp6(1),t.Oqu(e.NAME)}}function ut(r,c){if(1&r&&(t.TgZ(0,"option",16),t._uU(1),t.qZA()),2&r){const e=c.$implicit;t.Q6J("ngValue",e.BATCH),t.xp6(1),t.hij(" ",e.BATCH," ")}}function ht(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"div",73)(2,"div",74)(3,"div",43)(4,"h5",75),t._uU(5,"New Counting Batch"),t.qZA(),t.TgZ(6,"button",45),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.closeBatchModal())}),t.TgZ(7,"span",46),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",47)(10,"div",48)(11,"label",49),t._uU(12,"Division:"),t.qZA(),t.TgZ(13,"div",50)(14,"input",51),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.selectedDivisionName=n)}),t.qZA()()(),t.TgZ(15,"div",48)(16,"label",49),t._uU(17,"Batch Name:"),t.qZA(),t.TgZ(18,"div",50)(19,"input",52),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.batchUnitObj.BATCH=n)}),t.qZA()()(),t.TgZ(20,"div",12)(21,"label",49),t._uU(22,"Date:"),t.qZA(),t.TgZ(23,"div",50)(24,"input",53),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw(2);return t.KtG(o.batchUnitObj.DATE=n)}),t.qZA()()(),t.TgZ(25,"div",54)(26,"button",55),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onBatchSubmit())}),t._uU(27,"Save"),t.qZA()()()()()()}if(2&r){const e=t.oxw(2);t.xp6(14),t.Q6J("ngModel",e.selectedDivisionName)("disabled",!0),t.xp6(5),t.Q6J("ngModel",e.batchUnitObj.BATCH),t.xp6(5),t.Q6J("ngModel",e.batchUnitObj.DATE)}}function gt(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div",61)(1,"div",62),t._uU(2,"Physical Stock Entry"),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSave())}),t._uU(4,"Save"),t.qZA(),t.TgZ(5,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onDelete(n.manualStockEntry.TNO))}),t._uU(6,"Delete"),t.qZA(),t.TgZ(7,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.createBatch())}),t._uU(8,"Create Batch"),t.qZA(),t.TgZ(9,"div",63)(10,"div",64)(11,"label"),t._uU(12,"Entry No :"),t.qZA(),t.TgZ(13,"div",64)(14,"input",65),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.manualStockEntry.TNO=n)}),t.qZA()()(),t.TgZ(15,"label"),t._uU(16,"Division"),t.qZA(),t.TgZ(17,"div",66)(18,"input",19),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedDivisionName=n)}),t.qZA()(),t.TgZ(19,"label",21),t._uU(20,"Warehouse :"),t.qZA(),t.TgZ(21,"div",67)(22,"div",67)(23,"select",68),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o._trnMainService.TrnMainObj.MWAREHOUSE=n)})("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onWarehouseChange())}),t._UZ(24,"option"),t.YNc(25,dt,3,2,"ng-container",23),t.qZA()(),t.TgZ(26,"label",69),t._uU(27,"Counting Batch No :"),t.qZA(),t.TgZ(28,"div",12)(29,"div",13)(30,"select",70),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.manualStockChange(n))})("keydown.Tab",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.TabClickUnit())})("focus",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.newUnitCreateTrigger())}),t._UZ(31,"option",16),t.YNc(32,ut,2,2,"option",17),t.qZA()()()()(),t.TgZ(33,"div",71)(34,"generic-product-entry",72),t.NdJ("ShowGenericGridEvent",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.showGenericGrid(n))}),t.qZA()(),t.YNc(35,ht,28,4,"div",35),t.qZA()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("disabled","VIEW"==e.mode),t.xp6(11),t.Q6J("ngModel",e.manualStockEntry.TNO)("disabled","VIEW"==e.mode),t.xp6(4),t.Q6J("ngModel",e.selectedDivisionName)("disabled",!0),t.xp6(5),t.Q6J("ngModel",e._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","VIEW"==e.mode),t.xp6(2),t.Q6J("ngForOf",e.warehouseList),t.xp6(5),t.Q6J("ngModel",e.manualStockEntry.BATCH)("disabled","VIEW"==e.mode),t.xp6(1),t.Q6J("ngValue","%"),t.xp6(1),t.Q6J("ngForOf",e.batchlist),t.xp6(2),t.Q6J("GenericProductEntrySetting",e.genericProductEntrySetting),t.xp6(1),t.Q6J("ngIf",e.addNewBatch)}}const pt=[{path:"",component:(()=>{class r{constructor(e,i,n,o,s,m,T,B,b,D,C){this.masterService=e,this.fb=i,this.manualStockService=n,this.alertService=o,this.loadingService=s,this._trnMainService=m,this.genericProductEntryService=T,this.itemKeyEventService=B,this.entryValidateService=b,this.quantityChangeEventService=D,this.authService=C,this.addNewBatch=!1,this.category=!1,this.addNewCategory=!1,this.batch=!1,this.showMergePopup=!1,this.divisionlist=[],this.batchlist=[],this.warehouseList=[],this.activerowIndex=0,this.mode="",this.count=0,this.selectedDivisionName="",this.manualStockEntry={},this.batchUnitObj={},this.gridItemPopupSettings=new g.im,this.gridItemviewSettings=new g.im,this.gridItemeditSettings=new g.im,this.showbatchclose=!1,this.userSetting=C.getUserProfile(),this._trnMainService.initialFormLoad(107),this._trnMainService.TrnMainObj.DIVISION=this.userSetting.userDivision,this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION).subscribe(_=>{this.batchlist=_}),this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION,"close").subscribe(_=>{this.allBatchList=_}),this.masterService.getAllDivisions().subscribe(_=>{this.divisionlist=_,this.findDivisionName()}),this.manualStockService.getWarehouseByDivision(this._trnMainService.TrnMainObj.DIVISION).subscribe(_=>{this.warehouseList=_})}updown(e){"Insert"===e.code&&1==this.batch&&(this.addNewBatch=!0)}onResize(e){this.isLargeScreen=window.innerWidth>600}ngOnInit(){const e=new Date;this.batchUnitObj.DATE=(0,u.p6)(e,"yyyy-MM-dd","en-US"),this.onReset(),this.gridItemPopupSettings=Object.assign(new g.im,{title:"ITEMS",apiEndpoints:"/getItemListExceptService",defaultFilterIndex:1,useDefinefilterValue:"",columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"ITEM NAME",hidden:!1,noSearch:!1},{key:"BASEUNIT",title:"UNIT",hidden:!1,noSearch:!0},{key:"costprice",title:"COST PRICE",hidden:!1,noSearch:!0,alignment:"right",pipe:!0}]}),this.setProductEntryTable(),this.getEntryNumber(),this._trnMainService.TrnMainObj.DIVISION=this.userSetting.userDivision,this.onResize(null)}setProductEntryTable(){var e=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new M.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},disablePipe:(n,o)=>this.getColumnDisablePipe("disableAltQty",n,o)},{field:"BC",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},disablePipe:(n,o)=>this.getColumnDisablePipe("disableBarcode",n,o)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"380px"},disablePipe:(n,o)=>this.getColumnDisablePipe("disableItemDesc",n,o),focusTo:"ALTERNATEQUANTIY"},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},onChange:(n,o,s)=>this.QuantityChangeEvent_default(n,o,s),onEnter:n=>this.quantityChangeEventService.AlternateQuantityEventClick(n),onKeyPress:(n,o,s,m)=>this.quantityChangeEventService.quantityKeyPress(n,o,s,m),applyTwoDigitPipe:!1,disablePipe:(n,o)=>this.getColumnDisablePipe("disableAltQty",n,o),focusTo:"SHEETNO"},{field:"WAREHOUSE",header:"Warehouse",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"}},{field:"SHEETNO",header:"SheetNo#",inputType:"inputText",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},focusTo:"ITEMDESC",onEnter:(n,o,s,m)=>this.onEnterManualStockEntry(n,o,s)},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(n,o)=>this.getColumnDisablePipe("disableRowDelete",n,o)}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=e,this.genericProductEntrySetting.voucherType=p.Km.ManualstockEntry,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n)}SetRowItemFromSelectedItem(e){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,e),this._trnMainService.assignPrateaAsRATE(i,e),i.WAREHOUSE=this._trnMainService.TrnMainObj.MWAREHOUSE}SetRowItemRate(e,i){i()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(e,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}getColumnDisablePipe(e,i,n){return e}onEnterManualStockEntry(e,i,n){this.entryValidateService.mrpEnterEvent(e,i,n,()=>"default",()=>({useDefault:!0,preCheck:!1}),()=>!1)}dblClickPopupItem(e,i=""){console.log(e),setTimeout(()=>{this.masterService.focusAnyControl("ALTERNATEQUANTIY"+this.activerowIndex)},100)}focusAfterItemSelect(){2==this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType==p.Km.BatchAdjustment?null!=document.getElementById("BATCH"+this.genericProductEntryService.activerowIndex)&&setTimeout(()=>{document.getElementById("BATCH"+this.genericProductEntryService.activerowIndex).focus()},20):(null!=document.getElementById("ALTERNATEUNIT"+this.genericProductEntryService.activerowIndex)?(console.log("FOCUS HERE"),setTimeout(()=>{document.getElementById("ALTERNATEUNIT"+this.genericProductEntryService.activerowIndex).focus()},20)):null!=document.getElementById("ALTUNIT"+this.genericProductEntryService.activerowIndex)&&setTimeout(()=>{document.getElementById("ALTUNIT"+this.genericProductEntryService.activerowIndex).focus()},20),74===this._trnMainService.TrnMainObj.VoucherType&&null!=document.getElementById("ALTERNATEUNIT"+this.genericProductEntryService.activerowIndex)&&setTimeout(()=>{document.getElementById("ALTERNATEUNIT"+this.genericProductEntryService.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType===p.Km.RequisitionEntry&&null!=document.getElementById("ALTERNATEQUANTIY"+this.genericProductEntryService.activerowIndex)&&setTimeout(()=>{document.getElementById("ALTERNATEQUANTIY"+this.genericProductEntryService.activerowIndex).focus()},20))}rowClick(e,i){this.activerowIndex=e,this.data=i}onDelete(e){!this.checkValidation()||confirm("Are you sure you want to delete the entry?")&&this.manualStockService.deleteManualStockEntry(e,this._trnMainService.TrnMainObj.DIVISION).subscribe(i=>{console.log("Entry deleted successfully",i),this.onReset(),this.alertService.info(i.result)},i=>{console.error("Failed to delete entry",i)})}onReset(){this.manualStockEntry={},this.manualStockEntry.manualStockList=[],this.warehousename="",this.getEntryNumber(),this._trnMainService.barCodes={},this._trnMainService.barCodes.Quantity=1,this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this.mode="NEW",this.manualStockEntry.manualStockList.push({}),this.manualStockEntry.DIVISION=this.masterService.userProfile.userDivision,this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION).subscribe(i=>{this.batchlist=i}),setTimeout(()=>{this.masterService.focusAnyControl("itemname"+this.activerowIndex)},100)}focusToWarehouse(){setTimeout(()=>{this.masterService.focusAnyControl("whouse"+this.activerowIndex)}),this.manualStockEntry.TotalQty=this.manualStockEntry.manualStockList.map(e=>e.QTY).reduce((e,i)=>e+i,0)}focusToSheet(e,i){(""==this.manualStockEntry.manualStockList[this.activerowIndex].WAREHOUSE||null==this.manualStockEntry.manualStockList[this.activerowIndex].WAREHOUSE||null==this.manualStockEntry.manualStockList[this.activerowIndex].WAREHOUSE)&&this.alertService.warning("Warehouse cannot be empty"),setTimeout(()=>{this.masterService.focusAnyControl("sheet"+this.activerowIndex)})}checknegativevalue(){console.log("total Quan",this.manualStockEntry.TotalQty),this.manualStockEntry.TotalQty<0&&(this.alertService.warning("Quantity cannot be negative"),setTimeout(()=>{this.masterService.focusAnyControl("qty"+this.activerowIndex)},500))}focusToBarcode(){this.manualStockEntry.manualStockList.push({});var i=this.activerowIndex+1;this.mode=this.mode,console.log("MODE",this.mode),document.getElementById("sno"+this.activerowIndex).scrollIntoView(),setTimeout(()=>{this.masterService.focusAnyControl("itemname"+i),("NEW"==this.mode||"EDIT"==this.mode&&(null==this.manualStockEntry.manualStockList[i].MENUCODE||null==this.manualStockEntry.manualStockList[i].MENUCODE||""==this.manualStockEntry.manualStockList[i].MENUCODE))&&(this.manualStockEntry.manualStockList[i].WAREHOUSE=this.manualStockEntry.manualStockList[i-1].WAREHOUSE,this.manualStockEntry.manualStockList[i].SHEETNO=this.manualStockEntry.manualStockList[i-1].SHEETNO)},500)}addNextRow(e,i){this.manualStockEntry.manualStockList.push({WAREHOUSE:null}),this.mode=this.mode}showItemPopUp(e){if(this.checkValidation()){if(!this.warehousename)return void this.alertService.info("Please select Warehouse first!");this.genericGridForItem.show()}}dblClickview(e,i="VIEW"){this.manualStockEntry.TNO=e.TNO,this.batchlist.push({BATCH:e.BATCH}),this.manualStockEntry.BATCH=e.BATCH,this.manualStockEntry.DIVISION=e.DIVISION,this.manualStockEntry.TRNDATE=e.TRNDATE,this.manualStockService.getManualStockListView(this.manualStockEntry.TNO,this.manualStockEntry.DIVISION).subscribe(n=>{this.manualStockEntry.manualStockList=n,this.prepareprodListForViewModeAndEditMode(n),this.manualStockEntry.TotalQty=this.manualStockEntry.manualStockList.map(o=>o.QTY).reduce((o,s)=>o+s,0),this.warehousename=n[0].WAREHOUSE,this.mode="VIEW"})}prepareprodListForViewModeAndEditMode(e){this._trnMainService.TrnMainObj.ProdList=[];for(let i of e){let n={};n.BATCH=i.BATCH,n.ITEMDESC=i.DESCA,n.DIVISION=i.DIVISION,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.ALTERNATEQUANTIY=i.QTY,n.WAREHOUSE=i.WAREHOUSE,n.ALTUNIT=i.BASEUNIT,n.BC=i.BCODE,n.SHEETNO=i.SHEETNO,n.rowMode=this.mode,n.FulfillBatchQty=!1,this._trnMainService.TrnMainObj.ProdList.push(n)}}dblClickedit(e,i="EDIT"){1!=e.ISMERGED?1!=e.ISMERGEBATCH?(this.manualStockEntry.TNO=e.TNO,this.batchlist.push({BATCH:e.BATCH}),this.manualStockEntry.BATCH=e.BATCH,this.manualStockEntry.DIVISION=e.DIVISION,this.manualStockEntry.TRNDATE=e.TRNDATE,this.manualStockService.getManualStockListView(this.manualStockEntry.TNO,this.manualStockEntry.DIVISION).subscribe(n=>{this.manualStockEntry.manualStockList=n,this.prepareprodListForViewModeAndEditMode(n),this.manualStockEntry.TotalQty=this.manualStockEntry.manualStockList.map(o=>o.QTY).reduce((o,s)=>o+s,0),this.warehousename=n[0].WAREHOUSE,this.mode="EDIT"})):this.alertService.info("This is merged batch. So, can not be edited"):this.alertService.info("This batch is already merged. So, can not be edited")}clearRow(){confirm("Are you sure you want to delete the Row? ")&&this.manualStockEntry.manualStockList.splice(this.activerowIndex,1)}findDivisionName(){this.selectedDivisionName=this.divisionlist.find(e=>e.INITIAL==this._trnMainService.TrnMainObj.DIVISION).NAME}changeDiv(){this.findDivisionName(),this.manualStockService.getWarehouseByDivision(this._trnMainService.TrnMainObj.DIVISION).subscribe(e=>{this.warehouseList=e}),this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION).subscribe(e=>{this.batchlist=e})}onBatchSubmit(){this.batchUnitObj.DIVISION=this._trnMainService.TrnMainObj.DIVISION,this.loadingService.show("Data is Saving ..."),this.manualStockService.postBatchUnit(this.batchUnitObj).subscribe(e=>{"ok"==e.status?(this.loadingService.hide(),this.alertService.info("Saved Successfully"),this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION).subscribe(i=>{this.batchlist=i}),this.closeBatchModal()):(this.loadingService.hide(),this.alertService.error(e.result))},e=>{this.loadingService.hide(),console.log(e),this.alertService.error(e.error.result)})}mapManualStockListFromProdList(){this.manualStockEntry.manualStockList=[];for(let e of this._trnMainService.TrnMainObj.ProdList){let i={};i.BATCH=e.BATCH,i.DESCA=e.ITEMDESC,i.MCODE=e.MCODE,i.MENUCODE=e.MENUCODE,i.QTY=e.ALTERNATEQUANTIY,i.WAREHOUSE=e.WAREHOUSE,i.BCODE=e.BC,i.SHEETNO=e.SHEETNO,this.manualStockEntry.manualStockList.push(i)}}onSave(){if(this._trnMainService.TrnMainObj.ProdList?.length>1&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(e=>null!=e.MCODE&&""!=e.MCODE)),this.checkValidation()){if(this._trnMainService.TrnMainObj.ProdList.filter(e=>!e.WAREHOUSE)?.length>0)return void this.alertService.warning("Please select warehouse!");this.count=0,this.mapManualStockListFromProdList(),this.manualStockEntry.manualStockList.forEach(e=>{e.DIVISION=this._trnMainService.TrnMainObj.DIVISION,e.TNO=this.manualStockEntry.TNO,e.BATCH=this.manualStockEntry.BATCH,e.TRNDATE=this.manualStockEntry.TRNDATE,e.QTY||(e.QTY=0)}),"VIEW"==this.mode.toUpperCase()?this.alertService.error("Cannot Save in view Mode"):(this.loadingService.show("Please wait.... Saving your data."),this.manualStockService.saveManualStock({mode:this.mode,data:this.manualStockEntry.manualStockList}).subscribe(i=>{"ok"==i.status?(this.alertService.success("Data Saved Successfully"),this.loadingService.hide(),this.onReset(),this.manualStockEntry.DIVISION=this.masterService.userProfile.userDivision,this.manualStockEntry.manualStockList=[]):(this.loadingService.hide(),this.alertService.error(i.result.error))}))}}checkValidation(){return null==this.manualStockEntry.DIVISION||""==this.manualStockEntry.DIVISION||null==this.manualStockEntry.DIVISION?(this.alertService.warning("Division cannot be empty"),!1):null!=this.manualStockEntry.BATCH&&""!=this.manualStockEntry.BATCH&&null!=this.manualStockEntry.BATCH||(this.alertService.warning("Counting Batch cannot be empty If required, please create new batch"),!1)}onWarehouseChange(){this.warehousename&&this.manualStockEntry.manualStockList.forEach(e=>e.WAREHOUSE=this.warehousename)}closeBatchModal(){this.addNewBatch=!1,this.batchUnitObj.BATCH=""}newUnitCreateTrigger(){this.batch=!0}TabClickUnit(){setTimeout(()=>{document.getElementById("itemname").focus()},0)}nullToZeroConverter(e){return void 0===e||null==e||null===e||""===e||"Infinity"===e||"NaN"===e||Number.isNaN(e)||isNaN(parseFloat(e))?0:parseFloat(e)}onView(e,i){console.log("Entry Number",e,i),this.gridItemviewSettings={title:"Physical Stock Entry Item",apiEndpoints:`/getPagedManualStock/${this._trnMainService.TrnMainObj.DIVISION}`,defaultFilterIndex:0,columns:[{key:"TNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"BATCH",title:"Batch No",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1}]},this.genericGridview.show()}onEdit(e,i){console.log("Entry Number",e,i),this.gridItemviewSettings={title:"Physical Stock Entry Item",apiEndpoints:`/getPagedManualStock/${this._trnMainService.TrnMainObj.DIVISION}`,defaultFilterIndex:0,columns:[{key:"TNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"BATCH",title:"Batch No",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1}]},this.gridItemeditSettings={title:"Physical Stock Entry Item",apiEndpoints:`/getPagedManualStock/${this._trnMainService.TrnMainObj.DIVISION}`,defaultFilterIndex:0,columns:[{key:"TNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"BATCH",title:"Batch No",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1}]},this.genericGridedit.show()}getEntryNumber(){this.manualStockService.getEntryNumber().subscribe(e=>{this.manualStockEntry.TNO=e.result,console.log("StockID",e)})}manualStockChange(e){if("%"===e)this.manualStockEntry.BATCH="%";else{this.manualStockEntry.BATCH=e;let i=this.batchlist.find(n=>n.BATCH==e)?.DATE;this.manualStockEntry.TRNDATE=i}}createBatch(){this.addNewBatch=!0}mergeBatch(){this.showMergePopup=!this.showMergePopup}closeCountingBatch(){this.showbatchclose=!0}closebatchclosemodal(){this.showbatchclose=!1}showGenericGrid(e){this.itemKeyEventService.ItemkeyEvent(e.index,e.event,()=>d.K.done,i=>(this.setItemPopupUrl(i),d.K.default),()=>d.K.default,()=>d.K.default,()=>d.K.default)}setItemPopupUrl(e){return this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${e}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this._trnMainService.userSetting.DefaultFilterIndex?this._trnMainService.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:!0,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:!0,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:!0,noSearch:!0,alignment:"right",pipe:!0}]},this.genericProductEntryService.gridPopupSettings}onBatchClose(){console.log("on batch close",this.closeBatchName),this.loadingService.show("Closing Batch..."),this.manualStockService.closeManualStockBatch(this.closeBatchName).subscribe(e=>{console.log("response",e),"ok"==e.status?(this.loadingService.hide(),this.alertService.info(e.result),this.manualStockService.getBatchNumber(this._trnMainService.TrnMainObj.DIVISION).subscribe(i=>{this.batchlist=i,console.log("BatchList",i)}),this.closebatchclosemodal()):(this.loadingService.hide(),this.alertService.error(e.result))},e=>{this.loadingService.hide()})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(J.P),t.Y36(h.qu),t.Y36(E),t.Y36(U.c),t.Y36(H.V),t.Y36(V.p),t.Y36(j.w),t.Y36(d.X),t.Y36(q.C),t.Y36(R.s),t.Y36(Z.e))},r.\u0275cmp=t.Xpm({type:r,selectors:[["manualstockentry"]],viewQuery:function(e,i){if(1&e&&(t.Gf(X,5),t.Gf(tt,5),t.Gf(et,5),t.Gf(nt,5)),2&e){let n;t.iGM(n=t.CRH())&&(i.focusWarehouse=n.first),t.iGM(n=t.CRH())&&(i.genericGridForItem=n.first),t.iGM(n=t.CRH())&&(i.genericGridview=n.first),t.iGM(n=t.CRH())&&(i.genericGridedit=n.first)}},hostBindings:function(e,i){1&e&&t.NdJ("keydown",function(o){return i.updown(o)},!1,t.evT)("resize",function(o){return i.onResize(o)},!1,t.Jf7)},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["smallScreen",""],[1,"sectionWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-4"],[1,"col-md-8"],["routerLink","/pages/dashboard",1,"btn","btn-info","pull-right",2,"font-size","12px"],[1,"btn","btn-info","pull-right",2,"font-size","12px",3,"click"],[1,"btn","btn-info","pull-right",2,"font-size","12px",3,"disabled","click"],[1,"row","plainBackGround",2,"margin-top","0.5rem","padding-top","1rem"],[1,"col-md-3"],[1,"form-group","row"],[1,"col-md-6"],["type","number","readonly","",2,"width","14rem",3,"ngModel","disabled","ngModelChange"],["id","manualstockWH",1,"form-control",2,"width","14rem","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange","keydown.Tab","focus"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-3",2,"margin-left","20px"],["id","manualStockInput",1,"form-control",2,"width","14rem","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange"],[2,"width","auto"],[2,"font-size","13px"],[2,"width","14rem","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange","change"],[4,"ngFor","ngForOf"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"col-md-12","pd5",2,"height","61vh","overflow-x","scroll"],[1,"web-version"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"sticky-bottom"],[1,"row","clearfix","footer"],[1,"col-md-12","right",2,"vertical-align","center"],[1,"row"],[1,"col-md-2",2,"margin-left","30%"],[4,"ngIf"],[3,"division","divisionName","closeEvent",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridItem",""],["genericGridview",""],["genericGridedit",""],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px","margin-right","8rem"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label",2,"margin-left","-12px"],[1,"col-sm-8"],["type","text","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","disabled","ngModelChange"],["type","text","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","date",1,"date-input","form-control",2,"height","3vh",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[1,"form-control",2,"width","14rem","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","ngModelChange"],["value","%","selected",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"division","divisionName","closeEvent"],[1,"container"],[1,"header"],[1,"mainbox",2,"padding","20px 0px"],[1,"entry-no"],["type","number","readonly","",2,"width","14rem","height","25px","font-size","13px",3,"ngModel","disabled","ngModelChange"],[1,"division"],[1,"warehouse"],[2,"width","14rem","height","25px","color","black","font-size","13px","padding-bottom","10px",3,"ngModel","disabled","ngModelChange","change"],[2,"font-size","11px","width","120px"],["id","manualstockWH",1,"form-control",2,"width","14rem","height","25px","color","black","font-size","13px","margin-left","-29px","margin-top","-18px",3,"ngModel","disabled","ngModelChange","keydown.Tab","focus"],[1,"table-container"],[1,"generic-product-entry",3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"modal-sticky",2,"padding","0px","margin-bottom","20px","margin-right","8rem"],[1,"modal-content","modal-content-main-area",2,"width","200px"],[1,"modal-title",2,"padding-left","5px","font-size","20px"]],template:function(e,i){if(1&e&&(t.YNc(0,lt,87,25,"ng-container",0),t.YNc(1,gt,36,14,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",i.isLargeScreen)("ngIfElse",n)}},dependencies:[u.sg,u.O5,h.YN,h.Kr,h.Fj,h.wV,h.EJ,h.JJ,h.On,g.Zl,Y,l.rH,z.Z,$.o,u.uU],styles:[".web-version[_ngcontent-%COMP%]{\n    display: block;\n\n  }\n  .mobile-version[_ngcontent-%COMP%]{\n    display: none;\n  }\n  @media (max-width: 600px){\n    .web-version[_ngcontent-%COMP%]{\n    display: none;\n\n  }\n  .mobile-version[_ngcontent-%COMP%]{\n    display: block;\n  } \n  }",'td[_ngcontent-%COMP%] {\n     border: 1px solid #e6e6e6;\n}\n .footer[_ngcontent-%COMP%] {\n \n \n margin-right: 1px;\n height: 70px;\n clear: both;\n padding-top: 20px;\n border: 1px solid #eaeaea;\n background-color: #d1d6d8;\n}\n .card-body[_ngcontent-%COMP%] {\n     padding: 0 !important;\n }\n\n .form-group.row[_ngcontent-%COMP%] {\n     margin-bottom: 5px;\n }\n\n input[_ngcontent-%COMP%], select[_ngcontent-%COMP%] {\n     height: 26px;\n     font-size: 14px;\n     padding-top: 0;\n     padding-bottom: 0px;\n }\n\n th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{\n     padding: .2rem;\n     vertical-align: top;\n     border-top: 1px solid #dee2e6;\n     font-size: 14px;\n }\n th[_ngcontent-%COMP%]{\n     position: sticky; top: -1px; z-index: 1;\n     background-color: #7ed0ff;\n }\n\n th[_ngcontent-%COMP%]:first-child {\n     border-bottom: 1px solid #dee2e6;\n }\n .highlighted[_ngcontent-%COMP%]{\n     background-color: #ced6d3;\n }\n .row[_ngcontent-%COMP%]:after {\ncontent: "";\ndisplay: table;\nclear: both;\n}\n.column[_ngcontent-%COMP%] {\nfloat: left;\nwidth: 25%;\npadding: 10px;\n\n}',"*[_ngcontent-%COMP%] {\n          box-sizing: border-box;\n      }\n\n      .container[_ngcontent-%COMP%] {\n          width: 100%;\n          max-width: 600px;\n          background-color: white;\n          border-radius: 8px;\n          overflow: hidden;\n          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n      }\n\n      .header[_ngcontent-%COMP%] {\n          background: linear-gradient(to right, #007aff, #00aaff);\n          color: white;\n          text-align: center;\n          padding: 15px 10px;\n          font-size: 1.2em;\n      }\n\n      .form-group[_ngcontent-%COMP%] {\n          padding: 15px;\n      }\n\n      .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n          width: 100%;\n          padding: 1rem 0.5rem;\n          margin: 10px 0;\n          border: 1px solid #ddd;\n          border-radius: 5px;\n          font-size: 1em;\n      }\n\n      .table-container[_ngcontent-%COMP%] {\n          overflow-x: auto;\n      }\n\n      table[_ngcontent-%COMP%] {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 10px;\n      }\n\n      th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n          padding: 12px;\n          text-align: left;\n          border-bottom: 1px solid #ddd;\n      }\n\n      th[_ngcontent-%COMP%] {\n          background-color: #336799;;\n          color: white;\n      }\n\n      .payment-details[_ngcontent-%COMP%] {\n          background-color: #007aff;\n          color: white;\n          text-align: center;\n          padding: 12px;\n          font-weight: bold;\n          cursor: pointer;\n      }\n\n      .payment-details[_ngcontent-%COMP%]:hover {\n          background-color: #005bb5;\n      }"]}),r})()}];let mt=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[l.Bz.forChild(pt),l.Bz]}),r})();var _t=a(63321);let St=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({providers:[E],imports:[u.ez,h.u5,h.UX,_t._]}),r})();var vt=a(34579),Mt=a(56209),Et=a(60694),ft=a(7782),Tt=a(74263);let bt=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({providers:[E,Et.T,R.s,ft.y,Tt.R],imports:[u.ez,k.m,x.JX,I.Xd,y.Is,v.b.forRoot(),S.x.forRoot(),N.c.forRoot(),A.Z,St,mt,Mt.u,vt.h]}),r})()}}]);